{"inframe":false,"title":"员工管理","hidden":false,"roles":{"default":1},"children":[{"configs":{"initScript":"var ctxPath = request.getContextPath();\nrequest.setAttribute(\"contextPath\",ctxPath);\n\nvar dbType = com.xzsoft.xip.platform.util.PlatformUtil.getDbType();\nrequest.setAttribute(\"dbType\", dbType);","loginRequired":"false","jsLinks":"[\"xip/js/xip-debug.js\"]","itemId":"module"},"events":{"initialize":"var nametype='';\nvar checktype='0';\n\nfunction getuuid() {\n var s = [];\n var hexDigits = \"0123456789abcdef\";\n for (var i = 0; i < 36; i++) {\n s[i] = hexDigits.substr(Math.floor(Math.random() * 0x10), 1);\n }\n s[14] = \"4\"; // bits 12-15 of the time_hi_and_version field to 0010\n s[19] = hexDigits.substr((s[19] & 0x3) | 0x8, 1); // bits 6-7 of the clock_seq_hi_and_reserved to 01\n s[8] = s[13] = s[18] = s[23] = \"-\";\n\nvar uuid = s.join(\"\");\n return uuid;\n}\n\nfunction resetAndAdd() {\n\n    // 刷新主表Grid信息\n    app.empgrid.store.load();  \n    // 清空表单信息\n    app.EMP_CODE.setValue() ;\n    app.EMP_NAME.setValue() ;\n    app.BIRTHDAY.setValue() ;\n    app.ATTRIBUTE2.setValue('Y') ;\n    app.PHONE_NO.setValue() ;\n    app.ATTRIBUTE1.setValue() ;\n    app.ID_NO.setValue() ;\n    app.EMAIL.setValue() ;\n    app.ADDRESS.setValue() ;\n    app.BANK_NO.setValue();\n    app.BANK_NAME.setValue();\n    //清空默认用户表单\n    app.userName.setValue();\n\n    var _empId1 = getuuid() ;\n    app.EMP_ID.setValue(_empId1) ;\n    app.opType.setValue('add');\n\n}\n\n\n\n\n\n\n\n\n// var temp_flag = true;//标志位，是否删除对应的个人往来信息\n\n// cellclick:function(grid,td,cellIndex,record,tr,rowIndex){\n//     var selectedRecord = app.gridedit.store.getAt(rowIndex);\n//   if(cellIndex==7){\n//     if(Ext.isEmpty(selectedRecord.get('ORG_ID'))){\n//       Wb.toast('请选择组织!');\n//       return false;\n//     }else{\n//       app.deptstore.load({ params:{ orgId: selectedRecord.get('ORG_ID')}});\n\n//     }\n//   }else if(cellIndex==8){\n//     if(Ext.isEmpty(selectedRecord.get('ORG_ID'))){\n//       Wb.toast('请选择组织!');\n//       return false;\n//     }\n\n//     if(Ext.isEmpty(selectedRecord.get('DEPT_ID'))){\n//       Wb.toast('请选择部门!');\n//       return false;\n//     }\n//      app.poststore.load({ params:{ orgId:selectedRecord.get('ORG_ID'),deptId:selectedRecord.get('DEPT_ID')}});\n\n//   }\n//   else  if(cellIndex === 10){\n\n//      Ext.Msg.confirm('提示','您确定要删除此分配信息吗？',function(a){\n//      if(a=='yes'){\n       \n//        //核对账薄信息，删除对应的个人往来信息\n//        var temp_count = app.gridedit.store.getCount();\n//        for(var i=0;i<temp_count;i++){\n//           var rec = app.gridedit.store.getAt(i);\n//           //有组织一样的存在的就不用删除个人往来信息\n//           if(rec.data.ORG_ID === r.data.ORG_ID){\n//             temp_flag = false;\n//             break;\n//           } \n//        }\n       \n//        var r = app.gridedit.store.getAt(rowIndex) ;\n//        var json = {'asg_id' : r.data.ASG_ID} ;\n//          Wb.request({\n//            url : 'm?xwl=cux_xip/hr/emp/data/deleteEmpAsg',//同时删除个人往来\n//            params : json,\n//            success :function(response){\n             \n//               Wb.request({\n//                  url : 'm?xwl=cux_xip/hr/emp/data/deletelDEmp',//同时删除个人往来\n//                  params : {ld_emp_id:r.data.LD_EMP_ID} ,\n//                  success :function(response){\n\n//                  }\n//               });\n             \n             \n//            }\n//         });\n//       app.gridedit.store.removeAt(rowIndex) ;\n//     }else{\n//       return false ;\n//     }\n//   });\n//    }\n//   }"},"children":[{"configs":{"itemId":"stores"},"children":[{"configs":{"pageSize":"-1","autoLoad":"true","itemId":"orgstore","url":"m?xwl=xip/hr/emp/data/selelctOrgs"},"children":[],"expanded":false,"type":"store"},{"configs":{"pageSize":"10","autoLoad":"false","itemId":"deptstore","url":"m?xwl=xip/hr/emp/data/selelctDepts"},"events":{"beforeload":"var r = app.gridedit.getSelectionModel().getSelection();\nvar temp = r[0].data.ORG_ID;\nstore.proxy.extraParams.orgId = temp;"},"children":[],"expanded":false,"type":"store"},{"configs":{"pageSize":"10","autoLoad":"false","itemId":"poststore","url":"m?xwl=xip/hr/emp/data/selelctPosts"},"events":{"beforeload":"var r = app.gridedit.getSelectionModel().getSelection();\nstore.proxy.extraParams.orgId = r[0].data.ORG_ID;\nstore.proxy.extraParams.deptId = r[0].data.DEPT_ID;"},"children":[],"expanded":false,"type":"store"},{"configs":{"pageSize":"-1","autoLoad":"false","itemId":"updateEmpBeforeCheckStore","url":"m?xwl=cux_xip/hr/emp/data/updateEmpBeforeCheck"},"events":{"failure":"Wb.toast('保存失败');","success":"//根据查询出来的结果判断是新增还是修改\nvar count = store.getCount();\n\n//判断是员工开张信息新增状态还是修改，默认为新增状态\nvar temp_url = 'm?xwl=cux_xip/hr/emp/data/updateEmpInertExEmp';\nif(count!==0)\n  temp_url = 'm?xwl=cux_xip/hr/emp/data/update';\n\nvar json = {\n  empId:app.EMP_ID.getValue(),\n  empCode:app.EMP_CODE.getValue(),\n  empName:app.EMP_NAME.getValue(),\n  _sex:app.EMP_SEX.getValue(),\n  empIdNumber:app.ID_NO.getValue(),\n  empMobilePhone:app.PHONE_NO.getValue(),\n  empAddress:app.ADDRESS.getValue(),\n  empEmail:app.EMAIL.getValue(),\n  empTelephone:app.ATTRIBUTE1.getValue(),\n  birthday:app.BIRTHDAY.getValue(),\n  empStatus:app.ATTRIBUTE2.getValue(),\n  bankNo:app.BANK_NO.getValue(),\n  bankName:app.BANK_NAME.getValue()\n};\n\nWb.request({\n  async:false,\n  url: temp_url, \n  params: json,\n  success: function() {\n    if(app.gridedit.store.getModifiedRecords().length===0 && app.gridedit.store.getRemovedRecords().length===0){\n      Wb.toast('保存成功!');\n    }else{\n      var rows = app.gridedit.store.getModifiedRecords();//获取所有修改的行记录\n      var insertArray = [];//存放新增记录\n      var updateArray = [];//存放修改记录\n      var tempLdEmp = [];//存放需要查询的组织\n      var insertLdEmpArray = [];//存放新增的个人往来记录\n      \n      //存在被修改的数据\n      for(var i=0;i<rows.length;i++) {\n        var temp_id = rows[i].data.ASG_ID;//分配ID\n        var temp_emp = rows[i].data.EMP_ID;//员工ID\n        var temp_org = rows[i].data.ORG_ID;//组织ID\n        var temp_dept = rows[i].data.DEPT_ID;//部门ID   \n        var temp_post = rows[i].data.POST_ID;//岗位ID                      \n        var temp_enabled = rows[i].data.ENABLED;//是否启用\n\n        var mesg = \"{'ASG_ID':'\"+temp_id+\"','EMP_ID':'\"+temp_emp+\"','ORG_ID':'\"+temp_org+\"','DEPT_ID':'\"+temp_dept+\"','POST_ID':'\"+temp_post+\"','ENABLED':'\"+temp_enabled+\"'}\";\n        //账薄ID为空是新增操作\n        if(temp_id===''||temp_id===null) \n          insertArray.push(Wb.decode(mesg));\n        //否则是修改操作\n        else\n          updateArray.push(Wb.decode(mesg));\n      }\n      \n\n      //新增个人往来信息\n      var temp_ldEmp_count = app.gridedit.store.getCount();\n      //获得所有新增的唯一组织\n      for(var i=0;i<temp_ldEmp_count;i++) {\n        var id = app.gridedit.store.getAt(i).data.ASG_ID;//分配ID\n        var emp = app.gridedit.store.getAt(i).data.EMP_ID;//员工ID\n        var org = app.gridedit.store.getAt(i).data.ORG_ID;//组织ID\n        //看下新增记录中是否有组织一样的\n        if(id==='' || id===null) {\n          var temp_flag = true;\n          //核对组织信息是一样的则不需要保存组织ID\n          for(var j=0;j<i;j++) {\n            if(org===app.gridedit.store.getAt(j).data.ORG_ID) {\n              temp_flag = false;\n              break;\n            }\n          }\n          if(temp_flag) {\n            tempLdEmp.push(org);\n          }\n        }\n      }\n      //根据组织ID查询相对应的账薄ID\n      if(tempLdEmp.length>0){\n        var orgMsg = '';\n        //拼接需要查询的组织ID\n        for(var i=0;i<tempLdEmp.length;i++){\n          orgMsg = orgMsg+ \"'\"+tempLdEmp[i]+\"'\";\n          if(i!=tempLdEmp.length-1)\n            orgMsg = orgMsg+',';\n        }\n        //获得所有组织对应的账薄\n        Wb.request({\n          async:false,\n          url:'m?xwl=cux_xip/hr/emp/data/select_ledgerId_by_orgId',\n          params:{orgId:orgMsg},\n          success:function(response) {\n            var tempLedgerId = Wb.decode(response.responseText).rows;\n            for(var i=0;i<tempLedgerId.length;i++){\n              var leggerId = tempLedgerId[i].LEDGER_ID;\n              var mesg = \"{'LD_EMP_ID':'',\"+\"'LEDGER_ID':'\"+leggerId+\"','EMP_ID':'\"+app.EMP_ID.getValue()+\"'}\";\n              insertLdEmpArray.push(Wb.decode(mesg));\n            }\n          }\n        });\n      }\n \n      //执行新增或者修改操作\n      if(insertArray.length>0||updateArray.length>0){\n        Wb.request({\n          url:'m?xwl=cux_xip/hr/emp/data/insert_update_empAsg',\n          params:{insertArray:insertArray,updateArray:updateArray,insertLdEmpArray:insertLdEmpArray},\n          success:function(){\n            //新增与修改状态下的保存操作\n            Wb.toast('数据保存成功');\n            app.gridedit.store.reload();\n          },failure:function(){\n            Wb.toast('数据保存失败');\n          }\n        });\n      }\n      \n    }\n    //禁用员工后禁用用户\n    var type =app.ATTRIBUTE2.getValue();\n    var empid1 =app.EMP_ID.getValue();\n    var d=new Date();\n    if(type=='N'){\n      var date=new Date(d.getFullYear(),d.getMonth(),d.getDate()-1);\n      var jsont={end_date:date,empId:empid1};\n      Wb.request({\n        url: 'm?xwl=cux_xip/hr/emp/data/updateUser', \n        params: jsont ,\n        success: function() {\n        }  \n      });\n    }else{\n      var date1=new Date(d.getFullYear()+20,d.getMonth(),d.getDate());\n      var jsont1={end_date:date1,empId:empid1};\n      Wb.request({\n        url: 'm?xwl=cux_xip/hr/emp/data/updateUser', \n        params: jsont1 ,\n        success: function() {\n        }  \n      });\n    }\n    app.empgrid.store.load();\n  } \n});\n"},"children":[],"expanded":false,"type":"store"}],"expanded":false,"type":"folder"},{"configs":{"itemId":"Winbtns"},"children":[{"configs":{"text":"保存","itemId":"saveWin","iconCls":"save_icon"},"events":{"click":"var emp_Id=app.EMP_ID.getValue();\nvar _empCode = app.EMP_CODE.getValue();\nif(_empCode === null || _empCode === \"\"){\n  Wb.toast('请录入员工编码');\n  return false ;\n}\nvar _birthday= app.BIRTHDAY.getValue();\nif(_birthday > new Date()){\n  Wb.toast('出生日期不能大于当前日期');\n  return false ;\n}\nvar _empName = app.EMP_NAME.getValue();\nif(_empName === null || _empName === \"\"){\n  Wb.toast('请录入员工姓名');\n  return false ;\n}\nvar _empMobilePhone = app.PHONE_NO.getValue();\nvar phonePatrn= /^(0|86|17951)?(13[0-9]|15[012356789]|17[678]|18[0-9]|14[57])[0-9]{8}$/;\nif(!Ext.isEmpty(_empMobilePhone)){\n  if(!phonePatrn.test(_empMobilePhone)){\n    Wb.toast('手机号格式不合法');\n    return;\n  }\n}\n\nvar _empTelephone = app.ATTRIBUTE1.getValue();\nvar telPatrn=/^[+]{0,1}(\\d){1,3}[ ]?([-]?((\\d)|[ ]){1,12})+$/;\nif(!Ext.isEmpty(_empTelephone)){\n  if(!telPatrn.test(_empTelephone)){\n    Wb.toast('固定电话格式不合法!');\n    return;\n  }\n}\n\nvar _empEmail = app.EMAIL.getValue();\nif(_empEmail === null || _empEmail === \"\"){\n  Wb.toast('请录入邮箱信息');\n  return false ;\n}\n\nvar emailPatrn= /^([a-zA-Z0-9_\\.\\-])+\\@(([a-zA-Z0-9\\-])+\\.)+([a-zA-Z0-9]{2,4})+$/;\nif(!Ext.isEmpty(_empEmail)){\n  if(!emailPatrn.test(_empEmail)){\n    Wb.toast('邮箱格式不合法!');\n    return;\n  }\n}\n\nvar _empIdNumber = app.ID_NO.getValue();\nvar idNumPatrn = /(^\\d{15}$)|(^\\d{18}$)|(^\\d{17}(\\d|X|x)$)/;\nif(!Ext.isEmpty(_empIdNumber)){\n  if(!idNumPatrn.test(_empIdNumber)){\n    Wb.toast('身份证格式不合法!');\n    return;\n  }\n}\n\n//判断员工分配信息是否有重复，岗位是否为空\nvar temp_count = app.gridedit.store.getCount();\nfor(var i=0;i<temp_count;i++){\n  var rec = app.gridedit.store.getAt(i);\n  if(rec.data.POST_NAME === null||rec.data.POST_NAME===''){\n    Wb.toast('请选择岗位！');\n    return false;\n  }\n  //判断信息是否重复\n  for(var j=0;j<i;j++) {\n    var temp = app.gridedit.store.getAt(j);\n    if((rec.data.ORG_NAME===temp.data.ORG_NAME)&&(rec.data.DEPT_NAME===temp.data.DEPT_NAME)&&(rec.data.POST_NAME===temp.data.POST_NAME)) {\n      Wb.toast(\"员工分配信息不能重复!\") ;\n      return false ;\n    }\n  }\n}\n\n//判断创建用户是否隐藏\nif('edit' != app.opType.getValue()){\n  app.panel7.show();\n}else{\napp.panel7.hide();\n}\n \nvar json = {\n  empId:app.EMP_ID.getValue(),\n  empCode:app.EMP_CODE.getValue(),\n  empName:app.EMP_NAME.getValue(),\n  _sex:app.EMP_SEX.getValue(),\n  empIdNumber:app.ID_NO.getValue(),\n  empMobilePhone:app.PHONE_NO.getValue(),\n  empAddress:app.ADDRESS.getValue(),\n  empEmail:app.EMAIL.getValue(),\n  empTelephone:app.ATTRIBUTE1.getValue(),\n  birthday:_birthday,\n  empStatus:app.ATTRIBUTE2.getValue(),\n  bankNo:app.BANK_NO.getValue(),\n  bankName:app.BANK_NAME.getValue()\n};\n\n//新增员工\nif('edit' != app.opType.getValue()){\n  app.panel7.hide();\n   Wb.request({\n           async:false,\n           url: 'm?xwl=cux_xip/hr/emp/data/insert', \n           params: json,\n           success: function() {\n            //保存默认用户\n             if('edit' != app.opType.getValue()){\n               if(checktype=='1'){\n                 var _password = Xip.getMD5('11111'); // md5加密\n                 var _primaryKey = getuuid();\n                 var jsonuser = {\n                 empId:app.EMP_ID.getValue(),\n                 userName:app.userName.getValue(),\n                 password:_password,\n                 endDate:app.endDate.getValue(),\n                 primaryKey:_primaryKey\n                                } ;  \n                Wb.request({\n                  url: 'm?xwl=cux_xip/hr/emp/data/insertUser', \n                  params: jsonuser,\n                  success: function(){\n                  \n                  }\n                });\n\n               }\n             }\n           if(app.gridedit.store.getModifiedRecords().length===0 && app.gridedit.store.getRemovedRecords().length===0){\n                app.opType.setValue(\"edit\");//修改状态\n                 Wb.toast('保存成功!');\n                 //Ext.Msg.alert('提示','保存成功!');\n               }else{\n                  app.opType.setValue(\"edit\");\n                  var rows = app.gridedit.store.getModifiedRecords();//获取所有修改的行记录\n                  var insertArray = [];//存放新增的分配记录\n                  var updateArray = [];//存放修改的分配记录\n                  var tempLdEmp = [];//存放需要查询的组织\n                  var insertLdEmpArray = [];//存放新增的个人往来记录\n                 \n                  //存在被修改的数据\n                  for(var i=0;i<rows.length;i++) {\n                    var temp_id = rows[i].data.ASG_ID;//分配ID\n                    var temp_emp = rows[i].data.EMP_ID;//员工ID\n                    var temp_org = rows[i].data.ORG_ID;//组织ID\n                    var temp_dept = rows[i].data.DEPT_ID;//部门ID   \n                    var temp_post = rows[i].data.POST_ID;//岗位ID                      \n                    var temp_enabled = rows[i].data.ENABLED;//是否启用\n\n                    var mesg = \"{'ASG_ID':'\"+temp_id+\"','EMP_ID':'\"+temp_emp+\"','ORG_ID':'\"+temp_org+\"','DEPT_ID':'\"+temp_dept+\"','POST_ID':'\"+temp_post+\"','ENABLED':'\"+temp_enabled+\"'}\";\n\n                    //MSG_ID为空是新增操作(新增分配信息)\n                    if(temp_id===''||temp_id===null) {\n                      insertArray.push(Wb.decode(mesg));                      \n                    }                    \n                    //否则是修改操作\n                    else\n                      updateArray.push(Wb.decode(mesg));\n                  }\n                  \n\n                 \n                  //新增个人往来信息\n                  var temp_ldEmp_count = app.gridedit.store.getCount();\n                  //获得所有新增的唯一组织\n                  for(var i=0;i<temp_ldEmp_count;i++) {\n                    var id = app.gridedit.store.getAt(i).data.ASG_ID;//分配ID\n                    var emp = app.gridedit.store.getAt(i).data.EMP_ID;//员工ID\n                    var org = app.gridedit.store.getAt(i).data.ORG_ID;//组织ID\n                    //看下新增记录中是否有组织一样的\n                    if(id==='' || id===null) {\n                      var temp_flag = true;\n                      //核对组织信息是一样的则不需要保存组织ID\n                      for(var j=0;j<i;j++) {\n                        if(org===app.gridedit.store.getAt(j).data.ORG_ID) {\n                          temp_flag = false;\n                          break;\n                        }\n                      }\n                      if(temp_flag) {\n                        tempLdEmp.push(org);\n                      }\n                    }\n                  }\n                  //根据组织ID查询相对应的账薄ID\n                  if(tempLdEmp.length>0){\n                    var orgMsg = '';\n                    //拼接需要查询的组织ID\n                    for(var i=0;i<tempLdEmp.length;i++){\n                      orgMsg = orgMsg+ \"'\"+tempLdEmp[i]+\"'\";\n                      if(i!=tempLdEmp.length-1)\n                        orgMsg = orgMsg+',';\n                    }\n                    //获得所有组织对应的账薄\n                    Wb.request({\n                      async:false,\n                      url:'m?xwl=cux_xip/hr/emp/data/select_ledgerId_by_orgId',\n                      params:{orgId:orgMsg},\n                      success:function(response) {\n                        var tempLedgerId = Wb.decode(response.responseText).rows;\n                        for(var i=0;i<tempLedgerId.length;i++){\n                          var leggerId = tempLedgerId[i].LEDGER_ID;\n                          var mesg = \"{'LD_EMP_ID':'',\"+\"'LEDGER_ID':'\"+leggerId+\"','EMP_ID':'\"+app.EMP_ID.getValue()+\"'}\";\n                          insertLdEmpArray.push(Wb.decode(mesg));\n                        }\n                      }\n                    });\n                  }\n\n                 if(insertArray.length>0||updateArray.length>0){\n                   Wb.request({\n                     async:false,\n                     url:'m?xwl=cux_xip/hr/emp/data/insert_update_empAsg',\n                     params:{insertArray:insertArray,updateArray:updateArray,insertLdEmpArray:insertLdEmpArray},\n                     success:function(){\n                       //新增与修改状态下的保存操作\n                       Wb.toast('数据保存成功');\n                       // 加载员工分配信息\n                       app.gridedit.store.load({params:{empId:app.EMP_ID.getValue()}});\n                     },failure:function(){\n                       Wb.toast('数据保存失败');\n                     }\n                   });\n                 }  \n                 \n           }\n           app.empgrid.store.load();\n          }\n       });\n}\n\n//修改员工信息\nelse{  \n  //先校验员工扩展信息是新增还是修改\n  app.updateEmpBeforeCheckStore.load({\n    params:{empId:app.EMP_ID.getValue()}\n  });\n}\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"保存并添加下一个","itemId":"savenextWin","iconCls":"save_all_icon"},"events":{"click":"var emp_Id=app.EMP_ID.getValue();\nvar _empCode = app.EMP_CODE.getValue();\nif(_empCode === null || _empCode === \"\"){\n  Wb.toast(\"请录入员工编码\");\n  return false ;\n}\nvar _birthday= app.BIRTHDAY.getValue();\nif(_birthday > new Date()){\n  Wb.toast(\"出生日期不能大于当前日期\");\n  return false ;\n}\nvar _empName = app.EMP_NAME.getValue();\nif(_empName === null || _empName === \"\"){\n  Wb.toast(\"请录入员工名称\");  \n  return false ;\n}\n\nvar _empMobilePhone = app.PHONE_NO.getValue();\nvar phonePatrn= /^(0|86|17951)?(13[0-9]|15[012356789]|17[678]|18[0-9]|14[57])[0-9]{8}$/;\nif(!Ext.isEmpty(_empMobilePhone)){\n  if(!phonePatrn.test(_empMobilePhone)){\n    Wb.toast(\"手机号格式不合法!\");  \n    return;\n  }\n}\n\nvar _empTelephone = app.ATTRIBUTE1.getValue();\nvar telPatrn=/^[+]{0,1}(\\d){1,3}[ ]?([-]?((\\d)|[ ]){1,12})+$/;\nif(!Ext.isEmpty(_empTelephone)){\n  if(!telPatrn.test(_empTelephone)){\n    Wb.toast(\"固定电话格式不合法!\");  \n    return;\n  }\n}\n\nvar _empEmail = app.EMAIL.getValue();\nif(_empEmail === null || _empEmail === \"\"){\n  Wb.toast(\"请录入邮箱信息\");    \n  return false ;\n}\n\nvar emailPatrn= /^([a-zA-Z0-9_\\.\\-])+\\@(([a-zA-Z0-9\\-])+\\.)+([a-zA-Z0-9]{2,4})+$/;\nif(!Ext.isEmpty(_empEmail)){\n  if(!emailPatrn.test(_empEmail)){\n    Wb.toast(\"邮箱格式不合法!\");\n    return;\n  }\n}\n\nvar _empIdNumber = app.ID_NO.getValue();\nvar idNumPatrn = /(^\\d{15}$)|(^\\d{18}$)|(^\\d{17}(\\d|X|x)$)/;\nif(!Ext.isEmpty(_empIdNumber)){\n  if(!idNumPatrn.test(_empIdNumber)){\n    Wb.toast('身份证格式不合法!');\n    return;\n  }\n}\n\n//判断员工分配信息是否有重复，岗位是否为空\nfor(var i=0 ; i<app.gridedit.store.getCount();i++){\n  var rec = app.gridedit.store.getAt(i);\n  if(rec.data.POST_NAME === null||rec.data.POST_NAME===''){\n    Wb.toast('请选择岗位！');\n    return false;\n  }\n  //判断信息是否重复\n  for(var j=0;j<i;j++) {\n    var temp = app.gridedit.store.getAt(j);\n    if((rec.data.ORG_NAME===temp.data.ORG_NAME)&&(rec.data.DEPT_NAME===temp.data.DEPT_NAME)&&(rec.data.POST_NAME===temp.data.POST_NAME)) {\n      Wb.toast(\"员工分配信息不能重复!\") ;\n      return false ;\n    }\n  }\n}\n\n\n//判断创建用户是否隐藏\n\napp.panel7.show();\n\n  \n// 执行保存处理\nvar json = {\n  empId:app.EMP_ID.getValue(),\n  empCode:app.EMP_CODE.getValue(),\n  empName:app.EMP_NAME.getValue(),\n  _sex:app.EMP_SEX.getValue(),\n  empIdNumber:app.ID_NO.getValue(),\n  empMobilePhone:app.PHONE_NO.getValue(),\n  empAddress:app.ADDRESS.getValue(),\n  empEmail:app.EMAIL.getValue(),\n  empTelephone:app.ATTRIBUTE1.getValue(),\n  birthday:_birthday,\n  empStatus:app.ATTRIBUTE2.getValue(),\n  bankNo:app.BANK_NO.getValue(),\n  bankName:app.BANK_NAME.getValue()\n};\n \nif('edit' != app.opType.getValue()){\n if(emp_Id===null || emp_Id===''){\n   \n    var _empId=uuid() ;\n    json.empId=_empId;\n    app.EMP_ID.setValue(_empId); \n  \n  }\n  //app.panel7.hide();\n   Wb.request({\n           async:false,\n           url: 'm?xwl=cux_xip/hr/emp/data/insert',  \n           params: json,\n           success: function() {\n            //保存默认用户\n             if('edit' != app.opType.getValue()){\n               if(checktype=='1'){\n                 var _password = Xip.getMD5('11111'); // md5加密\n                 var _primaryKey = getuuid();\n                 var jsonuser = {\n                 empId:app.EMP_ID.getValue(),\n                 userName:app.userName.getValue(),\n                 password:_password,\n                 endDate:app.endDate.getValue(),\n                 primaryKey:_primaryKey\n                                } ;  \n                Wb.request({\n                  url: 'm?xwl=cux_xip/hr/emp/data/insertUser',  \n                  params: jsonuser,\n                  success: function(){\n                  \n                  }\n                });\n\n               }\n             }\n           if(app.gridedit.store.getModifiedRecords().length===0 && app.gridedit.store.getRemovedRecords().length===0){\n                app.opType.setValue(\"edit\");\n                 Wb.toast('保存成功!');\n               }else{\n                 var rows = app.gridedit.store.getModifiedRecords();//获取所有修改的行记录\n                 var insertArray = [];//存放新增记录\n                 var updateArray = [];//存放修改记录\n                 var tempLdEmp = [];//存放需要查询的组织\n                 var insertLdEmpArray = [];//存放新增的个人往来记录\n                 \n                 //存在被修改的数据\n                 for(var i=0;i<rows.length;i++) {\n                   var temp_id = rows[i].data.ASG_ID;//分配ID\n                   var temp_emp = rows[i].data.EMP_ID;//员工ID\n                   var temp_org = rows[i].data.ORG_ID;//组织ID\n                   var temp_dept = rows[i].data.DEPT_ID;//部门ID   \n                   var temp_post = rows[i].data.POST_ID;//岗位ID                      \n                   var temp_enabled = rows[i].data.ENABLED;//是否启用\n\n                   var mesg = \"{'ASG_ID':'\"+temp_id+\"','EMP_ID':'\"+temp_emp+\"','ORG_ID':'\"+temp_org+\"','DEPT_ID':'\"+temp_dept+\"','POST_ID':'\"+temp_post+\"','ENABLED':'\"+temp_enabled+\"'}\";\n\n                   //账薄ID为空是新增操作\n                   if(temp_id===''||temp_id===null) \n                     insertArray.push(Wb.decode(mesg));\n                   //否则是修改操作\n                   else\n                     updateArray.push(Wb.decode(mesg));\n                 }\n                 \n                 \n                    \n                  //新增个人往来信息\n                  var temp_ldEmp_count = app.gridedit.store.getCount();\n                  //获得所有新增的唯一组织\n                  for(var i=0;i<temp_ldEmp_count;i++) {\n                    var id = app.gridedit.store.getAt(i).data.ASG_ID;//分配ID\n                    var emp = app.gridedit.store.getAt(i).data.EMP_ID;//员工ID\n                    var org = app.gridedit.store.getAt(i).data.ORG_ID;//组织ID\n                    //看下新增记录中是否有组织一样的\n                    if(id==='' || id===null) {\n                      var temp_flag = true;\n                      //核对组织信息是一样的则不需要保存组织ID\n                      for(var j=0;j<i;j++) {\n                        if(org===app.gridedit.store.getAt(j).data.ORG_ID) {\n                          temp_flag = false;\n                          break;\n                        }\n                      }\n                      if(temp_flag) {\n                        tempLdEmp.push(org);\n                      }\n                    }\n                  }\n                  //根据组织ID查询相对应的账薄ID\n                  if(tempLdEmp.length>0){\n                    var orgMsg = '';\n                    //拼接需要查询的组织ID\n                    for(var i=0;i<tempLdEmp.length;i++){\n                      orgMsg = orgMsg+ \"'\"+tempLdEmp[i]+\"'\";\n                      if(i!=tempLdEmp.length-1)\n                        orgMsg = orgMsg+',';\n                    }\n                    //获得所有组织对应的账薄\n                    Ext.Ajax.request({\n                      sync:false,\n                      url:'m?xwl=cux_xip/hr/emp/data/select_ledgerId_by_orgId',\n                      params:{orgId:orgMsg},\n                      success:function(response) {\n                        var tempLedgerId = Wb.decode(response.responseText).rows;\n                        for(var i=0;i<tempLedgerId.length;i++){\n                          var leggerId = tempLedgerId[i].LEDGER_ID;\n                          var mesg = \"{'LD_EMP_ID':'',\"+\"'LEDGER_ID':'\"+leggerId+\"','EMP_ID':'\"+app.EMP_ID.getValue()+\"'}\";\n                          insertLdEmpArray.push(Wb.decode(mesg));\n                        }\n                      }\n                    });\n                  }\n              \n                 \n                 \n                 \n                 if(insertArray.length>0||updateArray.length>0){\n                   Wb.request({\n                     async:false,\n                     url:'m?xwl=cux_xip/hr/emp/data/insert_update_empAsg',\n                     params:{insertArray:insertArray,updateArray:updateArray,insertLdEmpArray:insertLdEmpArray},\n                     success:function(){\n                       //新增与修改状态下的保存操作\n                       Wb.toast('数据保存成功');\n                       app.gridedit.getStore().load();\n                     },failure:function(){\n                       Wb.toast('数据保存失败');\n                     }\n                   });\n                 }                 \n              }\n             //清空表单信息\n             resetAndAdd();\n             // 加载员工分配信息\n             app.gridedit.store.load({params:{empId:_empId1}}); \n             \n          }\n       });\n}\n//修改员工信息\nelse{\n  //先校验员工扩展信息是新增还是修改\n  app.updateEmpBeforeCheckStore.load({\n    params:{empId:app.EMP_ID.getValue()},\n    snyc:false,\n    success:function(){\n      //清空表单信息\n      resetAndAdd();\n      // 加载员工分配信息\n      app.gridedit.store.load({params:{empId:_empId1}}); \n    }\n  });\n}\n\n\n\n\n\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"关闭","itemId":"closeWin","iconCls":"cancel_icon"},"events":{"click":"app.win.close();"},"children":[],"expanded":false,"type":"button"}],"expanded":false,"type":"array"},{"configs":{"height":"550","width":"760","layout":"border","closeAction":"hide","buttons":"app.Winbtns","buttonAlign":"center","dialog":"false","itemId":"win","modal":"true"},"children":[{"configs":{"region":"north","frame":"true","style":"border-width:0px","border":"false","itemId":"addForm"},"children":[{"configs":{"hidden":"true","itemId":"EMP_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","value":"add","itemId":"opType"},"children":[],"expanded":false,"type":"text"},{"configs":{"frame":"true","style":"border-width:0px;padding-top:6px","bodyCls":"my-panel-no-border","layout":"column","columnWidth":".5","border":"false","itemId":"panel1"},"children":[{"configs":{"labelWidth":"80","allowBlank":"false","width":"320","labelAlign":"right","itemId":"EMP_CODE","fieldLabel":"<font color='red'>*<\/font>员工编码"},"events":{"blur":"var empcode=app.EMP_CODE.getValue().toUpperCase();\n\napp.userName.setValue(empcode);"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"80","allowBlank":"false","width":"320","labelAlign":"right","itemId":"EMP_NAME","fieldLabel":"<font color='red'>*<\/font>员工姓名"},"children":[],"expanded":false,"type":"text"}],"expanded":false,"type":"panel"},{"configs":{"frame":"true","style":"border-width:0px;padding-top:6px","bodyCls":"my-panel-no-border","layout":"column","columnWidth":".5","border":"false","itemId":"panel2"},"children":[{"configs":{"labelWidth":"80","width":"190","labelAlign":"right","itemId":"BIRTHDAY","fieldLabel":"出生日期"},"children":[],"expanded":false,"type":"date"},{"configs":{"labelWidth":"50","width":"130","value":"Y","labelAlign":"right","pickList":"[['Y','已启用'],['N','未启用']]","itemId":"ATTRIBUTE2","fieldLabel":"状态"},"children":[],"expanded":true,"type":"combo"},{"configs":{"tagConfigs":"{\n  //重载控件的getValue/setValue方法\n  getValue: function() {\n    var vals = Wb.getValue(this, ['radio1', 'radio2']);\n    if (vals.radio1)\n      return 1;\n    else if (vals.radio2)\n      return 2;\n    else return null;\n  },\n  setValue: function(v) {\n    Wb.setValue(this, {\n      radio1: v === 1,\n      radio2: v === 2\n    });\n  }\n}","labelWidth":"80","width":"320","layout":"hbox","labelAlign":"right","itemId":"EMP_SEX","fieldLabel":"性别"},"children":[{"configs":{"width":"100","name":"empsex","itemId":"radio1","boxLabel":"男"},"children":[],"expanded":false,"type":"radio"},{"configs":{"width":"100","name":"empsex","itemId":"radio2","boxLabel":"女"},"children":[],"expanded":false,"type":"radio"}],"expanded":false,"type":"fieldcontainer"}],"expanded":false,"type":"panel"},{"configs":{"frame":"true","style":"border-width:0px;padding-top:6px","bodyCls":"my-panel-no-border","layout":"column","columnWidth":".5","border":"false","itemId":"panel3"},"children":[{"configs":{"labelWidth":"80","width":"320","labelAlign":"right","itemId":"PHONE_NO","fieldLabel":"手    机"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"80","width":"320","labelAlign":"right","itemId":"ATTRIBUTE1","fieldLabel":"固定电话"},"children":[],"expanded":false,"type":"text"}],"expanded":false,"type":"panel"},{"configs":{"frame":"true","style":"border-width:0px;padding-top:6px","bodyCls":"my-panel-no-border","layout":"column","columnWidth":".5","border":"false","itemId":"panel4"},"children":[{"configs":{"labelWidth":"80","width":"320","labelAlign":"right","itemId":"ID_NO","fieldLabel":"身份证"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"80","width":"320","labelAlign":"right","itemId":"EMAIL","fieldLabel":"<font color='red'>*<\/font>邮   箱"},"children":[],"expanded":false,"type":"text"}],"expanded":false,"type":"panel"},{"configs":{"frame":"true","style":"border-width:0px;padding-top:6px","layout":"column","columnWidth":".5","border":"false","itemId":"panel6"},"children":[{"configs":{"labelWidth":"80","width":"640","labelAlign":"right","itemId":"ADDRESS","fieldLabel":"家庭地址"},"children":[],"expanded":false,"type":"text"}],"expanded":false,"type":"panel"},{"configs":{"frame":"true","style":"border-width:0px;padding-top:6px","bodyCls":"my-panel-no-border","layout":"column","columnWidth":".5","margin":"0 0 10 0","border":"false","itemId":"panel7"},"children":[{"configs":{"labelWidth":"80","width":"320","labelAlign":"right","itemId":"empcheck","fieldLabel":"创建用户"},"events":{"change":"var type=check.getValue();\nif(type==true){\n\n  app.userName.show();\n  checktype='1';\n \n}else{\napp.userName.hide();\n\nchecktype='0';\n  \n}"},"children":[],"expanded":false,"type":"check"},{"configs":{"labelWidth":"80","width":"320","labelAlign":"right","itemId":"userName","fieldLabel":"用户名"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","labelAlign":"right","itemId":"endDate","fieldLabel":"结束时间 "},"children":[],"expanded":false,"type":"date"}],"expanded":false,"type":"panel"},{"configs":{"frame":"true","style":"border-width:0px;padding-top:6px","bodyCls":"my-panel-no-border","layout":"column","columnWidth":".5","border":"false","itemId":"panel8"},"children":[{"configs":{"labelWidth":"80","width":"320","labelAlign":"right","padding":"0 0 5 0","itemId":"BANK_NO","fieldLabel":"银行账号"},"events":{"change":"//使银行卡号只能接收数字\ntext.setValue(text.getValue().replace(/[^\\d\\d]/g, \"\"));"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"80","width":"320","labelAlign":"right","padding":"0 0 5 0","itemId":"BANK_NAME","fieldLabel":"开户银行"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":false,"type":"form"},{"configs":{"region":"center","title":"员工分配","collapsible":"true","layout":"fit","itemId":"fieldset1"},"children":[{"configs":{"multiSelect":"true","selType":"cellmodel","forceFit":"true","itemId":"gridedit","editable":"true"},"events":{"tagEvents":"cellclick:function(grid,td,cellIndex,record,tr,rowIndex){\n    var selectedRecord = app.gridedit.store.getAt(rowIndex);\n  if(cellIndex==7){\n    if(Ext.isEmpty(selectedRecord.get('ORG_ID'))){\n      Wb.toast('请选择组织!');\n      return false;\n    }else{\n      app.deptstore.load({ params:{ orgId: selectedRecord.get('ORG_ID')}});\n\n    }\n  }else if(cellIndex==8){\n    if(Ext.isEmpty(selectedRecord.get('ORG_ID'))){\n      Wb.toast('请选择组织!');\n      return false;\n    }\n\n    if(Ext.isEmpty(selectedRecord.get('DEPT_ID'))){\n      Wb.toast('请选择部门!');\n      return false;\n    }\n     app.poststore.load({ params:{ orgId:selectedRecord.get('ORG_ID'),deptId:selectedRecord.get('DEPT_ID')}});\n\n  }\n  else  if(cellIndex === 10){\n\n     Ext.Msg.confirm('提示','您确定要删除此分配信息吗？',function(a){\n     if(a=='yes'){\n       \n          var deleteLdEmpArray = [];//存储需要批量删除的个人往来记录\n       \n          var r = app.gridedit.store.getAt(rowIndex) ; \n       \n          //核对账薄信息，删除对应的个人往来信息\n          var temp_count = app.gridedit.store.getCount();\n          var temp_flag = false;\n          for(var i=0;i<temp_count;i++){\n            \n            var rec = app.gridedit.store.getAt(i);\n            \n            //有组织一样的存在的就不用删除个人往来信息\n            if((rec.data.ORG_ID == r.data.ORG_ID)&&(rec.data.ASG_ID != r.data.ASG_ID)){\n               temp_flag = true;\n             } \n          }\n          //根据组织查询对应的账薄信息\n          if(!temp_flag){\n            //获得所有组织对应的账薄\n            Wb.request({\n              async:false,\n              url:'m?xwl=cux_xip/hr/emp/data/select_ledgerId_by_orgId',\n              params:{orgId:\"'\"+r.data.ORG_ID+\"'\"},\n              success:function(response) {\n                var tempLedgerId = Wb.decode(response.responseText).rows;\n                for(var i=0;i<tempLedgerId.length;i++){\n                  var leggerId = tempLedgerId[i].LEDGER_ID;\n                  var mesg = {'LEDGER_ID':leggerId,'EMP_ID':app.EMP_ID.getValue()};\n                  deleteLdEmpArray.push(mesg);\n                }\n              }\n            });\n          }\n       Wb.request({\n           url : 'm?xwl=cux_xip/hr/emp/data/deleteEmpAsg',\n           params : {asg_id:r.data.ASG_ID,deleteLdEmpArray:deleteLdEmpArray},\n           success :function(response){\n           }\n      });\n      app.gridedit.store.removeAt(rowIndex) ;\n    }else{\n      return false ;\n    }\n  });\n    \n   }\n\n  }"},"children":[{"configs":{"autoLoad":"false","itemId":"store","url":"m?xwl=cux_xip/hr/emp/data/readEmpAsg"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"新增","itemId":"addrow","iconCls":"plus_icon","tooltip":"新增员工分配信息"},"events":{"click":"var e=app.gridedit.plugins[0],index=app.gridedit.store.getCount()===0?0:app.gridedit.store.getCount();\ne.completeEdit();\n\napp.gridedit.store.insert(index,{});\napp.gridedit.store.getAt(index).set('ASG_ID','');\napp.gridedit.store.getAt(index).set('EMP_ID',app.EMP_ID.getValue());\napp.gridedit.store.getAt(index).set('ENABLED','Y');\ne.startEditByPosition({row:index,column:2});"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"序号","width":"50","align":"center","xtype":"rownumberer","titleAlign":"center","itemId":"chartNumber"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"asg_id","hidden":"true","dataIndex":"ASG_ID","titleAlign":"center","itemId":"COLUMN_ASG_ID"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"id","hidden":"true","dataIndex":"EMP_ID","titleAlign":"center","itemId":"COLUMN_EMP_ID"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"组织ID","hidden":"true","dataIndex":"ORG_ID","titleAlign":"center","itemId":"COLUMN_ORG_ID"},"children":[],"expanded":false,"type":"column"},{"configs":{"editor":"app.editororg","text":"组织","autoWrap":"false","width":"200","dataIndex":"ORG_NAME","titleAlign":"center","itemId":"COLUMN_ORG_NAME","renderer":"metaData.style = 'overflow:auto;padding: 3px 6px;text-overflow: ellipsis;white-space: nowrap;white-space:normal;line-height:18px;';   \nreturn value;"},"children":[{"configs":{"store":"app.orgstore","displayField":"ORG_NAME","valueField":"ORG_ID","itemId":"editor"},"events":{"select":"var r = app.gridedit.getSelectionModel().getSelection();\nr[0].set('ORG_ID',combo.getValue()) ;\n//r[0].set('ORG_NAME',app.editororg.getRawValue()) ;\ncombo.setValue(combo.getRawValue());\n\n//app.COLUMN_DEPT_NAME.clearValue();\nr[0].set('DEPT_ID','') ;\nr[0].set('DEPT_NAME','') ;\nr[0].set('POST_ID','') ;\nr[0].set('POST_NAME','') ;\n","focus":"//不容许更改组织信息\nvar rec = app.gridedit.getSelection();\nif(rec.length!==0) {\n  if((rec[0].data.ASG_ID!=='')&&(rec[0].data.ASG_ID!==null)) {\n    Wb.warn('组织部不能被修改!');\n    return;\n  }\n}"},"children":[],"expanded":true,"type":"combo"}],"expanded":false,"type":"column"},{"configs":{"text":"部门ID","hidden":"true","dataIndex":"DEPT_ID","titleAlign":"center","itemId":"COLUMN_DEPT_ID"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"部门","width":"150","dataIndex":"DEPT_NAME","titleAlign":"center","itemId":"COLUMN_DEPT_NAME","renderer":"metaData.style = 'overflow:auto;padding: 3px 6px;text-overflow: ellipsis;white-space: nowrap;white-space:normal;line-height:18px;';   \nreturn value;"},"children":[{"configs":{"itemId":"editor"},"events":{"expand":"//清空模糊选项的tbar\napp.deptstore.load();\napp.query_dept_name.setValue();"},"children":[{"configs":{"tagConfigs":"minWidth:400","height":"300","barPageButton":"true","store":"app.deptstore","barExportButtons":"false","width":"400","barRefreshButton":"false","barNavigateButtons":"true","itemId":"pickComp"},"events":{"itemclick":"//赋值\nvar r = app.gridedit.getSelectionModel().getSelection();\nr[0].set('POST_ID','') ;\nr[0].set('POST_NAME','') ;\n\nr[0].set('DEPT_ID',record.data.DEPT_ID) ;\nr[0].set('DEPT_NAME',record.data.DEPT_NAME) ;//把记录DEPT_ID存放到隐藏域，可方便被提交到后台\n\nvar picker = this.ownerCmp;\npicker.setValue(record.data.DEPT_NAME);\npicker.collapse();//隐藏picker"},"children":[{"configs":{"itemId":"tbar"},"children":[{"configs":{"emptyText":"支持编码和名称查询","itemId":"query_dept_name"},"events":{"specialkey":"if(e.getKey()===13) {\n  app.queryDeptBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"queryDeptBtn","iconCls":"seek_icon"},"events":{"click":"//判断组织信息是否为空 \nvar r = app.gridedit.getSelectionModel().getSelection();\nif(r[0].data.ORG_NAME === ''||r[0].data.ORG_NAME===null || r[0].data.ORG_ID === ''||r[0].data.ORG_ID===null) {\n  Ext.MessageBox.alert('提示','请先选择组织信息!');\n  return;\n}\n\napp.deptstore.load({\n   params:{dept_name:app.query_dept_name.getValue()}\n});"},"children":[],"expanded":false,"type":"item"},{"configs":{"itemId":"deleteDeptBtn","iconCls":"delete_icon"},"events":{"click":"var r = app.gridedit.getSelectionModel().getSelection();\nr[0].set('DEPT_ID','') ;\nr[0].set('DEPT_NAME','');\nr[0].set('POST_ID','') ;\nr[0].set('POST_NAME','') ;\napp.COLUMN_DEPT_NAME.getEditor().setValue();\napp.COLUMN_DEPT_NAME.getEditor().getPicker().hide();\n"},"children":[],"expanded":false,"type":"item"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"序号","hidden":"true","align":"center","xtype":"rownumberer","width":"50","titleAlign":"center","itemId":"dept_row_num"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"部门ID","hidden":"true","width":"80","dataIndex":"DEPT_ID","titleAlign":"center","itemId":"dept_id_col"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"编码","width":"80","dataIndex":"DEPT_CODE","titleAlign":"center","itemId":"dept_code_col"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"名称","width":"220","dataIndex":"DEPT_NAME","titleAlign":"center","itemId":"dept_name_col"},"children":[],"expanded":false,"type":"column"}],"expanded":false,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":false,"type":"column"},{"configs":{"text":"岗位ID","hidden":"true","dataIndex":"POST_ID","titleAlign":"center","itemId":"COLUMN_POST_ID"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"岗位","width":"130","dataIndex":"POST_NAME","titleAlign":"center","itemId":"COLUMN_POST_NAME"},"children":[{"configs":{"itemId":"editor"},"events":{"expand":"//清空模糊选项的tbar\napp.poststore.load();\napp.query_post_name.setValue();","focus":"\n"},"children":[{"configs":{"tagConfigs":"minWidth:400","height":"300","barPageButton":"true","store":"app.poststore","barExportButtons":"false","width":"400","barRefreshButton":"false","barNavigateButtons":"true","itemId":"pickComp"},"events":{"itemclick":"//赋值\nvar r = app.gridedit.getSelectionModel().getSelection();\n\nr[0].set('POST_ID',record.data.POST_ID) ;//把记录POST_ID存放到隐藏域，可方便被提交到后台\nr[0].set('POST_NAME',record.data.POST_NAME) ;\n\nvar picker = this.ownerCmp;\npicker.setValue(record.data.POST_NAME);\npicker.collapse();//隐藏picker"},"children":[{"configs":{"itemId":"tbar"},"children":[{"configs":{"emptyText":"支持编码和名称查询","itemId":"query_post_name"},"events":{"specialkey":"if(e.getKey()===13) {\n   app.queryPostBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"queryPostBtn","iconCls":"seek_icon"},"events":{"click":"\n//判断组织信息是否为空 \nvar r = app.gridedit.getSelectionModel().getSelection();\nif(r[0].data.ORG_NAME === ''||r[0].data.ORG_NAME===null || r[0].data.ORG_ID === ''||r[0].data.ORG_ID===null) {\n  Ext.MessageBox.alert('提示','请先选择组织信息!');\n  return;\n}\nif(r[0].data.DEPT_ID === ''||r[0].data.DEPT_ID===null || r[0].data.DEPT_NAME === ''||r[0].data.DEPT_NAME===null) {\n  Ext.MessageBox.alert('提示','请先选择部门信息!');\n  return;\n}\n\napp.poststore.load({\n   params:{post_name:app.query_post_name.getValue()}\n});"},"children":[],"expanded":false,"type":"item"},{"configs":{"itemId":"deletePostBtn","iconCls":"delete_icon"},"events":{"click":"var r = app.gridedit.getSelectionModel().getSelection();\nr[0].set('POST_ID','') ;\nr[0].set('POST_NAME','') ;\napp.COLUMN_POST_NAME.getEditor().setValue();\napp.COLUMN_POST_NAME.getEditor().getPicker().hide();\n"},"children":[],"expanded":false,"type":"item"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"序号","hidden":"true","align":"center","xtype":"rownumberer","width":"50","titleAlign":"center","itemId":"post_row_num"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"岗位ID","hidden":"true","width":"80","dataIndex":"POST_ID","titleAlign":"center","itemId":"post_id_col"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"编码","width":"80","dataIndex":"POST_CODE","titleAlign":"center","itemId":"post_code_col"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"名称","width":"220","dataIndex":"POST_NAME","titleAlign":"center","itemId":"post_name_col"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":false,"type":"column"},{"configs":{"text":"是否启用","width":"70","align":"center","dataIndex":"ENABLED","titleAlign":"center","itemId":"COLUMN_ENABLED","renderer":"if(value === 'Y'){\n  return '已启用';\n}else if(value === 'N'){\n  return '未启用';\n}else{\n  return value ;\n}"},"children":[{"configs":{"value":"Y","pickList":"[['Y','已启用'],['N','未启用']]","itemId":"editor"},"children":[],"expanded":true,"type":"combo"}],"expanded":true,"type":"column"},{"configs":{"align":"center","altText":"删除员工分配信息","itemId":"opts","renderer":"return '<img src=\"{#contextPath#}/wb/images/delete.gif\"/>';","flex":"1","tooltip":"删除员工分配信息"},"children":[],"expanded":false,"type":"column"}],"expanded":false,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":false,"type":"fieldset"}],"expanded":false,"type":"window"},{"configs":{"layout":"border","itemId":"viewport1"},"children":[{"configs":{"region":"north","frame":"true","style":"border-width:0px","layout":"fit","itemId":"queryform","border":"false"},"children":[{"configs":{"layout":"column","margin":"10 0 10 0","border":"false","itemId":"tr1"},"children":[{"configs":{"tagConfigs":"columnWidth:0.3","labelWidth":"120","emptyText":"请输入员工编号或姓名回车查询","labelAlign":"right","itemId":"ygbm","fieldLabel":"员工编码/姓名"},"events":{"specialkey":"app.queryBtn.fireEvent('click');"},"children":[],"expanded":false,"type":"text"},{"configs":{"tagConfigs":"cloumnWidth:0.08","text":"查询","hidden":"true","margin":"0 0 0 20","itemId":"queryBtn","iconCls":"seek_icon"},"events":{"click":"app.empgrid.store.load( {  params:{ygbm:app.ygbm.getValue() }} );"},"children":[],"expanded":false,"type":"button"},{"configs":{"tagConfigs":"cloumnWidth:0.08","text":"重置","hidden":"true","margin":"0 0 0 10","itemId":"resetBtn","iconCls":"refresh_icon"},"events":{"click":"app.queryform.getForm().reset();\napp.empgrid.store.load();"},"children":[],"expanded":true,"type":"button"}],"expanded":true,"type":"panel"}],"expanded":false,"type":"form"},{"configs":{"region":"center","selType":"checkboxmodel","itemId":"empgrid"},"events":{"itemdblclick":"app.editBtn.fireEvent('click');"},"children":[{"configs":{"itemId":"store","autoLoad":"true","url":"m?xwl=xip/hr/emp/data/selelct"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"新增","itemId":"addBtn","iconCls":"file_add_icon"},"events":{"click":"var win = new Ext.window.Window(app._win);\napp.gridedit.store.load();\napp.EMP_ID.setValue(getuuid()); \n//toolbar3.show();\napp.userName.hide();\nwin.setTitle('新增员工') ;\napp.savenextWin.show();\nwin.show();"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"编辑","itemId":"editBtn","iconCls":"file_edit_icon"},"events":{"click":"var rows=app.empgrid.getSelection();\n\nif(rows.length===0) {\n  Wb.toast('请先选择一条需要修改的数据');\n  return;\n}\n\n\nvar _empsex=rows[0].data.EMP_SEX;\nWb.edit(app.empgrid,app._win);\n  if(_empsex === '1'){\n    app.radio1.setValue(true) ;\n  }else{\n    app.radio2.setValue(true) ;\n  }\napp.win.setTitle('编辑员工');\napp.opType.setValue('edit') ;\napp.EMP_CODE.setReadOnly(true);\napp.panel7.hide();\n // 加载分配信息\napp.gridedit.store.load({params:{empId:app.EMP_ID.getValue()}}); \n\napp.savenextWin.hide();\n\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"删除","itemId":"deleteBtn","iconCls":"file_delete_icon"},"events":{"click":"var rows = app.empgrid.getSelection();\nif(Ext.isEmpty(rows)){\n  Wb.toast('请先选中需要删除的记录!');\n  //Ext.MessageBox.alert('提示','您没有选中任何数据！');\n}\nelse{\n   Ext.Msg.confirm('提示','您确定要删除？',function(a){\n      if(a=='yes'){\n      var idList = \"\" ;\n      Ext.each(rows,function(r){\n        var id = \"'\" + r.data.EMP_ID + \"'\";\n        if(idList === \"\"){\n          idList = id ;\n        }else{\n          idList = idList+\",\"+id ;\n        }\n      });\n      var json = {'ids' : idList} ;\n        Wb.request({\n         url : 'm?xwl=cux_xip/hr/emp/data/delete',\n         params : json,\n         success :function(response){\n          Wb.toast('员工信息删除成功!');\n          //Ext.Msg.alert(\"提示\",\"员工信息删除成功!\");\n           app.empgrid.store.load();\n           \n         }\n      });\n     \n    }else{\n      return false ;\n    }\n  });\n  \n      \n \n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"导出","itemId":"expBtn","iconCls":"db_export_icon"},"events":{"click":"var dbType = '{#dbType#}';\n\nif(dbType == \"mysql\"){\n  Xip.exportExcel('XIP_PUB_EMPS', {empCodeName:app.ygbm.getValue()}, '员工');\n}else{\n  Xip.exportExcel('XIP_PUB_EMPS_ORACLE', {empCodeName:app.ygbm.getValue()}, '员工');\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"导入","itemId":"impBtn","iconCls":"db_import_icon"},"events":{"click":"var dbType = '{#dbType#}';\n\nif(dbType == \"mysql\"){\n  Xip.importExcel('XIP_PUB_EMPS', null);\n}else{\n  Xip.importExcel('XIP_PUB_EMPS_ORACLE', null);\n}"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"序号","width":"50","align":"center","xtype":"rownumberer","titleAlign":"center","itemId":"chartNumber"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"员工编码","width":"80","dataIndex":"EMP_CODE","titleAlign":"center","itemId":"COLUMN_EMP_CODE"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"员工姓名","width":"100","dataIndex":"EMP_NAME","titleAlign":"center","itemId":"COLUMN_EMP_NAME"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"性别","width":"50","dataIndex":"EMP_SEX","titleAlign":"center","itemId":"COLUMN_EMP_SEX","renderer":"var sex = record.get('EMP_SEX');\n\nif(sex == '1'){\n  return '男' ;\n}else if(sex == '2'){\n  return '女' ;\n}else{\n  return sex ;\n}"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"身份证","hidden":"true","width":"200","dataIndex":"ID_NO","titleAlign":"center","itemId":"COLUMN_ID_NO"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"员工id","hidden":"true","dataIndex":"EMP_ID","titleAlign":"center","itemId":"COLUMN_EMP_ID"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"手机","width":"120","dataIndex":"PHONE_NO","titleAlign":"center","itemId":"COLUMN_PHONE_NO"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"地址","hidden":"true","width":"350","dataIndex":"ADDRESS","titleAlign":"center","itemId":"COLUMN_ADDRESS"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"银行账号","width":"150","dataIndex":"BANK_NO","titleAlign":"center","itemId":"COLUMN_BANK_NO"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"开户银行","width":"180","dataIndex":"BANK_NAME","titleAlign":"center","itemId":"COLUMN_BANK_NAME","renderer":"metaData.style = 'overflow:auto;padding: 3px 6px;text-overflow: ellipsis;white-space: nowrap;white-space:normal;line-height:18px;';   \nreturn value;"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"邮箱","width":"200","dataIndex":"EMAIL","titleAlign":"center","itemId":"COLUMN_EMAIL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"出生日期","hidden":"true","dataIndex":"BIRTHDAY","titleAlign":"center","itemId":"COLUMN_BIRTHDAY"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"固定电话","width":"120","dataIndex":"ATTRIBUTE1","titleAlign":"center","itemId":"COLUMN_ATTRIBUTE1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"员工状态","align":"center","width":"80","dataIndex":"ATTRIBUTE2","titleAlign":"center","itemId":"COLUMN_ATTRIBUTE2","renderer":"if(value == 'Y'){\n  return '已启用' ;\n}else if(value == 'N'){\n  return '<font color=red>未启用<\/font>' ;\n}else{\n  return value;\n}"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"弹性扩展字段3","hidden":"true","dataIndex":"ATTRIBUTE3","titleAlign":"center","itemId":"COLUMN_ATTRIBUTE3"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"弹性扩展字段4","hidden":"true","dataIndex":"ATTRIBUTE4","titleAlign":"center","itemId":"COLUMN_ATTRIBUTE4"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"弹性扩展字段5","hidden":"true","dataIndex":"ATTRIBUTE5","titleAlign":"center","itemId":"COLUMN_ATTRIBUTE5"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"弹性扩展字段6","hidden":"true","dataIndex":"ATTRIBUTE6","titleAlign":"center","itemId":"COLUMN_ATTRIBUTE6"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"弹性扩展字段7","hidden":"true","dataIndex":"ATTRIBUTE7","titleAlign":"center","itemId":"COLUMN_ATTRIBUTE7"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"弹性扩展字段8","hidden":"true","dataIndex":"ATTRIBUTE8","titleAlign":"center","itemId":"COLUMN_ATTRIBUTE8"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"弹性扩展字段9","hidden":"true","dataIndex":"ATTRIBUTE9","titleAlign":"center","itemId":"COLUMN_ATTRIBUTE9"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"弹性扩展字段10","hidden":"true","dataIndex":"ATTRIBUTE10","titleAlign":"center","itemId":"COLUMN_ATTRIBUTE10"},"children":[],"expanded":false,"type":"column"}],"expanded":false,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}