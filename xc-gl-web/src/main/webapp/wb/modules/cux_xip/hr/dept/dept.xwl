{"inframe":false,"title":"部门管理","hidden":false,"roles":{"default":1},"children":[{"configs":{"initScript":"var ctxPath = request.getContextPath();\nvar funCodeStr = request.getParameter(\"funCode\");\nrequest.setAttribute(\"contextPath\",ctxPath);\nrequest.setAttribute(\"tipCode\",funCodeStr);","loginRequired":"false","head":"<script type=\"text/javascript\">\n  function assginEmployee(orgId,deptId,postId,deptName,postName){\n    app.empAsgWin.setTitle('<center>【'+deptName+'】--'+'【'+postName+'】'+'  分配<\/center>');\n    //往隐藏框中添加 orgId、deptId、postId（组织ID、部门ID、岗位ID）\n    app.asgPostId.setValue(postId);\n    app.asgOrgId.setValue(orgId);\n    app.asgDeptId.setValue(deptId);\n    app.empAsgWin.show();\n    app.grid1.store.load({params:{asgPostId:app.asgPostId.getValue()}});\n    app.grid11.store.load({params:{asgPostId:app.asgPostId.getValue()}});\n\n  }\n  function swap(src, dst, isAll){\n      var srcSt=src.store, dstSt=dst.store, srcSelModel=src.getSelectionModel(),\n      sel=isAll?srcSt.getRange():srcSelModel.getSelection(),\n      srcIndex, len, key='EMP_CODE';\n      var bl = 0;\n      srcIndex=srcSt.indexOf(sel[0]);\n      srcSt.remove(sel);\n      Ext.Array.each(sel,function(r){\n//         if(!Wb.findRecord(dstSt,key,r.get(key)))\n//           dstSt.add(r);\n        for(var i = 0;i<dstSt.getCount();i++){\n           var key = dstSt.getAt(i).get(key);\n           if(r.get(key)===key){\n             bl=1;\n             return;\n           }\n        }\n        if(bl==0){\n          dstSt.add(r);\n        }\n      });\n      dst.getSelectionModel().select(sel);\n      len=srcSt.getCount()-1;\n      if(len<srcIndex)\n        srcIndex=len;\n      if(srcIndex!=-1)\n        srcSelModel.select(srcIndex);\n}\n<\/script>\n\n\n","itemId":"module"},"events":{"initialize":"/**\nname:treeNodeQuery(实现树的模糊查找)\ndesc:根据名称查询节点在树中的位置\nparams:text(节点名称)\nparams:by(依据字段<树查询默认为'text'>)\nparams:treeId(树的ID)\n*/\n\nvar tempDeptId;//存储选择的部门ID\nvar tempOrgId;//组织ID\n\nfunction treeNodeQuery(text,by,treeId) { \n  if(Ext.isEmpty(by))\n    by = 'text';\n  var menuFunTree = treeId;\n  menuFunTree.expandAll(function(){\n      var view = menuFunTree.getView(),\n      nodesAndParents = [];\n  menuFunTree.getRootNode().cascadeBy(function(tree, view) {\n        var uiNode = view.getNodeByRecord(this);\n        if (uiNode) {\n            Ext.get(uiNode).setDisplayed('table-row');\n        }\n    }, null, [menuFunTree, view]);\n    //添加匹配的节点和他们的父节点到nodesAndParents数组.\n    menuFunTree.getRootNode().cascadeBy(function(tree, view) {\n      var currNode = this;\n      if (currNode && currNode.data[by] && currNode.data[by].toString().toLowerCase().indexOf(text.toLowerCase()) > -1) {\n             menuFunTree.expandPath(currNode.getPath());\n             while (currNode.parentNode) {\n                nodesAndParents.push(currNode.id);\n                currNode = currNode.parentNode;\n            }\n        }\n    }, null, [menuFunTree, view]);\n    // 将不在nodesAndParents数组中的节点隐藏\n    // 将根节点放在显示数组中\n    nodesAndParents.push(menuFunTree.getRootNode().id);\n    menuFunTree.getRootNode().cascadeBy(function(tree, view){\n        var uiNode = view.getNodeByRecord(this);\n        if (uiNode && !Ext.Array.contains(nodesAndParents, this.id)) {\n            Ext.get(uiNode).setDisplayed('none');\n        }\n    }, null, [menuFunTree, view]);\n  });\n}\n"},"children":[{"configs":{"itemId":"deptOrderStore","url":"m?xwl=cux_xip/hr/dept/DATA/getDeptOrder"},"events":{"beforeload":"app.deptOrderStore.getProxy().extraParams.orgComobox = app.orgComobox.getValue();"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"winBtns"},"children":[{"configs":{"itemId":"winBtn"},"children":[{"configs":{"text":"保存","itemId":"winSave","iconCls":"save_icon"},"events":{"click":"/*-------增加岗位信息----------------*/\nif(!app.form1.getForm().isValid()){\n  Wb.toast(\"信息填写不完整！\") ;\n  return false ;\n}\n//判断为新增还是修改\nif(app.positionId.getValue()==='-1'){\n  Wb.request({\n    url : 'm?xwl=xip/auth/role/role/DATA/getUUid',\n    success:function(response){\n      var temp = response.responseText;\n      var resultJson = Wb.decode(temp);\n      var _primaryKey = resultJson.uuid;\n      var json = { primaryKey   : _primaryKey,\n                   positionCode : app.positionCode.getValue(),\n                   positionName : app.positionName.getValue(),\n                   winOrgId     : app.winOrgId.getValue(),\n                   winDeptId    : app.winDeptId.getValue(),\n                   isUse        : app.isUse.getValue()};  \n      Wb.request({\n         url:'m?xwl=cux_xip/hr/dept/DATA/positionAdd',\n         params:json,\n         success:function(){\n            app.positionId.setValue(_primaryKey);\n            Wb.toast('岗位添加成功！');\n\n        }\n      });\n    }\n  });\n  \n}else{\n     var json = {  positionCode : app.positionCode.getValue(),\n                   positionName : app.positionName.getValue(),\n                   isUse        : app.isUse.getValue(),\n                   winOrgId     : app.winOrgId.getValue(),\n                   winDeptId    : app.winDeptId.getValue(),\n                   positionId   : app.positionId.getValue()};\n     Wb.request({\n         url:'m?xwl=cux_xip/hr/dept/DATA/positionEdit',\n         params:json,\n         success:function(){\n            Wb.toast(\"岗位信息更新成功!\");\n         }\n      });\n}\n   \n\n\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"保存并添加下一个","itemId":"winContinue"},"events":{"click":"/*-------增加岗位信息----------------*/\napp.positionCode.setReadOnly(false);\nif(!app.form1.getForm().isValid()){\n  Wb.toast(\"信息填写不完整！\") ;\n  return false ;\n}\n/**------执行Update操作------*/\nif(app.positionId.getValue()==='-1'){\n  Wb.request({\n    url : 'm?xwl=xip/auth/role/role/DATA/getUUid',\n    success:function(response){\n      var temp = response.responseText;\n      var resultJson = Wb.decode(temp);\n      var _primaryKey = resultJson.uuid;\n      var json = { primaryKey   : _primaryKey,\n                   positionCode : app.positionCode.getValue(),\n                   positionName : app.positionName.getValue(),\n                   winOrgId     : app.winOrgId.getValue(),\n                   winDeptId    : app.winDeptId.getValue(),\n                   isUse        : app.isUse.getValue()};  \n      Wb.request({\n         url:'m?xwl=cux_xip/hr/dept/DATA/positionAdd',\n         params:json,\n         success:function(){\n            app.positionCode.setValue('');\n            app.positionName.setValue('');\n            app.positionId.setValue('-1');\n            app.positionGrid.store.removeAll();\n            Wb.toast('岗位添加成功！');\n        }\n      });\n    }\n  });\n  \n}else{\n  var json = {  positionCode : app.positionCode.getValue(),\n                   positionName : app.positionName.getValue(),\n                   isUse        : app.isUse.getValue(),\n                   winOrgId     : app.winOrgId.getValue(),\n                   winDeptId    : app.winDeptId.getValue(),\n                   positionId   : app.positionId.getValue()};\n     Wb.request({\n         url:'m?xwl=cux_xip/hr/dept/DATA/positionEdit',\n         params:json,\n         success:function(){\n            app.positionCode.setValue('');\n            app.positionName.setValue('');\n            app.positionId.setValue('-1');\n            app.positionGrid.store.removeAll();\n            Wb.toast('岗位更新成功！');\n         }\n      });\n}\n   \n\n\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"关闭","itemId":"winClose","iconCls":"cancel_icon"},"events":{"click":"app.position_win.close();"},"children":[],"expanded":false,"type":"button"}],"expanded":false,"type":"array"},{"configs":{"itemId":"asgBtn"},"children":[{"configs":{"text":"确定","hidden":"true","itemId":"asgSave","iconCls":"save_icon"},"events":{"click":"app.treePosGrid.store.getProxy().url='m?xwl=cux_xip/hr/dept/DATA/getDeptPositionByDeptId';\napp.treePosGrid.store.load({params:{orgComobox:app.asgOrgId.getValue(),deptId:app.asgDeptId.getValue()}});\napp.empAsgWin.hide();"},"children":[],"expanded":false,"type":"button"}],"expanded":false,"type":"array"}],"expanded":false,"type":"folder"},{"configs":{"itemId":"wins"},"children":[{"configs":{"title":"添加员工","height":"380","width":"580","layout":"border","closeAction":"hide","buttonAlign":"center","dialog":"true","itemId":"userSelectWin","modal":"true"},"events":{"ok":"var rows = app.userSelectGrid.getSelectionModel().getSelection();\nif(rows.length===0){\n  Wb.toast('请选择添加的记录!');\n}else{\n  var newArray=[];\n  var _deptId = app.winDeptId.getValue();\n  var _postId = app.positionId.getValue();\n  var _orgId = app.winOrgId.getValue();\n  \n  var empId = '';\n  var ledgerId = '';\n  var tempEmp = [];//存放选择的EMPID\n  var tempLedger = [];//存放选择的组织所关联的账薄信息\n  var insertLdEmpArray = [];//存放最后需要增加的个人往来记录\n  \n  for(var i=0;i<rows.length;i++) {\n    var _record = rows[i].data;\n    _record.DEPT_ID = _deptId;\n    _record.POST_ID = _postId;\n    _record.ORG_ID = _orgId; \n    _record.ASG_ID = '';\n    \n    //拼接需要查询存在的empId条件\n    empId = empId+ \"'\"+_record.EMP_ID+\"'\";\n    if(i!=rows.length-1)\n      empId = empId+',';\n    tempEmp.push(_record.EMP_ID);\n    \n    newArray.push(_record); \n  }\n//   Ext.each(rows,function(item){\n//     var _record = item.getData();\n//     _record.DEPT_ID = _deptId;\n//     _record.POST_ID = _postId;\n//     _record.ORG_ID = _orgId; \n//     _record.ASG_ID = '';\n//     newArray.push(_record); \n//   });\n  \n  \n\n    Wb.request({\n      //根据组织ID获取相关连的账薄id\n      url:'m?xwl=cux_xip/hr/dept/DATA/selectLedgerIdByOrgId_emp',\n      params:{orgId:app.winOrgId.getValue()},\n      success:function(response) {\n        var tempLedgerId = Wb.decode(response.responseText).rows;\n        for(var i=0;i<tempLedgerId.length;i++){\n          ledgerId = ledgerId+ \"'\"+tempLedgerId[i].LEDGER_ID+\"'\";\n          //拼接需要查询的账薄ID和empID\n          if(i!=tempLedgerId.length-1)\n            ledgerId = ledgerId+',';\n          //存储查询出的账薄信息，后期进行比对\n          tempLedger.push(tempLedgerId[i].LEDGER_ID);           \n        }\n \n        \n        Wb.request({\n           //获取指定账簿ID和员工ID的所有同步信息  \n           url:'m?xwl=cux_xip/hr/dept/DATA/selectLdEmpByLedgerIdAndEmpId',\n           params:{ledgerId:ledgerId,empId:empId},\n           success:function(response){\n               var tempSync = Wb.decode(response.responseText).rows;\n                 //循环遍历上面查询到的账薄信息和选择的员工信息，没有同步的个人往来进行同步处理\n               for(var i=0;i<tempLedger.length;i++) {\n                 for (var j=0;j<tempEmp.length;j++) {\n                   var flag = true;\n                   //循环进行已经存在的账薄信息比对，如果不存在就标志最后进行插入操作\n                   for(var k=0;k<tempSync.length;k++){\n                     if((tempLedger[i]==tempSync[k].LEDGER_ID)&&(tempEmp[j]==tempSync[k].EMP_ID)){\n                       flag = false;\n                       break;\n                     }\n                   }\n                   //需要增加\n                   if(flag) {\n                     var msg = \"{'LD_EMP_ID':'',\"+\"'LEDGER_ID':'\"+tempLedger[i]+\"','EMP_ID':'\"+tempEmp[j]+\"'}\";\n                     insertLdEmpArray.push(Wb.decode(msg));\n                   }\n                 }\n               }\n\n             //增加分配信息和个人往来信息\n             Wb.request({\n               url:'m?xwl=cux_xip/hr/dept/DATA/asgCreate',\n               params:({\n                 newArray:Ext.JSON.encode(newArray),insertLdEmpArray:insertLdEmpArray\n               }),\n               success:function(){\n                 Wb.toast('保存成功');\n                 app.positionGrid.store.load({params:{deptId:app.winDeptId.getValue(),postId:app.positionId.getValue()}});\n                 app.userSelectWin.close();\n               }\n             });\n             \n           }\n        });\n\n        \n      }\n    });\n      \n  \n    }\n \n\n  \n  /*\n  Wb.request({\n    url:'m?xwl=cux_xip/hr/dept/DATA/asgCreate',\n    params:Wb.apply({\n                newArray:Ext.JSON.encode(newArray)\n           }),\n    success:function(){\n      Wb.toast('保存成功');\n      app.positionGrid.store.load({params:{deptId:app.winDeptId.getValue(),postId:app.positionId.getValue()}});\n      app.userSelectWin.close();\n    }\n  });\n  */\n"},"children":[{"configs":{"region":"north","height":"70","frame":"true","style":"border-width:0px","layout":"fit","itemId":"userSelectForm"},"children":[{"configs":{"title":"查询条件","layout":"column","itemId":"fieldset4"},"children":[{"configs":{"labelWidth":"60","hidden":"true","width":"180","labelAlign":"right","itemId":"userName","fieldLabel":"用户名"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"100","width":"250","labelAlign":"right","itemId":"empWinName","fieldLabel":"员工编号/姓名"},"events":{"specialkey":"app.userSelectGrid.store.load({params:{\n                                  empWinName:app.empWinName.getValue(),\n                                  postId:app.positionId.getValue(),\n                                  deptId:app.winDeptId.getValue()\n                             }});"},"children":[],"expanded":false,"type":"text"},{"configs":{"text":"查询","itemId":"userQuertBtn","iconCls":"seek_icon","x":"5"},"events":{"click":"app.userSelectGrid.store.load({params:{\n                                  empWinName:app.empWinName.getValue(),\n                                  postId:app.positionId.getValue(),\n                                  deptId:app.winDeptId.getValue()\n                             }});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"重置","itemId":"userResetBtn","iconCls":"refresh_icon","x":"15"},"events":{"click":"app.empWinName.setValue('');\napp.userSelectGrid.store.load({params:{\n                                  empWinName:app.empWinName.getValue(),\n                                  postId:app.positionId.getValue(),\n                                  deptId:app.winDeptId.getValue()\n                             }});"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"fieldset"}],"expanded":false,"type":"form"},{"configs":{"region":"center","multiSelect":"true","selType":"checkboxmodel","buttonAlign":"center","itemId":"userSelectGrid","simpleSelect":"true"},"children":[{"configs":{"autoDestroy":"true","itemId":"store","url":"m?xwl=cux_xip/hr/dept/DATA/getUsers"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"用户id","hidden":"true","dataIndex":"EMP_ID","titleAlign":"center","itemId":"COLUMN_USER_ID"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"员工编号","width":"200","dataIndex":"EMP_CODE","titleAlign":"center","itemId":"COLUMN_EMP_CODE"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"员工姓名","width":"220","dataIndex":"EMP_NAME","titleAlign":"center","itemId":"COLUMN_EMP_NAME"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":false,"type":"grid"}],"expanded":false,"type":"window"},{"configs":{"height":"470","width":"580","layout":"fit","closeAction":"hide","buttons":"app.winBtn","buttonAlign":"center","dialog":"false","border":"false","itemId":"position_win","modal":"true"},"events":{"beforeclose":"var _orgId = app.orgComobox.getValue();\nvar _deptId = app.deptId.getValue();\nif(Ext.isEmpty(_deptId)){\n   app.treePosGrid.store.getProxy().url='m?xwl=cux_xip/hr/dept/DATA/getDeptPosition'; \n   app.treePosGrid.store.load({params:{orgComobox:_orgId}});\n  \n}else{\n   app.treePosGrid.store.getProxy().url='m?xwl=cux_xip/hr/dept/DATA/getDeptPositionByDeptId'; \n   app.treePosGrid.store.load({params:{orgComobox:_orgId,deptId:_deptId}});\n}\nWb.reset(app.form1);\napp.positionGrid.store.removeAll();"},"children":[{"configs":{"frame":"true","style":"border-width:0px","layout":"anchor","border":"false","itemId":"form1"},"children":[{"configs":{"title":"岗位信息","tagProperties":"anchor:'100%'","itemId":"fieldset1"},"children":[{"configs":{"height":"35","frame":"false","style":"border-width:0px","layout":"column","columnWidth":"1","border":"false","bodyPadding":"5 0 0 0","itemId":"panel1"},"children":[{"configs":{"labelWidth":"80","allowBlank":"false","width":"260","labelAlign":"right","itemId":"positionCode","fieldLabel":" <font color='red'>*<\/font>岗位编码"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"80","allowBlank":"false","width":"260","labelAlign":"right","itemId":"positionName","fieldLabel":"<font color='red'>*<\/font>岗位名称"},"children":[],"expanded":false,"type":"text"}],"expanded":false,"type":"panel"},{"configs":{"height":"35","frame":"false","style":"border-width:0px","layout":"column","columnWidth":"1","border":"false","itemId":"panel2"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","width":"260","labelAlign":"right","itemId":"beyondDept","fieldLabel":"所属部门"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"80","allowBlank":"false","displayField":"VAL_NAME","width":"260","valueField":"VAL_CODE","value":"Y","labelAlign":"right","itemId":"isUse","fieldLabel":"<font color='red'>*<\/font>是否启用"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=cux_xip/hr/dept/DATA/getEnableFlag"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"}],"expanded":false,"type":"panel"},{"configs":{"hidden":"true","itemId":"positionId"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"winOrgId"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"winDeptId"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"orginalCode"},"children":[],"expanded":false,"type":"text"}],"expanded":false,"type":"fieldset"},{"configs":{"title":"分配信息","style":"border-width:0px","collapsible":"false","layout":"fit","tagProperties":"anchor:'100%,65%'","itemId":"fieldset3"},"children":[{"configs":{"multiSelect":"true","selType":"checkboxmodel","height":"280","frame":"false","border":"true","itemId":"positionGrid","simpleSelect":"true"},"children":[{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"添加分配","itemId":"addAsignBtn","iconCls":"user_add_icon"},"events":{"click":"if(app.form1.getForm().isValid()===false){\n    Wb.toast('信息填写不完整,请确认!');\n    return;\n  }\n//判断为新增还是修改\nif(app.positionId.getValue()==='-1'){\n  Wb.request({\n    url : 'm?xwl=xip/auth/role/role/DATA/getUUid',\n    success:function(response){\n      var temp = response.responseText;\n      var resultJson = Wb.decode(temp);\n      var _primaryKey = resultJson.uuid;\n      var json = { primaryKey   : _primaryKey,\n                   positionCode : app.positionCode.getValue(),\n                   positionName : app.positionName.getValue(),\n                   winOrgId     : app.winOrgId.getValue(),\n                   winDeptId    : app.winDeptId.getValue(),\n                   isUse        : app.isUse.getValue()};  \n      Wb.request({\n         url:'m?xwl=cux_xip/hr/dept/DATA/positionAdd',\n         params:json,\n         success:function(){\n            app.positionId.setValue(_primaryKey);\n            app.position_win.setTitle(app.treeDeptName.getValue()+'-岗位编辑');\n            app.userSelectWin.show();\n            app.userSelectGrid.store.load({params:{deptId:app.winDeptId.getValue(),postId:app.positionId.getValue()}});\n        }\n      });\n    }\n  });\n  \n}else{\n     Wb.request({\n         url:'m?xwl=cux_xip/hr/dept/DATA/positionEdit',\n         success:function(){\n            app.userSelectWin.show();\n            app.userSelectGrid.store.load({params:{deptId:app.winDeptId.getValue(),postId:app.positionId.getValue()}});\n         }\n      });\n}\n\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"删除分配","itemId":"delAsignBtn","iconCls":"user_delete_icon"},"events":{"click":"var rows = app.positionGrid.getSelectionModel().getSelection();\nif(rows.length===0){\n  Wb.toast('请选择操作的记录!');\n  return;\n}\n\nExt.Msg.confirm('提示','确定要删除分配信息吗？',function(a){\n    if(a=='yes'){\n      var secIds = '';\n      for(var i=0; i<rows.length; i++){\n        secIds += '\\''+(rows[i].data.ASG_ID) + '\\',';    \n      }\n      secIds = secIds.substring(0,secIds.length-1);\n            \n      /*------删除员工分配时考虑是否删除对应的个人往来-------*/\n      var deleteLdEmpArray = [];//存放新增的个人往来记录\n      var ldEmpArray = [];//存放所有的个人往来信息\n\n      //根据对应的组织ID获取相关联的账薄信息\n      Wb.request({\n        async:false,\n        url:'m?xwl=cux_xip/hr/dept/DATA/selectLedgerIdByOrgId_emp',\n        params:{orgId:tempOrgId},//组织ID为全局变量，值的更改在组织选择选择中\n        success:function(response) {\n          var tempLedgerId = Wb.decode(response.responseText).rows;\n          for(var i=0;i<tempLedgerId.length;i++){\n            var leggerId = tempLedgerId[i].LEDGER_ID;\n            var msg = '';\n            for(var j=0;j<rows.length;j++){\n              msg = \"{'ORG_ID':'\"+tempOrgId+\"','LEDGER_ID':'\"+leggerId+\"','EMP_ID':'\"+rows[j].data.EMP_ID+\"'}\";\n              deleteLdEmpArray.push(Wb.decode(msg));\n            }\n          }\n          \n          //删除分配信息和个人往来信息\n          Wb.request({\n            url:'m?xwl=cux_xip/hr/dept/DATA/delEmpAsg',\n            params:{ids:secIds,deleteLdEmpArray:deleteLdEmpArray},\n            success:function(){\n              Wb.toast(\"取消员工分配成功!\");\n              app.positionGrid.store.load({params:{deptId:app.winDeptId.getValue(),postId:app.positionId.getValue()}});\n            }\n          });\n         \n        }\n      });\n      \n//       Wb.request({\n//         url:'m?xwl=cux_xip/hr/dept/DATA/delEmpAsg',\n//         params:{ids:secIds},\n//         success:function(){\n//           Wb.toast('删除分配信息成功');\n//           app.positionGrid.store.load({params:{deptId:app.winDeptId.getValue(),postId:app.positionId.getValue()}});\n//         }\n//       });\n    }\n  });\n\n\n"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"序号","width":"50","align":"center","xtype":"rownumberer","titleAlign":"center","itemId":"XUHAO"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"分配ID","hidden":"true","dataIndex":"ASG_ID","titleAlign":"center","itemId":"ASG_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"员工ID","hidden":"true","dataIndex":"EMP_ID","titleAlign":"center","itemId":"EMP_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"员工编号","width":"80","dataIndex":"EMP_CODE","titleAlign":"center","itemId":"EMP_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"员工名称","width":"150","dataIndex":"EMP_NAME","titleAlign":"center","itemId":"EMP_NAME_COL","renderer":"metaData.style = 'overflow:auto;padding: 3px 6px;text-overflow: ellipsis;white-space: nowrap;white-space:normal;line-height:18px;';   \nreturn value;"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"岗位编码","hidden":"true","width":"80","dataIndex":"POST_CODE","titleAlign":"center","itemId":"POST_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"岗位名称","hidden":"true","width":"150","dataIndex":"POST_NAME","titleAlign":"center","itemId":"POST_NAME_COL","renderer":"metaData.style = 'overflow:auto;padding: 3px 6px;text-overflow: ellipsis;white-space: nowrap;white-space:normal;line-height:18px;';   \nreturn value;"},"children":[],"expanded":false,"type":"column"}],"expanded":false,"type":"array"},{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=cux_xip/hr/dept/DATA/getAsignByPosId"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"fieldset"}],"expanded":true,"type":"form"}],"expanded":false,"type":"window"},{"configs":{"height":"500","width":"800","layout":"border","resizable":"true","closeAction":"hide","buttons":"app.asgBtn","buttonAlign":"center","dialog":"false","itemId":"empAsgWin","modal":"true"},"events":{"close":"app.treePosGrid.store.getProxy().url='m?xwl=cux_xip/hr/dept/DATA/getDeptPositionByDeptId';\napp.treePosGrid.store.load({params:{orgComobox:app.asgOrgId.getValue(),deptId:app.asgDeptId.getValue()}});\napp.empName.setValue('');\napp.empName1.setValue('');"},"children":[{"configs":{"region":"west","title":"<center>可分配员工<\/center>","height":"498","frame":"false","width":"'45%'","layout":"border","columnWidth":"1","split":"true","itemId":"panel1","y":"0","x":"0"},"children":[{"configs":{"region":"north","height":"40","frame":"true","width":"'100%'","layout":"form","border":"false","itemId":"panel4"},"children":[{"configs":{"frame":"true","style":"border-width:0px","width":"'100%'","layout":"column","border":"false","itemId":"panel1"},"children":[{"configs":{"labelWidth":"50","labelAlign":"right","itemId":"empName","fieldLabel":"名称"},"events":{"specialkey":"app.grid1.store.load({params:{empName:app.empName.getValue(),asgPostId:app.asgPostId.getValue()}});"},"children":[],"expanded":false,"type":"text"},{"configs":{"text":"查询","itemId":"button5","iconCls":"seek_icon"},"events":{"click":"app.grid1.store.load({params:{empName:app.empName.getValue(),asgPostId:app.asgPostId.getValue()}});"},"children":[],"expanded":false,"type":"button"},{"configs":{"hidden":"true","itemId":"asgPostId"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"asgOrgId"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"asgDeptId"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":false,"type":"panel"},{"configs":{"region":"center","frame":"false","layout":"fit","border":"false","itemId":"panel1"},"children":[{"configs":{"multiSelect":"true","selType":"checkboxmodel","frame":"true","scroll":"vertical","border":"false","itemId":"grid1","simpleSelect":"true"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=cux_xip/hr/dept/DATA/selectEmp"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"align":"center","xtype":"rownumberer","titleAlign":"center","itemId":"XUHAO"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"分配ID","hidden":"true","dataIndex":"ASG_ID","itemId":"ASG_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"员工ID","hidden":"true","dataIndex":"EMP_ID","itemId":"EMP_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"员工编号","width":"120","dataIndex":"EMP_CODE","itemId":"EMP_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"员工名称","dataIndex":"EMP_NAME","itemId":"EMP_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":false,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"region":"east","title":"<center>已分配员工<\/center>","height":"498","frame":"false","width":"'45%'","layout":"border","columnWidth":"1","split":"true","itemId":"panel11","y":"0"},"children":[{"configs":{"region":"north","height":"40","frame":"true","layout":"form","border":"false","itemId":"panel4","x":"'100%'"},"children":[{"configs":{"bodyStyle":"padding: 0px 10px 3px","frame":"true","style":"border-width:0px","layout":"column","border":"false","itemId":"panel1"},"children":[{"configs":{"labelWidth":"50","labelAlign":"right","itemId":"empName1","fieldLabel":"名称"},"events":{"specialkey":"app.grid11.store.load({params:{asgPostId:app.asgPostId.getValue(),empName1:app.empName1.getValue()}});"},"children":[],"expanded":false,"type":"text"},{"configs":{"text":"查询","itemId":"button51","iconCls":"seek_icon"},"events":{"click":"app.grid11.store.load({params:{asgPostId:app.asgPostId.getValue(),empName1:app.empName1.getValue()}});"},"children":[],"expanded":false,"type":"button"}],"expanded":false,"type":"panel"}],"expanded":false,"type":"panel"},{"configs":{"region":"center","frame":"true","layout":"fit","border":"false","itemId":"panel1"},"children":[{"configs":{"multiSelect":"true","selType":"checkboxmodel","frame":"true","scroll":"vertical","border":"false","itemId":"grid11","simpleSelect":"true"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=cux_xip/hr/dept/DATA/selectAsignEmp"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"align":"center","xtype":"rownumberer","titleAlign":"center","itemId":"XUHAO"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"分配ID","hidden":"true","dataIndex":"ASG_ID","itemId":"ASG_ID_COL1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"员工ID","hidden":"true","dataIndex":"EMP_ID","itemId":"EMP_ID_COL1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"员工编号","width":"120","dataIndex":"EMP_CODE","itemId":"EMP_CODE_COL1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"员工名称","dataIndex":"EMP_NAME","itemId":"EMP_NAME_COL1","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":false,"type":"panel"}],"expanded":false,"type":"panel"},{"configs":{"region":"center","height":"498","frame":"false","width":"'10%'","layout":"border","split":"true","itemId":"panel12"},"children":[{"configs":{"region":"south","bodyStyle":"padding: 0px 10px 0px","height":"'30%'","frame":"true","style":"border-width:0px","layout":"form","columnWidth":"1","border":"false","itemId":"panel4"},"children":[{"configs":{"text":"<<","width":"50","itemId":"cancelBtn","menuAlign":"center","tooltip":"取消分配"},"events":{"click":"var rows = app.grid11.getSelectionModel().getSelection();\nif(rows.length===0){\n  Wb.toast('请选择员工信息!');\n  return false ;\n}else{\n  \n      var idList = \"\" ;\n      Ext.each(rows,function(r){\n        var id = \"'\" + r.data.ASG_ID+ \"'\";\n        if(idList === \"\"){\n          idList = id ;\n        }else{\n          idList = idList+\",\"+id ;\n        }\n      });\n  \n      /*------删除员工分配时考虑是否删除对应的个人往来-------*/\n      var deleteLdEmpArray = [];//存放新增的个人往来记录\n      var ldEmpArray = [];//存放所有的个人往来信息\n\n      //根据对应的组织ID获取相关联的账薄信息\n      Wb.request({\n        async:false,\n        url:'m?xwl=cux_xip/hr/dept/DATA/selectLedgerIdByOrgId_emp',\n        params:{orgId:tempOrgId},\n        success:function(response) {\n          var tempLedgerId = Wb.decode(response.responseText).rows;\n          for(var i=0;i<tempLedgerId.length;i++){\n            var leggerId = tempLedgerId[i].LEDGER_ID;\n            var msg = '';\n            for(var j=0;j<rows.length;j++){\n              msg = \"{'ORG_ID':'\"+tempOrgId+\"','LEDGER_ID':'\"+leggerId+\"','EMP_ID':'\"+rows[j].data.EMP_ID+\"'}\";\n              deleteLdEmpArray.push(Wb.decode(msg));\n            }\n          }\n          //删除分配信息和个人往来信息\n          Wb.request({\n            url:'m?xwl=cux_xip/hr/dept/DATA/delEmpAsg',\n            params:{ids:idList,deleteLdEmpArray:deleteLdEmpArray},\n            success:function(){\n              Wb.toast(\"取消员工分配成功!\");\n              app.grid1.store.load({params:{asgPostId:app.asgPostId.getValue()}});\n              app.grid11.store.load({params:{asgPostId:app.asgPostId.getValue()}});\n            }\n          });\n        }\n      });\n  \n  \n    }\nswap(app.grid11,app.grid1);\n"},"children":[],"expanded":false,"type":"button"}],"expanded":false,"type":"panel"},{"configs":{"region":"north","height":"'30%'","frame":"true","style":"border-width:0px","columnWidth":"1","border":"false","itemId":"panel1"},"children":[],"expanded":false,"type":"panel"},{"configs":{"region":"center","bodyStyle":"padding: 0px 10px 0px","frame":"true","style":"border-width:0px","layout":"form","columnWidth":"1","border":"false","itemId":"panel2"},"children":[{"configs":{"text":">>","width":"50","itemId":"addBtn","tooltip":"添加分配"},"events":{"click":"//获取要添加授权的参数\nvar a_orgId = app.asgOrgId.getValue();\nvar a_deptId = app.asgDeptId.getValue();\nvar a_postId = app.asgPostId.getValue();\nvar rows = app.grid1.getSelectionModel().getSelection();\nvar empIdList=\"\";\n\nvar empId = '';\nvar ledgerId = '';\nvar tempEmp = [];//存放选择的EMPID\nvar tempLedger = [];//存放选择的组织所关联的账薄信息\nvar insertLdEmpArray = [];//存放最后需要增加的个人往来记录\n\n\nif(rows.length===0){\n  Wb.toast('请选择要授权的员工！');\n  return false;\n}\n//********执行授权操作***************\n//********交换store数据**************\n//********无需校验授权的重复性*********\nvar _addArray = [];\nvar _tmpJson;\n\nfor(var i=0;i<rows.length;i++){\n    _tmpJson = {EMP_ASG_ID:'',ORG_ID:a_orgId,DEPT_ID:a_deptId,POST_ID:a_postId,EMP_ID:rows[i].data.EMP_ID};\n    _addArray.push(_tmpJson); \n    //拼接需要查询存在的empId条件\n    empId = empId+ \"'\"+rows[i].data.EMP_ID+\"'\";\n    if(i!=rows.length-1)\n      empId = empId+',';\n    tempEmp.push(rows[i].data.EMP_ID);\n}\n\n// Ext.each(rows,function(item){\n//   _tmpJson = {EMP_ASG_ID:'',ORG_ID:a_orgId,DEPT_ID:a_deptId,POST_ID:a_postId,EMP_ID:item.data.EMP_ID};\n//   _addArray.push(_tmpJson); \n  \n// });\n\n Wb.request({\n      //根据组织ID获取相关连的账薄id\n      url:'m?xwl=cux_xip/hr/dept/DATA/selectLedgerIdByOrgId_emp',\n      params:{orgId:a_orgId},\n      success:function(response) {\n        var tempLedgerId = Wb.decode(response.responseText).rows;\n        for(var i=0;i<tempLedgerId.length;i++){\n          ledgerId = ledgerId+ \"'\"+tempLedgerId[i].LEDGER_ID+\"'\";\n          //拼接需要查询的账薄ID和empID\n          if(i!=tempLedgerId.length-1)\n            ledgerId = ledgerId+',';\n          //存储查询出的账薄信息，后期进行比对\n          tempLedger.push(tempLedgerId[i].LEDGER_ID);           \n        }\n \n        \n        Wb.request({\n           //获取指定账簿ID和员工ID的所有同步信息  \n           url:'m?xwl=cux_xip/hr/dept/DATA/selectLdEmpByLedgerIdAndEmpId',\n           params:{ledgerId:ledgerId,empId:empId},\n           success:function(response){\n               var tempSync = Wb.decode(response.responseText).rows;\n                 //循环遍历上面查询到的账薄信息和选择的员工信息，没有同步的个人往来进行同步处理\n               for(var i=0;i<tempLedger.length;i++) {\n                 for (var j=0;j<tempEmp.length;j++) {\n                   var flag = true;\n                   //循环进行已经存在的账薄信息比对，如果不存在就标志最后进行插入操作\n                   for(var k=0;k<tempSync.length;k++){\n                     if((tempLedger[i]==tempSync[k].LEDGER_ID)&&(tempEmp[j]==tempSync[k].EMP_ID)){\n                       flag = false;\n                       break;\n                     }\n                   }\n                   //需要增加\n                   if(flag) {\n                     var msg = \"{'LD_EMP_ID':'',\"+\"'LEDGER_ID':'\"+tempLedger[i]+\"','EMP_ID':'\"+tempEmp[j]+\"'}\";\n                     insertLdEmpArray.push(Wb.decode(msg));\n                   }\n                 }\n               }\n             \n             //增加分配信息和个人往来信息\n             Wb.request({\n               url:'m?xwl=cux_xip/hr/dept/DATA/asgCreate',\n               params:({\n                 newArray:Ext.JSON.encode(_addArray),\n                 insertLdEmpArray:insertLdEmpArray\n               }),\n               success:function(){\n                 Wb.toast('员工分配成功！');\n                 swap(app.grid1,app.grid11);\n                 app.grid1.store.load({params:{asgPostId:app.asgPostId.getValue()}});\n                 app.grid11.store.load({params:{asgPostId:app.asgPostId.getValue()}});\n               }\n             });\n        \n\n             }\n          });\n      }\n    });\n"},"children":[],"expanded":false,"type":"button"}],"expanded":false,"type":"panel"}],"expanded":false,"type":"panel"}],"expanded":false,"type":"window"},{"configs":{"title":"新增部门","height":"200","width":"350","layout":"fit","resizable":"false","closeAction":"hide","buttonAlign":"center","dialog":"true","itemId":"deptAddWin"},"events":{"hide":"app.deptAddForm.getForm().reset();\nvar _treeRecord = app.deptTree.getSelectionModel().getSelection()[0];\nif(_treeRecord.data.parent_id === '-1'){\n  //button2.setDisabled(true);\n}\n","ok":"if(!app.deptAddForm.getForm().isValid()){\n  Wb.toast('请填写所有必填信息！');\n  return;\n}\napp.deptInfoForm.show();\n//点击保存之前，将窗口填写的信息全部\napp.treeDeptCode.setValue(app.ADD_DEPT_CODE.getValue());\napp.treeDeptDesc.setValue(app.ADD_DEPT_DESC.getValue());\napp.treeDeptName.setValue(app.ADD_DEPT_NAME.getValue());\napp.check1.setValue(app.ADD_DEPT_ENABLE.getValue());\napp.deptSaveBtn.fireEvent('click');\napp.deptAddWin.close();\n\n"},"children":[{"configs":{"frame":"true","style":"border-width:0px","layout":"fit","border":"false","itemId":"deptAddForm"},"children":[{"configs":{"bodyStyle":"padding: 15px 50px 0px","frame":"true","style":"border-width:0px","layout":"form","columnWidth":".4","border":"false","itemId":"panel1"},"children":[{"configs":{"labelWidth":"60","hidden":"true","itemId":"UP_DEPT_ID","fieldLabel":"上级部门ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"60","hidden":"true","labelAlign":"right","itemId":"ADD_DEPT_ID","fieldLabel":"部门ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"ADD_DEPT_CODE","fieldLabel":"<font color='red'>*<\/font>部门编码"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"ADD_DEPT_NAME","fieldLabel":"<font color='red'>*<\/font>部门名称"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"ADD_DEPT_DESC","fieldLabel":"部门描述"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"ADD_DEPT_ENABLE","checked":"true","fieldLabel":"是否启用"},"children":[],"expanded":false,"type":"check"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"form"}],"expanded":false,"type":"window"}],"expanded":false,"type":"folder"},{"configs":{"layout":"border","itemId":"viewport1"},"events":{"afterrender":"// var _tipCode = '{#tipCode#}';\n// var _deptTip = Wb.getCookie(_tipCode);\n// if(Ext.isEmpty(_deptTip)){\n//   MsgTip.msg('<font color=\"red\">提示<\/font>', '先选择一个组织，然后在左边的树点击鼠标右键菜单进行操作，<br>拖动节点可以改变部门的顺序和上下级.',true,5000,_tipCode, true);  \n// }\nWb.toast('<font color=\"red\" style=\"font-weight:bold\">提示<\/font><br>'+'先选择一个组织，然后在左边的树点击鼠标右键菜单进行操作，<br>拖动节点可以改变部门的顺序和上下级.');\n"},"children":[{"configs":{"region":"west","height":"'100%'","frame":"false","width":"'28%'","layout":"border","columnWidth":"1","split":"true","border":"true","itemId":"panel1"},"children":[{"configs":{"region":"north","frame":"true","width":"'100%'","layout":"fit","columnWidth":"1","border":"false","itemId":"panel2"},"children":[{"configs":{"bodyStyle":"padding: 0px 10px 3px","frame":"true","style":"border-width:0px","width":"'100%'","layout":"form","columnWidth":"1","border":"false","itemId":"panel1"},"children":[{"configs":{"labelWidth":"40","displayField":"NAME","valueField":"CODE","emptyText":"请选择组织","labelAlign":"right","itemId":"orgComobox","forceSelection":"true","fieldLabel":"组织","editable":"true"},"events":{"select":"//记录当前组织ID\ntempOrgId = combo.getValue();\n\napp.deptInfoForm.getForm().reset();\napp.upDeptId.setValue(app.orgComobox.getValue());\napp.treePosGrid.store.load({params:{orgComobox:app.orgComobox.getValue()}});\napp.deptTree.store.load({params:{deptName:app.deptName.getValue(),orgComobox:app.orgComobox.getValue()}});\napp.deptSaveBtn.setDisabled(true);\nvar _tmp = document.getElementById('_toolTipsClickHide');\n//MsgTip.hide(_tmp);"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=cux_xip/hr/dept/DATA/getComboxOrg"},"children":[],"expanded":false,"type":"store"}],"expanded":false,"type":"combo"},{"configs":{"labelWidth":"40","emptyText":"输入部门名称后按回车键查询","labelAlign":"right","itemId":"deptName","fieldLabel":"部门"},"events":{"specialkey":"if (!Ext.isEmpty(app.orgComobox.getValue())){\n  treeNodeQuery(text.value,'text',app.deptTree);\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":false,"type":"panel"},{"configs":{"hidden":"true","layout":"column","width":"'100%'","columnWidth":"1","border":"false","itemId":"panel2"},"children":[],"expanded":false,"type":"panel"}],"expanded":false,"type":"panel"},{"configs":{"region":"center","height":"'100%'","width":"'100%'","layout":"border","border":"false","itemId":"panelWest"},"children":[{"configs":{"rootVisible":"false","region":"center","height":"'100%'","frame":"false","animate":"false","root":"{text:Str.all,parent_id:'-1',text:'组织部门树',flag:'Y',expanded:true}","width":"'100%'","split":"true","border":"false","itemId":"deptTree","viewConfig":"{\n  plugins : {\n    pluginId : 'ddPlug',\n    ptype : 'treeviewdragdrop'\n  },\n  listeners : {\n    beforedrop:function(node, data, om, dp){\n      /*-------------存储被拖拽节点的信息-----------*/\n      //Wb.saveNodePos(Wb.getNode(data.item));         \n      if(om.get('id')===app.orgComobox.getValue()){\n         return false;\n      }\n    },\n    drop : function(node, data, om, dp){\n            \n      /*-----------node：被拖拽的节点，om：要拖拽到的节点，dp：被拖拽的位置<before，after，append>---------*/\n      var dst = om, src = data.records[0], orderIndex, srcId, parentId, pn,tmpOrder;\n      \n      \n      Wb.mask(app.deptTree);\n      dst.expand(false,function(){\n        Wb.unmask(app.deptTree);\n        /*------------部门id---------------*/\n        srcId = src.get('id');      \n        /*-----------判断拖拽的类型---------*/\n        if(dp=='append'){\n          pn = dst;\n          parentId = dst.get('id');\n          if(!Ext.isEmpty(dst.lastChild.previousSibling)){\n            tmpOrder = dst.lastChild.previousSibling.get('seq_updept');\n            if(!Ext.isEmpty(tmpOrder)){\n              orderIndex = Number(tmpOrder)+Number(1);\n            }else{\n              orderIndex = 1;\n            }\n          }else{\n            orderIndex = 1;\n          }\n        }else{\n          pn = src.parentNode;\n          parentId = pn.get('id');\n          if (dp == 'before'){\n            if(Ext.isEmpty(dst.get('seq_updept'))){\n              orderIndex = 1;\n            }else{\n              orderIndex = Number(dst.get('seq_updept'));\n            }\n          }else{\n            if(Ext.isEmpty(dst.get('seq_updept'))){\n              orderIndex = 1;\n            }else{\n              orderIndex = Number(dst.get('seq_updept')) + Number(1);\n            }  \n          }\n        }\n\n        /*-------------节点拖曳前的判断-----------*/      \n        //拖曳之前先校验：被拖曳的节点如果有叶子节点，则不能被拖曳\n        Wb.request({\n          url:'m?xwl=cux_xip/hr/dept/DATA/selectDeptIsLeaf',\n          params:{deptId:data.records[0].get('id')},\n          success:function(response) {\n            var total = Wb.decode(response.responseText).total;//获得查询记录\n            if(total>0) {\n              Wb.toast('该部门存在下级部门，不允许被修改!');\n              //刷新树的显示信息\n              app.deptTree.getStore().reload();\n              //刷新左边的面板显示\n              app.deptInfoForm.hide();\n              app.deptSaveBtn.setDisabled(true);\n              app.postAddBtn.setDisabled(true);\n              app.postEditBtn.setDisabled(true);\n              app.treePosGrid.store.getProxy().url='m?xwl=cux_xip/hr/dept/DATA/getDeptPosition';   \n              app.treePosGrid.store.load({params:{orgComobox:app.orgComobox.getValue()}});\n              app.treeDeptName.setValue('');\n              app.treeDeptCode.setValue('');\n              app.treeDeptDesc.setValue('');\n              app.deptId.setValue('');\n              return;\n            }\n            else{\n              //拖曳之前先校验：已经被引用的不能作为父级\n              Wb.request({\n                url:'m?xwl=cux_xip/hr/dept/DATA/checkDeptIdByCcid',\n                params:{deptId:om.getId('id')},\n                success:function(response) {\n                  var tempCount = Wb.decode(response.responseText).total;\n                  if(tempCount>0){\n                    Wb.toast('部门信息已被使用，无法增加下级部门！');\n                    //刷新树的显示信息\n                    app.deptTree.getStore().reload();\n                    //刷新左边面板的显示\n                    app.deptInfoForm.hide();\n                    app.deptSaveBtn.setDisabled(true);\n                    app.postAddBtn.setDisabled(true);\n                    app.postEditBtn.setDisabled(true);\n                    app.treePosGrid.store.getProxy().url='m?xwl=cux_xip/hr/dept/DATA/getDeptPosition';   \n                    app.treePosGrid.store.load({params:{orgComobox:app.orgComobox.getValue()}});\n                    app.treeDeptName.setValue('');\n                    app.treeDeptCode.setValue('');\n                    app.treeDeptDesc.setValue('');\n                    app.deptId.setValue('');                    \n                    return;\n                  }else{\n                    //拖曳之后的修改\n                    Wb.request({\n                      url : 'm?xwl=cux_xip/hr/dept/DATA/updateDeptIndex',\n                      mask:app.deptTree,\n                      params : {seq_updept:orderIndex, deptId:srcId, parentId:parentId},\n                      failure : function() {\n                        Wb.revertNodePos(src);\n                      },\n                      success : function() {\n                        pn.eachChild(function(x) {\n                          var i ;\n                          if(Ext.isEmpty(x.get('seq_updept'))){\n                            i =1;\n                          }else{\n                            i = Number(x.get('seq_updept'));\n                          }\n                          if (i >= orderIndex) {\n                            x.set('seq_updept', Number(i) + Number(1));\n                            x.commit();\n                          }\n                        });\n                        src.set('parent_id', parentId);\n                        src.set('seq_updept', orderIndex);\n                        src.commit();\n                      }\n                    }); \n                  }\n                }\n              });\n            }\n          }\n      });\n  });\n  }\n  }\n}"},"events":{"itemclick":"tempDeptId = record.data.id;//记录当前选中的部门ID\n\napp.queryPositionName.setValue('');\nvar parentId = record.data.parent_id;\napp.deptSaveBtn.setDisabled(false);\nif(parentId==='-1'){\n  app.deptInfoForm.hide();\n  app.deptSaveBtn.setDisabled(true);\n  app.postAddBtn.setDisabled(true);\n  //button4.setDisabled(true);\n  app.postEditBtn.setDisabled(true);\n  app.treePosGrid.store.getProxy().url='m?xwl=cux_xip/hr/dept/DATA/getDeptPosition';   \n  app.treePosGrid.store.load({params:{orgComobox:app.orgComobox.getValue()}});\n  app.treeDeptName.setValue('');\n  app.treeDeptCode.setValue('');\n  app.treeDeptDesc.setValue('');\n  app.deptId.setValue('');\n   //upDeptId.setValue(parentId);\n  app.upDeptId.setValue(record.data.id); \n  \n}else{\n  app.deptInfoForm.show();\n  var orgComoboxId = app.orgComobox.getValue();\n  var _deptId = record.data.id;\n  app.postAddBtn.setDisabled(false);\n  app.postDeleteBtn.setDisabled(false);\n  app.postEditBtn.setDisabled(false);\n  app.treePosGrid.store.getProxy().url='m?xwl=cux_xip/hr/dept/DATA/getDeptPositionByDeptId'; \n  app.treePosGrid.store.load({params:{orgComobox:orgComoboxId,deptId:_deptId}});\n\n  var _treeDeptName = record.data.text;\n  var _treeDeptCode = record.data.code;\n  var _treeDeptDesc = record.data.shortname;\n  var _isEnabled = record.data.isenable;\n  var _treeDeptId = record.data.id;\n  var _treeDeptUpId = record.data.up_dp_id;\n  app.deptId.setValue(_treeDeptId);\n  app.upDeptId.setValue(_treeDeptUpId);\n  app.treeDeptName.setValue(_treeDeptName);\n  app.treeDeptCode.setValue(_treeDeptCode);\n  app.treeDeptDesc.setValue(_treeDeptDesc);\n  app.operateCode.setValue('edit'); \n  if(_isEnabled==='Y'){\n    app.check1.setValue(true);   \n  }else{\n    app.check1.setValue(false);\n  }\n}","tagEvents":"itemcontextmenu:function(view,record,item,index,event,options){ \n  \n    var tempFalg = false;//如果CCID中存在关联部门，则不能修改其顺序后者被删除与被新增下级部门\n  \n    event.preventDefault();\n    event.stopEvent();\n    var isRoot = record.data.parent_id;\n    var flag = record.data.text;\n    app.deptSaveBtn.setDisabled(false);\n    //根节点只新增下级部门\n    if(isRoot ==='-1' && flag !=='组织部门树'){\n                            var nodemenu = new Ext.menu.Menu({  \n                                floating:\ttrue,  \n                                items\t:\t[{  \n                                    text\t:\t'新增下级部门',  \n                                    iconCls\t:\t'new_icon',\n                                    handler\t:\tfunction(){\n                   app.deptInfoForm.getForm().reset();\n                   var deptUpId = record.data.id;//组织ID\n                   app.upDeptId.setValue(deptUpId);\n                   app.treePosGrid.store.removeAll();\n                   app.UP_DEPT_ID.setValue(deptUpId);\n                   app.deptAddWin.show();\n                                    }  \n                                }]  \t                  \n                            });\n     nodemenu.showAt(event.getXY());\n    }else if(isRoot !== '-1'){    \n                \n    var nodemenu = new Ext.menu.Menu({  \n            floating:\ttrue,  \n            items\t:\t[{  \n                text\t:\t'新增下级部门',  \n                iconCls\t:\t'new_icon',\n                handler\t:\tfunction(){\n                  //新增下级部门时进行的校验\n                  Wb.request({\n                    url:'m?xwl=cux_xip/hr/dept/DATA/checkDeptIdByCcid',\n                    params:{deptId:record.get('id')},\n                    success:function(response) {\n                      var tempCount = Wb.decode(response.responseText).total;\n                      if(tempCount>0){\n                        Wb.toast('部门信息已被使用，无法增加下级部门！');\n                        return;\n                      }else {\n                        //校验信息\n                        app.postAddBtn.setDisabled(true);\n                        app.postEditBtn.setDisabled(true);\t\n                        app.deptInfoForm.getForm().reset();\n                        var tempId = record.get('id');\n                        app.upDeptId.setValue(tempId);\n                        app.treePosGrid.store.removeAll();\n                        app.UP_DEPT_ID.setValue(tempId);\n                        app.deptAddWin.show();\n                      }\n                    }\n                  });                  \n                }  \n            },{  \n                text\t:\t'删除部门',  \n                iconCls\t:\t'delete_icon',\n                handler\t:\tfunction(){\n                  var tmpParentDeptId = record.get('id');\n                  deleteDept(tmpParentDeptId);\n                }  \n            }]  \n        });  \n        nodemenu.showAt(event.getXY());  \t\t\t   \n    }\n\n    function deleteDept(parentId){\n      Ext.MessageBox.confirm('提示','确定要删除所选择的部门信息?',function(item){\n        if(item === 'yes'){\n          Wb.request({\n            url:'m?xwl=cux_xip/hr/dept/DATA/deptDelete',\n            params:{deptId:parentId},\n            success:function(){\n               //更新树\n              var node = app.deptTree.getSelectionModel().getSelection()[0];;\n              var parentNode = node.parentNode;\n              parentNode.removeChild(node);\n              parentNode.commit();\n              Ext.Msg.alert(\"提示\",\"删除部门信息成功!\");\n\n            }\n          });\n        }\n      });\n    }\n\n}\n\n\n","beforeload":"store.getProxy().extraParams.orgComobox = app.orgComobox.getValue();\nstore.getProxy().extraParams.deptName = app.deptName.getValue();"},"children":[{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"-","itemId":"item1"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"导出部门","itemId":"exportDept","iconCls":"db_export_icon"},"events":{"click":"var orgId = app.orgComobox.getValue();\nif(Ext.isEmpty(orgId)){\n   Wb.info('请选择组织！');\n}else{\n Xip.exportExcel('XIP_PUB_DEPTS', {orgId:orgId, deptName:app.deptName.getValue()}, '部门');\n}\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item2"},"children":[],"expanded":true,"type":"item"},{"configs":{"text":"导入部门","itemId":"importDept","iconCls":"db_import_icon"},"events":{"click":"Xip.importExcel('XIP_PUB_DEPTS', null);"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item3"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"刷新","itemId":"refreshDept","iconCls":"refresh_icon"},"events":{"click":"app.deptTree.store.load({params:{deptName:app.deptName.getValue(),orgComobox:app.orgComobox.getValue()}});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item4"},"children":[],"expanded":false,"type":"item"}],"expanded":true,"type":"toolbar"},{"configs":{"autoLoad":"false","itemId":"store","url":"{#contextPath#}/deptTreeAction.do?method=getDeptTreeByorgId","fields":"[{name:'isenable'},{name:'seq_updept'},{name:'text'},{name:'id'},{name:'shortname'},{name:'up_dp_id'},{name:'orgid'},{name:'parent_id'},{name:'code'}]\n"},"events":{"load":"app.deptTree.expandAll();\nvar _findId = app.orgComobox.getValue();\nvar _selRecord = app.deptTree.store.getNodeById(_findId);\napp.deptTree.getSelectionModel().select(_selRecord);\napp.postAddBtn.setDisabled(true);\napp.postEditBtn.setDisabled(true);"},"children":[],"expanded":false,"type":"treestore"}],"expanded":true,"type":"tree"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"region":"center","height":"'100%'","frame":"false","width":"'100%'","layout":"border","border":"false","itemId":"contentPanel"},"children":[{"configs":{"region":"center","height":"'100%'","frame":"false","width":"'100%'","layout":"border","border":"false","itemId":"orgCenter"},"children":[{"configs":{"region":"north","frame":"true","style":"border-width:0px","hidden":"true","width":"document.body.clientWidth","layout":"form","border":"false","itemId":"deptInfoForm"},"children":[{"configs":{"style":"border-width:0px","itemId":"tbar"},"children":[{"configs":{"text":"保存","itemId":"deptSaveBtn","disabled":"true","iconCls":"save_icon"},"events":{"click":"if(Ext.isEmpty(app.orgComobox.getValue())){\n  Wb.toast('请选择组织!');\n  return false;\n}\nif(Ext.isEmpty(app.upDeptId.getValue())){\n  Wb.toast('请选择上级部门！');\n  return false;\n\n}\n//=====保存部门操作，只保存部门，部门下的岗位保存重新弹出新的窗口=====\nvar _deptCode = app.treeDeptCode.getValue();\nif(Ext.isEmpty(_deptCode)){\n  Wb.toast('请填写部门编码!');\n  return false;\n}\nvar _deptName = app.treeDeptName.getValue();\nif(Ext.isEmpty(_deptName)){\n  Wb.toast('请填写部门名称！');\n  return false;\n}\nvar _deptId = app.deptId.getValue();\nvar _orgId = app.orgComobox.getValue();\nvar _upDeptId = app.upDeptId.getValue();\nvar _isEnable = 'N';\nif(app.check1.getValue()){\n  _isEnable = 'Y';  \n}\nvar isExist = 0;\nvar isCurrentId;\nWb.request({\n  url : 'm?xwl=xip/auth/role/role/DATA/getUUid',\n  success:function(response){\n    var temp = response.responseText;\n    var resultJson = Wb.decode(temp);\n    var _primaryKey = resultJson.uuid;\n    \n    var _operateCode = app.operateCode.getValue();\n    var _deptId = app.deptId.getValue();\n    var _lastNode = app.deptTree.getRootNode().lastChild;\n    if(_operateCode!=='edit'){\n      //======新增操作=====\n       \n      app.deptOrderStore.load(function(){\n        var json = {isEnabled   : _isEnable,\n                   primaryKey  : _primaryKey,\n                   treeDeptCode: app.treeDeptCode.getValue(),\n                   treeDeptName: app.treeDeptName.getValue(),\n                   treeDeptDesc: app.treeDeptDesc.getValue(),\n                   deptId      : app.deptId.getValue(),\n                   orgComobox  : app.orgComobox.getValue(),\n                   upDeptId    : app.upDeptId.getValue(),\n                   TMP_ORDER   : app.deptOrderStore.getAt(0).get('TMP_ORDER')\n                   };  \n        \n        Wb.request({\n         url:'m?xwl=cux_xip/hr/dept/DATA/addDept',\n         params:json,\n         success:function(){\n            //动态添加新增的部门信息\n            var currentNode ;\n            var selNode =  app.deptTree.getSelectionModel().getSelection()[0];\n            if(selNode === app.deptTree.getRootNode()){\n              currentNode = selNode.firstChild;\n            }else{\n              currentNode =  app.deptTree.getSelectionModel().getSelection()[0];\n            }\n            var _isEnable = 'N';\n            if(app.check1.isChecked){\n              _isEnable ='Y';\n            }\n            var _incoPath = '{#contextPath#}/webbuilder/controls/ext/resources/themes/images/access/tree/leaf.gif';\n            var _json = {text:app.treeDeptName.getValue(),\n                                     isenable:_isEnable,\n                                     shortname:app.treeDeptDesc.getValue(),\n                                     code:app.treeDeptCode.getValue(),\n                                     up_dp_id:app.upDeptId.getValue(),\n                                     id:json.primaryKey,\n                                     orgid:app.orgComobox.getValue(),\n                                     seq_updept:'',\n                                     parent_id:app.upDeptId.getValue(),\n                                     icon:_incoPath,\n                                     children:[]};\n            currentNode.expand();\n            var c = currentNode.appendChild(_json);\n            currentNode.commit();\n            app.deptTree.view.select(c);\n            app.operateCode.setValue('edit');\n            app.deptId.setValue(json.primaryKey);\n            app.postAddBtn.setDisabled(false);\n            app.postDeleteBtn.setDisabled(false);\n            app.postEditBtn.setDisabled(false);\n            Wb.toast(\"部门信息保存成功!\");\n            if(Ext.isEmpty(app.deptId.getValue())){\n              app.treePosGrid.store.getProxy().url='m?xwl=cux_xip/hr/dept/DATA/getDeptPosition';\n              app.treePosGrid.store.load({params:{orgComobox:app.orgComobox.getValue()}});\n            }else{\n              app.treePosGrid.store.getProxy().url='m?xwl=cux_xip/hr/dept/DATA/getDeptPositionByDeptId';\n              app.treePosGrid.store.load({params:{orgComobox:app.orgComobox.getValue(),deptId:app.deptId.getValue()}});\n            }\n\n\n         }\n       });\n      });\n      \n    }else{\n       var json = {isEnabled   : _isEnable,\n                   treeDeptCode: app.treeDeptCode.getValue(),\n                   treeDeptName: app.treeDeptName.getValue(),\n                   treeDeptDesc: app.treeDeptDesc.getValue(),\n                   deptId      : app.deptId.getValue(),\n                   orgComobox  : app.orgComobox.getValue()\n                   };\n       Wb.request({\n         url:'m?xwl=cux_xip/hr/dept/DATA/deptEdit',\n         params:json,\n         success:function(){\n            var currentNode = app.deptTree.getSelectionModel().getSelection()[0];\n            currentNode.set('text',app.treeDeptName.getValue());\n            currentNode.set('shortname',app.treeDeptDesc.getValue());\n            currentNode.set('code',app.treeDeptCode.getValue());\n            var _isEnable = 'N';\n            if(app.check1.getValue()){\n              _isEnable ='Y';\n            }\n            currentNode.set('isenable',_isEnable);\n            currentNode.commit();\n            Wb.toast(\"部门信息保存成功!\");\n            if(Ext.isEmpty(app.deptId.getValue())){\n              app.treePosGrid.store.getProxy().url='m?xwl=cux_xip/hr/dept/DATA/getDeptPosition';\n              app.treePosGrid.store.load({params:{orgComobox:app.orgComobox.getValue()}});\n            }else{\n              app.treePosGrid.store.getProxy().url='m?xwl=cux_xip/hr/dept/DATA/getDeptPositionByDeptId';\n              app.treePosGrid.store.load({params:{orgComobox:app.orgComobox.getValue(),deptId:app.deptId.getValue()}});\n            }\n\n\n         }\n       });\n    }\n\n\n  }\n});\n\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"同步","hidden":"true","itemId":"syncBtn","iconCls":"record_copy_icon","tooltip":"同步至成本中心"},"events":{"click":"// TODO: 判断是否已选择部门\nvar rows = app.deptTree.getSelection() ;\nif(rows.length === 0){\n  Wb.toast('请选择部门') ;\n  return false ;\n  \n}else{\n  \n  Wb.toast('开发中, 请在【账簿辅助段启动】功能处维护成本中心') ;\n  \n/*  \n  // 判断部门是否为末级部门\n  var r = rows[0] ;\n  Wb.request({\n    url: 'm?xwl=cux_xip/hr/dept/sync-ld-dept/isLeafDept',\n    params: {\n      'orgId' : r.data.orgid,\n      'deptId': r.data.id\n    },\n    success: function(resp) {\n      var repsonse = Wb.decode(resp.responseText) ;\n      var rr = repsonse.rows[0] ; \n      var total = rr.totalRec ;\n      if(total === 1){\n        // 执行同步\n        Wb.request({\n          url: 'm?xwl=cux_xip/hr/dept/sync-ld-dept/syncLdDept',\n          params: {\n            \n          },\n          success: function(resp) {\n          \n          }\n        });\n        \n      }else{\n        Wb.toast('当前部门非末级部门不能同步到账簿成本中心') ;\n        return false ;\n      }\n    }\n  });\n*/\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"部门领导人设置","itemId":"deptLeader","iconCls":"settings2_icon"},"events":{"click":"if (Ext.isEmpty(app.orgComobox.getValue())) {\n  Wb.info('请选择组织！');\n  return;\n}\nif (Ext.isEmpty(tempDeptId)) {\n  Wb.info('请选择部门！');\n  return;\n}\nWb.run({\n  url: 'm?xwl=xc/com-wf/dept-leader/leaderConfig',\n  params:{'deptName':app.treeDeptName.getValue(),'orgId':app.orgComobox.getValue(),'deptId':tempDeptId},\n  failure:function(){\n    Wb.info('加载领导人设置窗口失败,请重试！');\n  }\n});"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"title":"部门信息","width":"'100%'","layout":"column","itemId":"fieldSet2","x":"5"},"children":[{"configs":{"frame":"true","style":"border-width:0px","layout":"form","columnWidth":".45","border":"false","itemId":"panel1"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","width":"320","labelAlign":"right","itemId":"treeDeptCode","fieldLabel":"<font color='red'>*<\/font>部门编码"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"80","width":"320","labelAlign":"right","itemId":"treeDeptDesc","fieldLabel":"部门简称"},"children":[],"expanded":false,"type":"text"}],"expanded":false,"type":"panel"},{"configs":{"frame":"true","style":"border-width:0px","layout":"form","columnWidth":".45","border":"false","itemId":"panel11"},"children":[{"configs":{"labelWidth":"80","width":"320","labelAlign":"right","itemId":"treeDeptName","fieldLabel":"<font color='red'>*<\/font>部门名称"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"check1","fieldLabel":"是否启用","checked":"true"},"children":[],"expanded":false,"type":"check"}],"expanded":false,"type":"panel"},{"configs":{"hidden":"true","itemId":"deptId"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"upDeptId"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"operateCode"},"children":[],"expanded":false,"type":"text"}],"expanded":false,"type":"fieldset"}],"expanded":true,"type":"form"},{"configs":{"region":"center","frame":"true","style":"border-width:0px","layout":"fit","border":"false","bodyPadding":"5px 0px 0px 0px","itemId":"panel1"},"children":[{"configs":{"frame":"true","style":"border-width:0px","layout":"fit","border":"false","itemId":"form2"},"children":[{"configs":{"title":"岗位信息","width":"'100%'","layout":"fit","itemId":"fieldSet5"},"children":[{"configs":{"multiSelect":"true","selType":"checkboxmodel","itemId":"treePosGrid"},"events":{"itemdblclick":"app.postEditBtn.fireEvent('click');"},"children":[{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"序号","width":"50","align":"center","xtype":"rownumberer","titleAlign":"center","itemId":"XUHAO"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"部门ID","hidden":"true","dataIndex":"DEPT_ID","titleAlign":"center","itemId":"DEPT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"岗位ID","hidden":"true","dataIndex":"POST_ID","titleAlign":"center","itemId":"POST_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"组织ID","hidden":"true","dataIndex":"ORG_ID","titleAlign":"center","itemId":"ORG_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"所属部门","width":"150","dataIndex":"DEPT_NAME","titleAlign":"center","itemId":"DEPT_NAME_COL","renderer":"metaData.style = 'overflow:auto;padding: 3px 6px;text-overflow: ellipsis;white-space: nowrap;white-space:normal;line-height:18px;';   \nreturn value;"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"岗位编码","width":"80","dataIndex":"POST_CODE","titleAlign":"center","itemId":"POST_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"岗位名称","width":"150","dataIndex":"POST_NAME","titleAlign":"center","itemId":"POST_NAME_COL","renderer":"metaData.style = 'overflow:auto;padding: 3px 6px;text-overflow: ellipsis;white-space: nowrap;white-space:normal;line-height:18px;';   \nreturn value;"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"员工分配数","width":"120","dataIndex":"EMP_NUM","titleAlign":"center","itemId":"EMP_NUM_COL","renderer":"var c_orgId = record.get('ORG_ID');\nvar c_deptId = record.get('DEPT_ID');\nvar c_postId = record.get('POST_ID');\nvar c_deptName = record.get('DEPT_NAME');\nvar c_postName = record.get('POST_NAME');\nvar str = \"<a href=\\\"javascript:assginEmployee('\"+c_orgId+\"','\"+c_deptId+\"','\"+c_postId+\"','\"+c_deptName+\"','\"+c_postName+\"');\\\">员工分配数：\"+record.get('EMP_NUM')+\"<\/a>\" ;\n//var str = \"<a href=#>员工分配数：\"+record.get('EMP_NUM')+\"<\/a>\" ;\nreturn str;\n\n\n\n"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"启用","width":"50","dataIndex":"ENABLE_FLAG","titleAlign":"center","itemId":"ENABLE_FLAG","renderer":"if(record.get('ENABLE_FLAG')=='Y'){\n  return '是';\n}else if(record.get('ENABLE_FLAG')=='N'){\n  return '否';\n}else{\n  return record.get('ENABLE_FLAG');\n}"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"attribute1","hidden":"true","dataIndex":"ATTRIBUTE1","titleAlign":"center","itemId":"STATE"},"children":[],"expanded":false,"type":"column"}],"expanded":false,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"-","itemId":"item1-0"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"新增","itemId":"postAddBtn","iconCls":"record_add_icon"},"events":{"click":"var _deptId = app.deptId.getValue();\nvar _orgId = app.orgComobox.getValue();\nvar _deptName = app.treeDeptName.getValue();\nif(Ext.isEmpty(_deptId)){\n  Wb.toast('请选择需要添加岗位的部门！');\n  return false;\n}else{\n  app.beyondDept.setValue(_deptName);\n  app.positionId.setValue('-1');\n  app.winDeptId.setValue(_deptId);\n  app.winOrgId.setValue(_orgId);\n  app.beyondDept.setReadOnly(true);\n  app.positionCode.setReadOnly(false);\n  app.position_win.show();\n  app.position_win.setTitle(_deptName+'-岗位新增');\n}"},"children":[],"expanded":true,"type":"button"},{"configs":{"text":"-","itemId":"item1-1"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"修改","itemId":"postEditBtn","iconCls":"record_edit_icon"},"events":{"click":"var sm = app.treePosGrid.getSelectionModel();\nif(!sm.hasSelection() || sm.getSelection().length>1){\n  Wb.toast('请选择一条岗位信息');\n  return false;\n}else{\n  var rows = sm.getSelection();\n  var _deptId = rows[0].data.DEPT_ID;\n  var _orgId = rows[0].data.ORG_ID;\n  var _deptName = rows[0].data.DEPT_NAME;\n  var _positionId = rows[0].data.POST_ID;\n  var _enabled = rows[0].data.ENABLE_FLAG;\n  var _positionCode = rows[0].data.POST_CODE;\n  var _positionName = rows[0].data.POST_NAME;\n  app.beyondDept.setValue(_deptName);\n  app.positionId.setValue(_positionId);\n  app.winDeptId.setValue(_deptId);\n  app.winOrgId.setValue(_orgId);\n  app.beyondDept.setReadOnly(true);\n  app.positionCode.setValue(_positionCode);\n  app.positionName.setValue(_positionName);\n  app.orginalCode.setValue(_positionCode);\n  app.isUse.setValue(_enabled);\n  if(_enabled==='Y'){\n    app.isUse.setRawValue('是');\n  }else{\n    app.isUse.setRawValue('否');\n  }\n  app.positionCode.setReadOnly(true);\n  app.positionGrid.store.load({params:{deptId:_deptId,postId:_positionId}});\n  app.position_win.show();\n  app.positionCode.setReadOnly(true);\n\n}\n\n\n\n\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item1-2"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"删除","itemId":"postDeleteBtn","iconCls":"record_delete_icon"},"events":{"click":"var sm = app.treePosGrid.getSelectionModel();\nif(!sm.hasSelection()){\n  Wb.toast(\"请选择要删除的岗位信息!\");\n  return false;\n}\nExt.MessageBox.confirm('提示','您确认要删除所选择的部门信息',function(item){\n  if(item==='yes'){    \n    var rows = sm.getSelection();\n    var _postIdLIst = \"\";\n    Ext.each(rows,function(item){\n      var _postId = \"'\"+item.data.POST_ID+\"'\";\n      if(_postIdLIst === \"\"){\n          _postIdLIst = _postId ;\n        }else{\n          _postIdLIst = _postIdLIst+\",\"+_postId;\n        }\n      \n    });  \n    Wb.request({\n       url:'m?xwl=cux_xip/hr/dept/DATA/positionDel',\n       params:{postId:_postIdLIst},\n       success:function(){\n          Wb.toast(\"岗位信息删除成功!\");\n          if(!Ext.isEmpty(app.deptId.getValue())){\n            app.treePosGrid.store.getProxy().url='m?xwl=cux_xip/hr/dept/DATA/getDeptPositionByDeptId';\n            app.treePosGrid.store.load({params:{orgComobox:app.orgComobox.getValue(),deptId:app.deptId.getValue()}});\n          }else{\n            app.treePosGrid.store.getProxy().url='m?xwl=cux_xip/hr/dept/DATA/getDeptPosition';\n            app.treePosGrid.store.load({params:{orgComobox:app.orgComobox.getValue()}});\n          }\n\n       }\n    });\n  }\n});\n\n\n  "},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item1"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"导出","itemId":"exportPosition","iconCls":"db_export_icon"},"events":{"click":"var orgId = app.orgComobox.getValue();\nif(Ext.isEmpty(orgId)){\n  Wb.info('请选择组织！');\n  return false;\n}\nvar deptId = '';\nif(app.deptInfoForm.hidden === false){\n  deptId = app.deptId.getValue();\n}\n\nXip.exportExcel('XIP_PUB_POSTS', {orgId:orgId, deptId:deptId}, '岗位');"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item2"},"children":[],"expanded":true,"type":"item"},{"configs":{"text":"导入","itemId":"importPosition","iconCls":"db_import_icon"},"events":{"click":"if(Ext.isEmpty(app.orgComobox.getValue())){\n  Wb.info('请选择组织！');\n}else{\nXip.importExcel('XIP_PUB_DEPTS', null);\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item3"},"children":[],"expanded":true,"type":"item"},{"configs":{"text":"->","itemId":"item1-03"},"children":[],"expanded":false,"type":"item"},{"configs":{"labelAlign":"right","itemId":"queryPositionName","fieldLabel":"岗位编码/名称"},"events":{"specialkey":"var _deptId = Ext.isEmpty(app.deptTree.getSelectionModel().getSelection()[0])? '':app.deptTree.getSelectionModel().getSelection()[0].get('id');\nvar json;\nif(Ext.isEmpty(_deptId))\n json= {orgComobox:app.orgComobox.getValue()};\nelse\n  json={orgComobox:app.orgComobox.getValue(),deptId:_deptId};\napp.treePosGrid.store.load({params:json});"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"queryBtn","iconCls":"seek_icon"},"events":{"click":"var _deptId = Ext.isEmpty(app.deptTree.getSelectionModel().getSelection()[0])? '':app.deptTree.getSelectionModel().getSelection()[0].get('id');\nvar json;\nif(Ext.isEmpty(_deptId))\n json= {orgComobox:app.orgComobox.getValue()};\nelse\n  json={orgComobox:app.orgComobox.getValue(),deptId:_deptId};\napp.treePosGrid.store.load({params:json});"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"pageSize":"25","autoLoad":"true","itemId":"store","url":"m?xwl=cux_xip/hr/dept/DATA/getDeptPosition"},"events":{"beforeload":"app.treePosGrid.store.getProxy().extraParams.POST_NAME = app.queryPositionName.getValue();\napp.treePosGrid.store.getProxy().extraParams.orgComobox = app.orgComobox.getValue();"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"fieldset"}],"expanded":true,"type":"form"}],"expanded":false,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}