{"inframe":false,"title":"菜单功能注册","hidden":false,"roles":{"default":1},"children":[{"configs":{"loginRequired":"false","itemId":"module"},"events":{"initialize":"function beforeDropType(node, data, overModel, dropPosition, options) {\n  //拖动前时间\n  //完成拖动: return true;\n  //取消拖动: return false;\n  return true;\n}\nfunction dropType(node, data, overModel, dropPosition, options) {\n  Wb.mask(app.funcMenuTree);\n  //树的根节点\n  var rootNode = app.funcMenuTree.getRootNode();\n  //父节点id\n  var parentId = '';\n  //拖动节点id\n  var srcId = data.records[0].get('ID');\n  //拖动节点新生成的排序号\n  var orderNum = '';\n  \n  //判断是否添加到根节点\n  if(overModel == rootNode){\n    Wb.unmask(app.funcMenuTree);\n    parentId = -1;\n    orderNum = overModel.lastChild.previousSibling ? Number(overModel.lastChild.previousSibling.get('IDX')) + 1 : 0;\n  }else{\n    if(dropPosition==='append'){//拖动为子节点 append\n      //展开拖动到的节点，为了获取拖动到节点的子节点。\n      overModel.expand(false,function(){\n        Wb.unmask(app.funcMenuTree);\n        parentId = overModel.get('ID');\n        orderNum = overModel.lastChild.previousSibling ? Number(overModel.lastChild.previousSibling.get('IDX')) + 1 : 0;\n      });\n    }else if(dropPosition==='before'){//拖动到节点前 before\n      Wb.unmask(app.funcMenuTree);\n      //判断根节点节点\n      if(overModel.parentNode == rootNode){\n        parentId = -1;\n      }else{\n        parentId = overModel.parentNode.get('ID');\n      }\n      orderNum = overModel.get('IDX');\n    }else{//拖动到节点后 after\n      Wb.unmask(app.funcMenuTree);\n      if(overModel.parentNode == rootNode){\n        parentId = -1;\n      }else{\n        parentId = overModel.parentNode.get('ID');\n      }\n      orderNum = overModel.get('IDX') + 1;\n    }\n  }\n  \n  Wb.request({\n    url: 'm?xwl=xc/examples/dragTree/data/updateFunMenuIdx', \n    params: {parentId:parentId, idx:orderNum, funTreeId: srcId}, \n    success: function(response){\n      if(dropPosition == 'append'){\n        //动态修改节点属性值\n        overModel.lastChild.set('PARENT_ID', parentId);\n        overModel.lastChild.set('IDX', orderNum);\n        overModel.commit();\n      }else{\n        var hasReachSrcNode = false;\n        overModel.eachChild(function(cNode) {\n          //判断是否为拖动的节点\n          if(cNode.get('ID') == srcId){\n            cNode.set('parent_id', parentId);\n            cNode.set('IDX', orderIndex);\n            cNode.commit();\n          }\n          //拖动节点后面的节点序号+1\n          var i = Number(cNode.get('IDX'));\n          if (i >= orderNum) {\n            cNode.set('IDX', i + 1);\n            cNode.commit();\n          }\n        });\n      }\n    },\n    failure:function(response){\n    }\n  });\n}"},"children":[{"configs":{"layout":"border","itemId":"viewport"},"children":[{"configs":{"region":"center","root":"{id:'rootNode',text:'功能菜单',expanded:true}","itemId":"funcMenuTree","viewConfig":"{\n  plugins : {\n    pluginId: 'ddPlug',\n    ptype: 'treeviewdragdrop'\n  },\n  listeners : {\n    beforedrop: beforeDropType,\n    drop: dropType\n  }\n}"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/examples/dragTree/data/getFunMenuTree"},"events":{"beforeload":"operation.params.parentID=operation.node.get('ID');"},"children":[],"expanded":false,"type":"treestore"}],"expanded":true,"type":"tree"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}