{"inframe":false,"title":"账簿授权管理","hidden":false,"roles":{"default":1},"children":[{"configs":{"serverScript":"request.setAttribute(\"ctxPath\", request.getContextPath()) ;\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xc/gl/global/ld-sec/XC_GL_LD_SEC\");\n","itemId":"module"},"children":[{"configs":{"title":"{#la_winTitle#}","height":"500","layout":"border","width":"1000","closeAction":"hide","buttonAlign":"center","itemId":"win","modal":"true"},"events":{"show":"// TODO: 取消选中记录\napp.urGrid.getSelectionModel().deselectAll(true) ;\napp.ldGrid.getSelectionModel().deselectAll(true) ;"},"children":[{"configs":{"region":"west","selType":"checkboxmodel","width":"390","forceFit":"true","border":"false","itemId":"ldGrid","simpleSelect":"true"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/gl/global/ld-sec/data/select-all-ledgers-con"},"events":{"beforeload":"store.proxy.extraParams.ldName = app.ldName.getValue() ;"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"{#la_labelWidth#}","labelAlign":"right","itemId":"ldName","fieldLabel":"{#la_ledgerName#}"},"events":{"specialkey":"if (e.getKey() == Ext.EventObject.ENTER) {\n  app.ldGrid.getStore().load();\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#rownum#}","align":"center","width":"50","xtype":"rownumberer","itemId":"rownum"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"账簿ID","hidden":"true","dataIndex":"ID","itemId":"LEDGER_ID"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"编码","hidden":"true","dataIndex":"CODE","itemId":"LEDGER_CODE"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#la_ledgerName#}","width":"250","dataIndex":"NAME","titleAlign":"center","itemId":"LEDGER_NAME"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"},{"configs":{"region":"center","frame":"true","width":"20","itemId":"sepPanel"},"children":[],"expanded":false,"type":"panel"},{"configs":{"region":"east","selType":"checkboxmodel","width":"590","forceFit":"true","border":"false","itemId":"urGrid","simpleSelect":"true"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/gl/global/ld-sec/data/select-user-role"},"events":{"beforeload":"store.proxy.extraParams.uName = app.uName.getValue() ;\nstore.proxy.extraParams.rName = app.rName.getValue() ;"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"90","labelAlign":"right","itemId":"uName","fieldLabel":"{#la_codeName#}"},"events":{"specialkey":"if (e.getKey() == Ext.EventObject.ENTER) {\n  app.urGrid.getStore().load();\n}"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"60","labelAlign":"right","itemId":"rName","fieldLabel":"{#la_roleName#}"},"events":{"specialkey":"if (e.getKey() == Ext.EventObject.ENTER) {\n  app.urGrid.getStore().load();\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#rownum#}","align":"center","xtype":"rownumberer","width":"50","itemId":"rownum"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"用户角色授权ID","hidden":"true","dataIndex":"USER_ROLE_ID","itemId":"USER_ROLE_ID"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"用户ID","hidden":"true","dataIndex":"USER_ID","itemId":"USER_ID"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"角色ID","hidden":"true","dataIndex":"ROLE_ID","itemId":"ROLE_ID"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#la_userName#}","width":"120","dataIndex":"USER_NAME","titleAlign":"center","itemId":"USER_NAME"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#la_empName#}","width":"120","dataIndex":"EMP_NAME","titleAlign":"center","itemId":"EMP_NAME"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#la_roleName#}","width":"200","dataIndex":"ROLE_NAME","titleAlign":"center","itemId":"ROLE_NAME"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"},{"configs":{"itemId":"buttons"},"children":[{"configs":{"text":"{#authorizeBtn#}","itemId":"btnGrant","iconCls":"user_group_icon"},"events":{"click":"// TODO: 获取选中记录行\nvar selLdArray = app.ldGrid.getSelection() ;\nvar selURArray = app.urGrid.getSelection() ;\n\nvar ledgerArr = [] ;\nif(selLdArray.length === 0){\n  Wb.toast('请选择账簿') ;\n  return false ;\n}else{\n  for(var i=0; i<selLdArray.length; i++){\n    var r = selLdArray[i] ;\n    var l = {'LEDGER_ID':r.data.ID} ;\n    ledgerArr.push(l) ;\n  }\n}\n\nvar urArr = [] ;\nif(selURArray.length === 0){\n  Wb.toast('请选择用户角色授权信息') ;\n  return false ;\n}else{\n  for(var i=0; i<selURArray.length; i++){\n    var r = selURArray[i] ;\n    var ur = {'USER_ID':r.data.USER_ID,'ROLE_ID':r.data.ROLE_ID} ;\n    urArr.push(ur) ;\n  }  \n}\n\n// TODO: 进度条\nvar msg = Ext.MessageBox.show({\n  title\t:\t'请等待',\n  msg\t\t:\t'正在提交审核请求，请稍后...',\n  width\t:\t240,\n  wait\t:\ttrue,\n  progress:\ttrue,\n  closable:\tfalse\n});\n\n// TODO: 保存授权信息\nWb.request({\n  url: '{#ctxPath#}'+'/ledgerAction.do?method=grant' ,\n  timeout : 3600000,\n  params: {\n    'ldArray' : Wb.encode(ledgerArr) ,\n    'urArray' : Wb.encode(urArr) \n  },\n  success: function(resp) {\n    msg.hide();\n    var response = Wb.decode(resp.responseText) ;\n    if(response.flag == \"0\"){\n      app.btnQuery.fireEvent('click') ;\n    }\n    Wb.toast(response.msg) ;\n  }\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#cancelAuthBtn#}","itemId":"btnRevoke","iconCls":"delete_icon"},"events":{"click":"// TODO: 获取选中记录行\nvar selLdArray = app.ldGrid.getSelection() ;\nvar selURArray = app.urGrid.getSelection() ;\n\nvar ledgerArr = [] ;\nif(selLdArray.length === 0){\n  Wb.toast('请选择账簿') ;\n  return false ;\n}else{\n  for(var i=0; i<selLdArray.length; i++){\n    var r = selLdArray[i] ;\n    var l = {'LEDGER_ID':r.data.ID} ;\n    ledgerArr.push(l) ;\n  }\n}\n\nvar urArr = [] ;\nif(selURArray.length === 0){\n  Wb.toast('请选择用户角色授权信息') ;\n  return false ;\n}else{\n  for(var i=0; i<selURArray.length; i++){\n    var r = selURArray[i] ;\n    var ur = {'USER_ID':r.data.USER_ID,'ROLE_ID':r.data.ROLE_ID} ;\n    urArr.push(ur) ;\n  }  \n}\n\n// TODO: 进度条\nvar msg = Ext.MessageBox.show({\n  title\t:\t'请等待',\n  msg\t\t:\t'正在提交审核请求，请稍后...',\n  width\t:\t240,\n  wait\t:\ttrue,\n  progress:\ttrue,\n  closable:\tfalse\n});\n\n// TODO: 取消授权信息\nWb.request({\n  url: '{#ctxPath#}'+'/ledgerAction.do?method=revoke' ,\n  timeout : 3600000,\n  params: {\n    'ldArray' : Wb.encode(ledgerArr) ,\n    'urArray' : Wb.encode(urArr) \n  },\n  success: function(resp) {\n    msg.hide();\n    var response = Wb.decode(resp.responseText) ;\n    if(response.flag == \"0\"){\n      app.btnQuery.fireEvent('click') ;\n    }\n    Wb.toast(response.msg) ;\n  }\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#cancelBtn#}","itemId":"btnClose","iconCls":"cancel_icon"},"events":{"click":"app.win.hide();"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"array"}],"expanded":true,"type":"window"},{"configs":{"layout":"fit","itemId":"viewport1"},"events":{"beforerender":"// TODO: 加载用户角色授权界面\nWb.run({\n  url:'m?xwl=xip/auth/role/userRoleAuth',       \n  success:function(appObj){\n    app.userRolePanel.add(appObj.viewport1)  ;\n    appObj.initViewport({\n\n    });\n  }  \n}) ;"},"children":[{"configs":{"activeTab":"ledgerSecPanel","border":"false","itemId":"tab"},"children":[{"configs":{"title":"{#la_userTitle#}","layout":"fit","border":"false","itemId":"userRolePanel"},"children":[],"expanded":true,"type":"panel"},{"configs":{"title":"{#la_ledgerTitle#}","layout":"border","border":"false","itemId":"ledgerSecPanel"},"children":[{"configs":{"region":"north","layout":"fit","border":"false","itemId":"queryForm"},"children":[{"configs":{"title":"{#la_querySet#}","height":"60","layout":"column","padding":"5","itemId":"fieldset1"},"children":[{"configs":{"layout":"fit","columnWidth":".28","border":"false","itemId":"ldPanel"},"children":[{"configs":{"labelWidth":"{#la_labelWidth#}","displayField":"NAME","valueField":"ID","labelAlign":"right","itemId":"ledger","fieldLabel":"{#la_ledgerName#}"},"events":{"select":"app.btnQuery.fireEvent('click');"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/com-qry/gl-ledgers/select-all-ledgers"},"events":{"load":"// 初始化\nExt.define('ldModel', {  \n    extend: 'Ext.data.Model',  \n    fields: [  \n        {name: 'ID'},  \n        {name: 'NAME'}\n     ]  \n});\nvar r = Ext.create('ldModel', {\n  'ID':'ALL', \n  'NAME':'全部'\n});\nstore.insert(0,r);\n\n// 为账簿赋值\nWb.setValue(app.ledger,{'ledger':'ALL'}) ;\n\n// 加载数据\napp.btnQuery.fireEvent('click') ;"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".18","border":"false","itemId":"userPanel"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"userName","fieldLabel":"{#la_userName#}"},"events":{"specialkey":"if (e.getKey() == Ext.EventObject.ENTER) {\n\tapp.btnQuery.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".23","border":"false","itemId":"empPanel"},"children":[{"configs":{"labelWidth":"{#la_labelWidth#}","labelAlign":"right","itemId":"empName","fieldLabel":"{#la_empName#}"},"events":{"specialkey":"if (e.getKey() == Ext.EventObject.ENTER) {\n\tapp.btnQuery.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".16","border":"false","itemId":"rolePanel"},"children":[{"configs":{"labelWidth":"50","labelAlign":"right","itemId":"roleName","fieldLabel":"{#la_roleName#}"},"events":{"specialkey":"if (e.getKey() == Ext.EventObject.ENTER) {\n\tapp.btnQuery.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"layout":"column","columnWidth":".15","border":"false","itemId":"btnPanel"},"children":[{"configs":{"text":"{#queryBtn#}","margin":"0 0 0 10","itemId":"btnQuery","iconCls":"seek_icon"},"events":{"click":"// TODO: 加载授权信息\napp.ldSecGrid.getStore().load({\n\tparams : Wb.encode(Wb.getValue(app.queryForm))\n}) ;"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#resetBtn#}","margin":"0 0 0 5","itemId":"btnReset","iconCls":"redo_icon"},"events":{"click":"Wb.reset(app.queryForm) ;\n\nWb.setValue(app.ledger,{'ledger':'ALL'}) ;\n\napp.btnQuery.fireEvent('click') ;"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"fieldset"}],"expanded":true,"type":"form"},{"configs":{"region":"center","selType":"checkboxmodel","border":"false","itemId":"ldSecGrid","simpleSelect":"true"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/gl/global/ld-sec/data/select-ledger-sec"},"events":{"beforeload":"store.proxy.extraParams = Wb.getValue(app.queryForm) ;"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"{#authorizeBtn#}","itemId":"Grant","iconCls":"user_group_icon"},"events":{"click":"// 设置弹窗口宽度\nvar clientW = document.body.clientWidth ;\nvar clientH = document.body.clientHeight ;\n\napp.win.setWidth(clientW*(0.7)) ;\napp.ldGrid.setWidth(clientW*(0.29)) ;\napp.sepPanel.setWidth(clientW*(0.01)) ;\napp.urGrid.setWidth(clientW*(0.4)) ;\n\napp.win.show();"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#delBtn#}","itemId":"Delete","iconCls":"file_delete_icon"},"events":{"click":"var rows = app.ldSecGrid.getSelection() ;\nif(rows.length === 0){\n  Wb.toast('请选择授权信息') ;\n  return false ;\n}else{\n  var secArray = [] ;\n  for(var i=0; i<rows.length; i++){\n    var r = rows[i] ;\n    var ldSecId = r.data.LEDGER_SEC_ID ;\n    secArray.push({'LD_SEC_ID':ldSecId}) ;\n  }\n  \n  // TODO: 进度条\n  var msg = Ext.MessageBox.show({\n    title\t:\t'请等待',\n    msg\t\t:\t'正在提交审核请求，请稍后...',\n    width\t:\t240,\n    wait\t:\ttrue,\n    progress:\ttrue,\n    closable:\tfalse\n  });\n\n  // TODO: 保存授权信息\n  Wb.request({\n    url: '{#ctxPath#}'+'/ledgerAction.do?method=batchDelSec' ,\n    timeout : 3600000,\n    params: {\n      'secArray' : Wb.encode(secArray)\n    },\n    success: function(resp) {\n      msg.hide();\n      var response = Wb.decode(resp.responseText) ;\n      if(response.flag == \"0\"){\n        app.btnQuery.fireEvent('click') ;\n      }\n      Wb.toast(response.msg) ;\n    }\n  });\n}"},"children":[],"expanded":false,"type":"item"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#rownum#}","align":"center","xtype":"rownumberer","width":"50","titleAlign":"center","itemId":"rownum"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"账薄授权ID","hidden":"true","dataIndex":"LEDGER_SEC_ID","itemId":"LD_SEC_ID"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"账薄ID","hidden":"true","dataIndex":"LEDGER_ID","itemId":"LEDGER_ID"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"用户ID","hidden":"true","dataIndex":"USER_ID","itemId":"USER_ID"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"角色ID","hidden":"true","dataIndex":"ROLE_ID","itemId":"ROLE_ID"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#la_ledgerName#}","width":"250","dataIndex":"LEDGER_NAME","titleAlign":"center","itemId":"LEDGER_NAME"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#la_userName#}","width":"200","dataIndex":"USER_NAME","titleAlign":"center","itemId":"USER_NAME"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#la_empName#}","width":"200","dataIndex":"EMP_NAME","titleAlign":"center","itemId":"EMP_NAME"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#la_roleName#}","width":"250","dataIndex":"ROLE_NAME","titleAlign":"center","itemId":"ROLE_NAME"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"tab"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}