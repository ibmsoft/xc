{"inframe":false,"title":"科目修改","hidden":false,"roles":{"default":1},"children":[{"configs":{"loginRequired":"false","serverScript":"//检查是否存在重复的ACC_CODE\napp.run('select 1 from xc_gl_accounts where ACC_CODE={?ACC_CODE?} and ACC_HRCY_ID={?ACC_HRCY_ID?} and ACC_ID <> {?ACC_ID?}',{\n    errorText: '编码\"' + app.get('ACC_CODE') + '\" 已经存在。'\n});\napp.run('select 1 from xc_gl_accounts where ACC_NAME={?ACC_NAME?} and ACC_HRCY_ID={?ACC_HRCY_ID?} and ACC_ID <> {?ACC_ID?}',{\n    errorText: '名称\"' + app.get('ACC_NAME') + '\" 已经存在。'\n});\n// //检查是否被科目组合占用，若是占用，不能添加下级\n// app.run(\"SELECT 1 FROM xc_gl_ccid gc,xc_gl_accounts ga,xc_gl_ledgers gl WHERE gc.ACC_ID = ga.ACC_ID AND gc.LEDGER_ID = gl.LEDGER_ID AND ga.ACC_HRCY_ID = gl.ACC_HRCY_ID AND ga.ACC_CODE = {?TEMP_ACC_CODE?} AND ga.ACC_HRCY_ID = {?ACC_HRCY_ID?}\",{\n// \terrorText: '上级编码\"' + app.get('TEMP_ACC_CODE') + '\" 已经被使用，不能添加下级。'\n// });\napp.run(\"UPDATE xc_gl_accounts SET IS_LEAF = 'N' WHERE ACC_CODE = {?TEMP_ACC_CODE?} AND ACC_ID <> {?ACC_ID?} and ACC_HRCY_ID = {?ACC_HRCY_ID?}\",{});","itemId":"module"},"children":[{"configs":{"oracle":"UPDATE xc_gl_ld_accounts gla\nSET gla.END_DATE = {?END_DATE?},\ngla.START_DATE = {?START_DATE?},\nLAST_UPDATE_DATE = {?timestamp.sys.date?},\nLAST_UPDATED_BY = {?XIP.userId?}\nWHERE\n\tgla.ACC_ID = {?ACC_ID?}\nAND gla.START_DATE <= (\n\tSELECT\n\t\tga.START_DATE\n\tFROM\n\t\txc_gl_accounts ga\n\tWHERE\n\t\tga.ACC_ID = {?ACC_ID?}\n\tAND ga.START_DATE = TO_DATE({?START_DATE?}, 'yy-MM-dd')\n)\nAND gla.END_DATE >= (\n\tSELECT\n\t\tga.END_DATE\n\tFROM\n\t\txc_gl_accounts ga\n\tWHERE\n\t\tga.ACC_ID = {?ACC_ID?}\n\tAND ga.END_DATE = TO_DATE({?END_DATE?},'yy-MM-dd')\n)","itemId":"sqlswitcher1","mysql":"UPDATE xc_gl_ld_accounts gla\nSET gla.END_DATE = {?END_DATE?},\ngla.START_DATE = {?START_DATE?},\nLAST_UPDATE_DATE={?timestamp.sys.date?},\nLAST_UPDATED_BY={?XIP.userId?}\nWHERE\n\tgla.ACC_ID = {?ACC_ID?}\nAND gla.START_DATE <= (\n\tSELECT\n\t\tga.START_DATE\n\tFROM\n\t\txc_gl_accounts ga\n\tWHERE\n\t\tga.ACC_ID = {?ACC_ID?}\n\tAND ga.START_DATE = DATE_FORMAT({?START_DATE?}, '%Y-%m-%d')\n)\nAND gla.END_DATE >= (\n\tSELECT\n\t\tga.END_DATE\n\tFROM\n\t\txc_gl_accounts ga\n\tWHERE\n\t\tga.ACC_ID = {?ACC_ID?}\n\tAND ga.END_DATE = DATE_FORMAT({?END_DATE?},'%Y-%m-%d')\n)"},"children":[],"expanded":false,"type":"sqlswitcher"},{"configs":{"oracle":"UPDATE xc_gl_ccid\nSET\n\tCCID_NAME = CONCAT(CONCAT({?ACC_CODE?},{?ACC_NAME?}),\n                       SUBSTR(CCID_NAME,\n                             LENGTH(CCID_NAME)-LENGTH(ACC_CODE)-LENGTH(ACC_NAME)\n                            )\n                      ),\n ACC_NAME = {?ACC_NAME?}\nWHERE\n\tACC_ID = {?ACC_ID?}","itemId":"sqlswitcher2","mysql":"UPDATE xc_gl_ccid\nSET\n\tCCID_NAME = CONCAT(CONCAT({?ACC_CODE?},{?ACC_NAME?}),\n                       RIGHT(CCID_NAME,\n                             CHAR_LENGTH(CCID_NAME)-CHAR_LENGTH(ACC_CODE)-CHAR_LENGTH(ACC_NAME)\n                            )\n                      ),\n ACC_NAME = {?ACC_NAME?}\nWHERE\n\tACC_ID = {?ACC_ID?}"},"children":[],"expanded":false,"type":"sqlswitcher"},{"configs":{"sql":"UPDATE xc_gl_accounts\nSET ACC_CODE = {?ACC_CODE?},\n    ACC_NAME = {?ACC_NAME?},\n    UP_ACC_CODE = {?UP_ACC_CODE?},\n    ACC_CATEGORY_CODE = {?ACC_CATEGORY_CODE?},\n    ACC_GROUP_ID = {?ACC_GROUP_ID?},\n    ACC_HRCY_ID = {?ACC_HRCY_ID?},\n    BALANCE_DIRECTION = {?BALANCE_DIRECTION?},\n    IS_BANK_ACC = {?IS_BANK_ACC?},\n    IS_CASH_ACC = {?IS_CASH_ACC?},\n    IS_CASH_ITEM = {?IS_CASH_ITEM?},\n    START_DATE = {?START_DATE?},\n    END_DATE = {?END_DATE?},\n    IS_LEAF = {?IS_LEAF?},\n    ACC_LEVEL = {?ACC_LEVEL?},\n    ASS_KEY = {?ASS_KEY?},\n    LAST_UPDATE_DATE = {?timestamp.sys.date?},\n    LAST_UPDATED_BY = {?XIP.userId?}\nWHERE ACC_ID = {?ACC_ID?}","transaction":"start","itemId":"accountsEdit"},"children":[],"expanded":false,"type":"query"},{"configs":{"sql":"{#sqlswitcher1#}","itemId":"ld_acountsEdit"},"children":[],"expanded":false,"type":"query"},{"configs":{"sql":"{#sqlswitcher2#}","itemId":"ld_ccidEdit"},"children":[],"expanded":false,"type":"query"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}