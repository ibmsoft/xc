{"inframe":false,"title":"保存模板数据","hidden":true,"roles":{"dev":1},"children":[{"configs":{"serverScript":"var subRows = Wb.decode(request.getParameter('operateData'));\nvar mainData = Wb.decode(request.getParameter('mainData'));\nvar mainRows = [];\nmainRows.push(mainData);\nvar mainKey = request.getParameter('mainKey');\n//只需处理新增和修改的列，删除操作已经单独执行\n//批量执行新增和更新操作\nvar createRows = subRows.create;\nvar updateRows = subRows.update;\nWb.each(createRows, function(rec) {\n  var subKey = java.util.UUID.randomUUID().toString();\n  Wb.apply(rec, {\n    TEMPLATE_ID: mainKey,\n    TEMPLATE_DTL_ID: subKey\n  });\n});\n\nrequest.setAttribute('updateRows', Wb.encode(updateRows));\nrequest.setAttribute('createRows', Wb.encode(createRows));\nrequest.setAttribute('mainRows',Wb.encode(mainRows));\n\n","itemId":"module"},"children":[{"configs":{"sql":"update xc_gl_template\n  set  TEMPLATE_DESC = {?TEMPLATE_DESC?},\n       LAST_UPDATE_DATE = {?timestamp.sys.date?},\n       LAST_UPDATED_BY ={?XIP.userId?}\nwhere TEMPLATE_ID = {?TEMPLATE_ID?}\n","transaction":"start","arrayName":"mainRows","itemId":"updateMainTable"},"children":[],"expanded":false,"type":"query"},{"configs":{"sql":"insert into xc_gl_template_dtl(\n TEMPLATE_DTL_ID, \n TEMPLATE_ID,     \n COL_CODE,        \n COL_NAME,        \n COL_ALIAS,       \n COL_TYPE, \n COL_SEQ,\n CREATION_DATE,   \n CREATED_BY,      \n LAST_UPDATE_DATE,\n LAST_UPDATED_BY \n)values(\n {?TEMPLATE_DTL_ID?},\n {?TEMPLATE_ID?},\n {?COL_CODE?},\n {?COL_NAME?},\n {?COL_ALIAS?},\n {?COL_TYPE?},\n {?integer.COL_SEQ?},\n {?timestamp.sys.date?},\n {?XIP.userId?},\n {?timestamp.sys.date?},\n {?XIP.userId?}\n)","arrayName":"createRows","itemId":"insertSubTable"},"children":[],"expanded":false,"type":"query"},{"configs":{"sql":"update  xc_gl_template_dtl\n set   COL_ALIAS =  {?COL_ALIAS?},\n       COL_SEQ = {?integer.COL_SEQ?},\n       LAST_UPDATE_DATE = {?timestamp.sys.date?},\n       LAST_UPDATED_BY ={?XIP.userId?}\nwhere TEMPLATE_DTL_ID ={?TEMPLATE_DTL_ID?}","arrayName":"updateRows","itemId":"updateSubTable"},"children":[],"expanded":false,"type":"query"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}