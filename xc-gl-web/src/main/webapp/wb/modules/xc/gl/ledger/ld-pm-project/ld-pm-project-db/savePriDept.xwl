{"inframe":false,"title":"","hidden":false,"roles":{"default":1},"children":[{"configs":{"loginRequired":"false","serverScript":"var id, ids = [],\n    recs_create = Wb.decode(request.getParameter('create')),\n    recs_update = Wb.decode(request.getParameter('update'));\n  \nWb.each(recs_create, function(rec) {\n  \n  app.run(\"select 1 from xc_pm_prj_dept where '\"+rec.DEPT_ID+\"'  = '' \",\n        {errorText: '请添加成本中心!'});\napp.run(\"select 1 from xc_pm_prj_dept where DEPT_ID='\"+rec.DEPT_ID+\"' and LEDGER_ID='\"+rec.LEDGER_ID+\"' and PROJECT_ID='\"+rec.PROJECT_ID+\"' \",\n        {errorText: '该成本中心已经存在!'});\n id =java.util.UUID.randomUUID();\n  rec.PRJ_DEPT_ID = id;\n  ids.push({\n    PRJ_DEPT_ID: id\n  });\n  });\nWb.each(recs_update, function(rec) {\napp.run(\"select 1 from xc_pm_prj_dept where DEPT_ID='\"+rec.DEPT_ID+\"' and LEDGER_ID='\"+rec.LEDGER_ID+\"' and PROJECT_ID='\"+rec.PROJECT_ID+\"' and PRJ_DEPT_ID<>'\"+rec.PRJ_DEPT_ID+\"' \",\n        {errorText: '该成本中心已经存在!'});\n\n  });\n\nrequest.setAttribute('create', Wb.encode(recs_create)); //重置create记录\nrequest.setAttribute('update', Wb.encode(recs_update));//重置update记录\napp.update({\n  tableName: 'xc_pm_prj_dept'\n});\napp.send(ids);","itemId":"module"},"children":[],"expanded":false,"type":"module"}],"pageLink":"","iconCls":""}