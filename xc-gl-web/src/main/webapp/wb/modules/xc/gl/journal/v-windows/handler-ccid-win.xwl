{"inframe":false,"title":"CCID处理","hidden":false,"roles":{"default":1},"children":[{"configs":{"loginRequired":"false","serverScript":"//---------------------获取当前模块语言对应的.json文件，放到request中----------------\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xc/gl/journal/v-windows/json/handler-ccid-win\");\n\n// TODO: 获取参数信息            \nvar ledgerId = request.getParameter(\"ledgerId\") ;\nrequest.setAttribute(\"ledgerId\",ledgerId) ;\n\nvar _pcode = request.getParameter(\"periodCode\") ;\nrequest.setAttribute(\"balPeriodCode\", _pcode) ;\n\n// TODO: 获取当前数据库信息，并存入request对象\nvar dbType = com.xzsoft.xip.platform.util.PlatformUtil.getDbType();\nrequest.setAttribute(\"dbType\",dbType);\n\n// TODO: 当前凭证类型:normal-金额凭证，amount-数量凭证，foreign-外币凭证\nvar vtype = request.getParameter(\"vtype\") ;\nrequest.setAttribute(\"vtype\",vtype) ;\n\n// TODO: 获取凭证来源信息：manual-内部手工凭证，其他值则视为外部凭证\nvar srctype = request.getParameter(\"srctype\") ;\nrequest.setAttribute(\"srctype\",srctype) ;","itemId":"module"},"events":{"initialize":"// TODO: 窗口初始化函数\nExt.apply(app,{\n  initWindow:function(params){\n    Ext.apply(app, params);\n    \n    // 设置科目与科目组信息\n    var _accName = params.accName ;\n    var _index = _accName.indexOf(\"/\") ;\n    _index = (_index == -1 ? _accName.length : _index ) ;\n    _accName = _accName.substr(0,_index) ;\n    \n    app.segAccName.setValue(_accName);\n    app.segAccGroup.setValue() ;\n    \n    // 查询科目信息\n    var accStore = app.accountGrid.getStore() ;\n    accStore.load({\n      params:{\n       'ledgerId':params.ledgerId,\n       'accName':_accName,\n       'groupId':params.groupId        \n      },\n      callback : function(){\n        // 如果只有一条记录\n        if(accStore.getCount() == 1){\n          var sm = app.accountGrid.getSelectionModel() ;\n          sm.select(0) ;\n          // 所选科目\n          var rr = accStore.getAt(0) ;\n          // 1.初始化现金流量项目\n          var isBankAcc = rr.get('IS_BANK_ACC') ;\n          var isCashAcc = rr.get('IS_CASH_ACC') ;\n          if(isBankAcc == 'Y' || isCashAcc == 'Y'){\n            if(params.caId !== \"\" && params.caId !== null && params.caId !== undefined){\n              var cashStore = app.cashItems.getStore() ;\n              cashStore.load({\n                callback : function(){\n                  var ii = cashStore.find('CA_ID',params.caId) ;\n                  var rec = cashStore.getAt(ii) ;\n                  app.cashId.setValue(params.caId) ;\n                  app.cashCode.setValue(rec.get('CA_CODE')) ;\n                  app.cashItems.setRawValue(rec.get('CA_NAME')) ;\n                }\n              });\n              app.segFrom.show() ;\n            }            \n          }\n          // 处理辅助段信息\n          var ldAccId = rr.get('LD_ACC_ID') ;\n          var segStore = app.segmentGrid.getStore() ;\n          segStore.load({\n              params : {'ldAccId':ldAccId},\n              callback : function(){\n                var segTotal = segStore.getCount() ;\n                var acc_id = rr.get('ACC_ID') ;\t\t\t// 科目ID\n                var cny_code = rr.get('CNY_CODE') ;\t\t// 币种\n                var segments = Wb.getData(app.segmentGrid) ; // 辅助核算信息\n                \n                // 1)、科目不存在辅助核算段\n                if(segTotal === 0 && params.ccid !== null && params.ccid !== \"\" && params.ccid !== undefined){\n                  // 计算科目余额\n                  getAccBalance(params.ledgerId,acc_id,segments,segTotal,cny_code) ;\n                }\n                \n                // 2)、科目存在辅助核算段\n                if(segTotal > 0 && params.ccid !== null && params.ccid !== \"\" && params.ccid !== undefined){\n                  // 查询科目组合信息\n                  Wb.request({\n                    url : 'm?xwl=xc/gl/journal/data-db/ccid-data/select-ccid',\n                    timeout : 3600000,\n                    async : false ,\n                    params : {\n                      'ccid' : params.ccid\n                    },\n                    success: function(resp) {\n                      // 为辅助核算段赋值\n                      var response = Wb.decode(resp.responseText) ;\n                      var rc = response.rows[0] ;\n                      for(var k=0; k<segTotal; k++){\n                        var sr = segStore.getAt(k) ;\n                        // 辅助段编码\n                        var segCode = sr.get('SEG_CODE') ;\n                        // 辅助段值\n                        var segValId,segValCode,segValName ;\n                        // 表格赋值\n                        if(segCode === 'XC_AP_VENDORS'){\n                          segValId = rc.VENDOR_ID ;\n                          segValCode = rc.VENDOR_CODE ;\n                          segValName = rc.VENDOR_NAME ;\n                          \n                        }else if(segCode === 'XC_AR_CUSTOMERS'){\n                          segValId = rc.CUSTOMER_ID ;\n                          segValCode = rc.CUSTOMER_CODE ;\n                          segValName = rc.CUSTOMER_NAME ;\n                          \n                        }else if(segCode === 'XIP_PUB_EMPS'){\n                          segValId = rc.EMP_ID ;\n                          segValCode = rc.EMP_CODE ;\n                          segValName = rc.EMP_NAME ;\n                                                                              \n                        }else if(segCode === 'XIP_PUB_ORGS'){\n                          segValId = rc.ORG_ID ;\n                          segValCode = rc.ORG_CODE ;\n                          segValName = rc.ORG_NAME ;\n                                                                            \n                        }else if(segCode === 'XC_GL_PRODUCTS'){\n                          segValId = rc.PRODUCT_ID ;\n                          segValCode = rc.PRODUCT_CODE ;\n                          segValName = rc.PRODUCT_NAME ;\n                                                                             \n                        }else if(segCode === 'XIP_PUB_DEPTS'){\n                          segValId = rc.DEPT_ID ;\n                          segValCode = rc.DEPT_CODE ;\n                          segValName = rc.DEPT_NAME ;\n                                                \n                        }else if(segCode === 'XC_PM_PROJECTS'){\n                          segValId = rc.PROJECT_ID ;\n                          segValCode = rc.PROJECT_CODE ;\n                          segValName = rc.PROJECT_NAME ;\n                                                    \n                        }else if(segCode === 'XC_GL_CUSTOM1'){\n                          segValId = rc.CUSTOM1_ID ;\n                          segValCode = rc.CUSTOM1_CODE ;\n                          segValName = rc.CUSTOM1_NAME ;\n                                                    \n                        }else if(segCode === 'XC_GL_CUSTOM2'){\n                          segValId = rc.CUSTOM2_ID ;\n                          segValCode = rc.CUSTOM2_CODE ;\n                          segValName = rc.CUSTOM2_NAME ;\n                                                    \n                        }else if(segCode === 'XC_GL_CUSTOM3'){\n                          segValId = rc.CUSTOM3_ID ;\n                          segValCode = rc.CUSTOM3_CODE ;\n                          segValName = rc.CUSTOM3_NAME ;\n                                                    \n\t\t\t\t\t\t}else if(segCode === 'XC_GL_CUSTOM4'){   \n                          segValId = rc.CUSTOM4_ID ;\n                          segValCode = rc.CUSTOM4_CODE ;\n                          segValName = rc.CUSTOM4_NAME ;\n                                                    \n                        }\n                        sr.set('SEG_VAL_ID',segValId) ;\n                        sr.set('SEG_VAL_CODE',segValCode) ;\n                        sr.set('SEG_VAL_NAME',segValName) ;\n                      }\n                    }\n                  });\n                  // 计算科目余额\n                  getAccBalance(params.ledgerId,acc_id,segments,segTotal,cny_code) ;\n                }\n              }\n          }) ;         \n          // 4.处理预算信息（手工凭证）\n          var bgItemId = rr.get('BG_ITEM_ID') ;\n          if('{#srctype#}' == 'manual' && bgItemId !== null && bgItemId !== \"\" && bgItemId !== undefined){\n            Wb.setValue(app.bgFrom,Wb.decode(params.bgInfo)) ;\n            app.projects.enable() ;\n            app.depts.enable() ;\n          }\n        }\n      }\n    }) ;\n    \n    // 设置窗口高度与宽度\n    var _width = params.width ;\n    if(_width === \"\" || _width === null || _width === undefined){\n      _width = document.body.clientWidth*(0.8) ;\n    }\n    var _height = params.height ;\n    if(_height === \"\" || _height === null || _height === undefined){\n      _height = document.body.clientHeight*(0.9) ;\n    }    \n    app.segWin.setWidth(_width) ;   // 922\n    app.segWin.setHeight(_height) ;    // 500\n    \n    app.segWin.show() ;\n  }\n});\n\n// TODO: 处理辅助核算段信息\nfunction getSegVals(segments,type){\n  var segvals = [];\n  if(segments.length > 0){   \n    var tt = 0 ;\n    for(var i=0; i<segments.length; i++){\n      var rr = segments[i] ;\n      var seg_code = rr.SEG_CODE ;\n      var seg_name = rr.SEG_NAME ;\n      var seg_val_id = rr.SEG_VAL_ID ;\n      if(type === 'required'){ \n        // 辅助段必输时(处理CCID)\n        if(seg_val_id === \"\" || seg_val_id === null || seg_val_id === undefined){\n          tt++ ;\n          break ;\n        }else{\n          segvals.push({'SEG_CODE':seg_code,'SEG_VAL_ID':seg_val_id}) ;\n        }\n        \n      }else{\n        // 辅助段可选时(计算余额)\n        if(seg_val_id !== \"\" && seg_val_id !== null && seg_val_id !== undefined){\n          segvals.push({'SEG_CODE':seg_code,'SEG_VAL_ID':seg_val_id}) ;\n        }\n      }\n    }\n    // 辅助核算段必须全部选择\n    if(type === 'required' && tt !== 0){\n      return [] ;\n    }\n  }\n  return segvals ;\n}\n\n// TODO: 添加零余额\nfunction addZeroRecord(cnyCode){\n  \n  Ext.define('balanceModel', {  \n    extend: 'Ext.data.Model',  \n    fields: [  \n      {name: 'CURRENCY'},  \n      {name: 'BALANCE'},\n      {name: 'T_BALANCE'}\n    ]  \n  });\n  var r = Ext.create('balanceModel', {\n    'CURRENCY':cnyCode,\n    'BALANCE':0,\n    'T_BALANCE':0\n  });\n  app.balanceGrid.store.insert(0,r);                  \n \n}\n\n// TODO: 处理CCID信息\nfunction getCCID(paramJson,returnJson){\n  // 执行请求\n  Wb.request({\n    url: 'm?xwl=xc/gl/journal/data-db/ccid-data/handler-v-line-ccid',\n    params: paramJson,\n    success: function(resp) {\n      var response = Wb.decode(resp.responseText);\n      if(response.flag == \"0\"){\n        // 生成返回参数\n        returnJson.acc_ccid = response.ccid ;\n        returnJson.acc_ccid_name = response.ccid_name ;\n        // 为凭证分录赋予CCID和现金流量项目ID\n        app.handlerCCID(Wb.encode(returnJson)) ;\n        // 隐藏窗口\n\t\tapp.segWin.hide();\n        \n      }else{\n        // CCID处理失败\n        Wb.info(response.msg) ;\n      }    \n    }\n  });  \n}\n\n// TODO: 计算科目余额\nfunction getAccBalance(ledgerId, accId, segments, segTotal, cnyCode){\n  // 已选辅助段\n  var segvals = getSegVals(segments,'option') ;\n  // 计算科目余额\n  if(segTotal == segvals.length){\n    // 发送请求计算CCID\n    Wb.request({\n      url: 'm?xwl=xc/gl/journal/data-db/ccid-data/handler-v-line-ccid',\n      params: {'ledgerId':ledgerId,'accId':accId,'segments':segments},\n      success: function(resp) {\n        var response = Wb.decode(resp.responseText) ;\n        if(response.flag == \"0\"){\n          // 加载数据\n          app.balanceGrid.getStore().load({\n              params : {'ccid':response.ccid},\n              callback : function(){\n                // 添加空余额\n                if(app.balanceGrid.getStore().getCount() === 0){\n                  addZeroRecord(cnyCode) ;\n                }\n              }\n          }) ;    \n        }        \n      }\n    });  \n    \n  }else{\n    // 清除余额表数据\n    app.balanceGrid.getStore().removeAll() ;\n  }\n}\n"},"children":[{"configs":{"itemId":"buttons"},"children":[{"configs":{"text":"{#okBtn#}","itemId":"okBtn","iconCls":"ok_icon"},"events":{"click":"// TODO: 获取科目信息\nvar records = app.accountGrid.getSelection() ;\n\nif(records.length === 0){\n  Wb.info(\"请选择科目信息\")  ;\n  return false ;\n  \n}else{\n  var r = records[0] ;\n\n  // TODO: 获取科目的银行科目和现金科目属性值\n  var isBankAcc = r.data.IS_BANK_ACC ;\n  var isCashAcc = r.data.IS_CASH_ACC ;\n  // TODO: 科目ID、编码和名称\n  var acc_id = r.data.ACC_ID ;\n  var acc_code = r.data.ACC_CODE ;\n  var acc_name = r.data.ACC_NAME ;\n  // TODO: 计量单位ID\n  var dim_id = r.data.DIM_ID ;\n  var dim_name = r.data.DIM_NAME ;\n  // TODO: 币种\n  var cny_code = r.data.CNY_CODE ;\n  var cny_name = r.data.CNY_NAME ;\n  // TODO: 是否外币\n  var foreign_cny = r.data.IS_FOREIGN ;\n  // TODO: 科目余额方向: 1-借方, -1-贷方\n  var bd = r.data.BD ;\n  // TODO: 获取现金流量项目值信息\n  var ca_id = app.cashId.getValue() ;\n  var caName = app.cashItems.getRawValue() ;\n\n  \n  // TODO: 当科目的银行科目或现金科目属性值为Y时，则需要指定现金流量项\n  if(isBankAcc == 'Y'){\n    if(ca_id === \"\" || ca_id === null || ca_id === undefined){\n      Wb.info(\"当前所选科目为银行科目，请选择现金流量项目!\") ;\n      return  ;\n    }\n  }\n  if(isCashAcc == 'Y'){\n    if(ca_id === \"\" || ca_id === null || ca_id === undefined){\n      Wb.info(\"当前所选科目为现金科目，请选择现金流量项目!\") ;\n      return  ;\n    }\n  }\n  \n  // TODO: 处理辅助核算段信息\n  var segvals = getSegVals(Wb.getData(app.segmentGrid),'required');\n  var segTotal = app.segmentGrid.getStore().getCount() ;\n  if(segTotal !== 0 && segvals.length === 0){\n    Wb.info('请把辅助核算段值补全') ;\n    return false ;\n  }\n  \n  /**\n   * 文档注释 :处理凭证分录CCID信息\n   * @param {json} paramJson 必须参数说明。\n   * @param {json} returnJson 必须参数说明。\n   * @return {void} 返回值说明。\n   */\n  \n  // 计算参数\n  var paramJson = {\n    'ledgerId' : '{#ledgerId#}',\n    'accId' : r.data.ACC_ID ,\n    'segments' : Wb.encode(segvals)\n  } ;\n  // 返回参数\n  var returnJson = {\n    'acc_id':acc_id,\n    'acc_code':acc_code,\n    'acc_name':acc_name,\n    'ca_id':ca_id,\n    'ca_name':caName,\n    'f_cny':foreign_cny,\n    'dim_id':dim_id,\n    'dim_name':dim_name,\n    'cny_code':cny_code,\n    'cny_name':cny_name,\n    'bd':bd,\n    'bgItemId':app.bgItemId.getValue() ,\n    'projectId' : app.projectId.getValue(),\n    'deptId':app.deptId.getValue() \n  } ;\n  if(isBankAcc == 'Y' || isCashAcc == 'Y'){\n    returnJson.is_sign = 'Y' ;\n  }else{\n    returnJson.is_sign = 'N' ;\n  }\n  \n  // 处理凭证分录CCID信息\n  getCCID(paramJson,returnJson);\n  \n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#cancelBtn#}","itemId":"cancelBtn","iconCls":"cancel_icon"},"events":{"click":"app.segWin.hide();\n"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"array"},{"configs":{"title":"{#segWinTitle#}","layout":"fit","buttons":"app.buttons","buttonAlign":"right","itemId":"segWin","modal":"true","maximizable":"true"},"children":[{"configs":{"layout":"border","buttons":"app.items","buttonAlign":"right","itemId":"segPanel","border":"false"},"children":[{"configs":{"region":"center","layout":"border","itemId":"segAccPanel","border":"false"},"children":[{"configs":{"region":"center","multiSelect":"false","pagingBar":"false","selType":"rowmodel","selModel":"{'mode':'SINGLE'}","itemId":"accountGrid","border":"false","forceFit":"true"},"events":{"itemclick":"// TODO: 加载科目辅助核算信息\nvar ldAccId = record.data.LD_ACC_ID ;\napp.segmentGrid.store.load({\n\tparams : {'ldAccId':ldAccId},\n    callback : function(){\n      // 科目ID\n      var acc_id = record.data.ACC_ID ;\t\n      // 币种\n      var cny_code = record.data.CNY_CODE ;\t\n      // 辅助核算信息\n      var segments = Wb.getData(app.segmentGrid) ; \n      var segTotal = app.segmentGrid.store.getCount() ;\n      // 如果科目不存在辅助核算段,则计算科目余额\n      if(segTotal === 0){  \n        getAccBalance('{#ledgerId#}',acc_id,segments,segTotal,cny_code) ;\n      }\n    }\n}) ;\n\n// TODO: 判断此科目是否需要关联现金流量项\nvar isBankAcc = record.data.IS_BANK_ACC ;\t// 是否为银行科目： Y-是,N-否\nvar isCashAcc = record.data.IS_CASH_ACC ;\t// 是否现金科目： Y-是,N-否\n\nif(isBankAcc == 'Y' || isCashAcc == 'Y'){\n  var cashId = app.cashId.getValue() ;\n  if(cashId !== \"\" && cashId !== null && cashId !== undefined){\n    var cashStore = app.cashItems.getStore() ;\n    var idx = cashStore.find('CA_ID',cashId) ;\n    var rr = cashStore.getAt(idx) ;\n    \n    var ca_code = rr.get('CA_CODE');\n    var _ca_name = rr.get('CA_NAME');\n    app.cashCode.setValue(ca_code);\n    app.cashItems.setRawValue(_ca_name);\n    \n  }else{\n    app.segFrom.getForm().reset() ;\n  }\n  app.segFrom.show();\n  \n}else{\n  app.segFrom.getForm().reset() ;\n  app.segFrom.hide();\n}\n\n\n// TODO: 处理总账手工凭证预算校验问题\nvar bgItemId = record.data.BG_ITEM_ID ; \nvar bgItemName = record.data.BG_ITEM_NAME ;\n// 获取凭证来源信息：manual-内部手工凭证，其他值则视为外部凭证\nvar srctype = '{#srctype#}' ;\nif(bgItemId !== null && bgItemId !== \"\" && bgItemId !== undefined && srctype === 'manual'){\n  app.projects.enable() ;\n  app.depts.enable() ;\n  \n  app.bgItemId.setValue(bgItemId) ;\n  app.bgItemName.setValue(bgItemName) ;\n  app.projectId.setValue() ;\n  app.projects.setValue() ;\n  app.deptId.setValue() ;\n  app.depts.setValue() ;  \n  \n}else{\n  app.projects.disable() ;\n  app.depts.disable() ;\n  \n  app.bgItemId.setValue() ;\n  app.bgItemName.setValue() ;\n  app.projectId.setValue() ;\n  app.projects.setValue() ;\n  app.deptId.setValue() ;\n  app.depts.setValue() ;\n}\n\n\n"},"children":[{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"65","width":"200","labelAlign":"right","itemId":"segAccName","fieldLabel":"{#segAccName#}"},"events":{"change":"// 动态筛选\nvar accStore = app.accountGrid.getStore() ;\naccStore.filterBy(function(record,id){\n  var text = record.get('ACC_NAME');\n  return (text.indexOf(newValue)!=-1);\n});","specialkey":"var _groupId = app.segAccGroup.getValue() ;\nif(_groupId === null || _groupId === \"\" || _groupId === \"undefined\"){\n  _groupId = 'ALL' ;\n}\napp.accountGrid.store.load({\n\tparams : {\n      'ledgerId' : '{#ledgerId#}',\n      'accName' :  text.getValue(),\n      'groupId' :  _groupId\n    }\n});"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"110","displayField":"GROUP_NAME","width":"250","valueField":"GROUP_ID","value":"ALL","emptyText":"{#gl_journal_v_windows_choose#}","labelAlign":"right","itemId":"segAccGroup","fieldLabel":"{#segAccGroup#}"},"events":{"beforequery":"var combo = plan.combo ;\nif(!plan.forceAll){\n  var value = plan.query;\n  combo.store.filterBy(function(record,id){\n    var text = record.get(combo.displayField);\n    return (text.indexOf(value)!=-1);\n  });\n  combo.expand();\n  return false;\n}","select":"var _groupId = combo.getValue() ;\nif(_groupId === null || _groupId === \"\" || _groupId === \"undefined\"){\n  _groupId = 'ALL' ;\n}\napp.accountGrid.store.load({\n\tparams : {\n      'ledgerId' : '{#ledgerId#}',\n      'accName' :  app.segAccName.getValue(),\n      'groupId' :  _groupId\n    }\n});"},"children":[{"configs":{"pageSize":"-1","autoLoad":"true","itemId":"store","url":"m?xwl=xc/gl/journal/data-db/ccid-data/select-acc-group"},"events":{"load":"Ext.define('accGroupModel', {  \n    extend: 'Ext.data.Model',  \n    fields: [  \n        {name: 'GROUP_ID'},  \n        {name: 'GROUP_NAME'}\n     ]  \n});\nvar r = Ext.create('accGroupModel', {\n  'GROUP_ID':'ALL', \n  'GROUP_NAME':'全部'\n});\n\nstore.insert(0,r);"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"}],"expanded":true,"type":"toolbar"},{"configs":{"pageSize":"-1","itemId":"store","url":"m?xwl=xc/gl/journal/data-db/ccid-data/select-line-account"},"events":{"load":"// 隐藏现金流量项的表单框\napp.segFrom.hide();\n\n// 清空辅助核算段信息\napp.segmentGrid.getStore().removeAll() ;\n\n// 清空预算信息\napp.projects.disable() ;\napp.depts.disable() ;\napp.bgFrom.getForm().reset();\n\n// 清空科目余额信息\napp.balanceGrid.getStore().removeAll() ;\n","beforeload":"var vt = '{#vtype#}' ;\n\n// 组合查询条件\nvar mysqlStr = '1=1' ;\nvar oraStr = '1=1' ;\nif(vt == 'normal'){\n  mysqlStr = 'xla.is_foregin_cny = 0 and IFNULL(xla.is_amount,0) = 0 ' ;\n  oraStr = 'xla.is_foregin_cny = 0 and NVL(xla.is_amount,0) = 0 ' ;\n  \n}else if(vt == 'amount'){\n  mysqlStr = 'xla.is_foregin_cny <> 1 ' ;\n  oraStr = 'xla.is_foregin_cny <> 1 ' ;\n  \n}else if(vt == 'foreign'){\n  mysqlStr = 'IFNULL(xla.is_amount,0) <> 1 ' ;\n  oraStr = 'NVL(xla.is_amount,0) <> 1 ' ;\n  \n}else{\n}\n\nstore.proxy.extraParams.mysqlStr = mysqlStr ;\nstore.proxy.extraParams.oraStr = mysqlStr ;\n"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"科目ID","hidden":"true","dataIndex":"ACC_ID","itemId":"accId"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"科目编码","hidden":"true","dataIndex":"ACC_CODE","itemId":"accCode"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#accName#}","width":"300","dataIndex":"ACC_NAME","titleAlign":"center","itemId":"accName"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"是否外币","hidden":"true","dataIndex":"IS_FOREIGN","itemId":"isForeign"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#cnyCode#}","width":"80","dataIndex":"CNY_CODE","titleAlign":"center","itemId":"cnyCode"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"单位ID","hidden":"true","dataIndex":"DIM_ID","itemId":"dimId"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#dimName#}","width":"80","dataIndex":"DIM_NAME","titleAlign":"center","itemId":"dimName"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"银行科目","hidden":"true","dataIndex":"IS_BANK_ACC","itemId":"isBankAcc"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"现金科目","hidden":"true","dataIndex":"IS_CASH_ACC","itemId":"isCashAcc"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"现金流量","hidden":"true","dataIndex":"IS_CASH_ITEM","itemId":"isCashItem"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"账簿级科目ID","hidden":"true","dataIndex":"LD_ACC_ID","itemId":"ldAccId"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"科目余额方向","hidden":"true","dataIndex":"BD","titleAlign":"center","itemId":"BD","renderer":"if(value == '1'){\n  return '借' ;\n}else if(value == '-1'){\n  return '贷' ;\n}else{\n  return value ;\n}"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"预算项目ID","hidden":"true","dataIndex":"BG_ITEM_ID","itemId":"BG_ITEM_ID"},"children":[],"expanded":false,"type":"column"}],"expanded":false,"type":"array"}],"expanded":true,"type":"grid"},{"configs":{"region":"south","hidden":"true","border":"false","itemId":"segFrom","bodyPadding":"9"},"children":[{"configs":{"height":"30","layout":"column","columnWidth":"1","border":"false","itemId":"tr_1"},"children":[{"configs":{"layout":"fit","columnWidth":".4","border":"false","itemId":"td1"},"children":[{"configs":{"labelWidth":"100","readOnly":"true","labelAlign":"right","itemId":"cashCode","fieldLabel":"{#cashItems#}"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"cashId","fieldLabel":"现金流量项ID"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".6","border":"false","itemId":"td2"},"children":[{"configs":{"displayField":"CA_DISPLAY_NAME","valueField":"CA_ID","margin":"0 10 0 0","itemId":"cashItems"},"events":{"change":"\n\n","beforequery":"// TODO: 对下拉框增加模糊查询处理\nvar combo = plan.combo ;\nif(!plan.forceAll){\n  var value = plan.query;\n  combo.store.filterBy(function(record,id){\n    var text = record.get(combo.displayField);\n    return (text.indexOf(value)!=-1);\n  });\n  combo.expand();\n  return false;\n}","select":"var ca_code = records[0].data.CA_CODE ;\nvar _ca_name = records[0].data.CA_NAME ;\nvar ca_id = records[0].data.CA_ID ;\napp.cashCode.setValue(ca_code);\napp.cashId.setValue(ca_id) ;\napp.cashItems.setRawValue(_ca_name);"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/gl/journal/data-db/ccid-data/select-cash-items"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":false,"type":"form"}],"expanded":true,"type":"panel"},{"configs":{"region":"east","width":"450","layout":"border","itemId":"segValPanel"},"children":[{"configs":{"region":"north","pagingBar":"false","title":"{#segmentGridTitle#}","height":"200","selType":"rowmodel","itemId":"segmentGrid","border":"false","forceFit":"true","editable":"true"},"events":{"tagEvents":"'cellclick' : function(view,td,cellIndex,record,tr,rowIndex,e,opts){\n  if(cellIndex == 5){   \n    \n  }\n}\n"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/gl/journal/data-db/ccid-data/select-ld-acc-ass-seg"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"序号","hidden":"true","xtype":"rownumberer","width":"60","align":"center","titleAlign":"center","itemId":"rownum"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"辅助段编码","hidden":"true","dataIndex":"SEG_CODE","titleAlign":"center","itemId":"SEG_CODE"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#SEG_NAME#}","width":"120","dataIndex":"SEG_NAME","titleAlign":"center","itemId":"SEG_NAME"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"值ID","hidden":"true","dataIndex":"SEG_VAL_ID","itemId":"SEG_VAL_ID"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"值编码","hidden":"true","dataIndex":"SEG_VAL_CODE","itemId":"SEG_VAL_CODE"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#SEG_VAL_NAME#}","width":"220","dataIndex":"SEG_VAL_NAME","titleAlign":"center","itemId":"SEG_VAL_NAME"},"children":[{"configs":{"triggerCls":"x-form-search-trigger","itemId":"editor","editable":"false"},"events":{"expand":"// 清空表格\napp.pickComp.getStore().removeAll() ;\n\n// TODO: 取得当前Grid的选中行\nvar r = app.segmentGrid.getSelection() ;\n// TODO: 获取辅助段编码\nvar segCode = r[0].data.SEG_CODE ; \n// TODO: 后去账簿ID\nvar ledgerId = '{#ledgerId#}';\nvar dbType = '{#dbType#}' ;\n\n// TODO: 为下拉框生成下拉SQL语句信息\nvar sqlStr ;\nif(segCode === 'XC_AP_VENDORS'){ \n  /** @property {type} name 供应商信息 */\n  sqlStr = ' select \\''+ segCode +'\\' as SEG_CODE, a.VENDOR_ID VAL_ID,a.VENDOR_CODE VAL_CODE,a.VENDOR_NAME  VAL_NAME ' +\n           ' from xc_ap_vendors a,xc_gl_ld_vendors b where a.vendor_id = b.vendor_id ' ;\n  if(dbType == 'mysql'){\n    sqlStr = sqlStr + ' and b.IS_ENABLED = 1 and b.LEDGER_ID = \\'' + ledgerId +'\\'' +\n               ' and a.START_DATE <= NOW() and a.END_DATE >= NOW()  ' ;\n  }else if(dbType == 'oracle'){\n      sqlStr = sqlStr + ' and b.IS_ENABLED = 1 and b.LEDGER_ID = \\'' + ledgerId +'\\'' +\n               ' and a.START_DATE <= sysdate and a.END_DATE >= sysdate  ' ;\n  }else{\n  }  \n\n}else if(segCode === 'XC_AR_CUSTOMERS'){\n  /** @property {type} name 客户信息 */\n  sqlStr = ' select \\''+ segCode +'\\' as SEG_CODE, a.CUSTOMER_ID VAL_ID,a.CUSTOMER_CODE VAL_CODE,a.CUSTOMER_NAME  VAL_NAME '+\n           ' from xc_ar_customers a,xc_gl_ld_customers b where a.CUSTOMER_ID = b.CUSTOMER_ID ' ;\n  if(dbType == 'mysql'){\n    sqlStr = sqlStr + ' and b.IS_ENABLED = 1 and b.LEDGER_ID = \\'' + ledgerId +'\\'' +\n               ' and a.START_DATE <= NOW() and a.END_DATE >= NOW()  ' ;\n  }else if(dbType == 'oracle'){\n      sqlStr = sqlStr + ' and b.IS_ENABLED = 1 and b.LEDGER_ID = \\'' + ledgerId +'\\'' +\n               ' and a.START_DATE <= sysdate and a.END_DATE >= sysdate  ' ;\n  }else{\n  } \n\n}else if(segCode === 'XC_GL_PRODUCTS'){\n  /** @property {type} name 产品信息 */\n  sqlStr = ' select \\''+ segCode +'\\' as SEG_CODE, a.PRODUCT_ID VAL_ID,a.PRODUCT_CODE VAL_CODE,a.PRODUCT_NAME VAL_NAME ' +\n           ' from xc_gl_products a,xc_gl_ld_products b where a.PRODUCT_ID = b.PRODUCT_ID ' ;\n  if(dbType == 'mysql'){\n    sqlStr = sqlStr + ' and b.IS_ENABLED = 1 and b.LEDGER_ID = \\'' + ledgerId +'\\'' +\n               ' and a.START_DATE <= NOW() and a.END_DATE >= NOW()  ' ;\n  }else if(dbType == 'oracle'){\n      sqlStr = sqlStr + ' and b.IS_ENABLED = 1 and b.LEDGER_ID = \\'' + ledgerId +'\\'' +\n               ' and a.START_DATE <= sysdate and a.END_DATE >= sysdate  ' ;\n  }else{\n  }  \n\n}else if(segCode === 'XC_PM_PROJECTS'){\n  /** @property {type} name 项目信息 */\n  sqlStr = ' SELECT \\''+ segCode +'\\' as SEG_CODE, A.PROJECT_ID VAL_ID,A.PROJECT_CODE VAL_CODE,A.PROJECT_NAME VAL_NAME ' +\n           ' FROM XC_PM_PROJECTS A WHERE A.LEDGER_ID = \\'' + ledgerId + '\\'' +\n           ' and not exists (select 1 from XC_PM_PROJECTS b where b.UP_PROJECT_ID = a.PROJECT_ID)';\n  if(dbType == 'mysql'){ \n    sqlStr = sqlStr + ' and a.start_date <= NOW() and a.end_date >= NOW() ' ;\n  }else if(dbType == 'oracle'){\n    sqlStr = sqlStr + ' and a.start_date <= sysdate and a.end_date >= sysdate ' ;\n  }else{\n  }\n}else if(segCode === 'XIP_PUB_ORGS'){\n  /** @property {type} name 内部往来 */\n  sqlStr = ' SELECT \\''+ segCode +'\\' as SEG_CODE, A.ORG_ID VAL_ID ,A.ORG_CODE VAL_CODE,A.ORG_NAME VAL_NAME ' +\n           ' FROM XIP_PUB_ORGS A ,XC_GL_LD_ORGS B WHERE A.ORG_ID = B.ORG_ID AND B.IS_ENABLED = 1  AND A.ENABLE_FLAG = \\'Y\\''+\n           ' AND B.LEDGER_ID = \\'' + ledgerId + '\\'' ;\n  \n}else if(segCode === 'XIP_PUB_DEPTS'){\n  /** @property {type} name 成本中心 */\n  sqlStr = ' SELECT \\''+ segCode +'\\' as SEG_CODE, A.DEPT_ID VAL_ID ,A.DEPT_CODE VAL_CODE,A.DEPT_NAME VAL_NAME ' +\n           ' FROM XIP_PUB_DEPTS A ,XC_GL_LD_DEPTS B WHERE A.DEPT_ID = B.DEPT_ID AND B.IS_ENABLED = 1  AND A.ENABLE_FLAG = \\'Y\\''+\n           ' AND B.LEDGER_ID = \\'' + ledgerId + '\\'' ;  \n  \n}else if(segCode === 'XIP_PUB_EMPS'){\n  /** @property {type} name 个人往来 */\n  sqlStr = ' SELECT \\''+ segCode +'\\' as SEG_CODE, A.EMP_ID VAL_ID ,A.EMP_CODE VAL_CODE,A.EMP_NAME VAL_NAME ' +\n           ' FROM XIP_PUB_EMPS A ,XC_GL_LD_EMPS B WHERE A.EMP_ID = B.EMP_ID AND B.IS_ENABLED = 1  AND A.ATTRIBUTE2 = \\'Y\\''+\n           ' AND B.LEDGER_ID = \\'' + ledgerId + '\\'' ;    \n  \n}else{\n  /** @property {type} name 自定义辅助段 */\n  sqlStr = ' SELECT \\''+ segCode +'\\' as SEG_CODE, t.LD_CUST_SEGVAL_ID VAL_ID,t.LD_CUST_SEGVAL_CODE VAL_CODE,t.LD_CUST_SEGVAL_NAME VAL_NAME ' + \n           ' FROM XC_GL_LD_CUST_ASS_SEGVALS T WHERE T.LEDGER_ID = \\'' + ledgerId + '\\'' + \n           ' AND T.SEG_CODE = \\'' + segCode + '\\'' +\n           ' AND T.IS_LEAF = \\'Y\\'' ;\n  if(dbType == 'mysql'){\n    sqlStr = sqlStr + ' AND T.START_DATE <= NOW() AND T.END_DATE >= NOW()  ' ;\n  }else if(dbType == 'oracle'){\n      sqlStr = sqlStr + ' AND T.START_DATE <= sysdate AND T.END_DATE >= sysdate  ' ;\n  }else{\n  }   \n}\n\n// TODO: SQL赋值\napp.pickComp.getStore().proxy.extraParams.sqlStr = sqlStr ;\napp.pickComp.getStore().proxy.extraParams.cstr = '%' ;\n\n//  加载数据\napp.pickComp.getStore().load() ;\n"},"children":[{"configs":{"tagConfigs":"minWidth:450","height":"350","forceFit":"true","itemId":"pickComp"},"events":{"itemclick":"// TODO: 获取当前下拉框的选中行信息\nvar seg_val_id = record.get('VAL_ID') ;\nvar seg_val_code = record.get('VAL_CODE') ;\nvar seg_value_name = record.get('VAL_NAME') ;\nvar seg_code = record.get('SEG_CODE') ;\n\n// TODO: 将选中行信息赋予表格行信息\nvar r = app.segmentGrid.getSelectionModel().getSelection() ;\nr[0].set('SEG_VAL_ID',seg_val_id) ;\nr[0].set('SEG_VAL_CODE',seg_val_code) ;\nr[0].set('SEG_VAL_NAME', seg_value_name) ;\n\napp.editor.setValue(seg_value_name) ;\n\n// 设置预算成本中心和项目信息\nif(seg_code === 'XIP_PUB_DEPTS'){\n  Wb.setValue(app.bgFrom,{'deptId':seg_val_id,'depts':seg_value_name}) ;\n  \n}else if(seg_code === 'XC_PM_PROJECTS'){\n  Wb.setValue(app.bgFrom,{'projectId':seg_val_id,'projects':seg_value_name}) ;\n  \n}else{\n  // 不设置\n}\n\n// 隐藏picker\nvar picker = this.ownerCmp;\npicker.collapse();\n\n// TODO: 计算科目余额信息\nvar r = app.accountGrid.getSelection()[0] ;\nvar acc_id = r.data.ACC_ID ; // 科目ID\nvar cnyCode = r.data.CNY_CODE ; // 币种\nvar segments = Wb.getData(app.segmentGrid) ;\t// 辅助段\nvar segTotal = app.segmentGrid.store.getCount() ;\n\ngetAccBalance('{#ledgerId#}',acc_id,segments,segTotal,cnyCode) ; // 计算余额\n"},"children":[{"configs":{"itemId":"tbar"},"children":[{"configs":{"width":"300","itemId":"valCodeOrName"},"events":{"change":"// 动态筛选\nvar store = app.pickComp.getStore() ;\nstore.filterBy(function(record,id){\n  var _code = record.get('VAL_CODE');\n  var _name = record.get('VAL_NAME');\n  var text = _code + _name ;\n  return (text.indexOf(newValue)!=-1);\n});","specialkey":"// 支持回车事件\nif(e.keyCode == e.ENTER){\n  app.btnQry.fireEvent('click') ;\n}"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"btnQry","iconCls":"seek_icon"},"events":{"click":"// 点击查询\nvar cstr = app.valCodeOrName.getValue() ;\ncstr = '%' + cstr + '%' ;\napp.pickComp.getStore().load({params:{'cstr':cstr}}) ;"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/gl/journal/data-db/new-voucher-data/select-ld-ass-segval"},"events":{"beforeload":"\n\n"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"辅助编码","hidden":"true","dataIndex":"SEG_CODE","titleAlign":"center","itemId":"SEG_CODE"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"VAL_ID","hidden":"true","dataIndex":"VAL_ID","titleAlign":"center","itemId":"VAL_ID"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#VAL_CODE#}","width":"120","dataIndex":"VAL_CODE","titleAlign":"center","itemId":"VAL_CODE"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#VAL_NAME#}","width":"280","dataIndex":"VAL_NAME","titleAlign":"center","itemId":"VAL_NAME"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":true,"type":"column"},{"configs":{"hidden":"true","xtype":"actioncolumn","width":"30","itemId":"ADD_SEG_VAL"},"children":[{"configs":{"itemId":"items"},"children":[{"configs":{"itemId":"addSegVal","iconCls":"seek_icon"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"array"}],"expanded":true,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"},{"configs":{"region":"center","title":"{#bgFromTitle#}","hidden":"false","border":"false","itemId":"bgFrom","bodyPadding":"9"},"children":[{"configs":{"layout":"fit","columnWidth":"1","border":"false","itemId":"tr1"},"children":[{"configs":{"readOnly":"true","hidden":"true","itemId":"bgItemId","fieldLabel":"预算项目ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"90","readOnly":"true","margin":"0 10 5 0","labelAlign":"right","itemId":"bgItemName","fieldLabel":"{#bgItemName#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":"1","border":"false","itemId":"tr2"},"children":[{"configs":{"hidden":"true","itemId":"projectId","fieldLabel":"项目ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"90","height":"450","triggerCls":"x-form-search-trigger","margin":"0 10 5 0","labelAlign":"right","itemId":"projects","fieldLabel":"{#projects#}","editable":"false","disabled":"true"},"events":{"expand":"app.findProjects.fireEvent('click') ;"},"children":[{"configs":{"height":"300","forceFit":"true","itemId":"pickComp"},"events":{"itemclick":"app.projectId.setValue(record.data.PROJECT_ID) ;\napp.projects.setValue(record.data.PROJECT_NAME) ;\n\n// 隐藏picker\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"itemId":"tbar"},"children":[{"configs":{"width":"300","emptyText":"按项目编码或名称查询","itemId":"prjCodeOrName"},"events":{"specialkey":"// 监控回车事件\nif(e.getKey() == 13){\n  app.findProjects.fireEvent('click') ;\n}"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"findProjects","iconCls":"seek_icon"},"events":{"click":"app.pickComp.getStore().load() ;"},"children":[],"expanded":false,"type":"button"},{"configs":{"itemId":"cancelPrjData","iconCls":"cancel_icon","tooltip":"清空已选择数据"},"events":{"click":"app.projectId.setValue() ;\napp.projects.setValue()　;\napp.prjCodeOrName.setValue() ;\napp.findProjects.fireEvent('click') ;\napp.pickComp.hide() ;"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"store","url":"m?xwl=xc/com-qry/gl-segments/select-ld-projects"},"events":{"beforeload":"store.proxy.extraParams.ledgerId = '{#ledgerId#}' ;\nstore.proxy.extraParams.textStr = app.prjCodeOrName.getValue() ;"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"序号","align":"center","xtype":"rownumberer","width":"50","itemId":"rownum"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"项目ID","hidden":"true","dataIndex":"PROJECT_ID","itemId":"PROJECT_ID"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"编码","dataIndex":"PROJECT_CODE","itemId":"PROJECT_CODE"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"名称","dataIndex":"PROJECT_NAME","itemId":"PROJECT_NAME"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":false,"type":"picker"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":"1","border":"false","itemId":"tr3"},"children":[{"configs":{"hidden":"true","itemId":"deptId","fieldLabel":"成本中心ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"90","triggerCls":"x-form-search-trigger","margin":"0 10 5 0","labelAlign":"right","itemId":"depts","fieldLabel":"{#depts#}","disabled":"true","editable":"false"},"events":{"expand":"app.findDepts.fireEvent('click') ;"},"children":[{"configs":{"height":"300","forceFit":"true","itemId":"pickComp"},"events":{"itemclick":"app.deptId.setValue(record.data.DEPT_ID) ;\napp.depts.setValue(record.data.DEPT_NAME) ;\n\n// 隐藏picker\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/com-qry/gl-segments/select-ld-depts"},"events":{"beforeload":"store.proxy.extraParams.ledgerId = '{#ledgerId#}' ;\nstore.proxy.extraParams.textStr = app.deptCodeOrName.getValue() ;"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"width":"300","emptyText":"按成本中心编码或名称查询","itemId":"deptCodeOrName"},"events":{"specialkey":"// 监控回车事件\nif(e.getKey() == 13){\n  app.findDepts.fireEvent('click') ;\n}"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"findDepts","iconCls":"seek_icon"},"events":{"click":"app.pickComp.getStore().load() ;"},"children":[],"expanded":false,"type":"button"},{"configs":{"itemId":"cancelDeptData","iconCls":"cancel_icon","tooltip":"清空已选择数据"},"events":{"click":"app.deptCodeOrName.setValue() ;\napp.deptId.setValue() ;\napp.depts.setValue() ;\napp.findDepts.fireEvent('click') ;\napp.pickComp.hide() ;"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"序号","align":"center","width":"50","xtype":"rownumberer","itemId":"rownum"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"ID","hidden":"true","dataIndex":"DEPT_ID","itemId":"DEPT_ID"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"编码","dataIndex":"DEPT_CODE","itemId":"DEPT_CODE"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"名称","dataIndex":"DEPT_NAME","itemId":"DEPT_NAME"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":false,"type":"picker"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"form"},{"configs":{"region":"south","pagingBar":"false","title":"{#balanceGridTitle#}","height":"150","itemId":"balanceGrid","border":"false","forceFit":"true","viewConfig":"{\n enableTextSelection:true\n}"},"children":[{"configs":{"autoLoad":"false","itemId":"store","url":"m?xwl=xc/gl/journal/data-db/ccid-data/select-acc-balance"},"events":{"beforeload":"store.proxy.extraParams.balLedgerId = '{#ledgerId#}' ;\nstore.proxy.extraParams.balCode = '{#balPeriodCode#}' ;\n"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"序号","hidden":"true","width":"40","xtype":"rownumberer","align":"center","titleAlign":"center","itemId":"rownum"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#CURRENCY#}","width":"80","dataIndex":"CURRENCY","titleAlign":"center","itemId":"CURRENCY"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#BALANCE#}","width":"150","align":"right","dataIndex":"BALANCE","titleAlign":"center","format":"0,000.00","itemId":"BALANCE"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#T_BALANCE#}","width":"150","align":"right","dataIndex":"T_BALANCE","titleAlign":"center","format":"0,000.00","itemId":"T_BALANCE"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":false,"type":"grid"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"window"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":"window_icon"}