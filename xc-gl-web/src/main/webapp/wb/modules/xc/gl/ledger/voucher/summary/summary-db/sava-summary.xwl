{"inframe":false,"title":"保存摘要","hidden":false,"roles":{"default":1},"children":[{"configs":{"loginRequired":"false","serverScript":"var id, ids = [];\nvar resc=Wb.decode(request.getParameter('create'));\nvar resc1=Wb.decode(request.getParameter('update'));\n//\nWb.each(resc, function(rec) {\n  app.run('select 1 from XC_GL_V_SUMMARIES where V_SUMMARY= \"'+rec.V_SUMMARY+'\" and LEDGER_ID = \"'+rec.LEDGER_ID+'\"', {\n  errorText: '该账簿下此摘要信息已经存在。'\n   });\n   id = java.util.UUID.randomUUID();\n//   rec.ASS_KEY=getAssKey(rec.V_SUMMARY);\n  rec.V_SUMMARY_ID = id;\n//   rec.LEDGER_ID =request.getParameter(\"ledger_id\");\n  ids.push({\n    V_SUMMARY_ID: id\n  });\n\n});\n\nWb.each(resc1, function(rec) {\n  app.run('select 1 from XC_GL_V_SUMMARIES where V_SUMMARY= \"'+rec.V_SUMMARY+'\" and LEDGER_ID = \"'+rec.LEDGER_ID+'\" and V_SUMMARY_ID <> \"'+rec.V_SUMMARY_ID+'\" ', {\n  errorText: '该账簿下此摘要信息已经存在。'\n   });\n   //rec.ASS_KEY=getAssKey(rec.V_SUMMARY);\n});\nrequest.setAttribute('create', Wb.encode(resc));\nrequest.setAttribute('update', Wb.encode(resc1));\n//Wb.error('aa');\n//默认使用app.update操作都在同一个数据库事务内\napp.update({\n  tableName: 'xc_gl_v_summaries'\n});\napp.send(ids); //把create中包含的数据（主要更新V_CATEGORY_ID）发送到客户端以同步到表格\n","itemId":"module"},"children":[],"expanded":false,"type":"module"}],"pageLink":"","iconCls":""}