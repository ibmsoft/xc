{"inframe":false,"title":"修改规则表","hidden":false,"roles":{"default":1},"children":[{"configs":{"loginRequired":"false","serverScript":"var rules = request.getParameter(\"rules\");\nvar v_rules = Wb.decode(rules);\nvar ruleDtls = request.getParameter(\"ruleDtls\");\nvar v_ruleDtls = Wb.decode(ruleDtls);\nvar deleteDtl = request.getParameter(\"deleteRuleDtl\");\nvar v_deleteDtl = Wb.decode(deleteDtl);\n//var out = java.lang.System.out;\nif(v_rules!=null){\n  var ruleCode = v_rules.RULE_CODE;\n  var length = v_rules.SERIAL_LENGTH;\n  var category = v_rules.SERIAL_CATEGORY;\n  var prefix = v_rules.FIXED_PREFIX;\n  var updateRule = 'update XC_GL_RULES set FIXED_PREFIX=\"'+prefix+'\",SERIAL_LENGTH=\"'+length+'\",SERIAL_CATEGORY=\"'+category+'\",LAST_UPDATE_DATE={?timestamp.sys.date?},LAST_UPDATED_BY={?XIP.userId?} where RULE_CODE=\"'+ruleCode+'\"';\n  app.run(updateRule,{});\n}\n  \t\n\nWb.each(v_ruleDtls,function(record){\n  \tvar dtlId = record.DTL_ID;\n  \tvar ruleCode = record.RULE_CODE;\n  \tvar dtlCode = record.DTL_CODE;\n  \tvar separator = record.DTL_SEPARATOR;\n  \tvar orderBy = record.ORDERBY;\n  \n  \tvar selectRuleDtl = 'select DTL_ID from XC_GL_RULE_DTL where DTL_ID=\"'+dtlId+'\" and RULE_CODE=\"'+ruleCode+'\"';\n  \tvar updateRuleDtl = 'update XC_GL_RULE_DTL set DTL_CODE=\"'+dtlCode+'\",DTL_SEPARATOR=\"'+separator+'\",ORDERBY=\"'+orderBy+'\",LAST_UPDATE_DATE={?timestamp.sys.date?},LAST_UPDATED_BY={?XIP.userId?} where DTL_ID=\"'+dtlId+'\"';\n \tvar insertRuleDtl = 'insert into XC_GL_RULE_DTL(DTL_ID,RULE_CODE,DTL_CODE,DTL_SEPARATOR,ORDERBY,CREATION_DATE,CREATED_BY,LAST_UPDATE_DATE,LAST_UPDATED_BY) values(\"'+java.util.UUID.randomUUID()+'\",\"'+ruleCode+'\",\"'+dtlCode+'\",\"'+separator+'\",\"'+orderBy+'\",{?timestamp.sys.date?},{?XIP.userId?},{?timestamp.sys.date?},{?XIP.userId?})';\n  \n  \tif(!app.run(selectRuleDtl,{}).next()){\n      app.run(insertRuleDtl,{});\n    }else{\n       app.run(updateRuleDtl,{});\n    }\t\n});\n\nWb.each(v_deleteDtl,function(recp){\n\tvar dtl_id = recp.DTL_ID;\n  \tvar rule_Code = recp.RULE_CODE;\n  \tvar deleteSql = 'delete from XC_GL_RULE_DTL where DTL_ID=\"'+dtl_id+'\" and RULE_CODE=\"'+rule_Code+'\"';\n  \tapp.run(deleteSql,{});\n});\n\t","itemId":"module"},"children":[],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}