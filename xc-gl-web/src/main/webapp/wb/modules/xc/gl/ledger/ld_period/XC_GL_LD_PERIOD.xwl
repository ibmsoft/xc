{"inframe":false,"title":"账薄会计期管理","hidden":false,"roles":{"default":1},"children":[{"configs":{"title":"账薄会计期管理","loginRequired":"false","serverScript":"//---------------------获取当前模块语言对应的.json文件，放到request中----------------\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xc/gl/ledger/ld_period/XC_GL_LD_PERIOD\");\n\nvar ctx = request.getContextPath();\nrequest.setAttribute(\"contextPath\",ctx);","itemId":"module"},"events":{"initialize":"var ledgerArray = [];//存储所有账薄信息  暂时未用\nvar start_period_code;//存储账薄的开始会计期\nvar ledger_id;//存储账薄的ID\nvar statuArray = [];//存放账薄的会计期的状态\n\nvar ledger_flag = false;//区分账簿下拉选择框的单击事件与选择事件\n//var period_flag = false;\n\n\n"},"children":[{"configs":{"itemId":"storeFolder"},"children":[{"configs":{"pageSize":"-1","itemId":"query_period_store","url":"m?xwl=xc/gl/ledger/ld_period/ld_period_db/select_period"},"children":[],"expanded":false,"type":"store"},{"configs":{"pageSize":"-1","autoLoad":"false","itemId":"query_ld_period_store","url":"m?xwl=xc/gl/ledger/ld_period/ld_period_db/select_ld_period"},"children":[],"expanded":true,"type":"store"},{"configs":{"pageSize":"-1","autoLoad":"true","itemId":"query_ld_period_statu","url":"m?xwl=xc/gl/ledger/ld_period/ld_period_db/select_ld_period_status"},"events":{"success":"statuArray = [];\nvar count=store.getCount();\nfor(var i=0;i<count;i++){\n\tstatuArray.push(store.getAt(i).data);\n}"},"children":[],"expanded":false,"type":"store"},{"configs":{"pageSize":"-1","itemId":"query_v_heads","url":"m?xwl=xc/gl/ledger/ld_period/ld_period_db/select_v_heads"},"events":{"success":"/*\nvar row = app.ld_period_grid.getSelectionModel().getSelection();\nvar period_code = row[0].data.period_code;//获取当前行的编码\n\nvar temp_year = app.query_ld_period_year.getValue();\nvar temp_ledger_id = app.query_ledger.getValue();//获取账薄的主键\n\nvar count = store.getCount();\nif(count>0) {//表示凭证处对应的账薄会计期的记账人有为空，此时不能切换，不满足关闭的条件\n  Ext.MessageBox.alert('提示','对应的凭证有不符合条件处，请重新核对！');\n  app.query_ld_period_store.load({\n    params:{\n      ledger_id:temp_ledger_id,\n      period_code : temp_year\n    }\n  });\n}\nelse {\n  Wb.request({ //修改至关闭状态\n    url: 'm?xwl=xc/gl/ledger/ld_period/ld_period_db/update_ld_period_statu',\n    params:{ledger_id:temp_ledger_id,period_code:period_code,statu:2},\n    success:function(){\n      app.query_ld_period_store.load({\n        params:{\n          ledger_id:temp_ledger_id,\n          period_code : temp_year\n        }\n      });\n    }\n  });\n}\n*/"},"children":[],"expanded":false,"type":"store"},{"configs":{"pageSize":"-1","itemId":"appendAdjustPeriodStore","url":"m?xwl=xc/gl/ledger/ld_period/ld_period_db/queryAdjustPeriod"},"events":{"load":"  app.addAdjustWindow.setTitle(app.query_ledger.getRawValue()+'\u2014追加调整期');\n  app.addAdjustWindow.show();","beforeload":"store.getProxy().extraParams.queryPeriodCode = app.queryPeriodCode.getValue();"},"children":[],"expanded":false,"type":"store"}],"expanded":false,"type":"folder"},{"configs":{"layout":"border","itemId":"viewport1"},"children":[{"configs":{"region":"north","layout":"column","bodyPadding":"10","border":"false","itemId":"query_form"},"children":[{"configs":{"layout":"fit","columnWidth":".3","border":"false","itemId":"td1"},"children":[{"configs":{"labelWidth":"60","displayField":"LEDGER_NAME","valueField":"LEDGER_ID","labelAlign":"right","itemId":"query_ledger","fieldLabel":"{#query_ledger#}","selectOnFocus":"true","editable":"false"},"events":{"beforequery":"// var combo = plan.combo ;\n// if(!plan.forceAll){\n//   var flag = false;\n//   var value = plan.query;\n//   combo.store.filterBy(function(record,id){\n//     var text = record.get(combo.displayField);\n//     return (text.indexOf(value)!=-1);\n//   });\n//   combo.expand();\n//   return false;\n// }","select":"app.query_ld_period_year.setValue();//清空年度\n\nif(!ledger_flag)\n   app.queryBtn.fireEvent('click');\nledger_flag = false;"},"children":[{"configs":{"pageSize":"-1","autoLoad":"true","itemId":"store","url":"m?xwl=xc/com-qry/gl-ledgers/select-sec-fd-ledgers"},"events":{"success":"//存储所有账薄信息：为了后面获取账薄的开始会计期。\nledgerArray = [];\nvar count=store.getCount();\nfor(var i=0;i<count;i++) {\n\tledgerArray.push(store.getAt(i).data);\n}\n"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".15","border":"false","itemId":"td2"},"children":[{"configs":{"labelWidth":"60","displayField":"YEAR","valueField":"YEAR","labelAlign":"right","itemId":"query_ld_period_year","fieldLabel":"{#query_ld_period_year#}"},"events":{"afterrender":"// 设置显示当前年度\n// app.query_ld_period_year.setValue(Ext.Date.format(new Date(),'Y'));","beforequery":"var combo = plan.combo ;\nif(!plan.forceAll){\n  var flag = false;\n  var value = plan.query;\n  combo.store.filterBy(function(record,id){\n    var text = record.get(combo.displayField);\n    return (text.indexOf(value)!=-1);\n  });\n  combo.expand();\n  return false;\n}","select":"var temp_year = combo.getValue();\nledger_id = app.query_ledger.getValue();\n\napp.query_ld_period_store.load({\n\tparams:{\n    ledger_id:ledger_id,\n    year : temp_year\n    }\n});","specialkey":"if(e.getKey()===13){\n\n  var temp_year = app.query_ld_period_year.getValue();\n  ledger_id = app.query_ledger.getValue();\n\n  app.query_ld_period_store.load({\n    params:{\n      ledger_id:ledger_id,\n      year : temp_year\n    }\n  });\n}"},"children":[{"configs":{"pageSize":"-1","itemId":"store","url":"m?xwl=xc/gl/ledger/ld_period/ld_period_db/select_ld_period_year"},"events":{"beforeload":"//动态传递参数\nExt.apply(store.proxy.extraParams,{ledger_id:ledger_id});    "},"children":[],"expanded":false,"type":"store"}],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"layout":"column","columnWidth":".2","border":"false","itemId":"td3"},"children":[{"configs":{"text":"{#queryBtn#}","margin":"0 0 0 20","itemId":"queryBtn","iconCls":"seek_icon"},"events":{"click":"var temp_year = app.query_ld_period_year.getValue();\nledger_id = app.query_ledger.getValue();\n\nif(ledger_id==='' || ledger_id===null) {\n   Ext.MessageBox.alert('提示','请先选择账薄信息！');\n   return;\n}\n\napp.query_ld_period_store.load({\n  params:{\n    ledger_id:ledger_id,\n    year : temp_year\n  }\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#resetBtn#}","margin":"0 0 0 10","itemId":"resetBtn","iconCls":"refresh_icon"},"events":{"click":"app.query_ledger.reset();\napp.query_ld_period_year.reset();\n//设置显示当前年度\n// app.query_ld_period_year.setValue(Ext.Date.format(new Date(),'Y'));\napp.query_ld_period_store.load();"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"panel"}],"expanded":false,"type":"form"},{"configs":{"region":"center","store":"app.query_ld_period_store","itemId":"ld_period_grid","editable":"true"},"children":[{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"追加期间","hidden":"true","itemId":"add_ld_period","iconCls":"file_add_icon"},"events":{"click":"ledger_id = app.query_ledger.getValue();\n\nif(ledger_id===null||ledger_id===''){\n    Ext.Msg.alert('提示', '请先选择账薄!');\n    return;\n}\n\n//获取账薄的开始会计期\nfor(var i=0;i<ledgerArray.length;i++)  {\n\tif(ledger_id===ledgerArray[i].LEDGER_ID)\n      start_period_code=ledgerArray[i].START_PERIOD_CODE;\n}\n\n//判断此账薄的开始会计期是否为空，并未设置\nif(start_period_code===''||start_period_code===null) {\n    Ext.MessageBox.alert('提示','此账薄还未设置开始会计期，请先设置账薄的开始会计期');\n    return;\n}\n\napp.query_period_store.load({\n\tparams:{\n      ledger_id:ledger_id,\n      period_code:start_period_code\n    }\n});\n\napp.add_period_win.show();\napp.add_period_win.setTitle(app.query_ledger.getRawValue()+'\u2014\u2014追加会计期');"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#add_next_ld_period#}","itemId":"add_next_ld_period","iconCls":"file_add_icon"},"events":{"click":"var ledger_id = app.query_ledger.getValue();\n\nif(ledger_id===null||ledger_id===''){\n    Ext.Msg.alert('提示', '请先选择账薄!');\n    return;\n}\nvar ledgerRecord = app.query_ledger.findRecord(\"LEDGER_ID\",ledger_id);\nvar startPeriodCode = ledgerRecord.data.START_PERIOD_CODE;\n//判断此账薄的开始会计期是否为空，并未设置\nif(Ext.isEmpty(startPeriodCode)) {\n  Wb.info(\"账薄未设置开始会计期，请先设置账薄的开始会计期！\");\n  return;\n}\nWb.request({\n   url:'{#contextPath#}/ledgerPeriodManageAction.do?method=appendLedgerPeriod',\n   params:{'ledgerId':ledger_id,startPeriod:startPeriodCode},\n   success:function(response,opts){\n     var returnObj = Wb.decode(response.responseText);\n     Wb.info(returnObj.msg);\n     app.query_ld_period_store.load({\n       params:{\n         ledger_id:ledger_id,\n         year : ''\n       }\n     });\n   }\n});\n"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#addAdjustPeriod#}","itemId":"addAdjustPeriod","iconCls":"file_add_icon"},"events":{"click":"var ledger_id = app.query_ledger.getValue();\n\nif(ledger_id===null||ledger_id===''){\n    Ext.Msg.alert('提示', '请先选择账薄!');\n    return;\n}\nvar ledgerRecord = app.query_ledger.findRecord(\"LEDGER_ID\",ledger_id);\nvar startPeriodCode = ledgerRecord.data.START_PERIOD_CODE;\n//判断此账薄的开始会计期是否为空，并未设置\nif(Ext.isEmpty(startPeriodCode)) {\n  Wb.info(\"账薄未设置开始会计期，请先设置账薄的开始会计期！\");\n  return;\n}\napp.appendAdjustPeriodStore.load({\n  params:{\n     'startPeriodCode':startPeriodCode,\n     'ledgerId':ledger_id\n  }\n});\n\n"},"children":[],"expanded":false,"type":"item"}],"expanded":false,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#period_row#}","align":"center","width":"50","xtype":"rownumberer","titleAlign":"center","itemId":"period_row"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#ledger_id_col#}","hidden":"true","dataIndex":"LEDGER_ID","itemId":"ledger_id_col"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#period_code_col#}","width":"100","dataIndex":"PERIOD_CODE","titleAlign":"center","itemId":"period_code_col"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#year_col#}","width":"60","dataIndex":"YEAR","titleAlign":"center","itemId":"year_col"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#quarter_col#}","width":"50","dataIndex":"QUARTER","titleAlign":"center","itemId":"quarter_col"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#start_date_col#}","width":"100","dataIndex":"START_DATE","titleAlign":"center","itemId":"start_date_col"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#end_date_col#}","width":"100","dataIndex":"END_DATE","titleAlign":"center","itemId":"end_date_col"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#is_adj_period_col#}","dataIndex":"IS_ADJ_PERIOD","titleAlign":"center","itemId":"is_adj_period_col","renderer":"if(value==='N')\n  return '否';\nif(value==='Y')\n  return '是';"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#ld_period_status_col#}","width":"100","dataIndex":"LD_PERIOD_STATUS","titleAlign":"center","itemId":"ld_period_status_col","renderer":"if(value == '1'){\n  return '打开' ;\n}else if(value == '2'){\n  return '关闭' ;\n}else if(value == '3'){\n  return '永久关闭' ;\n}else{\n  return value ;\n}\n"},"children":[{"configs":{"store":"app.query_ld_period_statu","queryMode":"local","displayField":"VAL_NAME","valueField":"VAL_CODE","itemId":"editor"},"events":{"change":"/*\n\t标志说明：1表示打开状态\n             2表示关闭状态\n             3表示永久关闭状态\n*/\n\nvar row = app.ld_period_grid.getSelectionModel().getSelection();\nvar period_code = row[0].data.PERIOD_CODE;//获取当前行的编码\n\nvar temp_year = app.query_ld_period_year.getValue();\nvar temp_ledger_id = app.query_ledger.getValue();//获取账薄的主键\n\n//切换到永久关闭状态\nif(newValue===3||newValue==='3') {\n  Ext.MessageBox.confirm('警告', '一旦永久关闭后,则该账薄期间不再被打开,是否仍选择永久关闭', function(btn){\n    if (btn == 'yes'){\n       //切换至永久关闭      \n       if(oldValue==='2'||oldValue===2) {\n         Wb.request({\n            url:'m?xwl=xc/gl/ledger/ld_period/ld_period_db/check_ld_period_statu',\n            params:{     \n              ledger_id:temp_ledger_id,\n              period_code : period_code,\n              statu:newValue\n            },\n           success:function(){\n             app.query_ld_period_store.load({\n               params:{\n                 ledger_id:temp_ledger_id,\n                 period_code : temp_year\n               }\n             });\n           },\n           failure:function(){\n              app.query_ld_period_store.reload();\n           }\n           \n        });\n       }\n       else {//进行永久关闭校验:只能由关闭状态切换至永久关闭状态\n         Ext.MessageBox.alert('提示','只能是关闭状态切换至永久关闭状态，请安流程顺序操作！');\n         app.query_ld_period_store.load({\n              params:{\n                ledger_id:temp_ledger_id,\n                period_code : temp_year\n              }\n         });\n     }\n    }\n    else {\n      app.query_ld_period_store.load({\n        params:{\n          ledger_id:temp_ledger_id,\n          period_code : temp_year\n        }\n      });\n    }\n   });\n}\n\n\n//切换到关闭状态\nelse if(newValue===2||newValue==='2') {\n    app.query_ld_period_statu.load();//重新加载状态，为的是获得所有的状态名称，避免显示不全\n\t//关闭状态的校验：校验凭证表中是否存在未记账凭证（即记账人为空的数据）\n    Wb.request({\n      url:'m?xwl=xc/gl/ledger/ld_period/ld_period_db/check_ld_period_statu',\n      params:{     \n        ledger_id:temp_ledger_id,\n        period_code : period_code,\n        statu:newValue\n      },\n      success:function(){\n        app.query_ld_period_store.reload();\n      },\n      failure:function(){\n        app.query_ld_period_store.reload();\n        \n      }\n    });   \n}\n\n\n//切换至打开状态\nif(newValue===1||newValue==='1') {\n    Wb.request({\n      url:'m?xwl=xc/gl/ledger/ld_period/ld_period_db/check_ld_period_statu',\n      params:{     \n        ledger_id:temp_ledger_id,\n        period_code : period_code,\n        statu:newValue\n      },\n      success:function(){\n        app.query_ld_period_store.reload();\n      },\n      failure:function(){\n        app.query_ld_period_store.reload();\n      }\n    });   \n}\n\n","focus":"var row = app.ld_period_grid.getSelectionModel().getSelection();\nvar period_code = row[0].data.PERIOD_CODE;//获取当前行的编码\n\nvar temp_year = app.query_ld_period_year.getValue();\nvar temp_ledger_id = app.query_ledger.getValue();//获取账薄的主键\n \n//如果为永久关闭状态，则禁止修改\nif(combo.getValue()===3||combo.getValue()==='3')\nWb.request({\n    url:'m?xwl=xc/gl/ledger/ld_period/ld_period_db/check_ld_period_statu',\n    params:{     \n      ledger_id:temp_ledger_id,\n      period_code : period_code\n    }\n});\n\n//如果为关闭状态，则显示所有信息\nif(combo.getValue()===1||combo.getValue()==='1') {\n  app.query_ld_period_statu.load({\n    params:{statu:'3'}\n  });\n}\n\nif(combo.getValue()===2||combo.getValue()==='2') {\n  app.query_ld_period_statu.load();\n}\n"},"children":[],"expanded":true,"type":"combo"}],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":false,"type":"viewport"},{"configs":{"title":"追加会计期","autoShow":"false","height":"550","autoScroll":"true","width":"500","layout":"border","closeAction":"hide","buttonAlign":"center","itemId":"add_period_win","modal":"true"},"events":{"show":"app.query_period_code.setValue();","close":"//start_period_code='';\n//ledger_id='';\n\n"},"children":[{"configs":{"region":"north","border":"false","itemId":"win_query_form"},"children":[{"configs":{"title":"查询条件","frame":"true","collapsible":"true","layout":"form","border":"true","itemId":"query"},"children":[{"configs":{"tagConfigs":"baseCls:'my-panel-no-border'","frame":"true","layout":"column","border":"false","itemId":"tr1"},"children":[{"configs":{"tagConfigs":"columnWidth:0.65","labelWidth":"80","emptyText":"输入后单击回车查询","labelAlign":"left","itemId":"query_period_code","fieldLabel":"会计期"},"events":{"specialkey":"if(e.getKey()===13) {\n  app.query_period_store.load({\n    params:{\n      ledger_id:ledger_id,\n      period_code:start_period_code\n    },\n    out:app.query\n  });\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls:'my-panel-no-border'","frame":"true","layout":"column","border":"false","itemId":"tr2"},"children":[{"configs":{"tagConfigs":"columnWidth:0.65","labelWidth":"40","hidden":"true","emptyText":"输入后单击回车查询","labelAlign":"left","itemId":"year","fieldLabel":"年度"},"events":{"specialkey":"if(e.getKey()===13) {\n  \n  var temp_ledger_id = app.ledger_col.getValue();\n//获取账薄的开始会计期\nfor(var i=0;i<ledgerArray.length;i++)  {\n\tif(temp_ledger_id===ledgerArray[i].ledger_id) {\n      var start_date=ledgerArray[i].start_period_code;\n        app.query_period_store.load({\n              params:{\n                ledger_id:temp_ledger_id,\n                period_code:start_date\n              },\n              out:app.query\n            });\n        return;\n        }\n    }\n}\n  \n"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"fieldset"}],"expanded":false,"type":"form"},{"configs":{"region":"center","selType":"checkboxmodel","store":"app.query_period_store","barExportButtons":"false","barRefreshButton":"false","itemId":"period_grid"},"children":[{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"序号","width":"50","align":"center","xtype":"rownumberer","titleAlign":"center","itemId":"period_row"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"会计期","width":"70","dataIndex":"PERIOD_CODE","titleAlign":"center","itemId":"period_code_col"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"年度","width":"60","dataIndex":"YEAR","titleAlign":"center","itemId":"year_col"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"季度","width":"50","dataIndex":"QUARTER","titleAlign":"center","itemId":"quarter_col"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"开始日期","width":"80","dataIndex":"START_DATE","titleAlign":"center","itemId":"start_date_col"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"结束日期","width":"80","dataIndex":"END_DATE","titleAlign":"center","itemId":"end_date_col"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":false,"type":"grid"},{"configs":{"itemId":"buttons"},"children":[{"configs":{"text":"追加","itemId":"addBtn","iconCls":"file_add_icon"},"events":{"click":"//获取所有选择的行记录\nvar temp = app.period_grid.getSelection();\nvar add_period_code = [];\nif(temp.length===0) {\n    Ext.Msg.alert('提示', '请先选择一条需要追加的会计期间');\n    return;\n}\nelse{\n\tfor(var i=0;i<temp.length;i++) {\n        add_period_code.push(temp[i].data.PERIOD_CODE);\n    }\t\n    Wb.request({\n        url :'m?xwl=xc/gl/ledger/ld_period/ld_period_db/insert_ld_period',\n        params : {ledger_id:ledger_id,add_ld_period_array:Wb.getData(temp)},\n        success: function(){\n            Ext.Msg.alert('提示', '账薄会计期追加成功');\n            //刷新主界面显示信息\n            var temp_year = app.query_ld_period_year.getValue();\n            ledger_id = app.query_ledger.getValue();\n\n            app.query_ld_period_store.load({\n                params:{\n                ledger_id:ledger_id,\n                period_code : temp_year\n                }\n            });\n            app.add_period_win.hide();\n        }\n    });\n}\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"取消","itemId":"cancelBtn","iconCls":"cancel_icon"},"events":{"click":"app.add_period_win.hide();"},"children":[],"expanded":false,"type":"button"}],"expanded":false,"type":"array"}],"expanded":false,"type":"window"},{"configs":{"title":"{#addAdjustWindow#}","autoShow":"false","height":"550","autoScroll":"true","width":"500","layout":"border","closeAction":"hide","buttonAlign":"center","itemId":"addAdjustWindow","modal":"true"},"events":{"show":"app.query_period_code.setValue();","close":"//start_period_code='';\n//ledger_id='';\n\n"},"children":[{"configs":{"region":"north","style":"border-width:0px","border":"false","itemId":"queryForm"},"children":[{"configs":{"tagConfigs":"baseCls:'my-panel-no-border'","frame":"true","layout":"column","padding":"10","border":"false","itemId":"tr1"},"children":[{"configs":{"tagConfigs":"columnWidth:0.65","labelWidth":"60","emptyText":"输入后单击回车查询","labelAlign":"right","itemId":"queryPeriodCode","fieldLabel":"{#queryPeriodCode#}"},"events":{"specialkey":"if(e.getKey()===13) {\n var ledgerId = app.query_ledger.getValue();\n var ledgerRecord = app.query_ledger.findRecord(\"LEDGER_ID\",ledgerId);\n app.appendAdjustPeriodStore.load({\n  params:{\n     'startPeriodCode':ledgerRecord.data.START_PERIOD_CODE,\n     'ledgerId':ledgerId\n  }\n});\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"form"},{"configs":{"region":"center","multiSelect":"false","store":"app.appendAdjustPeriodStore","barExportButtons":"false","barRefreshButton":"false","itemId":"adjustPeriodGrid"},"children":[{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#period_row#}","width":"50","align":"center","xtype":"rownumberer","titleAlign":"center","itemId":"period_row"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#period_code_col#}","width":"70","dataIndex":"PERIOD_CODE","titleAlign":"center","itemId":"period_code_col"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#year_col#}","width":"60","dataIndex":"YEAR","titleAlign":"center","itemId":"year_col"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#quarter_col#}","width":"50","dataIndex":"QUARTER","titleAlign":"center","itemId":"quarter_col"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#start_date_col#}","width":"80","dataIndex":"START_DATE","titleAlign":"center","itemId":"start_date_col"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#end_date_col#}","width":"80","dataIndex":"END_DATE","titleAlign":"center","itemId":"end_date_col"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"},{"configs":{"itemId":"buttons"},"children":[{"configs":{"text":"{#addBtn#}","itemId":"addBtn","iconCls":"accept_icon"},"events":{"click":"var selectRecord = app.adjustPeriodGrid.getSelection();\nif(selectRecord.length !=1){\n  Wb.info('请选择一条记录！');\n  return false;\n}\nvar ledgerId = app.query_ledger.getValue();\nvar ledgerRecord = app.query_ledger.findRecord(\"LEDGER_ID\",ledgerId);\nWb.request({\n   url:'{#contextPath#}/ledgerPeriodManageAction.do?method=appendAdjustPeriod',\n   params:{'ledgerId':ledgerId,startPeriod:ledgerRecord.data.START_PERIOD_CODE,adjustPeriod:selectRecord[0].data.PERIOD_CODE},\n   message:'请求提交中....',\n   success:function(response,opts){\n     var returnObj = Wb.decode(response.responseText);\n     Wb.info(returnObj.msg);\n     if(returnObj.flag == '1'){\n       app.query_ld_period_store.reload();\n       app.addAdjustWindow.close();\n     }\n   }\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#cancelBtn#}","itemId":"cancelBtn","iconCls":"cancel_icon"},"events":{"click":"app.addAdjustWindow.close();"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"array"}],"expanded":true,"type":"window"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}