{"inframe":false,"title":"模板复制","hidden":true,"roles":{"dev":1},"children":[{"configs":{"serverScript":"var copyData = Wb.decode(request.getParameter('copyData'));\nvar subData = Wb.decode(request.getParameter('subData'));\nvar subArray = [];\nWb.each(copyData, function(rec) {\n  var subKey = java.util.UUID.randomUUID().toString();\n  Wb.apply(rec, {\n    JZ_TPL_ID: subKey\n  });\n  //复制明细行\n  Wb.each(subData,function(sub){\n     var key = java.util.UUID.randomUUID().toString();\n     var subUnit = {\n       'TPL_DTL_ID':key,\n       'JZ_TPL_ID':subKey,   \n       'ZC_ACC_ID':sub.ZC_ACC_ID,   \n       'SUM_ACC_ID':sub.SUM_ACC_ID,     \n       'BAL_RULE':sub.BAL_RULE,         \n       'BAL_DR':sub.BAL_DR,              \n       'ACC_SEGMENTS':sub.ACC_SEGMENTS,\n       'SUMMARY':sub.SUMMARY     \n     };\n    subArray.push(subUnit);\n  });\n});\nrequest.setAttribute('mainData', Wb.encode(copyData));\nrequest.setAttribute('subData', Wb.encode(subArray));\n\n","itemId":"module"},"children":[{"configs":{"sql":"insert into xc_gl_jz_tpl\n select  \n    {?JZ_TPL_ID?},    \n    {?JZ_TPL_ID?},  \n    a.JZ_TPL_NAME,  \n    {?LEDGER_ID?},    \n    a.V_CATEGORY_ID,\n    a.ZR_ACC_ID,    \n    a.ACC_SEGMENTS, \n    a.ZR_ACC_DR,    \n    a.SUMMARY,      \n    {?timestamp.sys.date?},\n    {?XIP.userId?},\n    {?timestamp.sys.date?},\n    {?XIP.userId?}\nfrom  xc_gl_jz_tpl a \nwhere a.JZ_TPL_ID = {?SOURCE_JZ_ID?}\n\n","arrayName":"mainData","itemId":"insertMainTable"},"children":[],"expanded":false,"type":"query"},{"configs":{"sql":"insert into xc_gl_jz_tpl_dtl(\n TPL_DTL_ID,   \n JZ_TPL_ID,    \n ZC_ACC_ID,    \n SUM_ACC_ID,   \n BAL_RULE,     \n BAL_DR,       \n ACC_SEGMENTS, \n SUMMARY,      \n CREATION_DATE,   \n CREATED_BY,      \n LAST_UPDATE_DATE,\n LAST_UPDATED_BY \n)values(\n {?TPL_DTL_ID?},\n {?JZ_TPL_ID?},\n {?ZC_ACC_ID?},\n {?SUM_ACC_ID?},\n {?BAL_RULE?},\n {?BAL_DR?},\n {?ACC_SEGMENTS?},\n {?SUMMARY?},\n {?timestamp.sys.date?},\n {?XIP.userId?},\n {?timestamp.sys.date?},\n {?XIP.userId?}\n)","arrayName":"subData","itemId":"insertSubTable"},"children":[],"expanded":false,"type":"query"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}