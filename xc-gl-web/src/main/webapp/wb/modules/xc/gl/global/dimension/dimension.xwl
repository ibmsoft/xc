{"inframe":false,"title":"","hidden":false,"roles":{"default":1},"children":[{"configs":{"title":"计量单位管理","loginRequired":"false","serverScript":"com.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xc/gl/global/dimension/dimension\");\nrequest.setAttribute('contextPath',request.getContextPath());","itemId":"module"},"children":[{"configs":{"itemId":"store"},"children":[{"configs":{"autoLoad":"true","itemId":"typeStore","url":"m?xwl=xc/gl/global/dimension/dimensionDB/selectDimensionType"},"children":[],"expanded":false,"type":"store"}],"expanded":false,"type":"folder"},{"configs":{"itemId":"windows"},"children":[{"configs":{"maximized":"true","title":"{#importTitle#}","height":"400","minimizable":"true","width":"750","layout":"border","dialog":"false","border":"false","itemId":"importDataWin","modal":"true","maximizable":"true","createInstance":"false"},"events":{"close":"app.queryBtn.fireEvent('click');"},"children":[{"configs":{"region":"center","frame":"true","style":"border-width:0px","layout":"column","padding":"15 0 0 5","border":"false","itemId":"importForm"},"children":[{"configs":{"tagConfigs":"columnWidth:.35","labelWidth":"80","allowBlank":"false","emptyText":"{#fileTip#}","labelAlign":"left","itemId":"selectFile","fieldLabel":"{#fileName#}"},"children":[],"expanded":false,"type":"file"},{"configs":{"text":"{#importBtn#}","itemId":"importFile","iconCls":"ok_icon","x":"2"},"events":{"click":"if(!app.importForm.getForm().isValid()){\n  Wb.info('请选择要上传的文件！');\n  return false;\n}\nvar fileType = app.selectFile.getValue();\nif(!Ext.String.endsWith(fileType,'.xls')){\n  Wb.info('请选择以xls结尾的Office Excel文档!',function(){\n    app.importForm.getForm().reset();\n  });\n}else{\n  //导入前，先清除错误数据\n  app.importLogGrid.getStore().removeAll();\n  var msgProcessBar = Ext.Msg.show({\n     title:'提示',\n     msg  :'导入中，请稍后.....',\n     wait :true,\n     width:200\n  });\n  //将Office Excel数据导入到余额临时表中\n  app.importForm.getForm().submit({\n    url:'{#contextPath#}/glDataTransgerManageAction.do?method=importAccountData&templateCode=XC_GL_DIMENSIONS',\n    timeout:3600*1000,\n    success:function(form,action){\n      msgProcessBar.hide();\n      Wb.info(action.result.msg,function(){\n        app.importDataWin.close();\n      });\n    },\n    failure:function(form,action){\n      msgProcessBar.hide();\n      var _flag = action.result.flag;\n      //flag =0,导入时发生异常，输出异常信息\n      if(_flag == '0'){\n        Wb.info(action.result.msg);\n      }else if(_flag == '2'){\n       //flag =2,数据导入临时表成功，数据校验发生异常\n        var _sessionId = action.result.msg;\n        Wb.info('导入数据不合法！');\n        app.importLogGrid.getStore().load({params:{'sessionId':_sessionId}});\n      }\n    }   \n  });\n}"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"form"},{"configs":{"region":"south","height":"'88%'","itemId":"southTab"},"children":[{"configs":{"title":"{#importLogs#}","selType":"checkboxmodel","itemId":"importLogGrid"},"children":[{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#incorrectColumn#}","width":"100","dataIndex":"ROW_NUM","itemId":"ROW_NUM","renderer":"return '<font color=\"red\">'+value+'<\/font>';"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#dimensionCode#}","width":"150","dataIndex":"DIM_CODE","itemId":"DIM_CODE"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#dimensionName#}","width":"200","dataIndex":"DIM_NAME","itemId":"DIM_NAME"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#dimensionCategory#}","width":"130","dataIndex":"DIM_TYPE","itemId":"DIM_TYPE"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#dimensionDesc#}","width":"250","dataIndex":"DIM_DESC","itemId":"DIM_DESC"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#errorInformation#}","width":"300","dataIndex":"ERROR_MSG","itemId":"E_MSG","renderer":"metaData.style = 'overflow:auto;padding: 3px 6px;text-overflow: ellipsis;white-space: nowrap;white-space:normal;line-height:15px;';   \nreturn '<font color=\"red\">'+value+'<\/font>';","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"pageSize":"-1","autoLoad":"true","itemId":"store","url":"m?xwl=xc/gl/global/dimension/dimensionDB/getInvalidDimension"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"tab"}],"expanded":true,"type":"window"}],"expanded":true,"type":"folder"},{"configs":{"layout":"border","itemId":"viewport1"},"children":[{"configs":{"region":"north","frame":"false","layout":"fit","border":"false","itemId":"form1"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"column","margin":"10 0 10 0","border":"false","itemId":"panel1"},"children":[{"configs":{"labelWidth":"{#labelWidth#}","labelAlign":"right","itemId":"dimensionName","fieldLabel":"{#dimensionName#}"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\napp.grid1.store.load(\n  {\n  params:{\n  dimensionName:app.dimensionName.getValue(),\n  dimensionType:app.dimensionType.getValue()\n  }\n  }\n);\n}"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"{#labelWidth#}","allowBlank":"true","store":"app.typeStore","displayField":"DIM_TYPE","valueField":"DIM_TYPE","labelAlign":"right","itemId":"dimensionType","fieldLabel":"{#dimensionCategory#}","editable":"false"},"events":{"select":"app.queryBtn.fireEvent('click');","specialkey":"if(Ext.EventObject.getKey()==13){\napp.grid1.store.load(\n  {\n  params:{\n  dimensionName:app.dimensionName.getValue(),\n  dimensionType:app.dimensionType.getValue()\n  }\n  }\n);\n}"},"children":[],"expanded":true,"type":"combo"},{"configs":{"text":"{#queryBtn#}","margin":"0 0 0 10","itemId":"queryBtn","iconCls":"seek_icon"},"events":{"click":"app.grid1.store.load(\n  {\n  params:{\n  dimensionName:app.dimensionName.getValue(),\n  dimensionType:app.dimensionType.getValue()\n  }\n  }\n);"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#resetBtn#}","margin":"0 0 0 10","itemId":"resetBtn","iconCls":"refresh_icon"},"events":{"click":"app.dimensionName.setValue();\napp.dimensionType.setValue();\napp.grid1.store.load(\n  {\n  params:{\n  dimensionName:app.dimensionName.getValue(),\n  dimensionType:app.dimensionType.getValue()\n  }\n  }\n);\n"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"form"},{"configs":{"region":"center","selType":"checkboxmodel","itemId":"grid1","editable":"true"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/gl/global/dimension/dimensionDB/selectDimension"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"{#addBtn#}","itemId":"addBtn","iconCls":"file_add_icon"},"events":{"click":"Wb.addEdit(app.grid1); \n//更多选项可使用Wb.add方法"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#delBtn#}","itemId":"deleteBtn","iconCls":"file_delete_icon"},"events":{"click":"var sm = app.grid1.getSelection();\nvar sm1= app.grid1.getSelection();//可以删除的记录\nvar sm2= app.grid1.getSelection();//未被保存的记录，直接删除\nif(sm.length<1 ){\n  Wb.toast('请选择一条要删除的数据!');\n  return false;\n}\nvar ids;//记录可以删除的id\nvar flag = true;//是否有原记录,默认为true\nvar num=0;//记录可以删除的个数\n Ext.Msg.confirm('提示','您确定要删除所选的数据吗？',function(a){\n  if(a=='yes'){\n   for(var i=0;i<sm2.length;i++){\n   //将保存了的id放在ids\n   if(sm2[i].data.DIM_ID===''){\n    //如果为空，则说明还没有保存，应该直接删除\n    app.grid1.getStore().remove(sm[i]);\n    //也需要在可以删除的记录和总的记录删除\n    Ext.Array.remove(sm,sm2[i]);\n    Ext.Array.remove(sm1,sm2[i]);\n  }\n  else{\n  //放在ids里面\n    var id=sm2[i].data.DIM_ID;\n    if(num===0){\n     ids=\"'\"+id+\"'\";\n      num=1;\n    }\n    else{\n     ids=ids+\",\"+\"'\"+id+\"'\";\n    }\n    flag=false;//如果为false，则代表有原纪录，说明有要删除已经保存了的数据，则需要验证\n  }\n  }\n  //验证数据是否合法\nif (!Wb.verifyGrid(app.grid1)) \n  return false;\nif(flag){\nreturn false;//没有原来保存的记录要删除\n}\n //进行验证ids\n Wb.request({\n   params:{\n    ids:ids\n  },\n  url:'m?xwl=xc/gl/global/dimension/dimensionDB/validate',\n  success:function(resp){\n   var res = Wb.decode(resp.responseText);\n    if(res.total!==0){\n      //存在不能删除的记录\n      var names;//不能删除的用户名称\n      var num1=0;//判断标记\n     for(var i=0;i<res.total;i++){\n     //遍历获取到不能删除的id，则代表此行不能被删除\n       var id=res.rows[i].ID;\n       for(var j=0;j<sm.length;j++){\n       if(id===sm[j].data.DIM_ID){\n        //应该被移除到不可删除的记录中,记录下单位名称\n         if(num1===0){\n           names=sm[j].data.DIM_NAME;\n           num1=1;\n         }\n         else{\n         names=names+\",\"+sm[j].data.DIM_NAME;\n         }\n         Ext.Array.remove(sm1,sm[j]);//移除不能删除的\n         }\n       }\n     }\n      //首先要删除可以删除的\n      for(var k=0;k<sm1.length;k++){\n      Wb.remove(app.grid1,sm1[k]);\n      }\n      \n      //保存之后再提示\n      app.saveBtn.fireEvent('click');\n      if(names!==''){\n      Wb.toast(names+'已被账簿会记科目中使用，无法删除!');\n      return false;\n        }\n    }\n    else{\n      //则代表所有的数据都可以删除\n   Wb.remove(app.grid1);\n   Wb.sync({\n   grid: app.grid1,\n   url: 'm?xwl=xc/gl/global/dimension/dimensionDB/saveDimension',\n   message: '正在删除...',\n   success: function(resp) {\n    //ID_FIELD值在后台生成，把返回的ID_FIELD值列表同步到表格中\n    Wb.syncCreate(app.grid1, Wb.decode(resp.responseText));\n   }\n   });\n   }  \n  }\n  });\n  }\n  else{\n    //用户取消删除\n  return false;\n }\n });\n\n"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#saveBtn#}","itemId":"saveBtn","iconCls":"save_icon"},"events":{"click":"if (!Wb.verifyGrid(app.grid1)){ \n  //验证数据是否合法\n  return flase;\n}\n  Wb.sync({\n  grid: app.grid1,\n  url: 'm?xwl=xc/gl/global/dimension/dimensionDB/saveDimension',\n  message: '正在保存中...',\n  success: function(resp) {\n    //ID_FIELD值在后台生成，把返回的ID_FIELD值列表同步到表格中\n    var response = Wb.decode(resp.responseText) ;\n    if(response.DIM_ID !== null && response.DIM_ID !== \"\"){\n      Wb.syncCreate(app.grid1, Wb.decode(resp.responseText));\n      Wb.toast('保存成功') ;\n    }else{\n      Wb.toast('保存失败') ;\n    }\n  }\n});"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#importBtn#}","itemId":"importBtn","iconCls":"import_icon"},"events":{"click":"var win = new Ext.window.Window(app._importDataWin);\nwin.show();"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#exprotBtn#}","itemId":"exportBtn","iconCls":"export_icon"},"events":{"click":"window.location.href = '{#contextPath#}/glDataTransgerManageAction.do?method=exportBaseDataByModel&templateCode=XC_GL_DIMENSIONS';"},"children":[],"expanded":false,"type":"item"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#rownum#}","align":"center","xtype":"rownumberer","width":"45","titleAlign":"center","itemId":"rowNumCol"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"DIM_ID","hidden":"true","dataIndex":"DIM_ID","itemId":"dimIdCol"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#dimensionCode#}","align":"left","dataIndex":"DIM_CODE","titleAlign":"center","itemId":"dimCodeCol"},"children":[{"configs":{"itemId":"editor"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"column"},{"configs":{"text":"{#dimensionName#}","align":"left","width":"150","dataIndex":"DIM_NAME","titleAlign":"center","itemId":"dimNameCol"},"children":[{"configs":{"itemId":"editor"},"children":[],"expanded":false,"type":"text"}],"expanded":false,"type":"column"},{"configs":{"text":"{#dimensionCategory#}","width":"200","align":"left","dataIndex":"DIM_TYPE","titleAlign":"center","itemId":"dimTypeCol"},"children":[{"configs":{"store":"app.typeStore","displayField":"DIM_TYPE","valueField":"DIM_TYPE","itemId":"editor"},"children":[],"expanded":true,"type":"combo"}],"expanded":true,"type":"column"},{"configs":{"text":"{#dimensionDesc#}","align":"left","width":"400","dataIndex":"DIM_DESC","titleAlign":"center","itemId":"dimDescCol"},"children":[{"configs":{"itemId":"editor"},"children":[],"expanded":false,"type":"text"}],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}