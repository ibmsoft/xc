{"inframe":false,"title":"期末结转","hidden":false,"roles":{"default":1},"children":[{"configs":{"loginRequired":"false","serverScript":"com.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xc/gl/final-carryover/carryover-model\");\nrequest.setAttribute('contextPath',request.getContextPath());","head":"<style type=\"text/css\">\n  .my_custom_grid .x-grid-row{\n      height:50px;\n  }\n  .my_custom_grid .x-grid-editor .x-form-text{\n      height:49px;\n  }\n  .my_custom_grid .x-grid-cell{\n      font: normal 12px/13px tahoma, arial, verdana, sans-serif;\n  }\n  .my_custom_grid .x-grid-cell{\n      border-color: #d0d0d0;\n  }\n  .my_custom_grid .x-grid-with-col-lines .x-grid-cell {\n    border-right-width: 1px;\n  }\n  .my_custom_grid .x-grid-with-row-lines .x-grid-td {\n    border-bottom-width: 1px;\n}\n<\/style>","itemId":"module"},"children":[{"configs":{"itemId":"windows"},"children":[{"configs":{"maximized":"true","title":"{#modelInfo#}","frame":"true","height":"650","minimizable":"true","layout":"border","width":"850","buttonAlign":"center","border":"false","itemId":"editModeWin","modal":"true","createInstance":"false"},"events":{"close":"app.modelGrid.getStore().load();"},"children":[{"configs":{"region":"north","title":"{#basicInfo#}","height":"150","layout":"fit","itemId":"basicSet"},"children":[{"configs":{"frame":"true","style":"border-width:0px","layout":"form","border":"false","itemId":"basicInfoForm"},"children":[{"configs":{"hidden":"true","labelAlign":"right","itemId":"jzTplId","fieldLabel":"模板ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","labelAlign":"right","itemId":"accHrcyId","fieldLabel":"科目体系ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"80","allowBlank":"false","hidden":"true","labelAlign":"right","itemId":"account"},"children":[],"expanded":false,"type":"text"},{"configs":{"tagConfigs":"baseCls:'my-panel-no-border'","frame":"true","layout":"column","border":"false","itemId":"tr1"},"children":[{"configs":{"tagConfigs":"baseCls:'my-panel-no-border'","frame":"true","layout":"fit","columnWidth":".3","border":"false","itemId":"td1.1"},"children":[{"configs":{"labelWidth":"80","allowBlank":"false","displayField":"LEDGER_NAME","valueField":"LEDGER_ID","labelAlign":"right","itemId":"ledgerName","fieldLabel":"{#necessaryLedger#}"},"events":{"select":"var _accHrcyId = records[0].data.ACC_HRCY_ID;\napp.accHrcyId.setValue(_accHrcyId);\nvar _jzplId = app.jzTplId.getValue();\napp.detailInfoGrid.getStore().load(\n  {\n    params:{'accHrcyId':_accHrcyId,'jzTplId':_jzplId}\n  }\n);\n//更换账簿时，必须清空已经添加的结转明细行信息\nvar _delRows = app.detailInfoGrid.getSelection();\nWb.remove(app.detailInfoGrid,_delRows);\napp.account.setValue('');\napp.accountName.setValue('') ;\napp.accountAssist.setValue('');\napp.accountCodeAssist.setValue();","beforequery":"var combo = plan.combo;\nif (!plan.forceAll) {\n  var value = plan.query;\n  combo.store.filterBy(function(record, id) {\n    var text = record.get(combo.displayField);\n    return (text.indexOf(value) != -1);\n  });\n  combo.expand();\n  return false;\n}"},"children":[{"configs":{"pageSize":"-1","autoLoad":"true","itemId":"store","url":"m?xwl=xc/com-qry/gl-ledgers/select-sec-fd-ledgers"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls:'my-panel-no-border'","frame":"true","layout":"fit","columnWidth":".3","border":"false","itemId":"td1.2"},"children":[{"configs":{"labelWidth":"80","allowBlank":"false","labelAlign":"right","itemId":"modelName","fieldLabel":"{#necessaryModel#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls:'my-panel-no-border'","frame":"true","layout":"fit","columnWidth":".3","border":"false","itemId":"td1.3"},"children":[{"configs":{"labelWidth":"80","allowBlank":"false","displayField":"V_CATEGORY_NAME","valueField":"V_CATEGORY_ID","labelAlign":"right","itemId":"voucherCategory","fieldLabel":"{#voucherCategory#}"},"events":{"select":"app.modelGrid.getStore().load();","beforequery":"var combo = plan.combo;\nif (!plan.forceAll) {\n  var value = plan.query;\n  combo.store.filterBy(function(record, id) {\n    var text = record.get(combo.displayField);\n    return (text.indexOf(value) != -1);\n  });\n  combo.expand();\n  return false;\n}"},"children":[{"configs":{"pageSize":"-1","autoLoad":"true","itemId":"store","url":"m?xwl=xc/gl/final-carryover/data/query-voucher-type"},"events":{"load":"if(Ext.isEmpty(app.voucherCategory.getValue())){\n  app.voucherCategory.setValue(records[0].data.V_CATEGORY_ID);\n}\n"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"}],"expanded":true,"type":"panel"}],"expanded":false,"type":"panel"},{"configs":{"tagConfigs":"baseCls:'my-panel-no-border'","frame":"true","layout":"column","border":"false","itemId":"tr2"},"children":[{"configs":{"tagConfigs":"baseCls:'my-panel-no-border'","frame":"true","layout":"fit","columnWidth":".3","border":"false","itemId":"td2.1"},"children":[{"configs":{"labelWidth":"80","allowBlank":"false","labelAlign":"right","itemId":"accountName","fieldLabel":"{#intoAccount#}","editable":"false"},"events":{"change":"if(newValue !== oldValue){\n\t//更换转入科目时，必须清空已经添加的结转明细行信息\n    var _delRows = app.detailInfoGrid.getSelection();\n    Wb.remove(app.detailInfoGrid,_delRows);\n}","expand":"if(Ext.isEmpty(app.ledgerName.getValue())){\n     Wb.info('请先选择账簿！');\n     return false;\n}else{\n  app.pickComp.getStore().load();\n}"},"children":[{"configs":{"tagConfigs":"minWidth:470","multiSelect":"false","height":"250","forceFit":"true","itemId":"pickComp"},"events":{"itemclick":"var accCode = record.get('ACC_CODE') ;\nvar accId = record.get('ACC_ID') ;\nvar accName = record.get('ACC_NAME') ;\nvar segUnionName = record.get('ACC_SEG_UNION');\nvar segUnionCode = record.get('SEG_CODE_UNION');\napp.account.setValue(accId) ;\napp.accountName.setValue(accCode+' '+accName);\napp.accountAssist.setValue(segUnionName);\napp.accountCodeAssist.setValue(segUnionCode);\napp.pickComp.hide() ;"},"children":[{"configs":{"itemId":"tbar"},"children":[{"configs":{"width":"300","labelAlign":"right","itemId":"codeOrName"},"events":{"change":"// 动态筛选\nvar accStore = app.pickComp.getStore() ;\naccStore.filterBy(function(record,id){\n  var text = record.get('ACC_CODE');\n  return (text.indexOf(newValue)!=-1);\n});","specialkey":"if (e.getKey() == Ext.EventObject.ENTER) {\n  app.btnQryAcc.fireEvent('click') ;\n}"},"children":[],"expanded":false,"type":"text"},{"configs":{"text":"{#queryBtn#}","itemId":"btnQryAcc","iconCls":"seek_icon"},"events":{"click":"app.pickComp.getStore().load() ;"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#resetBtn#}","itemId":"btnClearAcc","iconCls":"cancel_icon","tooltip":"{#resetTip#}"},"events":{"click":"app.account.setValue('') ;\napp.accountName.setValue('') ;\napp.pickComp.hide() ;"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"pageSize":"-1","autoLoad":"true","itemId":"store","url":"m?xwl=xc/com-qry/gl-account/select-last-accounts"},"events":{"beforeload":"store.proxy.extraParams.ledgerId = app.ledgerName.getValue() ;\nstore.proxy.extraParams.accName = app.codeOrName.getValue() ;"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"ID","hidden":"true","dataIndex":"ACC_ID","itemId":"ID"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#accountCode#}","width":"140","dataIndex":"ACC_CODE","titleAlign":"center","itemId":"CODE"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#accountName#}","width":"250","dataIndex":"ACC_NAME","titleAlign":"center","itemId":"NAME"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":false,"type":"picker"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls:'my-panel-no-border'","frame":"true","layout":"fit","columnWidth":".3","border":"false","itemId":"td2.2"},"children":[{"configs":{"labelWidth":"80","allowBlank":"false","value":"1","pickList":"[['1','借'],['-1','贷']]","labelAlign":"right","itemId":"accountDirect","fieldLabel":"{#intoDirection#}"},"events":{"select":"app.modelGrid.getStore().load();","beforequery":"var combo = plan.combo;\nif (!plan.forceAll) {\n  var value = plan.query;\n  combo.store.filterBy(function(record, id) {\n    var text = record.get(combo.displayField);\n    return (text.indexOf(value) != -1);\n  });\n  combo.expand();\n  return false;\n}"},"children":[],"expanded":true,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls:'my-panel-no-border'","frame":"true","layout":"fit","columnWidth":".3","border":"false","itemId":"td2.3"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"accountAssist","fieldLabel":"{#assistantSegment#}"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"80","hidden":"true","labelAlign":"right","itemId":"accountCodeAssist","fieldLabel":"辅助核算编码"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls:'my-panel-no-border'","frame":"true","layout":"column","border":"false","itemId":"tr3"},"children":[{"configs":{"tagConfigs":"baseCls:'my-panel-no-border'","frame":"true","layout":"fit","columnWidth":".9","border":"false","itemId":"td3.1"},"children":[{"configs":{"labelWidth":"80","allowBlank":"false","labelAlign":"right","itemId":"modelSummary","fieldLabel":"{#necessarySummary#}"},"children":[],"expanded":false,"type":"textarea"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"form"}],"expanded":false,"type":"fieldset"},{"configs":{"region":"center","multiSelect":"false","selType":"cellmodel","itemId":"detailInfoGrid","enableColumnMove":"false","editable":"true"},"events":{"tagEvents":"'cellclick':function(cell,td,cellIndex,record,tr,rowIndex,e,eOpts){\n  if(cellIndex === 7 && !Ext.isEmpty(app.accountAssist.getValue())){\n    return false;\n  }\n}"},"children":[{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"TPL_DTL_ID","hidden":"true","dataIndex":"TPL_DTL_ID","itemId":"TPL_DTL_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"JZ_TPL_ID","hidden":"true","dataIndex":"JZ_TPL_ID","itemId":"JZ_TPL_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"ZC_ACC_ID","hidden":"true","dataIndex":"ZC_ACC_ID","itemId":"OUT_ACCOUNT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#outAccountName#}","dataIndex":"ZC_ACC_NAME","itemId":"OUT_ACCOUNT_COL","flex":"3"},"children":[{"configs":{"itemId":"editor"},"events":{"expand":"app.outAccComp.getStore().load();"},"children":[{"configs":{"tagConfigs":"minWidth:470","multiSelect":"false","height":"250","normalName":"outAccComp","forceFit":"true","itemId":"pickComp"},"events":{"itemclick":"var _accId = record.get('ACC_ID');\nvar _accCode = record.get('ACC_CODE');\nvar _accName = record.get('ACC_NAME');\nvar _accUnionName = record.get('ACC_SEG_UNION');\nvar _accBalDirection = record.get('BALANCE_DIRECTION');\nvar _accBalDirectName = '借';\nif(_accBalDirection === '-1')\n  _accBalDirectName = '贷';\nif(Ext.isEmpty(_accUnionName)){\n  _accUnionName = '';\n}\nvar _rows = app.detailInfoGrid.getSelection();\nvar _row = _rows[0];\n_row.set('ZC_ACC_ID',_accId);\n_row.set('ZC_ACC_NAME',_accCode+' '+_accName);\n_row.set('OUT_ACC_DIRECTION',_accBalDirection);\n_row.set('OUT_ACC_SEG',_accUnionName);\nvar picker = this.ownerCmp;\npicker.setValue(_accCode+' '+_accName);\n/*明细方向、辅助段确定规则\n *1- 取数规则为 【余额取数】时，明细行的【方向】取【取数科目】和【转出科目】的相反值，优先以【取数科目】的方向为准；\n *2- 【辅助段】的确定规则和【方向】的确定规则一致；\n *3- 【取数规则】不为【余额取数】时，明细行【方向】跟【取数规则】相反，【辅助段】确定规则同上；\n *4- 【转出科目】为必填，清空时无需对【方向】和【辅助段】做任何处理；\n *5- 【取数科目】清空时，在【取数规则】为【余额取数】的前提下，需设置【方向】和【辅助段】为【转出科目】的相反方向和辅助段；\n */\nvar _fetchRule = _row.get('BAL_RULE');\nvar _fetchAccount = _row.get('SUM_ACC_ID');\n//按余额取数并且取数科目为空时 设置转出科目为明细行的【方向】\nif(_fetchRule === '0' && Ext.isEmpty(_fetchAccount)){\n  _row.set('BAL_DR',_accBalDirection);\n  _row.set('BAL_DR_NAME',_accBalDirectName);\n}\n//当【取数科目】为空时，设置明细行【辅助段】为转出科目的【辅助段】\nif(Ext.isEmpty(_fetchAccount)){\n  _row.set('ACC_SEGMENTS',_accUnionName);\n}\npicker.collapse();"},"children":[{"configs":{"itemId":"tbar"},"children":[{"configs":{"width":"300","labelAlign":"right","itemId":"colCodeName"},"events":{"change":"// 动态筛选\nvar accStore = app.outAccComp.getStore();\naccStore.filterBy(function(record,id){\n  var text = record.get('ACC_CODE');\n  return (text.indexOf(newValue)!=-1);\n});","specialkey":"if (e.getKey() == Ext.EventObject.ENTER) {\n  app.outQryBtn.fireEvent('click') ;\n}"},"children":[],"expanded":false,"type":"text"},{"configs":{"text":"{#queryBtn#}","itemId":"outQryBtn","iconCls":"seek_icon"},"events":{"click":"var pickGrid = app.outAccComp;\npickGrid.getStore().load();"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#resetBtn#}","itemId":"outClearAcc","iconCls":"cancel_icon","tooltip":"{#resetTip#}"},"events":{"click":"app.colCodeName.setValue('') ;\nvar picker = app.outAccComp.ownerCmp;\npicker.setValue('');\nvar _rows = app.detailInfoGrid.getSelection();\nvar _row = _rows[0];\n_row.set('ZC_ACC_ID','');\n_row.set('ZC_ACC_NAME','');\n_row.set('OUT_ACC_DIRECTION','');\n_row.set('OUT_ACC_SEG','');\nvar _fetchRule = _row.get('BAL_RULE');\nvar _fetchAccount = _row.get('SUM_ACC_ID');\n//按余额取数并且取数科目为空时 设置转出科目为明细行的【方向】\nif(_fetchRule === '0' && Ext.isEmpty(_fetchAccount)){\n  _row.set('BAL_DR','');\n  _row.set('BAL_DR_NAME','');\n}\n//当【取数科目】为空时，设置明细行【辅助段】为转出科目的【辅助段】\nif(Ext.isEmpty(_fetchAccount)){\n  _row.set('ACC_SEGMENTS','');\n}\npicker.collapse('');"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"pageSize":"-1","autoLoad":"true","itemId":"store","url":"m?xwl=xc/gl/final-carryover/data/select-out-account"},"events":{"beforeload":"store.proxy.extraParams.WHERESQL = ' a.IS_LEAF = \\'Y\\'';\nstore.proxy.extraParams.ledgerId = app.ledgerName.getValue() ;\nstore.proxy.extraParams.accName = app.colCodeName.getValue();\nif(Ext.isEmpty(app.accountCodeAssist.getValue())){\n  store.proxy.extraParams.segUnionCoe ='';\n}else{\n  store.proxy.extraParams.segUnionCoe = app.accountCodeAssist.getValue();\n}\nstore.proxy.extraParams.accId = app.account.getValue();\n"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"科目ID","hidden":"true","dataIndex":"ACC_ID","itemId":"ID"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#accountCode#}","width":"140","dataIndex":"ACC_CODE","titleAlign":"center","itemId":"CODE"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#accountName#}","width":"250","dataIndex":"ACC_NAME","titleAlign":"center","itemId":"NAME"},"children":[],"expanded":false,"type":"column"}],"expanded":false,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":true,"type":"column"},{"configs":{"text":"OUT_ACC_DIRECTION","hidden":"true","dataIndex":"OUT_ACC_DIRECTION","itemId":"OUT_ACC_DIRECT_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"OUT_ACC_SEG","hidden":"true","dataIndex":"OUT_ACC_SEG","itemId":"OUT_ACC_SEG_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"SUM_ACC_ID","hidden":"true","dataIndex":"SUM_ACC_ID","itemId":"DATA_ACCOUNT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#dataFetchAccount#}","dataIndex":"SUM_ACC_NAME","itemId":"DATA_ACCOUNT_COL","flex":"3"},"children":[{"configs":{"itemId":"editor"},"events":{"expand":"app.fetchDataComp.getStore().load();"},"children":[{"configs":{"tagConfigs":"minWidth:470","multiSelect":"false","height":"250","normalName":"fetchDataComp","forceFit":"true","itemId":"pickComp"},"events":{"itemclick":"var _accId = record.get('ACC_ID');\nvar _accCode = record.get('ACC_CODE');\nvar _accName = record.get('ACC_NAME');\nvar _accUnionName = record.get('ACC_SEG_UNION');\nvar _accBalDirection = record.get('BALANCE_DIRECTION');\nvar _accBalDirectName = '借';\nif(_accBalDirection === '-1')\n  _accBalDirectName = '贷';\nif(Ext.isEmpty(_accUnionName)){\n  _accUnionName = '';\n}\nvar _rows = app.detailInfoGrid.getSelection();\nvar _row = _rows[0];\n_row.set('SUM_ACC_ID',_accId);\n_row.set('SUM_ACC_NAME',_accCode+' '+_accName);\n_row.set('ACC_SEGMENTS',_accUnionName);\n_row.set('DATA_ACC_DIRECTION',_accBalDirection);\nvar picker = this.ownerCmp;\npicker.setValue(_accCode+' '+_accName);\n/*明细方向、辅助段确定规则\n *1- 取数规则为 【余额取数】时，明细行的【方向】取【取数科目】和【转出科目】的相反值，优先以【取数科目】的方向为准；\n *2- 【辅助段】的确定规则和【方向】的确定规则一致；\n *3- 【取数规则】不为【余额取数】时，明细行【方向】跟【取数规则】相反，【辅助段】确定规则同上；\n *4- 【转出科目】为必填，清空时无需对【方向】和【辅助段】做任何处理；\n *5- 【取数科目】清空时，在【取数规则】为【余额取数】的前提下，需设置【方向】和【辅助段】为【转出科目】的相反方向和辅助段；\n */\nvar _fetchRule = _row.get('BAL_RULE');\n//按余额取数并且取数科目为空时 设置转出科目为明细行的【方向】\nif(_fetchRule === '0'){\n  _row.set('BAL_DR',_accBalDirection);\n  _row.set('BAL_DR_NAME',_accBalDirectName);\n}\npicker.collapse();"},"children":[{"configs":{"itemId":"tbar"},"children":[{"configs":{"width":"300","labelAlign":"right","itemId":"fetchCodeName"},"events":{"change":"var accStore = app.fetchDataComp.getStore();\naccStore.filterBy(function(record,id){\n  var text = record.get('ACC_CODE');\n  return (text.indexOf(newValue)!=-1);\n});","specialkey":"if (e.getKey() == Ext.EventObject.ENTER) {\n  app.fetchQryAcc.fireEvent('click') ;\n}"},"children":[],"expanded":false,"type":"text"},{"configs":{"text":"{#queryBtn#}","itemId":"fetchQryAcc","iconCls":"seek_icon"},"events":{"click":"var pickGrid = app.fetchDataComp;\npickGrid.getStore().load();"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#resetBtn#}","itemId":"fetchClearAcc","iconCls":"cancel_icon","tooltip":"{#resetTip#}"},"events":{"click":"app.fetchCodeName.setValue('') ;\nvar pickGrid = app.fetchDataComp.ownerCmp;\npickGrid.setValue('');\nvar _rows = app.detailInfoGrid.getSelection();\nvar _row = _rows[0];\n_row.set('SUM_ACC_ID','');\n_row.set('SUM_ACC_NAME','');\n_row.set('DATA_ACC_DIRECTION','');\nvar _fetchRule = _row.get('BAL_RULE');\nvar _outAccount = _row.get('ZC_ACC_ID');\n//按余额取数并且取数科目为空,转出科目不为空\nif(_fetchRule === '0' && !Ext.isEmpty(_outAccount)){\n  var _accBalDirection = _row.get('OUT_ACC_DIRECTION');\n  var _accBalDirectName = '借';\n  if(_accBalDirection === '-1')\n    _accBalDirectName = '贷';\n  _row.set('BAL_DR',_accBalDirection);\n  _row.set('BAL_DR_NAME',_accBalDirectName);\n}\n//当【取数科目】为空时，设置明细行【辅助段】为转出科目的【辅助段】\n  var _accUnionName = _row.get('OUT_ACC_SEG');\n  if(Ext.isEmpty(_accUnionName))\n    _accUnionName = '';\n  _row.set('ACC_SEGMENTS',_accUnionName);\npickGrid.collapse();"},"children":[],"expanded":false,"type":"button"}],"expanded":false,"type":"toolbar"},{"configs":{"pageSize":"-1","autoLoad":"true","itemId":"store","url":"m?xwl=xc/gl/final-carryover/data/select-out-account"},"events":{"beforeload":"store.proxy.extraParams.WHERESQL = ' 1=1';\nstore.proxy.extraParams.ledgerId = app.ledgerName.getValue() ;\nstore.proxy.extraParams.accName = app.fetchCodeName.getValue();\nif(Ext.isEmpty(app.accountCodeAssist.getValue())){\n  store.proxy.extraParams.segUnionCoe ='';\n}else{\n  store.proxy.extraParams.segUnionCoe = app.accountCodeAssist.getValue();\n}\nstore.proxy.extraParams.accId = app.account.getValue();\n"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"科目ID","hidden":"true","dataIndex":"ACC_ID","itemId":"ID"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#accountCode#}","width":"140","dataIndex":"ACC_CODE","titleAlign":"center","itemId":"CODE"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#accountName#}","width":"250","dataIndex":"ACC_NAME","titleAlign":"center","itemId":"NAME"},"children":[],"expanded":false,"type":"column"}],"expanded":false,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":false,"type":"picker"}],"expanded":false,"type":"column"},{"configs":{"text":"取数科目方向","hidden":"true","dataIndex":"DATA_ACC_DIRECTION","itemId":"DATA_ACC_DIRECT_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"BAL_RULE","hidden":"true","dataIndex":"BAL_RULE","itemId":"DATA_RULE_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#dataFetchRule#}","dataIndex":"BAL_RULE_NAME","itemId":"DATA_RULE_COL","renderer":"if(value === '1'){\n  return '借方取数';\n}else if(value === '-1'){\n  return '贷方取数';\n}else if(value === '0'){\n  return '余额取数';\n}else{\n  return value;\n}","flex":"2"},"children":[{"configs":{"pickList":"[['1','借方取数'],['-1','贷方取数'],['0','余额取数']]","itemId":"editor"},"events":{"select":"var _rows = app.detailInfoGrid.getSelection();\nvar _row = _rows[0];\n_row.set('BAL_RULE',combo.getValue());\n_row.set('BAL_RULE_NAME',combo.getRawValue());\nif(combo.getValue() === '1'){\n  _row.set('BAL_DR','-1');\n  _row.set('BAL_DR_NAME','贷');\n}else if(combo.getValue() === '-1'){\n  _row.set('BAL_DR','1');\n  _row.set('BAL_DR_NAME','借');\n}else{\n  //余额取数\n  var dataAccId = _row.get('SUM_ACC_ID');\n  if(Ext.isEmpty(dataAccId)){\n    var outAccDirect = _row.get('OUT_ACC_DIRECTION');\n    if(outAccDirect === '1'){\n      _row.set('BAL_DR','-1');\n      _row.set('BAL_DR_NAME','贷');\n    }else{\n      _row.set('BAL_DR','1');\n      _row.set('BAL_DR_NAME','借');\n    }\n  }else{\n      var dataAccDirect = _row.get('DATA_ACC_DIRECTION');\n      if(dataAccDirect === '1'){\n        _row.set('BAL_DR','-1');\n        _row.set('BAL_DR_NAME','贷');\n      }else{\n        _row.set('BAL_DR','1');\n        _row.set('BAL_DR_NAME','借');\n    }\n  }\n}"},"children":[],"expanded":false,"type":"combo"}],"expanded":true,"type":"column"},{"configs":{"text":"DIRECTION","hidden":"true","dataIndex":"BAL_DR","itemId":"DIRECTION_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#direction#}","dataIndex":"BAL_DR_NAME","itemId":"DIRECTION_COL","flex":"2"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#assistantSegment#}","dataIndex":"ACC_SEGMENTS","itemId":"ASSISTANT_COL","flex":"3"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#necessarySummary#}","dataIndex":"SUMMARY","itemId":"ACCOUNT_SUMMARY","flex":"5"},"children":[{"configs":{"itemId":"editor"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"-","itemId":"item7"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#addBtn#}","itemId":"addDetailBtn","iconCls":"table_add_icon"},"events":{"click":"if(Ext.isEmpty(app.ledgerName.getValue())){\n  Wb.info('请先选择账簿!');\n  return false;\n}\nif(Ext.isEmpty(app.accountName.getValue())){\n  Wb.info('请先选择转入科目!');\n  return false;\n}\nvar modelTplId = app.jzTplId.getValue();\nWb.addEdit(app.detailInfoGrid,{'TPL_DTL_ID':'-1','JZ_TPL_ID':modelTplId});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item8"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#delBtn#}","itemId":"delDetailBtn","iconCls":"table_delete_icon"},"events":{"click":"var _selRows = app.detailInfoGrid.getSelection();\nif(_selRows.length <1){\n  Wb.info('请选择要删除的记录！');\n}else{\n  Wb.confirm('确定要删除所选的记录？',function(){\n    Wb.request({\n          url:'m?xwl=xc/gl/final-carryover/data/deleteAccountDetail',\n          params:{destroy: Wb.getData(_selRows)},\n          success:function(){\n            Wb.remove(app.detailInfoGrid,_selRows);\n         }\n       });\n  });\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item9"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#createVoucher#}","itemId":"voucherCreateBtn","iconCls":"script_icon"},"events":{"click":"if(app.jzTplId.getValue() === '-1'){\n  Wb.info('请先保存模板信息！');\n}else{\n  var _createLedgerId = app.ledgerName.getValue();\n  app.createVoucherWin.show();\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item10"},"children":[],"expanded":false,"type":"item"}],"expanded":true,"type":"toolbar"},{"configs":{"pageSize":"-1","itemId":"store","url":"m?xwl=xc/gl/final-carryover/data/select-jz-tpl-dtl"},"children":[],"expanded":false,"type":"store"}],"expanded":false,"type":"grid"},{"configs":{"itemId":"buttons"},"children":[{"configs":{"text":"{#saveBtn#}","itemId":"modelSaveBtn","iconCls":"save_icon"},"events":{"click":"/**\n *保存结转模板明细信息。\n *1、jzTplId = '-1'时为新增，否则为修改\n *2、保存前校验\n *2.1、填写所有必填项<主表+明细表所有必填项>\n *2.2、结转明细保存：转出科目+取数科目两者必须必须唯一\n *2.3、转入科目和转出科目可以一致\n */\nvar _templateId = app.jzTplId.getValue();\nif(!app.basicInfoForm.getForm().isValid()){\n  Wb.info('请填写【基本信息】中的所有必填项!');\n  return false;\n}\nvar _rows = app.detailInfoGrid.getStore().getModifiedRecords();\nvar validArray = [];\nvar existsArray = [];\nvar isValid = true;\nvar isDuplicate = false;\nvar combineIds = '';\nvar index = 1;\nvar templateMainJson = {'JZ_TPL_ID':app.jzTplId.getValue(),\n                        'JZ_TPL_CODE':'',\n                        'JZ_TPL_NAME':app.modelName.getValue(),\n                        'LEDGER_ID':app.ledgerName.getValue(),\n                        'V_CATEGORY_ID':app.voucherCategory.getValue(),\n                        'ZR_ACC_ID':app.account.getValue(),\n                        'ACC_SEGMENTS':app.accountAssist.getValue(),\n                        'ZR_ACC_DR':app.accountDirect.getValue(),\n                        'SUMMARY':app.modelSummary.getValue()\n                        };\n//----------新增-------------\nif(_templateId === '-1'){\n  Ext.each(_rows,function(item){\n    var tmpOutId = item.data.ZC_ACC_ID;\n    var tmpDataId = item.data.SUM_ACC_ID;\n    if(Ext.isEmpty(tmpOutId) || Ext.isEmpty(item.data.BAL_RULE) || Ext.isEmpty(item.data.SUMMARY)){\n      isValid = false;\n      return ;\n    }\n    if(Ext.isEmpty(tmpDataId))\n      tmpDataId = '';\n    combineIds = tmpOutId+'|'+tmpDataId;\n    if(Ext.Array.contains(validArray,combineIds)){\n      isDuplicate = true;\n      return ;\n    }else{\n      validArray.push(combineIds);\n    }\n    index++;\n  });\n  if(!isValid){\n    Wb.info('请填写明细行上所有必填项！');\n    return;\n  }\n  if(isDuplicate){\n    Wb.info('第'+index+'个改变行的【转出科目】和【取数科目】已重复');\n    return;\n  }\n  //保存操作\n  var saveRows = Wb.getModified(app.detailInfoGrid);\n  Wb.request({\n    url:'m?xwl=xc/gl/final-carryover/data/save-jz-model',\n    params:{'mainData':Wb.encode(templateMainJson),'operateData':Wb.encode(saveRows)},\n    success:function(response){\n      var returnObj = Wb.decode(response.responseText);\n      var primaryKey = returnObj.JZ_TPL_ID;\n      app.jzTplId.setValue(primaryKey);\n      app.detailInfoGrid.getStore().load({params:{'jzTplId':primaryKey,'accHrcyId':app.accHrcyId.getValue()}});\n      Wb.info('保存成功！',function(){\n        app.ledgerName.setReadOnly(true);\n        app.accountName.setReadOnly(true);\n      });\n    },\n    failure:function(){\n      Wb.info('保存失败');\n    }\n  });\n}else{\n  /*修改\n   *修改除了校验新增的记录中是否存在重复【转出科目】和【取数科目】的重复性，还要校验改变记录和已存在记录是否存在着上述区别\n   *模板编辑时：账簿和转入科目 不能修改\n   */\n  var existRows;\n  var existCombine = false;\n  Wb.request({\n    url:'m?xwl=xc/gl/final-carryover/data/query-ledger-jz-data',\n    params:{'JZ_TPL_ID':app.jzTplId.getValue()},\n    success:function(response){\n      var allData = Wb.decode(response.responseText);\n      existRows = allData.rows;\n      Ext.each(existRows,function(tmp){\n        if(Ext.isEmpty(tmp.SUM_ACC_ID)){\n          combineIds = tmp.ZC_ACC_ID+'|'+'';\n        }else{\n          combineIds = tmp.ZC_ACC_ID+'|'+tmp.SUM_ACC_ID;\n        }\n        existsArray.push(combineIds);\n      });\n      Ext.each(_rows,function(item){\n        var tmpOutId = item.data.ZC_ACC_ID;\n        var tmpDataId = item.data.SUM_ACC_ID;\n        if(Ext.isEmpty(tmpOutId) || Ext.isEmpty(item.data.BAL_RULE) || Ext.isEmpty(item.data.SUMMARY)){\n          isValid = false;\n          return ;\n        }\n        if(Ext.isEmpty(tmpDataId)){\n          tmpDataId = '';\n        }\n        combineIds = tmpOutId+'|'+tmpDataId;\n        if(Ext.Array.contains(existsArray,combineIds)){\n          existCombine = true;\n          return false;\n        }else{\n          validArray.push(combineIds);\n          index++;\n        }\n  });\n  if(!isValid){\n    Wb.info('请填写明细行上所有必填项！');\n    return;\n  }\n  if(existCombine){\n    Wb.info('【转出科目】+【取数科目】存在重复记录,请重新选择！');\n    return;\n  }\n  var uniqueArray = Ext.Array.unique(validArray);\n  if(uniqueArray.length !== validArray.length){\n    Wb.info('【转出科目】+【取数科目】存在重复记录,请重新选择！');\n    return;\n  }\n  //如果需要具体提示到某一对【转出科目】+【取数科目】的差别，请使用Ext.Array.difference\n  //保存操作\n  var saveRows = Wb.getModified(app.detailInfoGrid);\n  //执行编辑时的保存操作\n     Wb.request({\n       url:'m?xwl=xc/gl/final-carryover/data/update-jz-model',\n       message:'请求处理中....',\n       params:{'mainData':Wb.encode(templateMainJson),'operateData':Wb.encode(saveRows)},\n       success:function(response){\n         Wb.info('保存成功！',function(){\n           app.detailInfoGrid.getStore().reload();\n         });\n       },\n       failure:function(response){\n         Wb.info('保存失败！');\n       }\n     }); \n    },\n    failure:function(response){\n      Wb.info('查询结转模板明细信息失败,请重试！');\n    }\n  });\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#cancelBtn#}","itemId":"modelCancelBtn","iconCls":"cancel_icon"},"events":{"click":"app.editModeWin.close();"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"array"}],"expanded":true,"type":"window"},{"configs":{"title":"{#createVoucher#}","height":"120","layout":"column","width":"450","closeAction":"hide","resizable":"false","buttonAlign":"center","border":"false","itemId":"createVoucherWin","modal":"true"},"events":{"beforeshow":"app.periodCode.setValue('');\napp.periodCombox.setValue('');","close":"app.modelGrid.getStore().load();"},"children":[{"configs":{"tagConfigs":"columnWidth:0.55","labelWidth":"90","labelAlign":"right","padding":"15 10 10 0","itemId":"periodCombox","fieldLabel":"{#accountingDate#}"},"events":{"change":"//截取会计日期的前7位作为会计期，并判断该会计期是否存在，若不存在，给出提示\nif(Ext.isEmpty(newValue)){\n   app.periodCode.setValue('');\n}else{\n  var formatDate = Ext.Date.format(newValue,'Y-m-d');\n  var validPeriodCode = formatDate.substring(0,7);\n Wb.request({\n  url:'m?xwl=xc/gl/final-carryover/data/select-jz-ledger-period',\n  params:{ledgerId:app.ledgerCombox.getValue(),'voucherPeriodCode':validPeriodCode},\n  success:function(response){\n    var returnObj = Wb.decode(response.responseText);\n    var _returnRows = returnObj.rows;\n    if(_returnRows.length === 0){\n      Wb.info('账簿会计期【'+validPeriodCode+'】不存在或未开启');\n      app.periodCode.setValue('');\n    }else{\n      app.periodCode.setValue(validPeriodCode);\n    }\n  }\n});\n}\n"},"children":[],"expanded":true,"type":"date"},{"configs":{"tagConfigs":"columnWidth:0.40","labelWidth":"60","readOnly":"true","labelAlign":"right","padding":"15 0 10 10","itemId":"periodCode","fieldLabel":"{#accountingPeriod#}"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"buttons"},"children":[{"configs":{"text":"{#acceptBtn#}","itemId":"acceptBtn","iconCls":"ok_icon"},"events":{"click":"if(Ext.isEmpty(app.periodCombox.getValue())){\n  Wb.info('请选择生成凭证的会计日期！');\n}else if(Ext.isEmpty(app.periodCode.getValue())){\n  Wb.info('生成凭证的会计期不能为空！');\n}else{\n  var _confirmRows = app.modelGrid.getSelection();\n    var _jzTplId = '';\n  if(_confirmRows === null || _confirmRows.length === 0){\n    _jzTplId = app.jzTplId.getValue();\n  }else{\n    _jzTplId = _confirmRows[0].data.JZ_TPL_ID;\n  }\n  Wb.request({\n    url:'{#contextPath#}/ledgerPeriodManageAction.do?method=convertModelToVoucher',\n    message:'请求处理中....',\n    timeout:10*60*1000,\n    params:{'jzTplId':_jzTplId,'periodCode':app.periodCode.getValue(),'voucherDate':app.periodCombox.getValue()},\n    success:function(response){\n      var returnObj = Wb.decode(response.responseText);\n      if(returnObj.flag === '0'){\n         app.createVoucherWin.close();\n         Wb.run({\n            url:'m?xwl=xc/gl/journal/v-windows/new-voucher-win',\n            params : {\n              'optype'   : 'modify',\n              'headId'   : returnObj.headId,\n              'ledgerId' : returnObj.ledgerId,\n              'vt'       : returnObj.vt\n            },\n           success:function(appObj){\n             appObj.initWindow({\n                 title :'凭证修改',\n                 ledgerId :  returnObj.ledgerId\n              });\n           }\n         }); \n      }else{\n        Wb.info(returnObj.msg);\n      }\n    },\n    failure:function(response){\n      Wb.info('生成凭证失败！');\n    }\n  });\n}\n\n\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#cancelBtn#}","itemId":"cancelBtn","iconCls":"cancel_icon"},"events":{"click":"app.createVoucherWin.close();"},"children":[],"expanded":false,"type":"button"}],"expanded":false,"type":"array"}],"expanded":false,"type":"window"},{"configs":{"title":"{#viewLog#}","height":"500","layout":"fit","width":"850","closeAction":"hide","resizable":"true","border":"false","itemId":"CreateLogsView","modal":"true"},"children":[{"configs":{"multiSelect":"false","selType":"checkboxmodel","itemId":"logsGrid","editable":"false"},"children":[{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#rownum#}","width":"45","align":"center","xtype":"rownumberer","titleAlign":"center","itemId":"rowNumber"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#logContent#}","dataIndex":"JZ_LOG_DESC","itemId":"JZ_LOG_DESC","renderer":"metaData.style = 'overflow:auto;padding: 3px 6px;text-overflow: ellipsis;white-space: nowrap;white-space:normal;line-height:14px;';   \nmetaData.tdAttr = 'data-qtip=\"' + value + '\"';\nreturn value;","flex":"8"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#creator#}","dataIndex":"CREATED_BY","itemId":"CREATED_BY","flex":"2"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#executionTime#}","dataIndex":"CREATION_DATE","itemId":"CREATION_DATE","flex":"3"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"pageSize":"-1","itemId":"store","url":"m?xwl=xc/gl/final-carryover/data/select-jz-create-logs"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"grid"}],"expanded":false,"type":"window"},{"configs":{"title":"{#la_moduleCopy#}","height":"500","layout":"fit","width":"850","closeAction":"hide","resizable":"true","border":"false","itemId":"moduleCopyWin","modal":"true"},"children":[{"configs":{"multiSelect":"true","selType":"checkboxmodel","itemId":"copyLedgerGrid","editable":"false"},"children":[{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#rownum#}","width":"45","align":"center","xtype":"rownumberer","titleAlign":"center","itemId":"rowNumber"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#ledgerLabel#}","dataIndex":"LEDGER_NAME","itemId":"LEDGER_NAME_COPY","flex":"2"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#la_accHrcyName#}","dataIndex":"ACC_HRCY_NAME","itemId":"ACC_HRCY_NAME_COPY","flex":"3"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"pageSize":"-1","itemId":"store","url":"m?xwl=xc/gl/final-carryover/data/select-jz-copy-ledger"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"grid"},{"configs":{"itemId":"buttons"},"children":[{"configs":{"text":"{#acceptBtn#}","itemId":"acceptCopyBtn","iconCls":"ok_icon"},"events":{"click":"/*复制选中的模板到指定的账簿\n *待复制账簿的科目体系与所选模板账簿的科目体系一致\n */\nvar _copyRecords = app.copyLedgerGrid.getSelection();\nif(_copyRecords.length === 0){\n  Wb.info('{#la_copyMsg#}');\n}else{\n  var _selModelRow = app.modelGrid.getSelection();\n  var _selJzTplId = _selModelRow[0].data.JZ_TPL_ID;\n  var _copyArray = [];\n  Ext.each(_copyRecords,function(a){\n    var copyUnit = {    'SOURCE_JZ_ID':_selJzTplId,\n                        'JZ_TPL_ID':'',\n                        'LEDGER_ID':a.data.LEDGER_ID\n                        };\n    _copyArray.push(copyUnit);\n  });\n Wb.request({\n   url:'m?xwl=xc/gl/final-carryover/data/select-copy-jz-tpl',\n   params:{'jzTplId':_selJzTplId},\n   success:function(response){\n     var _copyReturnObj = Wb.decode(response.responseText);\n      Wb.request({\n        url:'m?xwl=xc/gl/final-carryover/data/copy-jz-model',\n        message:'请求处理中....',\n        timeout:10*60*1000,\n        params:{'copyData':Wb.encode(_copyArray),'subData':Wb.encode(_copyReturnObj.rows)},\n        success:function(response){\n          Wb.info('复制成功！');\n          app.moduleCopyWin.close();\n        },\n        failure:function(response){\n          Wb.info('操作失败！');\n        }\n});\n  },\n  failure:function(response){\n    Wb.info('操作失败！');\n  }\n });\n}\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#cancelBtn#}","itemId":"cancelCopyBtn","iconCls":"cancel_icon"},"events":{"click":"app.moduleCopyWin.close();"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"array"}],"expanded":true,"type":"window"}],"expanded":true,"type":"folder"},{"configs":{"layout":"border","itemId":"viewport"},"children":[{"configs":{"region":"north","title":"{#setTitle#}","height":"45","layout":"column","itemId":"querySet"},"children":[{"configs":{"tagConfigs":"baseCls:'my-panel-no-border'","frame":"true","layout":"fit","columnWidth":".35","border":"false","itemId":"panel1"},"children":[{"configs":{"labelWidth":"80","displayField":"LEDGER_NAME","valueField":"LEDGER_ID","labelAlign":"right","itemId":"ledgerCombox","fieldLabel":"{#ledgerLabel#}"},"events":{"select":"app.modelGrid.getStore().load();","beforequery":"var combo = plan.combo;\nif (!plan.forceAll) {\n  var value = plan.query;\n  combo.store.filterBy(function(record, id) {\n    var text = record.get(combo.displayField);\n    return (text.indexOf(value) != -1);\n  });\n  combo.expand();\n  return false;\n}"},"children":[{"configs":{"pageSize":"-1","autoLoad":"true","itemId":"store","url":"m?xwl=xc/com-qry/gl-ledgers/select-sec-fd-ledgers"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"fieldset"},{"configs":{"region":"center","selType":"checkboxmodel","itemId":"modelGrid"},"events":{"itemdblclick":"app.editModel.fireEvent('click');"},"children":[{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#rownum#}","width":"45","align":"center","xtype":"rownumberer","titleAlign":"center","itemId":"rowNumber"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#ledgerLabel#}","dataIndex":"LEDGER_NAME","itemId":"LEDGER_NAME_COL","flex":"3"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#modelName#}","dataIndex":"JZ_TPL_NAME","itemId":"MODEL_NAME_COL","flex":"3"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#modelSummary#}","dataIndex":"SUMMARY","itemId":"MODEL_SUMMARY","flex":"5"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"autoLoad":"false","itemId":"store","url":"m?xwl=xc/gl/final-carryover/data/query-carryover-model"},"events":{"beforeload":"var _ledgerId = app.ledgerCombox.getValue();\nstore.proxy.extraParams.ledgerId = _ledgerId;"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"-","itemId":"item1"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#addBtn#}","itemId":"addModel","iconCls":"file_add_icon"},"events":{"click":"var win = new Ext.window.Window(app._editModeWin);\nwin.show();\nwin.setIconCls('record_add_icon');\napp.jzTplId.setValue('-1');\nWb.setTitle(win, '新增结转模板');"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item2"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#editBtn#}","itemId":"editModel","iconCls":"file_edit_icon"},"events":{"click":"var _editRow = app.modelGrid.getSelection();\nif(_editRow.length !== 1){\n  Wb.info('请选择一条要编辑的记录！');\n}else{\n  var win = new Ext.window.Window(app._editModeWin); \n  win.show(null,function(){\n      var _editTplJzId = _editRow[0].data.JZ_TPL_ID;\n      //主鍵\n      app.jzTplId.setValue(_editTplJzId);             \n      var _editAccHrcyId = _editRow[0].data.ACC_HRCY_ID;\n      //科目体系\n      app.accHrcyId.setValue(_editAccHrcyId);\n      //账簿\n      app.ledgerName.getStore().load(function(){\n        app.ledgerName.setValue(_editRow[0].data.LEDGER_ID);\n      });\n      //名称\n      app.modelName.setValue(_editRow[0].data.JZ_TPL_NAME);\n      //凭证类型\n      app.voucherCategory.setValue(_editRow[0].data.V_CATEGORY_ID);\n      //转入科目\n      app.accountName.setValue(_editRow[0].data.ACC_NAME);\n      app.account.setValue(_editRow[0].data.ZR_ACC_ID);\n      //辅助段名称和编码\n      app.accountAssist.setValue(_editRow[0].data.ACC_SEGMENTS);\n      app.accountCodeAssist.setValue(_editRow[0].data.SEG_CODE_UNION);\n      //摘要\n      app.modelSummary.setValue(_editRow[0].data.SUMMARY);\n      //方向\n      app.accountDirect.setValue(_editRow[0].data.ZR_ACC_DR);\n      win.setIconCls('record_edit_icon');\n      Wb.setTitle(win, '编辑结转模板');\n      //只读账簿和转入科目\n      app.ledgerName.setReadOnly(true);\n      app.accountName.setReadOnly(true);\n      app.detailInfoGrid.getStore().load({params:{'accHrcyId':_editAccHrcyId,'jzTplId':_editTplJzId}});\n  });\n\n}\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item3"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#delBtn#}","itemId":"delModel","iconCls":"file_delete_icon"},"events":{"click":"var rows = app.modelGrid.getSelection();\nif(rows.length ===0){\n  Wb.info('请选择要删除的记录!');\n}else{\n  Wb.confirm('您确定要删除所选的记录吗？',function(){\n       Wb.request({\n         url:'m?xwl=xc/gl/final-carryover/data/delete-jz-model',\n         params:{destroy: Wb.getData(rows)},\n         success:function(){\n           Wb.info('删除成功！');\n           Wb.remove(app.modelGrid,rows);\n         }\n       });\n  });\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item4"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#createVoucher#}","itemId":"createVoucher","iconCls":"script_icon"},"events":{"click":"var _editRow = app.modelGrid.getSelection();\nif(_editRow.length !== 1){\n  Wb.info('请选择一条要编辑的记录！');\n}else{\n  var _createLedgerId = _editRow[0].data.LEDGER_ID;\n  app.createVoucherWin.show();\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item5"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#viewLog#}","itemId":"viewLog","iconCls":"book_icon"},"events":{"click":"var _editRow = app.modelGrid.getSelection();\nif(_editRow.length !== 1){\n  Wb.info('请选择一条要查看日志信息的记录！');\n}else{\n  var _createLedgerId = _editRow[0].data.JZ_TPL_ID;\n  app.CreateLogsView.show(null,function(){\n    app.logsGrid.getStore().load({params:{'JZ_TPL_ID':_createLedgerId}});\n  });\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item6"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#copyBtn#}","itemId":"modelCopyBtn","iconCls":"record_copy_icon"},"events":{"click":"var _editRow = app.modelGrid.getSelection();\nif(_editRow.length !== 1){\n  Wb.info('{#la_copyWarn#}');\n}else{\n  var _createLedgerId = _editRow[0].data.LEDGER_ID;\n  var _copyLedger = app.ledgerCombox.findRecord('LEDGER_ID',_createLedgerId);\n  var _cpoyAccHrcyId = _copyLedger.data.ACC_HRCY_ID;\n  app.moduleCopyWin.show(null,function(){\n    app.copyLedgerGrid.getStore().load({params:{'noCopyLedger':_createLedgerId,'copyHrcyId':_cpoyAccHrcyId}});\n  });\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item7"},"children":[],"expanded":false,"type":"item"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":false,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}