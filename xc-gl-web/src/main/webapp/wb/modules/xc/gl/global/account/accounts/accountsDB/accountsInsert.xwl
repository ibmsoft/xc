{"inframe":false,"title":"科目新增","hidden":false,"roles":{"default":1},"children":[{"configs":{"loginRequired":"false","serverScript":"//检查是否存在重复的ACC_CODE\napp.run('select 1 from xc_gl_accounts where ACC_CODE={?ACC_CODE?} and ACC_HRCY_ID={?ACC_HRCY_ID?}',{\n    errorText: '编码\"' + app.get('ACC_CODE') + '\" 已经存在。'\n});\napp.run('select 1 from xc_gl_accounts where ACC_NAME={?ACC_NAME?} and ACC_HRCY_ID={?ACC_HRCY_ID?}',{\n    errorText: '名称\"' + app.get('ACC_NAME') + '\" 已经存在。'\n});\n//检查是否被科目组合占用，若是占用，不能添加下级\napp.run(\"SELECT 1 FROM xc_gl_ccid gc,xc_gl_accounts ga,xc_gl_ledgers gl WHERE gc.ACC_ID = ga.ACC_ID AND gc.LEDGER_ID = gl.LEDGER_ID AND ga.ACC_HRCY_ID = gl.ACC_HRCY_ID AND ga.ACC_CODE = {?TEMP_ACC_CODE?} AND ga.IS_LEAF = 'Y' AND ga.ACC_HRCY_ID = {?ACC_HRCY_ID?}\",{\n\terrorText: '上级编码\"' + app.get('TEMP_ACC_CODE') + '\" 已经被使用，不能添加下级。'\n});\napp.run(\"UPDATE xc_gl_accounts SET IS_LEAF = 'N' WHERE ACC_CODE = {?TEMP_ACC_CODE?} and ACC_HRCY_ID={?ACC_HRCY_ID?}\",{});","itemId":"module"},"children":[{"configs":{"sql":"INSERT INTO xc_gl_accounts (\n\tACC_ID,\n\tACC_CODE,\n\tACC_NAME,\n\tUP_ACC_CODE,\n\tACC_CATEGORY_CODE,\n\tACC_GROUP_ID,\n\tACC_HRCY_ID,\n\tBALANCE_DIRECTION,\n\tIS_BANK_ACC,\n\tIS_CASH_ACC,\n\tIS_CASH_ITEM,\n\tSTART_DATE,\n\tEND_DATE,\n\tIS_LEAF,\n\tACC_LEVEL,\n\tASS_KEY,\n\tCREATION_DATE,\n\tCREATED_BY,\n    LAST_UPDATE_DATE,\n    LAST_UPDATED_BY\n)\nVALUES\n(\n    {?ACC_ID?},\n    {?ACC_CODE?},\n    {?ACC_NAME?},\n    {?UP_ACC_CODE?},\n    {?ACC_CATEGORY_CODE?},\n    {?ACC_GROUP_ID?},\n    {?ACC_HRCY_ID?},\n    {?BALANCE_DIRECTION?},\n    {?IS_BANK_ACC?},\n    {?IS_CASH_ACC?},\n    {?IS_CASH_ITEM?},\n    {?START_DATE?},\n    {?END_DATE?},\n    'Y',\n    {?ACC_LEVEL?},\n    {?ASS_KEY?},\n    {?timestamp.sys.date?},\n    {?XIP.userId?},\n    {?timestamp.sys.date?},\n    {?XIP.userId?}\n)","itemId":"query1"},"children":[],"expanded":false,"type":"query"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}