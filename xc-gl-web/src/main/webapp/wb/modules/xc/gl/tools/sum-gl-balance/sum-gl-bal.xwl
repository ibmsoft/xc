{"inframe":false,"title":"按凭证汇总总账科目余额表","hidden":false,"roles":{"default":1},"children":[{"configs":{"serverScript":"request.setAttribute(\"ctxPath\",request.getContextPath()) ;","itemId":"module"},"children":[{"configs":{"title":"凭证汇总","height":"200","width":"400","layout":"fit","closeAction":"hide","dialog":"true","itemId":"sumWin","modal":"true"},"events":{"ok":"var records  = app.grid1.getSelection() ;\n\nif(records.length === 0){\n  Wb.toast('请选择凭证信息') ;\n  return false ;\n}\n\n// 参数信息\nvar headArray = [] ;\nfor(var i=0; i<records.length; i++){\n  var headId = records[i].data.V_HEAD_ID ; \n  var headJo = {'V_HEAD_ID':headId} ;\n  headArray.push(headJo) ;\n}\nvar isAccount = app.isSumAcc.getValue() ;\nvar isSumCash = app.isSumCash.getValue() ;\nvar isCanceled = app.isCanceled.getValue() ;\n\nvar store = app.ledgers.getStore() ;\nvar idx = store.find('LEDGER_ID',app.ledgers.getValue()) ;\nvar r = store.getAt(idx) ;\nvar hrcyId = r.get('ACC_HRCY_ID') ;\n\n// 提交请求\nWb.request({\n  url: '{#ctxPath#}'+'/sumBalanceAction.do?method=sumGLBal',\n  timeout : 3600000,\n  params: {\n    'headArray' : Wb.encode(headArray),\n    'hrcyId' : hrcyId ,\n    'isAccount' : isAccount ,\n    'isSumCash' : isSumCash ,\n    'isCanceled' : isCanceled \n  },\n  success: function(resp) {\n    var response = Wb.decode(resp.responseText) ;\n    Wb.info(response.msg) ;\n  }\n});"},"children":[{"configs":{"layout":"form","bodyPadding":"10","itemId":"form1"},"children":[{"configs":{"labelWidth":"90","queryMode":"local","displayField":"NAME","value":"N","valueField":"CODE","labelAlign":"right","itemId":"isSumAcc","fieldLabel":"提交/过账"},"children":[{"configs":{"data":"[{'CODE':'N','NAME':'提交'},{'CODE':'Y','NAME':'过账'}]","itemId":"store","fields":"[{name:'CODE'},{name:'NAME'}]"},"children":[],"expanded":false,"type":"store"}],"expanded":false,"type":"combo"},{"configs":{"labelWidth":"90","queryMode":"local","displayField":"NAME","value":"ALL","valueField":"CODE","labelAlign":"right","itemId":"isSumCash","fieldLabel":"科目与现金"},"children":[{"configs":{"data":"[{'CODE':'ALL','NAME':'全部'},{'CODE':'BA','NAME':'科目余额'},{'CODE':'CA','NAME':'现金流量'}]","itemId":"store","fields":"[{name:'CODE'},{name:'NAME'}]"},"children":[],"expanded":false,"type":"store"}],"expanded":false,"type":"combo"},{"configs":{"labelWidth":"90","queryMode":"local","displayField":"NAME","value":"N","valueField":"CODE","labelAlign":"right","itemId":"isCanceled","fieldLabel":"取消提交"},"children":[{"configs":{"data":"[{'CODE':'Y','NAME':'是'},{'CODE':'N','NAME':'否'}]","itemId":"store","fields":"[{name:'CODE'},{name:'NAME'}]"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"}],"expanded":true,"type":"form"}],"expanded":true,"type":"window"},{"configs":{"layout":"border","itemId":"viewport1"},"children":[{"configs":{"region":"north","layout":"column","bodyPadding":"10","itemId":"form1"},"children":[{"configs":{"tagConfigs":"columnWidth:0.3","labelWidth":"60","displayField":"LEDGER_NAME","width":"300","valueField":"LEDGER_ID","labelAlign":"right","itemId":"ledgers","fieldLabel":"账簿"},"events":{"select":"app.grid1.getStore().load() ;\napp.cbxPeriod.getStore().load() ;"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/com-qry/gl-ledgers/select-sec-fd-ledgers"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"},{"configs":{"labelWidth":"50","displayField":"PERIOD_CODE","valueField":"PERIOD_CODE","labelAlign":"right","itemId":"cbxPeriod","fieldLabel":"期间"},"events":{"select":"app.grid1.getStore().load() ;"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/gl/tools/sum-gl-balance/data/select-ld-period"},"events":{"beforeload":"store.proxy.extraParams.ledgerId=app.ledgers.getValue() ;"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"},{"configs":{"tagConfigs":"columnWidth:0.2","labelWidth":"60","queryMode":"local","displayField":"NAME","value":"2","valueField":"CODE","labelAlign":"right","itemId":"cbxStatus","fieldLabel":"状态"},"events":{"select":"app.grid1.getStore().load() ;"},"children":[{"configs":{"data":"[{'CODE':'1','NAME':'草稿'},{'CODE':'2','NAME':'已提交'}]","itemId":"store","fields":"[{name:'CODE'},{name:'NAME'}]"},"children":[],"expanded":false,"type":"store"}],"expanded":false,"type":"combo"},{"configs":{"tagConfigs":"columnWidth:0.2","labelWidth":"80","displayField":"NAME","valueField":"CODE","labelAlign":"right","itemId":"cbxBookkeeper","fieldLabel":"记账状态"},"events":{"select":"app.grid1.getStore().load() ;"},"children":[{"configs":{"data":"[{'CODE':'Y','NAME':'已记账'},{'CODE':'N','NAME':'未记账'}]","itemId":"store","fields":"[{name:'CODE'},{name:'NAME'}]"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"}],"expanded":true,"type":"form"},{"configs":{"region":"center","selType":"checkboxmodel","itemId":"grid1"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/gl/tools/sum-gl-balance/data/select-vouchers"},"events":{"beforeload":"store.proxy.extraParams.ledgerId = app.ledgers.getValue() ;\nstore.proxy.extraParams.vs = app.cbxStatus.getValue() ;\nstore.proxy.extraParams.bk = app.cbxBookkeeper.getValue() ;\nstore.proxy.extraParams.pcode = app.cbxPeriod.getValue() ;"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"汇总","itemId":"btnSum","iconCls":"total_icon"},"events":{"click":"app.sumWin.show();"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"序号","xtype":"rownumberer","align":"center","width":"50","itemId":"rownum"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"账簿ID","hidden":"true","dataIndex":"LEDGER_ID","titleAlign":"center","itemId":"LEDGER_ID"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"凭证ID","hidden":"true","dataIndex":"V_HEAD_ID","titleAlign":"center","itemId":"V_HEAD_ID"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"期间","dataIndex":"PERIOD_CODE","titleAlign":"center","itemId":"PERIOD_CODE"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"凭证编号","dataIndex":"V_SERIAL_NUM","titleAlign":"center","itemId":"V_SERIAL_NUM"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"摘要","width":"300","dataIndex":"SUMMARY","titleAlign":"center","itemId":"V_SUMMARY"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"金额","align":"right","dataIndex":"TOTAL_AMT","format":"0,000.00","titleAlign":"center","itemId":"TOTAL_AMT","tooltip":" "},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"状态","dataIndex":"V_STATUS","titleAlign":"center","itemId":"V_STATUS","renderer":"if(value == '1'){\n  return '草稿' ;\n}else if(value =='2'){\n  return '已提交' ;\n}else{\n  return value ;\n}"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"汇总标志","dataIndex":"SUM_FLAG","titleAlign":"center","itemId":"SUM_FLAG","renderer":"if(value == 'Y'){\n  return '已汇总' ;\n}else if(value == 'N'){\n  return '未汇总' ;\n}else{\n  return value ;\n}"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"创建人","dataIndex":"V_CREATED_NAME","titleAlign":"center","itemId":"V_CREATED_NAME"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"审核人","dataIndex":"V_VERIFIER","titleAlign":"center","itemId":"V_VERIFIER"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"签字人","dataIndex":"V_SIGNATORY","titleAlign":"center","itemId":"V_SIGNATORY"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"记账人","dataIndex":"V_BOOKKEEPER","titleAlign":"center","itemId":"V_BOOKKEEPER"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":"total_icon"}