{"inframe":false,"title":"","hidden":false,"roles":{"default":1},"children":[{"configs":{"title":"{#moduleTitle#}","initScript":"request.setAttribute('contextPath',request.getContextPath());\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xc/gl/global/cash-items/cash-items\");","loginRequired":"false","jsLinks":"[\"XCloud/js/createAssKey.js\",\"platform/util/platformUtil.js\"]","itemId":"module"},"events":{"initialize":"var _ass_key;\nvar id;\nvar v_ca_id;\nvar p_flag;\nvar s_flag;\nfunction beforeDropType(node, data, overModel, dropPosition, options) {\n  //拖动节点id\n  var srcId = data.records[0].get('id');\n  Wb.request({\n    url:'m?xwl=xc/gl/global/cash-items/cash-itemsDB/selectCaId',\n    params:{'CA_ID':srcId},\n    success:function(resp){\n      var rec = Wb.decode(resp.responseText);\n      var caId = rec.rows[0].CA_ID;\n      var upId = rec.rows[0].UP_ID;\n      if(rec.total==1){//该父节点下已经没有子节点，更新is_leaf为Y\n        Wb.request({\n          url:'m?xwl=xc/gl/global/cash-items/cash-itemsDB/updateIs_leaf_Y',\n          params:{'CA_ID':upId},\n          success:function(resp){\n\n          }\n        });\n      }\n    }\n  });\n  return true;\n}\nfunction dropType(node, data, overModel, dropPosition, options) {\n  Wb.mask(app.tree1);\n  //树的根节点\n  var rootNode = app.tree1.getRootNode();\n  //父节点id\n  var parentId = '';\n  //拖动节点id\n  var srcId = data.records[0].get('id');\n  //拖动节点新生成的排序号\n  var orderNum = '';\n  //拖动节点level\n  var ca_level = data.records[0].get('CA_LEVEL');\n  //判断是否添加到根节点\n  if(overModel == rootNode){\n    Wb.unmask(app.tree1);\n    parentId = -1;\n    orderNum = overModel.lastChild.previousSibling ? Number(overModel.lastChild.previousSibling.get('ORDERBY')) + 1 : 0;\n    \n  }else{\n    if(dropPosition==='append'){//拖动为子节点 append\n       parentId = overModel.get('id');\n       orderNum = 2;\n      //展开拖动到的节点，为了获取拖动到节点的子节点。\n      overModel.expand(false,function(){\n        Wb.unmask(app.tree1);\n        parentId = overModel.get('id');\n        orderNum = overModel.lastChild.previousSibling ? Number(overModel.lastChild.previousSibling.get('ORDERBY')) + 1 : 0;\n      });\n      //判断选中节点是否可以拖拽到该节点下\n      \n      \n      \n          \n    }else if(dropPosition==='before'){//拖动到节点前 before\n      Wb.unmask(app.tree1);\n      //判断根节点节点\n      if(overModel.parentNode == rootNode){\n        parentId = -1;\n      }else{\n        parentId = overModel.parentNode.get('id');\n      }\n      //判断选中节点是否可以拖拽到该节点下\n     \n      \n     \n      orderNum = overModel.get('ORDERBY');\n    }else{//拖动到节点后 after\n      Wb.unmask(app.tree1);\n      if(overModel.parentNode == rootNode){\n        parentId = -1;\n      }else{\n        parentId = overModel.parentNode.get('id');\n      }\n      orderNum = overModel.get('ORDERBY') + 1;\n      //判断选中节点是否可以拖拽到该节点下\n     \n      \n    }\n   \n  }\n  \n   //判断选中节点是否可以拖拽到该节点下\n     Wb.request({\n    \turl:'m?xwl=xc/gl/global/cash-items/cash-itemsDB/selectLevel_3',\n      \tparams:{'CA_ID':srcId},\n      \tsuccess:function(resp){\n          var rec = Wb.decode(resp.responseText);\n          if(rec.rows[0].cno>0){\n            s_flag = 3;//节点深度为3\n          }else{\n          \tWb.request({\n            \turl:'m?xwl=xc/gl/global/cash-items/cash-itemsDB/selectLevel_2',\n              \tparams:{'CA_ID':srcId},\n              success:function(resp){\n              \tvar rec = Wb.decode(resp.responseText);\n                if(rec.rows[0].cno>0){\n                  s_flag = 2;//节点深度为2\n                }else{\n                  s_flag = 1;//节点深度为1\n                }\n              }\n            });\n          }\n        }\n    });\n  \n   if(dropPosition=='append'){\n            if(overModel.get('CA_LEVEL')==1){//该节点的层次\n              if(s_flag==3){//节点深度为3\n                Wb.toast('选中节点不能拖动到该节点下！');\n                \n                return;\n              }\n            }else if(overModel.get('CA_LEVEL')==2){\n              if(s_flag==2||s_flag==3){//节点深度为2或3\n                Wb.toast('选中节点不能拖动到该节点下！');\n               \n                return;\n              }\n            }\n          }else{\n            if(overModel.parentNode.get('CA_LEVEL')==1){//该节点的父节点的层次\n              if(s_flag==3){//节点深度为3\n                Wb.toast('选中节点不能拖动到该节点下！');\n               \n                return;\n              }\n            }else if(overModel.parentNode.get('CA_LEVEL')==2){//该节点的父节点的层次\n              if(s_flag==2||s_flag==3){//节点深度为2或3\n                Wb.toast('选中节点不能拖动到该节点下！');\n                \n                return;\n              }\n            }\n  }\n  \n  if(parentId!==null || parentId!==''){\n    Wb.request({\n    url: 'm?xwl=xc/gl/global/cash-items/cash-itemsDB/updateNode',\n    params: {parentId:parentId, orderby:orderNum, caId: srcId},\n    async : false,\n    success: function(response){\n      if(dropPosition == 'append'){\n        //动态修改节点属性值\n        overModel.lastChild.set('parent_id', parentId);\n        overModel.lastChild.set('ORDERBY', orderNum);\n        overModel.commit();\n        //更新父级的is_leaf\n        Wb.request({\n        \turl:'m?xwl=xc/gl/global/cash-items/cash-itemsDB/updateIs_leaf_N',\n          \tparams:{'CA_ID':parentId},\n          \tsuccess:function(resp){\n            \n            }\n        });\n        //更新节点的level\n        if(parentId==-1){\n          Wb.request({\n          \t\turl:'m?xwl=xc/gl/global/cash-items/cash-itemsDB/updateLevel',\n            \tparams:{'CA_LEVEL':1,'CA_ID':srcId}\n          });\n           Wb.request({\n              url:'m?xwl=xc/gl/global/cash-items/cash-itemsDB/selectLevel_2',\n              params:{'CA_ID':srcId},\n              success:function(resp){\n                var rec_2 = Wb.decode(resp.responseText);\n                if(rec_2.total>0){\n                  for(var i=0;i<rec_2.total;i++){\n                    Wb.request({\n                      url:'m?xwl=xc/gl/global/cash-items/cash-itemsDB/updateLevel',\n                      params:{'CA_LEVEL':2,'CA_ID':rec_2.rows[i].CA_ID}\n          });\n                  }\n                }\n              }\n           });\n           \n        }else{\n        \t Wb.request({\n          \t\turl:'m?xwl=xc/gl/global/cash-items/cash-itemsDB/updateLevel',\n            \tparams:{'CA_LEVEL':overModel.get('CA_LEVEL')+1,'CA_ID':srcId}\n          });\n           Wb.request({\n              url:'m?xwl=xc/gl/global/cash-items/cash-itemsDB/selectLevel_2',\n              params:{'CA_ID':srcId},\n              success:function(resp){\n                var rec_2 = Wb.decode(resp.responseText);\n                if(rec_2.total>0){\n                  for(var i=0;i<rec_2.total;i++){\n                    Wb.request({\n                      url:'m?xwl=xc/gl/global/cash-items/cash-itemsDB/updateLevel',\n                      params:{'CA_LEVEL':overModel.get('CA_LEVEL')+2,'CA_ID':rec_2.rows[i].CA_ID}\n          });\n                  }\n                }\n              }\n           });\n          \n        }\n         app.tree1.store.load();\n      }else{\n        var hasReachSrcNode = false;\n        if(parentId==-1){\n          \t\tWb.request({\n          \t\turl:'m?xwl=xc/gl/global/cash-items/cash-itemsDB/updateLevel',\n            \tparams:{'CA_LEVEL':1,'CA_ID':srcId}\n          });\n           Wb.request({\n              url:'m?xwl=xc/gl/global/cash-items/cash-itemsDB/selectLevel_2',\n              params:{'CA_ID':srcId},\n              success:function(resp){\n                var rec_2 = Wb.decode(resp.responseText);\n                if(rec_2.total>0){\n                  for(var i=0;i<rec_2.total;i++){\n                    Wb.request({\n                      url:'m?xwl=xc/gl/global/cash-items/cash-itemsDB/updateLevel',\n                      params:{'CA_LEVEL':2,'CA_ID':rec_2.rows[i].CA_ID}\n          });\n                  }\n                }\n              }\n           });\n        }else{\n        \t Wb.request({\n          \t\turl:'m?xwl=xc/gl/global/cash-items/cash-itemsDB/updateLevel',\n            \tparams:{'CA_LEVEL':overModel.parentNode.get('CA_LEVEL')+1,'CA_ID':srcId}\n          });\n           Wb.request({\n              url:'m?xwl=xc/gl/global/cash-items/cash-itemsDB/selectLevel_2',\n              params:{'CA_ID':srcId},\n              success:function(resp){\n                var rec_2 = Wb.decode(resp.responseText);\n                if(rec_2.total>0){\n                  for(var i=0;i<rec_2.total;i++){\n                    Wb.request({\n                      url:'m?xwl=xc/gl/global/cash-items/cash-itemsDB/updateLevel',\n                      params:{'CA_LEVEL':overModel.parentNode.get('CA_LEVEL')+2,'CA_ID':rec_2.rows[i].CA_ID}\n          });\n                  }\n                }\n              }\n           });\n        }\n        overModel.eachChild(function(cNode) {\n          //判断是否为拖动的节点\n          if(cNode.get('id') == srcId){\n            cNode.set('parent_id', parentId);\n            cNode.set('ORDERBY', orderIndex);\n            cNode.commit();\n             \n          }\n         \n         \n          //拖动节点后面的节点序号+1\n          var i = Number(cNode.get('ORDERBY'));\n          if (i >= orderNum) {\n            cNode.set('ORDERBY', i + 1);\n            cNode.commit();\n          }\n        });\n         app.tree1.store.load();\n      }\n    },\n    failure:function(response){\n    }\n  });\n   \n  }\t \n}\n\n"},"children":[{"configs":{"itemId":"windows"},"children":[{"configs":{"height":"210","layout":"fit","width":"600","closeAction":"hide","buttonAlign":"center","border":"false","itemId":"rightClickWindow","dialog":"false","modal":"true"},"events":{"close":"app.tree1.store.load();"},"children":[{"configs":{"frame":"true","layout":"form","border":"false","itemId":"rightClickForm"},"children":[{"configs":{"hidden":"true","layout":"form","border":"false","itemId":"panel1"},"children":[{"configs":{"itemId":"CA_ID","fieldLabel":"现金流量项ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"120","hidden":"true","labelAlign":"right","itemId":"IS_LEAF","fieldLabel":"末级"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"ORDERBY","fieldLabel":"排序号"},"children":[],"expanded":false,"type":"text"}],"expanded":false,"type":"panel"},{"configs":{"tagConfigs":"baseCls:'my-panel-no-border'","layout":"column","border":"false","itemId":"panel2"},"children":[{"configs":{"tagConfigs":"columnWidth:0.45","labelWidth":"120","labelAlign":"right","itemId":"CA_NAME","fieldLabel":"<font color='red'>*<\/font>现金流量项名称"},"events":{"blur":"var ca_name = app.CA_NAME.getValue();\n_ass_key = getAssKey(ca_name);\napp.ASS_KEY.setValue(_ass_key);\n  \n"},"children":[],"expanded":false,"type":"text"},{"configs":{"tagConfigs":"columnWidth:0.45","labelWidth":"120","displayField":"VAL_NAME","valueField":"VAL_CODE","typeAhead":"false","labelAlign":"right","itemId":"CA_DIRECTION","fieldLabel":"{#la_cashItemDirect#}","editable":"false"},"children":[{"configs":{"itemId":"store","autoLoad":"true","url":"m?xwl=xc/gl/global/cash-items/cash-itemsDB/selectDirection"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls:'my-panel-no-border'","layout":"column","border":"false","itemId":"panel21"},"children":[{"configs":{"tagConfigs":"columnWidth:0.45","labelWidth":"120","readOnly":"true","allowBlank":"false","hidden":"true","labelAlign":"right","itemId":"ASS_KEY","fieldLabel":"助记符"},"children":[],"expanded":false,"type":"text"},{"configs":{"tagConfigs":"columnWidth:0.45","labelWidth":"120","readOnly":"true","labelAlign":"right","itemId":"UP_CODE","fieldLabel":"{#la_upcode#}"},"children":[],"expanded":false,"type":"text"},{"configs":{"tagConfigs":"columnWidth:0.45","labelWidth":"120","allowBlank":"false","labelAlign":"right","itemId":"CA_CODE","fieldLabel":"{#la_necessaryCode#}"},"events":{"blur":"/*var ca_code = app.CA_CODE.getValue();;\nWb.request({\n\turl:'m?xwl=xc/gl/global/cash-items/cash-itemsDB/selectByCode',\n  \tparams:{'CA_CODE':ca_code,'CA_ID':id},\n  \tsuccess:function(resp){\n    \tvar is_exist = Ext.decode(resp.responseText).total;\n        if(is_exist!=0){\n          Wb.info('该现金流量项编码已存在，请重新输入');\n        }\n    }\n});*/"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls:'my-panel-no-border'","layout":"column","border":"false","itemId":"panel22"},"children":[{"configs":{"tagConfigs":"columnWidth:0.45","labelWidth":"120","labelAlign":"right","itemId":"CA_DESC","fieldLabel":"{#la_description#}"},"children":[],"expanded":false,"type":"text"},{"configs":{"tagConfigs":"columnWidth:0.45","labelWidth":"120","readOnly":"true","labelAlign":"right","itemId":"CA_LEVEL","fieldLabel":"{#la_level#}"},"children":[],"expanded":false,"type":"number"},{"configs":{"tagConfigs":"columnWidth:0.45","labelWidth":"120","readOnly":"true","hidden":"true","labelAlign":"right","itemId":"UP_ID","fieldLabel":"上级ID"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls:'my-panel-no-border'","layout":"column","border":"false","itemId":"panel23"},"children":[{"configs":{"tagConfigs":"columnWidth:0.45","labelWidth":"120","labelAlign":"right","itemId":"START_DATE","fieldLabel":"{#la_startDate#}"},"events":{"blur":"var start_date = app.START_DATE.getValue();\nvar end_date = app.END_DATE.getValue();\n\nif(end_date<start_date){\n  Wb.info('开始日期不能大于结束日期');\n  app.START_DATE.setValue('');\n}"},"children":[],"expanded":false,"type":"date"},{"configs":{"tagConfigs":"columnWidth:0.45","labelWidth":"120","labelAlign":"right","itemId":"END_DATE","fieldLabel":"{#la_endDate#}"},"events":{"blur":"var start_date = app.START_DATE.getValue();\nvar end_date = app.END_DATE.getValue();\nif(end_date<start_date){\n  Wb.info('开始日期不能大于结束日期');\n  app.END_DATE.setValue('');\n}"},"children":[],"expanded":false,"type":"date"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"form"},{"configs":{"itemId":"buttons"},"children":[{"configs":{"text":"{#saveBtn#}","itemId":"saveBtn","iconCls":"save_icon"},"events":{"click":"if(Ext.util.Format.date(app.END_DATE.getValue(),'Y-m-d')==''){\napp.END_DATE.setValue(Ext.util.Format.date('9999-12-31','Y-m-d'));\n}\n\n\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"保存并添加下一个","hidden":"true","itemId":"saveBtn1","iconCls":"save_all_icon"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#cancelBtn#}","itemId":"cancelBtn","iconCls":"cancel_icon"},"events":{"click":"app.rightClickWindow.hide();"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"array"}],"expanded":false,"type":"window"},{"configs":{"maximized":"true","title":"{#la_importTitle#}","height":"400","minimizable":"true","width":"750","layout":"border","dialog":"false","border":"false","itemId":"importDataWin","modal":"true","maximizable":"true","createInstance":"false"},"events":{"close":"app.tree1.getStore().load();"},"children":[{"configs":{"region":"center","frame":"true","style":"border-width:0px","layout":"column","padding":"15 0 0 5","border":"false","itemId":"importForm"},"children":[{"configs":{"tagConfigs":"columnWidth:.35","labelWidth":"80","allowBlank":"false","emptyText":"{#la_fileTip#}","labelAlign":"left","itemId":"selectFile","fieldLabel":"{#la_fileName#}"},"children":[],"expanded":false,"type":"file"},{"configs":{"text":"{#importBtn#}","itemId":"importFile","iconCls":"ok_icon","x":"2"},"events":{"click":"if(!app.importForm.getForm().isValid()){\n  Wb.info('请选择要上传的文件！');\n  return false;\n}\nvar fileType = app.selectFile.getValue();\nif(!Ext.String.endsWith(fileType,'.xls')){\n  Wb.info('请选择以xls结尾的Office Excel文档!',function(){\n    app.importForm.getForm().reset();\n  });\n}else{\n  //导入前，先清除错误数据\n  app.importLogGrid.getStore().removeAll();\n  var msgProcessBar = Ext.Msg.show({\n     title:'提示',\n     msg  :'导入中，请稍后.....',\n     wait :true,\n     width:200\n  });\n  //将Office Excel数据导入到余额临时表中\n  app.importForm.getForm().submit({\n    url:'{#contextPath#}/glDataTransgerManageAction.do?method=importAccountData&templateCode=XC_GL_CASH_ITEMS',\n    timeout:3600*1000,\n    success:function(form,action){\n      msgProcessBar.hide();\n      Wb.info(action.result.msg,function(){\n        app.importDataWin.close();\n      });\n    },\n    failure:function(form,action){\n      msgProcessBar.hide();\n      var _flag = action.result.flag;\n      //flag =0,导入时发生异常，输出异常信息\n      if(_flag == '0'){\n        Wb.info(action.result.msg);\n      }else if(_flag == '2'){\n       //flag =2,数据导入临时表成功，数据校验发生异常\n        var _sessionId = action.result.msg;\n        Wb.info('导入数据不合法！');\n        app.importLogGrid.getStore().load({params:{'sessionId':_sessionId}});\n      }\n    }   \n  });\n}"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"form"},{"configs":{"region":"south","height":"'88%'","itemId":"southTab"},"children":[{"configs":{"title":"{#la_importLogs#}","selType":"checkboxmodel","itemId":"importLogGrid"},"children":[{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#la_incorrectColumn#}","width":"85","dataIndex":"ROW_NUM","itemId":"ROW_NUM","renderer":"return '<font color=\"red\">'+value+'<\/font>';"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#la_code#}","width":"150","dataIndex":"CA_CODE","itemId":"CA_CODE"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#la_upcode#}","width":"120","dataIndex":"UP_CODE","itemId":"UP_CODE"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#la_name#}","width":"200","dataIndex":"CA_NAME","itemId":"CA_NAME"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#la_direction#}","width":"65","dataIndex":"CA_DIRECTION","itemId":"CA_DIRECTION","renderer":"if(value == 1)\n  return '流入';\nelse\n   return '流出';"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#la_startDate#}","width":"120","dataIndex":"START_DATE","itemId":"START_DATE"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#la_endDate#}","width":"120","dataIndex":"END_DATE","itemId":"END_DATE"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#la_errorInformation#}","width":"300","dataIndex":"ERROR_MSG","itemId":"E_MSG","renderer":"metaData.style = 'overflow:auto;padding: 3px 6px;text-overflow: ellipsis;white-space: nowrap;white-space:normal;line-height:15px;';   \nreturn '<font color=\"red\">'+value+'<\/font>';","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"pageSize":"-1","autoLoad":"true","itemId":"store","url":"m?xwl=xc/gl/global/cash-items/cash-itemsDB/getInvalidCashItem"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"tab"}],"expanded":true,"type":"window"}],"expanded":true,"type":"folder"},{"configs":{"layout":"border","border":"false","itemId":"viewport1"},"children":[{"configs":{"region":"west","rootVisible":"true","root":"{text:Str.all,parent_id:'root',id:'-1',text:'{#la_projectTree#}',expanded:true}","width":"300","itemId":"tree1","viewConfig":"{  plugins : {    pluginId: 'ddPlug',    ptype: 'treeviewdragdrop'  },  listeners : {    beforedrop: beforeDropType,    drop: dropType  }}"},"events":{"itemclick":"v_ca_id = record.data.id;\napp.cashGrid.store.load({params:{'CA_ID':v_ca_id}});\n","itemdblclick":"var id = record.get('id');\nvar up_id = record.get('parent_id');\nvar ca_name = record.get('text');\nvar ca_direction = record.get('CA_DIRECTION');\nvar win = new Ext.window.Window(app._rightClickWindow); //app._win指向配置对象而非实例\n\twin.show();\n\twin.setIconCls('record_edit_icon');\n\tWb.setTitle(win, '修改['+record.get('text')+']');\n\tWb.setValue(win, record.data); //把记录数据应用到窗口\n    app.CA_NAME.setValue(ca_name);\n    app.UP_ID.setValue(up_id);\n    app.CA_ID.setValue(id);\n    app.CA_CODE.setValue(record.get('code'));\n     if(ca_direction=='-1'){\n       app.CA_DIRECTION.setValue('-1');\n     }\n     if(ca_direction=='1'){\n       app.CA_DIRECTION.setValue('1');\n     }\n\t//窗口每次动态生成,方法在窗口销毁时自动销毁\n\twin.mon(app.saveBtn, 'click', function() {\n  \tWb.request({\n    url: 'm?xwl=xc/gl/global/cash-items/cash-itemsDB/updateCash',\n    params: {'CA_ID':id,'CA_NAME':app.CA_NAME.getValue(),\n             'CA_DESC':app.CA_DESC.getValue(),'CA_DIRECTION':app.CA_DIRECTION.getValue(),\n             'ASS_KEY':app.ASS_KEY.getValue(),'START_DATE':app.START_DATE.getValue(),\n             'END_DATE':app.END_DATE.getValue(),'CA_CODE':app.CA_CODE.getValue()\n             },\n    success: function() {\n      win.close(); //根据closeAction属性，默认为销毁\n      app.cashGrid.store.load({params:{'UP_ID':up_id,'CA_ID':id}});\n    }\n  });\n});\n","tagEvents":"itemcontextmenu:function(view, record, item, index, event, options){\n  event.preventDefault();\n  event.stopEvent();\n  var is_leaf ='';\n  var result ='';\n  id = record.get('id');\n  if(id === undefined || id === ''){\n    id = '-1' ;\n  }\n  var up_id = record.get('parent_id');\n  var ca_level = record.get('CA_LEVEL');\n  var ca_name = record.get('text');\n  var ca_direction = record.get('CA_DIRECTION');\n  var up_code = record.get('UP_CODE');\n  var code =  record.get('code');\n  var nodemenu;\n  if(id=='-1'){//选中节点为根节点\n    nodemenu = new Ext.menu.Menu({\n      items:[\n        {text: '新增下级项目',\n         iconCls: 'file_add_icon',\n         handler:function(){\n           var win = new Ext.window.Window(app._rightClickWindow);\n           app.CA_LEVEL.setValue(1);\n           app.UP_ID.setValue(id);\n           app.UP_CODE.setValue(up_code);\n           app.START_DATE.setValue(new Date('1900-01-01'));\n           //app.END_DATE.setValue(new Date('9999-12-31'));\n           app.IS_LEAF.setValue('Y');\n           Wb.request({\n             url:\"m?xwl=xc/gl/global/cash-items/cash-itemsDB/selectOrderBy\",//查询排序号\n             async:false,\n             success:function(resp){\n               var order_val = Wb.decode(resp.responseText);\n               app.ORDERBY.setValue(order_val.rows[0].max_num+1);\n             }\n           });\n           win.setTitle('新增['+record.get('text')+']下级项目');\n           win.show();\n           win.setIconCls('record_add_icon');\n           //窗口每次动态生成,方法在窗口销毁时自动销毁\n           win.mon(app.saveBtn, 'click', function() {\n              Wb.request({\n              url:'m?xwl=xc/gl/global/account/hrcy/hrcyDB/getUUID',//给主键ID赋值\n              success:function(resp){\n                var record = Wb.decode(resp.responseText);\n                app.CA_ID.setValue(record.uuid);\n                if(Wb.isEmpty(app.CA_ID.getValue())){\n               \t\treturn;\n             \t}\n              }\n              });\n             \n             var values = Wb.getValue(win);\n             var ca_code = app.CA_CODE.getValue();\n             if(ca_code.length==3&&ca_code>=0&&ca_code<=999){\n               Wb.request({\n               url:'m?xwl=xc/gl/global/cash-items/cash-itemsDB/nameIfExist',//验证是否同名\n               params:{'CA_NAME':app.CA_NAME.getValue(),'CA_CODE':ca_code,'sqlStr':null},\n               success:function(resp){\n                 var rec = Wb.decode(resp.responseText);\n                 if(rec.rows[0].c_no>0){\n                   Wb.warn('存在相同的现金流量项名称或编码请修改！');\n                   return;\n                 }\n                 \n                 Wb.request({\n                   url: 'm?xwl=xc/gl/global/cash-items/cash-itemsDB/insertCash',//插入数据\n                   params: {'CA_ID':app.CA_ID.getValue(),'IS_LEAF':app.IS_LEAF.getValue(),'CA_NAME':app.CA_NAME.getValue(),\n                            'CA_DIRECTION':app.CA_DIRECTION.getValue(),'ASS_KEY':app.ASS_KEY.getValue(),\n                            'CA_CODE':ca_code,'CA_LEVEL':app.CA_LEVEL.getValue(),\n                            'CA_DESC':app.CA_DESC.getValue(),'UP_ID':app.UP_ID.getValue(),\n                            'UP_CODE':app.UP_CODE.getValue(),'START_DATE':app.START_DATE.getValue(),\n                            'END_DATE':app.END_DATE.getValue(),'ORDERBY':app.ORDERBY.getValue()},\n                   success: function(resp) {\n                     win.close(); //根据closeAction属性，默认为销毁\n                   }\n                 });\n               }\n             });\n             }else{\n             \tWb.info('现金流量编码请输入000~999之间的三位数字！');\n                return;\n             }\n           });\n         }}\n      ]\n    });\n  }\n\n  if(id != '-1'){//选中节点不为根节点\n    if(ca_level<3){\n      nodemenu = new Ext.menu.Menu({\n        items:[\n          {text: '新增同级项目',\n           iconCls: 'file_add_icon',\n           handler:function(){\n             var win = new Ext.window.Window(app._rightClickWindow);\n             app.CA_LEVEL.setValue(ca_level);\n             app.UP_ID.setValue(up_id);\n             app.UP_CODE.setValue(up_code);\n             app.START_DATE.setValue(new Date('1900-01-01'));\n             //app.END_DATE.setValue(new Date('9999-12-31'));\n             app.IS_LEAF.setValue('Y');\n             Wb.request({\n               url:\"m?xwl=xc/gl/global/cash-items/cash-itemsDB/selectOrderBy\",//查询排序号\n               async:false,\n               success:function(resp){\n                 var order_val = Wb.decode(resp.responseText);\n                 app.ORDERBY.setValue(order_val.rows[0].max_num+1);\n               }\n             });\n             win.setTitle('新增['+record.get('text')+']同级项目');\n             win.show();\n             win.setIconCls('record_add_icon');\n             //窗口每次动态生成,方法在窗口销毁时自动销毁\n             win.mon(app.saveBtn, 'click', function() {\n               Wb.request({\n              url:'m?xwl=xc/gl/global/account/hrcy/hrcyDB/getUUID',//给主键ID赋值\n              success:function(resp){\n                var record = Wb.decode(resp.responseText);\n                app.CA_ID.setValue(record.uuid);\n                if(Wb.isEmpty(app.CA_ID.getValue())){\n               \t\treturn;\n             \t}\n              }\n              });\n               var values = Wb.getValue(win);\n               var ca_code = app.CA_CODE.getValue();\n               var up_code = app.UP_CODE.getValue();\n               if(ca_level==1){//级数为1\n               \t\t if(ca_code.length==3&&ca_code>=0&&ca_code<=999){\n                     \tca_code = ca_code;\n                     }else{\n                     \tWb.info('现金流量编码请输入000~999之间的三位数字！');\n                       return;\n                     }\n               }else if(ca_level==2){//级数为2\n               \t\tif(ca_code.length==2&&ca_code>=0&&ca_code<=99){\n                     \tca_code = up_code + ca_code;\n                     }else{\n                     \tWb.info('现金流量编码请输入00~99之间的两位数字！');\n                       \treturn;\n                     }\n               }\n               Wb.request({\n                 url:'m?xwl=xc/gl/global/cash-items/cash-itemsDB/nameIfExist',//验证同名\n                 params:{'CA_NAME':app.CA_NAME.getValue(),'CA_CODE':ca_code,'sqlStr':null},\n                 success:function(resp){\n                   var rec = Wb.decode(resp.responseText);\n                   if(rec.rows[0].c_no>0){\n                     Wb.warn('存在相同的现金流量项名称或编码请修改！');\n                     return;\n                   }\n                   Wb.request({\n                     url: 'm?xwl=xc/gl/global/cash-items/cash-itemsDB/insertCash',//添加\n                     params: {'CA_ID':app.CA_ID.getValue(),'IS_LEAF':app.IS_LEAF.getValue(),'CA_NAME':app.CA_NAME.getValue(),\n                            'CA_DIRECTION':app.CA_DIRECTION.getValue(),'ASS_KEY':app.ASS_KEY.getValue(),\n                            'CA_CODE':ca_code,'CA_LEVEL':app.CA_LEVEL.getValue(),\n                            'CA_DESC':app.CA_DESC.getValue(),'UP_ID':app.UP_ID.getValue(),\n                            'UP_CODE':app.UP_CODE.getValue(),'START_DATE':app.START_DATE.getValue(),\n                            'END_DATE':app.END_DATE.getValue(),'ORDERBY':app.ORDERBY.getValue()},\n                     success: function(resp) {\n                       win.close(); //根据closeAction属性，默认为销毁\n                     }\n                   });\n                 }\n               });\n\n             });\n           }},\n          {text: '新增下级项目',\n           iconCls: 'file_add_icon',\n           handler:function(){\n             var win = new Ext.window.Window(app._rightClickWindow);\n             app.CA_LEVEL.setValue(ca_level+1);\n             app.UP_ID.setValue(id);\n             app.UP_CODE.setValue(code);\n             app.START_DATE.setValue(new Date('1900-01-01'));\n             //app.END_DATE.setValue(new Date('9999-12-31'));\n             app.IS_LEAF.setValue('Y');\n             Wb.request({\n               url:\"m?xwl=xc/gl/global/cash-items/cash-itemsDB/selectOrderBy\",//查询排序号\n               async:false,\n               success:function(resp){\n                 var order_val = Wb.decode(resp.responseText);\n                 app.ORDERBY.setValue(order_val.rows[0].max_num+1);\n               }\n             });\n             win.setTitle('新增['+record.get('text')+']下级项目');\n             win.show();\n             win.setIconCls('record_add_icon');\n             //窗口每次动态生成,方法在窗口销毁时自动销毁\n             win.mon(app.saveBtn, 'click', function() {\n               Wb.request({\n              url:'m?xwl=xc/gl/global/account/hrcy/hrcyDB/getUUID',//给主键ID赋值\n              success:function(resp){\n                var record = Wb.decode(resp.responseText);\n                app.CA_ID.setValue(record.uuid);\n                if(Wb.isEmpty(app.CA_ID.getValue())){\n               \t\treturn;\n             \t}\n              }\n              });\n               var values = Wb.getValue(win);\n               var ca_code = app.CA_CODE.getValue();\n               var up_code = app.UP_CODE.getValue();\n               if(ca_level==1){//级数为1时\n               \t\t if(ca_code.length==2&&ca_code>=0&&ca_code<=99){\n                     \tca_code = up_code+ca_code;\n                     }else{\n                     \tWb.info('现金流量编码请输入000~99之间的三位数字！');\n                       return;\n                     }\n               }else if(ca_level==2){//级数为2时\n               \t\tif(ca_code.length==2&&ca_code>=0&&ca_code<=99){\n                     \tca_code = up_code + ca_code;\n                     }else{\n                     \tWb.info('现金流量编码请输入00~99之间的两位数字！');\n                       \treturn;\n                     }\n               }\n               Wb.request({\n                 url:'m?xwl=xc/gl/global/cash-items/cash-itemsDB/nameIfExist',//验证同名\n                 params:{'CA_NAME':app.CA_NAME.getValue(),'CA_CODE':ca_code,'sqlStr':null},\n                 success:function(resp){\n                   var rec = Wb.decode(resp.responseText);\n                   if(rec.rows[0].c_no>0){\n                     Wb.warn('存在相同的现金流量项名称或编码请修改！');\n                     return;\n                   }\n                   Wb.request({\n                     url: 'm?xwl=xc/gl/global/cash-items/cash-itemsDB/insertCash',//添加\n                     params: {'CA_ID':app.CA_ID.getValue(),'IS_LEAF':app.IS_LEAF.getValue(),'CA_NAME':app.CA_NAME.getValue(),\n                            'CA_DIRECTION':app.CA_DIRECTION.getValue(),'ASS_KEY':app.ASS_KEY.getValue(),\n                            'CA_CODE':ca_code,'CA_LEVEL':app.CA_LEVEL.getValue(),\n                            'CA_DESC':app.CA_DESC.getValue(),'UP_ID':app.UP_ID.getValue(),\n                            'UP_CODE':app.UP_CODE.getValue(),'START_DATE':app.START_DATE.getValue(),\n                            'END_DATE':app.END_DATE.getValue(),'ORDERBY':app.ORDERBY.getValue()},\n                     success: function(resp) {\n                       Wb.request({\n                         url: 'm?xwl=xc/gl/global/cash-items/cash-itemsDB/updateIs_leaf_Y',//更新是否为末级节点\n                         params:{'CA_ID':id}\n                       });\n                       win.close(); //根据closeAction属性，默认为销毁\n                     }\n                   });\n                 }\n               });\n\n             });\n           }},\n          {text: '修改项目',\n           iconCls: 'file_edit_icon',\n           handler:function(){\n             var win = new Ext.window.Window(app._rightClickWindow); //app._win指向配置对象而非实例\n             win.show();\n             win.setIconCls('record_edit_icon');\n             Wb.setTitle(win, '修改['+record.get('text')+']');\n             Wb.setValue(win, record.data); //把记录数据应用到窗口\n             if(ca_level==2){\n             \tapp.CA_CODE.setValue(code.substring(3,5));\n             }else if(ca_level==1){\n               app.CA_CODE.setValue(code);\n             }\n             if(Ext.util.Format.date(record.data.END_DATE,'Y-m-d')=='9999-12-31'){\n               app.END_DATE.setValue('');\n             }\n             app.CA_NAME.setValue(ca_name);\n             app.UP_ID.setValue(up_id);\n             app.CA_ID.setValue(id);\n             if(ca_direction=='-1'){\n               app.CA_DIRECTION.setValue('-1');\n             }\n             if(ca_direction=='1'){\n               app.CA_DIRECTION.setValue('1');\n             }\n             //窗口每次动态生成,方法在窗口销毁时自动销毁\n             win.mon(app.saveBtn, 'click', function() {\n               var ca_code = app.CA_CODE.getValue();\n               var up_code = app.UP_CODE.getValue();\n               if(ca_level==1){//级数为1时\n               \t\t if(ca_code.length==3&&ca_code>=0&&ca_code<=999){\n                     \tca_code = ca_code;\n                     }else{\n                     \tWb.info('现金流量编码请输入000~999之间的三位数字！');\n                       return;\n                     }\n               }else if(ca_level==2){//级数为2时\n               \t\tif(ca_code.length==2&&ca_code>=0&&ca_code<=99){\n                     \tca_code = up_code + ca_code;\n                     }else{\n                     \tWb.info('现金流量编码请输入00~99之间的两位数字！');\n                       \treturn;\n                     }\n               }\n               Wb.request({\n                 url:'m?xwl=xc/gl/global/cash-items/cash-itemsDB/nameIfExist',//验证同名\n                 params:{'CA_NAME':app.CA_NAME.getValue(),'CA_CODE':ca_code,'sqlStr':'and CA_ID!='+\"'\"+app.CA_ID.getValue()+\"'\"},\n                 success:function(resp){\n                   var rec = Wb.decode(resp.responseText);\n                   if(rec.rows[0].c_no>0){\n                     Wb.warn('存在相同的现金流量项名称或编码请修改！');\n                     return;\n                   }\n                   Wb.request({\n                     url: 'm?xwl=xc/gl/global/cash-items/cash-itemsDB/updateCash',//修改\n                     params: {'CA_ID':id,'CA_NAME':app.CA_NAME.getValue(),\n                              'CA_DESC':app.CA_DESC.getValue(),'CA_DIRECTION':app.CA_DIRECTION.getValue(),\n                              'ASS_KEY':app.ASS_KEY.getValue(),'START_DATE':app.START_DATE.getValue(),'END_DATE':app.END_DATE.getValue(),\n                              'CA_CODE':ca_code\n                             },\n                     success: function() {\n                       win.close(); //根据closeAction属性，默认为销毁\n                       app.cashGrid.store.load({params:{'UP_ID':up_id,'CA_ID':id}});\n                     }\n                   });\n                 }\n               });\n\n             });\n\n           }},\n          {text: '删除项目',\n           iconCls:'file_delete_icon',\n           handler:function(){\n             Wb.request({\n               url:'m?xwl=xc/gl/global/cash-items/cash-itemsDB/is_leaf',//是否为末级\n               async:false,\n               params:{'CA_ID':id},\n               success:function(resp){\n                 result = Wb.decode(resp.responseText);\n                 result = result.total; \t\n               }\n             });\n             if(result>0){//不是末级\n               Wb.toast('\"'+ca_name+'\"'+'有下级项目,不能删除！');\n               /*Wb.confirm('\"'+ca_name+'\"'+'有下级项目,如果删除将同步删除下级,'+'确定删除'+'\"'+ca_name+'\"'+'吗?',function(){\n                 Wb.request({\n                   url:'m?xwl=xc/gl/global/cash-items/cash-itemsDB/deleteCashDB',//删除\n                   params:{'CA_ID':id},\n                   success:function(){\n                     app.tree1.store.load();\n                     app.cashGrid.store.load({param:{'CA_ID':id}});\n                     var node = Wb.getSelNode(app.tree1);\n                     var parentNode = node.parentNode;//取到当前选中节点的父节点\n                     parentNode.removeAll(node);\n                     parentNode.commit();\n                   } \n                 });\n               });*/\n             }else if(result==0){//是末级\n               Wb.confirm('确定删除'+'\"'+ca_name+'\"'+'吗?',function(){\n                 Wb.request({\n                   url:'m?xwl=xc/gl/global/cash-items/cash-itemsDB/deleteCashDB',//删除\n                   params:{'CA_ID':id},\n                   success:function(){\n                     app.tree1.store.load();\n                     app.cashGrid.store.load({param:{'CA_ID':id}});\n                     var node = Wb.getSelNode(app.tree1);\n                     var parentNode = node.parentNode;//取到当前选中节点的父节点\n                     parentNode.removeAll(node);\n                     parentNode.commit();\n                   } \n                 });\n               });\n             }\n\n           }}\n        ]\n      });\n    }else{\n      nodemenu = new Ext.menu.Menu({\n        items:[\n          {text: '新增同级项目',\n           iconCls: 'file_add_icon',\n           handler:function(){\n             var win = new Ext.window.Window(app._rightClickWindow);\n             app.CA_LEVEL.setValue(ca_level);\n             app.UP_ID.setValue(up_id);\n             app.UP_CODE.setValue(up_code);\n             app.START_DATE.setValue(new Date('1900-01-01'));\n             //app.END_DATE.setValue(new Date('9999-12-31'));\n             app.IS_LEAF.setValue('Y');\n             Wb.request({\n               url:\"m?xwl=xc/gl/global/cash-items/cash-itemsDB/selectOrderBy\",//查询排序号\n               async:false,\n               success:function(resp){\n                 var order_val = Wb.decode(resp.responseText);\n                 app.ORDERBY.setValue(order_val.rows[0].max_num+1);\n               }\n             });\n             win.setTitle('新增['+record.get('text')+']同级项目');\n             win.show();\n             win.setIconCls('record_add_icon');\n             //窗口每次动态生成,方法在窗口销毁时自动销毁\n             win.mon(app.saveBtn, 'click', function() {\n               Wb.request({\n              url:'m?xwl=xc/gl/global/account/hrcy/hrcyDB/getUUID',//给主键ID赋值\n              success:function(resp){\n                var record = Wb.decode(resp.responseText);\n                app.CA_ID.setValue(record.uuid);\n                if(Wb.isEmpty(app.CA_ID.getValue())){\n               \t\treturn;\n             \t}\n              }\n              });\n               var values = Wb.getValue(win);\n               var ca_code = app.CA_CODE.getValue();\n               var up_code = app.UP_CODE.getValue();\n               if(ca_code.length==2&&ca_code>=0&&ca_code<=99){\n                     \tca_code = up_code + ca_code;\n                     }else{\n                     \tWb.info('现金流量编码请输入00~99之间的两位数字！');\n                       \treturn;\n                     }\n               Wb.request({\n                 url:'m?xwl=xc/gl/global/cash-items/cash-itemsDB/nameIfExist',//验证同名\n                 params:{'CA_NAME':app.CA_NAME.getValue(),'CA_CODE':ca_code,'sqlStr':null},\n                 success:function(resp){\n                   var rec = Wb.decode(resp.responseText);\n                   if(rec.rows[0].c_no>0){\n                     Wb.warn('存在相同的现金流量项名称或编码请修改！');\n                     return;\n                   }\n                   Wb.request({\n                     url: 'm?xwl=xc/gl/global/cash-items/cash-itemsDB/insertCash',//添加\n                     params: {'CA_ID':app.CA_ID.getValue(),'IS_LEAF':app.IS_LEAF.getValue(),'CA_NAME':app.CA_NAME.getValue(),\n                            'CA_DIRECTION':app.CA_DIRECTION.getValue(),'ASS_KEY':app.ASS_KEY.getValue(),\n                            'CA_CODE':ca_code,'CA_LEVEL':app.CA_LEVEL.getValue(),\n                            'CA_DESC':app.CA_DESC.getValue(),'UP_ID':app.UP_ID.getValue(),\n                            'UP_CODE':app.UP_CODE.getValue(),'START_DATE':app.START_DATE.getValue(),\n                            'END_DATE':app.END_DATE.getValue(),'ORDERBY':app.ORDERBY.getValue()},\n                     success: function(resp) {\n                       win.close(); //根据closeAction属性，默认为销毁\n                     }\n                   });\n                 }\n               });\n\n             });\n           }},{text: '修改项目',\n               iconCls: 'file_edit_icon',\n               handler:function(){\n                 var win = new Ext.window.Window(app._rightClickWindow); //app._win指向配置对象而非实例\n                 win.show();\n                 win.setIconCls('record_edit_icon');\n                 Wb.setTitle(win, '修改['+record.get('text')+']');\n                 Wb.setValue(win, record.data); //把记录数据应用到窗口 \n             \t app.CA_CODE.setValue(code.substring(5,7));\n             \n                 if(Ext.util.Format.date(record.data.END_DATE,'Y-m-d')=='9999-12-31'){\n                   app.END_DATE.setValue('');\n                 }\n                 app.CA_NAME.setValue(ca_name);\n                 app.UP_ID.setValue(up_id);\n                 app.CA_ID.setValue(id);\n                 if(ca_direction=='-1'){\n                   app.CA_DIRECTION.setValue('-1');\n                 }\n                 if(ca_direction=='1'){\n                   app.CA_DIRECTION.setValue('1');\n                 }\n                 //窗口每次动态生成,方法在窗口销毁时自动销毁\n                 win.mon(app.saveBtn, 'click', function() {\n                   var ca_code = app.CA_CODE.getValue();\n               \t   var up_code = app.UP_CODE.getValue();\n                   if(ca_code.length==2&&ca_code>=0&&ca_code<=99){\n                     \tca_code = up_code + ca_code;\n                     }else{\n                     \tWb.info('现金流量编码请输入00~99之间的两位数字！');\n                       \treturn;\n                     }\n                   Wb.request({\n                     url:'m?xwl=xc/gl/global/cash-items/cash-itemsDB/nameIfExist',//验证同名\n                     params:{'CA_NAME':app.CA_NAME.getValue(),'CA_CODE':ca_code,'CA_ID':app.CA_ID.getValue(),'sqlStr':'and CA_ID!='+\"'\"+app.CA_ID.getValue()+\"'\"},\n                     success:function(resp){\n                       var rec = Wb.decode(resp.responseText);\n                       if(rec.rows[0].c_no>0){\n                         Wb.warn('存在相同的现金流量项名称或编码请修改！');\n                         return;\n                       }\n                       Wb.request({\n                         url: 'm?xwl=xc/gl/global/cash-items/cash-itemsDB/updateCash',//修改\n                         params: {'CA_ID':id,'CA_NAME':app.CA_NAME.getValue(),\n                                  'CA_DESC':app.CA_DESC.getValue(),'CA_DIRECTION':app.CA_DIRECTION.getValue(),\n                                  'ASS_KEY':app.ASS_KEY.getValue(),'START_DATE':app.START_DATE.getValue(),'END_DATE':app.END_DATE.getValue(),\n                                  'CA_CODE':ca_code\n                                 },\n                         success: function() {\n                           win.close(); //根据closeAction属性，默认为销毁\n                           app.cashGrid.store.load({params:{'UP_ID':up_id,'CA_ID':id}});\n                         }\n                       });\n                     }\n                   });\n\n                 });\n\n               }},\n          {text: '删除项目',\n           iconCls:'file_delete_icon',\n           handler:function(){\n             Wb.request({\n               url:'m?xwl=xc/gl/global/cash-items/cash-itemsDB/is_leaf',//是否为末级\n               async:false,\n               params:{'CA_ID':id},\n               success:function(resp){\n                 result = Wb.decode(resp.responseText);\n                 result = result.total; \t\n               }\n             });\n             if(result>0){//不是末级\n                 Wb.toast('\"'+ca_name+'\"'+'有下级项目,不能删除！');\n               /*Wb.confirm('\"'+ca_name+'\"'+'有下级项目,如果删除将同步删除下级,'+'确定删除'+'\"'+ca_name+'\"'+'吗?',function(){\n                 Wb.request({\n                   url:'m?xwl=xc/gl/global/cash-items/cash-itemsDB/deleteCashDB',\n                   params:{'CA_ID':id},\n                   success:function(){\n                     app.tree1.store.load();\n                     app.cashGrid.store.load({param:{'CA_ID':id}});\n                     var node = Wb.getSelNode(app.tree1);\n                     var parentNode = node.parentNode;//取到当前选中节点的父节点\n                     parentNode.removeAll(node);\n                     parentNode.commit();\n                   } \n                 });\n               });*/\n             }else if(result==0){//是末级\n               Wb.confirm('确定删除'+'\"'+ca_name+'\"'+'吗?',function(){\n                 Wb.request({\n                   url:'m?xwl=xc/gl/global/cash-items/cash-itemsDB/deleteCashDB',\n                   params:{'CA_ID':id},\n                   success:function(){\n                     app.tree1.store.load();\n                     app.cashGrid.store.load({param:{'CA_ID':id}});\n                     var node = Wb.getSelNode(app.tree1);\n                     var parentNode = node.parentNode;//取到当前选中节点的父节点\n                     parentNode.removeAll(node);\n                     parentNode.commit();\n                   } \n                 });\n               });\n             }\n\n           }}\n        ]\n      });\n    }\n  }\n  nodemenu.showAt(event.getPoint());\n}\n"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/gl/global/cash-items/cash-itemsDB/selectForTree"},"events":{"load":"app.tree1.getRootNode().expand();","beforeload":"var pid = operation.node.get('id') ;\nif(pid === undefined || pid === ''){\n  pid = '-1' ;\n}\noperation.params.parentID=pid; "},"children":[],"expanded":false,"type":"treestore"}],"expanded":true,"type":"tree"},{"configs":{"region":"center","pagingBar":"true","cls":"my_custom_grid","selType":"checkboxmodel","buttonAlign":"right","border":"false","itemId":"cashGrid","editable":"true"},"children":[{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#la_code#}","width":"120","dataIndex":"CA_CODE","titleAlign":"center","itemId":"CA_CODE_COL","renderer":"metaData.style = 'overflow:auto;text-overflow: ellipsis;white-space: nowrap;white-space:normal;line-height:20px;';   \nreturn value;"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"现金流量项ID","hidden":"true","width":"120","dataIndex":"CA_ID","titleAlign":"center","itemId":"CA_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#la_name#}","width":"230","dataIndex":"CA_NAME","titleAlign":"center","itemId":"CA_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"上级ID","hidden":"true","width":"80","dataIndex":"UP_ID","itemId":"UP_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#la_direction#}","width":"50","dataIndex":"CA_DIRECTION","titleAlign":"center","itemId":"CA_DIRECTION_COL","renderer":"if(value=='-1') return '流出';\nif(value=='1') return '流入';\n"},"children":[{"configs":{"displayField":"VAL_NAME","valueField":"VAL_CODE","itemId":"editor"},"children":[{"configs":{"itemId":"store","autoLoad":"true","url":"m?xwl=xc/gl/global/cash-items/cash-itemsDB/selectDirection"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"}],"expanded":false,"type":"column"},{"configs":{"text":"{#la_startDate#}","xtype":"datecolumn","width":"100","dataIndex":"START_DATE","titleAlign":"center","itemId":"START_DATE_COL"},"children":[{"configs":{"itemId":"editor"},"events":{"blur":"var rec = app.cashGrid.getSelectionModel().getSelection()[0];\nvar start_date = date.value;\nvar end_date = rec.data.END_DATE;\nif(end_date<start_date){\n  Wb.info('开始日期不能大于结束日期');\n date.setValue('');\n}"},"children":[],"expanded":false,"type":"date"}],"expanded":false,"type":"column"},{"configs":{"text":"{#la_endDate#}","xtype":"datecolumn","width":"100","dataIndex":"END_DATE","titleAlign":"center","itemId":"END_DATE_COL","renderer":"if(Ext.util.Format.date(value,'Y-m-d')=='9999-12-31'){\n return null;\n}else{\n\treturn Ext.util.Format.date(value,'Y-m-d');\n}"},"children":[{"configs":{"itemId":"editor"},"events":{"focus":"if(Ext.util.Format.date(date.getValue(),'Y-m-d')=='9999-12-31'){\n date.setValue('');\n}","blur":"var rec = app.cashGrid.getSelectionModel().getSelection()[0];\nvar start_date = rec.data.START_DATE;\nvar end_date = date.getValue();\nif(end_date<start_date){\n  Wb.info('开始日期不能大于结束日期');\n date.setValue('');\n}\nif(Ext.util.Format.date(date.getValue(),'Y-m-d')==''){\ndate.setValue(Ext.util.Format.date('9999-12-31','Y-m-d'));\n}\n"},"children":[],"expanded":false,"type":"date"}],"expanded":false,"type":"column"},{"configs":{"text":"说明","hidden":"true","dataIndex":"CA_DESC","titleAlign":"center","itemId":"CA_DESC_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#la_upcode#}","width":"120","dataIndex":"UP_CODE","titleAlign":"center","itemId":"UP_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#la_isLeaf#}","width":"100","dataIndex":"IS_LEAF","titleAlign":"center","itemId":"CA_IS_LEAF","renderer":"if(value === 'N')\n  return '否';\nelse\n  return '是';"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"排序号","hidden":"true","dataIndex":"ORDERBY","itemId":"ORDERBY_COL"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"store","url":"m?xwl=xc/gl/global/cash-items/cash-itemsDB/selectCash"},"events":{"load":"/*for(var i=0;i<records.length;i++){\n    var v_end_date = records[i].get('END_DATE');\n  \tv_end_date = Ext.util.Format.date(v_end_date,'Y-m-d');\n    if(v_end_date=='9999-12-31'){\n     records[i].set('END_DATE','');\n    }\n  }*/","success":"\n"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"{#saveBtn#}","itemId":"saveBtn_1","iconCls":"save_icon"},"events":{"click":"if (!Wb.verifyGrid(app.cashGrid)) //验证数据是否合法\n  return;\nvar v_end_date = new Date('9999-12-31');\nvar values = Wb.getData(app.cashGrid);\nWb.request({\n\turl:'m?xwl=xc/gl/global/cash-items/cash-itemsDB/save',\n  \tparams:{'values':Wb.encode(values),'V_END_DATE':v_end_date},\n  \tsuccess:function(resp){\n    \tapp.cashGrid.store.load({params:{'CA_ID':v_ca_id}});\n    }\n});\n"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#delBtn#}","itemId":"cashDelBtn","iconCls":"delete_icon"},"events":{"click":"/*desc：删除选中的现金流项目\n *note：删除前需校验,1-必须为末级现金流项目;2-必须为未发生业务的现金流项目;3-现金流项目删除后，需重新判断父级现金流是否为叶子节点属性\n *date：2016-06-14\n */\nvar delRows = app.cashGrid.getSelection();\nvar map = new Ext.util.HashMap();\nvar leafMap = new Ext.util.HashMap();\nif (delRows.length === 0) {\n  Wb.info('请选择要删除的末级现金流项目！');\n} else {\n  var cashIds = '';\n  Ext.Array.each(delRows, function(item) {\n    cashIds += '\\'' + item.data.CA_ID + '\\',';\n    var _tmpCode = item.data.CA_CODE;\n    var _tmpRow = app.cashGrid.getStore().indexOf(item) + 1;\n    if (item.data.IS_LEAF === 'N') {\n      map.add(_tmpCode, _tmpRow);\n    } else {\n      leafMap.add(_tmpCode, _tmpRow);\n    }\n  });\n  if (map.getCount() !== 0) {\n    var errorMsg = '第';\n    map.each(function(key, value, length) {\n      errorMsg += value + ',';\n    });\n    errorMsg = errorMsg.substring(0, errorMsg.length - 1);\n    errorMsg += '行记录不是末级现金流项目，请重新选择！';\n    Wb.info(errorMsg);\n    return;\n  }\n  cashIds = cashIds.substring(0, cashIds.length - 1);\n  //校验要删除的现金流项目是否已经发生业务数据\n  Wb.request({\n    url: 'm?xwl=xc/gl/global/cash-items/cash-itemsDB/getBusinessCashItem',\n    params: {\n      'ids': cashIds\n    },\n    success: function(response) {\n      var result = Wb.decode(response.responseText);\n      var tmpResult = result.rows;\n      if (tmpResult.length > 0) {\n        errorMsg = '第';\n        for (var i = 0; i < tmpResult.length; i++) {\n          leafMap.each(function(key, value, length) {\n            if(tmpResult[i].CA_CODE === key)\n               errorMsg += value + ',';\n          });\n        }\n        errorMsg = errorMsg.substring(0, errorMsg.length - 1);\n        errorMsg += '行现金流项目已经发生业务数据，请重新选择！';\n        Wb.info(errorMsg);\n        return;\n      } else {\n        //执行删除操作\n        Wb.request({\n          url: 'm?xwl=xc/gl/global/cash-items/cash-itemsDB/batchDelCashItem',\n          params: {\n            destroy: Wb.getData(delRows)\n          },\n          success: function() {\n            app.tree1.getStore().reload();\n            app.cashGrid.getStore().reload();\n          }\n        });\n      }\n    }\n  });\n}"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#importBtn#}","itemId":"importBtn","iconCls":"import_icon"},"events":{"click":"  var win = new Ext.window.Window(app._importDataWin);\n  win.setTitle('导入现金流项目数据');\n  win.show();"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#exportBtn#}","itemId":"exportBtn","iconCls":"export_icon"},"events":{"click":"window.location.href = '{#contextPath#}/glDataTransgerManageAction.do?method=exportBaseDataByModel&templateCode=XC_GL_CASH_ITEMS';"},"children":[],"expanded":false,"type":"item"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}