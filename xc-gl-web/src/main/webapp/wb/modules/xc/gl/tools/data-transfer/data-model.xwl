{"inframe":false,"title":"基础信息导入导出模板","hidden":false,"roles":{"default":1},"children":[{"configs":{"title":"基础数据模板","serverScript":"com.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xc/gl/tools/data-transfer/data-model\");\nrequest.setAttribute('contextPath',request.getContextPath());\n","itemId":"module"},"children":[{"configs":{"itemId":"newWinBtns"},"children":[{"configs":{"text":"{#saveBtn#}","itemId":"saveBtn","iconCls":"save_icon"},"events":{"click":"if(app.modelForm.getForm().isValid() === false){\n    Wb.info('请填写所有必填项！');\n    return false;\n}\n//保存修改前先校验必填选项\nvar modifyRows = app.columnGrid.getStore().getModifiedRecords();\nvar isValid = true;\nExt.each(modifyRows,function(rec){\n  if(Ext.isEmpty(rec.data.COL_ALIAS) || Ext.isEmpty(rec.data.COL_SEQ))\n    isValid = false;\n    return false;\n});\nif(!isValid){\n  Wb.info('列别名或者列序号不能为空！');\n  return false;\n}\n var rows = Wb.getModified(app.columnGrid);\n//执行保存操作\nif(Ext.isEmpty(app.templateId.getValue())){\n  //新增操作\n  //主表信息\n  var templateMainJson = {'TEMPLATE_ID':'',\n                          'TEMPLATE_CODE':app.templateName.getValue().toUpperCase(),\n                          'TEMPLATE_NAME':app.templateName.getRawValue(),\n                          'TEMPLATE_DESC':app.templateDesc.getValue(),\n                          'APP_ID':app.appName.getValue()};\n  //明细表信息\n  if(rows.create ===null || rows.create.length === 0){\n    Wb.info('请选择模板列信息！');\n  }else{\n    Wb.request({\n      url:'m?xwl=xc/gl/tools/data-transfer/data/saveModelData',\n      message:'请求处理中....',\n      params:{'mainData':Wb.encode(templateMainJson),'operateData':Wb.encode(rows)},\n      success:function(response){\n        Wb.info('保存成功！',function(){\n          app.newWin.close();\n        });\n      },\n      failure:function(response){\n        Wb.info('保存失败！');\n      }\n    });   \n  }\n}else{\n  //检查是否存在着明细行\n  if(app.columnGrid.getStore().getCount() === 0){\n    Wb.info('请选择明细行！');\n    return false;\n  }\n  //更新操作\n  //主表信息 \n  var templateMainJson = {'TEMPLATE_ID':app.templateId.getValue(),\n                          'TEMPLATE_CODE':app.templateName.getValue().toUpperCase(),\n                          'TEMPLATE_NAME':app.templateName.getRawValue(),\n                          'TEMPLATE_DESC':app.templateDesc.getValue(),\n                          'APP_ID':app.appName.getValue()};\n  //执行修改操作\n    Wb.request({\n      url:'m?xwl=xc/gl/tools/data-transfer/data/modifyModelData',\n      message:'请求处理中....',\n      params:{'mainData':Wb.encode(templateMainJson),'operateData':Wb.encode(rows),'mainKey':app.templateId.getValue()},\n      success:function(response){\n        Wb.info('保存成功！',function(){\n          app.newWin.close();\n        });\n      },\n      failure:function(response){\n        Wb.info('保存失败！');\n      }\n    });\n}\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#closeBtn#}","itemId":"closeBtn","iconCls":"cancel_icon"},"events":{"click":"app.newWin.close();"},"children":[],"expanded":false,"type":"button"}],"expanded":false,"type":"array"},{"configs":{"itemId":"windows"},"children":[{"configs":{"height":"400","layout":"fit","width":"650","closeAction":"hide","itemId":"tableColumnsWin","dialog":"true"},"events":{"ok":"var rows = app.tableColumnsGrid.getSelectionModel().getSelection();\nif(rows.length===0){\n  Wb.info('请选择要添加的列！');\n}else{\n  var e = app.columnGrid.plugins[0];\n  e.completeEdit();\n  var templateIdVar = app.templateId.getValue();\n  if(Ext.isEmpty(templateIdVar))\n    templateIdVar = '';\n  //排除重复添加的列,并计算列序号\n  var t = app.columnGrid.getStore().getCount();\n  for(var i=0; i<rows.length; i++){\n    var num = app.columnGrid.store.find('COL_CODE',rows[i].get('COL_CODE'));\n    if(num==-1){\n      var _colCode = rows[i].get('COL_CODE');\n      var _colName = rows[i].get('COL_NAME');\n      var _colType = rows[i].get('COL_TYPE');\n      var insertJson = {'TEMPLATE_ID' :'','TEMPLATE_DTL_ID':'','COL_CODE' : _colCode,'COL_NAME' :_colName, 'COL_ALIAS': _colName, 'COL_TYPE' : _colType,'COL_SEQ':t};\n      app.columnGrid.store.add(insertJson);\n      t++;\n    }\n  }\n  app.tableColumnsWin.hide();\n}"},"children":[{"configs":{"pagingBar":"false","multiSelect":"true","selType":"checkboxmodel","itemId":"tableColumnsGrid","simpleSelect":"true"},"children":[{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#rownum#}","width":"45","align":"center","xtype":"rownumberer","titleAlign":"center","itemId":"XUHAO"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#columnCode#}","width":"150","dataIndex":"COL_CODE","itemId":"COLUMN_CODE_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#columnName#}","width":"180","dataIndex":"COL_NAME","itemId":"COLUMN_NAME_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#columnType#}","width":"100","dataIndex":"COL_TYPE","itemId":"COLUMN_TYPE_COL"},"children":[],"expanded":true,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"pageSize":"-1","itemId":"store","autoLoad":"false","url":"m?xwl=xc/gl/tools/data-transfer/data/getTableColumns"},"events":{"load":"if(records.length === 0)\n   Wb.info('当前模板的数据模型不存在！');"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"window"},{"configs":{"frame":"false","height":"550","layout":"fit","width":"800","closeAction":"hide","resizable":"true","buttonAlign":"center","buttons":"app.newWinBtns","itemId":"newWin","dialog":"false","modal":"true"},"events":{"close":"app.queryBtn.fireEvent('click');"},"children":[{"configs":{"frame":"false","style":"border-width:0px","layout":"border","itemId":"modelForm","border":"false"},"children":[{"configs":{"region":"north","title":"{#modelTitle#}","height":"55","layout":"column","itemId":"modelSet"},"children":[{"configs":{"hidden":"true","itemId":"templateId"},"children":[],"expanded":true,"type":"text"},{"configs":{"tagConfigs":"columnWidth:0.35","labelWidth":"80","allowBlank":"false","displayField":"APP_NAME","width":"300","valueField":"APP_ID","labelAlign":"right","itemId":"appName","fieldLabel":"{#applicationName#}","editable":"false"},"children":[{"configs":{"pageSize":"-1","autoLoad":"true","itemId":"store","url":"m?xwl=xc/gl/tools/data-transfer/data/getUserApp"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"},{"configs":{"tagConfigs":"columnWidth:0.35","labelWidth":"80","allowBlank":"false","displayField":"VAL_NAME","width":"300","valueField":"VAL_CODE","labelAlign":"right","itemId":"templateName","fieldLabel":"{#necessaryTemplate#}","editable":"false"},"children":[{"configs":{"pageSize":"-1","autoLoad":"true","itemId":"store","url":"m?xwl=xc/gl/tools/data-transfer/data/getUncreateModel"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"},{"configs":{"tagConfigs":"columnWidth:0.3","labelWidth":"70","labelAlign":"right","itemId":"templateDesc","fieldLabel":"{#modelSummary#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"fieldset"},{"configs":{"region":"center","title":"{#modelColumn#}","layout":"fit","itemId":"columnSet"},"children":[{"configs":{"selType":"checkboxmodel","itemId":"columnGrid","editable":"true"},"children":[{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#rownum#}","width":"45","align":"center","xtype":"rownumberer","titleAlign":"center","itemId":"COLUMN_XH"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#columnCode#}","width":"150","dataIndex":"COL_CODE","itemId":"COLUMN_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#columnName#}","width":"200","dataIndex":"COL_NAME","itemId":"COLUMN_NAME_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#columnAlias#}","width":"150","dataIndex":"COL_ALIAS","itemId":"COLUMN_DESC_COL"},"children":[{"configs":{"itemId":"editor"},"children":[],"expanded":false,"type":"text"}],"expanded":false,"type":"column"},{"configs":{"text":"{#columnOrder#}","width":"50","dataIndex":"COL_SEQ","itemId":"COL_SEQ_COL","flex":"1"},"children":[{"configs":{"itemId":"editor"},"children":[],"expanded":false,"type":"number"}],"expanded":false,"type":"column"},{"configs":{"text":"COL_TYPE","hidden":"true","dataIndex":"COL_TYPE","itemId":"COL_TYPE"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"TEMPLATE_ID","hidden":"true","dataIndex":"TEMPLATE_ID","itemId":"TEMPLATE_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"TEMPLATE_DTL_ID","hidden":"true","dataIndex":"TEMPLATE_DTL_ID","itemId":"TEMPLATE_DTL_ID_COL"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"autoLoad":"false","itemId":"store","url":"m?xwl=xc/gl/tools/data-transfer/data/getModelColumns"},"events":{"beforeload":"\n"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"-","itemId":"item1"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#addColumn#}","itemId":"column_add_btn","iconCls":"plus_icon"},"events":{"click":"//获取应用ID：appId;表名称：tableName\nvar appIdVar = app.appName.getValue();\nvar tableNameVar = app.templateName.getValue();\nif(Ext.isEmpty(appIdVar) || Ext.isEmpty(tableNameVar)){\n  Wb.info('请选择应用和模板！');\n}else{\n  tableNameVar = tableNameVar.toUpperCase();\n  var win = new Ext.window.Window(app._tableColumnsWin);\n  win.show(null,function(){\n    app.tableColumnsGrid.getStore().load({params:{'tableName':tableNameVar,'appId':appIdVar}});\n  });\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item2"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#deleteColumn#}","itemId":"column_delete_btn","iconCls":"minus_icon"},"events":{"click":"var m = app.columnGrid.getSelectionModel(),s=m.getSelection(),i,j;\nvar rows = app.columnGrid.getSelection();\nif(s.length===0) return;\nWb.confirm('确定要删除所选数据吗？',function(){\n      Wb.request({\n        url: 'm?xwl=xc/gl/tools/data-transfer/data/deleteColumns',\n        params: {destroy: Wb.getData(rows)},\n        success: function() {\n          Wb.remove(app.columnGrid,rows);\n        },\n        failure:function(){\n          Wb.info('删除失败！');\n        }\n      });\n    \n  }); \n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item3"},"children":[],"expanded":false,"type":"item"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"fieldset"}],"expanded":true,"type":"form"}],"expanded":true,"type":"window"}],"expanded":true,"type":"folder"},{"configs":{"layout":"border","itemId":"viewport1"},"children":[{"configs":{"region":"north","height":"80","frame":"true","style":"border-width:0px","layout":"fit","itemId":"definedForm","border":"false"},"children":[{"configs":{"title":"{#setTitle#}","style":"padding-top:8px","layout":"column","itemId":"fieldset1"},"children":[{"configs":{"labelWidth":"100","labelAlign":"right","itemId":"modelName","fieldLabel":"{#modelName#}"},"events":{"specialkey":"app.definedGrid.store.load();\n"},"children":[],"expanded":false,"type":"text"},{"configs":{"text":"{#queryBtn#}","itemId":"queryBtn","iconCls":"seek_icon","x":"5"},"events":{"click":"app.definedGrid.store.load();"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#resetBtn#}","itemId":"resetBtn","iconCls":"refresh_icon","x":"15"},"events":{"click":"Wb.reset(app.definedForm);\napp.definedGrid.store.load();"},"children":[],"expanded":false,"type":"button"}],"expanded":false,"type":"fieldset"}],"expanded":true,"type":"form"},{"configs":{"region":"center","selType":"checkboxmodel","itemId":"definedGrid"},"events":{"itemdblclick":"app.editBtn.fireEvent('click');"},"children":[{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#rownum#}","width":"45","xtype":"rownumberer","align":"center","titleAlign":"center","itemId":"XL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"TEMPLATE_ID","hidden":"true","dataIndex":"TEMPLATE_ID","itemId":"TEMPLATE_ID"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#modelCode#}","width":"150","dataIndex":"TEMPLATE_CODE","itemId":"TEMPLATE_CODE"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#templateName#}","width":"180","dataIndex":"TEMPLATE_NAME","itemId":"TEMPLATE_NAME"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#modelSummary#}","width":"200","dataIndex":"TEMPLATE_DESC","itemId":"TEMPLATE_DESC"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#belongApp#}","width":"130","dataIndex":"APP_NAME","itemId":"APP_NAME"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#creationDate#}","width":"130","dataIndex":"CREATION_DATE","itemId":"CREATION_DATE"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#creator#}","width":"100","dataIndex":"CREATED_NAME","itemId":"CREATED_NAME"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#lastUpdateDate#}","width":"130","dataIndex":"LAST_UPDATE_DATE","itemId":"LAST_UPDATE_DATE"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#lastUpdatedBy#}","width":"130","dataIndex":"LAST_UPDATED_NAME","itemId":"LAST_UPDATED_NAME"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"store","autoLoad":"true","url":"m?xwl=xc/gl/tools/data-transfer/data/getDataModel"},"events":{"beforeload":"if(Ext.isEmpty(app.modelName.getValue())){\n  store.getProxy().extraParams.templateName = '%%';\n}else{\n  store.getProxy().extraParams.templateName = '%'+app.modelName.getValue()+'%';\n}\n\n"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"-","itemId":"item1"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#addBtn#}","itemId":"addBtn","iconCls":"record_add_icon"},"events":{"click":"var win = new Ext.window.Window(app._newWin);\nwin.setTitle('新增');\nwin.show(null,function(){\n  app.columnGrid.getStore().load({params:{'templateId':''}});\n});\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item2"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#editBtn#}","itemId":"editBtn","iconCls":"record_edit_icon"},"events":{"click":"var rows = app.definedGrid.getSelection();\nif(rows.length != 1) {\n  Wb.info('请选择一条记录！');\n}else{\n  var row = rows[0];\n  var win = new Ext.window.Window(app._newWin);\n  app.appName.getStore().load(function(){\n    app.appName.setValue(row.data.APP_ID);\n    app.templateName.getStore().getProxy().url = 'm?xwl=xc/gl/tools/data-transfer/data/getEditModel';\n    app.templateName.getStore().load(function(){\n      app.templateName.setValue(row.data.TEMPLATE_CODE);\n    });\n  });\n  app.templateId.setValue(row.data.TEMPLATE_ID);\n  app.templateDesc.setValue(row.data.TEMPLATE_DESC);\n  win.setTitle('编辑');\n  win.show(null,function(){\n   app.columnGrid.getStore().load({params:{'templateId':row.data.TEMPLATE_ID}});\n   app.appName.setReadOnly(true);\n   app.templateName.setReadOnly(true);\n});\n\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item3"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#delBtn#}","itemId":"deleteBtn","iconCls":"record_delete_icon"},"events":{"click":"var rows = app.definedGrid.getSelectionModel().getSelection();\nif(rows.length===0){\n  Wb.info('请选择一条记录!');\n}else{\n  record = rows[0];\n  Ext.Msg.confirm('提示','您确定要删除所选的记录吗？',function(a){\n    if(a=='yes'){\n       Wb.request({\n         url:'m?xwl=xc/gl/tools/data-transfer/data/deleteTempalte',\n         params:{destroy: Wb.getData(rows)},\n         success:function(){\n           Wb.info('删除成功！');\n           Wb.remove(app.definedGrid,rows);\n         }\n       });\n    }\n  });\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item4"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#downloadBtn#}","itemId":"downModeBtn","iconCls":"down_icon"},"events":{"click":"var rows = app.definedGrid.getSelection();\nif(rows.length !==1){\n  Wb.info('请选择一条要导出的模板记录！');\n}else{\n  var _templateCode = rows[0].data.TEMPLATE_CODE;\n  window.location.href = '{#contextPath#}/glDataTransgerManageAction.do?method=createDataTransferModel&modelCode='+_templateCode;\n}\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item5"},"children":[],"expanded":false,"type":"item"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":false,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}