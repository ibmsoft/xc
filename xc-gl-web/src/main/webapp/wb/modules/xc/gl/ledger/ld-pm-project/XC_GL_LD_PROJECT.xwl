{"inframe":false,"title":"项目段值管理","hidden":false,"roles":{"default":1},"children":[{"configs":{"loginRequired":"false","serverScript":"//---------------------获取当前模块语言对应的.json文件，放到request中----------------\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xc/gl/ledger/ld-pm-project/json/XC_GL_LD_PROJECT\");\n\nvar ctxPath = request.getContextPath() ;\nrequest.setAttribute(\"contextPath\",ctxPath);\n\nvar ledger_id = request.getParameter('ledger_id');\nrequest.setAttribute('ledger_id',ledger_id);","itemId":"module"},"events":{"finalize":"var ledger_id1 = '{#ledger_id#}';//外地操作","initialize":"var project_id='';//工程的id\nvar project_code;\nvar project_name;\nvar start_date;\nvar end_date;\nvar user_array;//用户数组\nvar dept_array;//产本中心数组\nvar flag;//判断是否点击了回车键\nfunction beforeDropType(node, data, overModel, dropPosition, options) {\n  //拖动前时间\n  //完成拖动: return true;\n  //取消拖动: return false;\n  return true;\n}\nfunction dropType(node, data, overModel, dropPosition, options) {\n  Wb.mask(app.controlTree);\n  //树的根节点\n  var rootNode = app.controlTree.getRootNode();\n  //父节点id\n  var parentId = '';\n  //拖动节点id\n  var srcId = data.records[0].get('id');\n  //拖动节点新生成的排序号\n  //var orderNum = '';\n  \n  //判断是否添加到根节点\n  if(overModel == rootNode){\n    Wb.unmask(app.controlTree);\n    parentId = -1;\n    //orderNum = overModel.lastChild.previousSibling ? Number(overModel.lastChild.previousSibling.get('IDX')) + 1 : 0;\n  }else{\n    if(dropPosition==='append'){//拖动为子节点 append\n      //展开拖动到的节点，为了获取拖动到节点的子节点。\n      overModel.expand(false,function(){\n        Wb.unmask(app.controlTree);\n        parentId = overModel.get('id');\n        //orderNum = overModel.lastChild.previousSibling ? Number(overModel.lastChild.previousSibling.get('IDX')) + 1 : 0;\n      });\n    }else if(dropPosition==='before'){//拖动到节点前 before\n      Wb.unmask(app.controlTree);\n      //判断根节点节点\n      if(overModel.parentNode == rootNode){\n        parentId = -1;\n      }else{\n        parentId = overModel.parentNode.get('id');\n      }\n      //orderNum = overModel.get('IDX');\n    }else{//拖动到节点后 after\n      Wb.unmask(app.controlTree);\n      if(overModel.parentNode == rootNode){\n        parentId = -1;\n      }else{\n        parentId = overModel.parentNode.get('id');\n      }\n      //orderNum = overModel.get('IDX') + 1;\n    }\n  }\n  \n  Wb.request({\n    url: 'm?xwl=xc/gl/ledger/ld-pm-project/ld-pm-project-db/updateFunMenuIdx', \n    params: {parentId:parentId, funTreeId: srcId}, \n    success: function(response){\n      if(dropPosition == 'append'){\n        //动态修改节点属性值\n        overModel.lastChild.set('PARENT_ID', parentId);\n        //overModel.lastChild.set('IDX', orderNum);\n        overModel.commit();\n      }else{\n        var hasReachSrcNode = false;\n        overModel.eachChild(function(cNode) {\n          //判断是否为拖动的节点\n          if(cNode.get('ID') == srcId){\n            cNode.set('parent_id', parentId);\n            //cNode.set('IDX', orderIndex);\n            cNode.commit();\n          }\n          //拖动节点后面的节点序号+1\n//           var i = Number(cNode.get('IDX'));\n//           if (i >= orderNum) {\n//             cNode.set('IDX', i + 1);\n//             cNode.commit();\n//           } \n        });\n      }\n    },\n    failure:function(response){\n    }\n  });\n}"},"children":[{"configs":{"itemId":"stores"},"children":[{"configs":{"autoLoad":"true","itemId":"dimstore","url":"m?xwl=xc/gl/ledger/ld-pm-project/ld-pm-project-db/selectDim"},"children":[],"expanded":false,"type":"store"},{"configs":{"autoLoad":"true","itemId":"codestore","url":"m?xwl=xc/gl/ledger/ld-pm-project/ld-pm-project-db/selectCode"},"children":[],"expanded":false,"type":"store"},{"configs":{"autoLoad":"true","itemId":"ledgerstore","url":"m?xwl=xc/com-qry/gl-ledgers/select-sec-fd-ledgers"},"events":{"success":"if(store.getCount() === 1){\n  Wb.setValue(app.LEDGER_NAMES, {'LEDGER_NAMES':records[0].data.LEDGER_ID});\n  \n}"},"children":[],"expanded":false,"type":"store"}],"expanded":false,"type":"folder"},{"configs":{"itemId":"windows"},"children":[{"configs":{"title":"项目预算汇总详情","height":"500","width":"900","layout":"border","closeAction":"hide","dialog":"true","itemId":"seeBudgetWin","modal":"true"},"children":[{"configs":{"region":"center","height":"500","forceFit":"true","itemId":"grid11"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/gl/ledger/ld-pm-project/ld-pm-project-db/selectBgPrj"},"events":{"beforeload":"store.proxy.extraParams.LEDGER_ID = app.LEDGER_NAMES.getValue();\nstore.proxy.extraParams.PROJECT_ID = project_id;"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#rownum#}","xtype":"rownumberer","width":"45","align":"center","titleAlign":"center","itemId":"rownumber"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#BG_ITEM_NAME_COL#}","width":"150","align":"center","dataIndex":"BG_ITEM_NAME","itemId":"BG_ITEM_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#DEPT_NAME_COL#}","width":"120","align":"center","dataIndex":"DEPT_NAME","itemId":"DEPT_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"月份","hidden":"true","width":"70","align":"center","itemId":"MONTH_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#BG_AMT_COL#}","width":"80","align":"center","dataIndex":"BG_AMT","itemId":"BG_AMT_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#BG_ITEM_DESC_COL#}","width":"300","align":"center","dataIndex":"BG_ITEM_DESC","itemId":"BG_ITEM_DESC_COL"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":false,"type":"window"},{"configs":{"title":"预算设置","height":"290","width":"400","layout":"form","closeAction":"hide","dialog":"true","defaultFocus":"prj_ctrm_mode","border":"false","itemId":"propertyWin","modal":"true"},"events":{"ok":"\nif((!Ext.isEmpty(app.prj_ctrm_mode.getValue()))&& (Ext.isEmpty(app.prj_ctrl_dim.getValue()))){\n  Wb.toast('请输入控制维度！');\n  app.prj_ctrl_dim.focus();\n  return false;\n}"},"children":[{"configs":{"title":"基本信息","height":"100","layout":"form","width":"334","itemId":"fieldset1"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","itemId":"tr1"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","width":"300","margin":"10 0 0 0 ","labelAlign":"right","itemId":"project_code","fieldLabel":"项目编码"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","itemId":"tr2"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","width":"300","margin":"10 0 0 0 ","labelAlign":"right","itemId":"project_name","fieldLabel":"项目名称"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":false,"type":"fieldset"},{"configs":{"title":"项目预算控制","height":"100","layout":"form","width":"334","itemId":"fieldset2"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","itemId":"tr3"},"children":[{"configs":{"labelWidth":"80","store":"app.codestore","displayField":"VAL_NAME","width":"300","valueField":"VAL_CODE","margin":"10 0 0 0","labelAlign":"right","itemId":"prj_ctrm_mode","fieldLabel":"控制方式"},"children":[],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","itemId":"tr4"},"children":[{"configs":{"labelWidth":"80","store":"app.dimstore","displayField":"VAL_NAME","width":"300","valueField":"VAL_CODE","margin":"10 0 0 0 ","labelAlign":"right","itemId":"prj_ctrl_dim","fieldLabel":"控制维度"},"children":[],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"hidden":"true","itemId":"hidden"},"children":[{"configs":{"itemId":"IS_BG_CTRL"},"children":[],"expanded":false,"type":"text"}],"expanded":false,"type":"panel"}],"expanded":true,"type":"fieldset"}],"expanded":false,"type":"window"},{"configs":{"height":"300","width":"400","layout":"form","closeAction":"hide","dialog":"true","border":"false","itemId":"addAndEditWin","modal":"true"},"events":{"ok":"if(Ext.isEmpty(app.PROJECT_CODE.getValue())){\nWb.toast('项目编码不能为空!');\n  app.PROJECT_CODE.focus();\n  return false;\n}\nif(Ext.isEmpty(app.PROJECT_NAME.getValue())){\nWb.toast('项目名称不能为空!');\n  app.PROJECT_NAME.focus();\n  return false;\n}\nif(Ext.isEmpty(app.START_DATE.getValue())){\nWb.toast('开始日期不能为空!');\n  app.START_DATE.focus();\n  return false;\n}\n"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","height":"30","layout":"column","margin":"10 0 0 30","border":"false","itemId":"tr1"},"children":[{"configs":{"labelWidth":"100","readOnly":"true","store":"app.ledgerstore","displayField":"LEDGER_NAME","width":"300","valueField":"LEDGER_ID","labelAlign":"right","itemId":"LEDGER_ID","fieldLabel":"<font color='red'>*<\/font>{#LEDGER_NAMES#}"},"events":{"select":"var id = combo.getValue() ;\nvar name = combo.getRawValue() ;\n\n// var r = app.grid1.getSelectionModel().getSelection();\n// r[0].set('LEDGER_ID',id) ;\n//LEDGER_ID.setValue(id);\n//  var r =  app.text1.getValue();\ncombo.setValue(name);\napp.LEDGER_ID.setValue(id);\n//alert(app.text1.getValue());\n// alert(app.UP_PROJECT_ID.getValue());\n// r.setValue('LEDGER_ID',id);\n// alert(r.getValue());\n//PROJECT_NAME.setValue(\"1\");"},"children":[],"expanded":true,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","height":"30","layout":"column","margin":"10 0 0 30","border":"false","itemId":"tr2"},"children":[{"configs":{"labelWidth":"100","width":"300","labelAlign":"right","itemId":"PROJECT_CODE","fieldLabel":"<font color='red'>*<\/font>{#PROJECT_CODE_COL#}"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"PROJECT_ID"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","height":"30","layout":"column","margin":"10 0 0 30","border":"false","itemId":"tr3"},"children":[{"configs":{"labelWidth":"100","width":"300","labelAlign":"right","itemId":"PROJECT_NAME","fieldLabel":"<font color='red'>*<\/font>{#PROJECT_NAME_COL#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","height":"30","hidden":"true","layout":"column","border":"false","itemId":"tr4"},"children":[{"configs":{"readOnly":"true","itemId":"UP_PROJECT_ID","fieldLabel":"上级ID"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","height":"30","layout":"column","margin":"10 0 0 30","border":"false","itemId":"tr5"},"children":[{"configs":{"labelWidth":"100","width":"300","labelAlign":"right","itemId":"START_DATE","fieldLabel":"<font color='red'>*<\/font>{#START_DATE_COL#}"},"children":[],"expanded":false,"type":"date"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","height":"30","layout":"column","margin":"10 0 0 30","border":"false","itemId":"tr6"},"children":[{"configs":{"labelWidth":"100","width":"300","labelAlign":"right","itemId":"END_DATE","fieldLabel":"{#END_DATE_COL#}"},"children":[],"expanded":false,"type":"date"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"window"},{"configs":{"maximized":"true","title":"{#importDataWin#}","height":"400","minimizable":"true","width":"750","layout":"border","dialog":"false","border":"false","itemId":"importDataWin","modal":"true","maximizable":"true","createInstance":"false"},"events":{"close":"app.controlTree.store.load();"},"children":[{"configs":{"region":"center","frame":"true","style":"border-width:0px","layout":"column","padding":"15 0 0 5","border":"false","itemId":"importForm"},"children":[{"configs":{"labelWidth":"80","allowBlank":"false","emptyText":"请选择Excel文件","labelAlign":"left","itemId":"selectFile","fieldLabel":"<font color='red'>*<\/font>{#selectFile#}"},"children":[],"expanded":false,"type":"file"},{"configs":{"text":"{#importFile#}","itemId":"importFile","iconCls":"ok_icon","x":"2"},"events":{"click":"if(!app.importForm.getForm().isValid()){\n  Wb.info('请选择要上传的文件！');\n  return false;\n}\nvar fileType = app.selectFile.getValue();\nif(!Ext.String.endsWith(fileType,'.xls')){\n  Wb.info('请选择以xls结尾的Office Excel文档!',function(){\n    app.importForm.getForm().reset();\n  });\n}else{\n  //导入前，先清除错误数据\n  app.importLogGrid.getStore().removeAll();\n  var msgProcessBar = Ext.Msg.show({\n     title:'提示',\n     msg  :'导入中，请稍后.....',\n     wait :true,\n     width:200\n  });\n  //将Office Excel数据导入到余额临时表中\n  app.importForm.getForm().submit({\n    url:'{#contextPath#}/glDataTransgerManageAction.do?method=importAccountData&templateCode=XC_PM_PROJECTS&ledgerId='+app.LEDGER_NAMES.getValue(),\n    timeout:3600*1000,\n    success:function(form,action){\n      msgProcessBar.hide();\n      Wb.info(action.result.msg,function(){\n        app.importDataWin.close();\n      });\n    },\n    failure:function(form,action){\n      msgProcessBar.hide();\n      var _flag = action.result.flag;\n      //flag =0,导入时发生异常，输出异常信息\n      if(_flag == '0'){\n        Wb.info(action.result.msg);\n      }else if(_flag == '2'){\n       //flag =2,数据导入临时表成功，数据校验发生异常\n        var _sessionId = action.result.msg;\n        Wb.info('导入数据不合法！');\n        app.importLogGrid.getStore().load({params:{'sessionId':_sessionId}});\n      }\n    }   \n  });\n}"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"form"},{"configs":{"region":"south","height":"'88%'","itemId":"southTab"},"children":[{"configs":{"title":"{#importLogGrid#}","selType":"checkboxmodel","itemId":"importLogGrid"},"children":[{"configs":{"pageSize":"-1","autoLoad":"true","itemId":"store","url":"m?xwl=xc/gl/ledger/ld-pm-project/ld-pm-project-db/getInvalidProject"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#rownum#}","width":"70","dataIndex":"ROW_NUM","itemId":"ROW_NUM","renderer":"return '<font color=\"red\">'+value+'<\/font>';"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#PROJECT_CODE_COL#}","width":"150","dataIndex":"PROJECT_CODE","itemId":"PROJECT_CODE"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#PROJECT_NAME_COL#}","width":"200","dataIndex":"PROJECT_NAME","itemId":"PROJECT_NAME"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#IS_BG_CTRL#}","width":"120","dataIndex":"IS_BG_CTRL","itemId":"IS_BG_CTRL","renderer":"if(value == 'N')\n  return '否';\nelse\n   return '是';"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#START_DATE_COL#}","width":"150","dataIndex":"START_DATE","itemId":"START_DATE"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#END_DATE_COL#}","width":"150","dataIndex":"END_DATE","itemId":"END_DATE"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#E_MSG#}","width":"300","dataIndex":"ERROR_MSG","itemId":"E_MSG","renderer":"metaData.style = 'overflow:auto;padding: 3px 6px;text-overflow: ellipsis;white-space: nowrap;white-space:normal;line-height:15px;';   \nreturn '<font color=\"red\">'+value+'<\/font>';","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":false,"type":"grid"}],"expanded":true,"type":"tab"}],"expanded":false,"type":"window"}],"expanded":true,"type":"folder"},{"configs":{"layout":"border","border":"false","itemId":"viewport1"},"events":{"afterrender":"\n","beforerender":"if(!Ext.isEmpty('{#ledger_id#}')){\n  app.ledgerstore.load(\n    {params:{ledger_id:ledger_id1} }\n  );\n  app.LEDGER_NAMES.setValue(ledger_id1);\n}"},"children":[{"configs":{"region":"north","frame":"false","layout":"form","border":"false","itemId":"form1"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"column","padding":"10","border":"false","itemId":"panel2"},"children":[{"configs":{"labelWidth":"{#LedgerNameLW#}","store":"app.ledgerstore","displayField":"LEDGER_NAME","autoSelect":"true","width":"330","valueField":"LEDGER_ID","labelAlign":"right","itemId":"LEDGER_NAMES","fieldLabel":"{#LEDGER_NAMES#}"},"events":{"change":"// TODO: 启用按钮\napp.importBtn.enable();\napp.exportBtn.enable();\n\n// TODO: 加载项目数据并展开一级目录\napp.controlTree.store.load();\napp.controlTree.getRootNode().expand();\n"},"children":[],"expanded":true,"type":"combo"}],"expanded":true,"type":"panel"}],"expanded":false,"type":"form"},{"configs":{"region":"west","animate":"false","collapsible":"true","root":"{text:Str.all,PARENT_ID:'root',id:'-1',text:'{#project#}',expanded:true}","width":"250","itemId":"controlTree","iconCls":"tool_icon","rootVisible":"true","tools":"Wb.getTreeTools({search:true})","title":"{#controlTree#}","frame":"false","split":"true","border":"false","viewConfig":"{\n  plugins : {\n    pluginId: 'ddPlug',\n    ptype: 'treeviewdragdrop'\n  },\n  listeners : {\n    beforedrop: beforeDropType,\n    drop: dropType\n  }\n}"},"events":{"itemclick":"var parentId = record.data.id;\nif (parentId !== '-1') {\n  app.propertyBtn.enable();\n  app.seekBudgetBtn.enable();\n  app.addBtn.enable();\n  app.delBtn.enable();\n}\nif (parentId === '-1') {\n  app.propertyBtn.disable();\n  app.seekBudgetBtn.disable();\n  app.addBtn.disable();\n  app.delBtn.disable();\n}\nvar ledgerId = app.LEDGER_NAMES.getValue();\napp.grid1.store.load({\n  params: {\n    project_id: parentId,\n    ledger_id: ledgerId\n  }\n});\n\nproject_id = parentId;\nproject_code = record.data.code;\nproject_name = record.data.text;\nstart_date = record.data.START_DATE;\nend_date = record.data.END_DATE;\nledger_id = ledgerId;\napp.grid2.store.load({\n  params: {\n    LEDGER_ID: ledger_id,\n    PROJECT_ID: project_id\n  }\n});\n","itemdblclick":"var id = record.get('id');\nvar code = record.get('code');\nvar name = record.get('text');\nvar ledger_id = record.get('ledger_id');\nvar start_date = record.get('START_DATE');\nvar end_date = record.get('END_DATE');\nvar up_project_id = record.get('parent_id');\nvar end_date1;//判断结束日期\nvar end_date1Flag = 'flase';//判断结束日期是否发生了变化\nif(id !== '-1'){\n  Wb.request({\n    url:'m?xwl=xc/gl/ledger/ld-pm-project/ld-pm-project-db/selectPROJECT_IDIfUsed',\n    params:{'ledger_id':ledger_id,'id':id},\n    success:function(resp){\n      var returnobj = Wb.decode(resp.responseText);\n        if(returnobj.rows[0].count!==0){\n        //被引用\n                  var win = new Ext.window.Window(app._addAndEditWin);\n         win.setTitle('修改['+record.get('text')+']');\n          win.setIconCls('file_edit_icon');\n          win.show();\n          app.PROJECT_CODE.setReadOnly(true);\n          app.LEDGER_ID.setValue(ledger_id);\n          app.PROJECT_ID.setValue(id);\n          app.PROJECT_CODE.setValue(code);\n          app.PROJECT_NAME.setValue(name);\n          app.START_DATE.setValue(start_date);\n          app.END_DATE.setValue(end_date);\n        win.mon(win,'ok',function(){\n          end_date1=app.END_DATE.getValue();\n         if(end_date1===null){\n           end_date1=new Date('12/31/9999');\n           end_date1Flag = 'true';\n           app.END_DATE.setValue(end_date1);\n          }\n      if(app.START_DATE.getValue()>app.END_DATE.getValue()){\n          Wb.toast('结束日期要大于开始日期!');\n            return false;\n          }\n     //判断用户是否进行了修改\n    if( name === app.PROJECT_NAME.getValue()&&app.START_DATE.getValue()-start_date === 0 && (end_date1Flag === 'true' || (app.END_DATE.getValue() - end_date === 0))){\n       //没有进行修改 \n      win.close();\n      return false;\n     }\n      Wb.request({\n    url: 'm?xwl=xc/gl/ledger/ld-pm-project/ld-pm-project-db/update-project',\n    params: {'PROJECT_ID':id,'PROJECT_CODE':app.PROJECT_CODE.getValue(),'PROJECT_NAME':app.PROJECT_NAME.getValue(),'LEDGER_ID':ledger_id,\n             'START_DATE':app.START_DATE.getValue(),'END_DATE':app.END_DATE.getValue()\n             },\n    success: function() {\n      win.close(); //根据closeAction属性，默认为销毁\n      Wb.toast('修改成功！');\n      app.controlTree.store.load({params:{ledger_id : app.LEDGER_NAMES.getValue()}});\n        app.grid1.store.load({params:{project_id:up_project_id}});\n    }\n  });\n        \n        });\n        }\n      else{\n          var win = new Ext.window.Window(app._addAndEditWin);\n         win.setTitle('修改['+record.get('text')+']');\n          win.setIconCls('file_edit_icon');\n          win.show();\n          app.LEDGER_ID.setValue(ledger_id);\n          app.PROJECT_ID.setValue(id);\n          app.PROJECT_CODE.setValue(code);\n          app.PROJECT_NAME.setValue(name);\n          app.START_DATE.setValue(start_date);\n          app.END_DATE.setValue(end_date);\n        win.mon(win,'ok',function(){\n          end_date1=app.END_DATE.getValue();\n         if(end_date1===null){\n           end_date1=new Date('12/31/9999');\n           end_date1Flag = 'true';\n           app.END_DATE.setValue(end_date1);\n          }\n      if(app.START_DATE.getValue()>app.END_DATE.getValue()){\n          Wb.toast('结束日期要大于开始日期!');\n            return false;\n          }\n     //判断用户是否进行了修改\n    if(code === app.PROJECT_CODE.getValue() && name === app.PROJECT_NAME.getValue()&&app.START_DATE.getValue()-start_date === 0 && (end_date1Flag === 'true' || (app.END_DATE.getValue() - end_date === 0))){\n       //没有进行修改 \n      win.close();\n      return false;\n     }\n      Wb.request({\n    url: 'm?xwl=xc/gl/ledger/ld-pm-project/ld-pm-project-db/update-project',\n    params: {'PROJECT_ID':id,'PROJECT_CODE':app.PROJECT_CODE.getValue(),'PROJECT_NAME':app.PROJECT_NAME.getValue(),'LEDGER_ID':ledger_id,\n             'START_DATE':app.START_DATE.getValue(),'END_DATE':app.END_DATE.getValue()\n             },\n    success: function() {\n      win.close(); //根据closeAction属性，默认为销毁\n      Wb.toast('修改成功！');\n      app.controlTree.store.load({params:{ledger_id : ledger_id}});\n        app.grid1.store.load({params:{project_id:up_project_id}});\n    }\n  });\n        \n        });\n      }\n    }\n  \n  });\n  \n\n\n}","tagEvents":"itemcontextmenu: function(view, record, item, index, event, options) {\n  if (Ext.isEmpty(app.LEDGER_NAMES.getValue())) {\n    Wb.toast('请先选择账簿！');\n    return false;\n  }\n  event.preventDefault();\n  event.stopEvent();\n  var id = record.get('id');\n  if(id === undefined || id === ''){\n    id = '-1' ;\n  }\n  var up_project_id = record.get('parent_id');\n  var project_code = record.get('code');\n  var project_name = record.get('text');\n  var ledger_id = record.get('ledger_id');\n  var ledger_name = record.get('ledger_name');\n  var start_date = record.get('START_DATE');\n  var end_date = record.get('END_DATE');\n  var leaf = record.get(\"leaf\");\n  var nodemenu\n  var LEDGER_NAME = app.LEDGER_NAMES.getRawValue();\n  var LEDGER_ID = app.LEDGER_NAMES.getValue();\n  var START_DATE = app.START_DATE.getValue();\n  var END_DATE = app.END_DATE.getValue();\n  var end_date1; //判断结束日期\n  var end_date1Flag = 'flase'; //判断结束日期是否发生了变化\n  if (id == '-1') {\n    nodemenu = new Ext.menu.Menu({\n      items: [{\n        text: '新增下级项目',\n        iconCls: 'file_add_icon',\n        handler: function() {\n          var win = new Ext.window.Window(app._addAndEditWin);\n          app.UP_PROJECT_ID.setValue(id);\n          app.START_DATE.setValue(new Date());\n          win.setTitle('新增[' + record.get('text') + ']下级菜单');\n          win.show();\n          win.setIconCls('file_add_icon');\n          app.LEDGER_ID.setValue(LEDGER_ID);\n          //窗口每次动态生成,方法在窗口销毁时自动销毁\n          win.mon(win, 'ok',\n          function() {\n            end_date1 = app.END_DATE.getValue();\n            if (end_date1 === null) {\n              end_date1 = new Date('12/31/9999');\n              app.END_DATE.setValue(end_date1);\n            }\n\n            var values = Wb.getValue(win);\n            Wb.request({\n              url: 'm?xwl=xc/gl/ledger/ld-pm-project/ld-pm-project-db/insertProject',\n              params: values,\n              success: function(resp) {\n                win.close(); //根据closeAction属性，默认为销毁\n                Wb.toast('增加成功！');\n                app.controlTree.store.load({\n                  params: {\n                    ledger_id: app.LEDGER_NAMES.getValue()\n                  }\n                });\n                return false;\n              }\n            });\n          });\n        }\n      }]\n    });\n    nodemenu.showAt(event.getPoint());\n  } else {\n    //判断是否被引用\n    Wb.request({\n      url: 'm?xwl=xc/gl/ledger/ld-pm-project/ld-pm-project-db/selectPROJECT_IDIfUsed',\n      params: {\n        'ledger_id': LEDGER_ID,\n        'id': id\n      },\n      success: function(resp) {\n        var returnobj = Wb.decode(resp.responseText);\n        if (returnobj.rows[0].count !== 0) {\n          //被引用了\n          //菜单\n          nodemenu = new Ext.menu.Menu({\n            items: [{\n              text: '新增同级项目',\n              iconCls: 'file_add_icon',\n              handler: function() {\n\n                var win = new Ext.window.Window(app._addAndEditWin);\n                app.UP_PROJECT_ID.setValue(up_project_id);\n                app.LEDGER_ID.setValue(LEDGER_ID);\n                app.START_DATE.setValue(new Date());\n                win.setTitle('新增[' + record.get('text') + ']同级菜单');\n                win.show();\n                win.setIconCls('record_add_icon');\n                //窗口每次动态生成,方法在窗口销毁时自动销毁\n                win.mon(win, 'ok',\n                function() {\n                  end_date1 = app.END_DATE.getValue();\n                  if (end_date1 === null) {\n                    end_date1 = new Date('12/31/9999');\n                    app.END_DATE.setValue(end_date1);\n                  }\n                  var values = Wb.getValue(win);\n                  Wb.request({\n                    url: 'm?xwl=xc/gl/ledger/ld-pm-project/ld-pm-project-db/insertProject',\n                    params: values,\n                    success: function(resp) {\n                      win.close(); //根据closeAction属性，默认为销毁\n                      Wb.toast('增加成功！');\n                      app.controlTree.store.load({\n                        params: {\n                          ledger_id: app.LEDGER_NAMES.getValue()\n                        }\n                      });\n                      return false;\n                    }\n                  });\n                });\n              }\n            },\n            {\n              text: '修改项目',\n              iconCls: 'file_edit_icon',\n              handler: function() {\n                var win = new Ext.window.Window(app._addAndEditWin); //app._win指向配置对象而非实例\n                win.show();\n                app.PROJECT_CODE.setReadOnly(true);\n                win.setIconCls('file_edit_icon');\n                Wb.setTitle(win, '修改[' + record.get('text') + ']');\n                app.LEDGER_ID.setValue(LEDGER_ID);\n                app.PROJECT_ID.setValue(id);\n                app.PROJECT_CODE.setValue(project_code);\n                app.PROJECT_NAME.setValue(project_name);\n                app.UP_PROJECT_ID.setValue(up_project_id);\n                app.START_DATE.setValue(start_date);\n                app.END_DATE.setValue(end_date);\n                //窗口每次动态生成,方法在窗口销毁时自动销毁\n                win.mon(win, 'ok',\n                function() {\n                  end_date1 = app.END_DATE.getValue();\n                  if (end_date1 === null) {\n                    end_date1 = new Date('12/31/9999');\n                    end_date1Flag = 'true';\n                    if (end_date !== null) {\n                      end_date1Flag = 'false';\n                    }\n                    app.END_DATE.setValue(end_date1);\n                  }\n                  if (app.START_DATE.getValue() > app.END_DATE.getValue()) {\n                    Wb.toast('结束日期要大于开始日期!');\n                    return false;\n                  }\n                  //判断用户是否进行了修改\n                  if (project_name === app.PROJECT_NAME.getValue() && app.START_DATE.getValue() - start_date === 0 && (end_date1Flag === 'true' || (app.END_DATE.getValue() - end_date === 0))) {\n                    //没有进行修改 \n                    win.close();\n                    return false;\n                  }\n                  Wb.request({\n                    url: 'm?xwl=xc/gl/ledger/ld-pm-project/ld-pm-project-db/update-project',\n                    params: {\n                      'PROJECT_ID': id,\n                      'PROJECT_CODE': app.PROJECT_CODE.getValue(),\n                      'PROJECT_NAME': app.PROJECT_NAME.getValue(),\n                      'LEDGER_ID': ledger_id,\n                      'START_DATE': app.START_DATE.getValue(),\n                      'END_DATE': app.END_DATE.getValue()\n                    },\n                    success: function() {\n                      win.close(); //根据closeAction属性，默认为销毁\n                      Wb.toast('修改成功！');\n                      app.controlTree.store.load({\n                        params: {\n                          ledger_id: app.LEDGER_NAMES.getValue()\n                        }\n                      });\n                      app.grid1.store.load({\n                        params: {\n                          project_id: up_project_id\n                        }\n                      });\n                    }\n                  });\n                });\n\n              }\n            }]\n          });\n          nodemenu.showAt(event.getPoint());\n        } else {\n          //没有被引用\n          //菜单\n          nodemenu = new Ext.menu.Menu({\n            items: [{\n              text: '新增同级项目',\n              iconCls: 'file_add_icon',\n              handler: function() {\n\n                var win = new Ext.window.Window(app._addAndEditWin);\n                app.UP_PROJECT_ID.setValue(up_project_id);\n                app.LEDGER_ID.setValue(LEDGER_ID);\n                app.START_DATE.setValue(new Date());\n                win.setTitle('新增[' + record.get('text') + ']同级菜单');\n                win.show();\n                win.setIconCls('record_add_icon');\n                //窗口每次动态生成,方法在窗口销毁时自动销毁\n                win.mon(win, 'ok',\n                function() {\n\n                  end_date1 = app.END_DATE.getValue();\n                  if (end_date1 === null) {\n                    end_date1 = new Date('12/31/9999');\n                    app.END_DATE.setValue(end_date1);\n                  }\n                  var values = Wb.getValue(win);\n                  Wb.request({\n                    url: 'm?xwl=xc/gl/ledger/ld-pm-project/ld-pm-project-db/insertProject',\n                    params: values,\n                    success: function(resp) {\n                      win.close(); //根据closeAction属性，默认为销毁\n                      Wb.toast('增加成功！');\n                      app.controlTree.store.load({\n                        params: {\n                          ledger_id: app.LEDGER_NAMES.getValue()\n                        }\n                      });\n                      return false;\n                    }\n                  });\n                });\n              }\n            },\n            {\n              text: '新增下级项目',\n              iconCls: 'file_add_icon',\n              handler: function() {\n                var win = new Ext.window.Window(app._addAndEditWin);\n                app.UP_PROJECT_ID.setValue(id);\n                app.LEDGER_ID.setValue(LEDGER_ID);\n                app.START_DATE.setValue(new Date());\n                win.setTitle('新增[' + record.get('text') + ']下级菜单');\n                win.show();\n                win.setIconCls('file_add_icon');\n                //窗口每次动态生成,方法在窗口销毁时自动销毁\n                win.mon(win, 'ok',\n                function() {\n\n                  end_date1 = app.END_DATE.getValue();\n                  if (end_date1 === null) {\n                    end_date1 = new Date('12/31/9999');\n                    app.END_DATE.setValue(end_date1);\n                  }\n                  var values = Wb.getValue(win);\n                  Wb.request({\n                    url: 'm?xwl=xc/gl/ledger/ld-pm-project/ld-pm-project-db/insertProject',\n                    params: values,\n                    success: function(resp) {\n                      win.close(); //根据closeAction属性，默认为销毁\n                      Wb.toast('增加成功！');\n                      app.controlTree.store.load({\n                        params: {\n                          ledger_id: app.LEDGER_NAMES.getValue()\n                        }\n                      });\n                      return false;\n                    }\n                  });\n                });\n              }\n            },\n            {\n              text: '修改项目',\n              iconCls: 'file_edit_icon',\n              handler: function() {\n                var win = new Ext.window.Window(app._addAndEditWin); //app._win指向配置对象而非实例\n                win.show();\n                win.setIconCls('file_edit_icon');\n                Wb.setTitle(win, '修改[' + record.get('text') + ']');\n                app.LEDGER_ID.setValue(LEDGER_ID);\n                app.PROJECT_ID.setValue(id);\n                app.PROJECT_CODE.setValue(project_code);\n                app.PROJECT_NAME.setValue(project_name);\n                app.UP_PROJECT_ID.setValue(up_project_id);\n                app.START_DATE.setValue(start_date);\n                app.END_DATE.setValue(end_date);\n                //窗口每次动态生成,方法在窗口销毁时自动销毁\n                win.mon(win, 'ok',\n                function() {\n                  end_date1 = app.END_DATE.getValue();\n                  if (end_date1 === null) {\n                    end_date1 = new Date('12/31/9999');\n                    app.END_DATE.setValue(end_date1);\n                    end_date1Flag = 'true';\n                    if (end_date !== null) {\n                      end_date1Flag = 'false';\n                    }\n                  }\n                  if (app.START_DATE.getValue() > app.END_DATE.getValue()) {\n                    Wb.toast('结束日期要大于开始日期!');\n                    return false;\n                  }\n                  //判断用户是否进行了修改\n                  if (project_code === app.PROJECT_CODE.getValue() && project_name === app.PROJECT_NAME.getValue() && app.START_DATE.getValue() - start_date === 0 && (end_date1Flag === 'true' || (app.END_DATE.getValue() - end_date === 0))) {\n                    //没有进行修改 \n                    win.close();\n                    return false;\n                  }\n                  Wb.request({\n                    url: 'm?xwl=xc/gl/ledger/ld-pm-project/ld-pm-project-db/update-project',\n                    params: {\n                      'PROJECT_ID': id,\n                      'PROJECT_CODE': app.PROJECT_CODE.getValue(),\n                      'PROJECT_NAME': app.PROJECT_NAME.getValue(),\n                      'LEDGER_ID': ledger_id,\n                      'START_DATE': app.START_DATE.getValue(),\n                      'END_DATE': app.END_DATE.getValue()\n                    },\n                    success: function() {\n                      win.close(); //根据closeAction属性，默认为销毁\n                      Wb.toast('修改成功！');\n                      app.controlTree.store.load({\n                        params: {\n                          ledger_id: app.LEDGER_NAMES.getValue()\n                        }\n                      });\n                      app.grid1.store.load({\n                        params: {\n                          project_id: up_project_id\n                        }\n                      });\n                    }\n                  });\n                });\n              }\n            },\n            {\n              text: '删除',\n              iconCls: 'file_delete_icon',\n              handler: function() {\n                if (leaf === false) {\n                  Wb.toast('该项目下有子项目,不能删除！');\n                  return false;\n                }\n                Wb.confirm('确定删除' + project_name + '吗?',\n                function() {\n                  Wb.request({\n                    url: 'm?xwl=xc/gl/ledger/ld-pm-project/ld-pm-project-db/delete-project',\n                    params: {\n                      'project_id': id\n                    },\n                    success: function() {\n\n                      app.controlTree.store.load({\n                        params: {\n                          ledger_id: app.LEDGER_NAMES.getValue()\n                        }\n                      });\n                      app.grid1.store.load({\n                        params: {\n                          project_id: up_project_id\n                        }\n                      });\n                      Wb.toast('删除成功！');\n                      return false;\n\n                    }\n                  });\n                });\n\n              }\n            }]\n          });\n          nodemenu.showAt(event.getPoint());\n        }\n      }\n\n    });\n\n  }\n\n}"},"children":[{"configs":{"autoLoad":"false","itemId":"store","url":"m?xwl=xc/gl/ledger/ld-pm-project/ld-pm-project-db/select-projects"},"events":{"beforeload":"// 父节点ID\nvar pid = operation.node.get('id') ;\nif(pid === undefined || pid === ''){\n  pid = '-1' ;\n}\n// 加载参数\noperation.params.parentID=pid;\noperation.params.ledger_id=app.LEDGER_NAMES.getValue();"},"children":[],"expanded":false,"type":"treestore"}],"expanded":true,"type":"tree"},{"configs":{"region":"center","layout":"border","itemId":"panel1"},"children":[{"configs":{"region":"center","height":"500","forceFit":"true","itemId":"grid1","editable":"false"},"events":{"itemdblclick":"var rows = app.grid1.getSelection();\nvar id = rows[0].data.PROJECT_ID;\n //判断是否被引用\n    Wb.request({\n      url:'m?xwl=xc/gl/ledger/ld-pm-project/ld-pm-project-db/selectPROJECT_IDIfUsed',\n      params:{'ledger_id':app.LEDGER_NAMES.getValue(),'id':rows[0].data.PROJECT_ID},\n      success:function(resp){\n        var win = new Ext.window.Window(app._addAndEditWin);\n        var end_date1Flag = 'false';\n        win.setTitle('修改');\n        win.setIconCls('file_edit_icon');\n        win.show();\n      var returnobj = Wb.decode(resp.responseText);\n        if(returnobj.rows[0].count!==0){\n          //被引用\n         app.PROJECT_CODE.setReadOnly(true);\n        } \n          app.LEDGER_ID.setValue(app.LEDGER_NAMES.getValue());\n          app.PROJECT_ID.setValue(rows[0].data.PROJECT_ID);\n          app.PROJECT_CODE.setValue(rows[0].data.PROJECT_CODE);\n          app.PROJECT_NAME.setValue(rows[0].data.PROJECT_NAME);\n          app.START_DATE.setValue(rows[0].data.START_DATE);\n          app.END_DATE.setValue(rows[0].data.END_DATE);\n          win.mon(win,'ok',function(){\n          var end_date1=app.END_DATE.getValue();\n         if(end_date1===null){\n           end_date1=new Date('12/31/9999');\n           end_date1Flag = 'true';\n           if(rows[0].data.END_DATE!==null){\n           end_date1Flag = 'false';\n           }\n           app.END_DATE.setValue(end_date1);\n          }\n      if(app.START_DATE.getValue()>app.END_DATE.getValue()){\n          Wb.toast('结束日期要大于开始日期!');\n            return false;\n          }\n        //判断用户是否进行了修改\n    if(rows[0].data.PROJECT_CODE === app.PROJECT_CODE.getValue() && rows[0].data.PROJECT_NAME === app.PROJECT_NAME.getValue()&&app.START_DATE.getValue()-rows[0].data.START_DATE === 0 && (end_date1Flag === 'true' || (app.END_DATE.getValue() -  rows[0].data.END_DATE  === 0))){\n       //没有进行修改 \n      win.close();\n     return false;\n     }\n   Wb.request({\n    url: 'm?xwl=xc/gl/ledger/ld-pm-project/ld-pm-project-db/update-project',\n    params: {'PROJECT_ID':app.PROJECT_ID.getValue(),'PROJECT_CODE':app.PROJECT_CODE.getValue(),'PROJECT_NAME':app.PROJECT_NAME.getValue(),'LEDGER_ID':app.LEDGER_NAMES.getValue(),\n             'START_DATE':app.START_DATE.getValue(),'END_DATE':app.END_DATE.getValue()\n             },\n    success: function() {\n      win.close(); //根据closeAction属性，默认为销毁\n      Wb.toast('修改成功！');\n      app.controlTree.store.load({params:{ledger_id : app.LEDGER_NAMES.getValue()}});\n        app.grid1.store.load({params:{project_id:id}});\n    }\n  });\n          });\n      }});\n"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/gl/ledger/ld-pm-project/ld-pm-project-db/select-project"},"children":[],"expanded":false,"type":"store"},{"configs":{"region":"north","itemId":"tbar"},"children":[{"configs":{"text":"{#importBtn#}","itemId":"importBtn","disabled":"true","iconCls":"import_icon"},"events":{"click":"var ledgerIdVar = app.LEDGER_NAMES.getValue();\nif(Ext.isEmpty(ledgerIdVar)){\n  Wb.info('请选择账簿！');\n  return ;\n}else{\n  var win = new Ext.window.Window(app._importDataWin);\n  win.setTitle('导入账簿项目数据');\n  win.show();\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#exportBtn#}","itemId":"exportBtn","disabled":"true","iconCls":"export_icon"},"events":{"click":"if(Ext.isEmpty(app.LEDGER_NAMES.getValue())){\n  Wb.info('请选择账簿！');\n}else{\n  window.location.href = '{#contextPath#}/glDataTransgerManageAction.do?method=exportBaseDataByModel&templateCode=XC_PM_PROJECTS&ledgerId='+app.LEDGER_NAMES.getValue();\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#propertyBtn#}","itemId":"propertyBtn","disabled":"true","iconCls":"property_icon"},"events":{"click":"if(Ext.isEmpty(app.LEDGER_NAMES.getValue())){\nWb.toast('请先选择账簿！');\n  return false;\n}\nif(project_id===''||project_id==='-1'){\n//未点击一个工程\n  Wb.toast('请您选中一个项目！');\n  return false;\n}\nWb.request({\n  url:'m?xwl=xc/gl/ledger/ld-pm-project/ld-pm-project-db/selectProjectById',\n  params:{'project_id':project_id},\n  success:function(resp){\n    var win1=new Ext.window.Window(app._propertyWin);\n    win1.show();\n    var res=Wb.decode(resp.responseText);\n    var getproject_name=res.rows[0].PROJECT_NAME;\n    var getproject_code=res.rows[0].PROJECT_CODE;\n    var getprj_ctrl_dim=res.rows[0].PRJ_CTRL_DIM;\n    var getprj_ctrm_mode=res.rows[0].PRJ_CTRM_MODE;\n      app.project_code.setValue(getproject_code);\n      app.project_name.setValue(getproject_name);\n      app.prj_ctrl_dim.setValue(getprj_ctrl_dim);\n      app.prj_ctrm_mode.setValue(getprj_ctrm_mode);\n    win1.mon(win1,'ok',function(){\n    if(app.prj_ctrm_mode.getValue()===getprj_ctrm_mode&&app.prj_ctrl_dim.getValue()===getprj_ctrl_dim){\n    //用户没有修过\n      win1.close();\n    }\n      else{\n        var IS_BG_CTRL = 'Y';\n        if(Ext.isEmpty(app.prj_ctrm_mode.getValue())){\n        IS_BG_CTRL='N';\n        }\n      //用户进行了修过\n        Wb.request({\n        url:'m?xwl=xc/gl/ledger/ld-pm-project/ld-pm-project-db/updataProjectDimAndCode',\n        message:'正在保存......',\n        params:{'PROJECT_ID':project_id,'PRJ_CTRL_DIM':app.prj_ctrl_dim.getValue(),'PRJ_CTRM_MODE':app.prj_ctrm_mode.getValue(),'IS_BG_CTRL':IS_BG_CTRL},\n        success:function(){\n          win1.close();\n          Wb.toast('修改成功！');\n          }\n        });\n      }\n    });\n  }\n  \n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#seekBudgetBtn#}","itemId":"seekBudgetBtn","disabled":"true","iconCls":"seek_icon"},"events":{"click":"\nif(Ext.isEmpty(app.LEDGER_NAMES.getValue())){\nWb.toast('请先选择账簿！');\n  return false;\n}\nif(project_id===''||project_id === '-1'){\n  Wb.toast('请您选中一个项目！');\n  return false;\n}\nvar win1=new Ext.window.Window(app._seeBudgetWin);\napp.grid11.store.load({\nparams:{\nLEDGER_ID:app.LEDGER_NAMES.getValue(),\n  PROJECT_ID :project_id\n}\n});\nwin1.show();"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#rownum#}","align":"center","width":"60","xtype":"rownumberer","titleAlign":"center","itemId":"ROW_NUMBER_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"项目ID","hidden":"true","align":"left","dataIndex":"PROJECT_ID","titleAlign":"center","itemId":"PROJECT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"账簿ID","hidden":"true","align":"left","dataIndex":"LEDGER_ID","titleAlign":"center","itemId":"LEDGER_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"账簿名称","hidden":"true","width":"150","align":"left","dataIndex":"LEDGER_NAME","titleAlign":"center","itemId":"LEDGER_NAME_COL"},"children":[{"configs":{"displayField":"LEDGER_NAME","valueField":"LEDGER_ID","itemId":"editor"},"events":{"select":"var id = combo.getValue() ;\nvar name = combo.getRawValue() ;\n//alert(id);\nvar r = app.grid1.getSelectionModel().getSelection();\nr[0].set('LEDGER_ID',id) ;\ncombo.setValue(name);\n//app.LEDGER_ID.setValue(id);"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/com-qry/gl-ledgers/select-sec-fd-ledgers"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"}],"expanded":false,"type":"column"},{"configs":{"text":"{#PROJECT_CODE_COL#}","width":"150","align":"left","dataIndex":"PROJECT_CODE","titleAlign":"center","itemId":"PROJECT_CODE_COL"},"children":[{"configs":{"itemId":"editor"},"children":[],"expanded":false,"type":"text"}],"expanded":false,"type":"column"},{"configs":{"text":"{#PROJECT_NAME_COL#}","width":"150","align":"left","dataIndex":"PROJECT_NAME","titleAlign":"center","itemId":"PROJECT_NAME_COL"},"children":[{"configs":{"itemId":"editor"},"children":[],"expanded":false,"type":"text"}],"expanded":false,"type":"column"},{"configs":{"text":"上级ID","hidden":"true","width":"150","align":"left","dataIndex":"UP_PROJECT_ID","titleAlign":"center","itemId":"UP_PROJECT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#START_DATE_COL#}","width":"100","dataIndex":"START_DATE","titleAlign":"center","itemId":"START_DATE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#END_DATE_COL#}","width":"100","dataIndex":"END_DATE","titleAlign":"center","itemId":"END_DATE_COL"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"},{"configs":{"region":"south","pagingBar":"true","selType":"checkboxmodel","height":"250","itemId":"grid2","editable":"true"},"children":[{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"{#addBtn#}","itemId":"addBtn","disabled":"true","iconCls":"file_add_icon"},"events":{"click":"if(project_id===''||project_id==='-1'){\n  Wb.toast('请您选中一个项目！');\n  return false;\n}\n\nWb.addEdit(app.grid2,[{LEDGER_ID:ledger_id,PROJECT_ID:project_id}]);\n\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#delBtn#}","itemId":"delBtn","disabled":"true","iconCls":"minus_icon"},"events":{"click":"var rows11=app.grid2.getSelection();\nif(rows11.length>0){\nExt.Msg.confirm('提示','您确定要删除所选的数据吗？',function(a){\n  if(a=='yes'){\n  Wb.remove(app.grid2); //更多选项可使用Wb.add方法\n  app.saveBtn.fireEvent('click');\n  }\nelse{\nreturn false;\n}});\n}\n\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#saveBtn#}","hidden":"true","itemId":"saveBtn","iconCls":"save_icon"},"events":{"click":"if(!Wb.verifyGrid(app.grid1)){ \n  return flase;\n}\n\nWb.sync({\n  grid: app.grid2,\n  url: 'm?xwl=xc/gl/ledger/ld-pm-project/ld-pm-project-db/savePriDept',\n  message: '正在保存中...',\n  success: function(resp) {\n    Wb.syncCreate(app.grid2, Wb.decode(resp.responseText));\n    app.grid2.store.commitChanges();\n  }\n});"},"children":[],"expanded":false,"type":"button"}],"expanded":false,"type":"toolbar"},{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/gl/ledger/ld-pm-project/ld-pm-project-db/selectPriDept"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#rownum#}","width":"55","xtype":"rownumberer","align":"center","titleAlign":"center","itemId":"rownum"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"主键ID","hidden":"true","dataIndex":"PRJ_DEPT_ID","itemId":"PRJ_DEPT_ID"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"账簿ID","hidden":"true","dataIndex":"LEDGER_ID","titleAlign":"center","itemId":"LEDGER_ID"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"项目ID","hidden":"true","dataIndex":"PROJECT_ID","itemId":"PROJECT_ID"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"成本中心ID","hidden":"true","dataIndex":"DEPT_ID","itemId":"DEPT_ID"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#DEPT_NAME_COL#}","width":"300","dataIndex":"DEPT_NAME","titleAlign":"center","itemId":"DEPT_NAME"},"children":[{"configs":{"triggerCls":"x-form-search-trigger","normalName":"deptEditor","itemId":"editor"},"events":{"expand":"app.btnQuery.fireEvent('click') ;"},"children":[{"configs":{"tagConfigs":"minWidth:480","height":"350","forceFit":"true","normalName":"deptsPickGrid","itemId":"pickComp"},"events":{"itemclick":"var picker = this.ownerCmp;\npicker.setValue(record.data.DEPT_NAME);\nvar rows = app.grid2.getSelection()[0];\nrows.set('DEPT_ID',record.data.DEPT_ID);\npicker.collapse();"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/gl/ledger/ld-pm-project/ld-pm-project-db/selectDept"},"events":{"beforeload":"store.proxy.extraParams.LEDGER_ID = app.LEDGER_NAMES.getValue();\nstore.proxy.extraParams.textStr = app.txtDeptName.getValue();"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"90","labelAlign":"right","itemId":"txtDeptName"},"events":{"specialkey":"if(e.keyCode == 13){\n  app.btnQuery.fireEvent('click') ;\n}"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"btnQuery","iconCls":"seek_icon"},"events":{"click":"app.deptsPickGrid.getStore().load() ;\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"itemId":"btnCancel","iconCls":"cancel_icon"},"events":{"click":"// 当前选中行\nvar records = app.grid2.getSelection() ;\nvar r = records[0] ;\nr.set('DEPT_ID', '') ;\nr.set('DEPT_NAME', '') ;\napp.deptEditor.setValue() ;\n\n// 重置Grid数据\napp.txtDeptName.setValue() ;\napp.btnQuery.fireEvent('click') ;\napp.deptsPickGrid.hide() ;\n"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"部门ID","hidden":"true","dataIndex":"DPET_ID","titleAlign":"center","itemId":"DPET_ID"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"成本中心编码","width":"150","dataIndex":"DEPT_CODE","titleAlign":"center","itemId":"DEPT_CODE"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"成本中心名称","width":"250","dataIndex":"DEPT_NAME","titleAlign":"center","itemId":"DEPT_NAME"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":true,"type":"column"},{"configs":{"text":"用户ID","hidden":"true","dataIndex":"USER_ID","itemId":"USER_ID"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#Project Manager#}","width":"150","dataIndex":"EMP_NAME","titleAlign":"center","itemId":"EMP_NAME"},"children":[{"configs":{"triggerCls":"x-form-search-trigger","normalName":"userEditor","itemId":"editor","createInstance":"false"},"events":{"collapse":"app.saveBtn.fireEvent('click');\napp.querytext.setValue();\napp.queryBtn.fireEvent('click');"},"children":[{"configs":{"tagConfigs":"minWidth: 480\n","height":"350","barExportButtons":"false","barExportAllButtons":"false","barRefreshButton":"false","forceFit":"true","normalName":"usersPickGrid","itemId":"pickComp"},"events":{"itemclick":"var picker = this.ownerCmp;\npicker.setValue(record.data.EMP_NAME);\nvar rows = app.grid2.getSelection()[0];\nrows.set('USER_ID',record.data.USER_ID);\npicker.collapse();"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/gl/ledger/ld-pm-project/ld-pm-project-db/selectUser"},"events":{"beforeload":"store.proxy.extraParams.LEDGER_ID = app.LEDGER_NAMES.getValue();\nstore.proxy.extraParams.textStr = app.querytext.getValue();"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"itemId":"querytext"},"events":{"specialkey":"if(e.keyCode == 13){\n  app.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"queryBtn","iconCls":"seek_icon"},"events":{"click":"app.usersPickGrid.getStore().load() ;"},"children":[],"expanded":false,"type":"button"},{"configs":{"itemId":"cancelBtn","iconCls":"cancel_icon"},"events":{"click":"// 当前选中行\nvar records = app.grid2.getSelection() ;\nvar r = records[0] ;\nr.set('USER_ID', '') ;\nr.set('EMP_NAME', '') ;\napp.userEditor.setValue() ;\n\n// 重置Grid数据\napp.querytext.setValue() ;\napp.queryBtn.fireEvent('click') ;\napp.usersPickGrid.hide() ;\n"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","dataIndex":"USER_ID","itemId":"user_id"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"用户名称","width":"110","align":"left","dataIndex":"USER_NAME","titleAlign":"center","itemId":"user_name"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"员工编码","width":"110","align":"left","dataIndex":"EMP_CODE","titleAlign":"center","itemId":"emp_code"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"员工姓名","width":"110","align":"left","dataIndex":"EMP_NAME","titleAlign":"center","itemId":"emp_name"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":true,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}