{"inframe":false,"title":"","hidden":false,"roles":{"default":1},"children":[{"configs":{"title":"{#moduleTitle#}","loginRequired":"false","serverScript":"com.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xc/gl/global/account/hrcy/hrcy\");","itemId":"module"},"events":{"finalize":"var IS_PREPARED;\nvar uuId;\nvar rec;\nvar buttonChange;\nvar hrcy_count;"},"children":[{"configs":{"itemId":"tools"},"children":[{"configs":{"itemId":"buttonArray"},"children":[{"configs":{"text":"{#confirmBtn#}","itemId":"okButton","iconCls":"ok_icon"},"events":{"click":"var is_perpared_count = 0;\nif(app.ACC_HRCY_CODE.getValue() === ''){\n    Wb.toast('科目体系编码不能为空！请重新输入');\n    return;\n}\nif(!Wb.verify(app.hrcy_window))//验证数据是否合法\n\treturn;\nif(app.ACC_HRCY_NAME.getValue() === ''){\n    Wb.toast('科目体系名称不能为空！请重新输入');\n    return;\n}\nif(app.START_DATE.getValue() === null){\n    Wb.toast('开始日期不能为空！请重新输入');\n    return;\n}\nif(app.END_DATE.getValue() === null){\n    Wb.toast('结束日期不能为空！请重新输入');\n    return;\n}\nif(app.START_DATE.getValue() > app.END_DATE.getValue()){\n    Wb.toast('结束日期不能小于开始日期，请重新输入！');\n    return;\n}\nif(buttonChange === 'insertButton'){\n    saveInsert();\n}\nif(buttonChange === 'editButton'){\n    saveEdit();\n}\nif(buttonChange === 'copyButton'){\n\tsaveCopy();\n}\nfunction saveInsert(){\n    Wb.request({\n        url: 'm?xwl=xc/gl/global/account/hrcy/hrcyDB/hrcyInsert',\n        out : app.hrcy_window,\n        params : {\"ACC_HRCY_ID\":app.ACC_HRCY_ID.getValue()},\n        success: function(resp) {\n            Wb.toast('数据新增成功！');\n            app.hrcy_grid.store.load();\n            app.hrcy_window.hide();\n        }\n    });\n}\nfunction saveEdit(){\n    Wb.request({\n        url: 'm?xwl=xc/gl/global/account/hrcy/hrcyDB/hrcyEdit',\n        out : app.hrcy_window,\n        success: function(resp) {\n            Wb.toast('数据修改成功！');\n            app.hrcy_grid.store.load();\n            app.hrcy_window.hide();\n        }\n    });\n}\nfunction saveCopy(){\n\tWb.request({//复制\n\t\turl: 'm?xwl=xc/gl/global/account/hrcy/hrcyDB/hrcyInsert',\n        params : {\"ACC_HRCY_ID\":app.ACC_HRCY_ID.getValue()},\n        out : app.hrcy_window,\n        success: function(resp) {\n\t\t\tWb.request({\n                url : 'm?xwl=xc/gl/global/account/hrcy/hrcyDB/accountsSelect',\n                params: {ACC_HRCY_ID:rec[0].data.ACC_HRCY_ID},\n                success: function(resp){\n                    var temp = Ext.decode(resp.responseText);\n                    for(var i = 0;i < temp.total;i++){\n                        var accountsArray = {\n                          ACC_CODE : temp.rows[i].ACC_CODE,\n                          ACC_NAME :temp.rows[i].ACC_NAME,\n                          ACC_CATEGORY_CODE : temp.rows[i].ACC_CATEGORY_CODE,\n                          ACC_GROUP_ID : temp.rows[i].ACC_GROUP_ID,\n                          ACC_HRCY_ID : uuId,\n                          BALANCE_DIRECTION : temp.rows[i].BALANCE_DIRECTION,\n                          IS_BANK_ACC : temp.rows[i].IS_BANK_ACC,\n                          IS_CASH_ACC : temp.rows[i].IS_CASH_ACC,\n                          IS_CASH_ITEM : temp.rows[i].IS_CASH_ITEM,\n                          IS_LEAF : temp.rows[i].IS_LEAF,\n                          UP_ACC_CODE : temp.rows[i].UP_ACC_CODE,\n                          START_DATE : temp.rows[i].START_DATE,\n                          END_DATE : temp.rows[i].END_DATE,\n                          ACC_LEVEL : temp.rows[i].ACC_LEVEL,\n                          ASS_KEY : temp.rows[i].ASS_KEY\n                        };\n                        Wb.request({\n                          url : 'm?xwl=xc/gl/global/account/hrcy/hrcyDB/accountsCopy',\n                          params : accountsArray\n                        });\n                    }\n                    app.hrcy_grid.store.load();//加载数据\n                    app.hrcy_window.hide();\n                    Wb.toast('数据复制成功！');\n\t\t\t\t}\n           });\n\t\t}\n\t});\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#cancelBtn#}","itemId":"cancelButton","iconCls":"cancel_icon"},"events":{"click":"app.hrcy_window.hide();"},"children":[],"expanded":true,"type":"button"}],"expanded":true,"type":"array"},{"configs":{"height":"220","width":"650","closeAction":"hide","buttons":"app.buttonArray","buttonAlign":"center","itemId":"hrcy_window","modal":"true"},"children":[{"configs":{"tagConfigs":"baseCls:'my-panel-no-border'","layout":"column","margin":"10 0 0 0","itemId":"row1","border":"false"},"children":[{"configs":{"labelWidth":"80","hidden":"true","labelAlign":"right","itemId":"ACC_HRCY_ID","fieldLabel":"科目体系ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"80","hidden":"true","labelAlign":"right","itemId":"ORDERBY","fieldLabel":"序号"},"children":[],"expanded":false,"type":"text"},{"configs":{"tagConfigs":"columnWidth : 0.48","labelWidth":"90","allowBlank":"false","vtype":"alphanum","labelAlign":"right","itemId":"ACC_HRCY_CODE","fieldLabel":"{#necessaryCode#}"},"children":[],"expanded":false,"type":"text"},{"configs":{"tagConfigs":"columnWidth : 0.48","labelWidth":"90","readOnly":"true","pickList":"[['Y','是'],['N','否']]","labelAlign":"right","itemId":"IS_PREPARED","fieldLabel":"{#necessaryPredict#}"},"children":[],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls:'my-panel-no-border'","layout":"column","margin":"10 0 0 0","itemId":"row2","border":"false"},"children":[{"configs":{"tagConfigs":"columnWidth : 0.48","labelWidth":"90","allowBlank":"false","labelAlign":"right","itemId":"ACC_HRCY_NAME","fieldLabel":"{#necessaryName#}"},"children":[],"expanded":false,"type":"textarea"},{"configs":{"tagConfigs":"columnWidth : 0.48","labelWidth":"90","labelAlign":"right","itemId":"ACC_HRCY_DESC","fieldLabel":"{#accHrcyDesc#}"},"children":[],"expanded":false,"type":"textarea"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls:'my-panel-no-border'","layout":"column","margin":"10 0 10 0","itemId":"row3","border":"false"},"children":[{"configs":{"tagConfigs":"columnWidth : 0.48","labelWidth":"90","allowBlank":"false","labelAlign":"right","itemId":"START_DATE","fieldLabel":"{#necessaryStartDate#}"},"children":[],"expanded":false,"type":"date"},{"configs":{"tagConfigs":"columnWidth : 0.48","labelWidth":"90","allowBlank":"false","labelAlign":"right","itemId":"END_DATE","fieldLabel":"{#necessaryEndDate#}"},"children":[],"expanded":false,"type":"date"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"window"}],"expanded":true,"type":"folder"},{"configs":{"autoScroll":"true","border":"false","itemId":"viewport"},"children":[{"configs":{"pagingBar":"false","rowNumber":"false","border":"false","itemId":"hrcy_grid"},"events":{"itemclick":"app.textarea.setFieldLabel('正在使用【'+record.data.ACC_HRCY_NAME+'】科目体系的账簿');\nvar ledger_array = [];\nWb.request({\n\turl : 'm?xwl=xc/gl/global/account/hrcy/hrcyDB/ledgersSelect',\n\tparams : {ACC_HRCY_ID:record.data.ACC_HRCY_ID},\n\tsuccess : function(resp){\n\t\tvar temp = Ext.JSON.decode(resp.responseText);//从后台获取数据\n        var total = temp.total;\n        //alert(temp.metaData.fields[0].name);\n        for(var i=0;i < total;i++){\n            ledger_array.push('\\n'+'账簿' + (i+1) + '：' + temp.rows[i].LEDGER_NAME);\n\t\t\tapp.textarea.setValue(ledger_array);\n        }\n        if(total === 0){\n            app.textarea.setValue('\\n'+'没有账簿使用！');\n        }\n    }  \n});","itemdblclick":"app.editButton.fireEvent('click');","tagEvents":"/*{\n    itemmouseenter:function(view,record,item,index,e,options){\n        app.hrcy_grid.getSelectionModel().select(index);\n    }\n}*/"},"children":[{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"{#addBtn#}","itemId":"addButton","iconCls":"file_add_icon"},"events":{"click":"var orderby = app.hrcy_grid.store.getCount();//获得store中的个数\nWb.request({//得到UUID\n    url : 'm?xwl=xc/gl/global/account/hrcy/hrcyDB/getUUID',\n    success : function(res){\n        var temp = Ext.decode(res.responseText);\n        var win = new Ext.window.Window(app._hrcy_window); //app._strategy_window指向配置对象而非实例\n        win.show();//显示窗口\n        win.setIconCls('file_add_icon');//图标\n        Wb.setTitle(win,'{#la_newWinTitle#}');//标题\n        app.START_DATE.setValue(Ext.Date.parse(Ext.util.Format.date(new Date(),'Y-m-d'),'Y-m-d'));\n        app.END_DATE.setValue(Ext.Date.parse('9999-12-31','Y-m-d'));\n        app.ACC_HRCY_ID.setValue(temp.uuid);\n        app.IS_PREPARED.setValue('N');\n        app.ORDERBY.setValue(orderby+1);\n        buttonChange = 'insertButton';\n\t}\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#editBtn#}","itemId":"editButton","iconCls":"file_edit_icon"},"events":{"click":"var rec = app.hrcy_grid.getSelection();\nif (rec.length > 1 || rec.length === 0) {//大于一条或没选择会警告\n    Wb.toast('请选择一条需要修改的记录。');\n    return;\n}\nvar win = new Ext.window.Window(app._hrcy_window); //app._strategy_window指向配置对象而非实例\nwin.show();//显示窗口\nwin.setIconCls('file_edit_icon');//图标\nWb.setTitle(win,'{#la_editWinTitle#}-\"'+rec[0].data.ACC_HRCY_NAME+'\"');//标题\nWb.setValue(win,rec[0].data);//把记录数据应用到窗口\nif(rec[0].data.IS_PREPARED == 'Y'){\n\tapp.ACC_HRCY_CODE.setReadOnly(true);\n\tapp.ACC_HRCY_NAME.setReadOnly(true);\n\tapp.ACC_HRCY_DESC.setReadOnly(true);\n\tapp.IS_PREPARED.setReadOnly(true);\n\tapp.START_DATE.setReadOnly(true);\n\tapp.END_DATE.setReadOnly(true);\n}\nbuttonChange = 'editButton';\napp.ACC_HRCY_CODE.setReadOnly(true);"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#copyBtn#}","itemId":"copyButton","iconCls":"copy_icon"},"events":{"click":"Wb.request({//得到UUID\n    url : 'm?xwl=xc/gl/global/account/hrcy/hrcyDB/getUUID',\n    success : function(res){\n        var temp = Ext.decode(res.responseText);\n        uuId = temp.uuid;\n        rec = app.hrcy_grid.getSelection();//选择记录\n        if (rec.length > 1 || rec.length === 0) {//大于一条或没选择会警告\n            Wb.toast('请选择一条需要复制的记录。');\n            return;\n        }\n        var params = {\n            ACC_HRCY_ID : uuId,\n            ACC_HRCY_CODE : rec[0].data.ACC_HRCY_CODE,//选中数据的编码\n            ACC_HRCY_NAME : rec[0].data.ACC_HRCY_NAME,//选中数据的名称\n            ACC_HRCY_DESC : rec[0].data.ACC_HRCY_DESC,//选中数据的描述\n            START_DATE : rec[0].data.START_DATE,//选中数据的描述\n            END_DATE : rec[0].data.END_DATE,//选中数据的描述\n            IS_PREPARED : 'N',//是否预制\n            ORDERBY : app.hrcy_grid.store.getCount()+1//序号\n        };\n        var win = new Ext.window.Window(app._hrcy_window); //app._strategy_window指向配置对象而非实例\n        win.show();//显示窗口\n        win.setIconCls('copy_icon');//图标\n        Wb.setTitle(win,'复制科目体系\"'+rec[0].data.ACC_HRCY_NAME+'\"');//标题\n        Wb.setValue(win,params);//把记录数据应用到窗口\n        buttonChange = 'copyButton';\n    }\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#delBtn#}","itemId":"deleteButton","iconCls":"file_delete_icon"},"events":{"click":"var recs = app.hrcy_grid.getSelection();//获得选中数据\nif (!recs.length) {//选中的数据条数\n\tWb.toast('请选择需要删除的记录。');\n\treturn;\n}\nWb.confirm('确定要删除选择的\u201c' + recs[0].data.ACC_HRCY_NAME + '\u201d记录吗？',function() {\n    Wb.request({//级联删除会计科目表中的数据\n        url : 'm?xwl=xc/gl/global/account/hrcy/hrcyDB/hrcyDelete',\n        params : {'infoArray' : Wb.encode(Wb.getData(recs)),ACC_HRCY_ID:recs[0].data.ACC_HRCY_ID},//传参\n        success : function(){\n            Wb.toast('科目体系\u201c'+recs[0].data.ACC_HRCY_NAME+'\u201d删除成功');\n            Wb.remove(app.hrcy_grid);//直接从表格中删除\n            app.hrcy_grid.store.load();\n        }\n    });\n});"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/gl/global/account/hrcy/hrcyDB/hrcySelect"},"children":[],"expanded":true,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#rowNum#}","hidden":"true","width":"40","dataIndex":"ORDERBY","titleAlign":"center","itemId":"ORDERBY_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"ACC_HRCY_ID","hidden":"true","dataIndex":"ACC_HRCY_ID","titleAlign":"center","itemId":"ACC_HRCY_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#accHrcyCode#}","width":"150","dataIndex":"ACC_HRCY_CODE","titleAlign":"center","itemId":"ACC_HRCY_CODE_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#accHrcyName#}","width":"200","dataIndex":"ACC_HRCY_NAME","titleAlign":"center","itemId":"ACC_HRCY_NAME_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#accHrcyDesc#}","width":"200","dataIndex":"ACC_HRCY_DESC","titleAlign":"center","itemId":"ACC_HRCY_DESC_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#startDate#}","width":"100","dataIndex":"START_DATE","titleAlign":"center","itemId":"START_DATE_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#endDate#}","width":"100","dataIndex":"END_DATE","titleAlign":"center","itemId":"END_DATE_COL","renderer":"if(Ext.util.Format.date(value, 'Y-m-d') == '9999-12-31'){\n  return null;\n}else{\n  return Ext.util.Format.date(value, 'Y-m-d');\n}"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#prediction#}","width":"120","dataIndex":"IS_PREPARED","titleAlign":"center","itemId":"IS_PREPARED_COL","renderer":"if(value=='Y'){\n  return '是';\n}\nelse if(value=='N'){\n  return '否';\n}"},"children":[],"expanded":true,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"},{"configs":{"tagConfigs":"readOnly : true","labelWidth":"60","grow":"true","width":"914","labelAlign":"top","itemId":"textarea","fieldLabel":"{#useTip#}"},"children":[],"expanded":true,"type":"textarea"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}