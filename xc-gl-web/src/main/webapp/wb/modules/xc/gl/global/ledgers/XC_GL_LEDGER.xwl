{"inframe":false,"title":"账薄管理","hidden":false,"roles":{"default":1},"children":[{"configs":{"title":"{#moduleTitle#}","loginRequired":"false","serverScript":"com.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xc/gl/global/ledgers/XC_GL_LEDGER\");","itemId":"module"},"events":{"initialize":"var acc_hrcyArray = [];//存储所有科目体系\nvar currencyArray = [];//存储所有币种\nvar orgArray = [];//存储所有组织信息\nvar accountsArray = [];//存储所有的会计科目\nvar currencyCode;//存放人民币的编码\n\nvar ledger_id ;//存放删除校验时需要传递的账薄ID\n\nvar edit_ledger_code;//存放在修改状态下的编码初始值\nvar edit_org;//存放在修改状态下的组织初始值\nvar edit_currency_code;//存放在修改状态下的本位币初始值\n\nvar delete_flag = false;//区分保存是在删除状态下还是非删除状态，默认为非删除状态\nvar delete_ledger_id;//删除需要保存时，被删除的账薄编码\nvar delete_ledger_name ;//删除需要保存时，被删除的账薄名称\n\n\nvar ledger_flag = false;//区分是修改状态还是新增状态。false默认为修改状态\n\n\n\n\n"},"children":[{"configs":{"itemId":"storeFolder"},"children":[{"configs":{"pageSize":"-1","autoLoad":"false","itemId":"acc_hrcy_store","url":"m?xwl=xc/gl/global/ledgers/ledgers_db/select_acc_hrcy"},"children":[],"expanded":false,"type":"store"},{"configs":{"pageSize":"-1","autoLoad":"false","itemId":"currency_store","url":"m?xwl=xc/gl/global/ledgers/ledgers_db/select_currencies"},"events":{"success":"/*\ncurrencyArray = [];\nvar count=store.getCount();\nfor(var i=0;i<count;i++){\n\tcurrencyArray.push(store.getAt(i).data);\n}\n\n*/"},"children":[],"expanded":false,"type":"store"},{"configs":{"pageSize":"-1","autoLoad":"false","itemId":"accounts_store","url":"m?xwl=xc/gl/global/ledgers/ledgers_db/select_accounts"},"events":{"success":"accountsArray = [];\nvar count=store.getCount();\nfor(var i=0;i<count;i++){\n\taccountsArray.push(store.getAt(i).data);\n}\n\n"},"children":[],"expanded":false,"type":"store"}],"expanded":false,"type":"folder"},{"configs":{"layout":"fit","itemId":"viewport1"},"children":[{"configs":{"itemId":"ledger_grid"},"events":{"itemdblclick":"app.updateBtn.fireEvent('click');"},"children":[{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"{#addBtn#}","itemId":"insertBtn","iconCls":"file_add_icon"},"events":{"click":"ledger_flag = true;\napp.add_update_ledger_win.setTitle('{#la_addLedger#}');\n\napp.add_update_ledger_win.show();\napp.LEDGER_CODE.setReadOnly(false);\napp.ORG_NAME.setReadOnly(false);"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#editBtn#}","itemId":"updateBtn","iconCls":"file_edit_icon"},"events":{"click":"var rec = app.ledger_grid.getSelection();\n\nif(rec.length===0) {\n    Wb.toast('请先选择一条需要修改的数据');\n    return;\n}\n\n//先判断体系是否可以修改\nvar temp_hrcy;\n\nExt.Ajax.request({\n  async:false,\n  url:'m?xwl=xc/gl/global/ledgers/ledgers_db/select_acc_hrcy',\n  params:{\n     ledger_id:rec[0].data.LEDGER_ID\n  },\n  success:function(response) {\n     var temp = Wb.decode(response.responseText);\n     temp_hrcy = temp.rows[0].cu;\n     //判断此账薄的科目体系是否已经被引用，能否被修改\n     if(temp_hrcy!==0&&temp_hrcy!=='0') \n        app.ACC_HRCY_NAME.setReadOnly(true);\n    \n    \n    //直接将值带过去，并没有重新查询数据库\n    app.add_update_ledger_win.setTitle('{#la_editLedger#}');\n    app.add_update_ledger_win.show(); \n\n    Wb.setValue(app.add_update_ledger_win, rec[0].data); //把记录数据应用到窗口\n    //判断此账薄是否已经被引用，能否被修改\n    if(temp_hrcy!==0&&temp_hrcy!=='0') \n      app.ACC_HRCY_NAME.setReadOnly(true);\n  }\n});\n\n\n\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#delBtn#}","itemId":"deleteBtn","iconCls":"file_delete_icon"},"events":{"click":"var temp = app.ledger_grid.getSelection();\nif(temp.length===0) {\n    Wb.toast('请先选择一条需要删除的数据!');\n    //Ext.MessageBox.alert('提示','请先选择一条需要删除的数据');\n    return;\n}\n\n//删除时校验并执行删除\ndelete_ledger_id = temp[0].data.LEDGER_ID;\ndelete_ledger_name = temp[0].data.LEDGER_NAME;\n\n\nExt.MessageBox.confirm('提示', '是否确定删除账薄:'+delete_ledger_name+'?', function(btn){ \n    if (btn == 'yes'){\n       Wb.request({\n         url:'m?xwl=xc/gl/global/ledgers/ledgers_db/delete_ledgers',\n         params:{ledger_id:delete_ledger_id},\n         success:function(){\n           Wb.toast('账薄'+delete_ledger_name+'删除成功');\n           //Ext.MessageBox.alert('提示','账薄'+delete_ledger_name+'删除成功');\n           app.ledger_grid.store.load();\n         }\n       });\n    }\n});\n\n\n/*\n//获取修改的行记录,为了在删除时进行提醒\nvar rows = app.ledger_grid.store.getModifiedRecords();\nvar temp_length = rows.length;//判断新增与修改是否同时操作\n\nvar temp_mes_length = 0;//提示删除时需要保存的修改记录数量\nvar temp_same = 0;//选择删除的是修改的那一条数据，为了区分提示的数量\n\nfor(var i=0;i<rows.length;i++){\n  //此情况是为了避免新增一行并且删除旧记录\n  if((rows[i].data.LEDGER_ID===''||rows[i].data.LEDGER_ID===null)&&(delete_ledger_id===''||delete_ledger_id===null)) {\n    temp_length = temp_length-1;\n    temp_mes_length = 1;\n  }\n  \n  //修改的唯一一条数据是选择删除的那一条数据\n  if(rows[i].data.LEDGER_ID===delete_ledger_id) {\n    temp_same = 1;\n  }\n  \n}\ntemp_mes_length = rows.length-temp_mes_length-temp_same;//这里是为了得到正确的需要提醒保存的数量\n\n\n//删除的是新增并未保存的记录,并且没有修改已经存在的旧数据\nif((delete_ledger_id===''||delete_ledger_id===null)&&(temp_length===0)) {\n  app.ledger_grid.store.remove(temp[0]);\n  return;\n}\n\nExt.MessageBox.confirm('提示', '是否确定删除账薄:'+delete_ledger_name+'?', function(btn){ \n    if (btn == 'yes'){\n      //删除数据，并且存在其他修改后未保存的数据\n      if((temp_length>0)&&(temp_mes_length>0)) {\n         Ext.MessageBox.confirm('提示', '有'+temp_mes_length+'条账薄信息未保存，是否先保存修改数据避免丢失，再继续执行删除操作', function(btn){\n           //删除并且保存  \n           if(btn=='yes') {\n               //删除的是新增记录，保存修改过的旧数据\n               if((delete_ledger_id===''||delete_ledger_id===null)) {\n                  app.ledger_grid.store.remove(temp[0]);\n                  app.saveBtn.fireEvent('click');//调用保存按钮\n                }\n                //删除已经存在的数据,并保存其他修改的数据\n                else{\n                   delete_flag = true;//删除状态下的保存操作,剩余操作在保存点击事件中执行\n                   app.saveBtn.fireEvent('click');//调用保存按钮\n                }\n           }\n           \n           //直接删除记录并且不保存已经修改的数据\n           else {\n               //删除新增记录\n               if((delete_ledger_id===''||delete_ledger_id===null)) {\n                  app.ledger_grid.store.remove(temp[0]);\n                  app.ledger_grid.store.load();\n                  return;\n                }\n               //删除已经存在的数据\n               else {\n                 Wb.request({\n                   url:'m?xwl=xc/gl/global/ledgers/ledgers_db/delete_ledgers',\n                   params:{ledger_id:delete_ledger_id},\n                   success:function(){\n                     Ext.MessageBox.alert('提示','账薄'+delete_ledger_name+'删除成功');\n                     app.ledger_grid.store.load();\n                   },\n                   failure:function(){\n                     app.ledger_grid.store.load();\n                   }\n                 });\n               }\n           }\n         });\n      }\n      \n   //删除已经存在的数据，并且未修改和新增其他数据  或者是删除的是当前修改的唯一一条数据\n   else{\n     Wb.request({\n       url:'m?xwl=xc/gl/global/ledgers/ledgers_db/delete_ledgers',\n       params:{ledger_id:delete_ledger_id},\n       success:function(){\n         Ext.MessageBox.alert('提示','账薄'+delete_ledger_name+'删除成功');\n         app.ledger_grid.store.load();\n       }\n     });\n   }\n  }\n});\ndelete_flag = false;\n*/"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#saveBtn#}","hidden":"true","itemId":"saveBtn","iconCls":"save_icon"},"events":{"click":"/*\n//获取面板中的所有数据\nvar grid_data = app.ledger_grid.getStore();\nvar count = grid_data.data.length;\n\nvar temp = [];//存储面板中的所有数据\n\n\nfor(var i=0;i<count;i++) {\n    var row = grid_data.getAt(i);  \n  \n    var code  = row.data.LEDGER_CODE;\n    //核查编码是否为空\n    if(code===''||code===null) {\n      Ext.MessageBox.alert('提示','账薄编码不能为空，保存失败！');\n      return;\n    }\n    else\n      temp.push(code);\n  \n    //检查名称是否为空\n    if(row.data.LEDGER_NAME===''||row.data.LEDGER_NAME===null) {\n      Ext.MessageBox.alert('提示','账薄名称不能为空，保存失败！');\n      return;\n    }\n  \n    //检查科目体系\n    if((row.data.ACC_HRCY_NAME===''||row.data.ACC_HRCY_NAME===null)&&(row.data.ACC_HRCY_ID===''||row.data.ACC_HRCY_ID===null)) {\n      Ext.MessageBox.alert('提示','科目体系不能为空，保存失败！');\n      return;\n    }\n  \n    //检查科目体系\n    if((row.data.ACC_HRCY_NAME!==''||row.data.ACC_HRCY_NAME!==null)&&(row.data.ACC_HRCY_ID===''||row.data.ACC_HRCY_ID===null)){\n      Ext.MessageBox.alert('提示','科目体系只能为下拉选项，保存失败！');\n      return;\n    }\n  \n  \n    //检查组织是否为空\n    if((row.data.ORG_NAME===''||row.data.ORG_NAME===null)&&(row.data.ORG_ID===''||row.data.ORG_ID===null)) {\n      Ext.MessageBox.alert('提示','账薄所属组织不能为空，保存失败！');\n      return;\n    }\n  \n    //检验组织\n    if((row.data.ORG_NAME!==''||row.data.ORG_NAME!==null)&&(row.data.ORG_ID===''||row.data.ORG_ID===null)){\n      Ext.MessageBox.alert('提示','账薄所属组织只能为下拉选项，保存失败！');\n      return;\n    }\n}\n\n//核对编码是否重复\nfor(var i=0;i<temp.length;i++) {\n  for(var j=i+1;j<temp.length;j++){\n    if(temp[i]===temp[j]) {\n      Ext.MessageBox.alert('提示','账薄编码不能重复，保存失败！');\n      return;\n    }\n  }\n}\n \n//利用SQL语句\n//获取所有修改记录，将加以区分新增与修改\nvar rows = app.ledger_grid.store.getModifiedRecords();//获取所有修改的行记录\n\nvar insertArray = [];\nvar updateArray = [];\n\n//存在被修改的数据\nfor(var i=0;i<rows.length;i++) {\n    var temp_id = rows[i].data.LEDGER_ID;//账薄id\n    var temp_code = rows[i].data.LEDGER_CODE;//账薄编码\n    var temp_name = rows[i].data.LEDGER_NAME;//账薄名称\n    var temp_acc = rows[i].data.ACC_HRCY_ID;//会计科目体系\n    var temp_org = rows[i].data.ORG_ID;//账薄所属组织\n\n    var mesg = \"{'LEDGER_ID':'\"+temp_id+\"','LEDGER_CODE':'\"+temp_code+\"','LEDGER_NAME':'\"+temp_name+\"','ACC_HRCY_ID':'\"+temp_acc+\"','ORG_ID':'\"+temp_org+\"'}\";\n  \n    //账薄ID为空是新增操作\n    if(temp_id===''||temp_id===null) \n      insertArray.push(Wb.decode(mesg));\n    \n    //否则是修改操作\n    else\n      updateArray.push(Wb.decode(mesg));\n}\n\nif(insertArray.length>0||updateArray.length>0){\n  Wb.request({\n      url:'m?xwl=xc/gl/global/ledgers/ledgers_db/insert_update_ledgers',\n      params:{insertArray:insertArray,updateArray:updateArray},\n      success:function(){\n        //新增与修改状态下的保存操作\n        if(!delete_flag){\n         Ext.MessageBox.alert('提示','数据保存成功');\n         app.ledger_grid.store.load();\n        }\n        //删除状态下的保存操作\n        else {\n          Wb.request({\n            url:'m?xwl=xc/gl/global/ledgers/ledgers_db/delete_ledgers',\n            params:{ledger_id:delete_ledger_id},\n            success:function(){\n              Ext.MessageBox.alert('提示','账薄'+delete_ledger_name+'删除成功');\n              app.ledger_grid.store.load();\n            },\n            failure:function() {\n              app.ledger_grid.store.load();\n            }\n          });\n        }\n        delete_flag = false;//还原为默认的非删除状态  \n      },\n      failure:function(){\n         Ext.MessageBox.alert('提示','数据保存失败');\n      }\n  });\n}\n*/"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#authorizeBtn#}","itemId":"grantBtn","iconCls":"user_group_icon"},"events":{"click":"//链接到授权窗口\nWb.run({\n     url:'m?xwl=xc/gl/global/ld-sec/XC_GL_LD_SEC',\n     success: function(obj) {\n        var win = new Ext.window.Window({\n          layout:'fit',\n          autoScroll:true,\n          maximized:true,//最大化窗口\n          resizable : false,//设置窗口大小不能被更改\n          modal : true,\n          frame : true,\n          border : false,\n          title:'账簿授权管理'\n        });\n        win.add(obj.viewport1);\n        win.show();\n   }\n });"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#rownum#}","align":"center","width":"50","xtype":"rownumberer","itemId":"row_num_col"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"账薄ID","hidden":"true","dataIndex":"LEDGER_ID","titleAlign":"center","itemId":"ledger_id_col"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#la_ledgerCode#}","width":"80","dataIndex":"LEDGER_CODE","titleAlign":"center","itemId":"ledger_code_col"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#la_ledgerName#}","width":"150","dataIndex":"LEDGER_NAME","titleAlign":"center","itemId":"ledger_name_col","renderer":"metaData.style = 'overflow:auto;padding: 3px 6px;text-overflow: ellipsis;white-space: nowrap;white-space:normal;line-height:18px;';   \nreturn value;"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"科目体系ID","hidden":"true","dataIndex":"ACC_HRCY_ID","itemId":"acc_hrcy_id_col"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#la_accountHrcy#}","width":"200","dataIndex":"ACC_HRCY_NAME","titleAlign":"center","itemId":"acc_hrcy_name_col","renderer":"metaData.style = 'overflow:auto;padding: 3px 6px;text-overflow: ellipsis;white-space: nowrap;white-space:normal;line-height:18px;';   \nreturn value;"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"组织ID","hidden":"true","dataIndex":"ORG_ID","titleAlign":"center","itemId":"org_id_col"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#la_orgName#}","width":"260","dataIndex":"ORG_NAME","titleAlign":"center","itemId":"org_name_col","renderer":"metaData.style = 'overflow:auto;padding: 3px 6px;text-overflow: ellipsis;white-space: nowrap;white-space:normal;line-height:18px;';   \nreturn value;"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#la_currency#}","hidden":"true","width":"60","dataIndex":"CURRENCY_NAME","titleAlign":"center","itemId":"currency_code_col"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#la_startPeriod#}","hidden":"true","width":"80","dataIndex":"START_PERIOD_CODE","titleAlign":"center","itemId":"start_period_code_col"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"留存收益科目","hidden":"true","width":"160","dataIndex":"RETAINED_ACC_ID","titleAlign":"center","itemId":"acc_name_col1","renderer":"metaData.style = 'overflow:auto;padding: 3px 6px;text-overflow: ellipsis;white-space: nowrap;white-space:normal;line-height:18px;';   \nreturn value;"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"汇兑损益科目","hidden":"true","width":"160","dataIndex":"EXCHANGE_ACC_ID","titleAlign":"center","itemId":"acc_name_col2","renderer":"metaData.style = 'overflow:auto;padding: 3px 6px;text-overflow: ellipsis;white-space: nowrap;white-space:normal;line-height:18px;';   \nreturn value;"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#la_description#}","width":"240","dataIndex":"LEDGER_ACC_DESC","titleAlign":"center","itemId":"ledger_acc_desc_col","renderer":"metaData.style = 'overflow:auto;padding: 3px 6px;text-overflow: ellipsis;white-space: nowrap;white-space:normal;line-height:18px;';   \nreturn value;"},"children":[],"expanded":true,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"pageSize":"-1","autoLoad":"true","itemId":"store","url":"m?xwl=xc/gl/global/ledgers/ledgers_db/select_ledgers"},"children":[],"expanded":false,"type":"store"}],"expanded":false,"type":"grid"}],"expanded":true,"type":"viewport"},{"configs":{"autoShow":"false","height":"300","layout":"fit","width":"450","closeAction":"hide","buttonAlign":"center","dialog":"true","itemId":"add_update_ledger_win","modal":"true","draggable":"false"},"events":{"close":"//清除信息\napp.LEDGER_ID.reset();\napp.LEDGER_NAME.reset();\napp.LEDGER_CODE.reset();\napp.ORG_NAME.reset();\napp.ORG_ID.reset();\napp.ACC_HRCY_ID.reset();\napp.ACC_HRCY_NAME.reset();\napp.LEDGER_ACC_DESC.reset();\n\n//设置编码和组织为不可修改状态\napp.LEDGER_CODE.setReadOnly(true);\napp.ORG_NAME.setReadOnly(true);\napp.ACC_HRCY_NAME.setReadOnly(false);\n\n//还原修改状态下的设置\nledger_flag = false;\n\n//刷新纪录\n// app.ledger_grid.store.load();"},"children":[{"configs":{"layout":"form","itemId":"edit_panel"},"children":[{"configs":{"tagConfigs":"baseCls:'my-panel-no-border'","frame":"true","layout":"column","border":"false","itemId":"td1"},"children":[{"configs":{"tagConfigs":"columnWidth:0.88","readOnly":"true","hidden":"true","itemId":"LEDGER_ID","fieldLabel":"账薄ID"},"children":[],"expanded":false,"type":"text"}],"expanded":false,"type":"panel"},{"configs":{"tagConfigs":"baseCls:'my-panel-no-border'","frame":"true","layout":"column","border":"false","itemId":"td2"},"children":[{"configs":{"tagConfigs":"columnWidth:0.88","labelWidth":"{#la_labelWidth#}","readOnly":"true","maxLength":"4","labelAlign":"right","maxLengthText":"{#la_ledgerTips#}","padding":"2 0 0 2","itemId":"LEDGER_CODE","fieldLabel":"{#la_necessaryCode#}"},"events":{"blur":"// if(text.getValue().length!==2){\n//     app.LEDGER_CODE.setValue();\n// }"},"children":[],"expanded":false,"type":"text"}],"expanded":false,"type":"panel"},{"configs":{"tagConfigs":"baseCls:'my-panel-no-border'","frame":"true","layout":"column","border":"false","itemId":"td3"},"children":[{"configs":{"tagConfigs":"columnWidth:0.88","labelWidth":"{#la_labelWidth#}","minLength":"1","labelAlign":"right","padding":"2 0 0 2","itemId":"LEDGER_NAME","fieldLabel":"{#la_necessaryName#}"},"children":[],"expanded":false,"type":"text"}],"expanded":false,"type":"panel"},{"configs":{"tagConfigs":"baseCls:'my-panel-no-border'","frame":"true","layout":"column","border":"false","itemId":"td4"},"children":[{"configs":{"tagConfigs":"columnWidth:0.88","labelWidth":"80","readOnly":"true","hidden":"true","labelAlign":"right","padding":"2 0 0 2","itemId":"ACC_HRCY_ID","fieldLabel":"科目体系ID"},"children":[],"expanded":false,"type":"text"}],"expanded":false,"type":"panel"},{"configs":{"tagConfigs":"baseCls:'my-panel-no-border'","frame":"true","layout":"column","border":"false","itemId":"td5"},"children":[{"configs":{"labelWidth":"{#la_labelWidth#}","itemId":"ACC_HRCY_NAME","padding":"2 0 0 2","fieldLabel":"{#la_necessaryHrcy#}","editable":"true","tagConfigs":"columnWidth:0.88","readOnly":"false","displayField":"EDIT_ACC_HRCY_NAME","hidden":"false","valueField":"EDIT_ACC_HRCY_ID","typeAhead":"true","labelAlign":"right","selectOnFocus":"true"},"events":{"change":"if(newValue==='' || newValue===null) {\n  app.ACC_HRCY_ID.setValue();\n}","select":"//为体系ID赋值\nvar temp_acc_name = combo.getRawValue();//获得选中的ACC_HRCY_NAME\n\napp.ACC_HRCY_ID.setValue(combo.getValue());\ncombo.setValue(temp_acc_name);//这里只是起到一个显示名称的作用","beforequery":"var combo = plan.combo ;\nif(!plan.forceAll){\n  var flag = false;\n  var value = plan.query;\n  combo.store.filterBy(function(record,id){\n    var text = record.get(combo.displayField);\n    return (text.indexOf(value)!=-1);\n  });\n  combo.expand();\n  return false;\n}","blur":"if(combo.getValue()===null || combo.getValue()===null) {\n  app.ACC_HRCY_ID.setValue();\n}"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/gl/global/ledgers/ledgers_db/update_check_acc_hrcy"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"}],"expanded":false,"type":"panel"},{"configs":{"tagConfigs":"baseCls:'my-panel-no-border'","frame":"true","layout":"column","border":"false","itemId":"td6"},"children":[{"configs":{"tagConfigs":"columnWidth:0.88","labelWidth":"80","readOnly":"true","hidden":"true","labelAlign":"right","padding":"2 0 0 2","itemId":"ORG_ID","fieldLabel":"组织ID"},"children":[],"expanded":false,"type":"text"}],"expanded":false,"type":"panel"},{"configs":{"tagConfigs":"baseCls:'my-panel-no-border'","frame":"true","layout":"column","border":"false","itemId":"td7"},"children":[{"configs":{"tagConfigs":"columnWidth:0.88","labelWidth":"{#la_labelWidth#}","readOnly":"true","displayField":"EDIT_ORG_NAME","valueField":"EDIT_ORG_ID","labelAlign":"right","padding":"2 0 0 2","itemId":"ORG_NAME","fieldLabel":"{#la_necessaryOrg#}","editable":"true"},"events":{"change":"if(newValue==='' || newValue===null) {\n  app.ORG_ID.setValue();\n}","select":"//为组织ID赋值\nvar temp_org_name = combo.getRawValue();//获得选中的ORG_NAME\n\napp.ORG_ID.setValue(combo.getValue());\ncombo.setValue(temp_org_name);//这里只是起到一个显示名称的作用\n\n\n\n","beforequery":"var combo = plan.combo ;\nif(!plan.forceAll){\n  var flag = false;\n  var value = plan.query;\n  combo.store.filterBy(function(record,id){\n    var text = record.get(combo.displayField);\n    return (text.indexOf(value)!=-1);\n  });\n  combo.expand();\n  return false;\n}","blur":"if(combo.getValue()==='' || combo.getValue()===null){\n  app.ORG_ID.setValue();\n}"},"children":[{"configs":{"pageSize":"-1","autoLoad":"true","itemId":"store","url":"m?xwl=xc/gl/global/ledgers/ledgers_db/select_orgs"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"}],"expanded":false,"type":"panel"},{"configs":{"tagConfigs":"baseCls:'my-panel-no-border'","frame":"true","layout":"column","border":"false","itemId":"td8"},"children":[{"configs":{"tagConfigs":"columnWidth:0.88","labelWidth":"{#la_labelWidth#}","height":"60","labelAlign":"right","padding":"2 0 2 2","itemId":"LEDGER_ACC_DESC","fieldLabel":"{#la_ledgerDesc#}"},"children":[],"expanded":false,"type":"textarea"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"itemId":" buttons"},"children":[{"configs":{"text":"{#saveBtn#}","itemId":"saveBtn","iconCls":"save_icon"},"events":{"click":"var temp_code = app.LEDGER_CODE.getValue();\nvar temp_name = app.LEDGER_NAME.getValue();\nvar temp_org = app.ORG_ID.getValue();\nvar temp_hrcy = app.ACC_HRCY_ID.getValue();\nvar temp_id = app.LEDGER_ID.getValue();\nvar temp_org_name = app.ORG_NAME.getValue();\nvar temp_acc_name = app.ACC_HRCY_NAME.getValue();\n\n\n//核查编码是否为空\nif(temp_code===''||temp_code===null) {\n  Wb.toast('账薄编码不能为空！');\n  //Ext.MessageBox.alert('提示','账薄编码不能为空！');\n  return;\n}\n\n//检查名称是否为空\nif(temp_name===''||temp_name===null) {\n  Wb.toast('账薄名称不能为空！');\n  //Ext.MessageBox.alert('提示','账薄名称不能为空！');\n  return;\n}\n\n//检查科目体系\nif(temp_acc_name===''||temp_acc_name===null) {\n  Wb.toast('科目体系不能为空！');\n  //Ext.MessageBox.alert('提示','科目体系不能为空！');\n  return;\n}\nif(temp_hrcy===''||temp_hrcy===null&&(temp_acc_name===''||temp_acc_name===null)) {\n  Wb.toast('科目体系不能为空！');\n  //Ext.MessageBox.alert('提示','科目体系不能为空！');\n  return;\n}\nif((temp_hrcy===''||temp_hrcy===null)&&(temp_acc_name!==''&&temp_acc_name!==null)) {\n  Wb.toast('科目体系只能为下拉框中的选项！');\n  //Ext.MessageBox.alert('提示','科目体系只能为下拉框中的选项！');\n  return;\n}\n\n//检查组织是否为空\nif(temp_org_name===''||temp_org_name===null) {\n  Wb.toast('账薄所属组织不能为空！');\n  return;\n}\nif((temp_org===''||temp_org===null)&&(temp_org_name===''||temp_org_name===null)) {\n  Wb.toast('账薄所属组织不能为空！');\n  return;\n}\nif((temp_org===''||temp_org===null)&&(temp_org_name!==''&&temp_org_name!==null)) {\n  Wb.toast('账薄所属组织只能为下拉框中的选项！');\n  return;\n}\n\nvar mesg = \"{'LEDGER_ID':'\"+temp_id+\"','LEDGER_CODE':'\"+temp_code+\"','LEDGER_NAME':'\"+temp_name+\"','ACC_HRCY_ID':'\"+temp_hrcy+\"','ORG_ID':'\"+temp_org+\"'}\";\n\n\n//获取面板中的所有数据，比对编码与名称是否重复\nvar grid_data = app.ledger_grid.getStore();\nvar count = grid_data.data.length;\n\n\n  \n//保存操作时的提示信息与执行的模块路径\nvar temp_url = 'm?xwl=xc/gl/global/ledgers/ledgers_db/update_ledgers';\nvar succ_msg = '账薄信息修改成功';\nvar fail_msg = '账薄信息修改失败';\n\n\n\n//新增\nif(ledger_flag){\n  \n  //编码长度是否符合\n  if(temp_code.length>4) {\n     Wb.toast('账薄编码不能超过四位！');\n     return;\n  }\n  for(var i=0;i<count;i++) {\n    var row = grid_data.getAt(i);  \n    //比对编码是否重复\n    if(temp_code===row.data.LEDGER_CODE) {\n      Wb.toast('账薄编码不能重复，保存失败！');\n      return;\n    }\n    //比对名称是否重复\n    if(temp_name===row.data.LEDGER_NAME) {\n      Wb.toast('账薄名称不能重复，保存失败！');\n      return;\n    }\n  }\n  \n  temp_url = 'm?xwl=xc/gl/global/ledgers/ledgers_db/insert_ledgers';\n  succ_msg = '账薄信息新增成功';\n  fail_msg = '账薄信息新增失败';\n}\n\n//修改\nelse {\n  for(var i=0;i<count;i++) {\n  var row = grid_data.getAt(i);  \n  //比对名称是否重复,排除和自己比对\n  if((temp_name===row.data.LEDGER_NAME)&&(temp_id!==row.data.LEDGER_ID)) {\n    Wb.toast('账薄名称不能重复，保存失败！');\n    //Ext.MessageBox.alert('提示','账薄名称不能重复，保存失败！');\n    return;\n  }\n }\n}\n\n\nWb.request({\n  url:temp_url,\n  out:app.edit_panel,\n  success:function(){\n    Wb.toast(succ_msg);\n    //Ext.MessageBox.alert('提示',succ_msg);\n    app.add_update_ledger_win.close();\n    app.ledger_grid.store.load(); //隐藏窗口刷新\n\n  },\n  failure:function(){\n    Wb.toast(succ_msg);\n    //Ext.MessageBox.alert('提示',succ_msg);\n    app.add_update_ledger_win.close();\n  }\n});  "},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#cancelBtn#}","itemId":"cancelBtn","iconCls":"cancel_icon"},"events":{"click":"app.add_update_ledger_win.close();"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"array"}],"expanded":true,"type":"window"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}