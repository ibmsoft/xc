{"inframe":false,"title":"同步账簿科目信息","hidden":false,"roles":{"default":1},"children":[{"configs":{"loginRequired":"false","serverScript":"var infoArray = request.getParameter(\"infoArray\");\nvar LEDGER_ID = request.getParameter(\"LEDGER_ID\");\nvar array = Wb.decode(infoArray) ;\nvar succRecord = 0;\nvar insertSql;\nWb.each(array,function(rec){\n    var upAccCode = rec.UP_ACC_CODE ;//前台传过来的上级编码\n    insertSql = 'INSERT INTO xc_gl_ld_accounts (LD_ACC_ID,LEDGER_ID,ACC_ID,START_DATE,END_DATE,CREATION_DATE,CREATED_BY)VALUES(\"'+java.util.UUID.randomUUID()+'\",\"'+LEDGER_ID+'\",\"'+rec.ACC_ID+'\",\"'+rec.START_DATE+'\",\"'+rec.END_DATE+'\",{?timestamp.sys.date?},{?XIP.userId?})';\n    if(upAccCode == '-1'){//一级 科目\n        app.run(insertSql,{});\n    }\n    else{\n        var sqlId = 'select ACC_ID from xc_gl_accounts where ACC_CODE=\"'+upAccCode+'\"';//根据上级编码得到上级ID\n        do{\n            var rsId = app.run(sqlId,{type:'query'}) ;\n            while(rsId.next()){\n                var upAccId = rsId.getString(\"ACC_ID\") ;//上级ID\n                insertSql = 'INSERT INTO xc_gl_ld_accounts (LD_ACC_ID,LEDGER_ID,ACC_ID,START_DATE,END_DATE,CREATION_DATE,CREATED_BY)VALUES(\"'+java.util.UUID.randomUUID()+'\",\"'+LEDGER_ID+'\",\"'+upAccId+'\",\"'+rec.START_DATE+'\",\"'+rec.END_DATE+'\",{?timestamp.sys.date?},{?XIP.userId?})';\n                app.run(insertSql,{});\n                var sqlUpCode= 'select UP_ACC_CODE from xc_gl_accounts where ACC_ID=\"'+upAccId+'\"';//根据上级ID得到上级编码\n                var rsUpCode = app.run(sqlUpCode,{type:'query'}) ;\n                while(rsUpCode.next()){\n                    upAccCode = rsUpCode.getString(\"UP_ACC_CODE\") ;//上级ID\n                    sqlId = 'select ACC_ID from xc_gl_accounts where ACC_CODE=\"'+upAccCode+'\"';//根据上级编码得到上级ID\n                    //app.run(insertSql,{});\n                }\n            }\n        }\n        while(upAccCode !== '-1');\n    }\n});","itemId":"module"},"children":[],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}