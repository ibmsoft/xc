{"inframe":false,"title":"账簿级辅助核算段管理","hidden":false,"roles":{"default":1},"children":[{"configs":{"title":"账簿级辅助核算段启用管理","loginRequired":"false","serverScript":"//---------------------获取当前模块语言对应的.json文件，放到request中----------------\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xc/gl/ledger/ld-ass-seg-enabled/XC_GL_LD_SEGMENT\");\n","itemId":"module"},"children":[{"configs":{"height":"400","width":"800","layout":"fit","buttonAlign":"center","dialog":"true","itemId":"syncWindow"},"children":[{"configs":{"selType":"checkboxmodel","itemId":"syncGrid"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/gl/ledger/ld-ass-seg-enabled/ld_segment_db/select-syncSegment"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","dataIndex":"LEDGER_ID","itemId":"LEDGER_ID"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"LD_SEG_ID","itemId":"LD_SEG_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"段编码","hidden":"true","width":"150","align":"left","dataIndex":"SEG_CODE","titleAlign":"center","itemId":"SEG_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#SEG_NAME_COL#}","width":"150","align":"left","dataIndex":"SEG_NAME","titleAlign":"center","itemId":"SEG_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#SEG_TYPE_COL#}","width":"100","align":"left","dataIndex":"SEG_TYPE","titleAlign":"center","itemId":"SEG_TYPE_COL","renderer":"if(value == '1'){\n  return '共享';\n}else if(value == '0'){\n  return '私有';\n}else{\n  return value;\n}"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#LD_SEG_DESC_COL#}","width":"260","align":"left","dataIndex":"SEG_DESC","titleAlign":"center","itemId":"SEG_DESC_COL"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"window"},{"configs":{"layout":"border","itemId":"viewport1"},"children":[{"configs":{"region":"north","layout":"fit","border":"false","itemId":"form1"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","margin":"10 0 10 0","border":"false","itemId":"panel1"},"children":[{"configs":{"labelWidth":"80","displayField":"LEDGER_NAME","width":"250","valueField":"LEDGER_ID","margin":"8 0 0 20","labelAlign":"right","itemId":"LEDGER_NAME","fieldLabel":"{#Ledger#}"},"events":{"select":"app.queryBtn.fireEvent('click');"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/com-qry/gl-ledgers/select-sec-fd-ledgers"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"},{"configs":{"text":"查询","hidden":"true","width":"70","margin":"8 0 0 20","itemId":"queryBtn","iconCls":"seek_icon"},"events":{"click":"//alert(app.LEDGER_CODE.getValue());\napp.grid1.store.load({\n  params : {\n\tledger_id : app.LEDGER_NAME.getValue()\n}});"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"panel"}],"expanded":false,"type":"form"},{"configs":{"region":"center","selType":"checkboxmodel","itemId":"grid1","editable":"true"},"events":{"tagEvents":"'beforeedit' : function(editor,e,eOpts){\n  if(e.record.data.IS_ENABLED === 0){\n    return false;\n  }\n  \n}"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/gl/ledger/ld-ass-seg-enabled/ld_segment_db/select_ld_segment"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"{#syncBtn#}","itemId":"syncBtn","iconCls":"record_copy_icon"},"events":{"click":"LEDGER_ID = app.LEDGER_NAME.getValue();\n//alert(LEDGER_ID);\nif(LEDGER_ID === null){\n\tWb.toast('请选择账簿！');\n\treturn;\n}\n\nvar win = new Ext.window.Window(app._syncWindow); //app._strategy_window指向配置对象而非实例\nwin.show();\nwin.setIconCls('record_add_icon');//图标\nWb.setTitle(win,'同步');//标题\napp.syncGrid.store.load({params : {LEDGER_ID:LEDGER_ID}});\n\nwin.mon(win,'ok',function() {\n            var r = app.syncGrid.getSelection();\n            if (r.length === 0) {//没选择会警告\n                Wb.toast('请选择需要同步的记录!');\n                return false;\n            }\n  \n  \t\t\tWb.request({\n  \t\t\t\turl : 'm?xwl=xc/gl/ledger/ld-ass-seg-enabled/ld_segment_db/save-syncSegment',\n  \t\t\t\tparams : {'lineArray' : Wb.encode(Wb.getData(r)),'LEDGER_ID':LEDGER_ID},\n  \t\t\t\tsuccess: function(response){\n                  win.close();\n                  Wb.toast(\"保存成功!\");   \n                  app.queryBtn.fireEvent('click');\n    \t\t\t\tWb.decode(response.responseText);\n    \t\t\t\t              \n  \t\t\t\t}\n\t\t\t});\n  \t\t\t\n \t\t\t\n//             for(var t = 0; t < r.length; t++){\n//               \tvar SEG_CODE = r[t].data.SEG_CODE;\n//                 Wb.request({\n//                     url: 'm?xwl=xc/gl/ledger/ld-ass-seg-enabled/ld_segment_db/invalidate-syncSegment',\n//                     params:{LEDGER_ID:LEDGER_ID,SEG_CODE:SEG_CODE},\n//                     success: function(resp) {\n//                       \twin.close();\n//                       \tapp.grid1.store.load({\n//   \t\t\t\t\t\tparams : {\n// \t\t\t\t\t\t\tledger_id : LEDGER_ID\n// \t\t\t\t\t\t}});\n//                         //app.searchsButton.fireEvent('click');\n// \t\t\t\t\t\t//app.searchButton.fireEvent('click');\n//                         //app.syncWindow.hide();//根据closeAction属性，默认为销毁\n//                     }\n//                 });\n//             }\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#delBtn#}","hidden":"true","itemId":"delBtn","iconCls":"file_delete_icon"},"events":{"click":"//Wb.remove(app.grid1);\n// Wb.del(app.grid1, {\n//   url: 'm?xwl=xc/gl/global/voucher/category/category-db/delete-category',\n//   titleField: 'V_CATEGORY_ID'\n// });\n\nvar recs = app.grid1.getSelection();\n\nif (!recs.length) {\n  Wb.toast('请选择需要删除的记录。');\n  return;\n}\n\nWb.confirm('确定要删除选择的 ' + recs.length + ' 条记录吗？', function() {\n  Wb.request({\n    url: 'm?xwl=xc/gl/ledger/ld-ass-seg-enabled/ld_segment_db/delete-ld-segment', //使用basic-delete.xwl用于演示目的，建议使用delete.xwl\n    params: Wb.apply({\n      destroy: Wb.getData(recs)\n    }),\n    success: function() {\n      Wb.remove(app.grid1, recs);\n    }\n  });\n});\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#saveBtn#}","itemId":"saveBtn","iconCls":"save_icon"},"events":{"click":"if (!Wb.verifyGrid(app.grid1)) //验证数据是否合法\n  return;\n var modify = app.grid1.store.getModifiedRecords();\n if(modify.length===0){\n Wb.toast('没有要保存的数据！');\n   return false;\n }\n\nWb.request({\n  params:{'infoArray':Wb.encode(Wb.getData(modify ))},\n  url: 'm?xwl=xc/gl/ledger/ld-ass-seg-enabled/ld_segment_db/update',\n  message: '正在保存中...',\n  success: function(resp) {\n    if(Wb.decode(resp.responseText).flag==='0'){\n\n      //把后台返回的KEY_ID和USER_ID同步更新到表格\n    Wb.syncCreate(app.grid1, Wb.decode(resp.responseText));\n          Wb.toast('保存成功！');\n        return false;\n    }else{\n        Wb.toast('保存失败！');\n        return false;\n    }\n  \n  }\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#defendBtn#}","itemId":"defendBtn","iconCls":"settings2_icon"},"events":{"click":"var rows=app.grid1.getSelection();\nif(rows.length!==1){\n  Wb.toast('请选择一条记录！');\n  return false;\n}\nif(rows[0].data.IS_ENABLED===0){\nWb.toast('该条账簿辅助段未启用！');\n  return false;\n}\nvar seg_code = rows[0].data.SEG_CODE;\nvar seg_name = rows[0].data.LD_SEG_ALIAS;\nvar ledger_id=rows[0].data.LEDGER_ID;\nvar url;\nvar flag = false;\nif(seg_code==='XC_AP_VENDORS'){\n  flag = true;\n  url='m?xwl=xc/gl/ledger/ld-segval-enabled/XC_GL_LD_SEGVAL_ENABLED';\n}\nelse if(seg_code==='XC_AR_CUSTOMERS'){\n  flag = true;\n  url='m?xwl=xc/gl/ledger/ld-segval-enabled/XC_GL_LD_SEGVAL_ENABLED';\n}\nelse if(seg_code==='XC_GL_PRODUCTS'){\n  flag = true;\n  url='m?xwl=xc/gl/ledger/ld-segval-enabled/XC_GL_LD_SEGVAL_ENABLED';\n}\nelse if(seg_code==='XC_PM_PROJECTS'){\n  url='m?xwl=xc/gl/ledger/ld-pm-project/XC_GL_LD_PROJECT';\n}\nelse if(seg_code==='XIP_PUB_DEPTS'){\n  flag = true;\n  url='m?xwl=xc/gl/ledger/ld-segval-enabled/XC_GL_LD_SEGVAL_ENABLED';\n}\nelse if(seg_code==='XIP_PUB_EMPS'){\n  flag = true;\n  url='m?xwl=xc/gl/ledger/ld-segval-enabled/XC_GL_LD_SEGVAL_ENABLED';\n}\nelse if(seg_code==='XIP_PUB_ORGS'){\n  flag = true;\n  url='m?xwl=xc/gl/ledger/ld-segval-enabled/XC_GL_LD_SEGVAL_ENABLED';\n}\nelse\n{\n  url='m?xwl=xc/gl/ledger/ld-cust-ass-segvals/XC_GL_LD_CUST_SEG_VAL';\n}\nWb.run({\n  url:url,\n  title:seg_name,\n  params : {ledger_id:ledger_id,seg_code:seg_code,seg_name:seg_name},\n  success:function(obj){\n    if(flag){\n    obj.initViewport();\n    }\n    var firstWindow = new Ext.Window({\n      title : seg_name+'辅助段详情', // 窗口标题\n      iconCls : 'imageIcon',\n      layout : 'fit', // 设置窗口布局模式\n      width : 1080, // 窗口宽度\n      height : 600, // 窗口高度\n      closable : true, // 是否可关闭\n      closeAction : 'hide', // 关闭策略\n      bodyStyle : 'background-color:#FFFFFF',\n      border : true, // 边框线设置\n      constrain : true\n    });\n    firstWindow.add(obj.viewport1);\n    firstWindow.show(); // 显示窗口\n  }\n});"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#rownum#}","align":"center","width":"50","xtype":"rownumberer","titleAlign":"center","itemId":"ROW_NUMBER_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"段ID","hidden":"true","dataIndex":"LD_SEG_ID","titleAlign":"center","itemId":"LD_SEG_ID_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"账簿ID","hidden":"true","dataIndex":"LEDGER_ID","titleAlign":"center","itemId":"LEDGER_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"账簿名称","hidden":"true","width":"150","align":"left","dataIndex":"LEDGER_NAME","titleAlign":"center","itemId":"LEDGER_NAME_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"段编码","hidden":"true","width":"150","align":"left","dataIndex":"SEG_CODE","titleAlign":"center","itemId":"SEG_CODE_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#SEG_NAME_COL#}","width":"150","align":"left","dataIndex":"SEG_NAME","titleAlign":"center","itemId":"SEG_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#SEG_TYPE_COL#}","width":"150","align":"left","dataIndex":"SEG_TYPE","titleAlign":"center","itemId":"SEG_TYPE_COL","renderer":"if(value == '1'){\n  return '共享';\n}else if(value == '0'){\n  return '私有';\n}else{\n  return value;\n}"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#LD_SEG_ALIAS_COL#}","width":"150","align":"left","dataIndex":"LD_SEG_ALIAS","titleAlign":"center","itemId":"LD_SEG_ALIAS_COL"},"children":[{"configs":{"itemId":"editor"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"column"},{"configs":{"undefinedText":"100","text":"{#IS_ENABLED_COL#}","xtype":"checkcolumn","dataIndex":"IS_ENABLED","titleAlign":"center","itemId":"IS_ENABLED_COL"},"events":{"checkchange":"if (!Wb.verifyGrid(app.grid1)) //验证数据是否合法\n  return;\nvar modify = app.grid1.store.getModifiedRecords();//获得修改的记录\nvar seg_code = modify[0].data.SEG_CODE;\nvar is_enabled = modify[0].data.IS_ENABLED;\nvar ledger_id = app.LEDGER_NAME.getValue();\nvar ld_seg_id = modify[0].data.LD_SEG_ID;\nvar after;\nif(is_enabled===0){\n  after=0;\n}else{\n  after=1;\n}\nWb.request({\n  url: 'm?xwl=xc/gl/ledger/ld-ass-seg-enabled/ld_segment_db/invalidate',\n  params: {'ledger_id': ledger_id,'seg_code':seg_code,'is_enabled':is_enabled,'ld_seg_id':ld_seg_id,'after':after},\n  success: function(resp) {\n    if(Wb.decode(resp.responseText).flag==='0'){\n      app.grid1.store.load({\n        params : {\n          ledger_id : app.LEDGER_NAME.getValue()\n        }\n      });\n    }else{\n      return false;\n    }\n  },\n  failure:function(){\n    app.grid1.store.load({\n      params : {\n        ledger_id : app.LEDGER_NAME.getValue()\n      }\n    });\n    return false;\n  }\n});"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#LD_SEG_DESC_COL#}","width":"300","align":"left","dataIndex":"LD_SEG_DESC","titleAlign":"center","itemId":"LD_SEG_DESC_COL"},"children":[{"configs":{"itemId":"editor"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}