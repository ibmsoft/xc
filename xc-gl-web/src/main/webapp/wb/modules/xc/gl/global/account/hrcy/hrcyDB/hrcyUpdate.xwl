{"inframe":false,"title":"科目体系更新","hidden":false,"roles":{"default":1},"children":[{"configs":{"loginRequired":"false","serverScript":"var id,ids = [],\nrecsInsert = Wb.decode(request.getParameter('create'));\nWb.each(recsInsert,function(rec){\n    if(rec.START_DATE > rec.END_DATE){\n\t\tWb.error('开始时间不能大于结束时间，请重新输入！');\n    }\n    app.run(\"select 1 from xc_gl_acc_hrcy where ACC_HRCY_CODE='\" + rec.ACC_HRCY_CODE.replace(\"'\",\"\\\\'\") + \"'\",{\n        errorText: '编码\"' + rec.ACC_HRCY_CODE + '\" 已经存在。'\n    });\n    app.run(\"select 1 from xc_gl_acc_hrcy where ACC_HRCY_NAME='\" + rec.ACC_HRCY_NAME.replace(\"'\",\"\\\\'\") + \"'\",{\n        errorText: '编码名称\"' + rec.ACC_HRCY_NAME + '\" 已经存在。'\n    });\n\tid = java.util.UUID.randomUUID();\n\trec.ACC_HRCY_ID = id;\n    Wb.apply(rec, {\n        CREATION_DATE : new Date(),\n        CREATED_BY : '{#XIP.userId#}',\n        LAST_UPDATE_DATE : new Date(),\n        LAST_UPDATED_BY : '{#XIP.userId#}'\n    });\n\tids.push({\n\t\tACC_HRCY_ID : id\n\t});\n});\nrecsUpdate = Wb.decode(request.getParameter('update'));\nWb.each(recsUpdate,function(rec){\n    if(rec.START_DATE > rec.END_DATE){\n\t\tWb.error('开始时间不能大于结束时间，请重新输入！');\n    }\n    app.run(\"select 1 from xc_gl_acc_hrcy where ACC_HRCY_CODE='\" + rec.ACC_HRCY_CODE.replace(\"'\",\"\\\\'\") + \"'and ACC_HRCY_ID <> '\" + rec.ACC_HRCY_ID+\"' \",{\n        errorText: '编码\"' + rec.ACC_HRCY_CODE + '\" 已经存在。'\n    });\n    app.run(\"select 1 from xc_gl_acc_hrcy where ACC_HRCY_NAME='\" + rec.ACC_HRCY_NAME.replace(\"'\",\"\\\\'\") + \"'and ACC_HRCY_ID <> '\" + rec.ACC_HRCY_ID+\"' \",{\n        errorText: '编码名称\"' + rec.ACC_HRCY_NAME + '\" 已经存在。'\n    });\n    rec.LAST_UPDATE_DATE = new Date();\n    rec.LAST_UPDATED_BY = '{#XIP.userId#}';\n});\nrequest.setAttribute('update',Wb.encode(recsUpdate));//重置create记录\nrequest.setAttribute('create',Wb.encode(recsInsert));//重置create记录\napp.update({\n\ttableName: 'xc_gl_acc_hrcy'\n});\ncom.xzsoft.xc.gl.util.XCGLWebBuilderUtil.clearHrcyCachedData(id);\napp.send(ids);//把id列表发送到客户端以同步到表格","itemId":"module"},"children":[],"expanded":false,"type":"module"}],"pageLink":"","iconCls":""}