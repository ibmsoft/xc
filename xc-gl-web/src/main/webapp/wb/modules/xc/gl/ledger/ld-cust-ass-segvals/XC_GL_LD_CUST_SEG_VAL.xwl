{"inframe":false,"title":"自定义辅助核算段值管理","hidden":false,"roles":{"default":1},"children":[{"configs":{"loginRequired":"false","serverScript":"//---------------------获取当前模块语言对应的.json文件，放到request中----------------\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xc/gl/ledger/ld-cust-ass-segvals/XC_GL_LD_CUST_SEG_VAL\");\n\n\n//获取账簿和自定义辅助段编码\nvar ledger_id = request.getParameter('ledger_id');\nvar seg_code = request.getParameter('seg_code');\nvar seg_name = request.getParameter('seg_name');\n// var out=java.lang.System.out;\n// out.print(\"ledger_idledger_id::\"+ledger_id);\nrequest.setAttribute('ledger_id',ledger_id);\nrequest.setAttribute('seg_code',seg_code);\nrequest.setAttribute('seg_name',seg_name);\nvar ctxPath = request.getContextPath() ;\nrequest.setAttribute('contextPath',ctxPath);","itemId":"module"},"events":{"finalize":"var ledger_id1 = '{#ledger_id#}';//外地操作\nvar seg_code1 = '{#seg_code#}';//外地操作\nvar seg_name1 = '{#seg_name#}';//外地操作","initialize":"var segName;\nvar v_seg_code;\nvar ledger_id;\nvar up_val;\nfunction beforeDropType(node, data, overModel, dropPosition, options) {\n  //拖动前时间\n  //完成拖动: return true;\n  //取消拖动: return false;\n  return true;\n}\nfunction dropType(node, data, overModel, dropPosition, options) {\n  Wb.mask(app.tree1);\n  //树的根节点\n  var rootNode = app.tree1.getRootNode();\n  //父节点id\n  var parentId = '';\n  //拖动节点id\n  var srcId = data.records[0].get('id');\n  \n  //拖动节点新生成的排序号\n  var orderNum = '';\n  \n  //判断是否添加到根节点\n  if(overModel == rootNode){\n    Wb.unmask(app.tree1);\n    parentId = -1;\n    orderNum = overModel.lastChild.previousSibling ? Number(overModel.lastChild.previousSibling.get('SEGVAL_LEVEL')) + 1 : 0;\n  }\n  else{\n    if(dropPosition==='append'){//拖动为子节点 append\n      parentId = overModel.get('id');\n      orderNum =2;\n      //展开拖动到的节点，为了获取拖动到节点的子节点。\n      overModel.expand(false,function(){\n        Wb.unmask(app.tree1);\n        parentId = overModel.get('id');\n        \n        orderNum = overModel.lastChild.previousSibling ? Number(overModel.lastChild.previousSibling.get('SEGVAL_LEVEL')) + 1 : 0;\n      });\n    }else if(dropPosition==='before'){//拖动到节点前 before\n      Wb.unmask(app.tree1);\n      //判断根节点节点\n      if(overModel.parentNode == rootNode){\n        parentId = -1;\n      }else{\n        parentId = overModel.parentNode.get('id');\n      }\n      orderNum = overModel.get('SEGVAL_LEVEL');\n    }else{//拖动到节点后 after\n      \n      Wb.unmask(app.tree1);\n      if(overModel.parentNode == rootNode){\n        parentId = -1;\n      }else{\n        parentId = overModel.parentNode.get('id');\n      }\n      orderNum = overModel.get('SEGVAL_LEVEL') + 1;\n    }\n  }\n\n     //拖拽完成之后根据子节点设置之前的父节点是否为叶子节点\n      Wb.request({url:'m?xwl=xc/gl/ledger/ld-cust-ass-segvals/ld-cust-ass-segvalsDB/selectParentId',\n                  params:{'srcId':srcId},\n                 success:function(resp){\n                   var returnObj = Wb.decode(resp.responseText);\n                   var parentId1 = returnObj.rows[0].UP_CUST_SEGVAL_ID;\n                   if(parentId1!=='-1'){\n                     Wb.request({\n                      url:'m?xwl=xc/gl/ledger/ld-cust-ass-segvals/ld-cust-ass-segvalsDB/selectCount',\n                       params:{'parentId1':parentId1},\n                       success:function(resp){\n                       var returnObj1 = Wb.decode(resp.responseText);\n                         \n                         if(returnObj1.rows[0].COUNT===0){\n                         Wb.request({\n                     url:'m?xwl=xc/gl/ledger/ld-cust-ass-segvals/ld-cust-ass-segvalsDB/updateIfYearBefore',\n                     params:{'parentId1':parentId1},\n                     success:function(){\n                        }\n                      });\n                         }\n                       }\n                     });\n\n                        \n                        \n                   \n                      }\n                 \n\n                   }\n                 \n                 });\n\n  Wb.request({\n    url: 'm?xwl=xc/gl/ledger/ld-cust-ass-segvals/ld-cust-ass-segvalsDB/updateFunMenuIdx', \n    params: {parentId:parentId,idx:orderNum,funTreeId:srcId},\n    success: function(response){\n   \n      if(dropPosition == 'append'){\n        //动态修改节点属性值\n        overModel.lastChild.set('parent_id', parentId);\n        overModel.lastChild.set('SEGVAL_LEVEL', orderNum);\n        overModel.commit();\n      }else{\n        var hasReachSrcNode = false;\n        overModel.eachChild(function(cNode) {\n          //判断是否为拖动的节点\n          if(cNode.get('id') == srcId){\n            cNode.set('parent_id', parentId);\n            cNode.set('SEGVAL_LEVEL', orderIndex);\n            cNode.commit();\n          }\n          //拖动节点后面的节点序号+1\n          var i = Number(cNode.get('SEGVAL_LEVEL'));\n          if (i >= orderNum) {\n            cNode.set('SEGVAL_LEVEL', i + 1);\n            cNode.commit();\n          }\n        });\n      }\n    \n    },\n    failure:function(response){\n    }\n  });\n  \n}"},"children":[{"configs":{"itemId":"folder1"},"children":[{"configs":{"autoLoad":"true","itemId":"ledgerstore","url":"m?xwl=xc/gl/ledger/ld-cust-ass-segvals/ld-cust-ass-segvalsDB/selectLedgerName","showMask":"false"},"children":[],"expanded":false,"type":"store"},{"configs":{"autoLoad":"true","itemId":"segstore","url":"m?xwl=xc/gl/ledger/ld-cust-ass-segvals/ld-cust-ass-segvalsDB/selectSegmentName"},"events":{"load":"\n","beforeload":"store.proxy.extraParams.ledgerId = app.ledgerName.getValue();"},"children":[],"expanded":false,"type":"store"}],"expanded":false,"type":"folder"},{"configs":{"itemId":"windows"},"children":[{"configs":{"height":"200","width":"500","layout":"form","closeAction":"hide","defaultFocus":"LD_CUST_SEGVAL_CODE","border":"false","dialog":"true","itemId":"window1","modal":"true","createInstance":"false"},"events":{"ok":"\nif(Ext.isEmpty(app.LD_CUST_SEGVAL_CODE.getValue())){\n  Wb.toast('编码不能为空！');\n  app.LD_CUST_SEGVAL_CODE.focus();\n  return false;\n}\nif(Ext.isEmpty(app.LD_CUST_SEGVAL_NAME.getValue())){\n  Wb.toast('名称不能为空！');\n  app.LD_CUST_SEGVAL_NAME.focus();\n  return false;\n}\nif(Ext.isEmpty(app.START_DATE.getValue())){\n  Wb.toast('开始日期不能为空！');\n  app.START_DATE.focus();\n  return false;\n}"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"column","margin":"10 0 0 0 ","itemId":"panel1"},"children":[{"configs":{"labelWidth":"80","width":"220","labelAlign":"right","itemId":"LD_CUST_SEGVAL_CODE","fieldLabel":"<font color='red'>*<\/font>编码"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"80","width":"220","labelAlign":"right","itemId":"LD_CUST_SEGVAL_NAME","fieldLabel":"<font color='red'>*<\/font>名称"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"column","margin":"10 0 0 0 ","itemId":"panel2"},"children":[{"configs":{"labelWidth":"80","width":"220","labelAlign":"right","itemId":"START_DATE","fieldLabel":"<font color='red'>*<\/font>开始日期","editable":"false"},"children":[],"expanded":false,"type":"date"},{"configs":{"labelWidth":"80","allowBlank":"true","width":"220","labelAlign":"right","itemId":"END_DATE","fieldLabel":"结束日期","editable":"false"},"children":[],"expanded":false,"type":"date"}],"expanded":false,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","margin":"10 0 0 0 ","itemId":"panel3"},"children":[{"configs":{"labelWidth":"80","allowBlank":"true","width":"440","labelAlign":"right","itemId":"LD_CUST_SEGVAL_DESC","fieldLabel":"说明"},"children":[],"expanded":false,"type":"text"}],"expanded":false,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","hidden":"true","itemId":"panel4"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","hidden":"true","width":"220","labelAlign":"right","itemId":"SEGVAL_LEVEL","fieldLabel":"级别"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"80","readOnly":"true","hidden":"true","width":"220","labelAlign":"right","itemId":"UP_CUST_SEGVAL_CODE","fieldLabel":"上级编码"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","hidden":"true","itemId":"panel5"},"children":[{"configs":{"itemId":"LD_CUST_SEGVAL_ID","fieldLabel":"id"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"IS_LEAF"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"LEDGER_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"SEG_CODE"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"80","readOnly":"true","width":"220","labelAlign":"right","itemId":"UP_CUST_SEGVAL_ID","fieldLabel":"上级ID"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":false,"type":"window"},{"configs":{"height":"130","width":"280","layout":"column","closeAction":"hide","border":"false","defaultFocus":"date1","dialog":"true","itemId":"window2","modal":"true"},"children":[{"configs":{"labelWidth":"80","width":"200","margin":"20 0 0 20","labelAlign":"right","itemId":"date1","fieldLabel":"结束日期"},"children":[],"expanded":false,"type":"date"}],"expanded":false,"type":"window"},{"configs":{"maximized":"true","title":"会计科目数据导入","height":"400","minimizable":"true","width":"750","layout":"border","dialog":"false","border":"false","itemId":"importDataWin","modal":"true","maximizable":"true","createInstance":"false"},"events":{"close":"app.tree1.getStore().reload();"},"children":[{"configs":{"region":"center","frame":"true","style":"border-width:0px","layout":"column","padding":"15 0 0 5","border":"false","itemId":"importForm"},"children":[{"configs":{"labelWidth":"80","allowBlank":"false","emptyText":"请选择Excel文件","labelAlign":"left","itemId":"selectFile","fieldLabel":"<font color='red'>*<\/font>选择文件"},"children":[],"expanded":false,"type":"file"},{"configs":{"text":"导入","itemId":"importFile","iconCls":"ok_icon","x":"2"},"events":{"click":"if(!app.importForm.getForm().isValid()){\n  Wb.info('请选择要上传的文件！');\n  return false;\n}\nvar fileType = app.selectFile.getValue();\nif(!Ext.String.endsWith(fileType,'.xls')){\n  Wb.info('请选择以xls结尾的Office Excel文档!',function(){\n    app.importForm.getForm().reset();\n  });\n}else{\n  //导入前，先清除错误数据\n  app.importLogGrid.getStore().removeAll();\n  var msgProcessBar = Ext.Msg.show({\n     title:'提示',\n     msg  :'导入中，请稍后.....',\n     wait :true,\n     width:200\n  });\n  //将Office Excel数据导入到余额临时表中\n  var importLedgerId = '{#ledger_id#}';\n  var importSegCode =  '{#seg_code#}';\n  app.importForm.getForm().submit({\n    url:'{#contextPath#}/glDataTransgerManageAction.do?method=importAccountData&templateCode=XC_GL_LD_CUST_ASS_SEGVALS&ledgerId='+importLedgerId+'&segCode='+importSegCode,\n    timeout:3600*1000,\n    success:function(form,action){\n      msgProcessBar.hide();\n      Wb.info(action.result.msg,function(){\n        app.importDataWin.close();\n      });\n    },\n    failure:function(form,action){\n      msgProcessBar.hide();\n      var _flag = action.result.flag;\n      //flag =0,导入时发生异常，输出异常信息\n      if(_flag == '0'){\n        Wb.info(action.result.msg);\n      }else if(_flag == '2'){\n       //flag =2,数据导入临时表成功，数据校验发生异常\n        var _sessionId = action.result.msg;\n        Wb.info('导入数据不合法！');\n        app.importLogGrid.getStore().load({params:{'sessionId':_sessionId,'segCode':importSegCode}});\n      }\n    }   \n  });\n}"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"form"},{"configs":{"region":"south","height":"'88%'","itemId":"southTab"},"children":[{"configs":{"title":"导入日志信息","selType":"checkboxmodel","itemId":"importLogGrid"},"children":[{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"错误行","width":"70","dataIndex":"ROW_NUM","itemId":"ROW_NUM","renderer":"return '<font color=\"red\">'+value+'<\/font>';"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"编码","width":"120","dataIndex":"LD_CUST_SEGVAL_CODE","itemId":"LD_CUST_SEGVAL_CODE"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"上级编码","width":"120","dataIndex":"UP_CODE","itemId":"UP_CODE"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"名称","width":"200","dataIndex":"LD_CUST_SEGVAL_NAME","itemId":"LD_CUST_SEGVAL_NAME"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"描述","width":"200","dataIndex":"LD_CUST_SEGVAL_DESC","itemId":"LD_CUST_SEGVAL_DESC"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"生效日期","width":"120","dataIndex":"START_DATE","itemId":"START_DATE"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"失效日期","width":"120","dataIndex":"END_DATE","itemId":"END_DATE"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"错误信息","width":"300","dataIndex":"ERROR_MSG","itemId":"E_MSG","renderer":"metaData.style = 'overflow:auto;padding: 3px 6px;text-overflow: ellipsis;white-space: nowrap;white-space:normal;line-height:15px;';   \nreturn '<font color=\"red\">'+value+'<\/font>';","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"pageSize":"-1","autoLoad":"true","itemId":"store","url":"m?xwl=xc/gl/ledger/ld-cust-ass-segvals/ld-cust-ass-segvalsDB/getInvalidSegment"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"tab"}],"expanded":false,"type":"window"}],"expanded":false,"type":"folder"},{"configs":{"layout":"border","border":"false","itemId":"viewport1"},"events":{"afterrender":"\nif((ledger_id1!==''||ledger_id1!== null||ledger_id1!==undefined)&&(seg_code1!==''||seg_code1!== null||seg_code1!==undefined)){\n  app.segstore.load({\n   params:{ledgerId:ledger_id1,\n           seg_code:seg_code1\n        }\n  });\n  app.ledgerName.setReadOnly(true);\n  app.segName1.setReadOnly(true);\n  app.ledgerName.setValue(ledger_id1);\n  app.segName1.setValue(seg_code1);\n  segName = seg_name1;\n  app.tree1.setRootNode({\n  text:Str.all,PARENT_ID:'root',id:'-1',text:segName,expanded:false\n});\n   app.tree1.store.load();\n}"},"children":[{"configs":{"region":"north","layout":"fit","border":"false","itemId":"form1"},"children":[{"configs":{"layout":"column","border":"false","padding":"10","itemId":"panel1"},"children":[{"configs":{"labelWidth":"100","store":"app.ledgerstore","displayField":"LEDGER_NAME","width":"330","valueField":"LEDGER_ID","labelAlign":"right","itemId":"ledgerName","fieldLabel":"{#ledgerName#}","editable":"true"},"events":{"select":"app.segName1.enable();","change":"app.segName1.setValue();\n"},"children":[],"expanded":true,"type":"combo"},{"configs":{"labelWidth":"{#segName1_lw#}","store":"app.segstore","displayField":"displayName","width":"400","valueField":"SEG_CODE","labelAlign":"right","itemId":"segName1","fieldLabel":"{#segName1#}","disabled":"false","editable":"false"},"events":{"select":"app.tree1.store.load();"},"children":[],"expanded":true,"type":"combo"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"form"},{"configs":{"rootVisible":"true","region":"west","title":"{#tree1#}","animate":"false","collapsible":"true","width":"220","itemId":"tree1","viewConfig":"{\n  plugins : {\n    pluginId: 'ddPlug',\n    ptype: 'treeviewdragdrop'\n  },\n  listeners : {\n    beforedrop: beforeDropType,\n    drop: dropType\n  }\n}"},"events":{"itemclick":"id=record.data.id;\nup_val = record.data.id;\nledger_id=app.ledgerName.getValue();\nv_seg_code=app.segName1.getValue();\nWb.request({\nurl:'m?xwl=xc/gl/ledger/ld-cust-ass-segvals/ld-cust-ass-segvalsDB/selectForTree'\n});\napp.grid1.store.load({params:{'ID':id,'ledger_id':ledger_id,'seg_code':v_seg_code}});","itemdblclick":"var id = record.get('id');\nvar up_id = record.get('parent_id');\nvar text = record.get('text');\nvar LD_CUST_SEGVAL_NAME=record.get('name');//name\nvar LD_CUST_SEGVAL_CODE=record.get('code');\nvar SEGVAL_LEVEL = record.get('SEGVAL_LEVEL');//级别\nvar UP_CUST_SEGVAL_CODE=record.get('UP_CUST_SEGVAL_CODE');\nvar LEDGER_ID=record.get('LEDGER_ID');\nvar SEG_CODE=record.get('SEG_CODE');\nvar start_date = record.get('START_DATE');\nvar end_date = record.get('END_DATE');\nvar end_date1;//判断结束日期\nvar end_date1Flag = 'flase';//判断结束日期是否发生了变化\nif(id!=='-1'){\n  var url1;\n\n if(SEG_CODE === 'XC_GL_CUSTOM1'){\n   url1='m?xwl=xc/gl/ledger/ld-cust-ass-segvals/ld-cust-ass-segvalsDB/selectCUSTOM1_IDIfUsed';\n }\n  if(SEG_CODE === 'XC_GL_CUSTOM2'){\n   url1='m?xwl=xc/gl/ledger/ld-cust-ass-segvals/ld-cust-ass-segvalsDB/selectCUSTOM2_IDIfUsed';\n  }\n  if(SEG_CODE === 'XC_GL_CUSTOM3'){\n   url1='m?xwl=xc/gl/ledger/ld-cust-ass-segvals/ld-cust-ass-segvalsDB/selectCUSTOM3_IDIfUsed';\n  }\n  if(SEG_CODE === 'XC_GL_CUSTOM4'){\n   url1='m?xwl=xc/gl/ledger/ld-cust-ass-segvals/ld-cust-ass-segvalsDB/selectCUSTOM4_IDIfUsed'; \n  }\n    Wb.request({\n    url:url1,\n    params:{'ledger_id':LEDGER_ID,'id':id},\n    success:function(resp){\n    var returnobj = Wb.decode(resp.responseText);\n     if(returnobj.rows[0].count!==0){\n     //被引用\n    var win = new Ext.window.Window(app._window1); //app._win指向配置对象而非实例\n\twin.show();\n\twin.setIconCls('file_edit_icon');\n\tWb.setTitle(win, '修改['+record.get('text')+']');\n\tWb.setValue(win, record.data); //把记录数据应用到窗口\n    app.LD_CUST_SEGVAL_CODE.setReadOnly(true);\n    app.LD_CUST_SEGVAL_NAME.setValue(LD_CUST_SEGVAL_NAME);\n    app.LD_CUST_SEGVAL_CODE.setValue(LD_CUST_SEGVAL_CODE);\n    app.UP_CUST_SEGVAL_ID.setValue(up_id);\n    app.UP_CUST_SEGVAL_CODE.setValue(UP_CUST_SEGVAL_CODE);\n    app.SEGVAL_LEVEL.setValue(SEGVAL_LEVEL);\n    app.START_DATE.setValue(new Date());\n\t//窗口每次动态生成,方法在窗口销毁时自动销毁\n\twin.mon(win, 'ok', function(){\n          end_date1=app.END_DATE.getValue();\n         if(end_date1===null){\n           end_date1=new Date('12/31/9999');\n           end_date1Flag = 'true';\n           app.END_DATE.setValue(end_date1);\n          }\n      if(app.START_DATE.getValue()>app.END_DATE.getValue()){\n          Wb.toast('结束日期要大于开始日期!');\n            return false;\n          }\n     //判断用户是否进行了修改\n    if( LD_CUST_SEGVAL_NAME === app.LD_CUST_SEGVAL_NAME.getValue()&&app.START_DATE.getValue()-start_date === 0 && (end_date1Flag === 'true' || (app.END_DATE.getValue() - end_date === 0))){\n       //没有进行修改 \n      win.close();\n      return false;\n     }\n      \n  \t Wb.request({\n     url: 'm?xwl=xc/gl/ledger/ld-cust-ass-segvals/ld-cust-ass-segvalsDB/updateLd_cust_seg_val',\n    params: {'LD_CUST_SEGVAL_ID':id,'LD_CUST_SEGVAL_CODE':app.LD_CUST_SEGVAL_CODE.getValue(),'LD_CUST_SEGVAL_NAME':app.LD_CUST_SEGVAL_NAME.getValue(),\n             'START_DATE':app.START_DATE.getValue(),'END_DATE':app.END_DATE.getValue(),\n             'LD_CUST_SEGVAL_DESC':app.LD_CUST_SEGVAL_DESC.getValue()\n             },\n    success: function() {\n      \n         win.close(); //根据closeAction属性，默认为销毁\n      Wb.toast('修改成功!');\n        app.tree1.store.load({\n               params:{'seg_code':v_seg_code,'ledger_id':ledger_id}\n               });\n              app.grid1.store.load({param:{'ID':id}});\n    }\n  });\n});\n     }\n    else{\n    //没有被引用\n    var win1 = new Ext.window.Window(app._window1); //app._win指向配置对象而非实例\n\twin1.show();\n\twin1.setIconCls('file_edit_icon');\n\tWb.setTitle(win1, '修改['+record.get('text')+']');\n\tWb.setValue(win1, record.data); //把记录数据应用到窗口\n    app.LD_CUST_SEGVAL_NAME.setValue(LD_CUST_SEGVAL_NAME);\n    app.LD_CUST_SEGVAL_CODE.setValue(LD_CUST_SEGVAL_CODE);\n    app.UP_CUST_SEGVAL_ID.setValue(up_id);\n    app.UP_CUST_SEGVAL_CODE.setValue(UP_CUST_SEGVAL_CODE);\n    app.SEGVAL_LEVEL.setValue(SEGVAL_LEVEL);\n    app.START_DATE.setValue(new Date());\n\t//窗口每次动态生成,方法在窗口销毁时自动销毁\n\twin1.mon(win1, 'ok', function() {\n           end_date1=app.END_DATE.getValue();\n         if(end_date1===null){\n           end_date1=new Date('12/31/9999');\n           end_date1Flag = 'true';\n           app.END_DATE.setValue(end_date1);\n          }\n      if(app.START_DATE.getValue()>app.END_DATE.getValue()){\n          Wb.toast('结束日期要大于开始日期!');\n            return false;\n          }\n     //判断用户是否进行了修改\n    if(LD_CUST_SEGVAL_CODE === app.LD_CUST_SEGVAL_CODE.getValue() && LD_CUST_SEGVAL_NAME === app.LD_CUST_SEGVAL_NAME.getValue()&&app.START_DATE.getValue()-start_date === 0 && (end_date1Flag === 'true' || (app.END_DATE.getValue() - end_date === 0))){\n       //没有进行修改 \n      win1.close();\n      return false;\n     }\n      \n  \tWb.request({\n     url: 'm?xwl=xc/gl/ledger/ld-cust-ass-segvals/ld-cust-ass-segvalsDB/updateLd_cust_seg_val',\n    params: {'LD_CUST_SEGVAL_ID':id,'LD_CUST_SEGVAL_CODE':app.LD_CUST_SEGVAL_CODE.getValue(),'LD_CUST_SEGVAL_NAME':app.LD_CUST_SEGVAL_NAME.getValue(),\n             'START_DATE':app.START_DATE.getValue(),'END_DATE':app.END_DATE.getValue(),\n             'LD_CUST_SEGVAL_DESC':app.LD_CUST_SEGVAL_DESC.getValue()\n             },\n    success: function() {\n      win1.close(); //根据closeAction属性，默认为销毁\n       Wb.toast('修改成功!');\n        app.tree1.store.load({\n               params:{'seg_code':v_seg_code,'ledger_id':ledger_id}\n               });\n              app.grid1.store.load({param:{'ID':id}});\n    }\n  });\n});\n      \n    }\n    }\n    });\n  \n\n}","tagEvents":"itemcontextmenu:function(view, record, item, index, event, options){\n//账簿不能为空\nevent.preventDefault();\nevent.stopEvent();\nvar is_leaf ='';\nid = record.get('id');//id\nvar LD_CUST_SEGVAL_NAME=record.get('name');//name\nvar LD_CUST_SEGVAL_CODE=record.get('code');\nvar up_id = record.get('parent_id');//上级id\nvar SEGVAL_LEVEL = record.get('SEGVAL_LEVEL');//级别\nvar text = record.get('text');\nvar ld_cust_segval_desc = record.get('LD_CUST_SEGVAL_DESC');\nvar start_date=record.get('START_DATE');\nvar end_date=record.get('END_DATE');\nvar LEDGER_ID=record.get('LEDGER_ID');\nvar SEG_CODE=record.get('SEG_CODE');\nvar UP_CUST_SEGVAL_CODE=record.get('UP_CUST_SEGVAL_CODE');\nvar nodemenu;\nvar end_date1;//判断结束日期\nvar end_date1Flag = 'flase';//判断结束日期是否发生了变化\nvar segName=app.segName1.getValue();\nvar leaf = record.get('leaf');\n//如果是根节点则不需要判断\n  if(id === '-1'){\n      nodemenu = new Ext.menu.Menu({\n      items:[\n        {\n        text:'新增下级段值',\n        iconCls: 'file_add_icon', \n        handler:function(){\n        var win = new Ext.window.Window(app._window1);\n        win.setTitle('新增['+record.get('text')+']下级项目');\n          app.SEGVAL_LEVEL.setValue('1');\n          app.UP_CUST_SEGVAL_CODE.setValue();\n          app.START_DATE.setValue(new Date());\n          app.END_DATE.setValue();\n          app.LEDGER_ID.setValue(app.ledgerName.getValue());\n          app.SEG_CODE.setValue(app.segName1.getValue());\n          app.IS_LEAF.setValue('Y');\n        win.show();\n        win.setIconCls('file_add_icon');\n\t\t//窗口每次动态生成,方法在窗口销毁时自动销毁\n\t\twin.mon(win, 'ok', function() {\n  \t\tvar values = Wb.getValue(win);\n            end_date1=app.END_DATE.getValue();\n         if(end_date1===null){\n          end_date1=new Date('12/31/9999');\n           app.END_DATE.setValue(end_date1);\n          }\n         \n  \t\tWb.request({\n    \t url: 'm?xwl=xc/gl/ledger/ld-cust-ass-segvals/ld-cust-ass-segvalsDB/addLd_cust_seg_val',\n    \t params:{\n         'SEG_CODE':app.SEG_CODE.getValue(),'LEDGER_ID':app.LEDGER_ID.getValue(),\n         'LD_CUST_SEGVAL_CODE':app.LD_CUST_SEGVAL_CODE.getValue(),'LD_CUST_SEGVAL_NAME':app.LD_CUST_SEGVAL_NAME.getValue(),\n         'UP_CUST_SEGVAL_ID':'-1','START_DATE':app.START_DATE.getValue(),'END_DATE':app.END_DATE.getValue(),\n           'LD_CUST_SEGVAL_DESC':app.LD_CUST_SEGVAL_DESC.getValue(),'IS_LEAF':'Y','SEGVAL_LEVEL':'1'\n         },\n    \t success: function(resp) {\n             win.close();\n              Wb.toast('增加成功！');       \n             app.tree1.store.load({\n               params:{'seg_code':v_seg_code,'ledger_id':ledger_id}\n               });\n              app.grid1.store.load({param:{'ID':id}});\n         }\n        }\n      );        \n   }); \n          \n}}\n ]});\n     nodemenu.showAt(event.getPoint());\n  }\n  else{\nvar url1;\n\n if(SEG_CODE === 'XC_GL_CUSTOM1'){\n   url1='m?xwl=xc/gl/ledger/ld-cust-ass-segvals/ld-cust-ass-segvalsDB/selectCUSTOM1_IDIfUsed';\n }\n  if(SEG_CODE === 'XC_GL_CUSTOM2'){\n   url1='m?xwl=xc/gl/ledger/ld-cust-ass-segvals/ld-cust-ass-segvalsDB/selectCUSTOM2_IDIfUsed';\n  }\n  if(SEG_CODE === 'XC_GL_CUSTOM3'){\n   url1='m?xwl=xc/gl/ledger/ld-cust-ass-segvals/ld-cust-ass-segvalsDB/selectCUSTOM3_IDIfUsed';\n  }\n  if(SEG_CODE === 'XC_GL_CUSTOM4'){\n   url1='m?xwl=xc/gl/ledger/ld-cust-ass-segvals/ld-cust-ass-segvalsDB/selectCUSTOM4_IDIfUsed'; \n  }\n   \n  Wb.request({\n    url:url1,\n    params:{'ledger_id':LEDGER_ID,'id':id},\n    success:function(resp){\n    var returnobj = Wb.decode(resp.responseText);\n     if(returnobj.rows[0].count!==0){\n     //被引用\n     //菜单\n    nodemenu = new Ext.menu.Menu({\n      items:[\n        {text: '新增同级段值',\n         iconCls: 'file_add_icon',\n         handler:function(){\n        var win = new Ext.window.Window(app._window1);    \n        app.UP_CUST_SEGVAL_ID.setValue(up_id);\n        app.START_DATE.setValue(new Date());\n        app.END_DATE.setValue();\n        app.SEG_CODE.setValue(SEG_CODE);\n        app.LEDGER_ID.setValue(LEDGER_ID);\n        app.SEGVAL_LEVEL.setValue(SEGVAL_LEVEL);\n        app.UP_CUST_SEGVAL_CODE.setValue(UP_CUST_SEGVAL_CODE);\n        app.IS_LEAF.setValue('Y');\n        win.setTitle('新增['+record.get('text')+']同级项目');\n        win.show();\n        win.setIconCls('file_add_icon');\n\t\t//窗口每次动态生成,方法在窗口销毁时自动销毁\n\t\twin.mon(win, 'ok', function() {\n          end_date1=app.END_DATE.getValue();\n         if(end_date1===null){\n          end_date1=new Date('12/31/9999');\n           app.END_DATE.setValue(end_date1);\n          }\n\n         \n  \t\tvar values = Wb.getValue(win);\n          \n  \t\tWb.request({\n    \turl: 'm?xwl=xc/gl/ledger/ld-cust-ass-segvals/ld-cust-ass-segvalsDB/addLd_cust_seg_val',\n    \tparams: values,\n    \tsuccess: function(resp) {\n      \twin.close(); //根据closeAction属性，默认为销毁\n          Wb.toast('增加成功！');\n        app.tree1.store.load({\n               params:{'seg_code':v_seg_code,'ledger_id':ledger_id}\n               });\n       app.grid1.store.load({param:{'ID':id}});\n                               }\n                  });\n                                                 }\n               );\n        }},\n        {text: '修改段值',\n         iconCls: 'file_edit_icon',\n        handler:function(){\n\tvar win = new Ext.window.Window(app._window1); //app._win指向配置对象而非实例\n\twin.show();\n    app.LD_CUST_SEGVAL_CODE.setReadOnly(true);\n\twin.setIconCls('file_edit_icon');\n\tWb.setTitle(win, '修改['+record.get('text')+']');\n\tWb.setValue(win, record.data); //把记录数据应用到窗口\n    app.SEG_CODE.setValue(SEG_CODE);\n    app.LEDGER_ID.setValue(LEDGER_ID);      \n    app.LD_CUST_SEGVAL_NAME.setValue(LD_CUST_SEGVAL_NAME);\n    app.LD_CUST_SEGVAL_CODE.setValue(LD_CUST_SEGVAL_CODE);\n    app.UP_CUST_SEGVAL_ID.setValue(up_id);\n    app.UP_CUST_SEGVAL_CODE.setValue(UP_CUST_SEGVAL_CODE);\n    app.LD_CUST_SEGVAL_DESC.setValue(ld_cust_segval_desc);\n\t//窗口每次动态生成,方法在窗口销毁时自动销毁\n\twin.mon(win, 'ok', function() {\n            end_date1=app.END_DATE.getValue();\n         if(end_date1===null){\n           end_date1=new Date('12/31/9999');\n           end_date1Flag = 'true';\n           app.END_DATE.setValue(end_date1);\n          }\n      if(app.START_DATE.getValue()>app.END_DATE.getValue()){\n          Wb.toast('结束日期要大于开始日期!');\n            return false;\n          }\n      //判断用户是否进行了修改\n    if(ld_cust_segval_desc === app.LD_CUST_SEGVAL_DESC.getValue()&&LD_CUST_SEGVAL_NAME === app.LD_CUST_SEGVAL_NAME.getValue()&&app.START_DATE.getValue()-start_date === 0 && (end_date1Flag === 'true' || (app.END_DATE.getValue() - end_date === 0))){\n       //没有进行修改 \n      win.close();\n    return false;\n     }\n  \tWb.request({\n    url: 'm?xwl=xc/gl/ledger/ld-cust-ass-segvals/ld-cust-ass-segvalsDB/updateLd_cust_seg_val',\n    params: {'LD_CUST_SEGVAL_ID':id,'LD_CUST_SEGVAL_CODE':app.LD_CUST_SEGVAL_CODE.getValue(),'LD_CUST_SEGVAL_NAME':app.LD_CUST_SEGVAL_NAME.getValue(),\n             'START_DATE':app.START_DATE.getValue(),'END_DATE':app.END_DATE.getValue(),\n             'LD_CUST_SEGVAL_DESC':app.LD_CUST_SEGVAL_DESC.getValue()\n             },\n    success: function() {\n      win.close(); //根据closeAction属性，默认为销毁\n      Wb.toast('修改成功！');\n        app.tree1.store.load({\n               params:{'seg_code':v_seg_code,'ledger_id':ledger_id}\n               });\n              app.grid1.store.load({param:{'ID':id}});\n    }\n  });\n});\n\n        }}\n      ]\n    });\n    nodemenu.showAt(event.getPoint());\n\n     }\n      else{\n              //没有被引用\n     //菜单\n    nodemenu = new Ext.menu.Menu({\n      items:[\n        {text: '新增同级段值',\n         iconCls: 'file_add_icon',\n         handler:function(){\n        var win = new Ext.window.Window(app._window1);    \n        app.UP_CUST_SEGVAL_ID.setValue(up_id);\n        app.START_DATE.setValue(new Date());\n        app.END_DATE.setValue();\n        app.SEG_CODE.setValue(SEG_CODE);\n        app.LEDGER_ID.setValue(LEDGER_ID);\n        app.SEGVAL_LEVEL.setValue(SEGVAL_LEVEL);\n        app.UP_CUST_SEGVAL_CODE.setValue(UP_CUST_SEGVAL_CODE);\n        app.IS_LEAF.setValue('Y');\n        win.setTitle('新增['+record.get('text')+']同级项目');\n        win.show();\n        win.setIconCls('file_add_icon');\n\t\t//窗口每次动态生成,方法在窗口销毁时自动销毁\n\t\twin.mon(win, 'ok', function() {\n          end_date1=app.END_DATE.getValue();\n         if(end_date1===null){\n          end_date1=new Date('12/31/9999');\n           app.END_DATE.setValue(end_date1);\n          }\n\n         \n  \t\tvar values = Wb.getValue(win);\n          \n  \t\tWb.request({\n    \turl: 'm?xwl=xc/gl/ledger/ld-cust-ass-segvals/ld-cust-ass-segvalsDB/addLd_cust_seg_val',\n    \tparams: values,\n    \tsuccess: function(resp) {\n      \twin.close(); //根据closeAction属性，默认为销毁\n          Wb.toast('增加成功！');\n        app.tree1.store.load({\n               params:{'seg_code':v_seg_code,'ledger_id':ledger_id}\n               });\n       app.grid1.store.load({param:{'ID':id}});\n                               }\n                  });\n                                                 }\n               );\n        }},\n        {text: '新增下级段值',\n       iconCls: 'file_add_icon',\n       handler:function(){\n        var win = new Ext.window.Window(app._window1);         \n        app.SEG_CODE.setValue(SEG_CODE);\n        app.LEDGER_ID.setValue(LEDGER_ID);\n        app.SEGVAL_LEVEL.setValue(SEGVAL_LEVEL+1);\n        app.UP_CUST_SEGVAL_ID.setValue(id);\n        app.START_DATE.setValue(new Date());\n        app.END_DATE  .setValue();\n        app.IS_LEAF.setValue('Y');\n        app.UP_CUST_SEGVAL_CODE.setValue(LD_CUST_SEGVAL_CODE);\n        win.setTitle('新增['+record.get('text')+']下级项目');\n        win.show();\n        win.setIconCls('file_add_icon');\n\t\t//窗口每次动态生成,方法在窗口销毁时自动销毁\n\t\twin.mon(win, 'ok', function() {\n         end_date1=app.END_DATE.getValue();\n         if(end_date1===null){\n          end_date1=new Date('12/31/9999');\n           app.END_DATE.setValue(end_date1);\n          }\n\n         \n  \t\tvar values = Wb.getValue(win);\n  \t\tWb.request({\n    \t url: 'm?xwl=xc/gl/ledger/ld-cust-ass-segvals/ld-cust-ass-segvalsDB/addLd_cust_seg_val',\n    \t params: values,\n    \t success: function(resp) {\n      \t win.close(); //根据closeAction属性，默认为销毁\n         Wb.request({\n           url:'m?xwl=xc/gl/ledger/ld-cust-ass-segvals/ld-cust-ass-segvalsDB/setIsLeafN',\n           params:{id:id}\n         });\n           Wb.toast('增加成功！');\n        app.tree1.store.load({\n               params:{'seg_code':v_seg_code,'ledger_id':ledger_id}\n               });\n              app.grid1.store.load({param:{'ID':id}});\n    }\n  });\n});\n      }},\n        {text: '修改段值',\n         iconCls: 'file_edit_icon',\n        handler:function(){\n\tvar win = new Ext.window.Window(app._window1); //app._win指向配置对象而非实例\n\twin.show();\n\twin.setIconCls('file_edit_icon');\n\tWb.setTitle(win, '修改['+record.get('text')+']');\n\tWb.setValue(win, record.data); //把记录数据应用到窗口\n    app.SEG_CODE.setValue(SEG_CODE);\n    app.LEDGER_ID.setValue(LEDGER_ID);      \n    app.LD_CUST_SEGVAL_NAME.setValue(LD_CUST_SEGVAL_NAME);\n    app.LD_CUST_SEGVAL_CODE.setValue(LD_CUST_SEGVAL_CODE);\n    app.UP_CUST_SEGVAL_ID.setValue(up_id);\n    app.UP_CUST_SEGVAL_CODE.setValue(UP_CUST_SEGVAL_CODE);\n    app.LD_CUST_SEGVAL_DESC.setValue(ld_cust_segval_desc);\n\t//窗口每次动态生成,方法在窗口销毁时自动销毁\n\twin.mon(win, 'ok', function() {\n            //判断用户是否进行了修改\n    if(LD_CUST_SEGVAL_CODE ===  app.LD_CUST_SEGVAL_CODE.getValue() && ld_cust_segval_desc === app.LD_CUST_SEGVAL_DESC.getValue()&&LD_CUST_SEGVAL_NAME === app.LD_CUST_SEGVAL_NAME.getValue()&&app.START_DATE.getValue()-start_date === 0 && (end_date1Flag === 'true' || (app.END_DATE.getValue() - end_date === 0))){\n       //没有进行修改 \n      win.close();\n    return false;\n     }\n      \n          end_date1=app.END_DATE.getValue();\n         if(end_date1===null){\n           end_date1=new Date('12/31/9999');\n           end_date1Flag = 'true';\n           app.END_DATE.setValue(end_date1);\n          }\n      \n      if(app.START_DATE.getValue()>app.END_DATE.getValue()){\n          Wb.toast('结束日期要大于开始日期!');\n            return false;\n          }\n        //判断用户是否进行了修改\n    if(LD_CUST_SEGVAL_NAME === app.LD_CUST_SEGVAL_NAME.getValue()&&app.START_DATE.getValue()-start_date === 0 && (end_date1Flag === 'true' || (app.END_DATE.getValue() - end_date === 0))){\n       //没有进行修改 \n      win.close();\n    return false;\n     }\n  \tWb.request({\n    url: 'm?xwl=xc/gl/ledger/ld-cust-ass-segvals/ld-cust-ass-segvalsDB/updateLd_cust_seg_val',\n    params: {'LD_CUST_SEGVAL_ID':id,'LD_CUST_SEGVAL_CODE':app.LD_CUST_SEGVAL_CODE.getValue(),'LD_CUST_SEGVAL_NAME':app.LD_CUST_SEGVAL_NAME.getValue(),\n             'START_DATE':app.START_DATE.getValue(),'END_DATE':app.END_DATE.getValue(),\n             'LD_CUST_SEGVAL_DESC':app.LD_CUST_SEGVAL_DESC.getValue()\n             },\n    success: function() {\n      win.close(); //根据closeAction属性，默认为销毁\n      Wb.toast('修改成功！');\n        app.tree1.store.load({\n               params:{'seg_code':v_seg_code,'ledger_id':ledger_id}\n               });\n              app.grid1.store.load({param:{'ID':id}});\n    }\n  });\n});\n\n        }},\n        {text: '删除段值',\n         iconCls:'file_delete_icon',\n         handler:function(){\n           if(leaf === false){\n             Wb.toast('该段值下有子段值,不能删除！');\n           return false;\n           }\n           Wb.confirm('确定删除'+record.get('text')+'吗?',function(){\n              Wb.request({\n          \turl:'m?xwl=xc/gl/ledger/ld-cust-ass-segvals/ld-cust-ass-segvalsDB/deleteLd_cust_seg_val',\n            params:{'LD_CUST_SEGVAL_ID':id},\n            success:function(){\n              if(up_id!=='-1'){\n              Wb.request({\n                url:'m?xwl=xc/gl/ledger/ld-cust-ass-segvals/ld-cust-ass-segvalsDB/setLeafY',\n                params:{id:up_id}\n              });\n              }\n              Wb.toast('删除成功！');\n               app.tree1.store.load({\n               params:{'seg_code':v_seg_code,'ledger_id':ledger_id}\n               });\n              app.grid1.store.load({param:{'ID':id}});\n            } \n          });\n           });\n          \n        }}\n      ]\n    });\n    nodemenu.showAt(event.getPoint());\n       \n        \n      }\n\n    }\n  });\n  }\n}"},"children":[{"configs":{"autoLoad":"false","itemId":"store","url":"m?xwl=xc/gl/ledger/ld-cust-ass-segvals/ld-cust-ass-segvalsDB/selectForTree"},"events":{"load":"app.tree1.getRootNode().expand();","beforeload":"operation.params.parentID=operation.node.get('id');\noperation.params.seg_code = app.segName1.getValue();\noperation.params.ledger_id = app.ledgerName.getValue();\n// store.proxy.extraParams.ledgerId=app.ledgerName.getValue();\n// store.proxy.extraParams.seg_node=app.segName1.getValue();"},"children":[],"expanded":false,"type":"treestore"}],"expanded":true,"type":"tree"},{"configs":{"region":"center","pagingBar":"false","selType":"checkboxmodel","width":"600","itemId":"grid1","editable":"false"},"events":{"itemdblclick":"var url1;\nvar SEG_CODE=app.segName1.getValue();\n if(SEG_CODE === 'XC_GL_CUSTOM1'){\n   url1='m?xwl=xc/gl/ledger/ld-cust-ass-segvals/ld-cust-ass-segvalsDB/selectCUSTOM1_IDIfUsed';\n }\n  if(SEG_CODE === 'XC_GL_CUSTOM2'){\n   url1='m?xwl=xc/gl/ledger/ld-cust-ass-segvals/ld-cust-ass-segvalsDB/selectCUSTOM2_IDIfUsed';\n  }\n  if(SEG_CODE === 'XC_GL_CUSTOM3'){\n   url1='m?xwl=xc/gl/ledger/ld-cust-ass-segvals/ld-cust-ass-segvalsDB/selectCUSTOM3_IDIfUsed';\n  }\n  if(SEG_CODE === 'XC_GL_CUSTOM4'){\n   url1='m?xwl=xc/gl/ledger/ld-cust-ass-segvals/ld-cust-ass-segvalsDB/selectCUSTOM4_IDIfUsed'; \n  }\nvar rows = app.grid1.getSelection();\nvar id = rows[0].data.LD_CUST_SEGVAL_ID;\n //判断是否被引用\n    Wb.request({\n      url:url1,\n      params:{'ledger_id':app.ledgerName.getValue(),'id':id},\n      success:function(resp){\n        var win = new Ext.window.Window(app._window1);\n        var end_date1Flag = 'false';\n        win.setTitle('修改');\n        win.setIconCls('file_edit_icon');\n        win.show();\n      var returnobj = Wb.decode(resp.responseText);\n        if(returnobj.rows[0].count!==0){\n          //被引用\n         app.LD_CUST_SEGVAL_CODE.setReadOnly(true);\n        } \n          app.LEDGER_ID.setValue(app.ledgerName.getValue());\n          app.LD_CUST_SEGVAL_ID.setValue(rows[0].data.LD_CUST_SEGVAL_ID);\n          app.LD_CUST_SEGVAL_CODE.setValue(rows[0].data.LD_CUST_SEGVAL_CODE);\n          app.LD_CUST_SEGVAL_NAME.setValue(rows[0].data.LD_CUST_SEGVAL_NAME);\n          app.START_DATE.setValue(rows[0].data.START_DATE);\n          app.END_DATE.setValue(rows[0].data.END_DATE);\n          app.LD_CUST_SEGVAL_DESC.setValue(rows[0].data.LD_CUST_SEGVAL_DESC);\n          win.mon(win,'ok',function(){\n          var end_date1=app.END_DATE.getValue();\n         if(end_date1===null){\n           end_date1=new Date('12/31/9999');\n           end_date1Flag = 'true';\n           if(rows[0].data.END_DATE!==null){\n           end_date1Flag = 'false';\n           }\n           app.END_DATE.setValue(end_date1);\n          }\n      if(app.START_DATE.getValue()>app.END_DATE.getValue()){\n          Wb.toast('结束日期要大于开始日期!');\n            return false;\n          }\n        //判断用户是否进行了修改\n    if(rows[0].data.LD_CUST_SEGVAL_DESC === app.LD_CUST_SEGVAL_DESC.getValue() && rows[0].data.LD_CUST_SEGVAL_CODE === app.LD_CUST_SEGVAL_CODE.getValue() && rows[0].data.LD_CUST_SEGVAL_NAME === app.LD_CUST_SEGVAL_NAME.getValue()&&app.START_DATE.getValue()-rows[0].data.START_DATE === 0 && (end_date1Flag === 'true' || (app.END_DATE.getValue() -  rows[0].data.END_DATE  === 0))){\n       //没有进行修改 \n      win.close();\n     return false;\n     }\n   Wb.request({\n    url: 'm?xwl=xc/gl/ledger/ld-cust-ass-segvals/ld-cust-ass-segvalsDB/updateLd_cust_seg_val',\n    params: {'LD_CUST_SEGVAL_ID':id,'LD_CUST_SEGVAL_CODE':app.LD_CUST_SEGVAL_CODE.getValue(),'LD_CUST_SEGVAL_NAME':app.LD_CUST_SEGVAL_NAME.getValue(),\n             'START_DATE':app.START_DATE.getValue(),'END_DATE':app.END_DATE.getValue(),\n             'LD_CUST_SEGVAL_DESC':app.LD_CUST_SEGVAL_DESC.getValue()\n             },\n    success: function() {\n      win.close(); //根据closeAction属性，默认为销毁\n      Wb.toast('修改成功！');\n        app.tree1.store.load({\n               params:{'seg_code':app.segName1.getValue(),'ledger_id':app.ledgerName.getValue()}\n               });\n              app.grid1.store.load({param:{'ID':id}});\n    }\n  });\n          });\n      }});\n\n"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/gl/ledger/ld-cust-ass-segvals/ld-cust-ass-segvalsDB/selectLd_cust_seg_val"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"{#allEditBtn#}","itemId":"allEditBtn","iconCls":"check_group_icon"},"events":{"click":"var rows=app.grid1.getSelectionModel().getSelection();\nif(rows.length===0){\n   Wb.toast(\"请选择要修改的信息!\");\n  return false ;\n}\nelse{\n var win=new Ext.window.Window(app._window2);\n  win.show();\n  win.setIconCls('checkgroup_icon');\n  Wb.setTitle(win, '批量修改');\n  win.mon(win,'ok',function(){\n    var date1=app.date1.getValue();\n  if(date1!==null){\n   Wb.request({\n     url:'m?xwl=xc/gl/ledger/ld-cust-ass-segvals/ld-cust-ass-segvalsDB/updateAll',\n     params:{date:date1,datas:Wb.getData(rows)},\n     success:function(){\n       win.hide();\n       app.tree1.store.load();\n       app.grid1.store.load();\n        Wb.toast(\"修改成功！\");\n      Wb.request({\n    url:'m?xwl=xc/common/sync-redis',\n      params:{\n      type:'private',\n        ledgerId:'LEDGER_ID',\n        segCode:'xc_gl_ld_cust_ass_segvals'\n      }\n    });\n     }\n   });\n  }\n    else{\n    win.hide();\n    }\n  });\n}\n"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#saveBtn#}","hidden":"true","itemId":"saveBtn","iconCls":"save_icon"},"events":{"click":"if (!Wb.verifyGrid(app.grid1)){ \n  //验证数据是否合法\n  return flase;\n}\nvar modify = app.grid1.store.getModifiedRecords();\n if(modify.length===0){\n   return false;\n  }\n  Wb.request({ \n  url: 'm?xwl=xc/gl/ledger/ld-cust-ass-segvals/ld-cust-ass-segvalsDB/saveLd_cust_seg_val',\n  params:{'infoArray':Wb.encode(Wb.getData(modify))},\n  message: '正在保存中...',\n  success: function(resp) {\n        //ID_FIELD值在后台生成，把返回的ID_FIELD值列表同步到表格中\n    Wb.syncCreate(app.grid1, Wb.decode(resp.responseText));\n    Wb.toast('保存成功！');\n      app.tree1.store.load();\n        //数据缓存\n    Wb.request({\n       url:'m?xwl=xc/common/sync-redis',\n      params:{\n      type:'private',\n        ledgerId:'LEDGER_ID',\n        segCode:'xc_gl_ld_cust_ass_segvals'\n      }\n    });\n  \n\n  }\n});"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#importBtn#}","itemId":"importBtn","iconCls":"import_icon"},"events":{"click":"//获取要导入辅助段的段编码以及账簿ID\nvar importLedgerId = '{#ledger_id#}';\nvar importSegCode =  '{#seg_code#}';\nif(Ext.isEmpty(importLedgerId)){\n  Wb.info('获取账簿信息失败，请重新打开页面！');\n  return;\n}\nif(Ext.isEmpty(importSegCode)){\n  Wb.info('获取段值信息失败，请重新打开页面！');\n  return;\n}\nvar win = new Ext.window.Window(app._importDataWin);\nwin.setTitle('导入现金流项目数据');\nwin.show();"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#exportBtn#}","itemId":"exportBtn","iconCls":"export_icon"},"events":{"click":"window.location.href = '{#contextPath#}/glDataTransgerManageAction.do?method=exportBaseDataByModel&templateCode=XC_GL_LD_CUST_ASS_SEGVALS&ledgerId='+ledger_id1+'&segCode='+seg_code1;"},"children":[],"expanded":false,"type":"item"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#rownumber#}","align":"center","xtype":"rownumberer","width":"50","itemId":"rownumber"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"自定义段值ID","hidden":"true","dataIndex":"LD_CUST_SEGVAL_ID","itemId":"LD_CUST_SEGVAL_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"账簿ID","hidden":"true","dataIndex":"LEDGER_ID","itemId":"LEDGER_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"辅助段编码","hidden":"true","dataIndex":"SEG_CODE_COL","itemId":"SEG_CODE"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#LD_CUST_SEGVAL_CODE_COL#}","align":"left","dataIndex":"LD_CUST_SEGVAL_CODE","titleAlign":"center","itemId":"LD_CUST_SEGVAL_CODE_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#LD_CUST_SEGVAL_NAME_COL#}","align":"left","dataIndex":"LD_CUST_SEGVAL_NAME","titleAlign":"center","itemId":"LD_CUST_SEGVAL_NAME_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"上级id","hidden":"true","dataIndex":"UP_CUST_SEGVAL_ID","itemId":"UP_CUST_SEGVAL_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"上级编码","hidden":"true","align":"left","dataIndex":"UP_CUST_SEGVAL_CODE","titleAlign":"center","itemId":"UP_CUST_SEGVAL_CODE_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#START_DATE#}","width":"80","align":"left","dataIndex":"START_DATE","titleAlign":"center","itemId":"START_DATE_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#END_DATE#}","style":"Y-m-d","width":"80","align":"left","dataIndex":"END_DATE","format":"Y-m-d","titleAlign":"center","itemId":"END_DATE_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#LD_CUST_SEGVAL_DESC_COL#}","width":"300","align":"left","dataIndex":"LD_CUST_SEGVAL_DESC","titleAlign":"center","itemId":"LD_CUST_SEGVAL_DESC_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"是否是叶子节点","hidden":"true","dataIndex":"IS_LEAF","itemId":"IS_LEAF"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"级别","hidden":"true","dataIndex":"SEGVAL_LEVEL","itemId":"SEGVAL_LEVEL_COL"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}