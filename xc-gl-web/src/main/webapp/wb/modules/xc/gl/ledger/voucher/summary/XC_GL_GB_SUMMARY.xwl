{"inframe":false,"title":"摘要","hidden":false,"roles":{"default":1},"children":[{"configs":{"title":"凭证摘要枚举信息管理","loginRequired":"false","jsLinks":"[\"platform/util/platformUtil.js\",\"XCloud/js/createAssKey.js\"]","serverScript":"//---------------------获取当前模块语言对应的.json文件，放到request中----------------\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xc/gl/ledger/voucher/summary/XC_GL_GB_SUMMARY\");\n","itemId":"module"},"children":[{"configs":{"layout":"border","itemId":"viewport1"},"children":[{"configs":{"region":"north","border":"false","itemId":"form1"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"column","padding":"10","border":"false","itemId":"panel1"},"children":[{"configs":{"labelWidth":"80","displayField":"LEDGER_NAME","width":"400","valueField":"LEDGER_ID","labelAlign":"right","itemId":"LEDGER_CODE","fieldLabel":"{#LEDGER_CODE#}"},"events":{"change":"app.queryBtn.fireEvent('click');"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/com-qry/gl-ledgers/select-sec-fd-ledgers"},"events":{"load":"if(store.getCount() === 1){\n  Wb.setValue(app.LEDGER_CODE, {'LEDGER_CODE':records[0].data.LEDGER_ID}) ;\n}"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"},{"configs":{"text":"{#queryBtn#}","hidden":"true","width":"70","margin":"0 0 0 10","itemId":"queryBtn","iconCls":"seek_icon"},"events":{"click":"//alert(app.LEDGER_CODE.getValue());\napp.grid1.store.load({\n  params : {\n\tledger_code : app.LEDGER_CODE.getValue()\n}});"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"form"},{"configs":{"region":"center","selType":"checkboxmodel","itemId":"grid1","editable":"true"},"children":[{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"{#addBtn#}","itemId":"addBtn","iconCls":"file_add_icon"},"events":{"click":"Wb.addEdit(app.grid1,[{'LEDGER_ID':app.LEDGER_CODE.getValue()}]);"},"children":[],"expanded":true,"type":"button"},{"configs":{"text":"{#delBtn#}","itemId":"delBtn","iconCls":"file_delete_icon"},"events":{"click":"\nvar recs = app.grid1.getSelection();\n\nif (!recs.length) {\n  Wb.toast('请选择需要删除的记录。');\n  return;\n}\n\nWb.confirm('确定要删除选择的 ' + recs.length + ' 条记录吗？', function() {\n  Wb.request({\n    url: 'm?xwl=xc/gl/ledger/voucher/summary/summary-db/delete-summary', //使用basic-delete.xwl用于演示目的，建议使用delete.xwl\n    params: Wb.apply({\n      destroy: Wb.getData(recs)\n    }),\n    success: function() {\n      Wb.remove(app.grid1, recs);\n      Wb.toast('删除成功！');\n      return false;\n    }\n  });\n});\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#syncBtn#}","hidden":"true","itemId":"syncBtn","iconCls":"view_icon"},"events":{"click":"LEDGER_ID = app.LEDGER_CODE.getValue();\n//alert(LEDGER_ID);\nif(LEDGER_ID === null){\n\tWb.toast('请选择账簿！');\n\treturn;\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#saveBtn#}","itemId":"saveBtn","iconCls":"save_icon"},"events":{"click":"if (!Wb.verifyGrid(app.grid1)) //验证数据是否合法\n  return;\nvar modify = app.grid1.store.getModifiedRecords();\nif(modify.length===0){\nreturn false;\n}\n //rec.ASS_KEY=getAssKey(rec.V_SUMMARY);\nvar r = app.grid1.getSelectionModel().getSelection() ;\nvar _summary = r[0].data.V_SUMMARY ;\n var _assKey = getAssKey(_summary);\n\nvar ledger_name = app.LEDGER_CODE.getRawValue();\nvar ledger_id = app.LEDGER_CODE.getValue();\n\nif(ledger_id === null){\n  Wb.toast('请选择账簿！');\n\treturn ;\n}\nWb.sync({\n  grid: app.grid1,\n//  params:{'ledger_id':ledger_id,'asskey':_assKey,'summary':_summary},\n  url: 'm?xwl=xc/gl/ledger/voucher/summary/summary-db/sava-summary',\n  message: '正在保存中...',\n  success: function(resp) {\n    var returnobj = Wb.decode(resp.responseText);\n      //把后台返回的KEY_ID和USER_ID同步更新到表格\n    Wb.syncCreate(app.grid1, Wb.decode(resp.responseText));\n      Wb.toast('保存成功！');\n     return false;\n \n  }\n});"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"store","url":"m?xwl=xc/gl/ledger/voucher/summary/summary-db/select-summary"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#ROW_NUMBER_COL#}","align":"center","width":"50","xtype":"rownumberer","itemId":"ROW_NUMBER_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#V_SUMMARY_ID_COL#}","hidden":"true","dataIndex":"V_SUMMARY_ID","itemId":"V_SUMMARY_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#LEDGER_ID_COL#}","hidden":"true","dataIndex":"LEDGER_ID","itemId":"LEDGER_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#LEDGER_NAME_COL#}","hidden":"true","align":"left","width":"250","dataIndex":"LEDGER_NAME","titleAlign":"center","itemId":"LEDGER_NAME_COL"},"children":[{"configs":{"displayField":"LEDGER_NAME","valueField":"LEDGER_ID","itemId":"editor"},"events":{"select":"var id = combo.getValue() ;\nvar name = combo.getRawValue() ;\n\nvar r = app.grid1.getSelectionModel().getSelection();\nr[0].set('LEDGER_ID',id) ;\ncombo.setValue(name);\n"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/gl/ledger/voucher/summary/summary-db/select-ledger"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"}],"expanded":false,"type":"column"},{"configs":{"text":"{#V_SUMMARY_COL#}","align":"left","width":"600","dataIndex":"V_SUMMARY","titleAlign":"center","itemId":"V_SUMMARY_COL"},"children":[{"configs":{"itemId":"editor"},"events":{"change":"var x = app.grid1.getSelection()[0];\nx.set('ASS_KEY',getAssKey(newValue));"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"column"},{"configs":{"text":"{#ASS_KEY_COL#}","hidden":"true","dataIndex":"ASS_KEY","itemId":"ASS_KEY_COL"},"children":[],"expanded":true,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}