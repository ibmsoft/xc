{"inframe":false,"title":"","hidden":false,"roles":{"default":1},"children":[{"configs":{"loginRequired":"false","serverScript":"//---------------------获取当前模块语言对应的.json文件，放到request中----------------\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xc/gl/ledger/ld-segval-enabled/XC_GL_LD_SEGVAL_ENABLED\");\n\nvar _ledger_id = request.getParameter('ledger_id');\nvar _seg_code = request.getParameter('seg_code');\n\nrequest.setAttribute('_ledger_id',_ledger_id);\nrequest.setAttribute('_seg_code',_seg_code);","itemId":"module"},"events":{"finalize":"var segs = ['XC_AP_VENDORS','XC_AR_CUSTOMERS','XC_GL_PRODUCTS','XIP_PUB_ORGS','XIP_PUB_DEPTS','XIP_PUB_EMPS'];\nvar seg_ids = ['VENDOR_ID','CUSTOMER_ID','PRODUCT_ID','ORG_ID','DEPT_ID','EMP_ID'];\nvar ld_segs = ['XC_GL_LD_VENDORS','XC_GL_LD_CUSTOMERS','XC_GL_LD_PRODUCTS','XC_GL_LD_ORGS','XC_GL_LD_DEPTS','XC_GL_LD_EMPS'];\nvar ld_seg_ids = ['LD_VENDOR_ID','LD_CUSTOMER_ID','LD_PRODUCT_ID','LD_ORG_ID','LD_DEPT_ID','LD_EMP_ID'];\nvar seg_codes = ['VENDOR_CODE','CUSTOMER_CODE','PRODUCT_CODE','ORG_CODE','DEPT_CODE','EMP_CODE'];\nvar seg_names = ['VENDOR_NAME','CUSTOMER_NAME','PRODUCT_NAME','ORG_NAME','DEPT_NAME','EMP_NAME'];\nvar ledger_id;//获取账簿ID\nvar seg;//获取辅助短编码\nvar seg_id;//辅助段列名\nvar ld_seg;//段值启用表名\nvar ld_seg_id;//段值启用表列名\nvar seg_code;//编码\nvar seg_name;//名称\nvar _index;//索引\nvar org_id;//组织ID\n","initialize":"Ext.apply(app,{\n  initViewport:function(params){\n    ledger_id =  '{#_ledger_id#}';\n    seg = '{#_seg_code#}';\n    app.combo1.setValue(ledger_id);\n    app.combo1.readOnly = true;\n    app.combo2.setValue(seg);\n    //获取组织ID、给全局遍历赋值\n    Wb.request({\n      async:false,\n      url:'m?xwl=xc/gl/ledger/ld-segval-enabled/DB/select_org_id',\n      params:{LEDGER_ID:ledger_id},\n      success:function(resp){\n        var obj = Wb.decode(resp.responseText);\n        if(obj.total>0){\n          org_id = obj.rows[0].ORG_ID;\n        }else{\n          Wb.warn('该账簿下没有组织');\n        }\n      }\n    });\n    for(var k=0;k<segs.length;k++){\n      if(seg==segs[k]){\n        seg_id = seg_ids[k];\n        ld_seg = ld_segs[k];\n        ld_seg_id = ld_seg_ids[k];\n        seg_code = seg_codes[k];\n        seg_name = seg_names[k];\n      }\n    }\n    app.combo2.getStore().load();\n    app.queryBtn.fireEvent('click');\n    \n    //是否可以使用同步和删除按钮\n    if(seg == 'XC_AP_VENDORS'){\n      Wb.request({\n        url:'m?xwl=xc/gl/ledger/ld-segval-enabled/DB/validate-apPeriodCode',\n        params:{ledger_id:ledger_id},\n        success:function(resp){\n          var obj = Wb.decode(resp.responseText);\n          if(obj.total>0){\n            app.button1.setDisabled(true);\n            app.delBtn.setDisabled(true);\n          }else{\n            app.button1.setDisabled(false);\n            app.delBtn.setDisabled(false);\n          }\n        }\n      });\n    }\n  }\n});"},"children":[{"configs":{"itemId":"store"},"children":[{"configs":{"autoLoad":"true","itemId":"ledger_store","url":"m?xwl=xc/com-qry/gl-ledgers/select-sec-fd-ledgers"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"seg_store","url":"m?xwl=xc/gl/ledger/ld-segval-enabled/DB/select_ass_segments"},"events":{"load":"var ledger_id = app.combo1.getValue();\nif(ledger_id!==null&&ledger_id!==''){\n  if(records.length === 0){\n    Wb.info('该账簿没有启用的辅助段');\n  }\n}","beforeload":"store.proxy.extraParams.ledger_id = app.combo1.getValue();"},"children":[],"expanded":false,"type":"store"}],"expanded":false,"type":"folder"},{"configs":{"height":"450","width":"600","layout":"fit","buttonAlign":"center","dialog":"true","itemId":"win"},"children":[{"configs":{"selType":"checkboxmodel","itemId":"grid2"},"children":[{"configs":{"pageSize":"-1","itemId":"store","url":"m?xwl=xc/gl/ledger/ld-segval-enabled/DB/select_notExist"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"emptyText":"{#condition_et#}","itemId":"text2"},"events":{"specialkey":"if(e.getKey()==13){\n  app.queryBtn2.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"},{"configs":{"text":"查询","hidden":"true","itemId":"queryBtn2","iconCls":"seek_icon"},"events":{"click":"//加载数据\napp.grid2.getStore().load({\n  params:{seg:seg,//XC_AP_VENDORS\n          seg_id:seg_id,//VENDOR_ID\n          ld_seg:ld_seg,//XC_GL_LD_VENDORS\n          ledger_id:ledger_id,//账簿ID\n          seg_code:seg_code,//VENDOR_CODE\n          seg_name:seg_name,//VENDOR_NAME\n          org_id:org_id,//组织ID\n          codeOrName:Ext.String.escape(app.text2.getValue() )\n         }\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"重置","hidden":"true","itemId":"resetBtn","iconCls":"refresh_icon"},"events":{"click":"app.text2.setValue();\napp.queryBtn2.fireEvent('click');"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"ID","hidden":"true","dataIndex":"seg_id","titleAlign":"center","itemId":"VAL_ID_COL_1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#VAL_CODE_COL#}","width":"150","dataIndex":"seg_code","titleAlign":"center","itemId":"VAL_CODE_COL_1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#VAL_NAME_COL#}","dataIndex":"seg_name","titleAlign":"center","itemId":"VAL_NAME_COL_1","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"window"},{"configs":{"layout":"border","itemId":"viewport1"},"children":[{"configs":{"region":"north","itemId":"form1"},"children":[{"configs":{"layout":"column","padding":"10 10 10 10","border":"false","itemId":"panel1"},"children":[{"configs":{"labelWidth":"60","store":"app.ledger_store","displayField":"LEDGER_NAME","valueField":"LEDGER_ID","labelAlign":"right","itemId":"combo1","fieldLabel":"{#Ledger#}","editable":"false"},"events":{"select":"org_id = records[0].get('ORG_ID');//账簿的组织\napp.combo2.setReadOnly(false);\napp.combo2.clearValue();\n\n\n"},"children":[],"expanded":true,"type":"combo"},{"configs":{"labelWidth":"80","readOnly":"true","store":"app.seg_store","displayField":"SEG_NAME","valueField":"SEG_CODE","labelAlign":"right","itemId":"combo2","fieldLabel":"{#Segments#}","editable":"false"},"events":{"beforequery":"\n","select":"ledger_id = app.combo1.getValue();//获取账簿ID\nseg = app.combo2.getValue();//获取辅助短编码\nfor(var i=0;i<segs.length;i++){\n  if(seg==segs[i]){\n    seg_id = seg_ids[i];\n    ld_seg = ld_segs[i];\n    ld_seg_id = ld_seg_ids[i];\n    seg_code = seg_codes[i];\n    seg_name = seg_names[i];\n  }\n}\napp.queryBtn.fireEvent('click');\n/*\napp.grid1.store.load({\n  params:{ld_seg_id:ld_seg_id,\n          seg_id:seg_id,\n          ld_seg:ld_seg,\n          seg_code:seg_code,\n          seg_name:seg_name,\n          seg:seg,\n          ledger_id:ledger_id\n         }\n});\n*/"},"children":[],"expanded":true,"type":"combo"},{"configs":{"labelWidth":"100","labelAlign":"right","itemId":"text1","fieldLabel":"{#condition#}","x":"200"},"events":{"specialkey":"if(e.getKey()===13){app.queryBtn.fireEvent('click');}"},"children":[],"expanded":false,"type":"text"},{"configs":{"text":"{#queryBtn#}","itemId":"queryBtn","iconCls":"seek_icon","x":"30"},"events":{"click":"if(app.combo1.getValue()===null){\n  Wb.toast('请选择账簿');\n  return;\n}else if(app.combo2.getValue()===null){\n  Wb.toast('请选择辅助段');\n  return;\n}\napp.grid1.store.load({\n  params:{ld_seg_id:ld_seg_id,seg_id:seg_id,ld_seg:ld_seg,seg_code:seg_code,seg_name:seg_name,seg:seg,ledger_id:ledger_id,queryVar:Ext.String.escape(app.text1.getValue())}\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#resetBtn#}","itemId":"resetBtn","iconCls":"refresh_icon","x":"50"},"events":{"click":"app.combo1.reset();\napp.combo2.reset();\napp.text1.reset();\napp.grid1.store.removeAll();\n//app.queryBtn.fireEvent('click');"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"panel"}],"expanded":false,"type":"form"},{"configs":{"region":"center","selType":"checkboxmodel","itemId":"grid1"},"events":{"tagEvents":"{\n  itemmouseenter:function(view, record, item, index, e, options){\n    _index = index;\n  }\n}"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/gl/ledger/ld-segval-enabled/DB/select"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"{#syncBtn#}","itemId":"button1","iconCls":"record_copy_icon"},"events":{"click":"if(app.combo1.getValue()===null){\n  Wb.toast('请选择账簿');return;\n}else if(app.combo2.getValue()===null){\n  Wb.toast('请选择辅助段');return;\n}\n\nvar win = new Ext.window.Window(app._win); //app._win指向配置对象而非实例\nwin.show();\nwin.setIconCls('record_copy_icon');\nWb.setTitle(win, '同步');\n//加载数据\napp.grid2.getStore().load({\n  params:{seg:seg,//XC_AP_VENDORS\n          seg_id:seg_id,//VENDOR_ID\n          ld_seg:ld_seg,//XC_GL_LD_VENDORS\n          ledger_id:ledger_id,//账簿ID\n          seg_code:seg_code,//VENDOR_CODE\n          seg_name:seg_name,//VENDOR_NAME\n          org_id:org_id//组织ID\n         }\n});\n//添加监听函数\nwin.mon(win, 'ok', function() {\n  var recs = app.grid2.getSelection();\n  var dataArray = [];\n  for(var i=0;i<recs.length;i++){\n    dataArray.push(recs[i].data);\n  }\n  //插入数据\n  Wb.request({\n    url:'m?xwl=xc/gl/ledger/ld-segval-enabled/DB/insert',\n    params:{ld_seg:ld_seg,seg_id:seg_id,ledger_id:ledger_id,dataArray:dataArray,ld_seg_id:ld_seg_id},\n    success:function(resp){\n      //重新加载\n      app.grid1.store.load({\n        params:{ld_seg_id:ld_seg_id,seg_id:seg_id,ld_seg:ld_seg,seg_code:seg_code,seg_name:seg_name,seg:seg,ledger_id:ledger_id}\n      });\n      //关闭窗口\n      win.close();\n    }\n  });\n});\n"},"children":[],"expanded":true,"type":"button"},{"configs":{"text":"{#delBtn#}","itemId":"delBtn","iconCls":"file_delete_icon"},"events":{"click":"var recs = app.grid1.getSelection();\nif(recs.length<1){\n  Wb.warn('请选择要删除的记录');\n}\nvar flag = false;//是否有不能删除的记录\nvar ids = [];//运行删除的记录\nfor(var i=0;i<recs.length;i++){\n  //判断记录是否启用\n  if(recs[i].data.IS_ENABLED == 0){\n    var id = {id:recs[i].data.LD_SEG_ID};\n    ids.push(id);\n  }else{\n    flag = true;\n  }\n}\n\n\n//删除数据\nWb.confirm('是否删除所选中的记录',function(){\n  Wb.request({\n    url:'m?xwl=xc/gl/ledger/ld-segval-enabled/DB/deleteRecords',\n    params:{ld_seg:ld_seg,ld_seg_id:ld_seg_id,ids:ids},\n    success:function(resp){\n      app.queryBtn.fireEvent('click');\n      if(flag){Wb.warn('已启用的记录不可删除');}\n    }\n  });\n});\n"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#rownum#}","width":"50","align":"center","xtype":"rownumberer","titleAlign":"center","itemId":"rownum"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"主键","hidden":"true","dataIndex":"LD_SEG_ID","titleAlign":"center","itemId":"LD_SEG_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"账簿ID","hidden":"true","dataIndex":"LEDGER_ID","titleAlign":"center","itemId":"LEDGER_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"账簿名称","hidden":"true","dataIndex":"LEDGER_NAME","titleAlign":"center","itemId":"LEDGER_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"段编码","hidden":"true","dataIndex":"SEG_CODE","titleAlign":"center","itemId":"SEG_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"段名称","hidden":"true","dataIndex":"SEG_NAME","titleAlign":"center","itemId":"SEG_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"段别名","hidden":"true","dataIndex":"LD_SEG_ALIAS","titleAlign":"center","itemId":"LD_SEG_ALIAS_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"值ID","hidden":"true","dataIndex":"VAL_ID","titleAlign":"center","itemId":"VAL_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#VAL_CODE_COL#}","dataIndex":"VAL_CODE","titleAlign":"center","itemId":"VAL_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#VAL_NAME_COL#}","width":"200","dataIndex":"VAL_NAME","titleAlign":"center","itemId":"VAL_NAME_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#IS_ENABLED_COL#}","xtype":"checkcolumn","dataIndex":"IS_ENABLED","titleAlign":"center","itemId":"IS_ENABLED_COL"},"events":{"checkchange":"\napp.grid1.getSelectionModel().select(_index);\nvar rec = app.grid1.getSelection()[0];\nvar is_enabled_val = rec.data.IS_ENABLED;\nvar ld_seg_id_val = rec.data.LD_SEG_ID;\nWb.request({\n  url:'m?xwl=xc/gl/ledger/ld-segval-enabled/DB/update_save',\n  params:{ld_seg:ld_seg,\n          ld_seg_id:ld_seg_id,\n          ld_seg_id_val:ld_seg_id_val,\n          is_enabled_val:is_enabled_val},\n  message:'保存中......',\n  success:function(resp){\n    app.grid1.store.load({\n      params:{ld_seg_id:ld_seg_id,seg_id:seg_id,ld_seg:ld_seg,seg_code:seg_code,seg_name:seg_name,seg:seg,ledger_id:ledger_id}\n    });\n  }\n});\n"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":false,"type":"grid"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}