{"inframe":false,"title":"","hidden":false,"roles":{"default":1},"children":[{"configs":{"serverScript":"//---------------------获取当前模块语言对应的.json文件，放到request中----------------\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xc/gl/ledger/ld-pr-modes/XC_GL_LD_PR_MODE\");\n","itemId":"module"},"events":{"initialize":"var pay_array = [];\nvar rec_array = [];"},"children":[{"configs":{"itemId":"folder1"},"children":[{"configs":{"autoLoad":"true","itemId":"payrecstore","url":"m?xwl=xc/gl/ledger/ld-pr-modes/ld-pr-modesDB/select-ld-accounts"},"events":{"beforeload":"store.proxy.extraParams.ledger_id = app.ledger.getValue();"},"children":[],"expanded":false,"type":"store"}],"expanded":false,"type":"folder"},{"configs":{"itemId":"editor"},"children":[{"configs":{"itemId":"PAY_ACC_NAME_EDITOR","createInstance":"false"},"events":{"collapse":"\napp.querytext.setValue();\napp.queryBtn.fireEvent('click');\napp.saveBtn.fireEvent('click');"},"children":[{"configs":{"tagConfigs":"minWidth:400","height":"300","store":"app.payrecstore","barExportButtons":"false","barExportAllButtons":"false","barRefreshButton":"false","itemId":"pickComp"},"events":{"itemclick":"var picker = this.ownerCmp;\npicker.setValue(record.data.ACC_NAME);\nvar rows = app.grid1.getSelection()[0];\nrows.set('PAY_ACC_ID',record.data.ACC_ID);\npicker.collapse();\n\n\n","itemdblclick":"\n"},"children":[{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"序号","hidden":"true","xtype":"rownumberer","align":"center","width":"50","itemId":"rownumber"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"ACC_ID","itemId":"id"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"科目编码","width":"100","dataIndex":"ACC_CODE","titleAlign":"center","itemId":"code"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"科目名称","width":"230","dataIndex":"ACC_NAME","titleAlign":"center","itemId":"name"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"emptyText":"输入名称或编码进行查询","itemId":"querytext"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\napp.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"},{"configs":{"text":"查询","itemId":"queryBtn","iconCls":"seek_icon"},"events":{"click":"app.payrecstore.load({\nparams:{\ncodeorname:app.querytext.getValue()\n}\n});\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"清空","itemId":"cancelBtn","iconCls":"cancel_icon"},"events":{"click":"app.grid1.getSelection()[0].set('PAY_ACC_ID','');\napp.grid1.getSelection()[0].set('PAY_ACC_NAME','');\napp.PAY_ACC_NAME_EDITOR.setValue();\napp.PAY_ACC_NAME_EDITOR.getPicker().setVisible(false);\n"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"},{"configs":{"itemId":"REC_ACC_NAME_EDITOR","createInstance":"false"},"events":{"collapse":"app.querytext1.reset();\napp.queryBtn1.fireEvent('click');\napp.saveBtn.fireEvent('click');"},"children":[{"configs":{"tagConfigs":"minWidth:400","height":"300","store":"app.payrecstore","barExportButtons":"false","barExportAllButtons":"false","barRefreshButton":"false","itemId":"pickComp"},"events":{"itemclick":"var picker = this.ownerCmp;\npicker.setValue(record.data.ACC_NAME);\nvar rows = app.grid1.getSelection()[0];\nrows.set('REC_ACC_ID',record.data.ACC_ID);\npicker.collapse();\n\n"},"children":[{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","itemId":"rownumber"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"ACC_ID","itemId":"id"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"科目编码","width":"100","align":"left","dataIndex":"ACC_CODE","titleAlign":"center","itemId":"code"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"科目名称","width":"230","align":"left","dataIndex":"ACC_NAME","titleAlign":"center","itemId":"name"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"emptyText":"输入名称或编码进行查询","itemId":"querytext1"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\napp.queryBtn1.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"},{"configs":{"text":"查询","itemId":"queryBtn1","iconCls":"seek_icon"},"events":{"click":"app.payrecstore.load({\nparams:{\ncodeorname:app.querytext1.getValue()\n}\n});\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"清空","itemId":"cancelBtn1","iconCls":"cancel_icon"},"events":{"click":"app.grid1.getSelection()[0].set('REC_ACC_ID','');\napp.grid1.getSelection()[0].set('REC_ACC_NAME','');\napp.REC_ACC_NAME_EDITOR.setValue();\napp.REC_ACC_NAME_EDITOR.getPicker().setVisible(false);"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":false,"type":"folder"},{"configs":{"layout":"border","itemId":"viewport1"},"children":[{"configs":{"title":"收付款方式分配","height":"400","layout":"fit","width":"560","closeAction":"hide","dialog":"true","itemId":"window1","modal":"true"},"events":{"ok":"var rows = app.addGrid.getSelection() ;\nif(app.addGrid.store.getCount()===0){\n        app.window1.close();\n       return false;\n}\nif(rows.length === 0){\n  Wb.toast(\"请选择收付款方式!\") ;\n  return false ;\n}else{\n  var paramArray = [] ;\n  Wb.each(rows, function(r){\n      var modeID = r.get('MODE_ID') ;\n      var paramJson = {'MODE_ID':modeID} ;\n      paramArray.push(paramJson) ;\n  }) ;\n  \n  // 提交请求\n  Wb.request({\n    url: 'm?xwl=xc/gl/ledger/ld-pr-modes/ld-pr-modesDB/insert-ld-pr-modes',\n    timeout:3600000,\n    params: {'idArray':Wb.encode(paramArray),'ledgerId':app.ledger.getValue()},\n    success: function(resp) {\n      var response = Wb.decode(resp.responseText) ;\n      if(response.flag === \"0\"){\n        app.grid1.store.load();\n        Wb.toast(\"分配成功!\") ;\n        app.window1.close();\n        return false;\n      }else{\n        Wb.toast(\"分配失败!\") ;\n      }\n    }\n  }); \n}\n"},"children":[{"configs":{"pagingBar":"false","multiSelect":"true","selType":"checkboxmodel","itemId":"addGrid","simpleSelect":"true"},"children":[{"configs":{"pageSize":"-1","autoLoad":"true","itemId":"store","url":"m?xwl=xc/gl/ledger/ld-pr-modes/ld-pr-modesDB/select-q-pr-modes"},"events":{"beforeload":"store.proxy.extraParams.ledger = app.ledger.getValue();"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#rownum#}","align":"center","width":"50","xtype":"rownumberer","itemId":"rownum"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"收付款方式ID","hidden":"true","dataIndex":"MODE_ID","titleAlign":"center","itemId":"MODE_ID"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#MODE_TYPE#}","width":"160","dataIndex":"MODE_TYPE","titleAlign":"center","itemId":"MODE_TYPE","renderer":"if(value == 'cash'){\n  return '现金' ;\n}else if(value == 'bank'){\n  return '银行' ;\n}else if(value == 'check'){\n  return '支票' ;\n}else if(value == 'other'){\n  return '其他' ;\n}else{\n  return value ;\n}"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#MODE_NAME#}","width":"200","dataIndex":"MODE_NAME","titleAlign":"center","itemId":"MODE_NAME"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#MODE_DESC#}","hidden":"true","width":"180","dataIndex":"MODE_DESC","titleAlign":"center","itemId":"MODE_DESC"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"window"},{"configs":{"region":"north","frame":"false","border":"false","itemId":"form1"},"children":[{"configs":{"tagConfigs":"baseCls :'my-panel-no-border'","padding":"10","border":"false","itemId":"panel1"},"children":[{"configs":{"labelWidth":"100","displayField":"NAME","width":"400","valueField":"ID","margin":"10 0 0 0","labelAlign":"right","itemId":"ledger","fieldLabel":"{#ledger#}"},"events":{"change":"app.payrecstore.load({\n\tparmas:{\n\t\tledger_id:app.ledger.getValue()\n\t}\n});\napp.grid1.store.load({\n\tparams:{\n\t\tledger_id:app.ledger.getValue()\n\t}\n});\n"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/com-qry/gl-ledgers/select-sec-ledger"},"events":{"load":"if(store.getCount() === 1){\n  Wb.setValue(app.ledger, {'ledger':records[0].data.ID}) ;\n}"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"}],"expanded":true,"type":"panel"}],"expanded":false,"type":"form"},{"configs":{"region":"center","multiSelect":"true","selType":"checkboxmodel","itemId":"grid1","editable":"true"},"children":[{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"{#addBtn#}","itemId":"addBtn","iconCls":"record_copy_icon"},"events":{"click":"if(Ext.isEmpty(app.ledger.getValue())){\n  \n  Wb.toast(\"请选择账簿\");\n  return false;\n}else{\n  app.addGrid.store.load({\n  params:{\n  ledger:app.ledger.getValue()\n  }\n  });\n  app.window1.show();\t\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#deleteBtn#}","itemId":"deleteBtn","iconCls":"file_delete_icon"},"events":{"click":"var rows = app.grid1.getSelection() ;\n\nif(rows.length === 0){\n  Wb.toast(\"请选择你要删除的记录!\") ;\n  return false ;\n}else{\n  Wb.confirm('您确定要删除所选的记录吗？',function(){\n   var paramArray = [] ;\n  Wb.each(rows, function(r){\n      var ldModeId = r.get('LD_MODE_ID') ;\n      var paramJson = {'LD_MODE_ID':ldModeId} ;\n      paramArray.push(paramJson) ;\n  }) ;\n  \n  // 提交请求\n  Wb.request({\n    url: 'm?xwl=xc/gl/ledger/ld-pr-modes/ld-pr-modesDB/delete-ld-pr-modes',\n    timeout:3600000,\n    params: {'idArray':Wb.encode(paramArray),'ledgerId':app.ledger.getValue()},\n    success: function(resp) {\n      var response = Wb.decode(resp.responseText) ;\n      if(response.flag === \"0\"){\n        app.grid1.store.load();\n        Wb.toast(\"删除成功!\") ;\n      }else{\n        Wb.toast(\"删除失败!\") ;\n      }\n    }\n  }); \n  });\n \n}\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#saveBtn#}","hidden":"true","itemId":"saveBtn","iconCls":"save_icon"},"events":{"click":"\nvar modify = app.grid1.store.getModifiedRecords();\nif(modify.length===0){\nreturn false;\n}\nWb.request({\n url:'m?xwl=xc/gl/ledger/ld-pr-modes/ld-pr-modesDB/updateaccount',\n   params:{'infoArray':Wb.encode(Wb.getData(modify))},\n  success:function(resp){\n    Wb.syncCreate(app.grid1, Wb.decode(resp.responseText));\n    //app.grid1.store.commitChanges();\n    app.grid1.store.load({\n   params:{\n   ledger_id:app.ledger.getValue()\n   }\n   });\n  }\n});\n"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/gl/ledger/ld-pr-modes/ld-pr-modesDB/select-ld-pr-modes"},"events":{"beforeload":"store.proxy.extraParams.ledger_id = app.ledger.getValue();"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#rownum#}","align":"center","width":"45","xtype":"rownumberer","titleAlign":"center","itemId":"rownum"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#LD_MODE_ID#}","hidden":"true","dataIndex":"LD_MODE_ID","titleAlign":"center","itemId":"LD_MODE_ID"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#LEDGER_ID#}","hidden":"true","dataIndex":"LEDGER_ID","titleAlign":"center","itemId":"LEDGER_ID"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#MODE_ID#}","hidden":"true","dataIndex":"MODE_ID","titleAlign":"center","itemId":"MODE_ID"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#MODE_TYPE#}","width":"120","dataIndex":"MODE_TYPE","titleAlign":"center","itemId":"MODE_TYPE","renderer":"if(value == 'cash'){\n  return '现金' ;\n}else if(value == 'bank'){\n  return '银行' ;\n}else if(value == 'check'){\n  return '支票' ;\n}else if(value == 'other'){\n  return '其他' ;\n}else{\n  return value ;\n}"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#MODE_NAME#}","width":"140","dataIndex":"MODE_NAME","titleAlign":"center","itemId":"MODE_NAME"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#MODE_DESC#}","hidden":"true","align":"left","width":"220","dataIndex":"MODE_DESC","titleAlign":"center","itemId":"MODE_DESC"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#PAY_ACC_ID#}","hidden":"true","width":"50","dataIndex":"PAY_ACC_ID","titleAlign":"center","itemId":"PAY_ACC_ID"},"children":[],"expanded":true,"type":"column"},{"configs":{"editor":"app.PAY_ACC_NAME_EDITOR","text":"{#PAY_ACC_NAME#}","align":"left","width":"240","dataIndex":"PAY_ACC_NAME","titleAlign":"center","itemId":"PAY_ACC_NAME"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#REC_ACC_ID#}","hidden":"true","width":"50","dataIndex":"REC_ACC_ID","titleAlign":"center","itemId":"REC_ACC_ID"},"children":[],"expanded":true,"type":"column"},{"configs":{"editor":"app.REC_ACC_NAME_EDITOR","text":"{#REC_ACC_NAME#}","hidden":"false","align":"left","width":"240","dataIndex":"REC_ACC_NAME","titleAlign":"center","itemId":"REC_ACC_NAME"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":false,"type":"grid"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}