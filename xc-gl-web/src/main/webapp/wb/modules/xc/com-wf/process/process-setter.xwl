{"inframe":false,"title":"流程条件设置","hidden":false,"roles":{"default":1},"children":[{"configs":{"initScript":"com.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xc/com-wf/process/process-setter\");","loginRequired":"false","serverScript":"request.setAttribute('contextPath',request.getContextPath());\nrequest.setAttribute('moduleType',request.getParameter('moduleType'));","itemId":"module"},"events":{"finalize":"//记录所选单据类型\nvar globalBillsType = '';\nvar globalProcessId = '';"},"children":[{"configs":{"layout":"border","itemId":"viewport1"},"children":[{"configs":{"region":"north","frame":"true","style":"border-width:0px","border":"false","itemId":"conditionForm"},"children":[{"configs":{"tagConfigs":"baseCls:'my-panel-no-border'","layout":"column","border":"false","itemId":"tr1"},"children":[{"configs":{"tagConfigs":"baseCls:'my-panel-no-border'","layout":"form","columnWidth":".25","border":"false","itemId":"td1"},"children":[{"configs":{"labelWidth":"50","displayField":"NAME","valueField":"CODE","labelAlign":"left","itemId":"ledgerCombox","fieldLabel":"<font color='red'>*<\/font>{#ledgerCombox#}"},"events":{"select":"app.billsGrid.getStore().removeAll();\napp.actGrid.getStore().removeAll();\nvar billTypeCode = app.modelCombox.getValue();\nif(!Ext.isEmpty(billTypeCode)){\n  if(\"XC_EX\" == billTypeCode){\n  app.billsGrid.getStore().proxy.url = 'm?xwl=xc/com-wf/process/data/getExBillType';\n}else if(\"XC_AR\" == billTypeCode){\n  app.billsGrid.getStore().proxy.url = 'm?xwl=xc/com-wf/process/data/getArBillType';\n}else if(\"XC_AP\" == billTypeCode){\n  app.billsGrid.getStore().proxy.url = 'm?xwl=xc/com-wf/process/data/getApBillType';\n}else if(\"XC_PO\" == billTypeCode){\n  app.billsGrid.getStore().proxy.url = 'm?xwl=xc/com-wf/process/data/getPoBillType';\n}else if(\"XC_ST\" == billTypeCode){\n  app.billsGrid.getStore().proxy.url = 'm?xwl=xc/com-wf/process/data/getStBillType';\n}else{\n   app.billsGrid.getStore().proxy.url = 'm?xwl=xc/com-wf/process/data/getBgBillType';\n}\napp.billsGrid.getStore().load({params:{'ledgerId':combo.getValue()}});\napp.actGrid.getStore().removeAll();\n}","beforequery":"var combo = plan.combo;\nif (!plan.forceAll) {\n  var value = plan.query;\n  combo.store.filterBy(function(record, id) {\n    var text = record.get(combo.displayField);\n    return (text.indexOf(value) != -1);\n  });\n  combo.expand();\n  return false;\n}"},"children":[{"configs":{"pageSize":"-1","autoLoad":"true","itemId":"store","url":"m?xwl=xc/gl/report/daily-accounts/cash-daily-account/data/getAllLedger"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls:'my-panel-no-border'","layout":"form","columnWidth":".25","border":"false","itemId":"td2"},"children":[{"configs":{"labelWidth":"50","displayField":"NAME","valueField":"CODE","labelAlign":"right","itemId":"modelCombox","fieldLabel":"<font color='red'>*<\/font>{#modelCombox#}"},"events":{"select":"var billTypeCode = combo.getValue();\nif(\"XC_EX\" == billTypeCode){\n  app.billsGrid.getStore().proxy.url = 'm?xwl=xc/com-wf/process/data/getExBillType';\n}else if(\"XC_AP\" == billTypeCode){\n  app.billsGrid.getStore().proxy.url = 'm?xwl=xc/com-wf/process/data/getApBillType';\n}else if(\"XC_AR\" == billTypeCode){\n  app.billsGrid.getStore().proxy.url = 'm?xwl=xc/com-wf/process/data/getArBillType';\n}else if(\"XC_PO\"==billTypeCode){\n   app.billsGrid.getStore().proxy.url = 'm?xwl=xc/com-wf/process/data/getPoBillType';\n}else if(\"XC_ST\" == billTypeCode){\n  app.billsGrid.getStore().proxy.url = 'm?xwl=xc/com-wf/process/data/getStBillType';\n}else{\n   app.billsGrid.getStore().proxy.url = 'm?xwl=xc/com-wf/process/data/getBgBillType';\n}\napp.billsGrid.getStore().load({params:{'ledgerId':app.ledgerCombox.getValue()}});\napp.actGrid.getStore().removeAll();","beforequery":"var combo = plan.combo;\nif (!plan.forceAll) {\n  var value = plan.query;\n  combo.store.filterBy(function(record, id) {\n    var text = record.get(combo.displayField);\n    return (text.indexOf(value) != -1);\n  });\n  combo.expand();\n  return false;\n}"},"children":[{"configs":{"pageSize":"-1","autoLoad":"true","itemId":"store","url":"m?xwl=xc/com-wf/process/data/getXcWfModel"},"events":{"load":"if(Ext.isEmpty('{#moduleType#}')){\n  app.modelCombox.setReadOnly(false);\n}else{\n  app.modelCombox.setValue('{#moduleType#}');\n  app.modelCombox.setReadOnly(true);\n}"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls:'my-panel-no-border'","layout":"form","columnWidth":".44","border":"false","itemId":"td3"},"children":[{"configs":{"itemId":"label1"},"children":[],"expanded":false,"type":"label"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls:'my-panel-no-border'","layout":"form","columnWidth":".04","border":"false","itemId":"td4"},"children":[{"configs":{"text":"{#saveBtn#}","width":"70","itemId":"saveBtn","iconCls":"save_icon"},"events":{"click":"var _ledgerId = app.ledgerCombox.getValue();\nvar _processCode = globalProcessId;\nif(Ext.isEmpty(_ledgerId) || Ext.isEmpty(_processCode)){\n  Wb.info('{#MSG1#}');\n  return false;\n}\n//校验数据合法性\nvar modifyRecords = app.actGrid.getStore().getModifiedRecords();\nif(modifyRecords.length === 0){\n  Wb.info('{#MSG2#}');\n  return ;\n}\n//不存在删除一说\nvar newArray = [];\nvar modifyArray = [];\nvar reg=new RegExp(\"A\",\"g\");\nExt.each(modifyRecords,function(item){\n  //已经启用的节点，限额不能为空\n  var tmpEnabled = item.data.IS_ENABLED;\n  var tmpLimitVal = item.data.LIMITED_VAL;\n  if(Ext.isEmpty(tmpLimitVal))\n    tmpLimitVal = '0';\n  var tmpActCode = item.data.ACT_CODE;\n  var tmpRealCode = tmpActCode.replace(reg,'S');\n  var tmpActId = item.data.ACT_ID;\n  if(Ext.isEmpty(item.data.CON_ID)){\n    var newObject = {'CON_ID':'',\n                     'LEDGER_ID':_ledgerId,\n                     'BILLS_TYPE':globalBillsType,\n                     'PROCESS_ID':_processCode,\n                     'ACT_ID':tmpActId,\n                     'ACT_CODE':tmpActCode,\n                     'REAL_ACT_CODE':tmpRealCode,\n                     'IS_ENABLED':tmpEnabled,\n                     'LIMITED_VAL':tmpLimitVal\n                     };\n    newArray.push(newObject);\n }else{\n   var updateObject = {'CON_ID':item.data.CON_ID,\n                       'IS_ENABLED':tmpEnabled,\n                       'LIMITED_VAL':tmpLimitVal\n                     };\n    modifyArray.push(updateObject);\n  }\n});\n  Wb.request({\n    url:'{#contextPath#}/m?xwl=xc/com-wf/process/data/saveWfCondition',\n    params:{'newArray':Wb.encode(newArray),'updateArray':Wb.encode(modifyArray)},\n    message:'{#message#}',\n    success:function(){\n      Wb.info('{#SAVETIP#}');\n      app.actGrid.getStore().load({params:{'ledgerId':app.ledgerCombox.getValue(),'billsType':globalBillsType,'processId':_processCode}});\n    },\n    failure:function(){\n        Wb.info('{#SAVEERROR#}');\n    }\n  });\n"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"form"},{"configs":{"region":"west","multiSelect":"false","pagingBar":"false","selType":"checkboxmodel","frame":"true","width":"'25%'","itemId":"billsGrid"},"events":{"itemclick":"globalBillsType = record.data.BILL_TYPE_CODE;\nglobalProcessId = record.data.PROCESS_ID;\napp.actGrid.getStore().load({params:{'ledgerId':app.ledgerCombox.getValue(),'billsType':globalBillsType,'processId':record.data.PROCESS_ID}});\n\n"},"children":[{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#XH#}","width":"45","align":"center","xtype":"rownumberer","itemId":"billRowNum"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#BILL_TYPE_CODE#}","hidden":"true","dataIndex":"BILL_TYPE_CODE","itemId":"BILL_TYPE_CODE","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#BILL_TYPE_NAME#}","dataIndex":"BILL_TYPE_NAME","itemId":"BILL_TYPE_NAME","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"pageSize":"-1","autoLoad":"false","itemId":"store","url":"m?xwl=xc/com-wf/process/data/getExBillType"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"grid"},{"configs":{"region":"center","pagingBar":"false","frame":"true","itemId":"actGrid","enableColumnMove":"false","editable":"true"},"events":{"tagEvents":"'cellclick':function(cell,td,cellIndex,record,tr,rowIndex,e,eOpts){\n  if(cellIndex == 4 &&('XC_BG' == '{#moduleType#}' || 'XC_BG' == app.modelCombox.getValue())){\n    return false;\n  }\n}\n"},"children":[{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#XH#}","width":"45","align":"center","xtype":"rownumberer","itemId":"actRowNum"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#ACT_CODE#}","dataIndex":"ACT_CODE","itemId":"ACT_CODE","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#ACT_NAME#}","dataIndex":"ACT_NAME","itemId":"ACT_NAME","flex":"4"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#IS_ENABLED#}","width":"80","align":"center","dataIndex":"IS_ENABLED","itemId":"IS_ENABLED","renderer":"if(value === 'Y')\n  return '{#YES#}';\nelse\n  return '{#NO#}' ;"},"children":[{"configs":{"value":"Y","pickList":"[['Y','{#YES#}'],['N','{#NO#}']]","itemId":"editor"},"children":[],"expanded":false,"type":"combo"}],"expanded":true,"type":"column"},{"configs":{"text":"{#LIMITED_VAL#}","width":"150","xtype":"numbercolumn","align":"center","dataIndex":"LIMITED_VAL","itemId":"LIMITED_VAL"},"children":[{"configs":{"itemId":"editor"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"pageSize":"-1","autoLoad":"false","itemId":"store","url":"m?xwl=xc/com-wf/process/data/getActSetterInfo"},"children":[],"expanded":false,"type":"store"}],"expanded":false,"type":"grid"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}