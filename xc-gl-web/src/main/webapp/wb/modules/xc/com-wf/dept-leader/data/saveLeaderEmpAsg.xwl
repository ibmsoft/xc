{"inframe":false,"title":"保存模板数据","hidden":true,"roles":{"dev":1},"children":[{"configs":{"serverScript":"/**\n *新增或删除部门领导人授权时，与领导人相关的授权员工必须重新删除在添加\n */\nvar newRows = Wb.decode(request.getParameter('newData'));\nvar updateRows = Wb.decode(request.getParameter('updateData'));\nvar newAddEmpRows = [];\nWb.each(newRows,function(nr){\n  var primaryKey = java.util.UUID.randomUUID().toString();\n  nr.CONFIG_ASG_ID =primaryKey;\n  var subArray = nr.EMP_IDS.split(',');\n  var userArray = nr.USER_IDS.split(',');\n  for(var i=0;i<subArray.length;i++){\n     var createEmpRec = {'LEADER_EMP_ID':java.util.UUID.randomUUID().toString(),\n                         'CONFIG_ASG_ID':primaryKey,\n                         'EMP_ID':subArray[i],\n                         'USER_ID':userArray[i]\n                        };\n    newAddEmpRows.push(createEmpRec);\n  }\n});\nWb.each(updateRows,function(ur){\n  var updateArray = ur.EMP_IDS.split(',');\n  var userArray = ur.USER_IDS.split(',');\n  for(var i=0;i<updateArray.length;i++){\n     var updateEmpRec = {'LEADER_EMP_ID':java.util.UUID.randomUUID().toString(),\n                         'CONFIG_ASG_ID':ur.CONFIG_ASG_ID,\n                         'EMP_ID':updateArray[i],\n                         'USER_ID':userArray[i]\n                        };\n    newAddEmpRows.push(updateEmpRec);\n  }\n});\n\nrequest.setAttribute('newRows', Wb.encode(newRows));\nrequest.setAttribute('updateRows', Wb.encode(updateRows));\nrequest.setAttribute('addEmpRows', Wb.encode(newAddEmpRows));\n","itemId":"module"},"children":[{"configs":{"sql":"insert into xc_wf_dept_leader_asg(\n  CONFIG_ASG_ID,   \n  ORG_ID,          \n  DEPT_ID,         \n  LEADER_CODE,      \n  LEADER_NAME,     \n  EMP_IDS,\n  USER_IDS,\n  CREATION_DATE,   \n  CREATED_BY,      \n  LAST_UPDATE_DATE,\n  LAST_UPDATED_BY \n)values(\n {?CONFIG_ASG_ID?},\n {?ORG_ID?},\n {?DEPT_ID?},\n {?LEADER_CODE?},\n {?LEADER_NAME?},\n {?EMP_IDS?},\n {?USER_IDS?},\n {?timestamp.sys.date?},\n {?XIP.userId?},\n {?timestamp.sys.date?},\n {?XIP.userId?}\n)","transaction":"start","arrayName":"newRows","itemId":"insertLeaderAsg"},"children":[],"expanded":false,"type":"query"},{"configs":{"sql":"update xc_wf_dept_leader_asg t \n   set t.LEADER_CODE = {?LEADER_CODE?},\n       t.LEADER_NAME = {?LEADER_NAME?},\n       t.EMP_IDS = {?EMP_IDS?},\n       t.USER_IDS = {?USER_IDS?},\n       t.LAST_UPDATE_DATE = {?timestamp.sys.date?},\n       t.LAST_UPDATED_BY = {?XIP.userId?}\n  where t.CONFIG_ASG_ID ={?CONFIG_ASG_ID?}","arrayName":"updateRows","itemId":"updateLeaderAsg"},"children":[],"expanded":false,"type":"query"},{"configs":{"sql":"delete from  xc_wf_leader_emps where CONFIG_ASG_ID ={?CONFIG_ASG_ID?}","arrayName":"updateRows","itemId":"delLeaderEmp"},"children":[],"expanded":false,"type":"query"},{"configs":{"sql":"insert into xc_wf_leader_emps(\n  LEADER_EMP_ID,   \n  CONFIG_ASG_ID,          \n  EMP_ID,\n  USER_ID\n)values(\n {?LEADER_EMP_ID?},\n {?CONFIG_ASG_ID?},\n {?EMP_ID?},\n {?USER_ID?}\n)","arrayName":"addEmpRows","itemId":"insertLeaderEmps"},"children":[],"expanded":false,"type":"query"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}