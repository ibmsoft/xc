{"inframe":false,"title":"部门领导配置窗口","hidden":false,"roles":{"default":1},"children":[{"configs":{"serverScript":"var deptName = request.getParameter('deptName');\nvar orgId = request.getParameter('orgId');\nvar deptId = request.getParameter('deptId');\nrequest.setAttribute('deptName',deptName);\nrequest.setAttribute('orgId',orgId);\nrequest.setAttribute('deptId',deptId);\nrequest.setAttribute('contextPath',request.getContextPath());","itemId":"module"},"events":{"initialize":"var globalDeptName = '{#deptName#}';\nvar globalDeptId = '{#deptId#}';\nvar globalOrgId = '{#orgId#}';"},"children":[{"configs":{"itemId":"store"},"children":[{"configs":{"autoLoad":"true","itemId":"leaderCodeStore","url":"m?xwl=xc/com-wf/dept-leader/data/getLeaderConfig"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"leaderEmpStore","url":"m?xwl=xc/com-wf/dept-leader/data/getLeaderEmp"},"events":{"beforeload":"store.proxy.extraParams.orgId = globalOrgId;\nstore.proxy.extraParams.queryName = '%'+app.queryName.getValue()+'%';"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"folder"},{"configs":{"itemId":"leaderAsignBtns"},"children":[{"configs":{"text":"保存","itemId":"saveBtn","iconCls":"save_icon"},"events":{"click":"var rows = app.leaderGrid.getStore().getModifiedRecords();\nvar createRows = [];\nvar updateRows = [];\nvar checkArray = [];\nvar isValid = true;\n//遍历已经授权的部门领导人列表，校验编码的重复性\napp.leaderGrid.getStore().each(function(a){\n    checkArray.push(a.data.LEADER_CODE);\n  });\nif(rows !== null && rows.length >0){\n  Ext.each(rows,function(item){\n    if(Ext.isEmpty(item.data.LEADER_CODE) || Ext.isEmpty(item.data.EMP_IDS)){\n      isValid = false;\n      return ;\n    }\n    if(Ext.isEmpty(item.data.CONFIG_ASG_ID)){\n      createRows.push(item.data);\n    }else{\n      updateRows.push(item.data);\n    }    \n  });\n  if(!isValid){\n    Wb.info('请选择所有必选项！');\n    return ;\n  }\n  var newArray = Ext.Array.unique(checkArray);\n  if(newArray.length !== checkArray.length){\n    Wb.info('领导编码已存在，请检查！');\n    return;\n  }\n  //通过校验，执行保存操作\n  Wb.request({\n      url:'m?xwl=xc/com-wf/dept-leader/data/saveLeaderEmpAsg',\n      message:'请求处理中....',\n      params:{'newData':Wb.encode(createRows),'updateData':Wb.encode(updateRows)},\n      success:function(response){\n        Wb.info('保存成功！',function(){\n          app.leaderGrid.getStore().load({params:{'deptId':globalDeptId}});\n        });\n      },\n      failure:function(response){\n        Wb.info('保存失败！');\n      }\n    });\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"关闭","itemId":"closeBtn","iconCls":"cancel_icon"},"events":{"click":"app.leaderAsignWin.close();"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"array"},{"configs":{"autoShow":"true","frame":"false","height":"550","layout":"fit","width":"800","closeAction":"hide","resizable":"true","buttonAlign":"center","buttons":"app.leaderAsignBtns","itemId":"leaderAsignWin","dialog":"false","modal":"true"},"events":{"beforeshow":"win.setTitle(globalDeptName+'-领导设置');\napp.leaderGrid.getStore().load({params:{'deptId':globalDeptId}});\n"},"children":[{"configs":{"region":"center","tagConfigs":"baseCls:'my-panel-no-body'","frame":"true","style":"border-width:0px","layout":"fit","border":"false","itemId":"personPanel"},"children":[{"configs":{"pagingBar":"false","selType":"checkboxmodel","itemId":"leaderGrid","editable":"true"},"children":[{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"序号","width":"45","align":"center","xtype":"rownumberer","titleAlign":"center","itemId":"COLUMN_XH"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"主键","hidden":"true","dataIndex":"CONFIG_ASG_ID","itemId":"CONFIG_ASG_ID"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"部门ID","hidden":"true","dataIndex":"DEPT_ID","itemId":"DEPT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"组织ID","hidden":"true","dataIndex":"ORG_ID","itemId":"ORG_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"领导编码","hidden":"true","dataIndex":"LEADER_CODE","itemId":"LEADER_CODE"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"员工编码","hidden":"true","dataIndex":"EMP_IDS","itemId":"EMP_IDS"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"用户编码","hidden":"true","dataIndex":"USER_IDS","itemId":"USER_IDS"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"<font color='red'>*<\/font>领导名称","width":"200","dataIndex":"LEADER_NAME","itemId":"LEADER_NAME_COL"},"children":[{"configs":{"store":"app.leaderCodeStore","displayField":"NAME","valueField":"CODE","itemId":"editor"},"events":{"select":"var _row = app.leaderGrid.getSelection();\n_row[0].set('LEADER_CODE',combo.getValue());\ncombo.setValue(combo.getRawValue());"},"children":[],"expanded":true,"type":"combo"}],"expanded":false,"type":"column"},{"configs":{"text":"<font color='red'>*<\/font>分配员工","width":"200","dataIndex":"EMP_NAMES","itemId":"EMP_NAMES"},"children":[{"configs":{"itemId":"editor"},"events":{"expand":"app.leaderEmpStore.load();"},"children":[{"configs":{"tagConfigs":"minWidth:300","multiSelect":"true","selType":"checkboxmodel","height":"240","store":"app.leaderEmpStore","barExportButtons":"false","barExportAllButtons":"false","width":"420","itemId":"pickComp"},"children":[{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"员工ID","hidden":"true","dataIndex":"USER_ID","itemId":"USER_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"用户名","width":"100","dataIndex":"USER_NAME","itemId":"USER_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"员工姓名","width":"100","dataIndex":"EMP_NAME","itemId":"EMP_NAME_COL"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"width":"170","emptyText":"输入用户名或员工姓名查询","itemId":"queryName"},"events":{"specialkey":"if(Ext.EventObject.getKey() == 13){\n  app.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"},{"configs":{"text":"查询","itemId":"queryBtn","iconCls":"seek_icon"},"events":{"click":"app.leaderEmpStore.load();"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"确定","itemId":"confirmBtn","iconCls":"ok_icon"},"events":{"click":"//选择部门领导执行人\nvar rows = app.pickComp.getSelection();\nif(rows === null || rows.length === 0){\n  Wb.info('请选择要分配的用户！');\n}else{\n  var selectedId = '';\n  var selectedEmpId = '';\n  var selectedName = '';\n  Ext.each(rows,function(item){\n    selectedId = selectedId+item.data.USER_ID+',';\n    selectedName = selectedName+item.data.EMP_NAME+',';\n    selectedEmpId = selectedEmpId+item.data.EMP_ID+',';\n  });\n  if(selectedId !==''){\n    selectedId = selectedId.substring(0,selectedId.length-1);\n    selectedName = selectedName.substring(0,selectedName.length-1);\n    selectedEmpId = selectedEmpId.substring(0,selectedEmpId.length-1);\n}\n  var parentPicker = app.pickComp.ownerCmp;\n  parentPicker.setValue(selectedName);\n  var gridRows = app.leaderGrid.getSelection();\n  gridRows[0].set('EMP_IDS',selectedEmpId);\n  gridRows[0].set('EMP_NAMES',selectedName);\n  gridRows[0].set('USER_IDS',selectedId);\n  parentPicker.collapse();\n}\n"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":true,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"pageSize":"-1","itemId":"store","url":"m?xwl=xc/com-wf/dept-leader/data/getDeptLeadersAsg"},"events":{"beforeload":"\n"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"-","itemId":"item1"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"添加领导","itemId":"addLeder","iconCls":"user_add_icon"},"events":{"click":"Wb.addEdit(app.leaderGrid,{'ORG_ID':globalOrgId,'DEPT_ID':globalDeptId});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item2"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"删除领导","itemId":"delLeader","iconCls":"user_delete_icon"},"events":{"click":"var rows = app.leaderGrid.getSelectionModel().getSelection();\nif(rows.length===0){\n  Wb.info('请选择一条记录!');\n}else{\n  Ext.Msg.confirm('提示','您确定要删除所选的记录吗？',function(a){\n    if(a=='yes'){\n       Wb.request({\n         url:'m?xwl=xc/com-wf/dept-leader/data/deleteLeaderEmp',\n         params:{destroy: Wb.getData(rows)},\n         success:function(){\n           Wb.info('删除成功！');\n           Wb.remove(app.leaderGrid,rows);\n         }\n       });\n    }\n  });\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item3"},"children":[],"expanded":false,"type":"item"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"window"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}