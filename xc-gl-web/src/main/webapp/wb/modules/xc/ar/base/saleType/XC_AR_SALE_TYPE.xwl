{"inframe":false,"title":"采购类型","hidden":false,"roles":{"default":1},"children":[{"configs":{"serverScript":"com.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xc/ar/base/saleType/XC_AR_SALE_TYPE\");","itemId":"module"},"children":[{"configs":{"layout":"border","itemId":"viewport1"},"children":[{"configs":{"region":"center","selType":"checkboxmodel","itemId":"Grid","border":"true","editable":"true"},"children":[{"configs":{"itemId":"store","autoLoad":"true","url":"m?xwl=xc/ar/base/saleType/data/select"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"{#addBtn#}","itemId":"addBtn","iconCls":"file_add_icon"},"events":{"click":"\n\nvar bkid =  Xip.getId();\n\nWb.addEdit(app.Grid,[{AR_SALE_TYPE_ID:bkid,IS_SYSTEM_AR:1,IS_SYSTEM_SALE:1}]);"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#delBtn#}","itemId":"delBtn","iconCls":"file_delete_icon"},"events":{"click":"var rows=app.Grid.getSelectionModel().getSelection();\nif(rows.length===0){\n  Ext.Msg.alert('{#TIP#}','{#DELTIP#}');\n  return;\n}\nelse{\n   Ext.Msg.confirm('{#TIP#}','{#DELOKTIP#}',function(a){\n    if(a=='yes'){\n\n      for(var i=0;i<rows.length;i++){\n    \n\n        var flag=true;\n        var msg=\"\";\n        var vcode = rows[i].data.AP_PUR_TYPE_NAME;\n        Wb.request({\n          url: 'm?xwl=xc/ar/base/saleType/data/selectLDExist',\n          params:{AR_SALE_TYPE_ID:rows[i].data.AR_SALE_TYPE_ID},\n          async:false,\n          method: 'POST',\n          success:function(response){\n            var rep = Ext.JSON.decode(response.responseText);\n            var num = rep.NUM;\n\n            if( num>0){\n\n              msg = vcode+\"{#MSG1#}！\";\n              flag = false;\n\n\n            }\n          }\n        });\n\n        if(flag==false){\n          Wb.toast(msg);\n        //  Ext.Msg.alert('{#TIP#}',msg);\n          return;\n        }\n\n      } \n      \n      \n       \n            \n      var idList = \"\" ;\n      Ext.each(rows,function(r){\n        var id = \"'\" + r.data.AR_SALE_TYPE_ID + \"'\";\n        if(idList === \"\"){\n          idList = id ;\n        }else{\n          idList = idList+\",\"+id ;\n        }\n      });\n      var json = {'ids' : idList} ;\n          Wb.request({\n           url : 'm?xwl=xc/ar/base/saleType/data/delete',\n           params :json,\n           success :function(response){\n             \n               Wb.toast('{#DELTIP1#}');\n          //   app.Grid.store.load();\n         //  Ext.Msg.alert(\"提示\",\"删除成功!\");\n             Wb.remove(app.Grid,rows);\n           }\n        });\n    }\n   });\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#saveBtn#}","itemId":"saveBtn","iconCls":"save_icon"},"events":{"click":"if (!Wb.verifyGrid(app.Grid)) //验证数据是否合法\n  return;\n\n\nvar rec = app.Grid.store.getModifiedRecords();\n\nfor(var i=0;i<rec.length;i++){\n  for(var j=0;j<rec.length;j++){\n    if(rec[i].data.AR_SALE_TYPE_NAME==rec[j].data.AR_SALE_TYPE_NAME&&rec[i].data.AR_SALE_TYPE_ID!=rec[j].data.AR_SALE_TYPE_ID){\n      Ext.Msg.alert('{#TIP#}',rec[i].data.AR_SALE_TYPE_NAME+\"{#MSG2#}\");\n      return false;\n    }\n  }\n\n  var flag=true;\n  var msg=\"\";\n  var vcode = rec[i].data.AR_SALE_TYPE_NAME;\n  Wb.request({\n    url: 'm?xwl=xc/ar/base/saleType/data/selectExist',\n    params:{AR_SALE_TYPE_NAME:vcode,AR_SALE_TYPE_ID:rec[i].data.AR_SALE_TYPE_ID},\n    async:false,\n    method: 'POST',\n    success:function(response){\n      var rep = Ext.JSON.decode(response.responseText);\n      var num = rep.NUM;\n\n      if( num>0){\n\n        msg = vcode+\"{#MSG2#}\";\n        flag = false;\n\n\n      }\n    }\n  });\n\n  if(flag==false){\n    Ext.Msg.alert('{#TIP#}',msg);\n    return;\n  }\n\n} \n\n\n\nWb.sync({\n  grid: app.Grid,\n  url: 'm?xwl=xc/ar/base/saleType/data/save',\n  message: '{#message#}',\n  success: function(resp) {\n    \n     Wb.reload(app.Grid);\n    Wb.toast('{#SAVETIP#}');\n  }\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#importBtn#}","itemId":"importBtn","iconCls":"import_icon"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#exportBtn#}","itemId":"exportBtn","iconCls":"export_icon"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#XH#}","xtype":"rownumberer","width":"50","align":"center","titleAlign":"center","itemId":"column1"},"events":{"afterrender":"\n\n"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#AR_SALE_TYPE_ID_COL#}","hidden":"true","dataIndex":"AR_SALE_TYPE_ID","itemId":"AR_SALE_TYPE_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"<font color='red'>*<\/font>{#AR_SALE_TYPE_NAME_COL#}","width":"150","dataIndex":"AR_SALE_TYPE_NAME","titleAlign":"center","itemId":"AR_SALE_TYPE_NAME_COL"},"children":[{"configs":{"allowBlank":"false","itemId":"editor"},"children":[],"expanded":false,"type":"text"}],"expanded":false,"type":"column"},{"configs":{"text":"{#SALE_OBJECT_COL#}","hidden":"true","align":"center","dataIndex":"SALE_OBJECT","itemId":"SALE_OBJECT_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"<font color='red'>*<\/font>{#SALE_OBJECT_COL#}","width":"150","dataIndex":"SALE_OBJECT_NAME","titleAlign":"center","itemId":"SALE_OBJECT_NAME_COL"},"children":[{"configs":{"allowBlank":"false","displayField":"VAL_NAME","valueField":"VAL_CODE","itemId":"editor","editable":"false"},"events":{"select":"var r = app.Grid.getSelectionModel().getSelection();\nr[0].set('SALE_OBJECT',combo.getValue()) ;\n//r[0].set('ORG_NAME',app.editororg.getRawValue()) ;\ncombo.setValue(combo.getRawValue());\n\n"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/ar/base/saleType/data/selectValset"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"}],"expanded":false,"type":"column"},{"configs":{"text":"{#IS_SYSTEM_AR_COL#}","hidden":"true","width":"130","xtype":"checkcolumn","dataIndex":"IS_SYSTEM_AR","itemId":"IS_SYSTEM_AR_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#IS_SYSTEM_SALE_COL#}","hidden":"true","xtype":"checkcolumn","dataIndex":"IS_SYSTEM_SALE","itemId":"IS_SYSTEM_SALE_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#DESCRIPTION_COL#}","width":"200","dataIndex":"DESCRIPTION","titleAlign":"center","itemId":"DESCRIPTION_COL"},"children":[{"configs":{"itemId":"editor"},"children":[],"expanded":false,"type":"text"}],"expanded":false,"type":"column"},{"configs":{"text":"{#CREATION_DATE_COL#","hidden":"true","dataIndex":"CREATION_DATE","itemId":"CREATION_DATE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#CREATED_BY_COL#}","hidden":"true","dataIndex":"CREATED_BY","itemId":"CREATED_BY_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#LAST_UPDATE_DATE_COL#}","hidden":"true","dataIndex":"LAST_UPDATE_DATE","itemId":"LAST_UPDATE_DATE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#LAST_UPDATED_BY_COL#}","hidden":"true","dataIndex":"LAST_UPDATED_BY","itemId":"LAST_UPDATED_BY_COL"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}