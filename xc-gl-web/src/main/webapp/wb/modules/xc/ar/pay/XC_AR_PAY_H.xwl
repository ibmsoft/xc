{"inframe":false,"title":"收款单新增修改查看","hidden":false,"roles":{"default":1},"children":[{"configs":{"serverScript":"//---------------------获取当前模块语言对应的.json文件，放到request中----------------\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xc/ar/pay/json/XC_AR_PAY_H\");\nvar contextPath = request.getContextPath();\nrequest.setAttribute(\"contextPath\",contextPath);\n\nrequest.setAttribute('opmode','view');\nrequest.setAttribute('vtype','normal');\n\n","itemId":"module"},"events":{"finalize":"\nWb.docCatCode = '{#AR_DOC_CAT_CODE#}';//单据类型 SKD_JSK 结算款 SKD_JSK-H 结算款红字 SKD_YUSK 预收款 SKD_YUSK-H 预收款红字  SKD_QTSK 其它收款 SKD_QTSK-H 其它收款红字\nWb.docStatus = 'xz';//单据状态 xz新增 cg草稿 zd只读 qz签字 shtg审核通过\nWb.ar_pay_h_id = '';//收款单id\nWb.v_head_id = '';//凭证id\n\nExt.apply(app,{\n  grid : null, // 被使用的表格\n  tbar : null // 表格工具条\n});\n\n\n\nif(Wb.docCatCode == 'SKD_JSK'){\n  app.title_skd.show();//收款单\n  app.title_tkd.hide();//退款单\n  app.SOURCE.setValue('GL_L');\n  app.grid1.show();\n  app.grid = app.grid1;\n  app.tbar = app.grid1Tbar;\n}else if(Wb.docCatCode == 'SKD_JSK-H'){\n  app.title_skd.hide();\n  app.title_tkd.show();\n  app.SOURCE.setValue('GL_H');\n  app.grid2.show();\n  app.grid = app.grid2;\n  app.tbar = app.grid2Tbar;\n}else if(Wb.docCatCode == 'SKD_YUSK'){\n  app.title_skd.show();\n  app.title_tkd.hide();\n  app.SOURCE.setValue('TEMP');\n  app.grid3.show();\n  app.grid = app.grid3;\n  app.tbar = app.grid3Tbar;\n}else if(Wb.docCatCode == 'SKD_YUSK-H'){\n  app.title_skd.hide();\n  app.title_tkd.show();\n  app.SOURCE.getStore().removeAt(0);\n  app.SOURCE.getStore().removeAt(0);\n  app.SOURCE.setValue('PAY_L');\n  app.SOURCE.setReadOnly(false);\n  app.grid4.show();\n  app.grid = app.grid4;\n  app.tbar = app.grid4Tbar;\n}else if(Wb.docCatCode == 'SKD_QTSK'){\n  app.title_skd.show();\n  app.title_tkd.hide();\n  app.SOURCE.setValue('TEMP');\n  app.grid5.show();\n  app.grid = app.grid5;\n  app.tbar = app.grid5Tbar;\n}else if(Wb.docCatCode == 'SKD_QTSK-H'){\n  app.title_skd.hide();\n  app.title_tkd.show();\n  app.SOURCE.setValue('TEMP');\n  app.grid6.show();\n  app.grid = app.grid6;\n  app.tbar = app.grid6Tbar;\n}\n\napp.grid.show();\n//改变界面视图\nchangeView1(Wb.docStatus);\n//处理必填项\ninitAllowBank();\n\n//自己的新增\nif(Wb.docStatus == 'xz'){\n  // 新增时，需要初始化一些数据\n  var store = app.LEDGER_ID_XWL.LEDGER_NAME.getPicker().getStore();\n  store.load({\n    scope:this,\n    callback:function(records,operation,success){\n      if(success){\n        //账簿\n        app.LEDGER_ID_XWL.LEDGER_ID.setValue(records[0].data.LEDGER_ID);\n        app.LEDGER_ID_XWL.LEDGER_NAME.setValue(records[0].data.LEDGER_NAME);\n        returnRowFn(records[0],'xc_gl_ledgers');\n        clearOtherFn('xc_gl_ledgers');\n        //入账日期、收款日期\n        app.GL_DATE.setValue(new Date());\n        app.PAY_DATE.setValue(new Date());\n        //收款方式\n        app.PAY_TYPE_NAME.store.load({\n          scope : this,\n          callback : function(records,operation,success){\n            app.PAY_TYPE_ID.setValue(records[0].data.MODE_ID);\n            app.PAY_TYPE_NAME.setValue(records[0].data.MODE_NAME);\n          }\n        });\n        //制单人\n        app.CREATED_BY.setValue('{#XIP.userId#}');\n        app.CREATED_BY_NAME.setValue('{#XIP.empName#}');\n        //单据类型\n        app.AR_DOC_CAT_CODE.setValue(Wb.docCatCode);\n        //加载表格\n        app.grid.store.load();\n      }\n    }\n  });\n\n}\n    \n    \n    \n\n\n/*picker返回值*/\nfunction returnRowFn(rec,type){\n  if(type == 'xc_gl_ledgers'){//账簿\n    app.CUSTOM_ID_XWL.QUERY_LEDGER_ID.setValue(rec.data.LEDGER_ID);//客户\n    app.DEPT_ID_XWL.QUERY_LEDGER_ID.setValue(rec.data.LEDGER_ID);//成本中心\n    app.PROJECT_ID_XWL.QUERY_LEDGER_ID.setValue(rec.data.LEDGER_ID);//项目\n    app.AR_CONTRACT_ID_XWL.QUERY_LEDGER_ID.setValue(rec.data.LEDGER_ID);//合同\n    app.BANK_ACCOUNT_XWL.QUERY_LEDGER_ID.setValue(rec.data.LEDGER_ID);//账户\n    app.SALE_ACC_ID_XWL.QUERY_LEDGER_ID.setValue(rec.data.LEDGER_ID);//收款科目\n  }else if(type == 'xip_pub_depts'){//成本中心\n    app.PROJECT_ID_XWL.QUERY_DEPT_ID.setValue(rec.data.DEPT_ID);//项目\n  }else if(type == 'xc_ar_customers'){\n    app.AR_CONTRACT_ID_XWL.QUERY_CUSTOMER_ID.setValue(rec.data.CUSTOMER_ID);//合同\n  }else if(type == 'xc_pm_projects'){\n    if(Wb.isEmpty(app.DEPT_ID_XWL.DEPT_NAME.getValue())){\n      app.DEPT_ID_XWL.DEPT_ID.setValue(rec.data.DEPT_ID);\n      app.DEPT_ID_XWL.DEPT_NAME.setValue(rec.data.DEPT_NAME);\n      app.PROJECT_ID_XWL.QUERY_DEPT_ID.setValue(rec.data.DEPT_ID);\n    }\n  }else if(type == 'xc_ar_contract'){\n    if(Wb.isEmpty(app.CUSTOM_ID_XWL.CUSTOMER_NAME.getValue())){\n      app.CUSTOM_ID_XWL.CUSTOMER_ID.setValue(rec.data.CUSTOMER_ID);\n      app.CUSTOM_ID_XWL.CUSTOMER_NAME.setValue(rec.data.CUSTOMER_NAME);\n      app.AR_CONTRACT_ID_XWL.QUERY_CUSTOMER_ID.setValue(rec.data.CUSTOMER_ID);\n    }\n  }\n}\n\n/*重新选择某一个值时，相应的值要发生改变*/\nfunction clearOtherFn(type){\n  if(type == 'xc_gl_ledgers'){\n    //清空客户相关\n    app.CUSTOM_ID_XWL.CUSTOMER_ID.reset();\n    app.CUSTOM_ID_XWL.CUSTOMER_NAME.reset();\n    //清空部门相关\n    app.DEPT_ID_XWL.DEPT_ID.reset();\n    app.DEPT_ID_XWL.DEPT_NAME.reset();\n    //清空项目相关\n    app.PROJECT_ID_XWL.PROJECT_ID.reset();\n    app.PROJECT_ID_XWL.PROJECT_NAME.reset();\n    //清空合同相关\n    app.AR_CONTRACT_ID_XWL.AR_CONTRACT_ID.reset();\n    app.AR_CONTRACT_ID_XWL.AR_CONTRACT_NAME.reset();\n    //清空账户相关\n    app.BANK_ACCOUNT_XWL.DEPOSIT_BANK_ID.reset();\n    app.BANK_ACCOUNT_XWL.DEPOSIT_BANK_NAME.reset();\n    //清空收款科目相关\n    app.SALE_ACC_ID_XWL.PAY_ACC_ID.reset();\n    app.SALE_ACC_ID_XWL.PAY_ACC_NAME.reset();\n  }else if(type == 'xip_pub_depts'){\n    //清空项目相关\n    app.PROJECT_ID_XWL.PROJECT_ID.reset();\n    app.PROJECT_ID_XWL.PROJECT_NAME.reset();\n  }else if(type == 'xc_ar_customers'){\n    //清空合同相关\n    app.AR_CONTRACT_ID_XWL.AR_CONTRACT_ID.reset();\n    app.AR_CONTRACT_ID_XWL.AR_CONTRACT_NAME.reset();\n  }\n}\n/*赋值*/\nfunction setJsonToValues(arPayH){\n  app.LEDGER_ID_XWL.LEDGER_ID.setValue(arPayH.LEDGER_ID);\n  app.LEDGER_ID_XWL.LEDGER_NAME.setValue(arPayH.LEDGER_NAME);\n  app.AR_DOC_CAT_CODE.setValue(arPayH.AR_DOC_CAT_CODE);\n  app.AR_PAY_H_CODE.setValue(arPayH.AR_PAY_H_CODE);\n  app.GL_DATE.setValue(Wb.strToDate(arPayH.GL_DATE));\n  app.CUSTOM_ID_XWL.CUSTOMER_ID.setValue(arPayH.CUSTOMER_ID);\n  app.CUSTOM_ID_XWL.CUSTOMER_NAME.setValue(arPayH.CUSTOMER_NAME);\n  app.DEPT_ID_XWL.DEPT_ID.setValue(arPayH.DEPT_ID);\n  app.DEPT_ID_XWL.DEPT_NAME.setValue(arPayH.DEPT_NAME);\n  app.PROJECT_ID_XWL.PROJECT_ID.setValue(arPayH.PROJECT_ID);\n  app.PROJECT_ID_XWL.PROJECT_NAME.setValue(arPayH.PROJECT_NAME);\n  app.AR_CONTRACT_ID_XWL.AR_CONTRACT_ID.setValue(arPayH.AR_CONTRACT_ID);\n  app.AR_CONTRACT_ID_XWL.AR_CONTRACT_NAME.setValue(arPayH.AR_CONTRACT_NAME);\n  app.SOURCE.setValue(arPayH.SOURCE);\n  app.DESCRIPTION.setValue(arPayH.DESCRIPTION);\n  app.PAY_TYPE_ID.setValue(arPayH.PAY_TYPE_ID);\n  app.PAY_TYPE_NAME.setValue(arPayH.PAY_TYPE_NAME);\n  app.PAY_NO.setValue(arPayH.PAY_NO);\n  app.PAY_DATE.setValue(Wb.strToDate(arPayH.PAY_DATE));\n  app.AMOUNT.setValue(arPayH.AMOUNT);\n  app.BANK_ACCOUNT_XWL.DEPOSIT_BANK_ID.setValue(arPayH.BANK_ACCOUNT);\n  app.BANK_ACCOUNT_XWL.DEPOSIT_BANK_NAME.setValue(arPayH.ACCOUNT_NAME);\n  app.SALE_ACC_ID_XWL.PAY_ACC_ID.setValue(arPayH.SALE_ACC_ID);\n  app.SALE_ACC_ID_XWL.PAY_ACC_NAME.setValue(arPayH.SALE_ACC_NAME);\n  app.CA_ID_XWL.CA_ID.setValue(arPayH.CA_ID);\n  app.CA_ID_XWL.CA_NAME.setValue(arPayH.CA_NAME);\n  app.CREATED_BY.setValue(arPayH.CREATED_BY);\n  app.CREATED_BY_NAME.setValue(arPayH.CREATED_BY_NAME);\n  app.SIGNATORY_ID.setValue(arPayH.SIGNATORY_ID);\n  app.SIGNATORY.setValue(arPayH.SIGNATORY);\n  app.V_HEAD_ID.setValue(arPayH.V_HEAD_ID);\n  var v_status = '';\n  if(arPayH.V_STATUS == '1'){v_status = '草稿';}else if(arPayH.V_STATUS == '3'){v_status = '审核通过';}\n  app.V_STATUS.setValue(v_status);\n}\n\n/*改变页面视图*/\nfunction changeView1(status){//\n  if(status == 'xz'){\n    app.addBtn.setDisabled(false);//新增按钮\n    app.saveBtn.setDisabled(false);//保存按钮\n    app.verfyBtn.setDisabled(true);//审核按钮\n    app.cancelVerfyBtn.setDisabled(true);//取消审核按钮\n    app.tbar.setDisabled(false);\n    app.LEDGER_ID_XWL.LEDGER_NAME.setReadOnly(false);//账簿\n    app.GL_DATE.setReadOnly(false);//入账日期\n    app.CUSTOM_ID_XWL.CUSTOMER_NAME.setReadOnly(false);//客户\n    app.DEPT_ID_XWL.DEPT_NAME.setReadOnly(false);//成本中心\n    app.PROJECT_ID_XWL.PROJECT_NAME.setReadOnly(false);//项目\n    app.AR_CONTRACT_ID_XWL.AR_CONTRACT_NAME.setReadOnly(false);//合同\n    app.DESCRIPTION.setReadOnly(false);//摘要\n    app.PAY_TYPE_NAME.setReadOnly(false);//收款方式\n    app.PAY_NO.setReadOnly(false);//结算号票据\n    app.PAY_DATE.setReadOnly(false);//收款日期\n    app.BANK_ACCOUNT_XWL.DEPOSIT_BANK_NAME.setReadOnly(false);//收款账户\n    app.SALE_ACC_ID_XWL.PAY_ACC_NAME.setReadOnly(false);//收款科目\n    app.CA_ID_XWL.CA_NAME.setReadOnly(false);//现金流名称\n\n  }else if(status == 'cg'){\n    app.addBtn.setDisabled(false);//新增按钮\n    app.saveBtn.setDisabled(false);//保存按钮\n    app.verfyBtn.setDisabled(false);//审核按钮\n    app.cancelVerfyBtn.setDisabled(true);//取消审核按钮\n    app.tbar.setDisabled(false);\n    app.LEDGER_ID_XWL.LEDGER_NAME.setReadOnly(true);//账簿\n    app.GL_DATE.setReadOnly(false);//入账日期\n    app.CUSTOM_ID_XWL.CUSTOMER_NAME.setReadOnly(true);//客户\n    app.DEPT_ID_XWL.DEPT_NAME.setReadOnly(false);//成本中心\n    app.PROJECT_ID_XWL.PROJECT_NAME.setReadOnly(false);//项目\n    app.AR_CONTRACT_ID_XWL.AR_CONTRACT_NAME.setReadOnly(false);//合同\n    app.DESCRIPTION.setReadOnly(false);//摘要\n    app.PAY_TYPE_NAME.setReadOnly(false);//收款方式\n    app.PAY_NO.setReadOnly(false);//结算号票据\n    app.PAY_DATE.setReadOnly(false);//收款日期\n    app.BANK_ACCOUNT_XWL.DEPOSIT_BANK_NAME.setReadOnly(false);//收款账户\n    app.SALE_ACC_ID_XWL.PAY_ACC_NAME.setReadOnly(false);//收款科目\n    app.CA_ID_XWL.CA_NAME.setReadOnly(false);//现金流名称\n  }else if(status == 'zd' || status == 'qz'){\n//     app.addBtn.setDisabled(true);//新增按钮\n//     app.saveBtn.setDisabled(true);//保存按钮\n//     app.verfyBtn.setDisabled(true);//审核按钮\n//     app.cancelVerfyBtn.setDisabled(true);//取消审核按钮\n    app.form1Tbar.setDisabled(true);\n    app.tbar.setDisabled(true);\n    app.LEDGER_ID_XWL.LEDGER_NAME.setReadOnly(true);//账簿\n    app.GL_DATE.setReadOnly(true);//入账日期\n    app.CUSTOM_ID_XWL.CUSTOMER_NAME.setReadOnly(true);//客户\n    app.DEPT_ID_XWL.DEPT_NAME.setReadOnly(true);//成本中心\n    app.PROJECT_ID_XWL.PROJECT_NAME.setReadOnly(true);//项目\n    app.AR_CONTRACT_ID_XWL.AR_CONTRACT_NAME.setReadOnly(true);//合同\n    app.DESCRIPTION.setReadOnly(true);//摘要\n    app.PAY_TYPE_NAME.setReadOnly(true);//收款方式\n    app.PAY_NO.setReadOnly(true);//结算号票据\n    app.PAY_DATE.setReadOnly(true);//收款日期\n    app.BANK_ACCOUNT_XWL.DEPOSIT_BANK_NAME.setReadOnly(true);//收款账户\n    app.SALE_ACC_ID_XWL.PAY_ACC_NAME.setReadOnly(true);//收款科目\n    app.CA_ID_XWL.CA_NAME.setReadOnly(true);//现金流名称\n  }else if(status == 'shtg'){\n    app.addBtn.setDisabled(true);//新增按钮\n    app.saveBtn.setDisabled(true);//保存按钮\n    app.verfyBtn.setDisabled(true);//审核按钮\n    app.cancelVerfyBtn.setDisabled(false);//取消审核按钮\n    app.tbar.setDisabled(true);\n    app.LEDGER_ID_XWL.LEDGER_NAME.setReadOnly(true);//账簿\n    app.GL_DATE.setReadOnly(true);//入账日期\n    app.CUSTOM_ID_XWL.CUSTOMER_NAME.setReadOnly(true);//客户\n    app.DEPT_ID_XWL.DEPT_NAME.setReadOnly(true);//成本中心\n    app.PROJECT_ID_XWL.PROJECT_NAME.setReadOnly(true);//项目\n    app.AR_CONTRACT_ID_XWL.AR_CONTRACT_NAME.setReadOnly(true);//合同\n    app.DESCRIPTION.setReadOnly(true);//摘要\n    app.PAY_TYPE_NAME.setReadOnly(true);//收款方式\n    app.PAY_NO.setReadOnly(true);//结算号票据\n    app.PAY_DATE.setReadOnly(true);//收款日期\n    app.BANK_ACCOUNT_XWL.DEPOSIT_BANK_NAME.setReadOnly(true);//收款账户\n    app.SALE_ACC_ID_XWL.PAY_ACC_NAME.setReadOnly(true);//收款科目\n    app.CA_ID_XWL.CA_NAME.setReadOnly(true);//现金流名称\n  }\n  if(!Wb.isEmpty(Wb.h_ar_inv_gl_h_id)){//从应收单跳转过来时，新增按钮始终不显示\n    app.addBtn.hide();\n  }\n}\n\nfunction initArPayByInv(data){\n  //赋值\n  app.LEDGER_ID_XWL.LEDGER_ID.setValue(data.LEDGER_ID);app.LEDGER_ID_XWL.LEDGER_NAME.setValue(data.LEDGER_NAME);\n  app.CUSTOM_ID_XWL.CUSTOMER_ID.setValue(data.CUSTOMER_ID);app.CUSTOM_ID_XWL.CUSTOMER_NAME.setValue(data.CUSTOMER_NAME);\n  app.DEPT_ID_XWL.DEPT_ID.setValue(data.DEPT_ID);app.DEPT_ID_XWL.DEPT_NAME.setValue(data.DEPT_NAME);\n  app.PROJECT_ID_XWL.PROJECT_ID.setValue(data.PROJECT_ID);app.PROJECT_ID_XWL.PROJECT_NAME.setValue(data.PROJECT_NAME);\n  app.AR_CONTRACT_ID_XWL.AR_CONTRACT_ID.setValue(data.AR_CONTRACT_ID);app.AR_CONTRACT_ID_XWL.AR_CONTRACT_NAME.setValue(data.AR_CONTRACT_NAME);\n  app.DESCRIPTION.setValue(data.DESCRIPTION);\n  app.GL_DATE.setValue(new Date());\n  app.PAY_DATE.setValue(new Date());\n  //picker查询条件赋值\n  app.CUSTOM_ID_XWL.QUERY_LEDGER_ID.setValue(data.LEDGER_ID);\n  app.DEPT_ID_XWL.QUERY_LEDGER_ID.setValue(data.LEDGER_ID);\n  app.PROJECT_ID_XWL.QUERY_LEDGER_ID.setValue(data.LEDGER_ID);\n  app.PROJECT_ID_XWL.QUERY_DEPT_ID.setValue(data.DEPT_ID);\n  app.AR_CONTRACT_ID_XWL.QUERY_LEDGER_ID.setValue(data.LEDGER_ID);\n  app.AR_CONTRACT_ID_XWL.QUERY_CUSTOMER_ID.setValue(data.CUSTOMER_ID);\n  app.BANK_ACCOUNT_XWL.QUERY_LEDGER_ID.setValue(data.LEDGER_ID);\n  app.SALE_ACC_ID_XWL.QUERY_LEDGER_ID.setValue(data.LEDGER_ID);\n}\n//整理必填项\nfunction initAllowBank(){\n  app.LEDGER_ID_XWL.LEDGER_NAME.allowBank = false;\n  app.GL_DATE.allowBlank = false;\n  app.CUSTOM_ID_XWL.CUSTOMER_NAME.allowBlank = false;\n  app.DEPT_ID_XWL.DEPT_NAME.allowBlank = false;\n  if(Wb.docCatCode == 'SKD_YUSK' || Wb.docCatCode == 'SKD_YUSK-H'){\n    app.AR_CONTRACT_ID_XWL.AR_CONTRACT_NAME.setFieldLabel(\"<font color='red'>*<\/font>合同\");\n    app.AR_CONTRACT_ID_XWL.AR_CONTRACT_NAME.allowBlank = false;\n  }else{\n    app.AR_CONTRACT_ID_XWL.AR_CONTRACT_NAME.setFieldLabel(\"合同\");\n    app.AR_CONTRACT_ID_XWL.AR_CONTRACT_NAME.allowBlank = true;\n  }\n  app.DESCRIPTION.allowBlank = false;\n  app.PAY_TYPE_NAME.allowBlank = false;\n  app.PAY_DATE.allowBlank = false;\n  app.SALE_ACC_ID_XWL.PAY_ACC_NAME.allowBlank = false;\n  //账户（收款方式为银行结算时）,不在此处处理\n  //现金留名称（收款方式为现金结算时）\n}"},"children":[{"configs":{"itemId":"form1Tbar"},"children":[{"configs":{"text":"{#addBtn#}","itemId":"addBtn","iconCls":"refresh_icon"},"events":{"click":"//新增时初始化单据,单据类型不发生改变\nWb.docStatus = 'xz'; // 单据状态 新增\nWb.ar_pay_h_id = '';//收款单id\nWb.v_head_id = '';//凭证id\nWb.h_ar_inv_gl_h_id = '';//应收单id\n\napp.form1.getForm().reset();\napp.form2.getForm().reset();\napp.grid.store.load();\n\n\n//改变界面视图\nchangeView1(Wb.docStatus);\n\nif(Wb.docCatCode == 'SKD_JSK'){\n  app.title1.show();\n  app.title2.hide();\n  app.SOURCE.setValue('GL_L');\n  app.grid1.show();\n  app.grid = app.grid1;\n\n}else if(Wb.docCatCode == 'SKD_JSK-H'){\n  app.title1.hide();\n  app.title2.show();\n  app.SOURCE.setValue('GL_H');\n  app.grid2.show();\n  app.grid = app.grid2;\n}else if(Wb.docCatCode == 'SKD_YUSK'){\n  app.title1.show();\n  app.title2.hide();\n  app.SOURCE.setValue('TEMP');\n  app.grid3.show();\n  app.grid = app.grid3;\n}else if(Wb.docCatCode == 'SKD_YUSK-H'){\n  app.title1.hide();\n  app.title2.show();\n  app.SOURCE.getStore().removeAt(0);\n  app.SOURCE.getStore().removeAt(0);\n  app.SOURCE.setValue('PAY_L');\n  app.SOURCE.setReadOnly(false);\n  app.grid4.show();\n  app.grid = app.grid4;\n}else if(Wb.docCatCode == 'SKD_QTSK'){\n  app.title1.show();\n  app.title2.hide();\n  app.SOURCE.setValue('TEMP');\n  app.grid5.show();\n  app.grid = app.grid5;\n}else if(Wb.docCatCode == 'SKD_QTSK-H'){\n  app.title1.hide();\n  app.title2.show();\n  app.SOURCE.setValue('TEMP');\n  app.grid6.show();\n  app.grid = app.grid6;\n}\n\nvar store = app.LEDGER_ID_XWL.LEDGER_NAME.getPicker().getStore();\nstore.load({\n  scope:this,\n  callback:function(records,operation,success){\n    if(success){\n      //账簿\n      app.LEDGER_ID_XWL.LEDGER_ID.setValue(records[0].data.LEDGER_ID);\n      app.LEDGER_ID_XWL.LEDGER_NAME.setValue(records[0].data.LEDGER_NAME);\n      returnRowFn(records[0],'xc_gl_ledgers');\n      clearOtherFn('xc_gl_ledgers');\n      //入账日期、收款日期\n      app.GL_DATE.setValue(new Date());\n      app.PAY_DATE.setValue(new Date());\n      //收款方式\n      app.PAY_TYPE_NAME.store.load({\n        scope : this,\n        callback : function(records,operation,success){\n          app.PAY_TYPE_ID.setValue(records[0].data.MODE_ID);\n          app.PAY_TYPE_NAME.setValue(records[0].data.MODE_NAME);\n        }\n      });\n      //制单人\n      app.CREATED_BY.setValue('{#XIP.userId#}');\n      app.CREATED_BY_NAME.setValue('{#XIP.empName#}');\n      //单据类型\n      app.AR_DOC_CAT_CODE.setValue(Wb.docCatCode);\n      //加载表格\n      app.grid.store.load();\n    }\n  }\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#saveBtn#}","itemId":"saveBtn","iconCls":"save_icon"},"events":{"click":"if(app.grid.store.getCount() === 0){\n  Wb.toast('请添加明细数据！');\n  return ;\n}\nif(!Wb.verifyGrid(app.grid)){\n  return ;\n}\nif (!Wb.verify(app.form1)) {\n  Wb.toast('表单存在非空项或者输入的数据不合法！');\n  return;\n}\n\n//计算金额\nvar srcAmt = 0;\nvar store = app.grid.getStore();\nfor(var i = 0 ; i < store.getCount() ; i++){\n  srcAmt += store.getAt(i).data.AMOUNT;\n}\napp.AMOUNT.setValue(srcAmt);\n\n//处理行部门、合同、摘要\nfor(var i=0; i<app.grid.store.getCount(); i++){\n  var rec = app.grid.store.getAt(i);\n  rec.set('DEPT_ID',app.DEPT_ID_XWL.DEPT_ID.getValue());\n  rec.set('AR_CONTRACT_ID',app.AR_CONTRACT_ID_XWL.AR_CONTRACT_ID.getValue());\n  if(Wb.isEmpty(rec.get('DESCRIPTION'))){\n    rec.set('DESCRIPTION',app.DESCRIPTION.getValue());\n  }\n}\n//获取应收款主信息数据\nvar arPayHJson = {\n  AR_PAY_H_ID\t\t:Wb.ar_pay_h_id,\n  AR_PAY_H_CODE\t\t:app.AR_PAY_H_CODE.getValue(),\n  AR_DOC_CAT_CODE\t:app.AR_DOC_CAT_CODE.getValue(),\n  LEDGER_ID\t\t\t:app.LEDGER_ID_XWL.LEDGER_ID.getValue(),\n  GL_DATE\t\t\t:app.GL_DATE.getValue(),\n  CUSTOMER_ID\t\t:app.CUSTOM_ID_XWL.CUSTOMER_ID.getValue(),\n  PROJECT_ID\t\t:app.PROJECT_ID_XWL.PROJECT_ID.getValue(),\n  DEPT_ID\t\t\t:app.DEPT_ID_XWL.DEPT_ID.getValue(),\n  AR_CONTRACT_ID\t:app.AR_CONTRACT_ID_XWL.AR_CONTRACT_ID.getValue(),\n  AMOUNT\t\t\t:app.AMOUNT.getValue(),\n  SOURCE\t\t\t:app.SOURCE.getValue(),\n  DESCRIPTION\t\t:app.DESCRIPTION.getValue(),\n  PAY_TYPE\t\t\t:app.PAY_TYPE_ID.getValue(),\n  PAY_NO\t\t\t:app.PAY_NO.getValue(),\n  PAY_DATE\t\t\t:app.PAY_DATE.getValue(),\n  SALE_ACC_ID\t\t:app.SALE_ACC_ID_XWL.PAY_ACC_ID.getValue(),\n  SALE_CCID\t\t\t:'',\n  CA_ID\t\t\t\t:app.CA_ID_XWL.CA_ID.getValue(),\n  BANK_ACCOUNT\t\t:app.BANK_ACCOUNT_XWL.DEPOSIT_BANK_ID.getValue()\n//   V_HEAD_ID\t\t\t:'',\n//   V_STATUS\t\t\t:'',\n//   VERIFIER_ID\t\t:'',\n//   VERFY_DATE\t\t:'',\n//   SIGNATORY_ID\t\t:'',\n//   SIGNATORY\t\t\t:'',\n//   SIGN_DATE\t\t\t:'',\n//   CREATION_DATE\t\t:new Date(),\n//   CREATED_BY\t\t:app.CREATED_BY.getValue(),\n//   LAST_UPDATE_DATE\t:new Date(),\n//   LAST_UPDATED_BY\t:app.CREATED_BY.getValue()\n};\n//获取行数据\nvar newRecs = store.getNewRecords();\nvar updateRecs = store.getUpdatedRecords();\nvar deleteRecs = store.getRemovedRecords();\n\n//保存数据  \n\nif(Wb.docStatus == 'xz'){\n  Wb.request({\n    url:'{#contextPath#}/arPayAction.do?method=insertArPay',\n    params:{arPayHJson : arPayHJson,\n            newRecs : Wb.getData(newRecs)\n           },\n    success:function(resp){\n      var obj = Wb.decode(resp.responseText);\n      if(obj.flag == '0'){\n        Wb.toast(obj.msg);\n        Wb.ar_pay_h_id = obj.AR_PAY_H_ID;\n        app.AR_PAY_H_CODE.setValue(obj.AR_PAY_H_CODE);\n        Wb.v_head_id = obj.V_HEAD_ID;\n        Wb.docStatus = 'cg';\n        app.V_STATUS.setValue('1');\n        app.V_STATUS_NAME.setValue('草稿');\n        store.commitChanges();//提交记录，去掉红色三角标记\n      }else{\n        Wb.toast(obj.msg);\n      }\n    }\n  });\n}else{\n  Wb.request({\n    url:'{#contextPath#}/arPayAction.do?method=updateArPay',\n    params:{arPayHJson : arPayHJson,\n            newRecs : Wb.getData(newRecs),\n            updateRecs : Wb.getData(updateRecs),\n            deleteRecs : Wb.getData(deleteRecs)\n           },\n    success:function(resp){\n      var obj = Wb.decode(resp.responseText);\n      if(obj.flag == '0'){\n        Wb.toast(obj.msg);\n        Wb.v_head_id = obj.V_HEAD_ID;//\n        store.commitChanges();//提交记录，去掉红色三角标记\n      }else{\n        Wb.toast(obj.msg);\n      }\n      \n    }\n  });\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#verfyBtn#}","itemId":"verfyBtn","iconCls":"user_edit_icon"},"events":{"click":"\nvar docs = [];//复合审核条件的单据\n\ndocs.push({\n  arId : Wb.ar_pay_h_id,\n  arCatCode : 'SKD'\n});\n\n\nif(docs.length > 0 ){\n  Wb.request({\n    url : '{#contextPath#}/arDocsAction.do?method=checkArVoucher',\n    params : {arInfo : docs},\n    success : function(resp){\n      var obj = Wb.decode(resp.responseText);\n      if(obj.flag == '0'){\n        Wb.docStatus = 'shtg';\n        app.V_STATUS.setValue('3');\n        app.V_STATUS_NAME.setValue('审核通过');\n        changeView1(Wb.docStatus);//改变界面视图\n      }\n      Wb.toast(obj.msg);\n    }\n  });\n}else{\n  Wb.toast('该单据已审核通过！');\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#cancelVerfyBtn#}","itemId":"cancelVerfyBtn","iconCls":"user_delete_icon"},"events":{"click":"\nvar docs = [];//可以取消审核的单据\n\ndocs.push({\n  arId : Wb.ar_pay_h_id,\n  arCatCode : 'SKD'\n});\n\n\nif(docs.length > 0){\n  Wb.request({\n    url: '{#contextPath#}/arDocsAction.do?method=cancelCheckArVoucher',\n    params: {arInfo: docs},\n    success: function(resp) {\n      var obj = Wb.decode(resp.responseText);\n      if(obj.flag == '0'){\n        Wb.docStatus = 'cg';\n        app.V_STATUS.setValue('1');\n        app.V_STATUS.setValue('草稿');\n        changeView1(Wb.docStatus);//改变界面视图\n      }\n      Wb.toast(obj.msg);\n    }\n  });\n}else{\n  Wb.toast('请选择未审核的记录！');\n}"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"layout":"fit","itemId":"viewport1"},"children":[{"configs":{"itemId":"tabs"},"events":{"beforetabchange":"//加载凭证信息\nif(newCard.title === app.edit_v_xwl.xwl_v_panel.title){\n    Wb.request({\n        url: 'm?xwl=xc/gl/journal/data-db/common-data/select-v-head',\n        params: {'headId' : Wb.v_head_id},\n        success: function(resp) {\n            var headJson = Wb.decode(resp.responseText);\n            Wb.setValue(app.edit_v_xwl.form1,headJson);\n            Wb.setValue(app.edit_v_xwl.bbar,headJson);\n            //处理会计日期\n            var accDate = headJson.accountDate;\n            app.edit_v_xwl.accountDate.setValue(Wb.strToDate(accDate));\n        }\n    });\n    // 加载凭证分录行\n    app.edit_v_xwl.grid1.getStore().load({params :{'headId':Wb.v_head_id}});\n}\n"},"children":[{"configs":{"title":"收款单","layout":"border","itemId":"tab1"},"children":[{"configs":{"tbar":"app.form1Tbar","region":"north","autoScroll":"true","layout":"auto","itemId":"form1","border":"false"},"children":[{"configs":{"html":"<font size = '5' color = 'black'>{#title_skd#}<\/font>","margin":"10 0 20 0","labelAlign":"center","itemId":"title_skd"},"children":[],"expanded":false,"type":"label"},{"configs":{"html":"<font size = '5' color = 'red'>{#title_tkd#}<\/font>","margin":"10 0 20 0","labelAlign":"center","itemId":"title_tkd"},"children":[],"expanded":false,"type":"label"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"column","margin":"10 10 0 10","itemId":"tr1"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"fit","columnWidth":".25","itemId":"tr1_td1"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/LEDGER_ID_PICK/LEDGER_ID_PICK_SEC","itemId":"LEDGER_ID_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"fit","columnWidth":".25","itemId":"tr1_td2"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","allowBlank":"false","labelAlign":"right","pickList":"[\n  ['SKD_JSK','结算款'],\n  ['SKD_YUSK','预收款'],\n  ['SKD_QTSK','其它收款'],\n  ['SKD_JSK-H','结算款-红字'],\n  ['SKD_YUSK-H','预收款-红字'],\n  ['SKD_QTSK-H','其它收款-红字']\n]","itemId":"AR_DOC_CAT_CODE","fieldLabel":"<font color='red'>*<\/font>{#AR_DOC_CAT_CODE1#}"},"events":{"change":"if(newValue=='FKD_CGJS-H'||newValue=='FKD_YUFK-H'||newValue=='FKD_QTFK-H'){\n\tapp.title.setText('<font style=\"color:red;\">付款单<\/font>',false);\n    app.AMOUNT.setFieldStyle('color:red;');\n}\nif(newValue === 'FKD_YUFK' || newValue === 'FKD_YUFK-H'){\n\tapp.AP_CONTRACT_ID_XWL.AP_CONTRACT_NAME.setFieldLabel('<font style=\"color:red;\">*<\/font>'+'合同名称');\n    app.AP_CONTRACT_ID_XWL.AP_CONTRACT_NAME.allowBlank = false;\n}"},"children":[],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"fit","columnWidth":".25","itemId":"tr1_td3"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","emptyText":"系统自动生成","labelAlign":"right","itemId":"AR_PAY_H_CODE","fieldLabel":"<font color='red'>*<\/font>{#AR_PAY_H_CODE#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"fit","columnWidth":".25","itemId":"tr1_td4"},"children":[{"configs":{"labelWidth":"80","allowBlank":"false","labelAlign":"right","itemId":"GL_DATE","fieldLabel":"<font color='red'>*<\/font>{#GL_DATE#}"},"children":[],"expanded":false,"type":"date"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"column","margin":"10 10 0 10","itemId":"tr2"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"fit","columnWidth":".25","border":"false","itemId":"tr2_td1"},"children":[{"configs":{"file":"m?xwl=xc/ar/ar-com-lov/AR_CUSTOMER_ID_PICK/AR_CUSTOMER_ID_PICK","itemId":"CUSTOM_ID_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".25","border":"false","itemId":"tr2_td2"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/DEPT_ID_PICK/DEPT_ID_LD","itemId":"DEPT_ID_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"fit","columnWidth":".25","itemId":"tr2_td3"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/PROJECT_ID_PICK/PROJECT_ID_LD","itemId":"PROJECT_ID_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"fit","columnWidth":".25","itemId":"tr2_td31"},"children":[{"configs":{"file":"m?xwl=xc/ar/ar-com-lov/AR_CONTRACT_ID_PICK/AR_CONTRACT_ID_PICK_ALL","itemId":"AR_CONTRACT_ID_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"column","margin":"10 10 0 10","itemId":"tr3"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"fit","columnWidth":".25","border":"false","itemId":"tr3_td1"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","allowBlank":"false","pickList":"[\n  ['GL_L','应收单（蓝）'],\n  ['GL_H','应收单（红）'],\n  ['PAY_L','收款单（蓝）'],\n  ['TEMP','手工模板']\n]","labelAlign":"right","itemId":"SOURCE","fieldLabel":"<font color = 'red'>*<\/font>{#SOURCE#}"},"events":{"change":"if(Wb.docCatCode == 'SKD_YUSK-H' && newValue == 'PAY_L'){\n  app.selectArPayBtn4.show();\n  app.addTempBtn4.hide();\n}else if(Wb.docCatCode == 'SKD_YUSK-H' && newValue == 'TEMP'){\n  app.selectArPayBtn4.hide();\n  app.addTempBtn4.show();\n}"},"children":[],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".5","border":"false","itemId":"tr3_td2"},"children":[{"configs":{"labelWidth":"80","allowBlank":"false","labelAlign":"right","itemId":"DESCRIPTION","fieldLabel":"<font color = 'red'>*<\/font>{#DESCRIPTION#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"title":"收款信息","layout":"fit","itemId":"fieldset1"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"column","margin":"0 0 10 0","itemId":"f2_tr1"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".25","itemId":"f2_tr1_td1"},"children":[{"configs":{"itemId":"PAY_TYPE_ID"},"children":[],"expanded":false,"type":"hidden"},{"configs":{"labelWidth":"80","allowBlank":"false","displayField":"MODE_NAME","valueField":"MODE_NAME","labelAlign":"right","itemId":"PAY_TYPE_NAME","fieldLabel":"<font color='red'>*<\/font>{#PAY_TYPE_NAME#}","editable":"false"},"events":{"change":"if(newValue == '银行结算' && (Wb.docStatus == 'xz' || Wb.docStatus == 'cg')){\n  app.BANK_ACCOUNT_XWL.DEPOSIT_BANK_NAME.setReadOnly(false);\n}else{\n  app.BANK_ACCOUNT_XWL.DEPOSIT_BANK_NAME.setReadOnly(true);\n}","select":"app.PAY_TYPE_ID.setValue(records[0].data.MODE_ID);"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/ar/pay/DB/payTypeSelect"},"events":{"beforeload":"store.proxy.extraParams.LEDGER_ID = app.LEDGER_ID_XWL.LEDGER_ID.getValue();"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".25","itemId":"f2_tr1_td2"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"PAY_NO","fieldLabel":"{#PAY_NO#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".25","itemId":"f2_tr1_td3"},"children":[{"configs":{"labelWidth":"80","allowBlank":"false","labelAlign":"right","itemId":"PAY_DATE","fieldLabel":"<font color='red'>*<\/font>{#PAY_DATE#}"},"children":[],"expanded":false,"type":"date"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".25","itemId":"f2_tr1_td4"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"AMOUNT","fieldLabel":"<font color = 'red'>*<\/font>{#AMOUNT#}"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"column","margin":"0 0 10 0","itemId":"f2_tr2"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".25","itemId":"f2_tr2_td1"},"children":[{"configs":{"file":"m?xwl=xc/ar/ar-com-lov/DEPOSIT_BANK_ID_PICK/DEPOSIT_BANK_ID_LD","itemId":"BANK_ACCOUNT_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".25","itemId":"f2_tr2_td2"},"children":[{"configs":{"file":"m?xwl=xc/ar/ar-com-lov/ACC_ID_PICK/PAY_ACC_ID_PICK","itemId":"SALE_ACC_ID_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".25","itemId":"f2_tr2_td3"},"children":[{"configs":{"file":"m?xwl=xc/ar/ar-com-lov/CA_ID_PICK/CA_ID_PICK_ALL","itemId":"CA_ID_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"fieldset"}],"expanded":true,"type":"form"},{"configs":{"region":"center","pagingBar":"false","hidden":"true","itemId":"grid1","editable":"true"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/ar/pay/DB/select_xc_ar_pay_l"},"events":{"beforeload":"operation.params = {\n  AR_PAY_H_ID : Wb.ar_pay_h_id\n};"},"children":[],"expanded":false,"type":"store"},{"configs":{"normalName":"grid1Tbar","itemId":"tbar"},"children":[{"configs":{"text":"{#selectArInvBtn1#}","itemId":"selectArInvBtn1","iconCls":"seek_icon"},"events":{"click":"var ledger_id = app.LEDGER_ID_XWL.LEDGER_ID.getValue();//账簿id\nvar customer_id = app.CUSTOM_ID_XWL.CUSTOMER_ID.getValue();//客户id\n//判断,过滤条件\nif(Wb.isEmpty(ledger_id)){\n  Wb.toast('请选择账簿！');\n  return ;\n}\nif(Wb.isEmpty(customer_id)){\n  Wb.toast('请选择客户！');\n  return ;\n}\nvar curGrid = app.grid1;\nWb.run({\n  url: 'm?xwl=xc/ar/pay/LOV/LOV_SELECT_INV_WIN', \n  success: function(app) {\n    app.initWin({\n      LEDGER_ID : ledger_id,\n      CUSTOMER_ID : customer_id,\n      AR_CAT_DOC_CODE : 'SKD_JSK',\n      hideFun:function(recs){\n        Ext.each(recs,function(rec){\n          Wb.addEdit(curGrid,{\n            AR_PAY_L_ID : '',\n            AR_PAY_H_ID : Wb.ar_pay_h_id,\n            AR_INV_GL_H_ID : rec.data.AR_INV_GL_H_ID,\n            AR_INV_GL_H_CODE : rec.data.AR_INV_GL_H_CODE,\n            PROJECT_ID : rec.data.PROJECT_ID,\n            PROJECT_NAME : rec.data.PROJECT_NAME,\n            AR_CONTRACT_ID : rec.data.AR_CONTRACT_ID,\n            AR_CONTRACT_NAME : rec.data.AR_CONTRACT_NAME,\n            DEPT_ID : rec.data.DEPT_ID,\n            DEPT_NAME : rec.data.DEPT_NAME,\n            AR_DOC_CAT_CODE : rec.data.AR_DOC_CAT_CODE,\n            AMOUNT : rec.data.JS_AMOUNT,\n            ACC_ID : rec.data.AR_ACC_ID_DEBT,\n            ACC_NAME : rec.data.AR_ACC_NAME_DEBT,\n            CCID : rec.data.AR_CCID_DEBT,\n            CCID_NAME : rec.data.AR_CCID_NAME_DEBT,\n            AR_CREATED_BY_NAME : '{#XIP.empName#}',\n            DESCRIPTION : rec.data.DESCRIPTION,\n            CREATION_DATE : null,\n            CREATED_BY : null,\n            LAST_UPDATE_DATE : null,\n            LAST_UPDATED_BY : null\n          }, 'after', 1, false);\n        });\n      }\n    });\n    \n  }\n});\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#deleteBtn#}","itemId":"deleteBtn1","iconCls":"file_delete_icon"},"events":{"click":"Wb.remove(app.grid1);"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#rownum#}","xtype":"rownumberer","titleAlign":"center","itemId":"rownum1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#AR_INV_GL_H_CODE_COL#}","width":"150","dataIndex":"AR_INV_GL_H_CODE","titleAlign":"center","itemId":"AR_INV_GL_H_CODE_COL1"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#AR_DOC_CAT_CODE_COL#}","width":"100","dataIndex":"AR_DOC_CAT_CODE","titleAlign":"center","itemId":"AR_DOC_CAT_CODE_COL1","renderer":"if(value == 'YSD'){\n  return '应收单';\n}else if(value == 'YSD-H'){\n  return '应收单-红';\n}"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#AR_CONTRACT_NAME_COL#}","width":"150","dataIndex":"AR_CONTRACT_NAME","titleAlign":"center","itemId":"AR_CONTRACT_NAME_COL1"},"children":[{"configs":{"labelWidth":"100","labelAlign":"right","itemId":"editor","normalName":"AP_CONTRACT_NAME_PICK1"},"children":[{"configs":{"tagConfigs":"minWidth:400","itemId":"pickComp"},"events":{"itemdblclick":"var r=app.grid.getSelectionModel().getSelection()[0];\nr.set('AP_CONTRACT_ID',record.data.AP_CONTRACT_ID);\nr.set('AP_CONTRACT_NAME',record.data.AP_CONTRACT_NAME);\nr.dirty = true;\napp.AP_CONTRACT_NAME_PICK1.setValue(record.data.AP_CONTRACT_NAME);\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"pageSize":"5","itemId":"store","autoLoad":"true","url":"m?xwl=xc/ap/ap-com-lov/AP_CONTRACT_ID_PICK/DB/GRID_XC_AP_CONTRACT_SELECT"},"events":{"beforeload":"operation.params = Wb.getValue([app.form1,app.tbar]);"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","dataIndex":"AP_CONTRACT_ID","itemId":"AP_CONTRACT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"项目编码","dataIndex":"AP_CONTRACT_CODE","itemId":"AP_CONTRACT_CODE_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"项目名称","dataIndex":"AP_CONTRACT_NAME","itemId":"AP_CONTRACT_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"100","emptyText":"合同编码/名称","labelAlign":"right","itemId":"QUERY_CODE_NAME"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.pickComp.getStore().load();\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":false,"type":"column"},{"configs":{"text":"{#DEPT_NAME_COL#}","hidden":"true","width":"150","dataIndex":"DEPT_NAME","titleAlign":"center","itemId":"DEPT_NAME_COL1"},"children":[{"configs":{"labelWidth":"100","labelAlign":"right","itemId":"editor","normalName":"DEPT_NAME_PICK1"},"children":[{"configs":{"tagConfigs":"minWidth:400","itemId":"pickComp"},"events":{"itemdblclick":"var r=app.grid.getSelectionModel().getSelection()[0];\nr.set('DEPT_ID',record.data.DEPT_ID);\nr.set('DEPT_NAME',record.data.DEPT_NAME);\nr.dirty = true;\napp.DEPT_NAME_PICK1.setValue(record.data.DEPT_NAME);\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"pageSize":"5","itemId":"store","autoLoad":"true","url":"m?xwl=xc/com-lov/DEPT_ID_PICK/DB/GRID_XIP_PUB_DEPTS_SELECT_LD"},"events":{"beforeload":"operation.params = Wb.getValue([app.form1,app.tbar]);"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","dataIndex":"DEPT_ID","itemId":"DEPT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"成本中心编码","dataIndex":"DEPT_CODE","itemId":"DEPT_CODE_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"成本中心名称","dataIndex":"DEPT_NAME","itemId":"DEPT_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"100","emptyText":"成本中心编码/名称","labelAlign":"right","itemId":"QUERY_CODE_NAME"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.pickComp.getStore().load();\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":false,"type":"column"},{"configs":{"text":"{#PROJECT_NAME_COL#}","width":"150","dataIndex":"PROJECT_NAME","titleAlign":"center","itemId":"PROJECT_NAME_COL1"},"children":[{"configs":{"labelWidth":"100","labelAlign":"right","itemId":"editor","normalName":"PROJECT_NAME_PICK1"},"children":[{"configs":{"tagConfigs":"minWidth:400","itemId":"pickComp"},"events":{"itemdblclick":"var r=app.grid.getSelectionModel().getSelection()[0];\nr.set('PROJECT_ID',record.data.PROJECT_ID);\nr.set('PROJECT_NAME',record.data.PROJECT_NAME);\nr.dirty = true;\napp.PROJECT_NAME_PICK1.setValue(record.data.PROJECT_NAME);\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"pageSize":"5","itemId":"store","autoLoad":"true","url":"m?xwl=xc/com-lov/PROJECT_ID_PICK/DB/GRID_XC_PM_PROJECT_SELECT"},"events":{"beforeload":"operation.params = {\n  QUERY_LEDGER_ID : app.LEDGER_ID_XWL.LEDGER_ID.getValue(),\n  QUERY_DEPT_ID : app.DEPT_ID_XWL.DEPT_ID.getValue(),\n  QUERY_CODE_NAME : app.QUERY_CODE_NAME.getValue()\n};"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","dataIndex":"PROJECT_ID","itemId":"PROJECT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"项目编码","dataIndex":"PROJECT_CODE","itemId":"PROJECT_CODE_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"项目名称","dataIndex":"PROJECT_NAME","itemId":"PROJECT_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"100","emptyText":"项目编码/名称","labelAlign":"right","itemId":"QUERY_CODE_NAME"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.pickComp.getStore().load();\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":false,"type":"column"},{"configs":{"text":"{#ACC_NAME_COL#}","width":"150","dataIndex":"ACC_NAME","titleAlign":"center","itemId":"ACC_NAME_COL1"},"children":[{"configs":{"labelWidth":"100","allowBlank":"false","labelAlign":"right","itemId":"editor","normalName":"ACC_NAME_PICK1"},"events":{"change":"var r=app.grid.getSelectionModel().getSelection()[0];\nr.set('CCID','');\nr.set('CCID_NAME','');"},"children":[{"configs":{"tagConfigs":"minWidth:400","itemId":"pickComp"},"events":{"itemdblclick":"var r=app.grid.getSelectionModel().getSelection()[0];\nr.set('ACC_ID',record.data.ACC_ID);\nr.set('ACC_NAME',record.data.ACC_NAME);\nr.dirty = true;\napp.ACC_NAME_PICK1.setValue(record.data.ACC_NAME);\nvar picker = this.ownerCmp;\npicker.collapse();\n"},"children":[{"configs":{"pageSize":"5","itemId":"store","autoLoad":"true","url":"m?xwl=xc/com-lov/ACC_ID_PICK/DB/XC_BG_LD_ACCOUNTS_SELECT_LD"},"events":{"beforeload":"operation.params = Wb.getValue([app.form1,app.tbar]);"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","dataIndex":"ACC_ID","itemId":"ACC_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"科目编码","dataIndex":"ACC_CODE","itemId":"ACC_CODE_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"科目名称","dataIndex":"ACC_NAME","itemId":"ACC_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"100","emptyText":"科目编码/名称","labelAlign":"right","itemId":"QUERY_CODE_NAME"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.pickComp.getStore().load();\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":false,"type":"column"},{"configs":{"text":"{#CCID_NAME_COL#}","width":"150","dataIndex":"CCID_NAME","titleAlign":"center","itemId":"CCID_NAME_COL1"},"children":[{"configs":{"displayField":"CCID_NAME","triggerCls":"x-form-search-trigger","valueField":"CCID","itemId":"editor","onTriggerClick":"  // 账簿\n  var ledgerId = app.LEDGER_ID_XWL.LEDGER_ID.getValue() ;\n  if(ledgerId === \"\" ||ledgerId === null || ledgerId === undefined){\n    Wb.info('请选择账簿!') ;\n    return false ;\n  }\n  \n  // 会计日期\n  var accDate = app.GL_DATE.getValue() ;\n  if(accDate === \"\" ||accDate === null || accDate === undefined){\n    Wb.info('请选择会计日期!') ;\n    return false ;\n  }else{\n\taccDate = Wb.dateToStr(accDate).substring(0,7);\n  }\n  \n  // TODO: 当前选中\n  var r = app.grid.getSelection()[0] ; \n  \n  // TODO: 显示科目选择窗口\n  Wb.run({\n    url:'m?xwl=xc/gl/journal/v-windows/handler-ccid-win',\n    params : {\n      'ledgerId' : ledgerId,\n      'vtype' : '{#vtype#}'\n    },          \n    success:function(appObj){\n      appObj.initWindow({\n        accName : r.data.ACC_NAME,\n        ledgerId : ledgerId,\n        periodCode : accDate ,\n        groupId : 'ALL',\n        handlerCCID : function(returnObj){\n          // TODO: 处理CCID信息\n          var rObj = Wb.decode(returnObj) ;\n          r.set('ACC_ID', rObj.acc_id) ;    \n          r.set('ACC_NAME', rObj.acc_name);\n          r.set('CCID', rObj.acc_ccid) ;    \n          r.set('CCID_NAME', rObj.acc_ccid_name);\n          if(!Wb.isEmpty(rObj.dim_id)){\n          r.set('DIM_ID', rObj.dim_id) ;\n          r.set('DIM_NAME', rObj.dim_name) ;\n          }\n          // 禁用账簿\n           app.LEDGER_ID_XWL.LEDGER_ID.setReadOnly(true) ;\n        }\n      });\n    }  \n  }) ;   "},"events":{"beforequery":"var combo = e.combo;\nif(!e.forceAll){\n  var value = e.query;\n  combo.store.filterBy(function(record,id){\n    var text = record.get(combo.displayField);\n    return (text.indexOf(value)!=-1);\n  });\n  combo.expand();\n  return false;\n}","specialkey":"// TODO: 按回车键执行借方和贷方金额切换\nif (e.getKey() == e.ENTER) {\n  // 账簿\n  var ledgerId = app.LEDGER_ID_XWL.LEDGER_ID.getValue() ;\n  if(ledgerId === \"\" ||ledgerId === null || ledgerId === undefined){\n    Wb.info('请选择账簿!') ;\n    return false ;\n  }\n  \n  // 会计日期\n  var accDate = app.GL_DATE.getValue();\n  if(accDate === \"\" ||accDate === null || accDate === undefined){\n    Wb.info('请选择会计日期!') ;\n    return false ;\n  }else{\n    accDate = Wb.dateToStr(accDate).substring(0,7);\n  }\n  \n  // TODO: 当前选中\n  var r = app.grid.getSelection()[0] ; \n  \n  // TODO: 显示科目选择窗口\n  Wb.run({\n    url:'m?xwl=xc/gl/journal/v-windows/handler-ccid-win',\n    params : {\n      'ledgerId' : ledgerId ,\n      'vtype' : '{#vtype#}'\n    },          \n    success:function(appObj){\n      appObj.initWindow({\n        accName : r.data.ACC_NAME,\n        ledgerId : ledgerId,\n        periodCode : accDate ,\n        groupId : 'ALL',\n        handlerCCID : function(returnObj){\n          // TODO: 处理CCID信息\n          var rObj = Wb.decode(returnObj) ;\n          r.set('ACC_ID', rObj.acc_id) ;    \n          r.set('ACC_NAME', rObj.acc_name);\n          r.set('CCID', rObj.acc_ccid) ;    \n          r.set('CCID_NAME', rObj.acc_ccid_name);\n          if(!Wb.isEmpty(rObj.dim_id)){\n            r.set('DIM_ID', rObj.dim_id) ;\n            r.set('DIM_NAME', rObj.dim_name) ;\n          }\n          // 禁用账簿\n           app.LEDGER_ID_XWL.LEDGER_ID.setReadOnly(true) ;\n        }\n      });\n    }  \n  }) ;   \n}"},"children":[],"expanded":true,"type":"combo"}],"expanded":true,"type":"column"},{"configs":{"text":"{#AMOUNT_COL#}","align":"right","width":"100","dataIndex":"AMOUNT","titleAlign":"center","itemId":"AMOUNT_COL1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#AR_CREATED_BY_NAME_COL#}","hidden":"true","width":"150","dataIndex":"AR_CREATED_BY_NAME","titleAlign":"center","itemId":"AR_CREATED_BY_NAME_COL1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#DESCRIPTION_COL#}","dataIndex":"DESCRIPTION","titleAlign":"center","itemId":"DESCRIPTION_COL1","flex":"1"},"children":[{"configs":{"itemId":"editor"},"children":[],"expanded":false,"type":"textarea"}],"expanded":true,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"},{"configs":{"region":"center","pagingBar":"false","hidden":"true","itemId":"grid2"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/ar/pay/DB/select_xc_ar_pay_l"},"events":{"beforeload":"operation.params = {\n  AR_PAY_H_ID : Wb.ar_pay_h_id\n};"},"children":[],"expanded":false,"type":"store"},{"configs":{"normalName":"grid2Tbar","itemId":"tbar"},"children":[{"configs":{"text":"{#selectArInvBtn2#}","itemId":"selectArInvBtn2","iconCls":"seek_icon"},"events":{"click":"var ledger_id = app.LEDGER_ID_XWL.LEDGER_ID.getValue();//账簿id\nvar customer_id = app.CUSTOM_ID_XWL.CUSTOMER_ID.getValue();//客户id\n//判断,过滤条件 账簿 有合同就按合同过滤，没有就算了\nif(Wb.isEmpty(ledger_id)){\n  Wb.toast('请选择账簿！');\n  return ;\n}\nif(Wb.isEmpty(customer_id)){\n  Wb.toast('请选择客户！');\n  return ;\n}\nvar curGrid = app.grid1;\nWb.run({\n  url: 'm?xwl=xc/ar/pay/LOV/LOV_SELECT_INV_WIN', \n  success: function(app) {\n    app.initWin({\n      LEDGER_ID : ledger_id,\n      CUSTOMER_ID : customer_id,\n      AR_CAT_DOC_CODE : 'SKD_JSK-H',\n      hideFun:function(recs){\n        Ext.each(recs,function(rec){\n          Wb.addEdit(curGrid,{\n            AR_PAY_L_ID : '',\n            AR_PAY_H_ID : Wb.ar_pay_h_id,\n            AR_INV_GL_H_ID : rec.data.AR_INV_GL_H_ID,\n            AR_INV_GL_H_CODE : rec.data.AR_INV_GL_H_CODE,\n            PROJECT_ID : rec.data.PROJECT_ID,\n            PROJECT_NAME : rec.data.PROJECT_NAME,\n            AR_CONTRACT_ID : rec.data.AR_CONTRACT_ID,\n            AR_CONTRACT_NAME : rec.data.AR_CONTRACT_NAME,\n            DEPT_ID : rec.data.DEPT_ID,\n            DEPT_NAME : rec.data.DEPT_NAME,\n            AR_DOC_CAT_CODE : rec.data.AR_DOC_CAT_CODE,\n            AMOUNT : rec.data.JS_AMOUNT,\n            ACC_ID : rec.data.AR_ACC_ID_DEBT,\n            ACC_NAME : rec.data.AR_ACC_NAME_DEBT,\n            CCID : rec.data.AR_CCID_DEBT,\n            CCID_NAME : rec.data.AR_CCID_NAME_DEBT,\n            AR_CREATED_BY_NAME : '{#XIP.empName#}',\n            DESCRIPTION : rec.data.DESCRIPTION\n          }, 'after', 1, false);\n        });\n      }\n    });\n    \n  }\n});\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#deleteBtn#}","itemId":"deleteBtn2","iconCls":"file_delete_icon"},"events":{"click":"Wb.remove(app.grid2);"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#rownum#}","xtype":"rownumberer","titleAlign":"center","itemId":"rownum2"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#AR_INV_GL_H_CODE_COL#}","width":"200 ","dataIndex":"AR_INV_GL_H_CODE","titleAlign":"center","itemId":"AR_INV_GL_H_CODE_COL2"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#AR_DOC_CAT_CODE_COL#}","width":"100","dataIndex":"AR_DOC_CAT_CODE","titleAlign":"center","itemId":"AR_DOC_CAT_CODE_COL2"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#AR_CONTRACT_NAME_COL#}","width":"150","dataIndex":"AR_CONTRACT_NAME","titleAlign":"center","itemId":"AR_CONTRACT_NAME_COL2"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#DEPT_NAME_COL#}","hidden":"true","width":"150","dataIndex":"DEPT_NAME","titleAlign":"center","itemId":"DEPT_NAME_COL2"},"children":[{"configs":{"labelWidth":"100","labelAlign":"right","itemId":"editor","normalName":"DEPT_NAME_PICK2"},"children":[{"configs":{"tagConfigs":"minWidth:400","itemId":"pickComp"},"events":{"itemdblclick":"var r=app.grid.getSelectionModel().getSelection()[0];\nr.set('DEPT_ID',record.data.DEPT_ID);\nr.set('DEPT_NAME',record.data.DEPT_NAME);\nr.dirty = true;\napp.DEPT_NAME_PICK2.setValue(record.data.DEPT_NAME);\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"pageSize":"5","itemId":"store","autoLoad":"true","url":"m?xwl=xc/com-lov/DEPT_ID_PICK/DB/GRID_XIP_PUB_DEPTS_SELECT_LD"},"events":{"beforeload":"operation.params = Wb.getValue([app.form1,app.tbar]);"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","dataIndex":"DEPT_ID","itemId":"DEPT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"成本中心编码","dataIndex":"DEPT_CODE","itemId":"DEPT_CODE_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"成本中心名称","dataIndex":"DEPT_NAME","itemId":"DEPT_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"100","emptyText":"成本中心编码/名称","labelAlign":"right","itemId":"QUERY_CODE_NAME"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.pickComp.getStore().load();\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":false,"type":"column"},{"configs":{"text":"{#PROJECT_NAME_COL#}","width":"150","dataIndex":"PROJECT_NAME","titleAlign":"center","itemId":"PROJECT_NAME_COL2"},"children":[{"configs":{"labelWidth":"100","labelAlign":"right","itemId":"editor","normalName":"PROJECT_NAME_PICK2"},"children":[{"configs":{"tagConfigs":"minWidth:400","itemId":"pickComp"},"events":{"itemdblclick":"var r=app.grid.getSelectionModel().getSelection()[0];\nr.set('PROJECT_ID',record.data.PROJECT_ID);\nr.set('PROJECT_NAME',record.data.PROJECT_NAME);\nr.dirty = true;\napp.PROJECT_NAME_PICK2.setValue(record.data.PROJECT_NAME);\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"pageSize":"5","itemId":"store","autoLoad":"true","url":"m?xwl=xc/com-lov/PROJECT_ID_PICK/DB/GRID_XC_PM_PROJECT_SELECT"},"events":{"beforeload":"operation.params = {\n  QUERY_LEDGER_ID : app.LEDGER_ID_XWL.LEDGER_ID.getValue(),\n  QUERY_DEPT_ID : app.DEPT_ID_XWL.DEPT_ID.getValue(),\n  QUERY_CODE_NAME : app.QUERY_CODE_NAME.getValue()\n};"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","dataIndex":"PROJECT_ID","itemId":"PROJECT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"项目编码","dataIndex":"PROJECT_CODE","itemId":"PROJECT_CODE_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"项目名称","dataIndex":"PROJECT_NAME","itemId":"PROJECT_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"100","emptyText":"项目编码/名称","labelAlign":"right","itemId":"QUERY_CODE_NAME"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.pickComp.getStore().load();\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":false,"type":"column"},{"configs":{"text":"{#ACC_NAME_COL#}","width":"150","dataIndex":"ACC_NAME","titleAlign":"center","itemId":"ACC_NAME_COL2"},"children":[{"configs":{"labelWidth":"100","allowBlank":"false","labelAlign":"right","itemId":"editor","normalName":"ACC_NAME_PICK2"},"events":{"change":"var r=app.grid.getSelectionModel().getSelection()[0];\nr.set('CCID','');\nr.set('CCID_NAME','');"},"children":[{"configs":{"tagConfigs":"minWidth:400","itemId":"pickComp"},"events":{"itemdblclick":"var r=app.grid.getSelectionModel().getSelection()[0];\nr.set('ACC_ID',record.data.ACC_ID);\nr.set('ACC_NAME',record.data.ACC_NAME);\nr.dirty = true;\napp.ACC_NAME_PICK2.setValue(record.data.ACC_NAME);\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"pageSize":"5","itemId":"store","autoLoad":"true","url":"m?xwl=xc/com-lov/ACC_ID_PICK/DB/XC_BG_LD_ACCOUNTS_SELECT_LD"},"events":{"beforeload":"operation.params = Wb.getValue([app.form1,app.tbar]);"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","dataIndex":"ACC_ID","itemId":"ACC_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"科目编码","dataIndex":"ACC_CODE","itemId":"ACC_CODE_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"科目名称","dataIndex":"ACC_NAME","itemId":"ACC_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"100","emptyText":"科目编码/名称","labelAlign":"right","itemId":"QUERY_CODE_NAME"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.pickComp.getStore().load();\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":false,"type":"column"},{"configs":{"text":"{#CCID_NAME_COL#}","width":"150","dataIndex":"CCID_NAME","titleAlign":"center","itemId":"CCID_NAME_COL2"},"children":[{"configs":{"displayField":"CCID_NAME","triggerCls":"x-form-search-trigger","valueField":"CCID","itemId":"editor","onTriggerClick":"  // 账簿\n  var ledgerId = app.LEDGER_ID_XWL.LEDGER_ID.getValue() ;\n  if(ledgerId === \"\" ||ledgerId === null || ledgerId === undefined){\n    Wb.info('请选择账簿!') ;\n    return false ;\n  }\n  \n  // 会计日期\n  var accDate = app.GL_DATE.getValue() ;\n  if(accDate === \"\" ||accDate === null || accDate === undefined){\n    Wb.info('请选择会计日期!') ;\n    return false ;\n  }else{\n\taccDate = Wb.dateToStr(accDate).substring(0,7);\n  }\n  \n  // TODO: 当前选中\n  var r = app.grid.getSelection()[0] ; \n  \n  // TODO: 显示科目选择窗口\n  Wb.run({\n    url:'m?xwl=xc/gl/journal/v-windows/handler-ccid-win',\n    params : {\n      'ledgerId' : ledgerId,\n      'vtype' : '{#vtype#}'\n    },          \n    success:function(appObj){\n      appObj.initWindow({\n        accName : r.data.ACC_NAME,\n        ledgerId : ledgerId,\n        periodCode : accDate ,\n        groupId : 'ALL',\n        handlerCCID : function(returnObj){\n          // TODO: 处理CCID信息\n          var rObj = Wb.decode(returnObj) ;\n          r.set('ACC_ID', rObj.acc_id) ;    \n          r.set('ACC_NAME', rObj.acc_name);\n          r.set('CCID', rObj.acc_ccid) ;    \n          r.set('CCID_NAME', rObj.acc_ccid_name);\n          if(!Wb.isEmpty(rObj.dim_id)){\n          r.set('DIM_ID', rObj.dim_id) ;\n          r.set('DIM_NAME', rObj.dim_name) ;\n          }\n          // 禁用账簿\n           app.LEDGER_ID_XWL.LEDGER_ID.setReadOnly(true) ;\n        }\n      });\n    }  \n  }) ;   "},"events":{"beforequery":"var combo = e.combo;\nif(!e.forceAll){\n  var value = e.query;\n  combo.store.filterBy(function(record,id){\n    var text = record.get(combo.displayField);\n    return (text.indexOf(value)!=-1);\n  });\n  combo.expand();\n  return false;\n}","specialkey":"// TODO: 按回车键执行借方和贷方金额切换\nif (e.getKey() == e.ENTER) {\n  // 账簿\n  var ledgerId = app.LEDGER_ID_XWL.LEDGER_ID.getValue() ;\n  if(ledgerId === \"\" ||ledgerId === null || ledgerId === undefined){\n    Wb.info('请选择账簿!') ;\n    return false ;\n  }\n  \n  // 会计日期\n  var accDate = app.GL_DATE.getValue();\n  if(accDate === \"\" ||accDate === null || accDate === undefined){\n    Wb.info('请选择会计日期!') ;\n    return false ;\n  }else{\n    accDate = Wb.dateToStr(accDate).substring(0,7);\n  }\n  \n  // TODO: 当前选中\n  var r = app.grid.getSelection()[0] ; \n  \n  // TODO: 显示科目选择窗口\n  Wb.run({\n    url:'m?xwl=xc/gl/journal/v-windows/handler-ccid-win',\n    params : {\n      'ledgerId' : ledgerId ,\n      'vtype' : '{#vtype#}'\n    },          \n    success:function(appObj){\n      appObj.initWindow({\n        accName : r.data.ACC_NAME,\n        ledgerId : ledgerId,\n        periodCode : accDate ,\n        groupId : 'ALL',\n        handlerCCID : function(returnObj){\n          // TODO: 处理CCID信息\n          var rObj = Wb.decode(returnObj) ;\n          r.set('ACC_ID', rObj.acc_id) ;    \n          r.set('ACC_NAME', rObj.acc_name);\n          r.set('CCID', rObj.acc_ccid) ;    \n          r.set('CCID_NAME', rObj.acc_ccid_name);\n          if(!Wb.isEmpty(rObj.dim_id)){\n            r.set('DIM_ID', rObj.dim_id) ;\n            r.set('DIM_NAME', rObj.dim_name) ;\n          }\n          // 禁用账簿\n           app.LEDGER_ID_XWL.LEDGER_ID.setReadOnly(true) ;\n        }\n      });\n    }  \n  }) ;   \n}"},"children":[],"expanded":true,"type":"combo"}],"expanded":true,"type":"column"},{"configs":{"text":"{#AMOUNT_COL#}","align":"right","width":"100","dataIndex":"AMOUNT","titleAlign":"center","format":"0,000.00","itemId":"AMOUNT_COL2"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#AR_CREATED_BY_NAME_COL#}","hidden":"true","dataIndex":"AR_CREATED_BY_NAME","titleAlign":"center","itemId":"AR_CREATED_BY_NAME_COL2"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#DESCRIPTION_COL#}","dataIndex":"DESCRIPTION","titleAlign":"center","itemId":"DESCRIPTION_COL2","flex":"1"},"children":[{"configs":{"itemId":"editor"},"children":[],"expanded":false,"type":"textarea"}],"expanded":true,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"},{"configs":{"region":"center","pagingBar":"false","hidden":"true","itemId":"grid3","editable":"true"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/ar/pay/DB/select_xc_ar_pay_l"},"events":{"beforeload":"operation.params = {\n  AR_PAY_H_ID : Wb.ar_pay_h_id\n};"},"children":[],"expanded":false,"type":"store"},{"configs":{"normalName":"grid3Tbar","itemId":"tbar"},"children":[{"configs":{"text":"{#addTempBtn#}","itemId":"addTempBtn3","iconCls":"insert_icon"},"events":{"click":"if(app.grid3.store.getCount() !== 0){\n  Wb.toast(\"预收款明细数据只能有 1 条！\");\n  return ;\n}\nWb.addEdit(app.grid3,{AR_CREATED_BY_NAME : '{#XIP.empName#}'});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#deleteBtn#}","itemId":"deleteBtn3","iconCls":"file_delete_icon"},"events":{"click":"Wb.remove(app.grid3);"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#rownum#}","xtype":"rownumberer","titleAlign":"center","itemId":"rownum3"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#AR_DOC_CAT_CODE_COL#}","hidden":"true","dataIndex":"AR_DOC_CAT_CODE","titleAlign":"center","itemId":"AR_DOC_CAT_CODE_COL3"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"<font color = 'red'>*<\/font>{#AR_CONTRACT_NAME_COL#}","hidden":"true","width":"150","dataIndex":"AR_CONTRACT_NAME","titleAlign":"center","itemId":"AR_CONTRACT_NAME_COL3"},"children":[{"configs":{"labelWidth":"100","labelAlign":"right","itemId":"editor","normalName":"AP_CONTRACT_NAME_PICK3"},"children":[{"configs":{"tagConfigs":"minWidth:400","itemId":"pickComp"},"events":{"itemdblclick":"var r=app.grid.getSelectionModel().getSelection()[0];\nr.set('AP_CONTRACT_ID',record.data.AP_CONTRACT_ID);\nr.set('AP_CONTRACT_NAME',record.data.AP_CONTRACT_NAME);\nr.dirty = true;\napp.AP_CONTRACT_NAME_PICK3.setValue(record.data.AP_CONTRACT_NAME);\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"pageSize":"5","itemId":"store","autoLoad":"true","url":"m?xwl=xc/ap/ap-com-lov/AP_CONTRACT_ID_PICK/DB/GRID_XC_AP_CONTRACT_SELECT"},"events":{"beforeload":"operation.params = Wb.getValue([app.form1,app.tbar]);"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","dataIndex":"AP_CONTRACT_ID","itemId":"AP_CONTRACT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"项目编码","dataIndex":"AP_CONTRACT_CODE","itemId":"AP_CONTRACT_CODE_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"项目名称","dataIndex":"AP_CONTRACT_NAME","itemId":"AP_CONTRACT_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"100","emptyText":"合同编码/名称","labelAlign":"right","itemId":"QUERY_CODE_NAME"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.pickComp.getStore().load();\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":false,"type":"column"},{"configs":{"text":"<font color = 'red'>*<\/font>{#DEPT_NAME_COL#}","hidden":"true","width":"150","dataIndex":"DEPT_NAME","titleAlign":"center","itemId":"DEPT_NAME_COL3"},"children":[{"configs":{"labelWidth":"100","labelAlign":"right","itemId":"editor","normalName":"DEPT_NAME_PICK3"},"children":[{"configs":{"tagConfigs":"minWidth:400","itemId":"pickComp"},"events":{"itemdblclick":"var r=app.grid.getSelectionModel().getSelection()[0];\nr.set('DEPT_ID',record.data.DEPT_ID);\nr.set('DEPT_NAME',record.data.DEPT_NAME);\nr.dirty = true;\napp.DEPT_NAME_PICK3.setValue(record.data.DEPT_NAME);\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"pageSize":"5","itemId":"store","autoLoad":"true","url":"m?xwl=xc/com-lov/DEPT_ID_PICK/DB/GRID_XIP_PUB_DEPTS_SELECT_LD"},"events":{"beforeload":"operation.params = Wb.getValue([app.form1,app.tbar]);"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","dataIndex":"DEPT_ID","itemId":"DEPT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"成本中心编码","dataIndex":"DEPT_CODE","itemId":"DEPT_CODE_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"成本中心名称","dataIndex":"DEPT_NAME","itemId":"DEPT_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"100","emptyText":"成本中心编码/名称","labelAlign":"right","itemId":"QUERY_CODE_NAME"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.pickComp.getStore().load();\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":false,"type":"column"},{"configs":{"text":"{#PROJECT_NAME_COL#}","width":"150","dataIndex":"PROJECT_NAME","titleAlign":"center","itemId":"PROJECT_NAME_COL3"},"children":[{"configs":{"labelWidth":"100","labelAlign":"right","itemId":"editor","normalName":"PROJECT_NAME_PICK3"},"children":[{"configs":{"tagConfigs":"minWidth:400","itemId":"pickComp"},"events":{"itemdblclick":"var r=app.grid.getSelectionModel().getSelection()[0];\nr.set('PROJECT_ID',record.data.PROJECT_ID);\nr.set('PROJECT_NAME',record.data.PROJECT_NAME);\nr.dirty = true;\napp.PROJECT_NAME_PICK3.setValue(record.data.PROJECT_NAME);\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"pageSize":"5","itemId":"store","autoLoad":"true","url":"m?xwl=xc/com-lov/PROJECT_ID_PICK/DB/GRID_XC_PM_PROJECT_SELECT"},"events":{"beforeload":"operation.params = {\n  QUERY_LEDGER_ID : app.LEDGER_ID_XWL.LEDGER_ID.getValue(),\n  QUERY_DEPT_ID : app.DEPT_ID_XWL.DEPT_ID.getValue(),\n  QUERY_CODE_NAME : app.QUERY_CODE_NAME.getValue()\n};"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","dataIndex":"PROJECT_ID","itemId":"PROJECT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"项目编码","dataIndex":"PROJECT_CODE","itemId":"PROJECT_CODE_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"项目名称","dataIndex":"PROJECT_NAME","itemId":"PROJECT_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"100","emptyText":"项目编码/名称","labelAlign":"right","itemId":"QUERY_CODE_NAME"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.pickComp.getStore().load();\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":false,"type":"column"},{"configs":{"text":"<font color = 'red'>*<\/font>{#ACC_NAME_COL#}","width":"150","dataIndex":"ACC_NAME","titleAlign":"center","itemId":"ACC_NAME_COL3"},"children":[{"configs":{"labelWidth":"100","allowBlank":"false","labelAlign":"right","itemId":"editor","normalName":"ACC_NAME_PICK3"},"events":{"change":"var r=app.grid.getSelectionModel().getSelection()[0];\nr.set('CCID','');\nr.set('CCID_NAME','');"},"children":[{"configs":{"tagConfigs":"minWidth:400","itemId":"pickComp"},"events":{"itemdblclick":"var r=app.grid.getSelectionModel().getSelection()[0];\nr.set('ACC_ID',record.data.ACC_ID);\nr.set('ACC_NAME',record.data.ACC_NAME);\nr.dirty = true;\napp.ACC_NAME_PICK3.setValue(record.data.ACC_NAME);\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"pageSize":"5","itemId":"store","autoLoad":"true","url":"m?xwl=xc/com-lov/ACC_ID_PICK/DB/XC_BG_LD_ACCOUNTS_SELECT_LD"},"events":{"beforeload":"operation.params = Wb.getValue([app.form1,app.tbar]);"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","dataIndex":"ACC_ID","itemId":"ACC_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"科目编码","dataIndex":"ACC_CODE","itemId":"ACC_CODE_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"科目名称","dataIndex":"ACC_NAME","itemId":"ACC_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"100","emptyText":"科目编码/名称","labelAlign":"right","itemId":"QUERY_CODE_NAME"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.pickComp.getStore().load();\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":false,"type":"column"},{"configs":{"text":"{#CCID_NAME_COL#}","width":"150","dataIndex":"CCID_NAME","titleAlign":"center","itemId":"CCID_NAME_COL3"},"children":[{"configs":{"displayField":"CCID_NAME","triggerCls":"x-form-search-trigger","valueField":"CCID","itemId":"editor","onTriggerClick":"  // 账簿\n  var ledgerId = app.LEDGER_ID_XWL.LEDGER_ID.getValue() ;\n  if(ledgerId === \"\" ||ledgerId === null || ledgerId === undefined){\n    Wb.info('请选择账簿!') ;\n    return false ;\n  }\n  \n  // 会计日期\n  var accDate = app.GL_DATE.getValue() ;\n  if(accDate === \"\" ||accDate === null || accDate === undefined){\n    Wb.info('请选择会计日期!') ;\n    return false ;\n  }else{\n\taccDate = Wb.dateToStr(accDate).substring(0,7);\n  }\n  \n  // TODO: 当前选中\n  var r = app.grid.getSelection()[0] ; \n  \n  // TODO: 显示科目选择窗口\n  Wb.run({\n    url:'m?xwl=xc/gl/journal/v-windows/handler-ccid-win',\n    params : {\n      'ledgerId' : ledgerId,\n      'vtype' : '{#vtype#}'\n    },          \n    success:function(appObj){\n      appObj.initWindow({\n        accName : r.data.ACC_NAME,\n        ledgerId : ledgerId,\n        periodCode : accDate ,\n        groupId : 'ALL',\n        handlerCCID : function(returnObj){\n          // TODO: 处理CCID信息\n          var rObj = Wb.decode(returnObj) ;\n          r.set('ACC_ID', rObj.acc_id) ;    \n          r.set('ACC_NAME', rObj.acc_name);\n          r.set('CCID', rObj.acc_ccid) ;    \n          r.set('CCID_NAME', rObj.acc_ccid_name);\n          if(!Wb.isEmpty(rObj.dim_id)){\n          r.set('DIM_ID', rObj.dim_id) ;\n          r.set('DIM_NAME', rObj.dim_name) ;\n          }\n          // 禁用账簿\n           app.LEDGER_ID_XWL.LEDGER_ID.setReadOnly(true) ;\n        }\n      });\n    }  \n  }) ;   "},"events":{"beforequery":"var combo = e.combo;\nif(!e.forceAll){\n  var value = e.query;\n  combo.store.filterBy(function(record,id){\n    var text = record.get(combo.displayField);\n    return (text.indexOf(value)!=-1);\n  });\n  combo.expand();\n  return false;\n}","specialkey":"// TODO: 按回车键执行借方和贷方金额切换\nif (e.getKey() == e.ENTER) {\n  // 账簿\n  var ledgerId = app.LEDGER_ID_XWL.LEDGER_ID.getValue() ;\n  if(ledgerId === \"\" ||ledgerId === null || ledgerId === undefined){\n    Wb.info('请选择账簿!') ;\n    return false ;\n  }\n  \n  // 会计日期\n  var accDate = app.GL_DATE.getValue();\n  if(accDate === \"\" ||accDate === null || accDate === undefined){\n    Wb.info('请选择会计日期!') ;\n    return false ;\n  }else{\n    accDate = Wb.dateToStr(accDate).substring(0,7);\n  }\n  \n  // TODO: 当前选中\n  var r = app.grid.getSelection()[0] ; \n  \n  // TODO: 显示科目选择窗口\n  Wb.run({\n    url:'m?xwl=xc/gl/journal/v-windows/handler-ccid-win',\n    params : {\n      'ledgerId' : ledgerId ,\n      'vtype' : '{#vtype#}'\n    },          \n    success:function(appObj){\n      appObj.initWindow({\n        accName : r.data.ACC_NAME,\n        ledgerId : ledgerId,\n        periodCode : accDate ,\n        groupId : 'ALL',\n        handlerCCID : function(returnObj){\n          // TODO: 处理CCID信息\n          var rObj = Wb.decode(returnObj) ;\n          r.set('ACC_ID', rObj.acc_id) ;    \n          r.set('ACC_NAME', rObj.acc_name);\n          r.set('CCID', rObj.acc_ccid) ;    \n          r.set('CCID_NAME', rObj.acc_ccid_name);\n          if(!Wb.isEmpty(rObj.dim_id)){\n            r.set('DIM_ID', rObj.dim_id) ;\n            r.set('DIM_NAME', rObj.dim_name) ;\n          }\n          // 禁用账簿\n           app.LEDGER_ID_XWL.LEDGER_ID.setReadOnly(true) ;\n        }\n      });\n    }  \n  }) ;   \n}"},"children":[],"expanded":true,"type":"combo"}],"expanded":true,"type":"column"},{"configs":{"text":"<font color = 'red'>*<\/font>{#AMOUNT_COL#}","align":"right","width":"100","dataIndex":"AMOUNT","titleAlign":"center","format":"0,000.00","itemId":"AMOUNT_COL3"},"children":[{"configs":{"allowBlank":"false","minValue":"0","value":"0","itemId":"editor"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"column"},{"configs":{"text":"{#AR_CREATED_BY_NAME_COL#}","hidden":"true","dataIndex":"AR_CREATED_BY_NAME","titleAlign":"center","itemId":"AR_CREATED_BY_NAME_COL3"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"<font color = 'red'>*<\/font>{#DESCRIPTION_COL#}","dataIndex":"DESCRIPTION","titleAlign":"center","itemId":"DESCRIPTION_COL3","flex":"1"},"children":[{"configs":{"itemId":"editor"},"children":[],"expanded":false,"type":"textarea"}],"expanded":true,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"},{"configs":{"region":"center","pagingBar":"false","hidden":"true","itemId":"grid4","editable":"true"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/ar/pay/DB/select_xc_ar_pay_l"},"events":{"beforeload":"operation.params = {\n  AR_PAY_H_ID : Wb.ar_pay_h_id\n};"},"children":[],"expanded":false,"type":"store"},{"configs":{"normalName":"grid4Tbar","itemId":"tbar"},"children":[{"configs":{"text":"{#selectArPayBtn4#}","hidden":"true","itemId":"selectArPayBtn4","iconCls":"seek_icon"},"events":{"click":"if(app.grid4.store.getCount() !== 0){\n  Wb.toast(\"预收款-红字明细数据只能有 1 条！\");\n  return;\n}\nvar ledger_id = app.LEDGER_ID_XWL.LEDGER_ID.getValue();//账簿id\nvar customer_id = app.CUSTOM_ID_XWL.CUSTOMER_ID.getValue();//客户id\n//判断,过滤条件 账簿 有合同就按合同过滤，没有就算了\nif(Wb.isEmpty(ledger_id)){\n  Wb.toast('请选择账簿！');\n  return ;\n}\nif(Wb.isEmpty(customer_id)){\n  Wb.toast('请选择客户！');\n  return ;\n}\nvar curGrid = app.grid4;\nWb.run({\n  url: 'm?xwl=xc/ar/pay/LOV/LOV_SELECT_PAY_WIN', \n  success: function(app) {\n    app.initWin({\n      LEDGER_ID : ledger_id,\n      CUSTOMER_ID : customer_id,\n      hideFun:function(recs){\n\t\tWb.info(Wb.encode(Wb.getData(recs)));\n        Ext.each(recs,function(rec){\n          Wb.addEdit(curGrid,{\n            AR_PAY_L_ID : '',\n            AR_PAY_H_ID : Wb.ar_pay_h_id,\n            L_AR_PAY_H_ID : rec.data.AR_PAY_H_ID,\n            PROJECT_ID : rec.data.PROJECT_ID,\n            PROJECT_NAME : rec.data.PROJECT_NAME,\n            AR_CONTRACT_ID : rec.data.AR_CONTRACT_ID,\n            AR_CONTRACT_NAME : rec.data.AR_CONTRACT_NAME,\n            DEPT_ID : rec.data.DEPT_ID,\n            DEPT_NAME : rec.data.DEPT_NAME,\n            AR_DOC_CAT_CODE : rec.data.AR_DOC_CAT_CODE,\n            AMOUNT : rec.data.TK_AMT,\n            ACC_ID : rec.data.SALE_ACC_ID,\n            ACC_NAME : rec.data.SALE_ACC_NAME,\n            CCID : rec.data.SALE_CCID,\n            CCID_NAME : rec.data.SALE_CCID_NAME,\n            AR_CREATED_BY_NAME : '{#XIP.empName#}',\n            DESCRIPTION : rec.data.DESCRIPTION\n          }, 'after', 1, false);\n        });\n      }\n    });\n    \n  }\n});\n","tagEvents":"{\n  show : function(button, options){\n    app.L_AR_PAY_H_ID_COL4.show();\n    app.L_AR_PAY_L_ID_COL4.show();\n  }\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#addTempBtn#}","hidden":"true","itemId":"addTempBtn4","iconCls":"insert_icon"},"events":{"tagEvents":"{\n  show : function(button, options){\n    app.L_AR_PAY_H_ID_COL4.hide();\n    app.L_AR_PAY_L_ID_COL4.hide();\n  }\n}","click":"if(app.grid4.store.getCount() !== 0){\n  Wb.toast(\"预收款-红字明细数据只能有 1 条！\");\n  return;\n}\nWb.addEdit(app.grid4,{AR_CREATED_BY_NAME : '{#XIP.empName#}'});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#deleteBtn#}","itemId":"deleteBtn4","iconCls":"file_delete_icon"},"events":{"click":"Wb.remove(app.grid4);"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#rownum#}","xtype":"rownumberer","titleAlign":"center","itemId":"rownum4"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#AR_DOC_CAT_CODE_COL#}","hidden":"true","dataIndex":"AR_DOC_CAT_CODE","titleAlign":"center","itemId":"AR_DOC_CAT_CODE_COL4"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#L_AR_PAY_H_CODE_COL#}","dataIndex":"L_AR_PAY_H_CODE","titleAlign":"center","itemId":"L_AR_PAY_H_CODE_COL4"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"<font color = 'red'>*<\/font>{#AR_CONTRACT_NAME_COL#}","hidden":"true","width":"150","dataIndex":"AR_CONTRACT_NAME","titleAlign":"center","itemId":"AR_CONTRACT_NAME_COL4"},"children":[{"configs":{"labelWidth":"100","labelAlign":"right","itemId":"editor","normalName":"AP_CONTRACT_NAME_PICK4"},"children":[{"configs":{"tagConfigs":"minWidth:400","itemId":"pickComp"},"events":{"itemdblclick":"var r=app.grid.getSelectionModel().getSelection()[0];\nr.set('AP_CONTRACT_ID',record.data.AP_CONTRACT_ID);\nr.set('AP_CONTRACT_NAME',record.data.AP_CONTRACT_NAME);\nr.dirty = true;\napp.AP_CONTRACT_NAME_PICK4.setValue(record.data.AP_CONTRACT_NAME);\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"pageSize":"5","itemId":"store","autoLoad":"true","url":"m?xwl=xc/ap/ap-com-lov/AP_CONTRACT_ID_PICK/DB/GRID_XC_AP_CONTRACT_SELECT"},"events":{"beforeload":"operation.params = Wb.getValue([app.form1,app.tbar]);"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","dataIndex":"AP_CONTRACT_ID","itemId":"AP_CONTRACT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"项目编码","dataIndex":"AP_CONTRACT_CODE","itemId":"AP_CONTRACT_CODE_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"项目名称","dataIndex":"AP_CONTRACT_NAME","itemId":"AP_CONTRACT_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"100","emptyText":"合同编码/名称","labelAlign":"right","itemId":"QUERY_CODE_NAME"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.pickComp.getStore().load();\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":false,"type":"column"},{"configs":{"text":"<font color = 'red'>*<\/font>{#DEPT_NAME_COL#}","hidden":"true","width":"150","dataIndex":"DEPT_NAME","titleAlign":"center","itemId":"DEPT_NAME_COL4"},"children":[{"configs":{"labelWidth":"100","labelAlign":"right","itemId":"editor","normalName":"DEPT_NAME_PICK4"},"children":[{"configs":{"tagConfigs":"minWidth:400","itemId":"pickComp"},"events":{"itemdblclick":"var r=app.grid.getSelectionModel().getSelection()[0];\nr.set('DEPT_ID',record.data.DEPT_ID);\nr.set('DEPT_NAME',record.data.DEPT_NAME);\nr.dirty = true;\napp.DEPT_NAME_PICK4.setValue(record.data.DEPT_NAME);\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"pageSize":"5","itemId":"store","autoLoad":"true","url":"m?xwl=xc/com-lov/DEPT_ID_PICK/DB/GRID_XIP_PUB_DEPTS_SELECT_LD"},"events":{"beforeload":"operation.params = Wb.getValue([app.form1,app.tbar]);"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","dataIndex":"DEPT_ID","itemId":"DEPT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"成本中心编码","dataIndex":"DEPT_CODE","itemId":"DEPT_CODE_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"成本中心名称","dataIndex":"DEPT_NAME","itemId":"DEPT_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"100","emptyText":"成本中心编码/名称","labelAlign":"right","itemId":"QUERY_CODE_NAME"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.pickComp.getStore().load();\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":false,"type":"column"},{"configs":{"text":"{#PROJECT_NAME_COL#}","width":"150","dataIndex":"PROJECT_NAME","titleAlign":"center","itemId":"PROJECT_NAME_COL4"},"children":[{"configs":{"labelWidth":"100","labelAlign":"right","itemId":"editor","normalName":"PROJECT_NAME_PICK"},"children":[{"configs":{"tagConfigs":"minWidth:400","itemId":"pickComp"},"events":{"itemdblclick":"var r=app.grid.getSelectionModel().getSelection()[0];\nr.set('PROJECT_ID',record.data.PROJECT_ID);\nr.set('PROJECT_NAME',record.data.PROJECT_NAME);\nr.dirty = true;\napp.PROJECT_NAME_PICK.setValue(record.data.PROJECT_NAME);\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"pageSize":"5","itemId":"store","autoLoad":"true","url":"m?xwl=xc/com-lov/PROJECT_ID_PICK/DB/GRID_XC_PM_PROJECT_SELECT"},"events":{"beforeload":"operation.params = {\n  QUERY_LEDGER_ID : app.LEDGER_ID_XWL.LEDGER_ID.getValue(),\n  QUERY_DEPT_ID : app.DEPT_ID_XWL.DEPT_ID.getValue(),\n  QUERY_CODE_NAME : app.QUERY_CODE_NAME.getValue()\n};"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","dataIndex":"PROJECT_ID","itemId":"PROJECT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"项目编码","dataIndex":"PROJECT_CODE","itemId":"PROJECT_CODE_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"项目名称","dataIndex":"PROJECT_NAME","itemId":"PROJECT_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"100","emptyText":"项目编码/名称","labelAlign":"right","itemId":"QUERY_CODE_NAME"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.pickComp.getStore().load();\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":false,"type":"column"},{"configs":{"text":"<font color = 'red'>*<\/font>{#ACC_NAME_COL#}","width":"150","dataIndex":"ACC_NAME","titleAlign":"center","itemId":"ACC_NAME_COL4"},"children":[{"configs":{"labelWidth":"100","allowBlank":"false","labelAlign":"right","itemId":"editor","normalName":"ACC_NAME_PICK4"},"events":{"change":"var r=app.grid.getSelectionModel().getSelection()[0];\nr.set('CCID','');\nr.set('CCID_NAME','');"},"children":[{"configs":{"tagConfigs":"minWidth:400","itemId":"pickComp"},"events":{"itemdblclick":"var r=app.grid.getSelectionModel().getSelection()[0];\nr.set('ACC_ID',record.data.ACC_ID);\nr.set('ACC_NAME',record.data.ACC_NAME);\nr.dirty = true;\napp.ACC_NAME_PICK4.setValue(record.data.ACC_NAME);\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"pageSize":"5","itemId":"store","autoLoad":"true","url":"m?xwl=xc/com-lov/ACC_ID_PICK/DB/XC_BG_LD_ACCOUNTS_SELECT_LD"},"events":{"beforeload":"operation.params = Wb.getValue([app.form1,app.tbar]);"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","dataIndex":"ACC_ID","itemId":"ACC_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"科目编码","dataIndex":"ACC_CODE","itemId":"ACC_CODE_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"科目名称","dataIndex":"ACC_NAME","itemId":"ACC_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"100","emptyText":"科目编码/名称","labelAlign":"right","itemId":"QUERY_CODE_NAME"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.pickComp.getStore().load();\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":false,"type":"column"},{"configs":{"text":"{#CCID_NAME_COL#}","width":"150","dataIndex":"CCID_NAME","titleAlign":"center","itemId":"CCID_NAME_COL4"},"children":[{"configs":{"displayField":"CCID_NAME","triggerCls":"x-form-search-trigger","valueField":"CCID","itemId":"editor","onTriggerClick":"  // 账簿\n  var ledgerId = app.LEDGER_ID_XWL.LEDGER_ID.getValue() ;\n  if(ledgerId === \"\" ||ledgerId === null || ledgerId === undefined){\n    Wb.info('请选择账簿!') ;\n    return false ;\n  }\n  \n  // 会计日期\n  var accDate = app.GL_DATE.getValue() ;\n  if(accDate === \"\" ||accDate === null || accDate === undefined){\n    Wb.info('请选择会计日期!') ;\n    return false ;\n  }else{\n\taccDate = Wb.dateToStr(accDate).substring(0,7);\n  }\n  \n  // TODO: 当前选中\n  var r = app.grid.getSelection()[0] ; \n  \n  // TODO: 显示科目选择窗口\n  Wb.run({\n    url:'m?xwl=xc/gl/journal/v-windows/handler-ccid-win',\n    params : {\n      'ledgerId' : ledgerId,\n      'vtype' : '{#vtype#}'\n    },          \n    success:function(appObj){\n      appObj.initWindow({\n        accName : r.data.ACC_NAME,\n        ledgerId : ledgerId,\n        periodCode : accDate ,\n        groupId : 'ALL',\n        handlerCCID : function(returnObj){\n          // TODO: 处理CCID信息\n          var rObj = Wb.decode(returnObj) ;\n          r.set('ACC_ID', rObj.acc_id) ;    \n          r.set('ACC_NAME', rObj.acc_name);\n          r.set('CCID', rObj.acc_ccid) ;    \n          r.set('CCID_NAME', rObj.acc_ccid_name);\n          if(!Wb.isEmpty(rObj.dim_id)){\n          r.set('DIM_ID', rObj.dim_id) ;\n          r.set('DIM_NAME', rObj.dim_name) ;\n          }\n          // 禁用账簿\n           app.LEDGER_ID_XWL.LEDGER_ID.setReadOnly(true) ;\n        }\n      });\n    }  \n  }) ;   "},"events":{"beforequery":"var combo = e.combo;\nif(!e.forceAll){\n  var value = e.query;\n  combo.store.filterBy(function(record,id){\n    var text = record.get(combo.displayField);\n    return (text.indexOf(value)!=-1);\n  });\n  combo.expand();\n  return false;\n}","specialkey":"// TODO: 按回车键执行借方和贷方金额切换\nif (e.getKey() == e.ENTER) {\n  // 账簿\n  var ledgerId = app.LEDGER_ID_XWL.LEDGER_ID.getValue() ;\n  if(ledgerId === \"\" ||ledgerId === null || ledgerId === undefined){\n    Wb.info('请选择账簿!') ;\n    return false ;\n  }\n  \n  // 会计日期\n  var accDate = app.GL_DATE.getValue();\n  if(accDate === \"\" ||accDate === null || accDate === undefined){\n    Wb.info('请选择会计日期!') ;\n    return false ;\n  }else{\n    accDate = Wb.dateToStr(accDate).substring(0,7);\n  }\n  \n  // TODO: 当前选中\n  var r = app.grid.getSelection()[0] ; \n  \n  // TODO: 显示科目选择窗口\n  Wb.run({\n    url:'m?xwl=xc/gl/journal/v-windows/handler-ccid-win',\n    params : {\n      'ledgerId' : ledgerId ,\n      'vtype' : '{#vtype#}'\n    },          \n    success:function(appObj){\n      appObj.initWindow({\n        accName : r.data.ACC_NAME,\n        ledgerId : ledgerId,\n        periodCode : accDate ,\n        groupId : 'ALL',\n        handlerCCID : function(returnObj){\n          // TODO: 处理CCID信息\n          var rObj = Wb.decode(returnObj) ;\n          r.set('ACC_ID', rObj.acc_id) ;    \n          r.set('ACC_NAME', rObj.acc_name);\n          r.set('CCID', rObj.acc_ccid) ;    \n          r.set('CCID_NAME', rObj.acc_ccid_name);\n          if(!Wb.isEmpty(rObj.dim_id)){\n            r.set('DIM_ID', rObj.dim_id) ;\n            r.set('DIM_NAME', rObj.dim_name) ;\n          }\n          // 禁用账簿\n           app.LEDGER_ID_XWL.LEDGER_ID.setReadOnly(true) ;\n        }\n      });\n    }  \n  }) ;   \n}"},"children":[],"expanded":true,"type":"combo"}],"expanded":true,"type":"column"},{"configs":{"text":"<font color = 'red'>*<\/font>{#AMOUNT_COL#}","align":"right","width":"100","dataIndex":"AMOUNT","titleAlign":"center","format":"0,000.00","itemId":"AMOUNT_COL4"},"children":[{"configs":{"value":"-0","itemId":"editor","maxValue":"-0"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"column"},{"configs":{"text":"{#AR_CREATED_BY_NAME_COL#}","hidden":"true","width":"100","dataIndex":"AR_CREATED_BY_NAME","titleAlign":"center","itemId":"AR_CREATED_BY_NAME_COL4"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"<font color = 'red'>*<\/font>{#DESCRIPTION_COL#}","dataIndex":"DESCRIPTION","titleAlign":"center","itemId":"DESCRIPTION_COL4","flex":"1"},"children":[{"configs":{"itemId":"editor"},"children":[],"expanded":false,"type":"textarea"}],"expanded":true,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"},{"configs":{"region":"center","pagingBar":"false","hidden":"true","itemId":"grid5","editable":"true"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/ar/pay/DB/select_xc_ar_pay_l"},"events":{"beforeload":"operation.params = {\n  AR_PAY_H_ID : Wb.ar_pay_h_id\n};"},"children":[],"expanded":false,"type":"store"},{"configs":{"normalName":"grid5Tbar","itemId":"tbar"},"children":[{"configs":{"text":"{#addTempBtn#}","itemId":"addTempBtn5","iconCls":"insert_icon"},"events":{"click":"Wb.addEdit(app.grid5,{AR_CREATED_BY_NAME : '{#XIP.empName#}'});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#deleteBtn#}","itemId":"deleteBtn5","iconCls":"file_delete_icon"},"events":{"click":"Wb.remove(app.grid5);"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#rownum#}","xtype":"rownumberer","titleAlign":"center","itemId":"rownum5"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#AR_INV_GL_H_CODE_COL#}","hidden":"true","dataIndex":"AR_INV_GL_H_CODE","titleAlign":"center","itemId":"AR_INV_GL_H_CODE_COL5"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#AR_DOC_CAT_CODE_COL#}","hidden":"true","dataIndex":"AR_DOC_CAT_CODE","titleAlign":"center","itemId":"AR_DOC_CAT_CODE_COL5"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#AR_CONTRACT_NAME_COL#}","hidden":"true","width":"150","dataIndex":"AR_CONTRACT_NAME","titleAlign":"center","itemId":"AR_CONTRACT_NAME_COL5"},"children":[{"configs":{"labelWidth":"100","allowBlank":"false","labelAlign":"right","itemId":"editor","normalName":"AP_CONTRACT_NAME_PICK5"},"children":[{"configs":{"tagConfigs":"minWidth:400","itemId":"pickComp"},"events":{"itemdblclick":"var r=app.grid.getSelectionModel().getSelection()[0];\nr.set('AP_CONTRACT_ID',record.data.AP_CONTRACT_ID);\nr.set('AP_CONTRACT_NAME',record.data.AP_CONTRACT_NAME);\nr.dirty = true;\napp.AP_CONTRACT_NAME_PICK5.setValue(record.data.AP_CONTRACT_NAME);\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"pageSize":"5","itemId":"store","autoLoad":"true","url":"m?xwl=xc/ap/ap-com-lov/AP_CONTRACT_ID_PICK/DB/GRID_XC_AP_CONTRACT_SELECT"},"events":{"beforeload":"operation.params = Wb.getValue([app.form1,app.tbar]);"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","dataIndex":"AP_CONTRACT_ID","itemId":"AP_CONTRACT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"项目编码","dataIndex":"AP_CONTRACT_CODE","itemId":"AP_CONTRACT_CODE_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"项目名称","dataIndex":"AP_CONTRACT_NAME","itemId":"AP_CONTRACT_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"100","emptyText":"合同编码/名称","labelAlign":"right","itemId":"QUERY_CODE_NAME"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.pickComp.getStore().load();\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":false,"type":"column"},{"configs":{"text":"<font color = 'red'>*<\/font>{#DEPT_NAME_COL#}","hidden":"true","width":"150","dataIndex":"DEPT_NAME","titleAlign":"center","itemId":"DEPT_NAME_COL5"},"children":[{"configs":{"labelWidth":"100","labelAlign":"right","itemId":"editor","normalName":"DEPT_NAME_PICK5"},"children":[{"configs":{"tagConfigs":"minWidth:400","itemId":"pickComp"},"events":{"itemdblclick":"var r=app.grid.getSelectionModel().getSelection()[0];\nr.set('DEPT_ID',record.data.DEPT_ID);\nr.set('DEPT_NAME',record.data.DEPT_NAME);\nr.dirty = true;\napp.DEPT_NAME_PICK5.setValue(record.data.DEPT_NAME);\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"pageSize":"5","itemId":"store","autoLoad":"true","url":"m?xwl=xc/com-lov/DEPT_ID_PICK/DB/GRID_XIP_PUB_DEPTS_SELECT_LD"},"events":{"beforeload":"operation.params = Wb.getValue([app.form1,app.tbar]);"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","dataIndex":"DEPT_ID","itemId":"DEPT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"成本中心编码","dataIndex":"DEPT_CODE","itemId":"DEPT_CODE_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"成本中心名称","dataIndex":"DEPT_NAME","itemId":"DEPT_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"100","emptyText":"成本中心编码/名称","labelAlign":"right","itemId":"QUERY_CODE_NAME"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.pickComp.getStore().load();\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":false,"type":"column"},{"configs":{"text":"{#PROJECT_NAME_COL#}","width":"150","dataIndex":"PROJECT_NAME","titleAlign":"center","itemId":"PROJECT_NAME_COL5"},"children":[{"configs":{"labelWidth":"100","labelAlign":"right","itemId":"editor","normalName":"PROJECT_NAME_PICK5"},"children":[{"configs":{"tagConfigs":"minWidth:400","itemId":"pickComp"},"events":{"itemdblclick":"var r=app.grid.getSelectionModel().getSelection()[0];\nr.set('PROJECT_ID',record.data.PROJECT_ID);\nr.set('PROJECT_NAME',record.data.PROJECT_NAME);\nr.dirty = true;\napp.PROJECT_NAME_PICK5.setValue(record.data.PROJECT_NAME);\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"pageSize":"5","itemId":"store","autoLoad":"true","url":"m?xwl=xc/com-lov/PROJECT_ID_PICK/DB/GRID_XC_PM_PROJECT_SELECT"},"events":{"beforeload":"operation.params = {\n  QUERY_LEDGER_ID : app.LEDGER_ID_XWL.LEDGER_ID.getValue(),\n  QUERY_DEPT_ID : app.DEPT_ID_XWL.DEPT_ID.getValue(),\n  QUERY_CODE_NAME : app.QUERY_CODE_NAME.getValue()\n};"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","dataIndex":"PROJECT_ID","itemId":"PROJECT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"项目编码","dataIndex":"PROJECT_CODE","itemId":"PROJECT_CODE_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"项目名称","dataIndex":"PROJECT_NAME","itemId":"PROJECT_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"100","emptyText":"项目编码/名称","labelAlign":"right","itemId":"QUERY_CODE_NAME"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.pickComp.getStore().load();\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":false,"type":"column"},{"configs":{"text":"<font color = 'red'>*<\/font>{#ACC_NAME_COL#}","width":"150","dataIndex":"ACC_NAME","titleAlign":"center","itemId":"ACC_NAME_COL5"},"children":[{"configs":{"labelWidth":"100","allowBlank":"false","labelAlign":"right","itemId":"editor","normalName":"ACC_NAME_PICK5"},"events":{"change":"var r=app.grid.getSelectionModel().getSelection()[0];\nr.set('CCID','');\nr.set('CCID_NAME','');"},"children":[{"configs":{"tagConfigs":"minWidth:400","itemId":"pickComp"},"events":{"itemdblclick":"var r=app.grid.getSelectionModel().getSelection()[0];\nr.set('ACC_ID',record.data.ACC_ID);\nr.set('ACC_NAME',record.data.ACC_NAME);\nr.dirty = true;\napp.ACC_NAME_PICK5.setValue(record.data.ACC_NAME);\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"pageSize":"5","itemId":"store","autoLoad":"true","url":"m?xwl=xc/com-lov/ACC_ID_PICK/DB/XC_BG_LD_ACCOUNTS_SELECT_LD"},"events":{"beforeload":"operation.params = Wb.getValue([app.form1,app.tbar]);"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","dataIndex":"ACC_ID","itemId":"ACC_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"科目编码","dataIndex":"ACC_CODE","itemId":"ACC_CODE_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"科目名称","dataIndex":"ACC_NAME","itemId":"ACC_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"100","emptyText":"科目编码/名称","labelAlign":"right","itemId":"QUERY_CODE_NAME"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.pickComp.getStore().load();\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":false,"type":"column"},{"configs":{"text":"{#CCID_NAME_COL#}","width":"150","dataIndex":"CCID_NAME","titleAlign":"center","itemId":"CCID_NAME_COL5"},"children":[{"configs":{"displayField":"CCID_NAME","triggerCls":"x-form-search-trigger","valueField":"CCID","itemId":"editor","onTriggerClick":"  // 账簿\n  var ledgerId = app.LEDGER_ID_XWL.LEDGER_ID.getValue() ;\n  if(ledgerId === \"\" ||ledgerId === null || ledgerId === undefined){\n    Wb.info('请选择账簿!') ;\n    return false ;\n  }\n  \n  // 会计日期\n  var accDate = app.GL_DATE.getValue() ;\n  if(accDate === \"\" ||accDate === null || accDate === undefined){\n    Wb.info('请选择会计日期!') ;\n    return false ;\n  }else{\n\taccDate = Wb.dateToStr(accDate).substring(0,7);\n  }\n  \n  // TODO: 当前选中\n  var r = app.grid.getSelection()[0] ; \n  \n  // TODO: 显示科目选择窗口\n  Wb.run({\n    url:'m?xwl=xc/gl/journal/v-windows/handler-ccid-win',\n    params : {\n      'ledgerId' : ledgerId,\n      'vtype' : '{#vtype#}'\n    },          \n    success:function(appObj){\n      appObj.initWindow({\n        accName : r.data.ACC_NAME,\n        ledgerId : ledgerId,\n        periodCode : accDate ,\n        groupId : 'ALL',\n        handlerCCID : function(returnObj){\n          // TODO: 处理CCID信息\n          var rObj = Wb.decode(returnObj) ;\n          r.set('ACC_ID', rObj.acc_id) ;    \n          r.set('ACC_NAME', rObj.acc_name);\n          r.set('CCID', rObj.acc_ccid) ;    \n          r.set('CCID_NAME', rObj.acc_ccid_name);\n          if(!Wb.isEmpty(rObj.dim_id)){\n          r.set('DIM_ID', rObj.dim_id) ;\n          r.set('DIM_NAME', rObj.dim_name) ;\n          }\n          // 禁用账簿\n           app.LEDGER_ID_XWL.LEDGER_ID.setReadOnly(true) ;\n        }\n      });\n    }  \n  }) ;   "},"events":{"beforequery":"var combo = e.combo;\nif(!e.forceAll){\n  var value = e.query;\n  combo.store.filterBy(function(record,id){\n    var text = record.get(combo.displayField);\n    return (text.indexOf(value)!=-1);\n  });\n  combo.expand();\n  return false;\n}","specialkey":"// TODO: 按回车键执行借方和贷方金额切换\nif (e.getKey() == e.ENTER) {\n  // 账簿\n  var ledgerId = app.LEDGER_ID_XWL.LEDGER_ID.getValue() ;\n  if(ledgerId === \"\" ||ledgerId === null || ledgerId === undefined){\n    Wb.info('请选择账簿!') ;\n    return false ;\n  }\n  \n  // 会计日期\n  var accDate = app.GL_DATE.getValue();\n  if(accDate === \"\" ||accDate === null || accDate === undefined){\n    Wb.info('请选择会计日期!') ;\n    return false ;\n  }else{\n    accDate = Wb.dateToStr(accDate).substring(0,7);\n  }\n  \n  // TODO: 当前选中\n  var r = app.grid.getSelection()[0] ; \n  \n  // TODO: 显示科目选择窗口\n  Wb.run({\n    url:'m?xwl=xc/gl/journal/v-windows/handler-ccid-win',\n    params : {\n      'ledgerId' : ledgerId ,\n      'vtype' : '{#vtype#}'\n    },          \n    success:function(appObj){\n      appObj.initWindow({\n        accName : r.data.ACC_NAME,\n        ledgerId : ledgerId,\n        periodCode : accDate ,\n        groupId : 'ALL',\n        handlerCCID : function(returnObj){\n          // TODO: 处理CCID信息\n          var rObj = Wb.decode(returnObj) ;\n          r.set('ACC_ID', rObj.acc_id) ;    \n          r.set('ACC_NAME', rObj.acc_name);\n          r.set('CCID', rObj.acc_ccid) ;    \n          r.set('CCID_NAME', rObj.acc_ccid_name);\n          if(!Wb.isEmpty(rObj.dim_id)){\n            r.set('DIM_ID', rObj.dim_id) ;\n            r.set('DIM_NAME', rObj.dim_name) ;\n          }\n          // 禁用账簿\n           app.LEDGER_ID_XWL.LEDGER_ID.setReadOnly(true) ;\n        }\n      });\n    }  \n  }) ;   \n}"},"children":[],"expanded":true,"type":"combo"}],"expanded":true,"type":"column"},{"configs":{"text":"<font color = 'red'>*<\/font>{#AMOUNT_COL#}","align":"right","width":"100","dataIndex":"AMOUNT","titleAlign":"center","format":"0,000.00","itemId":"AMOUNT_COL5"},"children":[{"configs":{"allowBlank":"false","minValue":"0","value":"0","itemId":"editor"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"column"},{"configs":{"text":"{#AR_CREATED_BY_NAME_COL#}","hidden":"true","width":"100","dataIndex":"AR_CREATED_BY_NAME","titleAlign":"center","itemId":"AR_CREATED_BY_NAME_COL5"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"<font color = 'red'>*<\/font>{#DESCRIPTION_COL#}","dataIndex":"DESCRIPTION","titleAlign":"center","itemId":"DESCRIPTION_COL5","flex":"1"},"children":[{"configs":{"itemId":"editor"},"children":[],"expanded":false,"type":"textarea"}],"expanded":true,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"},{"configs":{"region":"center","pagingBar":"false","hidden":"true","itemId":"grid6","editable":"true"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/ar/pay/DB/select_xc_ar_pay_l"},"events":{"beforeload":"operation.params = {\n  AR_PAY_H_ID : Wb.ar_pay_h_id\n};"},"children":[],"expanded":false,"type":"store"},{"configs":{"normalName":"grid6Tbar","itemId":"tbar"},"children":[{"configs":{"text":"{#addTempBtn#}","itemId":"addTempBtn6","iconCls":"insert_icon"},"events":{"click":"Wb.addEdit(app.grid6,{AR_CREATED_BY_NAME : '{#XIP.empName#}'});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#deleteBtn#}","itemId":"deleteBtn6","iconCls":"file_delete_icon"},"events":{"click":"Wb.remove(app.grid6);"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#rownum#}","xtype":"rownumberer","titleAlign":"center","itemId":"rownum6"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#AR_INV_GL_H_CODE_COL#}","hidden":"true","dataIndex":"AR_INV_GL_H_CODE","titleAlign":"center","itemId":"AR_INV_GL_H_CODE_COL6"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#AR_DOC_CAT_CODE_COL#}","hidden":"true","dataIndex":"AR_DOC_CAT_CODE","titleAlign":"center","itemId":"AR_DOC_CAT_CODE_COL6"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#AR_CONTRACT_NAME_COL#}","hidden":"true","dataIndex":"AR_CONTRACT_NAME","titleAlign":"center","itemId":"AR_CONTRACT_NAME_COL6"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"<font color = 'red'>*<\/font>{#DEPT_NAME_COL#}","hidden":"true","width":"150","dataIndex":"DEPT_NAME","titleAlign":"center","itemId":"DEPT_NAME_COL6"},"children":[{"configs":{"labelWidth":"100","labelAlign":"right","itemId":"editor","normalName":"DEPT_NAME_PICK6"},"children":[{"configs":{"tagConfigs":"minWidth:400","itemId":"pickComp"},"events":{"itemdblclick":"var r=app.grid.getSelectionModel().getSelection()[0];\nr.set('DEPT_ID',record.data.DEPT_ID);\nr.set('DEPT_NAME',record.data.DEPT_NAME);\nr.dirty = true;\napp.DEPT_NAME_PICK6.setValue(record.data.DEPT_NAME);\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"pageSize":"5","itemId":"store","autoLoad":"true","url":"m?xwl=xc/com-lov/DEPT_ID_PICK/DB/GRID_XIP_PUB_DEPTS_SELECT_LD"},"events":{"beforeload":"operation.params = Wb.getValue([app.form1,app.tbar]);"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","dataIndex":"DEPT_ID","itemId":"DEPT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"成本中心编码","dataIndex":"DEPT_CODE","itemId":"DEPT_CODE_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"成本中心名称","dataIndex":"DEPT_NAME","itemId":"DEPT_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"100","emptyText":"成本中心编码/名称","labelAlign":"right","itemId":"QUERY_CODE_NAME"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.pickComp.getStore().load();\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":false,"type":"column"},{"configs":{"text":"{#PROJECT_NAME_COL#}","width":"150","dataIndex":"PROJECT_NAME","titleAlign":"center","itemId":"PROJECT_NAME_COL6"},"children":[{"configs":{"labelWidth":"100","labelAlign":"right","itemId":"editor","normalName":"PROJECT_NAME_PICK6"},"children":[{"configs":{"tagConfigs":"minWidth:400","itemId":"pickComp"},"events":{"itemdblclick":"var r=app.grid.getSelectionModel().getSelection()[0];\nr.set('PROJECT_ID',record.data.PROJECT_ID);\nr.set('PROJECT_NAME',record.data.PROJECT_NAME);\nr.dirty = true;\napp.PROJECT_NAME_PICK6.setValue(record.data.PROJECT_NAME);\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"pageSize":"5","itemId":"store","autoLoad":"true","url":"m?xwl=xc/com-lov/PROJECT_ID_PICK/DB/GRID_XC_PM_PROJECT_SELECT"},"events":{"beforeload":"operation.params = {\n  QUERY_LEDGER_ID : app.LEDGER_ID_XWL.LEDGER_ID.getValue(),\n  QUERY_DEPT_ID : app.DEPT_ID_XWL.DEPT_ID.getValue(),\n  QUERY_CODE_NAME : app.QUERY_CODE_NAME.getValue()\n};"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","dataIndex":"PROJECT_ID","itemId":"PROJECT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"项目编码","dataIndex":"PROJECT_CODE","itemId":"PROJECT_CODE_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"项目名称","dataIndex":"PROJECT_NAME","itemId":"PROJECT_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"100","emptyText":"项目编码/名称","labelAlign":"right","itemId":"QUERY_CODE_NAME"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.pickComp.getStore().load();\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":false,"type":"column"},{"configs":{"text":"<font color = 'red'>*<\/font>{#ACC_NAME_COL#}","width":"150","dataIndex":"ACC_NAME","titleAlign":"center","itemId":"ACC_NAME_COL6"},"children":[{"configs":{"labelWidth":"100","allowBlank":"false","labelAlign":"right","itemId":"editor","normalName":"ACC_NAME_PICK6"},"events":{"change":"var r=app.grid.getSelectionModel().getSelection()[0];\nr.set('CCID','');\nr.set('CCID_NAME','');"},"children":[{"configs":{"tagConfigs":"minWidth:400","itemId":"pickComp"},"events":{"itemdblclick":"var r=app.grid.getSelectionModel().getSelection()[0];\nr.set('ACC_ID',record.data.ACC_ID);\nr.set('ACC_NAME',record.data.ACC_NAME);\nr.dirty = true;\napp.ACC_NAME_PICK6.setValue(record.data.ACC_NAME);\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"pageSize":"5","itemId":"store","autoLoad":"true","url":"m?xwl=xc/com-lov/ACC_ID_PICK/DB/XC_BG_LD_ACCOUNTS_SELECT_LD"},"events":{"beforeload":"operation.params = Wb.getValue([app.form1,app.tbar]);"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","dataIndex":"ACC_ID","itemId":"ACC_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"科目编码","dataIndex":"ACC_CODE","itemId":"ACC_CODE_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"科目名称","dataIndex":"ACC_NAME","itemId":"ACC_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"100","emptyText":"科目编码/名称","labelAlign":"right","itemId":"QUERY_CODE_NAME"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.pickComp.getStore().load();\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":false,"type":"column"},{"configs":{"text":"{#CCID_NAME_COL#}","width":"150","dataIndex":"CCID_NAME","titleAlign":"center","itemId":"CCID_NAME_COL6"},"children":[{"configs":{"displayField":"CCID_NAME","triggerCls":"x-form-search-trigger","valueField":"CCID","itemId":"editor","onTriggerClick":"  // 账簿\n  var ledgerId = app.LEDGER_ID_XWL.LEDGER_ID.getValue() ;\n  if(ledgerId === \"\" ||ledgerId === null || ledgerId === undefined){\n    Wb.info('请选择账簿!') ;\n    return false ;\n  }\n  \n  // 会计日期\n  var accDate = app.GL_DATE.getValue() ;\n  if(accDate === \"\" ||accDate === null || accDate === undefined){\n    Wb.info('请选择会计日期!') ;\n    return false ;\n  }else{\n\taccDate = Wb.dateToStr(accDate).substring(0,7);\n  }\n  \n  // TODO: 当前选中\n  var r = app.grid.getSelection()[0] ; \n  \n  // TODO: 显示科目选择窗口\n  Wb.run({\n    url:'m?xwl=xc/gl/journal/v-windows/handler-ccid-win',\n    params : {\n      'ledgerId' : ledgerId,\n      'vtype' : '{#vtype#}'\n    },          \n    success:function(appObj){\n      appObj.initWindow({\n        accName : r.data.ACC_NAME,\n        ledgerId : ledgerId,\n        periodCode : accDate ,\n        groupId : 'ALL',\n        handlerCCID : function(returnObj){\n          // TODO: 处理CCID信息\n          var rObj = Wb.decode(returnObj) ;\n          r.set('ACC_ID', rObj.acc_id) ;    \n          r.set('ACC_NAME', rObj.acc_name);\n          r.set('CCID', rObj.acc_ccid) ;    \n          r.set('CCID_NAME', rObj.acc_ccid_name);\n          if(!Wb.isEmpty(rObj.dim_id)){\n          r.set('DIM_ID', rObj.dim_id) ;\n          r.set('DIM_NAME', rObj.dim_name) ;\n          }\n          // 禁用账簿\n           app.LEDGER_ID_XWL.LEDGER_ID.setReadOnly(true) ;\n        }\n      });\n    }  \n  }) ;   "},"events":{"beforequery":"var combo = e.combo;\nif(!e.forceAll){\n  var value = e.query;\n  combo.store.filterBy(function(record,id){\n    var text = record.get(combo.displayField);\n    return (text.indexOf(value)!=-1);\n  });\n  combo.expand();\n  return false;\n}","specialkey":"// TODO: 按回车键执行借方和贷方金额切换\nif (e.getKey() == e.ENTER) {\n  // 账簿\n  var ledgerId = app.LEDGER_ID_XWL.LEDGER_ID.getValue() ;\n  if(ledgerId === \"\" ||ledgerId === null || ledgerId === undefined){\n    Wb.info('请选择账簿!') ;\n    return false ;\n  }\n  \n  // 会计日期\n  var accDate = app.GL_DATE.getValue();\n  if(accDate === \"\" ||accDate === null || accDate === undefined){\n    Wb.info('请选择会计日期!') ;\n    return false ;\n  }else{\n    accDate = Wb.dateToStr(accDate).substring(0,7);\n  }\n  \n  // TODO: 当前选中\n  var r = app.grid.getSelection()[0] ; \n  \n  // TODO: 显示科目选择窗口\n  Wb.run({\n    url:'m?xwl=xc/gl/journal/v-windows/handler-ccid-win',\n    params : {\n      'ledgerId' : ledgerId ,\n      'vtype' : '{#vtype#}'\n    },          \n    success:function(appObj){\n      appObj.initWindow({\n        accName : r.data.ACC_NAME,\n        ledgerId : ledgerId,\n        periodCode : accDate ,\n        groupId : 'ALL',\n        handlerCCID : function(returnObj){\n          // TODO: 处理CCID信息\n          var rObj = Wb.decode(returnObj) ;\n          r.set('ACC_ID', rObj.acc_id) ;    \n          r.set('ACC_NAME', rObj.acc_name);\n          r.set('CCID', rObj.acc_ccid) ;    \n          r.set('CCID_NAME', rObj.acc_ccid_name);\n          if(!Wb.isEmpty(rObj.dim_id)){\n            r.set('DIM_ID', rObj.dim_id) ;\n            r.set('DIM_NAME', rObj.dim_name) ;\n          }\n          // 禁用账簿\n           app.LEDGER_ID_XWL.LEDGER_ID.setReadOnly(true) ;\n        }\n      });\n    }  \n  }) ;   \n}"},"children":[],"expanded":true,"type":"combo"}],"expanded":true,"type":"column"},{"configs":{"text":"<font color = 'red'>*<\/font>{#AMOUNT_COL#}","align":"right","width":"100","dataIndex":"AMOUNT","titleAlign":"center","format":"0,000.00","itemId":"AMOUNT_COL6"},"children":[{"configs":{"allowBlank":"false","itemId":"editor","maxValue":"0"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"column"},{"configs":{"text":"{#AR_CREATED_BY_NAME_COL#}","hidden":"true","width":"100","dataIndex":"AR_CREATED_BY_NAME","titleAlign":"center","itemId":"AR_CREATED_BY_NAME_COL6"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"<font color = 'red'>*<\/font>{#DESCRIPTION_COL#}","dataIndex":"DESCRIPTION","titleAlign":"center","itemId":"DESCRIPTION_COL6","flex":"1"},"children":[{"configs":{"itemId":"editor"},"children":[],"expanded":false,"type":"textarea"}],"expanded":true,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"},{"configs":{"region":"south","itemId":"form2"},"children":[{"configs":{"layout":"column","margin":"5 10 5 10","border":"false","itemId":"tr1"},"children":[{"configs":{"layout":"fit","columnWidth":".25","border":"false","itemId":"td1"},"children":[{"configs":{"itemId":"CREATED_BY"},"children":[],"expanded":false,"type":"hidden"},{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"CREATED_BY_NAME","fieldLabel":"{#CREATED_BY_NAME#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".25","border":"false","itemId":"td2"},"children":[{"configs":{"itemId":"SIGNATORY_ID"},"children":[],"expanded":false,"type":"hidden"},{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"SIGNATORY","fieldLabel":"{#SIGNATORY#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".25","border":"false","itemId":"td3"},"children":[{"configs":{"itemId":"V_HEAD_ID"},"children":[],"expanded":false,"type":"hidden"},{"configs":{"labelWidth":"80","readOnly":"true","hidden":"true","labelAlign":"right","itemId":"V_STATUS","fieldLabel":"{#V_STATUS#}"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"V_STATUS_NAME","fieldLabel":"{#V_STATUS#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"form"}],"expanded":true,"type":"panel"},{"configs":{"file":"m?xwl=xc/gl/journal/v-windows/new-xwl-voucher","itemId":"edit_v_xwl"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"tab"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}