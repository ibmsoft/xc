{"inframe":false,"title":"收款单查询","hidden":false,"roles":{"default":1},"children":[{"configs":{"serverScript":"//获取多语言的类别\nvar lang = request.getSession().getAttribute(\"XzSessionVars\").get('language');\nrequest.setAttribute(\"language\",lang);\n\nvar data = app.get();\nvar sql = \"\";\n//单据类型\n// if(!(Wb.isEmpty(data.AR_DOC_CAT_CODE) || data.AR_DOC_CAT_CODE == 'SKD_ALL')){\n//   sql += \" and h.AR_DOC_CAT_CODE = '\"+data.AR_DOC_CAT_CODE+\"'\";\n// }\n\nif(data.AR_DOC_CAT_CODE != 'ALL'){\n  sql += \" and h.AR_DOC_CAT_CODE = '\"+data.AR_DOC_CAT_CODE+\"'\";\n}\n//收款单编码\nif(!Wb.isEmpty(data.AR_PAY_H_CODE)){\n  sql += \" and h.AR_PAY_H_CODE like '%\"+data.AR_PAY_H_CODE+\"%'\";\n}\n//金额1\nif(!Wb.isEmpty(data.AMOUNT1)){\n\tsql += \" and h.AMOUNT >= \"+data.AMOUNT1+\"\";\n}\n//金额2\nif(!Wb.isEmpty(data.AMOUNT2)){\n\tsql += \" and h.AMOUNT <= \"+data.AMOUNT2+\"\";\n}\n//客户\nif(!Wb.isEmpty(data.CUSTOMER)){\n\tsql += \" and customer.CUSTOMER_NAME like '%\"+data.CUSTOMER+\"%'\";\n}\n//项目\nif(!Wb.isEmpty(data.PROJECT)){\n\tsql += \" and project.PROJECT_NAME like '%\"+data.PROJECT+\"%'\";\n}\n//日期1\nif(!Wb.isEmpty(data.DATE1)){\n\tsql += \" and h.GL_DATE >= '\"+data.DATE1+\"'\";\n}\n//日期2\nif(!Wb.isEmpty(data.DATE2)){\n\tsql += \" and h.GL_DATE <= '\"+data.DATE2+\"'\";\n}\n//凭证状态\n// if(!Wb.isEmpty(data.V_STATUS) ){\n//   sql += \" and h.V_STATUS = '\"+data.V_STATUS+\"'\";\n// }\nif(data.V_STATUS != 'ALL'){\n  sql += \" and h.V_STATUS = '\"+data.V_STATUS+\"'\";\n}\n//签字状态\nif(data.SIGN_STATUS == 'Y'){\n  sql += \" and (h.SIGNATORY_ID is not null and h.SIGNATORY_ID <> '')\";\n}else if(data.SIGN_STATUS == 'N'){\n  sql += \" and (h.SIGNATORY_ID is null or h.SIGNATORY_ID = '')\";\n}else {\n\n}\n\nrequest.setAttribute('sql',sql);","itemId":"module"},"children":[{"configs":{"sql":"select \n  h.AR_PAY_H_ID , -- id\n  h.AR_PAY_H_CODE , -- 编号\n  h.AR_DOC_CAT_CODE , -- 单据类型\n  h.LEDGER_ID , ledger.LEDGER_NAME, -- 账簿\n  h.GL_DATE , -- 业务日期\n  h.CUSTOMER_ID , customer.CUSTOMER_NAME, -- 客户\n  h.PROJECT_ID , project.PROJECT_NAME, -- 项目\n  h.DEPT_ID , dept.DEPT_NAME, -- 成本中心\n  h.AR_CONTRACT_ID , contract.AR_CONTRACT_NAME, -- 所属合同\n  h.AMOUNT , -- 收款金额\n  CASE \n    WHEN (h.AR_DOC_CAT_CODE = 'SKD_YUSK-H' AND h.SOURCE = 'TEMP') OR h.AR_DOC_CAT_CODE = 'SKD_YUSK' THEN (SELECT SUM(NO_CANCEL_AMT) FROM xc_ar_pay_l WHERE AR_PAY_H_ID = H.AR_PAY_H_ID)\n    ELSE 0\n  END NO_CANCEL_AMT, -- 可核销金额\n  h.DESCRIPTION , -- 摘要\n  h.SALE_ACC_ID , account.ACC_NAME , -- 科目\n  h.SALE_CCID , ccid.CCID_NAME , -- 科目组合\n  h.CREATED_BY , emp.EMP_NAME as CREATED_BY_NAME, -- 创建人\n  h.SIGNATORY_ID , h.SIGNATORY , -- 签字人\n  h.V_HEAD_ID , -- 凭证\n  h.V_STATUS -- 状态\nfrom xc_ar_pay_h h\n  left join xc_gl_ledgers ledger on ledger.LEDGER_ID = h.LEDGER_ID\n  left join xc_ar_customers customer on customer.CUSTOMER_ID = h.CUSTOMER_ID\n  left join xc_pm_projects project on project.PROJECT_ID = h.PROJECT_ID\n  left join xip_pub_depts dept on dept.DEPT_ID = h.DEPT_ID\n  left join xc_ar_contract contract on contract.AR_CONTRACT_ID = h.AR_CONTRACT_ID\n  left join xc_gl_accounts account on account.ACC_ID = h.SALE_ACC_ID\n  left join xc_gl_ccid ccid on ccid.CCID = h.SALE_CCID\n  left join xip_pub_emps emp on emp.EMP_ID = (select EMP_ID from xip_pub_users where USER_ID=h.CREATED_BY)\nwhere \n\th.LEDGER_ID = {?LEDGER_ID?}\nand\th.INIT = '2'\n{#sql#}\norder by h.CREATION_DATE DESC\n","itemId":"dataprovider1"},"children":[],"expanded":false,"type":"dataprovider"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":"seek_icon"}