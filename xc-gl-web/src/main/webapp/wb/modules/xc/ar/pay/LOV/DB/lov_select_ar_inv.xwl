{"inframe":false,"title":"选择应收单","hidden":false,"roles":{"default":1},"children":[{"configs":{"serverScript":"var data = app.get();\nvar sql = '';\n//客户\n// if(!Wb.isEmpty(data.CUSTOMER_ID)){\n//   sql += \" and h.CUSTOMER_ID = '\"+data.CUSTOMER_ID+\"' \";\n// }\n//项目\nif(!Wb.isEmpty(data.PROJECT)){\n  sql += \" and (project.PROJECT_CODE like '%\"+data.PROJECT+\"%' or project.PROJECT_NAME like '%\"+data.PROJECT+\"%')\";\n}\n//成本中心\nif(!Wb.isEmpty(data.DEPT)){\n  sql += \" and (dept.DEPT_CODE like '%\"+data.DEPT+\"%' or dept.DEPT_NAME like '%\"+data.DEPT+\"%')\";\n}\n//项目\nif( !Wb.isEmpty(data.PROJECT_ID) ){\n  sql += \" and h.project_id = '\"+data.PROJECT_ID+\"'\";\n}\n//合同\nif( !Wb.isEmpty(data.AR_CONTRACT_ID) ){\n  sql += \" and h.AR_CONTRACT_ID = '\"+data.AR_CONTRACT_ID+\"'\";\n}else{\n  sql += \" and (h.AR_CONTRACT_ID is null or h.AR_CONTRACT_ID = '') \";\n}\n//合同\nif(!Wb.isEmpty(data.CONTRACT)){\n  sql += \" and (contract.AR_CONTRACT_CODE like '%\"+data.CONTRACT+\"%' or contract.AR_CONTRACT_NAME like '%\"+data.CONTRACT+\"%')\";\n}\n//日期\nif(!Wb.isEmpty(data.GL_DATE1)){\n  sql += \" and h.GL_DATE >= '\"+data.GL_DATE1+\"'\";\n}\nif(!Wb.isEmpty(data.GL_DATE2)){\n  sql += \" and h.GL_DATE <= '\"+data.GL_DATE2+\"'\";\n}\n//摘要\nif(!Wb.isEmpty(data.DESCRIPTION)){\n  sql += \" and h.DESCRIPTION LIKE '%\"+data.DESCRIPTION+\"%'\";\n}\n//单据类型\nif(data.AR_CAT_DOC_CODE == 'SKD_JSK'){\n  sql += \" AND h.AR_DOC_CAT_CODE NOT LIKE '%-H%'\";\n  sql += \" AND h.NO_PAY_AMT > 0\";\n}else if(data.AR_CAT_DOC_CODE == 'SKD_JSK-H'){\n  sql += \" AND h.AR_DOC_CAT_CODE LIKE '%-H%'\";\n  sql += \" AND h.NO_PAY_AMT < 0\";\n}\n\nrequest.setAttribute('sql',sql);\n","itemId":"module"},"children":[{"configs":{"sql":"SELECT \n  h.AR_INV_GL_H_ID, \n  h.AR_INV_GL_H_CODE, \n  h.AR_INV_H_ID, \n  h.L_AR_INV_GL_H_ID, \n  h.AR_DOC_CAT_CODE, \n  h.LEDGER_ID, \n  h.GL_DATE,\n  h.CUSTOMER_ID, customer.CUSTOMER_CODE,customer.CUSTOMER_NAME, \n  h.PROJECT_ID, project.PROJECT_CODE, project.PROJECT_NAME, \n  h.DEPT_ID, dept.DEPT_CODE, dept.DEPT_NAME,  \n  h.AR_CONTRACT_ID, contract.AR_CONTRACT_CODE, contract.AR_CONTRACT_NAME, \n  h.INV_AMOUNT,  \n  h.NO_PAY_AMT,  \n  0 AS JS_AMOUNT,\n  h.AR_ACC_ID_DEBT,account.ACC_NAME AS AR_ACC_NAME_DEBT,\n  h.AR_CCID_DEBT,ccid.CCID_NAME AS AR_CCID_NAME_DEBT,\n  h.DESCRIPTION,\n  ledger.AR_ACCOUNT_STATUS\nFROM xc_ar_inv_gl_h h\n  LEFT join xc_gl_ledgers ledger on ledger.LEDGER_ID = h.LEDGER_ID\n  LEFT JOIN xc_ar_customers customer ON customer.CUSTOMER_ID = h.CUSTOMER_ID\n  LEFT JOIN xc_pm_projects project ON project.PROJECT_ID = h.PROJECT_ID\n  LEFT JOIN xip_pub_depts dept ON dept.DEPT_ID = h.DEPT_ID\n  LEFT JOIN xc_ar_contract contract ON contract.AR_CONTRACT_ID = h.AR_CONTRACT_ID\n  LEFT JOIN xc_gl_accounts account ON account.ACC_ID = h.AR_ACC_ID_DEBT\n  LEFT JOIN xc_gl_ccid ccid ON ccid.CCID = h.AR_CCID_DEBT\nWHERE h.LEDGER_ID = {?LEDGER_ID?}\n  AND h.CUSTOMER_ID = {?CUSTOMER_ID?}\n  AND h.V_STATUS >= 3\n  AND h.AR_INV_GL_H_CODE IS NOT NULL\n  AND h.AR_INV_GL_H_CODE <> ''\n{#sql#}\nORDER BY h.CREATION_DATE DESC\n","itemId":"dataprovider1"},"children":[],"expanded":false,"type":"dataprovider"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":"seek_icon"}