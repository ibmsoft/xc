{"inframe":false,"title":"余额调整单编辑无容器模式","hidden":false,"roles":{"default":1},"children":[{"configs":{"serverScript":"com.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,'xc/ar/adj/json/XC_AR_INV_GL_ADJ_NO_C');\nvar contextPath = request.getContextPath();\nrequest.setAttribute(\"contextPath\",contextPath);\n//var vHeadId = request.getParameter(\"vHeadId\");\n//request.setAttribute('vHeadId',vHeadId);\nrequest.setAttribute('opmode','view');\nrequest.setAttribute('vtype','normal');\n//request.setAttribute('headId',vHeadId);\n","head":"<style type=\"text/css\">\n  .my_custom_grid .x-grid-row{\n      height:50px;\n  }\n  .my_custom_grid .x-grid-editor .x-form-text{\n      height:49px;\n  }\n  .my_custom_grid .x-grid-cell{\n      font: normal 12px/13px tahoma, arial, verdana, sans-serif;\n  }\n  .my_custom_grid .x-grid-cell{\n      border-color: #d0d0d0;\n  }\n  .my_custom_grid .x-grid-with-col-lines .x-grid-cell {\n    border-right-width: 1px;\n  }\n  .my_custom_grid .x-grid-with-row-lines .x-grid-td {\n    border-bottom-width: 1px;\n}\n<\/style>","itemId":"module"},"events":{"initialize":"Wb.keyValue = '';\nWb.isInsert = 'Y';\nWb.formValue = '';\nExt.apply(app, {\n    initWin: function(params) {\n        Ext.apply(app, params);\n        app.editWinN = new Ext.window.Window(app.editWinN);\n        app.editWinN.show();\n        Wb.isInsert = params.IS_INSERT;\n        Wb.keyValue = params.GL_ADJ_ID;\n\n        if (Wb.isInsert == 'Y') {//新增\n            app.GL_ADJ_ID.setValue(Xip.getId());\n            app.GL_DATE.setValue(new Date());\n            app.CREATED_BY_NAME.setValue('{#XIP.empName#}');\n          \tapp.ldInitStore.load();\n        }\n        if (Wb.isInsert == 'N') {//修改\n            Wb.request({\n                url: 'm?xwl=xc/ar/adj/DB/XC_AR_INV_GL_ADJ_SELECT_BY_ID',\n                params: {\n                    GL_ADJ_ID: Wb.keyValue\n                },\n                success: function(resp) {\n                    var r = Wb.decode(resp.responseText);\n                    r.GL_DATE = Wb.strToDate(r.GL_DATE);\n                    if(r.V_STATUS_CODE === '1' || r.V_STATUS_CODE === '' || r.V_STATUS_CODE === null){//凭证状态为空，草稿\n                        app.saveBtn.setDisabled(false);\n                        app.verfyBtn.setDisabled(false);\n                    }\n                    else{\n                        app.saveBtn.setDisabled(true);\n                      \tapp.verfyBtn.setDisabled(true);\n                      \tapp.cancelVerfyBtn.setDisabled(false);\n                    }\n                    Wb.setValue(app.editWinN, r);\n                    app.CUSTOMER_ID_XWL.QUERY_LEDGER_ID.setValue(r.LEDGER_ID);\n                  \tapp.AR_INV_GL_H_ID_XWL.QUERY_LEDGER_ID.setValue(r.LEDGER_ID);\n                   \tapp.AR_INV_GL_H_ID_XWL.QUERY_CUSTOMER_ID.setValue(r.CUSTOMER_ID);\n                    app.LEDGER_ID_XWL.LEDGER_NAME.setReadOnly(true);\n                    Wb.formValue = Wb.encode(Wb.getValue(app.form1));\n                }\n            });\n          \n        }\n        if (Wb.isInsert == 'S') {//查看\n            Wb.request({\n                url: 'm?xwl=xc/ar/adj/DB/XC_AR_INV_GL_ADJ_SELECT_BY_ID',\n                params: {\n                    GL_ADJ_ID: Wb.keyValue\n                },\n                success: function(resp) {\n                    var r = Wb.decode(resp.responseText);\n                    r.GL_DATE = Wb.strToDate(r.GL_DATE);\n                    Wb.setValue(app.editWinN, r);\n                    app.CUSTOMER_ID_XWL.QUERY_LEDGER_ID.setValue(r.LEDGER_ID);\n                    //app.TO_CCID_XWL.QUERY_LEDGER_ID.setValue(r.data.LEDGER_ID);\n                }\n            });\n            app.form1Tbar.hide();\n        }\n        app.LEDGER_ID_XWL.LEDGER_NAME.allowBlank = false;\n        app.CUSTOMER_ID_XWL.CUSTOMER_NAME.allowBlank = false;\n    }\n});\n\nfunction returnRowFn(r, type) {\n    if (type == 'xc_gl_ledgers') {//选中账簿\n\t\tapp.AR_INV_GL_H_ID_XWL.QUERY_LEDGER_ID.setValue(r.data.LEDGER_ID);\n    \tapp.CUSTOMER_ID_XWL.QUERY_LEDGER_ID.setValue(r.data.LEDGER_ID);\n    \tapp.CUSTOMER_ID_XWL.CUSTOMER_NAME.getPicker().getStore().removeAll();\n    \tapp.CUSTOMER_ID_XWL.CUSTOMER_ID.setValue('');\n    \tapp.CUSTOMER_ID_XWL.CUSTOMER_NAME.setValue('');\n    \tapp.AR_INV_GL_H_ID_XWL.AR_INV_GL_H_CODE.setValue('');\n    \tapp.AR_INV_GL_H_ID_XWL.AR_INV_GL_H_ID.setValue('');\n    \tapp.AR_INV_GL_H_ID_XWL.AR_INV_GL_H_CODE.getPicker().getStore().removeAll();\n      \n    }\n    if (type == 'xc_ar_inv_gl_h') {//选中应收单\n        app.AR_DOC_CAT_NAME.setValue(r.data.AR_DOC_CAT_NAME);\n        app.AR_ACC_NAME_DEBT.setValue(r.data.AR_ACC_NAME_DEBT);\n      \tapp.AR_DOC_CAT_CODE.setValue(r.data.AR_DOC_CAT_CODE);\n        Wb.request({\n          url: 'm?xwl=xc/ar/adj/DB/XC_AR_INV_GL_ADJ_CODE',\n          params: {AR_INV_GL_H_ID:r.data.AR_INV_GL_H_ID,AR_INV_GL_H_CODE:r.data.AR_INV_GL_H_CODE},\n          success: function(resp) {\n            var o = Wb.decode(resp.responseText);\n            app.GL_ADJ_CODE.setValue(r.data.AR_INV_GL_H_CODE+'('+o.GL_ADJ_CODE+')');\n          }\n        });\n    }\n        //选择供应商后为合同名称加筛选条件//同时将应付单中加上供应商查询\n    if (type == 'xc_ar_customers') {//选中客户\n      app.AR_INV_GL_H_ID_XWL.QUERY_CUSTOMER_ID.setValue(r.data.CUSTOMER_ID);\n      app.AR_INV_GL_H_ID_XWL.AR_INV_GL_H_ID.setValue('');\n      app.AR_INV_GL_H_ID_XWL.AR_INV_GL_H_CODE.setValue('');\n      app.AR_INV_GL_H_ID_XWL.QUERY_LEDGER_ID.setValue(app.LEDGER_ID_XWL.LEDGER_ID.getValue());\n      app.AR_DOC_CAT_NAME.setValue('');\n      app.AR_ACC_NAME_DEBT.setValue('');\n    }\n}\nfunction clearOtherFn(type){\n if(type=='xc_gl_ledgers'){//选中账簿\n   \tapp.CUSTOMER_ID_XWL.QUERY_LEDGER_ID.setValue('');\n    app.CUSTOMER_ID_XWL.CUSTOMER_ID.setValue('');\n    app.CUSTOMER_ID_XWL.CUSTOMER_NAME.setValue('');\n    app.CUSTOMER_ID_XWL.CUSTOMER_NAME.getPicker().getStore().removeAll();\n    app.AR_INV_GL_H_ID_XWL.QUERY_LEDGER_ID.setValue('');\n    app.AR_INV_GL_H_ID_XWL.AR_INV_GL_H_CODE.setValue('');\n    app.AR_INV_GL_H_ID_XWL.AR_INV_GL_H_ID.setValue('');\n    app.AR_INV_GL_H_ID_XWL.AR_INV_GL_H_CODE.getPicker().getStore().removeAll();\n    app.AR_DOC_CAT_NAME.setValue('');\n    app.AR_ACC_NAME_DEBT.setValue('');\n   \tWb.request({\n  \t\turl:'m?xwl=xc/ap/req/DB/getPeriodDate',\n  \t\tparams:{'LEDGER_ID':r.data.LEDGER_ID},\n  \t\tsuccess:function(resp){\n    \t\tvar rec = Wb.decode(resp.responseText);\n    \t\tapp.GL_DATE.setMinValue(new Date(rec.rows[0].START_DATE));\n  }\n});\n  }\n  if(type=='xc_ar_inv_gl_h'){//选中应收单\n    app.AR_DOC_CAT_NAME.setValue('');\n    app.AR_ACC_NAME_DEBT.setValue('');\n    app.AR_DOC_CAT_CODE.setValue('');\n  }\n}"},"children":[{"configs":{"itemId":"request"},"children":[{"configs":{"itemId":"ldInitStore","url":"m?xwl=xc/com-lov/LEDGER_ID_PICK/DB/XC_GL_LEDGERS_SELECT_SEC"},"events":{"load":"\nWb.ledgerStroe = store;\n\napp.LEDGER_ID_XWL.LEDGER_ID.setValue(store.getAt(0).get('LEDGER_ID'));\napp.LEDGER_ID_XWL.LEDGER_NAME.setValue(store.getAt(0).get('LEDGER_NAME'));\napp.CUSTOMER_ID_XWL.QUERY_LEDGER_ID.setValue(store.getAt(0).get('LEDGER_ID'));\napp.AR_INV_GL_H_ID_XWL.QUERY_LEDGER_ID.setValue(store.getAt(0).get('LEDGER_ID'));\n\n"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"folder"},{"configs":{"itemId":"form1Tbar"},"children":[{"configs":{"text":"{#add#}","itemId":"AddBtn","iconCls":"file_add_icon"},"events":{"click":"app.form1.getForm().reset();\napp.GL_ADJ_ID.setValue(Xip.getId());\nWb.isInsert = 'Y';\n app.GL_DATE.setValue(new Date());\n app.saveBtn.setDisabled(false);\n app.LEDGER_ID_XWL.LEDGER_NAME.setReadOnly(false);\n\nvar lstore = Wb.ledgerStroe;\nif(lstore.getCount()==1){\napp.LEDGER_ID_XWL.LEDGER_ID.setValue(lstore.getAt(0).get('LEDGER_ID'));\napp.LEDGER_ID_XWL.LEDGER_NAME.setValue(lstore.getAt(0).get('LEDGER_NAME'));\napp.CUSTOMER_ID_XWL.QUERY_LEDGER_ID.setValue(lstore.getAt(0).get('LEDGER_ID'));\napp.AR_INV_GL_H_ID_XWL.QUERY_LEDGER_ID.setValue(lstore.getAt(0).get('LEDGER_ID'));\napp.TO_CCID_XWL.QUERY_LEDGER_ID.setValue(lstore.getAt(0).get('LEDGER_ID'));\n\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#save#}","itemId":"saveBtn","iconCls":"save_icon"},"events":{"click":"if (!Wb.verify(app.form1)) {//表格数据不合法\n  Wb.toast('{#saveMsg1#}');\n  return;\n}\napp.CR_AMT.setValue(0);\napp.DR_AMT.setValue(app.ADJ_AMT.getValue());\n\nWb.request({\n  url: 'm?xwl=xc/ar/adj/DB/XC_AR_INV_GL_ADJ_CHECK',\n  params: {\n    AR_INV_GL_H_ID: app.AR_INV_GL_H_ID_XWL.AR_INV_GL_H_ID.getValue()\n  },\n  success: function(resp) {\n    var o = Wb.decode(resp.responseText);\n    if (Wb.isEmpty(o.NO_PAY_AMT)) {\n      o.NO_PAY_AMT = 0;\n    }\n    if(o.AR_DOC_CAT_CODE=='YSD-HZ'){\n      if ((Number(o.NO_PAY_AMT) + Number(app.ADJ_AMT.getValue())) >0){\n        Wb.toast('{#saveMsg2#}');\n        return;\n      }\n    }else if(o.AR_DOC_CAT_CODE=='YSD'){\n      if ((Number(o.NO_PAY_AMT) + Number(app.ADJ_AMT.getValue())) < 0) {\n        Wb.toast('{#saveMsg2#}');\n        return;\n      }\n    }\n    Wb.request({\n      url:'{#contextPath#}'+'/arInvGlAdjAction.do?method=saveInvAdj',//调用后台方法\n      params:{'params':Wb.getValue(app.form1)},\n      success:function(resp){\n        var rec = Wb.decode(resp.responseText);\n        if (rec.flag=='0') {\n          Wb.toast('{#saveMsg3#}');\n          app.V_HEAD_ID.setValue(rec.headId);\n          app.V_STATUS_NAME.setValue('{#draft#}');\n          app.verfyBtn.setDisabled(false);\n          app.edit_v_xwl.v_head_id.setValue(rec.headId);\n          Wb.isInsert = 'N';\n          Wb.formValue =Wb.encode(Wb.getValue(app.form1));\n        }else if(rec.flag=='1') {\n          Wb.toast(rec.msg);\n        }\n      }\n    });\n  }\n});"},"children":[],"expanded":true,"type":"button"},{"configs":{"text":"{#verify#}","itemId":"verfyBtn","disabled":"true","iconCls":"user_edit_icon"},"events":{"click":"var headId = app.V_HEAD_ID.getValue();//凭证头ID\nif(Wb.formValue!=Wb.encode(Wb.getValue(app.form1))&&Wb.formValue!=''){\n   Wb.toast('{#verifyMsg1#}');\n   return;\n}\nif(app.V_STATUS_NAME.getValue() !== '{#draft#}'){//凭证状态为草稿\n    Wb.toast('{#verifyMsg2#}');\n    return;\n}\nelse{\n    var docArray = [] ;\n    var paramJson = {'headId' : app.V_HEAD_ID.getValue(),'arId':app.GL_ADJ_ID.getValue(),arCatCode:'TZD'} ;\n    docArray.push(paramJson) ;\n    Wb.request({\n        url: '{#contextPath#}'+'/arInvGlAdjAction.do?method=checkArVoucher',//调用后台方法\n        params: Wb.apply({arInfo: docArray}),\n        success: function(resp) {\n            var record = Wb.decode(resp.responseText);\n            if(record.flag === '0'){\n                Wb.toast('{#verifyMsg3#}');\n                app.V_STATUS_NAME.setValue('{#verifyMsg3#}');\n                app.saveBtn.setDisabled(true);\n              \tapp.verfyBtn.setDisabled(true);\n              \tapp.cancelVerfyBtn.setDisabled(false);\n            }\n            if(record.flag === '1'){\n                Wb.toast(record.msg);\n            }\n        }\n\t});\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#cancelVerify#}","itemId":"cancelVerfyBtn","disabled":"true","iconCls":"user_delete_icon"},"events":{"click":"var headId = app.V_HEAD_ID.getValue();\nif(headId === '' || headId === null){\n    Wb.toast('{#cancelMsg1#}');\n    return;\n}\nif(app.V_STATUS_NAME.getValue() === '{#draft#}'){\n    Wb.toast('{#cancelMsg2#}');\n    return;\n}\nelse{\n    var docArray = [] ;\n    var paramJson = {'headId' : app.V_HEAD_ID.getValue(),'arId':app.GL_ADJ_ID.getValue(),arCatCode:'TZD'} ;\n    docArray.push(paramJson) ;\n    Wb.request({\n        url: '{#contextPath#}'+'/arInvGlAdjAction.do?method=cancelCheckArVoucher',\n        params: Wb.apply({'arInfo': docArray}),\n        success: function(resp) {\n            var record = Wb.decode(resp.responseText);  \n            if(record.flag === '0'){\n                Wb.toast('{#cancelVerify#}');\n                app.V_STATUS_NAME.setValue('{#draft#}');\n                app.saveBtn.setDisabled(false);\n              \tapp.verfyBtn.setDisabled(false);\n              \tapp.cancelVerfyBtn.setDisabled(true);\n            }\n            if(record.flag === '1'){\n                Wb.toast(record.msg);\n            }\n        }\n\t});\n}"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"maximized":"true","layout":"fit","itemId":"editWinN","modal":"true"},"events":{"close":"app.hideFun();"},"children":[{"configs":{"itemId":"tabs"},"events":{"beforetabchange":"//加载凭证信息\nif(newCard.title === app.edit_v_xwl.xwl_v_panel.title){\n    Wb.request({\n        url: 'm?xwl=xc/gl/journal/data-db/common-data/select-v-head',\n        params: {'headId' : app.V_HEAD_ID.getValue()},\n        success: function(resp) {\n            var headJson = Wb.decode(resp.responseText);\n            Wb.setValue(app.edit_v_xwl.form1,headJson);\n            Wb.setValue(app.edit_v_xwl.bbar,headJson);\n            //处理会计日期\n            var accDate = headJson.accountDate;\n            app.edit_v_xwl.accountDate.setValue(Wb.strToDate(accDate));\n        }\n    });\n    // 加载凭证分录行\n    app.edit_v_xwl.grid1.getStore().load({params :{'headId':app.V_HEAD_ID.getValue()}});\n}\n"},"children":[{"configs":{"region":"center","title":"{#panel1#}","layout":"fit","itemId":"tab1"},"children":[{"configs":{"tbar":"app.form1Tbar","height":"180","itemId":"form1"},"children":[{"configs":{"height":"55","padding":"10 50 0 70","border":"false","itemId":"tr_1"},"children":[{"configs":{"style":"fontSize:20px","margin":"10 0 20 0","html":"<font style=\"\">{#title#}<\/font>","labelAlign":"center","itemId":"title"},"children":[],"expanded":false,"type":"label"}],"expanded":false,"type":"panel"},{"configs":{"layout":"column","padding":"10 0 0 20","border":"false","itemId":"tr_2"},"children":[{"configs":{"layout":"form","columnWidth":".24","border":"false","itemId":"td_1"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/LEDGER_ID_PICK/LEDGER_ID_PICK_SEC","itemId":"LEDGER_ID_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".24","border":"false","itemId":"td_2"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","emptyText":"{#system#}","labelAlign":"right","itemId":"GL_ADJ_CODE","fieldLabel":"{#glAdjCode#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".24","border":"false","itemId":"td_3"},"children":[{"configs":{"file":"m?xwl=xc/ar/ar-com-lov/AR_CUSTOMER_ID_PICK/AR_CUSTOMER_ID_PICK","itemId":"CUSTOMER_ID_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".24","border":"false","itemId":"td_4"},"children":[{"configs":{"labelWidth":"80","allowBlank":"false","labelAlign":"right","itemId":"GL_DATE","fieldLabel":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#glDate#}"},"events":{"expand":"Wb.request({\n  url:'m?xwl=xc/ap/req/DB/getPeriodDate',\n  params:{'LEDGER_ID':app.LEDGER_ID_XWL.LEDGER_ID.getValue()},\n  success:function(resp){\n    var rec = Wb.decode(resp.responseText);\n    app.GL_DATE.setMinValue(new Date(rec.rows[0].START_DATE));\n  }\n});"},"children":[],"expanded":false,"type":"date"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"layout":"column","border":"false","padding":"10 0 0 20","itemId":"tr_3"},"children":[{"configs":{"layout":"form","columnWidth":".24","border":"false","itemId":"td_4"},"children":[{"configs":{"file":"m?xwl=xc/ar/ar-com-lov/AR_INV_GL_H_ID_PICK/AR_INV_GL_H_ID_PICK_ALL","itemId":"AR_INV_GL_H_ID_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".24","border":"false","itemId":"td_5"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"AR_DOC_CAT_NAME","fieldLabel":"{#docCatName#}"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"80","readOnly":"true","hidden":"true","labelAlign":"right","itemId":"AR_DOC_CAT_CODE","fieldLabel":"{#docCatName#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".24","border":"false","itemId":"td_7"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"AR_ACC_NAME_DEBT","fieldLabel":"{#accName#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".24","border":"false","itemId":"td_6"},"children":[{"configs":{"labelWidth":"80","allowBlank":"false","labelAlign":"right","itemId":"ADJ_AMT","fieldLabel":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#adjAmt#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":false,"type":"panel"},{"configs":{"layout":"column","border":"false","padding":"10 0 0 20","itemId":"tr_4"},"children":[{"configs":{"layout":"form","columnWidth":".48","border":"false","itemId":"td_8"},"children":[{"configs":{"labelWidth":"80","allowBlank":"false","labelAlign":"right","itemId":"DESCRIPTION","fieldLabel":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#description#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".24","border":"false","itemId":"td_9"},"children":[{"configs":{"hidden":"true","itemId":"TO_CCID"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"80","allowBlank":"false","displayField":"CCID_NAME","triggerCls":"x-form-search-trigger","valueField":"CCID","labelAlign":"right","itemId":"CCID_NAME","fieldLabel":"<font color='red'>*<\/font>{#ccidName#}","onTriggerClick":"  // 账簿\n  var ledgerId = app.LEDGER_ID_XWL.LEDGER_ID.getValue() ;\n  if(ledgerId === \"\" ||ledgerId === null || ledgerId === undefined){\n    Wb.info('{#ccidMsg1#}') ;\n    return false ;\n  }\n  // 会计日期\n  var accDate = app.GL_DATE.getValue() ;\n  if(accDate === \"\" ||accDate === null || accDate === undefined){\n    Wb.info('{#ccidMsg2#}') ;\n    return false ;\n  }else{\n\taccDate = Wb.dateToStr(accDate).substring(0,7);\n  }\n  // TODO: 显示科目选择窗口\n  Wb.run({\n    url:'m?xwl=xc/gl/journal/v-windows/handler-ccid-win',\n    params : {\n      'ledgerId' : ledgerId,\n      'vtype' : '{#vtype#}'\n    },          \n    success:function(appObj){\n      appObj.initWindow({\n        accName : '',\n        ledgerId : ledgerId,\n        periodCode : accDate ,\n        groupId : 'ALL',\n        handlerCCID : function(returnObj){\n          // TODO: 处理CCID信息\n          var rObj = Wb.decode(returnObj) ;\n          app.TO_CCID.setValue(rObj.acc_ccid);\n          app.CCID_NAME.setRawValue(rObj.acc_ccid_name);\n          app.LEDGER_ID_XWL.LEDGER_ID.setReadOnly(true) ;\n        }\n      });\n    }  \n  }) ;   "},"events":{"beforequery":"var combo = e.combo;\nif(!e.forceAll){\n  var value = e.query;\n  combo.store.filterBy(function(record,id){\n    var text = record.get(combo.displayField);\n    return (text.indexOf(value)!=-1);\n  });\n  combo.expand();\n  return false;\n}","specialkey":"// TODO: 按回车键执行借方和贷方金额切换\nif (e.getKey() == e.ENTER) {\n  // 账簿\n  var ledgerId = app.LEDGER_ID_XWL.LEDGER_ID.getValue() ;\n  if(ledgerId === \"\" ||ledgerId === null || ledgerId === undefined){\n    Wb.info('请选择账簿!') ;\n    return false ;\n  }\n  \n  // 会计日期\n  var accDate = app.GL_DATE.getValue();\n  if(accDate === \"\" ||accDate === null || accDate === undefined){\n    Wb.info('请选择会计日期!') ;\n    return false ;\n  }else{\n    accDate = Wb.dateToStr(accDate).substring(0,7);\n  }\n  \n  \n  // TODO: 显示科目选择窗口\n  Wb.run({\n    url:'m?xwl=xc/gl/journal/v-windows/handler-ccid-win',\n    params : {\n      'ledgerId' : ledgerId ,\n      'vtype' : '{#vtype#}'\n    },          \n    success:function(appObj){\n      appObj.initWindow({\n        accName : '',\n        ledgerId : ledgerId,\n        periodCode : accDate ,\n        groupId : 'ALL',\n        handlerCCID : function(returnObj){\n          // TODO: 处理CCID信息\n          var rObj = Wb.decode(returnObj) ;\n          app.TO_CCID.setValue(rObj.acc_ccid);\n          app.CCID_NAME.setRawValue(rObj.acc_ccid_name);\n          app.LEDGER_ID_XWL.LEDGER_ID.setReadOnly(true) ;\n        }\n      });\n    }  \n  }) ;   \n}"},"children":[],"expanded":true,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"hidden":"true","layout":"form","columnWidth":".24","border":"false","itemId":"td_10"},"children":[{"configs":{"labelWidth":"80","allowBlank":"false","value":"CR","labelAlign":"right","pickList":"[\n\t['DR','{#dr#}'],\n  \t['CR','{#cr#}']\n]","itemId":"DR_OR_CR","fieldLabel":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#direction#}","editable":"false"},"children":[],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"layout":"column","padding":"10 0 0 20","border":"false","itemId":"tr_5"},"children":[{"configs":{"layout":"form","columnWidth":".24","border":"false","itemId":"td_11"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"CREATED_BY_NAME","fieldLabel":"{#createByName#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".24","border":"false","itemId":"td_12"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","value":"{#draft#}","labelAlign":"right","itemId":"V_STATUS_NAME","fieldLabel":"{#vStatus#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"hidden":"true","itemId":"hidden_p"},"children":[{"configs":{"hidden":"true","itemId":"GL_ADJ_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","value":"{#XIP.userId#}","itemId":"USER_ID","fieldLabel":"USER_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"DR_AMT"},"children":[],"expanded":false,"type":"number"},{"configs":{"hidden":"true","itemId":"CR_AMT"},"children":[],"expanded":false,"type":"number"},{"configs":{"hidden":"true","itemId":"V_HEAD_ID","fieldLabel":"凭证头ID"},"children":[],"expanded":false,"type":"text"}],"expanded":false,"type":"panel"}],"expanded":true,"type":"form"}],"expanded":true,"type":"panel"},{"configs":{"file":"m?xwl=xc/gl/journal/v-windows/new-xwl-voucher","itemId":"edit_v_xwl"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"tab"}],"expanded":false,"type":"window"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}