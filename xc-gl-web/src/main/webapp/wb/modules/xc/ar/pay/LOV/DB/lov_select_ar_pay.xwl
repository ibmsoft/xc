{"inframe":false,"title":"选择蓝色收款单","hidden":false,"roles":{"default":1},"children":[{"configs":{"serverScript":"var data = app.get();\nvar sql = '';\n//客户\n// if(!Wb.isEmpty(data.CUSTOMER_ID)){\n//   sql += \"and h.CUSTOMER_ID = '\"+data.CUSTOMER_ID+\"' \";\n// }\n// if(!Wb.isEmpty(params.CUSTOM)){\n//   sql += \"and (customer.CUSTOMER_CODE like '%\"+params.CUSTOM+\"%' or customer.CUSTOMER_NAME like '%\"+params.CUSTOM+\"%')\";\n// }\n//项目\nif( !Wb.isEmpty(data.PROJECT_ID) ){\n  sql += \" and h.project_id = '\"+data.PROJECT_ID+\"'\";\n}\n//合同\nif( !Wb.isEmpty(data.AR_CONTRACT_ID) ){\n  sql += \" and h.AR_CONTRACT_ID = '\"+data.AR_CONTRACT_ID+\"'\";\n}else{\n  sql += \" and (h.AR_CONTRACT_ID is null or h.AR_CONTRACT_ID = '') \";\n}\n//日期\nif(!Wb.isEmpty(data.GL_DATE1)){\n  sql += \" and h.GL_DATE >= '\"+data.GL_DATE1+\"'\";\n}\nif(!Wb.isEmpty(data.GL_DATE2)){\n  sql += \" and h.GL_DATE <= '\"+data.GL_DATE2+\"'\";\n}\n//单据编码\nif(!Wb.isEmpty(data.AR_PAY_H_CODE)){\n  sql += \" and h.AR_PAY_H_CODE LIKE '%\"+data.AR_PAY_H_CODE+\"%'\";\n}\n//摘要\nif(!Wb.isEmpty(data.DESCRIPTION)){\n  sql += \" and h.DESCRIPTION LIKE '%\"+data.DESCRIPTION+\"%'\";\n}\napp.info(data.AR_CAT_DOC_CODE);\n//单据类型\n// if(data.AR_CAT_DOC_CODE == 'SKD_YUSK'){\n//   sql += \"AND h.AR_DOC_CAT_CODE NOT LIKE '%-H%'\";\n// }else if(data.AR_CAT_DOC_CODE == 'SKD_JSK-H'){\n//   sql += \"AND h.AR_DOC_CAT_CODE LIKE '%-H%'\";\n// }\n\nrequest.setAttribute('sql',sql);\n","itemId":"module"},"children":[{"configs":{"sql":"SELECT \n  h.AR_PAY_H_ID , -- id\n  l.AR_PAY_L_ID,\n  h.AR_PAY_H_CODE , -- 编号\n  h.AR_DOC_CAT_CODE , -- 单据类型\n  h.LEDGER_ID , ledger.LEDGER_NAME, -- 账簿\n  h.GL_DATE , -- 业务日期\n  h.CUSTOMER_ID , customer.CUSTOMER_NAME, -- 客户\n  h.PROJECT_ID , project.PROJECT_NAME, -- 项目\n  h.DEPT_ID , dept.DEPT_NAME, -- 成本中心\n  h.AR_CONTRACT_ID , contract.AR_CONTRACT_NAME, -- 所属合同\n  h.AMOUNT , -- 收款金额\n  l.NO_CANCEL_AMT NO_CANCEL_AMT, -- 待核销金额\n  0 AS TK_AMT, -- 退款金额\n  h.DESCRIPTION , -- 摘要\n  h.SALE_ACC_ID , account.ACC_NAME AS SALE_ACC_NAME, -- 科目\n  h.SALE_CCID , ccid.CCID_NAME AS SALE_CCID_NAME, -- 科目组合\n  h.CREATED_BY , emp.EMP_NAME, -- 创建人\n  l.ACC_ID as L_ACC_ID, \n  account_l.ACC_NAME as L_ACC_NAME,-- 行科目\n  l.CCID as L_CCID, \n  ccid_l.CCID_NAME as L_CCID_NAME-- 行科目组合\nFROM xc_ar_pay_h h\n  LEFT JOIN xc_pm_projects project ON project.PROJECT_ID = h.PROJECT_ID\n  LEFT JOIN xip_pub_depts dept ON dept.DEPT_ID = h.DEPT_ID\n  LEFT JOIN xc_ar_contract contract ON contract.AR_CONTRACT_ID = h.AR_CONTRACT_ID\n  LEFT JOIN xc_gl_accounts account ON account.ACC_ID = h.SALE_ACC_ID\n  LEFT JOIN xc_gl_ccid ccid ON ccid.CCID = h.SALE_CCID\n  LEFT JOIN xip_pub_emps emp ON emp.EMP_ID = (SELECT EMP_ID FROM xip_pub_users WHERE USER_ID=h.CREATED_BY),\n  xc_ar_pay_l l\n  LEFT JOIN xc_gl_accounts account_l ON account_l.ACC_ID = l.ACC_ID\n  LEFT JOIN xc_gl_ccid ccid_l ON ccid_l.CCID = l.CCID\n  ,xc_gl_ledgers ledger,xc_ar_customers customer\nWHERE h.LEDGER_ID = ledger.LEDGER_ID\n  AND customer.CUSTOMER_ID = h.CUSTOMER_ID\n  AND h.AR_PAY_H_ID = l.AR_PAY_H_ID\n  AND h.LEDGER_ID = {?LEDGER_ID?}\n  AND h.CUSTOMER_ID = {?CUSTOMER_ID?}\n  AND h.AR_DOC_CAT_CODE = 'SKD_YUSK'\n  AND l.NO_CANCEL_AMT > 0\n  AND h.V_STATUS >= 3\n  AND h.AR_PAY_H_CODE IS NOT NULL\n  AND h.AR_PAY_H_CODE <> ''\n{#sql#}\nORDER BY h.CREATION_DATE DESC\n\n\n","itemId":"dataprovider1"},"children":[],"expanded":false,"type":"dataprovider"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":"seek_icon"}