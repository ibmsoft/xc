{"inframe":false,"title":"","hidden":false,"roles":{"default":1},"children":[{"configs":{"initScript":"var lang = request.getSession().getAttribute(\"XzSessionVars\").get('language');\nrequest.setAttribute(\"language\",lang);","loginRequired":"false","serverScript":"var dbtype = com.xzsoft.xip.platform.util.PlatformUtil.getDbType();\nvar sql, data = app.get();\nsql = ' where 1=1 ';\n    sql+=' and LEDGER_ID={?LEDGER_ID?}';\nif (!Wb.isEmpty(data.AR_DOC_CAT_CODE)) {\n    if(data.AR_DOC_CAT_CODE != 'All'){\n        sql+=' and AR_DOC_CAT_CODE={?AR_DOC_CAT_CODE?}';\n    }\n}\nif (!Wb.isEmpty(data.AR_INV_H_CODE)) {\n    sql+=' and (AR_INV_H_CODE like \\'%'+data.AR_INV_H_CODE+'%\\' or AR_CONTRACT_CODE like \\'%'+data.AR_INV_H_CODE+'%\\' or AR_CONTRACT_NAME like \\'%'+data.AR_INV_H_CODE+'%\\')';\n}\nif (!Wb.isEmpty(data.INV_AMOUNT_START)) {\n    sql+=' and INV_AMOUNT >='+data.INV_AMOUNT_START;\n}\nif (!Wb.isEmpty(data.INV_AMOUNT_END)) {\n    sql+=' and INV_AMOUNT <='+data.INV_AMOUNT_END;\n}\nif (!Wb.isEmpty(data.BIZ_DATE_START)) {\n    if (!Wb.isEmpty(data.BIZ_DATE_END)) {\n        sql+=' and BIZ_DATE BETWEEN {?BIZ_DATE_START?} and {?BIZ_DATE_END?} ';\n    }else{\n        sql+=' and BIZ_DATE >= {?BIZ_DATE_START?}';\n    }\n}else{\n    if (!Wb.isEmpty(data.BIZ_DATE_END)) {\n        sql+=' and BIZ_DATE <= {?BIZ_DATE_END?}';\n    }\n}\nif (!Wb.isEmpty(data.BIZ_DATE)) {\n    if(dbtype == 'mysql'){\n        if(data.BIZ_DATE <= 90)\n            sql+=' and DATEDIFF(SYSDATE(),BIZ_DATE) <= '+data.BIZ_DATE;\n        else\n            sql+=' and DATEDIFF(SYSDATE(),BIZ_DATE) > '+90;\n    }\n    if(dbtype == 'oracle'){\n        if(data.BIZ_DATE <= 90)\n            sql+=' and DATEDIFF(SYSDATE,BIZ_DATE) <= '+data.BIZ_DATE;\n        else\n            sql+=' and DATEDIFF(SYSDATE,BIZ_DATE) > '+90;\n    }\n}\nif (!Wb.isEmpty(data.CUSTOMER_NAME)) {\n    sql+=' and CUSTOMER_NAME like \\'%'+data.CUSTOMER_NAME+'%\\' ';\n}\nif (!Wb.isEmpty(data.PROJECT_NAME)) {\n    sql+=' and PROJECT_NAME like \\'%'+data.PROJECT_NAME+'%\\' ';\n}\nif (!Wb.isEmpty(data.DEPT_NAME)) {\n    sql+=' and DEPT_NAME like \\'%'+data.DEPT_NAME+'%\\' ';\n}\nif (!Wb.isEmpty(data.SYS_AUDIT_STATUS)) {\n    if(data.SYS_AUDIT_STATUS != 'ALL'){\n        sql+=' and (SYS_AUDIT_STATUS={?SYS_AUDIT_STATUS?} or PRINT_STATUS={?SYS_AUDIT_STATUS?})';\n    }\n}\nif (!Wb.isEmpty(data.AUDIT_STATUS)) {\n    if(data.AUDIT_STATUS != 'ALL')\n        sql+=' and AUDIT_STATUS={?AUDIT_STATUS?}';\n}\nif (!Wb.isEmpty(data.CREATED_BY)) {\n    sql+=' and CREATED_BY={?CREATED_BY?}';\n}\nif (!Wb.isEmpty(data.CREATED_NAME)) {\n    sql+=' and CREATED_BY_NAME like \\'%'+data.CREATED_NAME+'%\\' ';\n}\nif (!Wb.isEmpty(data.PRINT_STATUS)) {\n    if(data.PRINT_STATUS != 'ALL'){\n        if(data.PRINT_STATUS == '0'){\n            sql+=' and PRINT_STATUS=\"0\" ';\n            if(data.AUDIT_STATUS == 'E'){\n                sql+=' AND (SELECT IS_PRINT FROM xc_ar_doc_cats WHERE AR_CAT_CODE = AR_DOC_CAT_CODE)=\"1\" ';\n            }\n        }\n        else if(data.PRINT_STATUS == '1'){\n            if(data.voidCheck == 'true'){\n                sql+=' and PRINT_STATUS =\"2\" ';\n            }\n            else if(data.voidCheck == 'false'){\n                sql+=' and PRINT_STATUS =\"1\" ';\n            }\n            else{\n                sql+=' and PRINT_STATUS={?PRINT_STATUS?}';\n            }\n        }\n        else{\n            sql+=' and PRINT_STATUS={?PRINT_STATUS?}';\n        }\n    }\n}\nif (!Wb.isEmpty(data.FIN_NO)) {\n    sql+=data.FIN_NO;\n}\nif (!Wb.isEmpty(data.PRINT_USER_ID)) {\n    sql+= \" AND IF((SELECT IS_PRINT FROM xc_ar_doc_cats WHERE AR_CAT_CODE = AR_DOC_CAT_CODE)<>'0',PRINT_USER_ID IS NOT NULL AND PRINT_STATUS<>'2' ,1=1 AND PRINT_STATUS<>'2' )\";\n}\nrequest.setAttribute('sql', sql);","itemId":"module"},"children":[{"configs":{"sql":"SELECT * FROM (\n  SELECT\n    arih.*,\n    (SELECT\n       CASE WHEN l.DESCRIPTION IS NULL OR l.DESCRIPTION = '' THEN d.DESCRIPTION ELSE l.DESCRIPTION END DESCRIPTION\n     FROM\n       xip_pub_val_set_dtl d\n     LEFT JOIN XIP_PUB_VAL_SET_DTL_LANG l ON d.VAL_SET_CODE = l.VAL_SET_CODE\n     AND d.VAL_CODE = l.VAL_CODE\n     AND l.VAL_SET_LANG = '{#language#}'\n     WHERE\n       d.VAL_SET_CODE = 'XC_AP_SYS_AUDIT_STATUS'\n     AND d.ENABLE_FLAG = 'Y'\n     AND d.VAL_CODE = arih.SYS_AUDIT_STATUS) AS XC_AP_SYS_AUDIT_STATUS,\n    (SELECT AR_INV_GL_H_ID FROM xc_ar_inv_gl_h a WHERE a.AR_INV_H_ID = arih.AR_INV_H_ID AND a.AR_INV_H_ID != '') AR_INV_GL_H_ID,\n    (SELECT NO_PAY_AMT FROM xc_ar_inv_gl_h a WHERE a.AR_INV_H_ID = arih.AR_INV_H_ID AND a.AR_INV_H_ID != '') NO_PAY_AMT,\n    (SELECT\n       CASE WHEN l.VAL_NAME IS NULL OR l.VAL_NAME = '' THEN d.VAL_NAME ELSE l.VAL_NAME END VAL_NAME\n     FROM\n       xip_pub_val_set_dtl d\n     LEFT JOIN XIP_PUB_VAL_SET_DTL_LANG l ON d.VAL_SET_CODE = l.VAL_SET_CODE\n     AND d.VAL_CODE = l.VAL_CODE\n     AND l.VAL_SET_LANG = '{#language#}'\n     WHERE\n       d.VAL_SET_CODE = 'XC_AR_XSFP_CLASS'\n     AND d.ENABLE_FLAG = 'Y'\n     AND d.VAL_CODE = arih.AR_DOC_CAT_CODE) AR_CAT_NAME,\n    (SELECT pp.PROJECT_NAME FROM xc_pm_projects pp WHERE arih.PROJECT_ID = pp.PROJECT_ID) PROJECT_NAME,\n    (SELECT pd.DEPT_NAME FROM xip_pub_depts pd WHERE arih.DEPT_ID = pd.DEPT_ID ) DEPT_NAME,\n    (SELECT gl.LEDGER_NAME FROM xc_gl_ledgers gl WHERE arih.LEDGER_ID = gl.LEDGER_ID) LEDGER_NAME,\n    (SELECT arcu.CUSTOMER_NAME FROM xc_ar_customers arcu WHERE arih.CUSTOMER_ID = arcu.CUSTOMER_ID) CUSTOMER_NAME,\n    (select arco.AR_CONTRACT_NAME FROM xc_ar_contract arco WHERE arih.AR_CONTRACT_ID = arco.AR_CONTRACT_ID) AR_CONTRACT_NAME,\n    (select arco.AR_CONTRACT_CODE FROM xc_ar_contract arco WHERE arih.AR_CONTRACT_ID = arco.AR_CONTRACT_ID) AR_CONTRACT_CODE,\n    (SELECT EMP_NAME FROM xip_pub_emps WHERE EMP_ID=(SELECT EMP_ID FROM xip_pub_users b WHERE b.USER_ID = arih.FIN_USER_ID)) FIN_USER_NAME,\n    (SELECT EMP_NAME FROM xip_pub_emps WHERE EMP_ID=(SELECT EMP_ID FROM xip_pub_users b WHERE b.USER_ID = arih.PRINT_USER_ID)) PRINT_USER_NAME,\n    (SELECT EMP_NAME FROM xip_pub_emps WHERE EMP_ID=(SELECT EMP_ID FROM xip_pub_users b WHERE b.USER_ID = arih.CREATED_BY)) CREATED_BY_NAME,\n    CASE PRINT_STATUS WHEN '0' THEN '待开票' WHEN '1' THEN '已开票' WHEN '2' THEN '已作废' END AS PRINT_STATUS_NAME\n  FROM\n    xc_ar_invoice_h arih\n) t\n  {#sql#}\n  ORDER BY t.AR_INV_H_CODE DESC","itemId":"dataprovider1"},"children":[],"expanded":false,"type":"dataprovider"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}