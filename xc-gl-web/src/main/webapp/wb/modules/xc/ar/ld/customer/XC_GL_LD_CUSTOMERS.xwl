{"inframe":false,"title":"","hidden":false,"roles":{"default":1},"children":[{"configs":{"loginRequired":"false","serverScript":"com.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xc/ar/ld/customer/XC_GL_LD_CUSTOMERS\");","itemId":"module"},"events":{"finalize":"var segs = ['XC_AP_VENDORS','XC_AR_CUSTOMERS','XC_GL_PRODUCTS','XIP_PUB_ORGS','XIP_PUB_DEPTS','XIP_PUB_EMPS'];\nvar seg_ids = ['VENDOR_ID','CUSTOMER_ID','PRODUCT_ID','ORG_ID','DEPT_ID','EMP_ID'];\nvar ld_segs = ['XC_GL_LD_VENDORS','XC_GL_LD_CUSTOMERS','XC_GL_LD_PRODUCTS','XC_GL_LD_ORGS','XC_GL_LD_DEPTS','XC_GL_LD_EMPS'];\nvar ld_seg_ids = ['LD_VENDOR_ID','LD_CUSTOMER_ID','LD_PRODUCT_ID','LD_ORG_ID','LD_DEPT_ID','LD_EMP_ID'];\nvar seg_codes = ['VENDOR_CODE','CUSTOMER_CODE','PRODUCT_CODE','ORG_CODE','DEPT_CODE','EMP_CODE'];\nvar seg_names = ['VENDOR_NAME','CUSTOMER_NAME','PRODUCT_NAME','ORG_NAME','DEPT_NAME','EMP_NAME'];\nvar ledger_id;//获取账簿ID\nvar seg='XC_AR_CUSTOMERS';//获取辅助短编码\nvar seg_id='CUSTOMER_ID';//辅助段列名\nvar ld_seg='XC_GL_LD_CUSTOMERS';//段值启用表名\nvar ld_seg_id='LD_CUSTOMER_ID';//段值启用表列名\nvar seg_code='CUSTOMER_CODE';//编码\nvar seg_name='CUSTOMER_NAME';//名称\nvar _index;//索引\nvar org_id;//组织ID\nfunction returnRowFn(r,type){\n    if(type==='xip_pub_orgs'){\n        app.combo1.setValue(r.data.LEDGER_ID);\n        app.queryBtn.fireEvent('click');\n    }\n}"},"children":[{"configs":{"itemId":"tools"},"children":[{"configs":{"itemId":"orgInitStore","autoLoad":"true","url":"m?xwl=xc/com-lov/ORG_PICK/DB/ORG_SELECT_BY_LEDGER"},"events":{"load":"app.combo1.setValue(store.getAt(0).get('LEDGER_ID'));\napp.ORG_XWL.ORG_ID.setValue(store.getAt(0).get('ORG_ID'));\napp.ORG_XWL.ORG_NAME.setValue(store.getAt(0).get('ORG_NAME'));\napp.queryBtn.fireEvent('click');"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"folder"},{"configs":{"height":"450","width":"600","layout":"fit","buttonAlign":"center","dialog":"true","itemId":"win"},"children":[{"configs":{"selType":"checkboxmodel","itemId":"grid2"},"children":[{"configs":{"pageSize":"-1","itemId":"store","url":"m?xwl=xc/ar/ld/customer/DB/select_notExist"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"ID","hidden":"true","dataIndex":"seg_id","titleAlign":"center","itemId":"VAL_ID_COL_1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#CODE_COL#}","width":"150","dataIndex":"seg_code","titleAlign":"center","itemId":"VAL_CODE_COL_1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#NAME_COL#}","width":"350","dataIndex":"seg_name","titleAlign":"center","itemId":"VAL_NAME_COL_1"},"children":[],"expanded":false,"type":"column"}],"expanded":false,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"emptyText":"{#CODE_NAME#}","itemId":"text2"},"events":{"specialkey":"if(e.getKey()==13){\n  app.queryBtn2.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"},{"configs":{"text":"{#queryBtn#}","itemId":"queryBtn2","iconCls":"seek_icon"},"events":{"click":"//加载数据\napp.grid2.getStore().load({\n  params:{seg:seg,\n          seg_id:seg_id,\n          ld_seg:ld_seg,\n          ledger_id:ledger_id,//账簿ID\n          seg_code:seg_code,\n          seg_name:seg_name,\n          org_id:org_id,\n          codeOrName:Ext.String.escape(app.text2.getValue() )\n         }\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#resetBtn#}","itemId":"resetBtn","iconCls":"refresh_icon"},"events":{"click":"app.text2.setValue();\napp.queryBtn2.fireEvent('click');"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"window"},{"configs":{"layout":"border","itemId":"viewport1"},"children":[{"configs":{"region":"north","frame":"true","layout":"column","bodyPadding":"5 5 5 5","itemId":"form1"},"children":[{"configs":{"labelWidth":"40","hidden":"true","labelAlign":"right","itemId":"combo1","fieldLabel":"{#LEDGER_NAME_ZH#}","editable":"false"},"events":{"change":"ledger_id = newValue;\norg_id = app.ORG_XWL.ORG_ID.getValue();"},"children":[],"expanded":true,"type":"combo"},{"configs":{"file":"m?xwl=xc/com-lov/ORG_PICK/ORG_ALL_PICK","itemId":"ORG_XWL"},"children":[],"expanded":false,"type":"xwl"},{"configs":{"labelWidth":"100","readOnly":"true","queryMode":"local","displayField":"SEG_NAME","hidden":"true","valueField":"SEG_CODE","labelAlign":"right","itemId":"combo2","fieldLabel":"辅助段","editable":"false"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/ar/ld/customer/DB/select_ass_segments"},"events":{"load":"app.combo2.select(store.getAt(1));\n\nledger_id = app.combo1.getValue();//获取账簿ID\nseg = app.combo2.getValue();//获取辅助短编码\nif(seg!=null){\nfor(var i=0;i<segs.length;i++){\n  if(seg==segs[i]){\n    seg_id = seg_ids[i];\n    ld_seg = ld_segs[i];\n    ld_seg_id = ld_seg_ids[i];\n    seg_code = seg_codes[i];\n    seg_name = seg_names[i];\n  }\n}\n\napp.grid1.store.load({\n  params:{ld_seg_id:ld_seg_id,\n          seg_id:seg_id,\n          ld_seg:ld_seg,\n          seg_code:seg_code,\n          seg_name:seg_name,\n          seg:seg,\n          ledger_id:ledger_id\n         }\n});\n}else{\n\tWb.warn('该账簿下没有设置辅助段！');\n\tapp.grid1.getStore().removeAll();\n}\n"},"children":[],"expanded":false,"type":"store"}],"expanded":false,"type":"combo"},{"configs":{"labelWidth":"100","labelAlign":"right","itemId":"text1","fieldLabel":"{#CODE_NAME#}","x":"200"},"events":{"specialkey":"if(e.getKey()===13){app.queryBtn.fireEvent('click');}"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"QUERY_LEDGER_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"text":"{#queryBtn#}","itemId":"queryBtn","iconCls":"seek_icon","x":"30"},"events":{"click":"if(app.combo1.getValue()===null){\n   Wb.toast('{#MSG1#}');\n  return;\n}\n/**else if(app.combo2.getValue()===null){\n  Wb.toast('请选择辅助段');\n  return;\n}**/\n\napp.grid1.store.load({\n  params:{ledger_id:app.combo1.getValue(),queryVar:Ext.String.escape(app.text1.getValue())}\n});\n// app.grid1.store.load({\n//   params:{ld_seg_id:ld_seg_id,seg_id:seg_id,ld_seg:ld_seg,seg_code:seg_code,seg_name:seg_name,seg:seg,ledger_id:ledger_id,queryVar:Ext.String.escape(app.text1.getValue())}\n// });"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#resetBtn#}","itemId":"resetBtn","iconCls":"refresh_icon","x":"50"},"events":{"click":"app.text1.setValue('');\nif(app.combo1.getValue()===null){\n   Wb.toast('{#MSG1#}');\n  return;\n}\n/**else if(app.combo2.getValue()===null){\n  Wb.toast('请选择辅助段');\n  return;\n}**/\n\napp.grid1.store.load({\n  params:{ledger_id:app.combo1.getValue()}\n});\n//app.queryBtn.fireEvent('click');"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"form"},{"configs":{"region":"center","selType":"checkboxmodel","itemId":"grid1","editable":"true"},"events":{"tagEvents":"{\n  itemmouseenter:function(view, record, item, index, e, options){\n    _index = index;\n  }\n}"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/ar/ld/customer/DB/select"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#XH#}","width":"50","align":"center","xtype":"rownumberer","titleAlign":"center","itemId":"rownum"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"LD_SEG_ID_COL","hidden":"true","dataIndex":"LD_SEG_ID","titleAlign":"center","itemId":"LD_SEG_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"CUSTOMER_ID","hidden":"true","dataIndex":"CUSTOMER_ID","titleAlign":"center","itemId":"CUSTOMER_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#LEDGER_ID_ZH#}","hidden":"true","dataIndex":"LEDGER_ID","titleAlign":"center","itemId":"LEDGER_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#LEDGER_NAME_ZH#}","hidden":"true","dataIndex":"LEDGER_NAME","titleAlign":"center","itemId":"LEDGER_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#SEG_CODE_COL#}","hidden":"true","dataIndex":"SEG_CODE","titleAlign":"center","itemId":"SEG_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#SEG_NAME_COL#}","hidden":"true","dataIndex":"SEG_NAME","titleAlign":"center","itemId":"SEG_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#LD_SEG_ALIAS_COL#}","hidden":"true","dataIndex":"LD_SEG_ALIAS","titleAlign":"center","itemId":"LD_SEG_ALIAS_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#VAL_ID_COL#}","hidden":"true","dataIndex":"VAL_ID","titleAlign":"center","itemId":"VAL_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#CODE_COL#}","dataIndex":"VAL_CODE","titleAlign":"center","itemId":"VAL_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#NAME_COL#}","width":"280","dataIndex":"VAL_NAME","titleAlign":"center","itemId":"VAL_NAME_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#CREDIT_COL#}","dataIndex":"CREDIT","titleAlign":"center","itemId":"CREDIT_COL"},"children":[{"configs":{"itemId":"editor"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"column"},{"configs":{"text":"{#CREDIT_DAY_COL#}","dataIndex":"CREDIT_DAY","titleAlign":"center","itemId":"CREDIT_DAY_COL"},"children":[{"configs":{"itemId":"editor"},"children":[],"expanded":false,"type":"number"}],"expanded":false,"type":"column"},{"configs":{"text":"{#CONTACT1#}","dataIndex":"CONTACT","titleAlign":"center","itemId":"CONTACT_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#TEL1#}","dataIndex":"TEL","titleAlign":"center","itemId":"TEL_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#MOBILE1#}","dataIndex":"MOBILE","titleAlign":"center","itemId":"MOBILE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#QQ1#}","dataIndex":"QQ","titleAlign":"center","itemId":"QQ_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#EMAIL1#}","dataIndex":"EMAIL","titleAlign":"center","itemId":"EMAIL_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#SALE_USER_ID_COL#}","hidden":"true","dataIndex":"SALE_USER_ID","titleAlign":"center","itemId":"SALE_USER_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#SALE_USER_ID_COL#}","width":"200","dataIndex":"SALE_USER_NAME","titleAlign":"center","itemId":"SALE_USER_NAME_COL"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"editor","normalName":"EMP_NAME_PICK"},"events":{"expand":"\napp.pickComp.getStore().reload({params:{\n\t\tQUERY_LEDGER_ID:app.QUERY_LEDGER_ID.getValue()\n\t}});"},"children":[{"configs":{"tagConfigs":"minWidth:400","itemId":"pickComp"},"events":{"itemdblclick":"var r=app.grid1.getSelectionModel().getSelection()[0];\nr.set('SALE_USER_ID',record.data.EMP_ID);\nr.set('SALE_USER_NAME',record.data.EMP_NAME);\nr.dirty = true;\napp.EMP_NAME_PICK.setValue(record.data.EMP_NAME);\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"pageSize":"5","itemId":"store","autoLoad":"true","url":"m?xwl=xc/com-lov/EMP_ID_PICK/DB/XIP_PUB_EMPS_SELECT_LD"},"events":{"beforeload":"operation.params = Wb.getValue([app.QUERY_LEDGER_ID,app.tbar]);"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","dataIndex":"EMP_ID","itemId":"EMP_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#EMP_CODE_COL#}","dataIndex":"EMP_CODE","itemId":"EMP_CODE_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#EMP_NAME_COL#}","dataIndex":"EMP_NAME","itemId":"EMP_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"100","emptyText":"{#CODE_NAME#}","labelAlign":"right","itemId":"QUERY_CODE_NAME"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.pickComp.getStore().load();\n}"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"cancelBtn","iconCls":"delete_icon"},"events":{"click":"app.EMP_ID.reset();\napp.EMP_NAME.reset();\napp.QUERY_CODE_NAME.reset(); \napp.EMP_NAME.getPicker().hide();"},"children":[],"expanded":false,"type":"item"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":true,"type":"column"},{"configs":{"text":"{#START_DATE1#}","xtype":"datecolumn","dataIndex":"START_DATE","titleAlign":"center","format":"Y-m-d","itemId":"START_DATE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#END_DATE1#}","xtype":"datecolumn","dataIndex":"END_DATE","titleAlign":"center","format":"Y-m-d","itemId":"END_DATE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#IS_ENABLED_COL#}","xtype":"checkcolumn","dataIndex":"IS_ENABLED","titleAlign":"center","itemId":"IS_ENABLED_COL"},"events":{"checkchange":"\napp.grid1.getSelectionModel().select(_index);\nvar rec = app.grid1.getSelection()[0];\nvar is_enabled_val = rec.data.IS_ENABLED;\nvar ld_seg_id_val = rec.data.LD_SEG_ID;\nWb.request({\n  url:'m?xwl=xc/gl/ledger/ld-segval-enabled/DB/update_save',\n  params:{ld_seg:ld_seg,\n          ld_seg_id:ld_seg_id,\n          ld_seg_id_val:ld_seg_id_val,\n          is_enabled_val:is_enabled_val},\n  message:'保存中......',\n  success:function(resp){\n    app.grid1.store.load({\n      params:{ld_seg_id:ld_seg_id,seg_id:seg_id,ld_seg:ld_seg,seg_code:seg_code,seg_name:seg_name,seg:seg,ledger_id:ledger_id}\n    });\n  }\n});\n"},"children":[],"expanded":false,"type":"column"}],"expanded":false,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"{#sysBtn#}","itemId":"button1","iconCls":"record_copy_icon"},"events":{"click":"if(app.combo1.getValue()===null){\n   Wb.toast('{#MSG1#}');return;\n}\n// else if(app.combo2.getValue()===null){\n//    Wb.toast('请选择辅助段');return;\n// }\n\nvar win = new Ext.window.Window(app._win); //app._win指向配置对象而非实例\nwin.show();\nwin.setIconCls('record_copy_icon');\nWb.setTitle(win, '{#sysBtn#}');\n//加载数据\napp.grid2.getStore().load({\n  params:{seg:seg,//XC_AP_VENDORS\n          seg_id:seg_id,//VENDOR_ID\n          ld_seg:ld_seg,//XC_GL_LD_VENDORS\n          ledger_id:ledger_id,//账簿ID\n          seg_code:seg_code,//VENDOR_CODE\n          seg_name:seg_name,//VENDOR_NAME\n          org_id:org_id//组织ID\n         }\n});\n//添加监听函数\nwin.mon(win, 'ok', function() {\n  var recs = app.grid2.getSelection();\n  var dataArray = [];\n  for(var i=0;i<recs.length;i++){\n    dataArray.push(recs[i].data);\n  }\n  //插入数据\n  Wb.request({\n    url:'m?xwl=xc/ap/ld/vendors/DB/insert',\n    params:{ld_seg:ld_seg,seg_id:seg_id,ledger_id:ledger_id,dataArray:dataArray,ld_seg_id:ld_seg_id},\n      //params:{dataArray:dataArray},\n    success:function(resp){\n      //重新加载\n      app.grid1.store.load({\n        params:{ld_seg_id:ld_seg_id,seg_id:seg_id,ld_seg:ld_seg,seg_code:seg_code,seg_name:seg_name,seg:seg,ledger_id:ledger_id}\n      });\n      //关闭窗口\n      win.close();\n    }\n  });\n});\n"},"children":[],"expanded":true,"type":"button"},{"configs":{"text":"{#saveBtn#}","itemId":"saveBtn","iconCls":"save_icon"},"events":{"click":"if (!Wb.verifyGrid(app.grid1)) //验证数据是否合法\n  return;\nvar records = [];\n\nvar modifiedRecords = app.grid1.getStore().getModifiedRecords();\n\nfor(var i=0; i<modifiedRecords.length; i++){\n  records.push(modifiedRecords[i].data);\n}\n\n//alert(modifiedRecords.length);return;\n\nExt.Ajax.request({\n  url : 'm?xwl=xc/ar/ld/customer/DB/update',\n  method: 'POST',\n  params: {modifiedRecords: Ext.JSON.encode(records)},\n  success: function(response,options){\n    //Ext.Msg.hide();\n    Wb.toast('{#SAVETIP#}');\n      Wb.reload(app.grid1);\n    \n  },\n  failure: function(response,options){\n    Ext.Msg.hide();\n    Wb.error('{#SAVEERROR#}');\n  }\n});\n\n\n//app.grid1.plugins[0].completeEdit();\n\n/**app.grid1.store.sync(\n  {\n    callback :function(){\n     Wb.reload(app.grid1);\n    Wb.toast('保存成功');\n    }\n  });\nWb.sync({\n  grid: app.grid1,\n  url: 'm?xwl=xc/ar/ld/customer/DB/update',\n  message: '正在保存中...',\n  success: function(resp) {\n    Wb.reload(app.grid1);\n    Wb.toast('保存成功');\n  }\n});**/"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#delBtn#}","itemId":"delBtn","iconCls":"file_delete_icon"},"events":{"click":"\nvar recs = app.grid1.getSelection();\nif(recs.length<1){\n  Wb.toast('{#DELTIP#}');\n  return;\n}\nvar flag = false;//是否有不能删除的记录\nvar ids = [];//运行删除的记录\nvar deleteRecords = [];//要删除的记录\n\nfor(var i=0;i<recs.length;i++){\n  //判断记录是否启用\n  if(recs[i].data.IS_ENABLED === 0){\n    var id = {id:recs[i].data.LD_SEG_ID};\n    deleteRecords.push(recs[i].data);\n    ids.push(id);\n  }else{\n    flag = true;\n  }\n}\nif(flag){\n  Wb.toast('{#MSG2#}');\n  return;\n}\n\n//删除数据\nWb.confirm('{#DELOKTIP#}',function(){\n  Wb.request({\n    url:'m?xwl=xc/ar/ld/customer/DB/deleteRecords',\n    params:{ld_seg:ld_seg,ld_seg_id:ld_seg_id,ids:ids,deleteRecords:deleteRecords},\n    success:function(resp){\n      app.queryBtn.fireEvent('click');\n        Wb.toast('{#DELTIP1#}');\n      //Wb.toast('选中了'+recs.length+'条记录,成功删除了'+ids.length+'条记录！');\n    }\n  });\n});\n"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}