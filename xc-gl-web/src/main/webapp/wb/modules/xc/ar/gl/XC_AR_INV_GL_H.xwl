{"inframe":false,"title":"应收单录入","hidden":false,"roles":{"default":1},"children":[{"configs":{"serverScript":"//---------------------获取当前模块语言对应的.json文件，放到request中----------------\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xc/ar/gl/json/XC_AR_INV_GL_H_NO_C\");\nvar contextPath = request.getContextPath();\nrequest.setAttribute(\"contextPath\",contextPath);\nrequest.setAttribute('opmode','view');\nrequest.setAttribute('vtype','normal');\n\nrequest.setAttribute('businessId',request.getParameter('businessId')); ","itemId":"module"},"events":{"finalize":"var tableValue = '';//窗口中的所有信息\nvar isEditCol = 'N';//判断是否更新过行信息\nvar deleteDtl = [];\n//判断应收单明细是否为空\nfunction judgemDtlIsNull(){\n    var returnMsg = '';\n    var store = app.grid1.store;\n    for(var i = 0;i < store.getCount();i++){\n        var data = store.getAt(i);\n        if(Ext.isEmpty(data.get('AR_SALE_TYPE_ID'))){\n            returnMsg = '{#saveDtlWarn1#}' + (i + 1) + '：{#saveDtlWarn2#}';\n            break;\n        }\n        if(Ext.isEmpty(data.get('ACC_NAME'))){\n            returnMsg = '{#saveDtlWarn1#}' + (i + 1) + '：{#saveDtlWarn3#}';\n            break;\n        }\n        if(Ext.isEmpty(data.get('DIM_NAME'))){\n            returnMsg = '{#saveDtlWarn1#}' + (i + 1) + '：{#saveDtlWarn5#}';\n            break;\n        }\n        if(Ext.isEmpty(data.get('QTY'))){\n            returnMsg = '{#saveDtlWarn1#}' + (i + 1) + '：{#saveDtlWarn6#}';\n            break;\n        }\n        if(Ext.isEmpty(data.get('TAX'))){\n            returnMsg = '{#saveDtlWarn1#}' + (i + 1) + '：{#saveDtlWarn7#}';\n            break;\n        }\n        if(Ext.isEmpty(data.get('TAX_AMT'))){\n            returnMsg = '{#saveDtlWarn1#}' + (i + 1) + '：{#saveDtlWarn8#}';\n            break;\n        }\n        if(Ext.isEmpty(data.get('INV_AMOUNT'))){\n            returnMsg = '{#saveDtlWarn1#}' + (i + 1) + '：{#saveDtlWarn9#}';\n            break;\n        }\n    }\n    return returnMsg;\n}\n\nWb.keyValue = '';\nWb.isInsert = 'Y';\nWb.docCatCode = '{#AR_DOC_CAT_CODES#}';\napp.AR_INV_GL_H_ID.setValue(Xip.getId());\napp.AR_DOC_CAT_CODE.setValue(Wb.docCatCode);\n\nif (Wb.docCatCode == 'YSD-HZ') {\n    app.invGlBtn.hide();\n}\nelse{\n    app.SOURCE.setReadOnly(true);\n    app.saleTypeBtn.show();\n}\napp.GL_DATE.setValue(new Date());\napp.CREATED_BY_NAME.setValue('{#XIP.empName#}');\napp.grid1.getStore().reload({params: {AR_INV_GL_H_ID: app.AR_INV_GL_H_ID.getValue()}});\napp.SOURCE.getStore().removeAt(1);\n          \napp.LEDGER_ID_XWL.LEDGER_NAME.allowBlank = false;\napp.CUSTOMER_ID_XWL.CUSTOMER_NAME.allowBlank = false;\napp.AR_ACC_ID_DEBT_XWL.AR_ACC_NAME_DEBT.allowBlank = false;\napp.AR_ACC_ID_TAX_XWL.AR_ACC_NAME_TAX.allowBlank = false;\nfunction returnRowFn(r, type) {\n    if (type == 'xc_gl_ledgers') {\n        setLedger(r.data.LEDGER_ID);\n        setMinDate(r.data.LEDGER_ID);\n        Wb.request({\n            url: 'm?xwl=xc/ar/gl/DB/XC_GL_LEDGERS_SELECT_BY_ID',\n            params: {LEDGER_ID: app.LEDGER_ID_XWL.LEDGER_ID.getValue()},\n            success: function(resp) {\n                var o = Wb.decode(resp.responseText);\n                app.AR_ACC_ID_DEBT_XWL.AR_ACC_ID_DEBT.setValue(o.AR_ACC_ID_DEBT);\n                app.AR_ACC_ID_DEBT_XWL.AR_ACC_NAME_DEBT.setValue(o.AR_ACC_NAME_DEBT);\n                app.AR_ACC_ID_TAX_XWL.AR_ACC_ID_TAX.setValue(o.AR_ACC_ID_TAX);\n                app.AR_ACC_ID_TAX_XWL.AR_ACC_NAME_TAX.setValue(o.AR_ACC_NAME_TAX);\n            }\n        });\n    }\n    //选择合同名称后为客户赋值\n    if (type == 'xc_ar_contract') {\n        app.CUSTOMER_ID_XWL.CUSTOMER_ID.setValue(r.data.CUSTOMER_ID);\n        app.CUSTOMER_ID_XWL.CUSTOMER_NAME.setValue(r.data.CUSTOMER_NAME);\n    }\n    //为蓝字应收单筛选时带上客户条件\n    if (type == 'xc_ar_inv_gl_h_before') {\n        app.AR_INV_GL_H_ID_XWL.QUERY_CUSTOMER_ID.setValue(app.CUSTOMER_ID_XWL.CUSTOMER_ID.getValue());\n    }\n    //选择客户后为合同名称加筛选条件\n    if (type == 'xc_ar_customers') {\n        //清空客户信息时，同时清空合同名称和蓝字发票\n        if(app.AR_INV_GL_H_ID_XWL.L_AR_INV_GL_H_CODE.getValue() !== null && app.AR_INV_GL_H_ID_XWL.L_AR_INV_GL_H_CODE.getValue() !== ''){\n            clearAll();\n            app.CUSTOMER_ID_XWL.CUSTOMER_ID.setValue(r.data.CUSTOMER_ID);\n            app.CUSTOMER_ID_XWL.CUSTOMER_NAME.setValue(r.data.CUSTOMER_NAME);\n        }\n        else{\n            app.AR_CONTRACT_ID_XWL.QUERY_CUSTOMER_ID.setValue(app.CUSTOMER_ID_XWL.CUSTOMER_ID.getValue());\n            app.AR_CONTRACT_ID_XWL.AR_CONTRACT_ID.setValue('');\n            app.AR_CONTRACT_ID_XWL.AR_CONTRACT_NAME.setValue('');\n        }\n    }\n    if (type == 'xc_ar_inv_gl_h') {\n        setMaxOrMinValue(null);\n        app.DEPT_ID_XWL.DEPT_ID.setValue(r.data.DEPT_ID);\n        app.DEPT_ID_XWL.DEPT_NAME.setValue(r.data.DEPT_NAME);\n        app.PROJECT_ID_XWL.PROJECT_ID.setValue(r.data.PROJECT_ID);\n        app.PROJECT_ID_XWL.PROJECT_NAME.setValue(r.data.PROJECT_NAME);\n        app.CUSTOMER_ID_XWL.CUSTOMER_ID.setValue(r.data.CUSTOMER_ID);\n        app.CUSTOMER_ID_XWL.CUSTOMER_NAME.setValue(r.data.CUSTOMER_NAME);\n        app.AR_CONTRACT_ID_XWL.AR_CONTRACT_ID.setValue(r.data.AR_CONTRACT_ID);\n        app.AR_CONTRACT_ID_XWL.AR_CONTRACT_NAME.setValue(r.data.AR_CONTRACT_NAME);\n        app.AR_ACC_ID_DEBT_XWL.AR_ACC_ID_DEBT.setValue(r.data.AR_ACC_ID_DEBT);\n        app.AR_ACC_ID_DEBT_XWL.AR_ACC_NAME_DEBT.setValue(r.data.AR_ACC_NAME_DEBT);\n        app.AR_ACC_ID_TAX_XWL.AR_ACC_ID_TAX.setValue(r.data.AR_ACC_ID_TAX);\n        app.AR_ACC_ID_TAX_XWL.AR_ACC_NAME_TAX.setValue(r.data.AR_ACC_NAME_TAX);\n        app.DESCRIPTION.setValue(r.data.DESCRIPTION);\n        app.TAX_AMT.setValue(r.get('TAX_AMT') * -1);\n        app.TAX_AMT.setMaxValue(0);\n        app.TAX_AMT.setMinValue(r.get('TAX_AMT') * -1);\n        app.INV_AMOUNT.setValue(r.get('INV_AMOUNT') * -1);\n        app.INV_AMOUNT.setMaxValue(0);\n        app.INV_AMOUNT.setMinValue(r.get('INV_AMOUNT') * -1);\n        app.TAX_RATE.setValue(r.get('TAX_RATE'));\n        app.TAX_RATE.setMaxValue(r.get('TAX_RATE'));\n        app.DESCRIPTION.setValue(r.data.DESCRIPTION);\n        var H_AMOUNT_SUM = r.data.NO_PAY_AMT;\n        var L_AMOUNT_SUM = 0;\n        app.store2.reload({params: {AR_INV_GL_H_ID: app.AR_INV_GL_H_ID_XWL.L_AR_INV_GL_H_ID.getValue()},\n            callback: function() {\n                app.grid1.getStore().removeAll();\n                for (var i = 0; i < app.store2.getCount(); i++) {\n                    var r = app.store2.getAt(i);\n                    L_AMOUNT_SUM = L_AMOUNT_SUM+r.get('AMOUNT');\n                    r.set('L_AR_INV_GL_L_ID', r.get('AR_INV_GL_L_ID'));\n                    r.set('L_AR_INV_GL_H_ID', r.get('AR_INV_GL_H_ID'));\n                    r.set('AR_INV_GL_L_ID', null);\n                    r.set('AR_INV_GL_H_ID', null);\n                    r.set('AMOUNT',r.get('AMOUNT') * -1);\n                    r.set('QTY',r.get('QTY') * -1);\n                    r.set('TAX_AMT',r.get('TAX_AMT') * -1);\n                    r.set('INV_AMOUNT',r.get('INV_AMOUNT') * -1);\n                    app.QTY_COL.getEditor().setMinValue(r.get('QTY'));\n                    app.AMOUNT_COL.getEditor().setMinValue(r.get('AMOUNT'));\n                    app.INV_AMOUNT_COL.getEditor().setMinValue(r.get('INV_AMOUNT'));\n                    app.TAX_AMT_COL.getEditor().setMinValue(r.get('TAX_AMT'));\n                    app.INV_PRICE_COL.getEditor().setMaxValue(r.get('INV_PRICE'));\n                    app.TAX_RATE_COL.getEditor().setMaxValue(r.get('TAX'));\n                    app.PRICE_COL.getEditor().setMaxValue(r.get('PRICE'));\n                    app.AMOUNT_COL.getEditor().setMinValue(r.get('AMOUNT'));\n                    app.grid1.getStore().add(r.getData());\n                }\n                if(H_AMOUNT_SUM!=L_AMOUNT_SUM){\n                    app.AMOUNT_COL.getEditor().setMaxValue(0);\n                    app.AMOUNT_COL.getEditor().editable=true;\n                }\n            }\n        });\n    }\n    //选择项目带回成本中心\n    if(type == 'xc_pm_projects') {\n        app.DEPT_ID_XWL.DEPT_ID.setValue(r.data.DEPT_ID);\n        app.DEPT_ID_XWL.DEPT_NAME.setValue(r.data.DEPT_NAME);\n    }\n    //选择成本中心为项目查询的成本中心赋值\n    if(type == 'xip_pub_depts') {\n        app.PROJECT_ID_XWL.QUERY_DEPT_ID.setValue(r.data.DEPT_ID);\n    }\n}\nfunction clearOtherFn(type) {\n    //清空客户信息时，同时清空合同名称和蓝字发票\n    if (type == 'xc_ar_customers') {\n        if(app.AR_INV_GL_H_ID_XWL.L_AR_INV_GL_H_CODE.getValue() !== null && app.AR_INV_GL_H_ID_XWL.L_AR_INV_GL_H_CODE.getValue() !== ''){\n            clearAll();\n            setMaxOrMinValue(null);\n        }\n        else{\n            app.AR_CONTRACT_ID_XWL.QUERY_CUSTOMER_ID.setValue('');\n            app.AR_CONTRACT_ID_XWL.AR_CONTRACT_ID.setValue('');\n            app.AR_CONTRACT_ID_XWL.AR_CONTRACT_NAME.setValue('');\n        }\n    }\n    if (type == 'xc_gl_ledgers') {\n\t\tclearAll();\n        app.CUSTOMER_ID_XWL.CUSTOMER_ID.setValue('');\n        app.CUSTOMER_ID_XWL.CUSTOMER_NAME.setValue('');\n    }\n    if (type == 'cancelLedger') {\n\t\tclearAll();\n        app.CUSTOMER_ID_XWL.CUSTOMER_ID.setValue('');\n        app.CUSTOMER_ID_XWL.CUSTOMER_NAME.setValue('');\n        setLedger('');\n        setMinDate(null);\n    }\n    //清空成本中心同时清空项目查询条件里的成本中心\n    if(type == 'xip_pub_depts') {\n        app.PROJECT_ID_XWL.QUERY_DEPT_ID.setValue('');\n    }\n    //清空应付单，清空明细\n    if(type == 'cancelArInvGl'){\n\t\tclearAll();\n        setMaxOrMinValue(null);\n    }\n}\nfunction setLedger(ledgerId) {\n    app.CUSTOMER_ID_XWL.QUERY_LEDGER_ID.setValue(ledgerId);\n    app.PROJECT_ID_XWL.QUERY_LEDGER_ID.setValue(ledgerId);\n    app.DEPT_ID_XWL.QUERY_LEDGER_ID.setValue(ledgerId);\n    app.AR_CONTRACT_ID_XWL.QUERY_LEDGER_ID.setValue(ledgerId);\n    app.AR_ACC_ID_DEBT_XWL.QUERY_LEDGER_ID.setValue(ledgerId);\n    app.AR_ACC_ID_TAX_XWL.QUERY_LEDGER_ID.setValue(ledgerId);\n    app.AR_INV_GL_H_ID_XWL.QUERY_LEDGER_ID.setValue(ledgerId);\n}\nfunction clearAll(){\n\tapp.DEPT_ID_XWL.DEPT_ID.setValue('');\n    app.DEPT_ID_XWL.DEPT_NAME.setValue('');\n    app.PROJECT_ID_XWL.PROJECT_ID.setValue('');\n    app.PROJECT_ID_XWL.PROJECT_NAME.setValue('');\n    app.AR_CONTRACT_ID_XWL.AR_CONTRACT_ID.setValue('');\n    app.AR_CONTRACT_ID_XWL.AR_CONTRACT_NAME.setValue('');\n    app.AR_CONTRACT_ID_XWL.QUERY_CUSTOMER_ID.setValue('');\n    app.AR_ACC_ID_DEBT_XWL.AR_ACC_ID_DEBT.setValue('');\n    app.AR_ACC_ID_DEBT_XWL.AR_ACC_NAME_DEBT.setValue('');\n    app.AR_ACC_ID_TAX_XWL.AR_ACC_ID_TAX.setValue('');\n    app.AR_ACC_ID_TAX_XWL.AR_ACC_NAME_TAX.setValue('');\n    app.AR_INV_GL_H_ID_XWL.L_AR_INV_GL_H_ID.setValue('');\n    app.AR_INV_GL_H_ID_XWL.L_AR_INV_GL_H_CODE.setValue('');\n    app.INV_AMOUNT.reset();\n    app.TAX_AMT.reset();\n    app.TAX_RATE.reset();\n    app.DESCRIPTION.reset();\n    //清空下面的发票详情\n    app.grid1.getStore().removeAll();\n}\n//账薄、供应商、蓝字应收单设置为可修改/不可修改状态\nfunction setSomeReadOnly(flag){\n    app.LEDGER_ID_XWL.LEDGER_NAME.setReadOnly(flag);\n    app.CUSTOMER_ID_XWL.CUSTOMER_NAME.setReadOnly(flag);\n    app.AR_INV_GL_H_ID_XWL.L_AR_INV_GL_H_CODE.setReadOnly(flag);\n    app.SOURCE.setReadOnly(flag);\n}\nfunction setMaxOrMinValue(flag){\n    app.TAX_AMT.setMinValue(flag);\n    app.INV_AMOUNT.setMinValue(flag);\n    app.TAX_RATE.setMaxValue(17);\n    app.QTY_COL.getEditor().setMinValue(flag);\n    app.AMOUNT_COL.getEditor().setMinValue(flag);\n    app.INV_AMOUNT_COL.getEditor().setMinValue(flag);\n    app.TAX_AMT_COL.getEditor().setMinValue(flag);\n    app.INV_PRICE_COL.getEditor().setMaxValue(flag);\n    app.TAX_RATE_COL.getEditor().setMaxValue(17);\n    app.PRICE_COL.getEditor().setMaxValue(flag);\n}\nfunction setMinDate(ledgerId){\n    Wb.request({//账簿会计期查询\n        url : 'm?xwl=xc/ar/inv/DB/ledgerDateSelect',\n        params : {LEDGER_ID : ledgerId},\n        success : function(resp){\n            var temp = Wb.decode(resp.responseText);\n            if(temp.total > 0){\n                app.GL_DATE.setMinValue(Wb.strToDate(temp.rows[0].START_DATE));\n            }\n            else {}\n        }\n    });\n}"},"children":[{"configs":{"itemId":"request"},"children":[{"configs":{"itemId":"store1","url":"m?xwl=xc/ap/inv/DB/XC_AP_INVOICE_L_SELECT_FOR_GL"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"store2","url":"m?xwl=xc/ar/gl/DB/XC_AR_INV_GL_L_SELECT"},"children":[],"expanded":false,"type":"store"},{"configs":{"autoLoad":"true","itemId":"ldInitStore","url":"m?xwl=xc/com-lov/LEDGER_ID_PICK/DB/XC_GL_LEDGERS_SELECT_SEC"},"events":{"load":"if (Wb.isInsert == 'Y') {\n    app.LEDGER_ID_XWL.LEDGER_ID.setValue(store.getAt(0).get('LEDGER_ID'));\n    app.LEDGER_ID_XWL.LEDGER_NAME.setValue(store.getAt(0).get('LEDGER_NAME'));\n    setLedger(store.getAt(0).get('LEDGER_ID'));\n    Wb.request({\n        url: 'm?xwl=xc/ar/gl/DB/XC_GL_LEDGERS_SELECT_BY_ID',\n        params: {LEDGER_ID: app.LEDGER_ID_XWL.LEDGER_ID.getValue()},\n        success: function(resp) {\n            var o = Wb.decode(resp.responseText);\n            app.AR_ACC_ID_DEBT_XWL.AR_ACC_ID_DEBT.setValue(o.AR_ACC_ID_DEBT);\n            app.AR_ACC_ID_DEBT_XWL.AR_ACC_NAME_DEBT.setValue(o.AR_ACC_NAME_DEBT);\n            app.AR_ACC_ID_TAX_XWL.AR_ACC_ID_TAX.setValue(o.AR_ACC_ID_TAX);\n            app.AR_ACC_ID_TAX_XWL.AR_ACC_NAME_TAX.setValue(o.AR_ACC_NAME_TAX);\n        }\n    });\n    setMinDate(store.getAt(0).get('LEDGER_ID'));\n}"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"folder"},{"configs":{"itemId":"form1Tbar"},"children":[{"configs":{"text":"{#addBtn#}","itemId":"addBtn","iconCls":"file_add_icon"},"events":{"click":"app.form1.getForm().reset();\napp.edit_v_xwl.form1.getForm().reset();\nWb.reload(app.ldInitStore);\nsetSomeReadOnly(false);\nif(Wb.docCatCode == 'YSD-HZ')\n    setMaxOrMinValue(null);\napp.saveBtn.setDisabled(false);\napp.verfyBtn.setDisabled(false);\napp.AR_INV_GL_H_ID.setValue(Xip.getId());\napp.GL_DATE.setValue(new Date());\napp.AR_DOC_CAT_CODE.setValue(Wb.docCatCode);\napp.grid1.getStore().reload({params:{\n\tAR_INV_GL_H_ID:app.AR_INV_GL_H_ID.getValue()\n}});\nWb.isInsert = 'Y';"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#saveBtn#}","itemId":"saveBtn","iconCls":"save_icon"},"events":{"click":"if(!app.form1.getForm().isValid()){\n    Wb.toast('{#saveWarn3#}');\n    return;\n}\n//判断是否有应收单明细\nvar store = app.grid1.store;\nif(store.getCount() === 0){\n    Wb.toast('{#saveWarn1#}');\n    return;\n}\n//判断明细是否为空\nvar message = judgemDtlIsNull();\nif(message !== ''){\n    Wb.verifyGrid(app.grid1);\n    Wb.toast(message);\n    return;\n}\n//通过明细算出主表中的金额值\nvar INV_AMOUNT = 0;//价税合计\nvar AMOUNT = 0;//金额(无税)\nvar TAX_AMT = 0;//税额\nfor (var i = 0; i < app.grid1.getStore().getCount(); i++) {\n    var r = app.grid1.getStore().getAt(i);\n    INV_AMOUNT = INV_AMOUNT + r.get('INV_AMOUNT');\n    AMOUNT = AMOUNT + r.get('AMOUNT');\n    TAX_AMT = TAX_AMT + r.get('TAX_AMT');\n    //行摘要\n    var DESCRIPTION = r.get('DESCRIPTION');\n    if(DESCRIPTION === null || DESCRIPTION === ''){\n\t\tr.set('DESCRIPTION',app.DESCRIPTION.getValue());\n    }\n}\napp.AMOUNT.setValue(AMOUNT);\napp.TAX_AMT.setValue(TAX_AMT);\napp.INV_AMOUNT.setValue(INV_AMOUNT);\nvar remove = app.grid1.getStore().getRemovedRecords();\nfor(var i = 0;i < remove.length;i++){\n    var deleteData =  {AR_INV_GL_L_ID : remove[i].data.AR_INV_GL_L_ID};\n    deleteDtl.push(deleteData);\n}\nWb.request({\n\turl : '{#contextPath#}'+'/arDocsAction.do?method=createDocsAndVoucher',\n    params : {'arDocClass' : 'YSD','mainTabInfo' : Wb.encode(Wb.getValue(app.form1)),rowTabInfo : Wb.encode(Wb.getData(app.grid1)),deleteDtl : deleteDtl},\n    success : function(resp){\n        var record = Wb.decode(resp.responseText);\n        var msg = record.msg;\n        var headId = record.headId;\n        if(record.flag === '0'){\n            setSomeReadOnly(true);\n            app.edit_v_xwl.v_head_id.setValue(headId);\n            app.V_HEAD_ID.setValue(headId);\n            app.AR_INV_GL_H_CODE.setValue(record.arDocCode);\n            app.grid1.getStore().load({params: {AR_INV_GL_H_ID: app.AR_INV_GL_H_ID.getValue()}});\n            Wb.isInsert = 'N';\n        }\n        Wb.toast(msg);\n        tableValue = Wb.encode(Wb.getValue(app.form1));\n        isEditCol = 'N';\n    }\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#verfyBtn#}","itemId":"verfyBtn","iconCls":"check_icon"},"events":{"click":"var headId = app.V_HEAD_ID.getValue();\nif(app.V_STATUS_NAME.getValue() === '审核通过'){\n    Wb.toast('{#verfyRec1#}');\n    return;\n}\nif(headId === '' || headId === null || tableValue !== Wb.encode(Wb.getValue(app.form1)) || isEditCol == 'Y'){\n    Wb.toast('{#verfyRec2#}');\n    return;\n}\nelse{\n    var docArray = [] ;\n    var paramJson = {'headId' : app.V_HEAD_ID.getValue(),'arId':app.AR_INV_GL_H_ID.getValue(),arCatCode:'YSD'} ;\n    docArray.push(paramJson) ;\n    Wb.request({\n        url: '{#contextPath#}'+'/arDocsAction.do?method=checkArVoucher',\n        params: Wb.apply({arInfo: docArray}),\n        success: function(resp) {\n            var record = Wb.decode(resp.responseText);\n            var msg = record.msg;\n            if(record.flag === '0'){\n                app.V_STATUS_NAME.setValue('审核通过');\n                app.V_STATUS.setValue('3');\n                app.saveBtn.setDisabled(true);\n                app.verfyBtn.setDisabled(true);\n                if(app.INV_CANCEL_AMT.getValue() !== null && app.INV_CANCEL_AMT.getValue() !== '' && app.INV_CANCEL_AMT.getValue() !== 0 && app.CANCEL_AMT.getValue() === 0){\n                    Wb.confirm('{#verfyRec3#}',function(){\n\t\t\t\t\t\tapp.cancelBtn.fireEvent('click');\n                    });\n                }\n            }\n            Wb.toast(msg);\n        }\n\t});\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#cancelVerfyBtn#}","itemId":"cancelVerfyBtn","iconCls":"delete_icon"},"events":{"click":"var headId = app.V_HEAD_ID.getValue();\nif(headId === '' || headId === null){\n    Wb.toast('{#cancelVerfyRec1#}');\n    return;\n}\nif(app.V_STATUS_NAME.getValue() === '草稿'){\n    Wb.toast('{#cancelVerfyRec2#}');\n    return;\n}\nelse{\n//    Wb.request({\n//         url: 'm?xwl=xc/ap/gl/DB/XC_AP_INV_GL_H_IS_NEXT_BY_ONE',\n//         params: Wb.getValue(app.form1),\n//         success: function(resp) {\n            var docArray = [] ;\n            var paramJson = {'headId' : app.V_HEAD_ID.getValue(),'arId':app.AR_INV_GL_H_ID.getValue(),arCatCode:'YSD'} ;\n            docArray.push(paramJson) ;\n            Wb.request({\n                url: '{#contextPath#}'+'/arDocsAction.do?method=cancelCheckArVoucher',\n                params: Wb.apply({arInfo: docArray}),\n                success: function(resp) {\n                    var record = Wb.decode(resp.responseText);\n                    var msg = record.msg;\n                    if(record.flag === '0'){\n                        app.V_STATUS_NAME.setValue('草稿');\n                        app.V_STATUS.setValue('1');\n                        app.saveBtn.setDisabled(false);\n                        app.verfyBtn.setDisabled(false);\n                    }\n                    Wb.toast(msg);\n                    tableValue = Wb.encode(Wb.getValue(app.form1));\n                }\n            });\n//         }\n//     });\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#cancelBtn#}","itemId":"cancelBtn","iconCls":"pay_icon"},"events":{"click":"var r = Wb.getRefer(app.form1);\n\nif('3' > r.V_STATUS.getValue() || Wb.isEmpty(r.V_STATUS.getValue())){\n    Wb.toast('{#cancelPayRec1#}');\n    return;\n}\nvar AR_INV_H_ID = r.AR_INV_H_ID.getValue();//发票ID\nWb.request({\n\turl : 'm?xwl=xc/ar/gl/DB/XC_AR_INV_GL_H_SELECT_BY_ID',\n    params : {AR_INV_GL_H_ID : r.AR_INV_GL_H_ID.getValue()},\n    success : function(resp){\n        var r = Wb.decode(resp.responseText);\n        if(r.CANCEL_AMT !== null && r.CANCEL_AMT !== '' && r.CANCEL_AMT !== 0){\n            AR_INV_H_ID = null;\n        }\n    }\n});\nWb.request({\n    url: 'm?xwl=xc/ar/gl/DB/XC_AR_INV_GL_H_PUB_ERROR_ALERT',\n    params: {\n        AR_INV_GL_H_ID: r.AR_INV_GL_H_ID.getValue(),\n        sql: 'select 1 FROM xc_ar_inv_gl_h WHERE AR_INV_GL_H_ID={?AR_INV_GL_H_ID?} AND NO_PAY_AMT=0',\n        errorMsg: '{#cancelPayRec2#}'\n    },\n    success : function(){\n        Wb.run({\n            url: 'm?xwl=xc/ar/cancel/XC_AR_CANCEL_H_NO_C', \n            success: function(app) {\n                app.initWin({\n                    AR_CANCEL_H_ID:'',\n                    AR_INV_GL_H_ID:r.AR_INV_GL_H_ID.getValue(),\n                    AR_INV_H_ID:AR_INV_H_ID,\n                    IS_INSERT:'Y',\n                    flag:'cancel',\n                    AR_DOC_CAT_CODE:r.AR_DOC_CAT_CODE.getValue(),\n                    AR_CANCEL_TYPE:'YSHYUS',\n                    hideFun:function(){\n                        Wb.isInsert = 'N';\n                    }\n                });\n            }\n        });\n    }\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#payBtn#}","itemId":"payBtn"},"events":{"click":"var ar_doc_cat_code = 'SKD_JSK';\nvar r = Wb.getRefer(app.form1);\nif ('3' > r.V_STATUS.getValue() || Wb.isEmpty(r.V_STATUS.getValue())) {\n    Wb.toast('{#payRec1#}');\n    return null;\n}\nif (r.AR_DOC_CAT_CODE.getValue().indexOf('-HZ') != -1) {\n    ar_doc_cat_code = 'SKD_JSK-H';\n}\nWb.request({\n    url: 'm?xwl=xc/ar/gl/DB/XC_AR_INV_GL_H_PUB_ERROR_ALERT',\n    params: {\n        AR_INV_GL_H_ID: r.AR_INV_GL_H_ID.getValue(),\n        sql: 'select 1 FROM xc_ar_inv_gl_h WHERE AR_INV_GL_H_ID={?AR_INV_GL_H_ID?} AND (ABS(NO_PAY_AMT))<=0',\n        errorMsg: '{#payRec2#}'\n    },\n    success: function(resp) {\n        Wb.run({\n            url: 'm?xwl=xc/ar/pay/XC_AR_PAY_H_NO_C',\n            success: function(app) {\n                app.initWin({\n                    AR_PAY_H_ID: '',\n                    H_AR_INV_GL_H_ID: r.AR_INV_GL_H_ID.getValue(),\n                    DOC_STATUS: 'xz',\n                    flag: 'payAll',\n                    AR_DOC_CAT_CODE: ar_doc_cat_code,\n                    hideFun: function() {\n                        Wb.docCatCode = ((ar_doc_cat_code == 'SKD_JSK') ? 'YSD' : 'YSD-HZ');\n                        Wb.isInsert = 'N';\n                    }\n                });\n            }\n        });\n    }\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#invGlBtn#}","itemId":"invGlBtn"},"events":{"click":"var r = Wb.getRefer(app.form1);\nif ('3' > r.V_STATUS.getValue() || Wb.isEmpty(r.V_STATUS.getValue())) {\n    Wb.toast('{#invGLRec1#}');\n    return null;\n}\nif (r.AR_DOC_CAT_CODE.getValue() == 'YSD') {\n    Wb.request({\n        url: 'm?xwl=xc/ar/gl/DB/XC_AR_INV_GL_H_PUB_ERROR_ALERT',\n        params: {\n            sql: 'SELECT 1 FROM xc_ar_inv_gl_h WHERE NO_PAY_AMT<=0 and AR_INV_GL_H_ID={?AR_INV_GL_H_ID?}',\n            errorMsg: '{#invGLRec2#}',\n            AR_INV_GL_H_ID:r.AR_INV_GL_H_ID.getValue()\n        },\n        success: function(resp) {\n            Wb.run({\n                url: 'm?xwl=xc/ar/gl/XC_AR_INV_GL_H_NO_C',\n                success: function(app) {\n                    app.initWin({\n                        H_AR_INV_GL_H_ID: r.AR_INV_GL_H_ID.getValue(),\n                        IS_INSERT: 'Y',\n                        flag:'inv_h',\n                        AR_DOC_CAT_CODE: r.AR_DOC_CAT_CODE.getValue() + '-HZ',\n                        hideFun: function() {\n                            Wb.docCatCode = 'YSD';\n                            Wb.isInsert = 'N';\n                        }\n                    });\n                }\n            });\n        }\n    });\n}\nelse {\n    Wb.toast('{#invGLRec3#}');\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#payListBtn#}","itemId":"payListBtn","iconCls":"aim_icon"},"events":{"click":"var arInvGlHId = app.AR_INV_GL_H_ID.getValue();\n\n// if(Wb.isInsert != 'N'){\n//     Wb.toast('请先保存数据！');\n//     return null;\n// }\nWb.run({\n    url: 'm?xwl=xc/ar/trans/XC_AR_INV_TRANS_ALL',\n    success: function(app) {\n        app.initWin({\n            SOURCE_ID : arInvGlHId,\n            AR_INV_GL_H_ID : arInvGlHId,\n            QUERY_FROM:'YSD'\n        });\n    }\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#enclosureBtn#}","itemId":"enclosureBtn","iconCls":"attach_icon"},"events":{"click":"if(Wb.isInsert == 'Y'){\n    Wb.toast('{#enclosureWarn1#}');\n    return false;\n}\nvar temp_id = app.AR_INV_GL_H_ID.getValue();\nvar temp_code = app.AR_INV_GL_H_CODE.getValue();\nWb.request({\n    url : '{#contextPath#}' + '/arInvoiceAction.do?method=getArAttCatCode',\n    params : {LEDGER_ID : app.LEDGER_ID_XWL.LEDGER_ID.getValue(),AR_DOC_CAT_CODE : app.AR_DOC_CAT_CODE.getValue()},\n    success : function(resp){\n        var temp = Wb.decode(resp.responseText);\n        if(temp.flag == '0'){\n            var attCatCode = temp.attCatCode;\n            Xip.showAttachmentManager('{#XIP.userId#}',temp_id,'',attCatCode,temp_code,'Y','Y','Y',function(){},2); \n        }\n        else{\n            Wb.toast(temp.msg);\n        }\n    }\n});"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"layout":"fit","itemId":"viewport1"},"children":[{"configs":{"itemId":"tabs"},"events":{"beforerender":"app.edit_v_xwl.xwl_v_panel.setTitle('{#VOUCHER#}');","beforetabchange":"//加载凭证信息\nif(newCard.title === app.edit_v_xwl.xwl_v_panel.title){\n    Wb.request({\n        url: 'm?xwl=xc/gl/journal/data-db/common-data/select-v-head',\n        params: {'headId' : app.V_HEAD_ID.getValue()},\n        success: function(resp) {\n            var headJson = Wb.decode(resp.responseText);\n            Wb.setValue(app.edit_v_xwl.form1,headJson);\n            Wb.setValue(app.edit_v_xwl.bbar,headJson);\n            //处理会计日期\n            var accDate = headJson.accountDate;\n            app.edit_v_xwl.accountDate.setValue(Wb.strToDate(accDate));\n        }\n    });\n    // 加载凭证分录行\n    app.edit_v_xwl.grid1.getStore().load({params :{'headId':app.V_HEAD_ID.getValue()}});\n}"},"children":[{"configs":{"title":"{#INV_GL#}","layout":"border","itemId":"tab1"},"events":{"activate":"if (Wb.isInsert == 'F') { \napp.AMOUNT_COL.getEditor().setReadOnly(true);\napp.TAX_AMT.setReadOnly(true);\napp.TAX_RATE.setReadOnly(true);\n   Wb.isInsert = 'Y';\n}"},"children":[{"configs":{"region":"north","tbar":"app.form1Tbar","border":"false","itemId":"form1"},"children":[{"configs":{"layout":"column","margin":"10 0 0 0","border":"false","itemId":"tr0"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".52","itemId":"td_0_1"},"children":[{"configs":{"style":"fontSize:20px","html":"<font style=\"\">应收单<\/font>","labelAlign":"right","itemId":"title"},"children":[],"expanded":false,"type":"label"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".31","itemId":"td_0_2"},"children":[{"configs":{"itemId":"emptyLabel"},"children":[],"expanded":false,"type":"label"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".148","itemId":"td_0_3"},"children":[{"configs":{"labelWidth":"80","allowBlank":"false","minValue":"0","value":"0","fieldStyle":"color:red;direction:rtl;","labelAlign":"right","itemId":"V_ATTCH_TOTAL","fieldLabel":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#V_ATTCH_TOTAL#}"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"layout":"column","margin":"10 0 0 0","border":"false","itemId":"tr1"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_1_1"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/LEDGER_ID_PICK/LEDGER_ID_PICK_SEC","itemId":"LEDGER_ID_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":false,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_1_2"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","allowBlank":"false","pickList":"[\n  ['YSD','{#ysd#}'],\n  ['YSD-HZ','{#ysdH#}'],\n]","labelAlign":"right","itemId":"AR_DOC_CAT_CODE","fieldLabel":"{#AR_DOC_CAT_CODE#}"},"events":{"change":"if(newValue == 'YSD'){\n    app.title.setText('{#ysd#}',false);\n    setMinAndStyle();\n}\nif(newValue == 'YSD-HZ'){\n    app.title.setText('<font style=\"color:red;\">{#ysd#}<\/font>',false);\n    app.AR_INV_GL_H_ID_XWL.QUERY_AR_DOC_CAT_CODE.setValue('YSD');\n    setMaxAndStyle();\n}\nfunction setMaxAndStyle(){\n    app.INV_AMOUNT.setFieldStyle('color:red;');\n    app.TAX_AMT.setFieldStyle('color:red;');\n    app.QTY_COL.getEditor().setFieldStyle('color:red;');\n    app.AMOUNT_COL.getEditor().setFieldStyle('color:red;');\n    app.INV_AMOUNT_COL.getEditor().setFieldStyle('color:red;');\n    app.TAX_AMT_COL.getEditor().setFieldStyle('color:red;');\n    app.TAX_AMT.setMaxValue(0);\n    app.INV_AMOUNT.setMaxValue(0);\n    app.QTY_COL.getEditor().setMaxValue(0);\n    app.AMOUNT_COL.getEditor().setMaxValue(0);\n    app.INV_AMOUNT_COL.getEditor().setMaxValue(0);\n    app.TAX_AMT_COL.getEditor().setMaxValue(0);\n}\nfunction setMinAndStyle(){\n    app.TAX_AMT.setMinValue(0);\n    app.INV_AMOUNT.setMinValue(0);\n    app.QTY_COL.getEditor().setMinValue(0);\n    app.AMOUNT_COL.getEditor().setMinValue(0);\n    app.INV_AMOUNT_COL.getEditor().setMinValue(0);\n    app.TAX_AMT_COL.getEditor().setMinValue(0);\n}"},"children":[],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_1_3"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","emptyText":"系统自动生成","labelAlign":"right","itemId":"AR_INV_GL_H_CODE","fieldLabel":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#AR_INV_GL_H_CODE#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_1_4"},"children":[{"configs":{"labelWidth":"80","allowBlank":"false","labelAlign":"right","itemId":"GL_DATE","fieldLabel":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#GL_DATE#}"},"children":[],"expanded":false,"type":"date"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"layout":"column","margin":"10 0 0 0","border":"false","itemId":"tr2"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_2_1"},"children":[{"configs":{"file":"m?xwl=xc/ar/ar-com-lov/AR_CUSTOMER_ID_PICK/AR_CUSTOMER_ID_PICK","itemId":"CUSTOMER_ID_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","hidden":"true","layout":"form","columnWidth":".245","itemId":"td_2_2"},"children":[{"configs":{"file":"m?xwl=xc/ar/ar-com-lov/AR_INV_GL_H_ID_PICK/AR_INV_GL_H_ID_PICK_GL_L","itemId":"AR_INV_GL_H_ID_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_2_3"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/DEPT_ID_PICK/DEPT_ID_LD","itemId":"DEPT_ID_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_2_4"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/PROJECT_ID_PICK/PROJECT_ID_LD","itemId":"PROJECT_ID_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"layout":"column","margin":"10 0 0 0","border":"false","itemId":"tr3"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_3_1"},"children":[{"configs":{"file":"m?xwl=xc/ar/ar-com-lov/AR_CONTRACT_ID_PICK/AR_CONTRACT_ID_PICK_ALL","itemId":"AR_CONTRACT_ID_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_3_2"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"INV_AMOUNT","fieldLabel":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#INV_AMOUNT#}"},"children":[],"expanded":false,"type":"number"},{"configs":{"labelWidth":"80","readOnly":"true","hidden":"true","labelAlign":"right","itemId":"AMOUNT","fieldLabel":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#AMOUNT#}"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_3_3"},"children":[{"configs":{"tagConfigs":"baseChars:\"-.0123456789\"","labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"TAX_AMT","fieldLabel":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#TAX_AMT#}"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_3_4"},"children":[{"configs":{"labelWidth":"80","allowBlank":"false","minValue":"0","value":"17","labelAlign":"right","allowDecimals":"false","itemId":"TAX_RATE","fieldLabel":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#TAX_RATE#}(%)","maxValue":"17"},"events":{"change":"if(number.getValue() > number.maxValue){\n    number.setValue(number.maxValue);\n}","blur":"for(var i = 0;i < app.grid1.getStore().getCount();i++){\n    var rec = app.grid1.getStore().getAt(i);\n    rec.set('TAX',number.value);\n  \n    //税额\n    var taxAmt = rec.get('AMOUNT') * rec.get('TAX') / 100;\n    rec.set('TAX_AMT',Ext.util.Format.round(taxAmt,2));\n  \n    //价税合计\n    var invAmount = rec.get('AMOUNT') + rec.get('TAX_AMT');\n    rec.set('INV_AMOUNT',invAmount);\n  \n    //含税单价\n    var invPrice = rec.get('INV_AMOUNT') / rec.get('QTY');\n    rec.set('INV_PRICE',Ext.util.Format.round(invPrice,6));\n}"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"layout":"column","margin":"10 0 0 0","border":"false","itemId":"tr4"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_4_1"},"children":[{"configs":{"labelWidth":"80","allowBlank":"false","labelAlign":"right","itemId":"DESCRIPTION","fieldLabel":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#DESCRIPTION#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_4_2"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"INV_NO","fieldLabel":"{#INV_NO#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_5_1"},"children":[{"configs":{"file":"m?xwl=xc/ar/ar-com-lov/ACC_ID_PICK/AR_ACC_ID_DEBT","itemId":"AR_ACC_ID_DEBT_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_5_2"},"children":[{"configs":{"file":"m?xwl=xc/ar/ar-com-lov/ACC_ID_PICK/AR_ACC_ID_TAX","itemId":"AR_ACC_ID_TAX_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","hidden":"true","layout":"form","columnWidth":".245","itemId":"td_4_3"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","hidden":"true","labelAlign":"right","itemId":"INV_CANCEL_AMT","fieldLabel":"核销预收"},"children":[],"expanded":false,"type":"number"},{"configs":{"labelWidth":"80","readOnly":"true","hidden":"true","labelAlign":"right","itemId":"NO_PAY_AMT","fieldLabel":"未付金额"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"layout":"column","border":"false","itemId":"tr5"},"children":[],"expanded":true,"type":"panel"},{"configs":{"layout":"column","margin":"10 0 10 0","border":"false","itemId":"tr6"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_6_1"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","value":"{#XIP.empName#}","labelAlign":"right","itemId":"CREATED_BY_NAME","fieldLabel":"{#CREATED_BY_NAME#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_6_2"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","value":"草稿","labelAlign":"right","itemId":"V_STATUS_NAME","fieldLabel":"{#V_STATUS_NAME#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_6_3"},"children":[{"configs":{"labelWidth":"80","value":"TEMP","pickList":"[\n  ['GL','应收单（蓝）'],\n  ['INV','发票'],\n  ['TEMP','手工']\n]","labelAlign":"right","itemId":"SOURCE","fieldLabel":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#SOURCE#}","editable":"false"},"events":{"change":"app.td_2_2.hide();\napp.saleTypeBtn.hide();\nif(newValue=='GL'){\n    app.td_2_2.show();\n    clearAll();\n}\nif(newValue=='TEMP'){\n\tapp.saleTypeBtn.show();\n    if(app.AR_INV_GL_H_ID_XWL.L_AR_INV_GL_H_CODE.getValue() !== null && app.AR_INV_GL_H_ID_XWL.L_AR_INV_GL_H_CODE.getValue() !== ''){\n        clearAll();\n    }\n}\napp.AR_INV_GL_H_ID_XWL.L_AR_INV_GL_H_ID.reset();\napp.AR_INV_GL_H_ID_XWL.L_AR_INV_GL_H_CODE.reset();\napp.grid1.getStore().reload({params:{AR_INV_GL_H_ID:app.AR_INV_GL_H_ID.getValue()}});"},"children":[],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"hidden":"true","itemId":"hidden_p"},"children":[{"configs":{"hidden":"true","itemId":"V_STATUS","fieldLabel":"凭证状态"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"AR_INV_GL_H_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"AR_INV_H_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","value":"{#XIP.userId#}","itemId":"USER_ID","fieldLabel":"USER_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"V_HEAD_ID","fieldLabel":"凭证头ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"PAID_AMT","fieldLabel":"已收金额"},"children":[],"expanded":false,"type":"number"},{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"ADJ_AMT","fieldLabel":"调整金额"},"children":[],"expanded":false,"type":"number"},{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"CANCEL_AMT","fieldLabel":"核销金额"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"form"},{"configs":{"region":"center","pagingBar":"false","selType":"checkboxmodel","itemId":"grid1","editable":"true"},"events":{"tagEvents":"'cellclick' : function(grid1,td,cellIndex,record,tr,rowIndex,e,eOpts){\n    if(cellIndex == 17){\n        var store = grid1.getStore();\n        var DIM_NAME = record.data.DIM_NAME;\n        var DIM_CODE = record.data.DIM_CODE;\n        if(rowIndex > 0){\n            if(DIM_CODE === '' || DIM_CODE === null){\n                var r = store.getAt(0);\n                record.set('DIM_CODE',r.data.DIM_CODE);\n                record.set('DIM_NAME',r.data.DIM_NAME);\n            }\n        }\n    }\n}"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/ar/gl/DB/XC_AR_INV_GL_L_SELECT"},"events":{"update":"isEditCol = 'Y';","remove":"isEditCol = 'Y';","add":"isEditCol = 'Y';"},"children":[],"expanded":false,"type":"store"},{"configs":{"normalName":"grid1Tbar","itemId":"tbar"},"children":[{"configs":{"text":"{#saleTypeBtn#}","itemId":"saleTypeBtn","iconCls":"db_form_add_icon"},"events":{"click":"var invGlHId = app.AR_INV_GL_H_ID.getValue();\nvar taxRate = app.TAX_RATE.getValue();\nvar ledgerId = app.LEDGER_ID_XWL.LEDGER_ID.getValue();\nvar P_DESCRIPTION = app.DESCRIPTION.getValue();\nif(Wb.isEmpty(ledgerId)){\n    Wb.toast('{#selectInfo1#}');\n    return false;\n}\n//设置数量\nvar tempQty = 1;\nif (Wb.docCatCode == 'YSD-HZ') {\n\ttempQty = -1;\n}\n\nvar curGrid = app.grid1;\nWb.run({\n    url: 'm?xwl=xc/ar/gl/LOV/LOV_XC_AR_SALE_TYPE', \n    params:{docCatCode:Wb.docCatCode},//发票类型\n    success: function(app) {\n        app.initWin({\n            LEDGER_ID:ledgerId,\n            hideFun:function(rs){\n                Wb.each(rs, function(r) {\n                    r.set('AR_INV_GL_L_ID',Xip.getId());\n                    r.set('AR_INV_GL_H_ID',invGlHId);\n                    r.set('QTY',tempQty);\n                    r.set('TAX',taxRate);\n                    var grid1Store = curGrid.getStore();\n                    if(grid1Store.getCount() > 0){\n                        r.set('DIM_CODE',grid1Store.getAt(0).get('DIM_CODE'));\n                        r.set('DIM_NAME',grid1Store.getAt(0).get('DIM_NAME'));\n                    }\n                    for(var i=0;i<grid1Store.getCount();i++){\n                        var gr = grid1Store.getAt(i);\n                        if(gr.get('AR_SALE_TYPE_ID') == r.get('AR_SALE_TYPE_ID')){\n//                             return false;\n                            curGrid.getStore().removeAt(i);\n                        }\n                    }\n                    Wb.add(curGrid, {\n//                         AR_INV_GL_L_ID : r.get('AR_INV_GL_L_ID'),\n//                         AR_INV_GL_H_ID : r.get('AR_INV_GL_H_ID'),\n                        L_AR_INV_GL_H_CODE : r.get('L_AR_INV_GL_H_CODE'),\n                        AR_SALE_TYPE_ID : r.get('AR_SALE_TYPE_ID'),\n                        AR_SALE_TYPE_NAME : r.get('AR_SALE_TYPE_NAME'),\n//                         BG_ITEM_ID : r.get('BG_ITEM_ID'),\n//                         BG_ITEM_NAME : r.get('BG_ITEM_NAME'),\n                        DEPT_ID : r.get('DEPT_ID'),\n                        DEPT_NAME : r.get('DEPT_NAME'),\n                        PRODUCT_ID : r.get('PRODUCT_ID'),\n                        PRODUCT_NAME : r.get('PRODUCT_NAME'),\n                        ACC_ID : r.get('AR_ACC_ID_INV'),\n                        ACC_NAME : r.get('ACC_NAME'),\n                        CCID : r.get('CCID'),\n                        AMOUNT : r.get('PAY_AMT'),\n                        DIM_CODE:r.get('DIM_CODE'),\n                        DIM_NAME:r.get('DIM_NAME'),\n                        QTY : r.get('QTY'),\n                        TAX : r.get('TAX'),\n                        PRICE : Ext.util.Format.round(r.get('PAY_AMT') / r.get('QTY'),6),\n                        TAX_AMT : Ext.util.Format.round(r.get('PAY_AMT') * r.get('TAX') / 100,2),\n                        INV_AMOUNT : (r.get('PAY_AMT') + Ext.util.Format.round(r.get('PAY_AMT') * r.get('TAX') / 100,2)),\n                        INV_PRICE : Ext.util.Format.round((r.get('PAY_AMT') + Ext.util.Format.round(r.get('PAY_AMT') * r.get('TAX') / 100,2)) / r.get('QTY')),\n                        DESCRIPTION : P_DESCRIPTION\n                    }, 'after', 1, false);\n                });\n            }\n        });\n    }\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#delBtns#}","itemId":"delBtn","iconCls":"file_delete_icon"},"events":{"click":"//删除原则，先将选中记录在表格中移除，点击主单保存时，才真正从数据库删除。\nvar recs = app.grid1.getSelection();\nif (!recs.length) {\n    Wb.toast('请选择需要删除的记录。');\n    return;\n}\nWb.confirm('确定要删除选择的 ' + recs.length + ' 条记录吗？', function() {\n\tWb.remove(app.grid1,recs);\n});"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"应付单主ID","hidden":"true","dataIndex":"AR_INV_GL_H_ID","itemId":"AR_INV_GL_H_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"应付单行ID","hidden":"true","dataIndex":"AR_INV_GL_L_ID","itemId":"AR_INV_GL_L_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"应收单蓝单行ID","hidden":"true","dataIndex":"L_AR_INV_GL_L_ID","titleAlign":"center","itemId":"L_AR_INV_GL_L_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"应收单蓝单主ID","hidden":"true","dataIndex":"L_AR_INV_GL_H_ID","titleAlign":"center","itemId":"L_AR_INV_GL_H_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"销售类型ID","hidden":"true","dataIndex":"AR_SALE_TYPE_ID","titleAlign":"center","itemId":"AR_SALE_TYPE_ID_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"<font color=\"red\">*<\/font>{#AR_SALE_TYPE_NAME#}","width":"150","dataIndex":"AR_SALE_TYPE_NAME","titleAlign":"center","itemId":"AR_SALE_TYPE_NAME_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"产品ID","hidden":"true","dataIndex":"PRODUCT_ID","itemId":"PRODUCT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#PRODUCT_NAME#}","width":"100","dataIndex":"PRODUCT_NAME","titleAlign":"center","itemId":"PRODUCT_NAME_COL"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","normalName":"PRODUCT_NAME_PICK","itemId":"editor"},"events":{"expand":"app.pickComp.getStore().load();"},"children":[{"configs":{"tagConfigs":"minWidth:400","height":"300","barExportButtons":"false","barExportAllButtons":"false","itemId":"pickComp"},"events":{"itemdblclick":"var r=app.grid1.getSelectionModel().getSelection()[0];\nr.set('PRODUCT_ID',record.data.PRODUCT_ID);\nr.set('PRODUCT_NAME',record.data.PRODUCT_NAME);\napp.PRODUCT_NAME_PICK.setValue(record.data.PRODUCT_NAME);\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/ar/inv/DB/selectProductInfo"},"events":{"beforeload":"operation.params = Wb.getValue([app.form1,app.tbar]);"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"ID","hidden":"true","dataIndex":"PRODUCT_ID","itemId":"PRODUCT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#PRODUCT_CODE_COL#}","dataIndex":"PRODUCT_CODE","itemId":"PRODUCT_CODE_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#PRODUCT_NAME_COL#}","dataIndex":"PRODUCT_NAME","itemId":"PRODUCT_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"100","emptyText":"{#PRODUCT_CODE_NAME#}","labelAlign":"right","itemId":"QUERY_CODE_NAME"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.pickComp.getStore().load();\n}"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"searchButton","iconCls":"seek_icon"},"events":{"click":"app.pickComp.getStore().load();"},"children":[],"expanded":false,"type":"button"},{"configs":{"itemId":"cancelBtn","iconCls":"delete_icon"},"events":{"click":"var r=app.grid1.getSelectionModel().getSelection()[0];\nr.set('PRODUCT_ID',null);\nr.set('PRODUCT_NAME',null);\napp.PRODUCT_NAME_PICK.setValue(null);\napp.PRODUCT_NAME_PICK.getPicker().hide();"},"children":[],"expanded":true,"type":"item"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":false,"type":"column"},{"configs":{"text":"{#PRODUCT_NAME1#}","width":"150","dataIndex":"PRODUCT_NAMES","titleAlign":"center","itemId":"PRODUCT_NAME_COL1"},"children":[{"configs":{"itemId":"editor"},"children":[],"expanded":false,"type":"text"}],"expanded":false,"type":"column"},{"configs":{"text":"{#MODEL#}","width":"100","dataIndex":"MODEL","titleAlign":"center","itemId":"MODEL_COL"},"children":[{"configs":{"itemId":"editor"},"children":[],"expanded":false,"type":"text"}],"expanded":false,"type":"column"},{"configs":{"text":"收入科目ID","hidden":"true","dataIndex":"ACC_ID","itemId":"ACC_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"<font color=\"red\">*<\/font>{#ACC_NAME#}","width":"150","dataIndex":"ACC_NAME","titleAlign":"center","itemId":"ACC_NAME_COL"},"children":[{"configs":{"labelWidth":"100","allowBlank":"false","labelAlign":"right","normalName":"ACC_NAME_PICK","itemId":"editor"},"events":{"expand":"app.pickComp.getStore().load();"},"children":[{"configs":{"tagConfigs":"minWidth:400","height":"300","itemId":"pickComp"},"events":{"itemdblclick":"var r=app.grid1.getSelectionModel().getSelection()[0];\nr.set('ACC_ID',record.data.ACC_ID);\nr.set('ACC_NAME',record.data.ACC_NAME);\nr.set('CCID',null) ;    \nr.set('CCID_NAME',null);\nr.dirty = true;\napp.ACC_NAME_PICK.setValue(record.data.ACC_NAME);\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/com-lov/ACC_ID_PICK/DB/XC_BG_LD_ACCOUNTS_SELECT_LD"},"events":{"beforeload":"operation.params = Wb.getValue([app.form1,app.tbar]);"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","dataIndex":"ACC_ID","itemId":"ACC_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#ACC_CODE_COLS#}","dataIndex":"ACC_CODE","itemId":"ACC_CODE_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#ACC_NAME_COLS#}","dataIndex":"ACC_NAME","itemId":"ACC_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":false,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"100","emptyText":"{#ACC_CODE_NAMES#}","labelAlign":"right","itemId":"QUERY_CODE_NAME"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.pickComp.getStore().load();\n}"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"searchButton","iconCls":"seek_icon"},"events":{"click":"app.pickComp.getStore().load();"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":true,"type":"column"},{"configs":{"text":"组合科目ID","hidden":"true","dataIndex":"CCID","itemId":"CCID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#CCID_NAME#}","width":"200","dataIndex":"CCID_NAME","titleAlign":"center","normalName":"CCID_NAME_PICK","itemId":"CCID_NAME_COL"},"children":[{"configs":{"displayField":"CCID_NAME","triggerCls":"x-form-search-trigger","valueField":"CCID","itemId":"editor","onTriggerClick":"  // 账簿\n  var ledgerId = app.LEDGER_ID_XWL.LEDGER_ID.getValue() ;\n  if(ledgerId === \"\" ||ledgerId === null || ledgerId === undefined){\n    Wb.info('请选择账簿!') ;\n    return false ;\n  }\n  \n  // 会计日期\n  var accDate = app.GL_DATE.getValue() ;\n  if(accDate === \"\" ||accDate === null || accDate === undefined){\n    Wb.info('请选择会计日期!') ;\n    return false ;\n  }else{\n\taccDate = Wb.dateToStr(accDate).substring(0,7);\n  }\n  \n  // TODO: 当前选中\n  var r = app.grid1.getSelection()[0] ; \n  \n  // TODO: 显示科目选择窗口\n  Wb.run({\n    url:'m?xwl=xc/gl/journal/v-windows/handler-ccid-win',\n    params : {\n      'ledgerId' : ledgerId,\n      'vtype' : '{#vtype#}'\n    },          \n    success:function(appObj){\n      appObj.initWindow({\n        accName : r.data.ACC_NAME,\n        ledgerId : ledgerId,\n        periodCode : accDate ,\n        groupId : 'ALL',\n        handlerCCID : function(returnObj){\n          // TODO: 处理CCID信息\n          var rObj = Wb.decode(returnObj) ;\n          r.set('ACC_ID', rObj.acc_id) ;    \n          r.set('ACC_NAME', rObj.acc_name);\n          r.set('CCID', rObj.acc_ccid) ;    \n          r.set('CCID_NAME', rObj.acc_ccid_name);\n          if(!Wb.isEmpty(rObj.dim_id)){\n          r.set('DIM_ID', rObj.dim_id) ;\n          r.set('DIM_NAME', rObj.dim_name) ;\n          }\n          // 禁用账簿\n           app.LEDGER_ID_XWL.LEDGER_ID.setReadOnly(true) ;\n        }\n      });\n    }  \n  }) ;   "},"events":{"change":"if(newValue === null || newValue === ''){\n    var r = app.grid1.getSelection()[0]; \n    r.set('CCID',null);   \n}","beforequery":"var combo = e.combo;\nif(!e.forceAll){\n  var value = e.query;\n  combo.store.filterBy(function(record,id){\n    var text = record.get(combo.displayField);\n    return (text.indexOf(value)!=-1);\n  });\n  combo.expand();\n  return false;\n}","specialkey":"// TODO: 按回车键执行借方和贷方金额切换\nif (e.getKey() == e.ENTER) {\n  // 账簿\n  var ledgerId = app.LEDGER_ID_XWL.LEDGER_ID.getValue() ;\n  if(ledgerId === \"\" ||ledgerId === null || ledgerId === undefined){\n    Wb.info('请选择账簿!') ;\n    return false ;\n  }\n  \n  // 会计日期\n  var accDate = app.GL_DATE.getValue();\n  if(accDate === \"\" ||accDate === null || accDate === undefined){\n    Wb.info('请选择会计日期!') ;\n    return false ;\n  }else{\n    accDate = Wb.dateToStr(accDate).substring(0,7);\n  }\n  \n  // TODO: 当前选中\n  var r = app.grid1.getSelection()[0] ; \n  \n  // TODO: 显示科目选择窗口\n  Wb.run({\n    url:'m?xwl=xc/gl/journal/v-windows/handler-ccid-win',\n    params : {\n      'ledgerId' : ledgerId ,\n      'vtype' : '{#vtype#}'\n    },          \n    success:function(appObj){\n      appObj.initWindow({\n        accName : r.data.ACC_NAME,\n        ledgerId : ledgerId,\n        periodCode : accDate ,\n        groupId : 'ALL',\n        handlerCCID : function(returnObj){\n          // TODO: 处理CCID信息\n          var rObj = Wb.decode(returnObj) ;\n          r.set('ACC_ID', rObj.acc_id) ;    \n          r.set('ACC_NAME', rObj.acc_name);\n          r.set('CCID', rObj.acc_ccid) ;    \n          r.set('CCID_NAME', rObj.acc_ccid_name);\n          if(!Wb.isEmpty(rObj.dim_id)){\n          r.set('DIM_ID', rObj.dim_id) ;\n          r.set('DIM_NAME', rObj.dim_name) ;\n          }\n          // 禁用账簿\n           app.LEDGER_ID_XWL.LEDGER_ID.setReadOnly(true) ;\n        }\n      });\n    }  \n  }) ;   \n}"},"children":[],"expanded":true,"type":"combo"}],"expanded":true,"type":"column"},{"configs":{"text":"<font color=\"red\">*<\/font>{#QTY#}","align":"right","width":"100","dataIndex":"QTY","titleAlign":"center","itemId":"QTY_COL","renderer":"if (Wb.docCatCode == 'ZZS-HZ' || Wb.docCatCode == 'ZZSPT-HZ') {\n    value = '<font style=\"color:red;\">'+value+'<\/font>';\n}\nreturn value;"},"children":[{"configs":{"decimalPrecision":"6","allowBlank":"false","itemId":"editor"},"events":{"blur":"/*\t无税金额\t= ROUND（无税单价*数量，2）\n\t税额\t\t= ROUND（无税金额*税率/100，2）\n    价税合计\t= 无税金额+税额\n    含税单价\t= ROUND（价税合计/数量，6）\n*/\n\nvar rec = app.grid1.getSelection()[0];\n\n//无税金额\nvar amount = number.value * rec.data.PRICE;\nrec.set('AMOUNT',Ext.util.Format.round(amount,2));\n\n//税额\nvar taxAmt = rec.get('AMOUNT') * rec.get('TAX') / 100;\nrec.set('TAX_AMT',Ext.util.Format.round(taxAmt,2));\n\n//价税合计\nvar invAmount = rec.get('AMOUNT') + rec.get('TAX_AMT');\nrec.set('INV_AMOUNT',invAmount);\n\n//含税单价\nvar invPrice = rec.get('INV_AMOUNT') / number.value;\nrec.set('INV_PRICE',Ext.util.Format.round(invPrice,6));"},"children":[],"expanded":false,"type":"number"}],"expanded":false,"type":"column"},{"configs":{"text":"{#DIM_CODE#}","hidden":"true","dataIndex":"DIM_CODE","itemId":"DIM_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"<font color=\"red\">*<\/font>{#DIM_NAME#}","width":"80","dataIndex":"DIM_NAME","titleAlign":"center","itemId":"DIM_NAME_COL"},"children":[{"configs":{"labelWidth":"80","allowBlank":"false","labelAlign":"right","normalName":"DIM_NAME_PICK","itemId":"editor"},"events":{"expand":"app.pickComp.getStore().load();"},"children":[{"configs":{"tagConfigs":"minWidth:400","height":"300","barExportButtons":"false","barExportAllButtons":"false","itemId":"pickComp"},"events":{"itemdblclick":"var r=app.grid1.getSelectionModel().getSelection()[0];\nr.set('DIM_CODE',record.data.DIM_CODE);\nr.set('DIM_NAME',record.data.DIM_NAME);\napp.DIM_NAME_PICK.setValue(record.data.DIM_NAME);\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/ap/inv/DB/XC_GL_DIMENSIONS_SELECT"},"events":{"beforeload":"operation.params = Wb.getValue(app.tbar);"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","dataIndex":"DIM_ID","itemId":"DIM_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#DIM_CODE_COL#}","dataIndex":"DIM_CODE","itemId":"DIM_CODE_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#DIM_NAME_COL#}","dataIndex":"DIM_NAME","itemId":"DIM_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":false,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"100","emptyText":"{#DIM_CODE_NAME#}","labelAlign":"right","itemId":"QUERY_CODE_NAME"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.pickComp.getStore().load();\n}"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"searchButton","iconCls":"seek_icon"},"events":{"click":"app.pickComp.getStore().load();"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":true,"type":"column"},{"configs":{"text":"{#PRICE#}","width":"100","align":"right","dataIndex":"PRICE","format":"0,000.00","titleAlign":"center","itemId":"PRICE_COL"},"children":[{"configs":{"decimalPrecision":"6","minValue":"0","itemId":"editor"},"events":{"focus":"var rec = app.grid1.getSelection()[0];\nif(rec.data.QTY === 0 || rec.data.QTY === null){\n\tnumber.setReadOnly(true);\n}\nelse{\n\tnumber.setReadOnly(false);\n}","blur":"/*\t无税金额\t= ROUND（无税单价*数量，2）\n\t税额\t\t= ROUND（无税金额*税率/100，2）\n    价税合计\t= 无税金额+税额\n    含税单价\t= ROUND（价税合计/数量，6）\n*/\n\nvar rec = app.grid1.getSelection()[0];\n\n//无税金额\nvar amount = number.value * rec.get('QTY');\nrec.set('AMOUNT',Ext.util.Format.round(amount,2));\n\n//税额\nvar taxAmt = rec.get('AMOUNT') * rec.get('TAX') / 100;\nrec.set('TAX_AMT',Ext.util.Format.round(taxAmt,2));\n\n//价税合计\nvar invAmount = rec.get('AMOUNT') + rec.get('TAX_AMT');\nrec.set('INV_AMOUNT',invAmount);\n\n//含税单价\nvar invPrice = rec.get('INV_AMOUNT') / rec.get('QTY');\nrec.set('INV_PRICE',Ext.util.Format.round(invPrice,6));"},"children":[],"expanded":false,"type":"number"}],"expanded":false,"type":"column"},{"configs":{"text":"{#INV_PRICE#}","width":"100","align":"right","dataIndex":"INV_PRICE","format":"0,000.00","titleAlign":"center","itemId":"INV_PRICE_COL"},"children":[{"configs":{"readOnly":"true","decimalPrecision":"6","minValue":"0","itemId":"editor"},"children":[],"expanded":false,"type":"number"}],"expanded":false,"type":"column"},{"configs":{"text":"{#AMOUNT#}","width":"100","align":"right","dataIndex":"AMOUNT","format":"0,000.00","titleAlign":"center","itemId":"AMOUNT_COL","renderer":"if (Wb.docCatCode == 'YSD-HZ') {\n    value = '<font color=red>'+Wb.format(value,'0,000.00')+'<\/font>';\n}\nelse {\n    value = Wb.format(value,'0,000.00');\n}\nreturn value;"},"children":[{"configs":{"decimalPrecision":"6","itemId":"editor"},"events":{"focus":"var rec = app.grid1.getSelection()[0];\nif(rec.data.QTY === 0 || rec.data.QTY === null){\n\tnumber.setReadOnly(true);\n}\nelse{\n\tnumber.setReadOnly(false);\n}","blur":"/*\n\t无税单价\t= ROUND（无税金额/数量，6）\n    税额\t\t= ROUND（无税金额*税率/100，2）\n    价税合计\t= 无税金额+税额\n    含税单价\t= ROUND（价税合计/数量，6）\n*/\nvar rec = app.grid1.getSelection()[0];\n\n//无税单价\nvar price = number.value / rec.get('QTY');\nrec.set('PRICE',Ext.util.Format.round(price,6));\n\n//税额\nvar taxAmt = number.value * rec.get('TAX') / 100;\nrec.set('TAX_AMT',Ext.util.Format.round(taxAmt,2));\n\n//价税合计\nvar invAmount = number.value + rec.get('TAX_AMT');\nrec.set('INV_AMOUNT',invAmount);\n\n//含税单价\nvar invPrice = rec.get('INV_AMOUNT') / rec.get('QTY');\nrec.set('INV_PRICE',Ext.util.Format.round(invPrice,6));"},"children":[],"expanded":false,"type":"number"}],"expanded":false,"type":"column"},{"configs":{"text":"<font color=\"red\">*<\/font>{#TAX_RATE#}(%)","width":"100","align":"right","dataIndex":"TAX","titleAlign":"center","itemId":"TAX_RATE_COL"},"children":[{"configs":{"allowBlank":"false","minValue":"0","itemId":"editor","maxValue":"17"},"events":{"change":"if(number.getValue() > number.maxValue){\n    number.setValue(number.maxValue);\n}","blur":"/*\n\t无税单价\t= ROUND（无税金额/数量，6）\n    税额\t\t= ROUND（无税金额*税率/100，2）\n    价税合计\t= 无税金额+税额\n    含税单价\t= ROUND（价税合计/数量，6）\n*/\nvar rec = app.grid1.getSelection()[0];\n\n//税额\nvar taxAmt = rec.get('AMOUNT') * number.value / 100;\nrec.set('TAX_AMT',Ext.util.Format.round(taxAmt,2));\n\n//价税合计\nvar invAmount = rec.get('AMOUNT') + rec.get('TAX_AMT');\nrec.set('INV_AMOUNT',invAmount);\n\n//含税单价\nvar invPrice = rec.get('INV_AMOUNT') / rec.get('QTY');\nrec.set('INV_PRICE',Ext.util.Format.round(invPrice,6));"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"column"},{"configs":{"text":"<font color=\"red\">*<\/font>{#TAX_AMT#}","width":"100","align":"right","dataIndex":"TAX_AMT","format":"0,000.00","titleAlign":"center","itemId":"TAX_AMT_COL","renderer":"if (Wb.docCatCode == 'YSD-HZ') {\n    value = '<font color=red>'+Wb.format(value,'0,000.00')+'<\/font>';\n}\nelse {\n    value = Wb.format(value,'0,000.00');\n}\nreturn value;"},"children":[{"configs":{"allowBlank":"false","itemId":"editor"},"events":{"change":"if(number.value > number.maxValue)\n    number.setValue(number.maxValue);\nif(number.value < number.minValue)\n    number.setValue(number.minValue);","focus":"var rec = app.grid1.getSelection()[0];\n\nif (Wb.docCatCode == 'ZZS-HZ' || Wb.docCatCode == 'ZZSPT-HZ') {\n\tnumber.setMinValue(rec.get('INV_AMOUNT'));\n}\nelse{\n\tnumber.setMaxValue(rec.get('INV_AMOUNT'));\n}\nif(rec.data.QTY === 0 || rec.data.QTY === null){\n\tnumber.setReadOnly(true);\n}\nelse{\n\tnumber.setReadOnly(false);\n}","blur":"/*\n\t无税金额\t= 价税合计-税额\n    无税单价\t= ROUND（无税金额/数量，6）\n    含税单价\t= ROUND（价税合计/数量，6）\n*/\nvar rec = app.grid1.getSelection()[0];\n\n//无税金额\nvar amount = rec.get('INV_AMOUNT') - number.value;\nrec.set('AMOUNT',Ext.util.Format.round(amount,2));\n\n//无税单价\nvar price = rec.get('AMOUNT') / rec.get('QTY');\nrec.set('PRICE',Ext.util.Format.round(price,6));\n\n//含税单价\nvar invPrice = rec.get('INV_AMOUNT') / rec.get('QTY');\nrec.set('INV_PRICE',Ext.util.Format.round(invPrice,6));"},"children":[],"expanded":false,"type":"number"}],"expanded":false,"type":"column"},{"configs":{"text":"<font color=\"red\">*<\/font>{#INV_AMOUNT#}","width":"100","align":"right","dataIndex":"INV_AMOUNT","format":"0,000.00","titleAlign":"center","itemId":"INV_AMOUNT_COL","renderer":"if (Wb.docCatCode == 'YSD-HZ') {\n    value = '<font color=red>'+Wb.format(value,'0,000.00')+'<\/font>';\n}\nelse {\n    value = Wb.format(value,'0,000.00');\n}\nreturn value;"},"children":[{"configs":{"readOnly":"true","allowBlank":"false","itemId":"editor"},"children":[],"expanded":false,"type":"number"}],"expanded":false,"type":"column"},{"configs":{"text":"<font color=\"red\">*<\/font>{#DESCRIPTION#}","width":"300","dataIndex":"DESCRIPTION","titleAlign":"center","itemId":"DESCRIPTION_COL"},"children":[{"configs":{"allowBlank":"false","itemId":"editor"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"panel"},{"configs":{"file":"m?xwl=xc/gl/journal/v-windows/new-xwl-voucher","itemId":"edit_v_xwl"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"tab"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}