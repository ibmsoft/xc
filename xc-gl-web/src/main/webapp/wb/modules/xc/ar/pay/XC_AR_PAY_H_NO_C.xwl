{"inframe":false,"title":"收款单新增修改查看","hidden":false,"roles":{"default":1},"children":[{"configs":{"serverScript":"//---------------------获取当前模块语言对应的.json文件，放到request中----------------\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xc/ar/pay/json/XC_AR_PAY_H_NO_C\");\nvar contextPath = request.getContextPath();\nrequest.setAttribute(\"contextPath\",contextPath);\n\nrequest.setAttribute('opmode','view');\nrequest.setAttribute('vtype','normal');","itemId":"module"},"events":{"finalize":"Wb.docCatCode = '';//单据类型 SKD_JSK 结算款 SKD_JSK-H 结算款红字 SKD_YUSK 预收款 SKD_YUSK-H 预收款红字  SKD_QTSK 其它收款 SKD_QTSK-H 其它收款红字\nWb.docStatus = '';//单据状态 xz新增 cg草稿 zd只读 qz签字 shtg审核通过\nWb.ar_pay_h_id = '';//收款单id\nWb.v_head_id = '';//凭证id\nWb.h_ar_inv_gl_h_id = '';//应收单id\nWb.recordFormData = null;//记录表单数据\n\n\n\nExt.apply(app,{\n  grid : null, // 被使用的表格\n  tbar : null, // 表格工具条\n  initWin:function(params){\n    Ext.apply(app, params);\n    //参数赋值\n    Wb.docStatus = params.DOC_STATUS;\n    Wb.docCatCode = params.AR_DOC_CAT_CODE;\n    Wb.ar_pay_h_id = params.AR_PAY_H_ID;\n    Wb.h_ar_inv_gl_h_id = params.H_AR_INV_GL_H_ID;\n    \n    //显示窗口\n    app.win = new Ext.window.Window(app.window);\n    app.win.show();\n    \n    if(Wb.docCatCode == 'SKD_JSK'){\n      app.title_skd.show();\n      app.title_tkd.hide();\n      app.SOURCE.setValue('GL_L');\n     //app.grid1.show();\n      app.grid = app.grid1;\n      app.tbar = app.grid1Tbar;\n    }else if(Wb.docCatCode == 'SKD_JSK-H'){\n      app.title_skd.hide();\n      app.title_tkd.show();\n      app.SOURCE.setValue('GL_H');\n      //app.grid2.show();\n      app.grid = app.grid2;\n      app.tbar = app.grid2Tbar;\n    }else if(Wb.docCatCode == 'SKD_YUSK'){//预收款（红蓝）合同为必填项\n      app.title_skd.show();\n      app.title_tkd.hide();\n      app.SOURCE.setValue('TEMP');\n      //app.grid3.show();\n      app.grid = app.grid3;\n      app.tbar = app.grid3Tbar;\n    }else if(Wb.docCatCode == 'SKD_YUSK-H'){\n      app.title_skd.hide();\n      app.title_tkd.show();\n      app.SOURCE.getStore().removeAt(0);\n      app.SOURCE.getStore().removeAt(0);\n      app.SOURCE.setValue('PAY_L');\n      app.SOURCE.setReadOnly(false);\n      //app.grid4.show();\n      app.grid = app.grid4;\n      app.tbar = app.grid4Tbar;\n    }else if(Wb.docCatCode == 'SKD_QTSK'){\n      app.title_skd.show();\n      app.title_tkd.hide();\n      app.SOURCE.setValue('TEMP');\n      //app.grid5.show();\n      app.grid = app.grid5;\n      app.tbar = app.grid5Tbar;\n    }else if(Wb.docCatCode == 'SKD_QTSK-H'){\n      app.title_skd.hide();\n      app.title_tkd.show();\n      app.SOURCE.setValue('TEMP');\n      //app.grid6.show();\n      app.grid = app.grid6;\n      app.tbar = app.grid6Tbar;\n    }\n    \n    app.grid.show();\n    \n    \n    \n    //改变界面视图\n    changeView1(Wb.docStatus);\n    //处理必填项\n    initAllowBank();  \n    //账户置灰\n    app.BANK_ACCOUNT_XWL.DEPOSIT_BANK_NAME.setReadOnly(true);\n    app.BANK_ACCOUNT_XWL.DEPOSIT_BANK_NAME.allowBank = true;\n    app.BANK_ACCOUNT_XWL.DEPOSIT_BANK_NAME.setFieldLabel('{#ACCOUNT_NAME#}');\n    \n    //从应收单跳转过来\n    if(Wb.docStatus == 'xz' && !Wb.isEmpty(Wb.h_ar_inv_gl_h_id)){\n      Wb.request({\n        async : false,\n        url : 'm?xwl=xc/ar/pay/DB/select_xc_ar_inv_gl_h_by_id',\n        params : {AR_INV_GL_H_ID : Wb.h_ar_inv_gl_h_id},\n        success : function(resp){\n          var obj = Wb.decode(resp.responseText);\n          if(obj.rows.length === 0 ){\n            Wb.info('该应收单不存在！');\n          }else{\n            var inv_data = obj.rows[0];\n            updateGlDATEMinValue(inv_data.LEDGER_ID);//设置业务日期最小值\n            initArPayByInv(inv_data);//初始数据和界面设置都在这里面完成\n            app.grid.store.load({\n              scope : this,\n              callback : function(records, operation, success){\n                Wb.addEdit(app.grid,{\n                  AR_INV_GL_H_ID : inv_data.AR_INV_GL_H_ID,\n                  AR_INV_GL_H_CODE : inv_data.AR_INV_GL_H_CODE,\n                  AR_DOC_CAT_CODE : inv_data.AR_DOC_CAT_CODE,\n                  AR_CONTRACT_ID : inv_data.AR_CONTRACT_ID,\n                  AR_CONTRACT_NAME : inv_data.AR_CONTRACT_NAME,\n                  DEPT_ID : inv_data.DEPT_ID,\n                  DEPT_NAME : inv_data.DEPT_NAME,\n                  PROJECT_ID : inv_data.PROJECT_ID,\n                  PROJECT_NAME : inv_data.PROJECT_NAME,\n                  ACC_ID : inv_data.ACC_ID,\n                  ACC_NAME : inv_data.ACC_NAME,\n                  CCID : inv_data.CCID,\n                  CCID_NAME : inv_data.CCID_NAME,\n                  AMOUNT : inv_data.NO_PAY_AMT,\n                  AR_CREATED_BY_NAME : '{#XIP.empName#}',\n                  DESCRIPTION : inv_data.DESCRIPTION\n                },'after',1,false);\n              }\n            });\n            app.selectArInvBtn1.setDisabled(true);\n            app.deleteBtn1.setDisabled(true);\n            Wb.recordFormData = Wb.encode(Wb.getValue(app.form1));//记录表单数据\n          }\n\n        }\n      });\n      \n    }\n\n    //自己的新增\n    if(Wb.docStatus == 'xz' && Wb.h_ar_inv_gl_h_id === ''){\n        // 新增时，需要初始化一些数据\n        var store = app.LEDGER_ID_XWL.LEDGER_NAME.getPicker().getStore();\n        store.load({\n          scope:this,\n          callback:function(records,operation,success){\n            if(success){\n              //账簿\n              app.LEDGER_ID_XWL.LEDGER_ID.setValue(records[0].data.LEDGER_ID);\n              app.LEDGER_ID_XWL.LEDGER_NAME.setValue(records[0].data.LEDGER_NAME);\n              returnRowFn(records[0],'xc_gl_ledgers');\n              //入账日期、收款日期\n              app.GL_DATE.setValue(new Date());\n              app.PAY_DATE.setValue(new Date());\n              //制单人\n              app.CREATED_BY.setValue('{#XIP.userId#}');\n              app.CREATED_BY_NAME.setValue('{#XIP.empName#}');\n              //单据类型\n              app.AR_DOC_CAT_CODE.setValue(Wb.docCatCode);\n              //加载表格\n              app.grid.store.load();\n            }\n          }\n        });\n        \n    }\n    //修改或者查看\n    if(Wb.docStatus == 'cg' || Wb.docStatus == 'zd' || Wb.docStatus == 'qz' || Wb.docStatus == 'shtg'){\n      //根据单据id获得数据\n      var pay_data;\n      Wb.request({\n        async : false,\n        url : 'm?xwl=xc/ar/pay/DB/select_xc_ar_pay_by_id',\n        params : {AR_PAY_H_ID:Wb.ar_pay_h_id},\n        success : function(resp){\n          var obj = Wb.decode(resp.responseText);\n          if(obj.rows.length > 0){\n            pay_data = obj.rows[0];\n          }else{\n            Wb.toast('该收款单不存在！');\n          }\n        }\n      });\n      //加载收款方式store\n      app.LEDGER_ID_XWL.LEDGER_ID.setValue(pay_data.LEDGER_ID);\n      updateGlDATEMinValue(pay_data.LEDGER_ID);//设置业务日期最小值\n      app.PAY_TYPE_NAME.store.load();\n      //凭证\n      Wb.v_head_id = pay_data.V_HEAD_ID;\n      //赋值\n      setJsonToValues(pay_data);\n      \n      setProjectDisabled(true);//项目置灰\n      //picker查询条件赋值\n      app.CUSTOM_ID_XWL.QUERY_LEDGER_ID.setValue(pay_data.LEDGER_ID);\n      app.DEPT_ID_XWL.QUERY_LEDGER_ID.setValue(pay_data.LEDGER_ID);\n      app.PROJECT_ID_XWL.QUERY_LEDGER_ID.setValue(pay_data.LEDGER_ID);\n      app.PROJECT_ID_XWL.QUERY_DEPT_ID.setValue(pay_data.DEPT_ID);\n      app.AR_CONTRACT_ID_XWL.QUERY_LEDGER_ID.setValue(pay_data.LEDGER_ID);\n      app.AR_CONTRACT_ID_XWL.QUERY_CUSTOMER_ID.setValue(pay_data.CUSTOMER_ID);\n      app.BANK_ACCOUNT_XWL.QUERY_LEDGER_ID.setValue(pay_data.LEDGER_ID);\n      app.SALE_ACC_ID_XWL.QUERY_LEDGER_ID.setValue(pay_data.LEDGER_ID);\n      //加载表格\n      app.grid.store.load();\n      Wb.recordFormData = Wb.encode(Wb.getValue(app.form1));//记录表单数据\n    }\n    \n    \n    \n  }// initWin\n});\n\n\n/*赋值*/\nfunction setJsonToValues(arPayH){\n  //app.LEDGER_ID_XWL.LEDGER_ID.setValue(arPayH.LEDGER_ID);\n  app.LEDGER_ID_XWL.LEDGER_NAME.setValue(arPayH.LEDGER_NAME);\n  app.AR_DOC_CAT_CODE.setValue(arPayH.AR_DOC_CAT_CODE);\n  app.AR_PAY_H_CODE.setValue(arPayH.AR_PAY_H_CODE);\n  app.GL_DATE.setValue(Wb.strToDate(arPayH.GL_DATE));\n  app.CUSTOM_ID_XWL.CUSTOMER_ID.setValue(arPayH.CUSTOMER_ID);\n  app.CUSTOM_ID_XWL.CUSTOMER_NAME.setValue(arPayH.CUSTOMER_NAME);\n  app.DEPT_ID_XWL.DEPT_ID.setValue(arPayH.DEPT_ID);\n  app.DEPT_ID_XWL.DEPT_NAME.setValue(arPayH.DEPT_NAME);\n  app.PROJECT_ID_XWL.PROJECT_ID.setValue(arPayH.PROJECT_ID);\n  app.PROJECT_ID_XWL.PROJECT_NAME.setValue(arPayH.PROJECT_NAME);\n  app.AR_CONTRACT_ID_XWL.AR_CONTRACT_ID.setValue(arPayH.AR_CONTRACT_ID);\n  app.AR_CONTRACT_ID_XWL.AR_CONTRACT_NAME.setValue(arPayH.AR_CONTRACT_NAME);\n  app.SOURCE.setValue(arPayH.SOURCE);\n  app.DESCRIPTION.setValue(arPayH.DESCRIPTION);\n  app.PAY_TYPE_ID.setValue(arPayH.PAY_TYPE_ID);\n  app.PAY_TYPE_NAME.setValue(arPayH.PAY_TYPE_NAME);\n  if(arPayH.MODE_TYPE == 'bank'){\n    app.BANK_ACCOUNT_XWL.DEPOSIT_BANK_NAME.setReadOnly(false);\n  }else{\n    app.BANK_ACCOUNT_XWL.DEPOSIT_BANK_NAME.setReadOnly(true);\n  }\n  app.PAY_NO.setValue(arPayH.PAY_NO);\n  app.PAY_DATE.setValue(Wb.strToDate(arPayH.PAY_DATE));\n  app.AMOUNT.setValue(arPayH.AMOUNT);\n  app.BANK_ACCOUNT_XWL.DEPOSIT_BANK_ID.setValue(arPayH.BANK_ACCOUNT);\n  app.BANK_ACCOUNT_XWL.DEPOSIT_BANK_NAME.setValue(arPayH.ACCOUNT_NAME);\n  app.SALE_ACC_ID_XWL.PAY_ACC_ID.setValue(arPayH.SALE_ACC_ID);\n  app.SALE_ACC_ID_XWL.PAY_ACC_NAME.setValue(arPayH.SALE_ACC_NAME);\n  app.CA_ID_XWL.CA_ID.setValue(arPayH.CA_ID);\n  app.CA_ID_XWL.CA_NAME.setValue(arPayH.CA_NAME);\n  app.CREATED_BY.setValue(arPayH.CREATED_BY);\n  app.CREATED_BY_NAME.setValue(arPayH.CREATED_BY_NAME);\n  app.SIGNATORY_ID.setValue(arPayH.SIGNATORY_ID);\n  app.SIGNATORY.setValue(arPayH.SIGNATORY);\n  app.V_HEAD_ID.setValue(arPayH.V_HEAD_ID);\n  app.V_STATUS.setValue(arPayH.V_STATUS);\n  var v_status_name = '';\n  if(arPayH.V_STATUS == '1'){\n    v_status_name = \"{#CG#}\";//草稿\n  }else if(arPayH.V_STATUS == '3'){\n    v_status_name = \"{#SHTG#}\";//审核通过\n  }\n  app.V_STATUS_NAME.setValue(v_status_name);\n}\n\n/*改变页面视图*/\nfunction changeView1(status){//\n  if(status == 'xz'){\n    app.addBtn.setDisabled(false);//新增按钮\n    app.saveBtn.setDisabled(false);//保存按钮\n    app.verfyBtn.setDisabled(true);//审核按钮\n    app.cancelVerfyBtn.setDisabled(true);//取消审核按钮\n    app.tbar.setDisabled(false);\n    app.LEDGER_ID_XWL.LEDGER_NAME.setReadOnly(false);//账簿\n    app.CUSTOM_ID_XWL.CUSTOMER_NAME.setReadOnly(false);//客户\n  }else if(status == 'cg'){\n    app.addBtn.setDisabled(false);//新增按钮\n    app.saveBtn.setDisabled(false);//保存按钮\n    app.verfyBtn.setDisabled(false);//审核按钮\n    app.cancelVerfyBtn.setDisabled(true);//取消审核按钮\n    app.tbar.setDisabled(false);\n    app.LEDGER_ID_XWL.LEDGER_NAME.setReadOnly(true);//账簿\n    app.CUSTOM_ID_XWL.CUSTOMER_NAME.setReadOnly(true);//客户\n  }else if(status == 'zd' || status == 'qz'){\n    app.form1Tbar.setDisabled(true);\n    app.tbar.setDisabled(true);\n    app.LEDGER_ID_XWL.LEDGER_NAME.setReadOnly(true);//账簿\n    app.GL_DATE.setReadOnly(true);//入账日期\n    app.CUSTOM_ID_XWL.CUSTOMER_NAME.setReadOnly(true);//客户\n    app.DEPT_ID_XWL.DEPT_NAME.setReadOnly(true);//成本中心\n    app.PROJECT_ID_XWL.PROJECT_NAME.setReadOnly(true);//项目\n    app.AR_CONTRACT_ID_XWL.AR_CONTRACT_NAME.setReadOnly(true);//合同\n    app.DESCRIPTION.setReadOnly(true);//摘要\n    app.PAY_TYPE_NAME.setReadOnly(true);//收款方式\n    app.PAY_NO.setReadOnly(true);//结算号票据\n    app.PAY_DATE.setReadOnly(true);//收款日期\n    app.BANK_ACCOUNT_XWL.DEPOSIT_BANK_NAME.setReadOnly(true);//收款账户\n    app.SALE_ACC_ID_XWL.PAY_ACC_NAME.setReadOnly(true);//收款科目\n    app.CA_ID_XWL.CA_NAME.setReadOnly(true);//现金流名称\n  }else if(status == 'shtg'){\n    app.addBtn.setDisabled(false);//新增按钮\n    app.saveBtn.setDisabled(true);//保存按钮\n    app.verfyBtn.setDisabled(true);//审核按钮\n    app.cancelVerfyBtn.setDisabled(false);//取消审核按钮\n    app.tbar.setDisabled(true);\n    app.LEDGER_ID_XWL.LEDGER_NAME.setReadOnly(true);//账簿\n    app.CUSTOM_ID_XWL.CUSTOMER_NAME.setReadOnly(true);//客户\n  }\n  if(!Wb.isEmpty(Wb.h_ar_inv_gl_h_id)){//从应收单跳转过来时，新增按钮始终不显示\n    app.addBtn.hide();\n  }\n}\n//根据应收单初始化数据\nfunction initArPayByInv(data){\n  //赋值\n  app.LEDGER_ID_XWL.LEDGER_ID.setValue(data.LEDGER_ID);\n  app.LEDGER_ID_XWL.LEDGER_NAME.setValue(data.LEDGER_NAME);\n  app.LEDGER_ID_XWL.LEDGER_NAME.setReadOnly(true);\n  app.CUSTOM_ID_XWL.CUSTOMER_ID.setValue(data.CUSTOMER_ID);\n  app.CUSTOM_ID_XWL.CUSTOMER_NAME.setValue(data.CUSTOMER_NAME);\n  app.CUSTOM_ID_XWL.CUSTOMER_NAME.setReadOnly(true);\n  app.DEPT_ID_XWL.DEPT_ID.setValue(data.DEPT_ID);\n  app.DEPT_ID_XWL.DEPT_NAME.setValue(data.DEPT_NAME);\n  app.PROJECT_ID_XWL.PROJECT_ID.setValue(data.PROJECT_ID);\n  app.PROJECT_ID_XWL.PROJECT_NAME.setValue(data.PROJECT_NAME);\n  app.AR_CONTRACT_ID_XWL.AR_CONTRACT_ID.setValue(data.AR_CONTRACT_ID);\n  app.AR_CONTRACT_ID_XWL.AR_CONTRACT_NAME.setValue(data.AR_CONTRACT_NAME);\n  app.AR_CONTRACT_ID_XWL.AR_CONTRACT_NAME.setReadOnly(true);\n  \n  //\n  app.DESCRIPTION.setValue(data.DESCRIPTION);\n  app.GL_DATE.setValue(new Date());\n  app.PAY_DATE.setValue(new Date());\n  //制单人\n  app.CREATED_BY.setValue('{#XIP.userId#}');\n  app.CREATED_BY_NAME.setValue('{#XIP.empName#}');\n  //单据类型\n  app.AR_DOC_CAT_CODE.setValue(Wb.docCatCode);\n  //picker查询条件赋值\n  app.CUSTOM_ID_XWL.QUERY_LEDGER_ID.setValue(data.LEDGER_ID);\n  app.DEPT_ID_XWL.QUERY_LEDGER_ID.setValue(data.LEDGER_ID);\n  app.PROJECT_ID_XWL.QUERY_LEDGER_ID.setValue(data.LEDGER_ID);\n  app.PROJECT_ID_XWL.QUERY_DEPT_ID.setValue(data.DEPT_ID);\n  app.AR_CONTRACT_ID_XWL.QUERY_LEDGER_ID.setValue(data.LEDGER_ID);\n  app.AR_CONTRACT_ID_XWL.QUERY_CUSTOMER_ID.setValue(data.CUSTOMER_ID);\n  app.BANK_ACCOUNT_XWL.QUERY_LEDGER_ID.setValue(data.LEDGER_ID);\n  app.SALE_ACC_ID_XWL.QUERY_LEDGER_ID.setValue(data.LEDGER_ID);\n}\n\n//整理必填项\nfunction initAllowBank(){\n  app.LEDGER_ID_XWL.LEDGER_NAME.allowBank = false;\n  app.GL_DATE.allowBlank = false;\n  app.CUSTOM_ID_XWL.CUSTOMER_NAME.allowBlank = false;\n  app.DEPT_ID_XWL.DEPT_NAME.allowBlank = false;\n  if(Wb.docCatCode == 'SKD_YUSK' || Wb.docCatCode == 'SKD_YUSK-H'){\n    app.AR_CONTRACT_ID_XWL.AR_CONTRACT_NAME.setFieldLabel(\"<font color='red'>*<\/font>{#AR_CONTRACT_NAME#}\");\n    app.AR_CONTRACT_ID_XWL.AR_CONTRACT_NAME.allowBlank = false;\n  }else{\n    app.AR_CONTRACT_ID_XWL.AR_CONTRACT_NAME.setFieldLabel(\"{#AR_CONTRACT_NAME#}\");\n    app.AR_CONTRACT_ID_XWL.AR_CONTRACT_NAME.allowBlank = true;\n  }\n  app.DESCRIPTION.allowBlank = false;\n  app.PAY_TYPE_NAME.allowBlank = false;\n  app.PAY_DATE.allowBlank = false;\n  app.SALE_ACC_ID_XWL.PAY_ACC_NAME.allowBlank = false;\n  //账户（收款方式为银行结算时）,不在此处处理\n  \n}\n//给项目置灰\nfunction setProjectDisabled(flag){\n  app.PROJECT_ID_XWL.PROJECT_NAME.setReadOnly(flag);\n}\n\n//判断单据是否被修改过\nfunction whetherModified(){\n  var a = Wb.encode(Wb.getValue(app.form1));//记录表单数据\n  if(a != Wb.recordFormData){//判断表单数据是否相等\n    return true;\n  }\n  var count1 = app.grid.getStore().getModifiedRecords().length;//被修改的记录数\n  if(count1 > 0){\n    return true;\n  }\n  var count2 = app.grid.getStore().getRemovedRecords().length;//被删除的记录数\n  if(count2 > 0){\n    return true;\n  }\n  return false;\n}\n\n\n/*picker返回值*/\nfunction returnRowFn(rec,type){\n  if(type == 'xc_gl_ledgers'){//账簿\n    updateGlDATEMinValue(rec.data.LEDGER_ID);//设置业务日期最小值\n    //客户\n    app.CUSTOM_ID_XWL.QUERY_LEDGER_ID.setValue(rec.data.LEDGER_ID);\n    app.CUSTOM_ID_XWL.CUSTOMER_ID.reset();\n    app.CUSTOM_ID_XWL.CUSTOMER_NAME.reset();\n    //部门\n    app.DEPT_ID_XWL.QUERY_LEDGER_ID.setValue(rec.data.LEDGER_ID);\n    app.DEPT_ID_XWL.DEPT_ID.reset();\n    app.DEPT_ID_XWL.DEPT_NAME.reset();\n    //项目\n    app.PROJECT_ID_XWL.QUERY_LEDGER_ID.setValue(rec.data.LEDGER_ID);\n    app.PROJECT_ID_XWL.QUERY_DEPT_ID.reset();\n    app.PROJECT_ID_XWL.PROJECT_ID.reset();\n    app.PROJECT_ID_XWL.PROJECT_NAME.reset();\n    //应收合同\n    app.AR_CONTRACT_ID_XWL.QUERY_LEDGER_ID.setValue(rec.data.LEDGER_ID);\n    app.AR_CONTRACT_ID_XWL.QUERY_CUSTOMER_ID.reset();\n    app.AR_CONTRACT_ID_XWL.AR_CONTRACT_ID.reset();\n    app.AR_CONTRACT_ID_XWL.AR_CONTRACT_NAME.reset();\n    //账户\n    app.BANK_ACCOUNT_XWL.QUERY_LEDGER_ID.setValue(rec.data.LEDGER_ID);\n    app.BANK_ACCOUNT_XWL.DEPOSIT_BANK_ID.reset();\n    app.BANK_ACCOUNT_XWL.DEPOSIT_BANK_NAME.reset();\n    //收款科目\n    app.SALE_ACC_ID_XWL.QUERY_LEDGER_ID.setValue(rec.data.LEDGER_ID);\n    app.SALE_ACC_ID_XWL.PAY_ACC_ID.reset();\n    app.SALE_ACC_ID_XWL.PAY_ACC_NAME.reset();\n    //现金流科目\n  }else if(type == 'xc_ar_customers'){\n    app.AR_CONTRACT_ID_XWL.QUERY_CUSTOMER_ID.setValue(rec.data.CUSTOMER_ID);//合同\n    app.AR_CONTRACT_ID_XWL.AR_CONTRACT_ID.reset();\n    app.AR_CONTRACT_ID_XWL.AR_CONTRACT_NAME.reset();\n  }else if(type == 'xip_pub_depts'){//成本中心\n    //项目\n    app.PROJECT_ID_XWL.QUERY_DEPT_ID.setValue(rec.data.DEPT_ID);\n    app.PROJECT_ID_XWL.PROJECT_ID.reset();\n    app.PROJECT_ID_XWL.PROJECT_NAME.reset();\n  }else if(type == 'xc_pm_projects'){\n    if(Wb.isEmpty(app.DEPT_ID_XWL.DEPT_ID.getValue())){\n      app.DEPT_ID_XWL.DEPT_ID.setValue(rec.data.DEPT_ID);\n      app.DEPT_ID_XWL.DEPT_NAME.setValue(rec.data.DEPT_NAME);\n      app.PROJECT_ID_XWL.QUERY_DEPT_ID.setValue(rec.data.DEPT_ID);\n    }\n  }else if(type == 'xc_ar_contract'){\n    if(Wb.isEmpty(app.CUSTOM_ID_XWL.CUSTOMER_ID.getValue())){\n      app.CUSTOM_ID_XWL.CUSTOMER_ID.setValue(rec.data.CUSTOMER_ID);\n      app.CUSTOM_ID_XWL.CUSTOMER_NAME.setValue(rec.data.CUSTOMER_NAME);\n      app.AR_CONTRACT_ID_XWL.QUERY_CUSTOMER_ID.setValue(rec.data.CUSTOMER_ID);\n    }\n  }else if(type == 'xc_gl_ld_deposit_bank'){//账户\n    app.SALE_ACC_ID_XWL.PAY_ACC_ID.setValue(rec.data.ACC_ID);\n    app.SALE_ACC_ID_XWL.PAY_ACC_NAME.setValue(rec.data.ACC_NAME);\n  }\n}\n\n/*重新选择某一个值时，相应的值要发生改变*/\nfunction clearOtherFn(type){\n  if(type == 'xc_gl_ledgers'){//清空账簿后\n    //客户\n    app.CUSTOM_ID_XWL.QUERY_LEDGER_ID.reset();\n    app.CUSTOM_ID_XWL.CUSTOMER_ID.reset();\n    app.CUSTOM_ID_XWL.CUSTOMER_NAME.reset();\n    //部门\n    app.DEPT_ID_XWL.QUERY_LEDGER_ID.reset();\n    app.DEPT_ID_XWL.DEPT_ID.reset();\n    app.DEPT_ID_XWL.DEPT_NAME.reset();\n    //项目\n    app.PROJECT_ID_XWL.QUERY_LEDGER_ID.reset();\n    app.PROJECT_ID_XWL.QUERY_DEPT_ID.reset();\n    app.PROJECT_ID_XWL.PROJECT_ID.reset();\n    app.PROJECT_ID_XWL.PROJECT_NAME.reset();\n    //应收合同\n    app.AR_CONTRACT_ID_XWL.QUERY_LEDGER_ID.reset();\n    app.AR_CONTRACT_ID_XWL.QUERY_CUSTOMER_ID.reset();\n    app.AR_CONTRACT_ID_XWL.AR_CONTRACT_ID.reset();\n    app.AR_CONTRACT_ID_XWL.AR_CONTRACT_NAME.reset();\n    //账户\n    app.BANK_ACCOUNT_XWL.QUERY_LEDGER_ID.reset();\n    app.BANK_ACCOUNT_XWL.DEPOSIT_BANK_ID.reset();\n    app.BANK_ACCOUNT_XWL.DEPOSIT_BANK_NAME.reset();\n    //收款科目\n    app.SALE_ACC_ID_XWL.QUERY_LEDGER_ID.reset();\n    app.SALE_ACC_ID_XWL.PAY_ACC_ID.reset();\n    app.SALE_ACC_ID_XWL.PAY_ACC_NAME.reset();\n    //现金流科目\n  }else if(type == 'xc_ar_customers'){//清空客户后\n    //清空合同相关\n    app.AR_CONTRACT_ID_XWL.QUERY_CUSTOMER_ID.reset();\n    app.AR_CONTRACT_ID_XWL.AR_CONTRACT_ID.reset();\n    app.AR_CONTRACT_ID_XWL.AR_CONTRACT_NAME.reset();\n  }else if(type == 'xip_pub_depts'){//清空部门后\n    //清空项目相关\n    app.PROJECT_ID_XWL.QUERY_DEPT_ID.reset();\n    app.PROJECT_ID_XWL.PROJECT_ID.reset();\n    app.PROJECT_ID_XWL.PROJECT_NAME.reset();\n  }else if(type == 'xc_gl_ld_deposit_bank'){//清空账户后\n    app.SALE_ACC_ID_XWL.PAY_ACC_ID.reset();\n    app.SALE_ACC_ID_XWL.PAY_ACC_NAME.reset();\n  }\n}\n","initialize":"/*\n  修改业务日期最小值（业务日期不可小于账簿开始会计期）\n  参数是账簿id\n*/\nfunction updateGlDATEMinValue(ledgerId){\n  Wb.request({\n    async : false,\n    url : 'm?xwl=xc/ap/pay/DB/selectLedgerStartDate',\n    params : {LEDGER_ID : ledgerId},\n    success : function(resp){\n\n      var startDate = Wb.decode(resp.responseText).START_DATE;\n      if(!Wb.isEmpty(startDate)){\n        app.GL_DATE.setMinValue(Wb.strToDate(startDate));\n      }else{\n        app.GL_DATE.setMinValue();\n      }\n      \n    }\n  });\n}\n"},"children":[{"configs":{"itemId":"form1Tbar"},"children":[{"configs":{"text":"{#addBtn#}","itemId":"addBtn","iconCls":"refresh_icon"},"events":{"click":"//新增时初始化单据,单据类型不发生改变\nWb.docStatus = 'xz'; // 单据状态 新增\nWb.ar_pay_h_id = '';//收款单id\nWb.v_head_id = '';//凭证id\nWb.h_ar_inv_gl_h_id = '';//应收单id\n\n//app.PAY_TYPE_NAME.store.load();\n\napp.form1.getForm().reset();\napp.form2.getForm().reset();\napp.grid.store.removeAll();\n\n\n//改变界面视图\nchangeView1(Wb.docStatus);\n//项目置白\nsetProjectDisabled(false);\n\nif(Wb.docCatCode == 'SKD_JSK'){\n\n  app.SOURCE.setValue('GL_L');\n\n}else if(Wb.docCatCode == 'SKD_JSK-H'){\n\n  app.SOURCE.setValue('GL_H');\n\n}else if(Wb.docCatCode == 'SKD_YUSK'){//预收款（红蓝）合同为必填项\n\n  app.SOURCE.setValue('TEMP');\n\n}else if(Wb.docCatCode == 'SKD_YUSK-H'){\n\n  app.SOURCE.setValue('PAY_L');\n  app.SOURCE.setReadOnly(false);\n\n}else if(Wb.docCatCode == 'SKD_QTSK'){\n\n  app.SOURCE.setValue('TEMP');\n\n}else if(Wb.docCatCode == 'SKD_QTSK-H'){\n\n  app.SOURCE.setValue('TEMP');\n\n}\n\nvar store = app.LEDGER_ID_XWL.LEDGER_NAME.getPicker().getStore();\nstore.load({\n  scope:this,\n  callback:function(records,operation,success){\n    if(success){\n      //账簿\n      app.LEDGER_ID_XWL.LEDGER_ID.setValue(records[0].data.LEDGER_ID);\n      app.LEDGER_ID_XWL.LEDGER_NAME.setValue(records[0].data.LEDGER_NAME);\n      returnRowFn(records[0],'xc_gl_ledgers');\n      clearOtherFn('xc_gl_ledgers');\n      //入账日期、收款日期\n      app.GL_DATE.setValue(new Date());\n      app.PAY_DATE.setValue(new Date());\n      //制单人\n      app.CREATED_BY.setValue('{#XIP.userId#}');\n      app.CREATED_BY_NAME.setValue('{#XIP.empName#}');\n      //单据类型\n      app.AR_DOC_CAT_CODE.setValue(Wb.docCatCode);\n      //加载表格\n      app.grid.store.load();\n    }\n  }\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#saveBtn#}","itemId":"saveBtn","iconCls":"save_icon"},"events":{"click":"\nif(app.grid.store.getCount() === 0){\n  Wb.toast('{#QTJMXSJ#}'); // 请添加明细数据!\n  return ;\n}\nif(!Wb.verifyGrid(app.grid)){\n  return ;\n}\nif (!Wb.verify(app.form1)) {\n  Wb.toast('{#BDCZFKXHSJBHF#}'); //表单存在非空项或者输入的数据不合法！\n  return;\n}\n\n//计算金额\nvar srcAmt = 0;\nvar store = app.grid.getStore();\nfor(var i = 0 ; i < store.getCount() ; i++){\n  srcAmt += store.getAt(i).data.AMOUNT;\n}\n\napp.AMOUNT.setValue(srcAmt);\n\n\n//处理行部门、合同、项目、摘要\nfor(var i=0; i<app.grid.store.getCount(); i++){\n  var rec = app.grid.store.getAt(i);\n  rec.set('DEPT_ID',app.DEPT_ID_XWL.DEPT_ID.getValue());\n  rec.set('AR_CONTRACT_ID',app.AR_CONTRACT_ID_XWL.AR_CONTRACT_ID.getValue());\n  if(Wb.isEmpty(rec.get('DESCRIPTION'))){\n    rec.set('DESCRIPTION',app.DESCRIPTION.getValue());\n  }\n  if(Wb.docCatCode == 'SKD_YUSK' || Wb.docCatCode == 'SKD_YUSK-H'){\n    rec.set('PROJECT_ID',app.PROJECT_ID_XWL.PROJECT_ID.getValue());\n    rec.set('PROJECT_NAME',app.PROJECT_ID_XWL.PROJECT_NAME.getValue());\n  }\n}\n//获取应收款主信息数据\nvar arPayHJson = {\n  AR_PAY_H_ID\t\t:Wb.ar_pay_h_id,\n  AR_PAY_H_CODE\t\t:app.AR_PAY_H_CODE.getValue(),\n  AR_DOC_CAT_CODE\t:app.AR_DOC_CAT_CODE.getValue(),\n  LEDGER_ID\t\t\t:app.LEDGER_ID_XWL.LEDGER_ID.getValue(),\n  GL_DATE\t\t\t:app.GL_DATE.getValue(),\n  CUSTOMER_ID\t\t:app.CUSTOM_ID_XWL.CUSTOMER_ID.getValue(),\n  PROJECT_ID\t\t:app.PROJECT_ID_XWL.PROJECT_ID.getValue(),\n  DEPT_ID\t\t\t:app.DEPT_ID_XWL.DEPT_ID.getValue(),\n  AR_CONTRACT_ID\t:app.AR_CONTRACT_ID_XWL.AR_CONTRACT_ID.getValue(),\n  AMOUNT\t\t\t:app.AMOUNT.getValue(),\n  SOURCE\t\t\t:app.SOURCE.getValue(),\n  DESCRIPTION\t\t:app.DESCRIPTION.getValue(),\n  PAY_TYPE\t\t\t:app.PAY_TYPE_ID.getValue(),\n  PAY_NO\t\t\t:app.PAY_NO.getValue(),\n  PAY_DATE\t\t\t:app.PAY_DATE.getValue(),\n  SALE_ACC_ID\t\t:app.SALE_ACC_ID_XWL.PAY_ACC_ID.getValue(),\n  SALE_CCID\t\t\t:'',\n  CA_ID\t\t\t\t:app.CA_ID_XWL.CA_ID.getValue(),\n  BANK_ACCOUNT\t\t:app.BANK_ACCOUNT_XWL.DEPOSIT_BANK_ID.getValue()\n};\n//获取行数据\nvar newRecs = store.getNewRecords();\nvar updateRecs = store.getUpdatedRecords();\nvar deleteRecs = store.getRemovedRecords();\n\nvar opType = '';\nif(Wb.docStatus == 'xz'){\n  opType = 'Y';\n}else{\n  opType = 'N';\n}\n\n//保存单据\nWb.request({\n  url:'{#contextPath#}/arPayAction.do?method=saveArPay',\n  params:{\n    opType : opType,\n    arPayHJson : arPayHJson,\n    newRecs : Wb.getData(newRecs),\n    updateRecs : Wb.getData(updateRecs),\n    deleteRecs : Wb.getData(deleteRecs)\n  },\n  success:function(resp){\n    var obj = Wb.decode(resp.responseText);\n    if(obj.flag == '0'){\n      Wb.toast(obj.msg);\n      Wb.ar_pay_h_id = obj.AR_PAY_H_ID;\n      app.AR_PAY_H_CODE.setValue(obj.AR_PAY_H_CODE);\n      Wb.v_head_id = obj.V_HEAD_ID;\n      Wb.docStatus = 'cg';\n      app.V_HEAD_ID = obj.V_HEAD_ID;\n      app.V_STATUS.setValue('1');\n      app.V_STATUS_NAME.setValue(\"{#CG#}\");//草稿\n      app.grid.getStore().load();\n      changeView1(Wb.docStatus);//改变界面视图\n//       app.verfyBtn.setDisabled(false);//审核按钮\n//       app.cancelVerfyBtn.setDisabled(true);//取消审核按钮\n//       app.LEDGER_ID_XWL.LEDGER_NAME.setReadOnly(true);//账簿\n//       app.CUSTOM_ID_XWL.CUSTOMER_NAME.setReadOnly(true);//客户\n//       app.AR_CONTRACT_ID_XWL.AR_CONTRACT_NAME.setReadOnly(true);//合同\n      Wb.recordFormData = Wb.encode(Wb.getValue(app.form1));//记录表单数据\n    }else{\n      Wb.toast(obj.msg);\n    }\n    \n  }\n});\n\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#verfyBtn#}","itemId":"verfyBtn","iconCls":"user_edit_icon"},"events":{"click":"//验证单据是否被修改\nif(whetherModified()){\n  Wb.toast(\"{#djybxgqxbcdj#}\");//单据已被修改，请先保存单据！\n  return false;\n}\n\n\nvar docs = [];//复合审核条件的单据\n\ndocs.push({\n  arId : Wb.ar_pay_h_id,\n  arCatCode : 'SKD'\n});\n\n\nif(docs.length > 0 ){\n  Wb.request({\n    url : '{#contextPath#}/arDocsAction.do?method=checkArVoucher',\n    params : {arInfo : docs},\n    success : function(resp){\n      var obj = Wb.decode(resp.responseText);\n      if(obj.flag == '0'){\n        Wb.docStatus = 'shtg';\n        app.V_STATUS.setValue('3');\n        app.V_STATUS_NAME.setValue(\"{#SHTG#}\");//审核通过\n        changeView1(Wb.docStatus);//改变界面视图\n//         app.saveBtn.setDisabled(true);//保存按钮\n//         app.verfyBtn.setDisabled(true);//审核按钮\n//         app.cancelVerfyBtn.setDisabled(false);//取消审核按钮\n//         app.tbar.setDisabled(true);\n      }\n      Wb.toast(obj.msg);\n    }\n  });\n}else{\n  Wb.toast('{#GDJYSHTG#}');//该单据已审核通过！\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#cancelVerfyBtn#}","itemId":"cancelVerfyBtn","iconCls":"user_delete_icon"},"events":{"click":"\nvar docs = [];//可以取消审核的单据\n\ndocs.push({\n  arId : Wb.ar_pay_h_id,\n  arCatCode : 'SKD'\n});\n\n\nif(docs.length > 0){\n  Wb.request({\n    url: '{#contextPath#}/arDocsAction.do?method=cancelCheckArVoucher',\n    params: {arInfo: docs},\n    success: function(resp) {\n      var obj = Wb.decode(resp.responseText);\n      if(obj.flag == '0'){\n        Wb.docStatus = 'cg';\n        app.V_STATUS.setValue('1');\n        app.V_STATUS_NAME.setValue(\"{#CG#}\");//草稿\n        changeView1(Wb.docStatus);//改变界面视图\n//         app.addBtn.setDisabled(false);//新增按钮\n//         app.saveBtn.setDisabled(false);//保存按钮\n//         app.verfyBtn.setDisabled(false);//审核按钮\n//         app.cancelVerfyBtn.setDisabled(true);//取消审核按钮\n      }\n      Wb.toast(obj.msg);\n    }\n  });\n}else{\n  Wb.toast('{#QXZWSHTGDJL#}');//请选择未审核的记录！\n}"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"maximized":"true","layout":"fit","closeAction":"hide","itemId":"window"},"events":{"close":"app.hideFun();"},"children":[{"configs":{"itemId":"tabs"},"events":{"beforetabchange":"//加载凭证信息\nif(newCard.title === app.edit_v_xwl.xwl_v_panel.title){\n    Wb.request({\n        url: 'm?xwl=xc/gl/journal/data-db/common-data/select-v-head',\n        params: {'headId' : Wb.v_head_id},\n        success: function(resp) {\n            var headJson = Wb.decode(resp.responseText);\n            Wb.setValue(app.edit_v_xwl.form1,headJson);\n            Wb.setValue(app.edit_v_xwl.bbar,headJson);\n            //处理会计日期\n            var accDate = headJson.accountDate;\n            app.edit_v_xwl.accountDate.setValue(Wb.strToDate(accDate));\n        }\n    });\n    // 加载凭证分录行\n    app.edit_v_xwl.grid1.getStore().load({params :{'headId':Wb.v_head_id}});\n}\n"},"children":[{"configs":{"title":"{#TABEL1TITLE#}","layout":"border","itemId":"tab1"},"children":[{"configs":{"tbar":"app.form1Tbar","region":"north","autoScroll":"true","layout":"auto","itemId":"form1","border":"false"},"children":[{"configs":{"margin":"10 0 20 0","html":"<font size = '5' color = 'black'>{#title_skd#}<\/font>","labelAlign":"center","itemId":"title_skd"},"children":[],"expanded":false,"type":"label"},{"configs":{"margin":"10 0 20 0","html":"<font size = '5' color = 'red'>{#title_tkd#}<\/font>","labelAlign":"center","itemId":"title_tkd"},"children":[],"expanded":false,"type":"label"},{"configs":{"layout":"column","margin":"10 10 0 10","border":"false","itemId":"tr1"},"children":[{"configs":{"layout":"fit","columnWidth":".25","border":"false","itemId":"tr1_td1"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/LEDGER_ID_PICK/LEDGER_ID_PICK_SEC","itemId":"LEDGER_ID_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".25","border":"false","itemId":"tr1_td2"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","allowBlank":"false","labelAlign":"right","pickList":"[\n  ['SKD_JSK','{#SKD_JSK#}'],\n  ['SKD_YUSK','{#SKD_YUSK#}'],\n  ['SKD_QTSK','{#SKD_QTSK#}'],\n  ['SKD_JSK-H','{#SKD_JSK-H#}'],\n  ['SKD_YUSK-H','{#SKD_YUSK-H#}'],\n  ['SKD_QTSK-H','{#SKD_QTSK-H#}']\n]","itemId":"AR_DOC_CAT_CODE","fieldLabel":"<font color='red'>*<\/font>{#AR_DOC_CAT_CODE#}"},"events":{"change":"if(newValue=='FKD_CGJS-H'||newValue=='FKD_YUFK-H'||newValue=='FKD_QTFK-H'){\n\tapp.title.setText('<font style=\"color:red;\">付款单<\/font>',false);\n    app.AMOUNT.setFieldStyle('color:red;');\n}\nif(newValue === 'FKD_YUFK' || newValue === 'FKD_YUFK-H'){\n\tapp.AP_CONTRACT_ID_XWL.AP_CONTRACT_NAME.setFieldLabel('<font style=\"color:red;\">*<\/font>'+'合同名称');\n    app.AP_CONTRACT_ID_XWL.AP_CONTRACT_NAME.allowBlank = false;\n}"},"children":[],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".25","border":"false","itemId":"tr1_td3"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","emptyText":"{#EMPTY_TEXT#}","labelAlign":"right","itemId":"AR_PAY_H_CODE","fieldLabel":"<font color='red'>*<\/font>{#AR_PAY_H_CODE#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".25","border":"false","itemId":"tr1_td4"},"children":[{"configs":{"labelWidth":"80","allowBlank":"false","labelAlign":"right","itemId":"GL_DATE","fieldLabel":"<font color='red'>*<\/font>{#GL_DATE#}"},"children":[],"expanded":false,"type":"date"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"layout":"column","margin":"10 10 0 10","border":"false","itemId":"tr2"},"children":[{"configs":{"layout":"fit","columnWidth":".25","border":"false","itemId":"tr2_td1"},"children":[{"configs":{"file":"m?xwl=xc/ar/ar-com-lov/AR_CUSTOMER_ID_PICK/AR_CUSTOMER_ID_PICK","itemId":"CUSTOM_ID_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".25","border":"false","itemId":"tr2_td2"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/DEPT_ID_PICK/DEPT_ID_LD","itemId":"DEPT_ID_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".25","border":"false","itemId":"tr2_td3"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/PROJECT_ID_PICK/PROJECT_ID_LD","itemId":"PROJECT_ID_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".25","border":"false","itemId":"tr2_td31"},"children":[{"configs":{"file":"m?xwl=xc/ar/ar-com-lov/AR_CONTRACT_ID_PICK/AR_CONTRACT_ID_PICK_ALL","itemId":"AR_CONTRACT_ID_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"layout":"column","margin":"10 10 0 10","border":"false","itemId":"tr3"},"children":[{"configs":{"layout":"fit","columnWidth":".25","border":"false","itemId":"tr3_td1"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","allowBlank":"false","pickList":"[\n  ['GL_L','{#GL_L#}'],\n  ['GL_H','{#GL_H#}'],\n  ['PAY_L','{#PAY_L#}'],\n  ['TEMP','{#TEMP#}']\n]","labelAlign":"right","itemId":"SOURCE","fieldLabel":"<font color = 'red'>*<\/font>{#SOURCE#}"},"events":{"change":"if(Wb.docCatCode == 'SKD_YUSK-H' && newValue == 'PAY_L'){\n  app.selectArPayBtn4.show();\n  app.addTempBtn4.hide();\n}else if(Wb.docCatCode == 'SKD_YUSK-H' && newValue == 'TEMP'){\n  app.selectArPayBtn4.hide();\n  app.addTempBtn4.show();\n}"},"children":[],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".5","border":"false","itemId":"tr3_td2"},"children":[{"configs":{"labelWidth":"80","allowBlank":"false","labelAlign":"right","itemId":"DESCRIPTION","fieldLabel":"<font color = 'red'>*<\/font>{#DESCRIPTION#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"title":"{#FIELDSET1_TITLE#}","layout":"fit","itemId":"fieldset1"},"children":[{"configs":{"layout":"column","margin":"0 0 10 0","border":"false","itemId":"f2_tr1"},"children":[{"configs":{"layout":"form","columnWidth":".25","border":"false","itemId":"f2_tr1_td1"},"children":[{"configs":{"itemId":"PAY_TYPE_ID"},"children":[],"expanded":false,"type":"hidden"},{"configs":{"labelWidth":"80","allowBlank":"false","displayField":"MODE_NAME","valueField":"MODE_NAME","labelAlign":"right","itemId":"PAY_TYPE_NAME","fieldLabel":"<font color='red'>*<\/font>{#PAY_TYPE_NAME#}","editable":"false"},"events":{"change":"\n","select":"var rec = records[0];\napp.PAY_TYPE_ID.setValue(rec.data.MODE_ID);\n\nif(rec.data.MODE_TYPE == 'bank' && (Wb.docStatus == 'xz' || Wb.docStatus == 'cg')){\n  app.BANK_ACCOUNT_XWL.DEPOSIT_BANK_NAME.setReadOnly(false);\n  app.BANK_ACCOUNT_XWL.DEPOSIT_BANK_NAME.allowBank = false;\n  app.BANK_ACCOUNT_XWL.DEPOSIT_BANK_NAME.setFieldLabel(\"<font color='red'>*<\/font>{#ACCOUNT_NAME#}\");\n  app.SALE_ACC_ID_XWL.PAY_ACC_ID.reset();\n  app.SALE_ACC_ID_XWL.PAY_ACC_NAME.reset();\n\n}else{\n  app.BANK_ACCOUNT_XWL.DEPOSIT_BANK_NAME.setReadOnly(true);\n  app.BANK_ACCOUNT_XWL.DEPOSIT_BANK_NAME.allowBank = true;\n  app.BANK_ACCOUNT_XWL.DEPOSIT_BANK_NAME.setFieldLabel(\"{#ACCOUNT_NAME#}\");\n  app.BANK_ACCOUNT_XWL.DEPOSIT_BANK_ID.reset();\n  app.BANK_ACCOUNT_XWL.DEPOSIT_BANK_NAME.reset();\n  app.SALE_ACC_ID_XWL.PAY_ACC_ID.setValue(rec.data.REC_ACC_ID);\n  app.SALE_ACC_ID_XWL.PAY_ACC_NAME.setValue(rec.data.REC_ACC_NAME);\n}\n\n\n\n\n\n\n"},"children":[{"configs":{"autoSync":"false","itemId":"store","url":"m?xwl=xc/ar/pay/DB/payTypeSelect"},"events":{"beforeload":"store.proxy.extraParams.LEDGER_ID = app.LEDGER_ID_XWL.LEDGER_ID.getValue();"},"children":[],"expanded":false,"type":"store"}],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".25","border":"false","itemId":"f2_tr1_td2"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"PAY_NO","fieldLabel":"{#PAY_NO#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".25","border":"false","itemId":"f2_tr1_td3"},"children":[{"configs":{"labelWidth":"80","allowBlank":"false","labelAlign":"right","itemId":"PAY_DATE","fieldLabel":"<font color='red'>*<\/font>{#PAY_DATE#}"},"children":[],"expanded":false,"type":"date"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".25","border":"false","itemId":"f2_tr1_td4"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"AMOUNT","fieldLabel":"<font color = 'red'>*<\/font>{#AMOUNT#}"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"layout":"column","margin":"0 0 10 0","border":"false","itemId":"f2_tr2"},"children":[{"configs":{"layout":"form","columnWidth":".25","border":"false","itemId":"f2_tr2_td1"},"children":[{"configs":{"file":"m?xwl=xc/ar/ar-com-lov/DEPOSIT_BANK_ID_PICK/DEPOSIT_BANK_ID_LD","itemId":"BANK_ACCOUNT_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".25","border":"false","itemId":"f2_tr2_td2"},"children":[{"configs":{"file":"m?xwl=xc/ar/ar-com-lov/ACC_ID_PICK/PAY_ACC_ID_PICK","itemId":"SALE_ACC_ID_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".25","border":"false","itemId":"f2_tr2_td3"},"children":[{"configs":{"file":"m?xwl=xc/ar/ar-com-lov/CA_ID_PICK/CA_ID_PICK_ALL","itemId":"CA_ID_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"fieldset"}],"expanded":true,"type":"form"},{"configs":{"region":"center","pagingBar":"false","hidden":"true","itemId":"grid1"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/ar/pay/DB/select_xc_ar_pay_l"},"events":{"beforeload":"operation.params = {\n  AR_PAY_H_ID : Wb.ar_pay_h_id\n};"},"children":[],"expanded":false,"type":"store"},{"configs":{"normalName":"grid1Tbar","itemId":"tbar"},"children":[{"configs":{"text":"{#selectArInvBtn1#}","itemId":"selectArInvBtn1","iconCls":"seek_icon"},"events":{"click":"var ledger_id = app.LEDGER_ID_XWL.LEDGER_ID.getValue();//账簿id\nvar customer_id = app.CUSTOM_ID_XWL.CUSTOMER_ID.getValue();//客户id\nvar project_id = app.PROJECT_ID_XWL.PROJECT_ID.getValue();//项目\nvar ar_contract_id = app.AR_CONTRACT_ID_XWL.AR_CONTRACT_ID.getValue();//合同\n//判断,过滤条件\nif(Wb.isEmpty(ledger_id)){\n  Wb.toast('{#QXZZB#}');//请选择账簿！\n  return ;\n}\nif(Wb.isEmpty(customer_id)){\n  Wb.toast('{#QXZKH#}');//请选择客户！\n  return ;\n}\nvar curGrid = app.grid1;\nWb.run({\n  url: 'm?xwl=xc/ar/pay/LOV/LOV_SELECT_INV_WIN', \n  success: function(app) {\n    app.initWin({\n      LEDGER_ID : ledger_id,\n      CUSTOMER_ID : customer_id,\n      PROJECT_ID : project_id,\n      AR_CONTRACT_ID : ar_contract_id,\n      AR_CAT_DOC_CODE : 'SKD_JSK',\n      hideFun:function(recs){\n        Ext.each(recs,function(rec){\n          Wb.addEdit(curGrid,{\n            AR_PAY_L_ID : '',\n            AR_PAY_H_ID : Wb.ar_pay_h_id,\n            AR_INV_GL_H_ID : rec.data.AR_INV_GL_H_ID,\n            AR_INV_GL_H_CODE : rec.data.AR_INV_GL_H_CODE,\n            PROJECT_ID : rec.data.PROJECT_ID,\n            PROJECT_NAME : rec.data.PROJECT_NAME,\n            AR_CONTRACT_ID : rec.data.AR_CONTRACT_ID,\n            AR_CONTRACT_NAME : rec.data.AR_CONTRACT_NAME,\n            DEPT_ID : rec.data.DEPT_ID,\n            DEPT_NAME : rec.data.DEPT_NAME,\n            AR_DOC_CAT_CODE : rec.data.AR_DOC_CAT_CODE,\n            AMOUNT : rec.data.JS_AMOUNT,\n            ACC_ID : rec.data.AR_ACC_ID_DEBT,\n            ACC_NAME : rec.data.AR_ACC_NAME_DEBT,\n            CCID : rec.data.AR_CCID_DEBT,\n            CCID_NAME : rec.data.AR_CCID_NAME_DEBT,\n            AR_CREATED_BY_NAME : '{#XIP.empName#}',\n            DESCRIPTION : rec.data.DESCRIPTION\n          }, 'after', 1, false);\n        });\n        setProjectDisabled(true);\n      }\n    });\n    \n  }\n});\n\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#deleteBtn#}","itemId":"deleteBtn1","iconCls":"file_delete_icon"},"events":{"click":"Wb.remove(app.grid1);\n\nif(app.grid.store.getCount() === 0){\n  setProjectDisabled(false);\n}"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#rownum#}","align":"center","xtype":"rownumberer","titleAlign":"center","itemId":"rownum1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#AR_INV_GL_H_CODE_COL#}","width":"150","dataIndex":"AR_INV_GL_H_CODE","titleAlign":"center","itemId":"AR_INV_GL_H_CODE_COL1"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#AR_DOC_CAT_CODE_COL#}","width":"100","dataIndex":"AR_DOC_CAT_CODE","titleAlign":"center","itemId":"AR_DOC_CAT_CODE_COL1","renderer":"if(value == 'YSD'){\n  return '应收单';\n}else if(value == 'YSD-HZ'){\n  return '应收单-红';\n}"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#AR_CONTRACT_NAME_COL#}","width":"150","dataIndex":"AR_CONTRACT_NAME","titleAlign":"center","itemId":"AR_CONTRACT_NAME_COL1"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#DEPT_NAME_COL#}","hidden":"true","width":"150","dataIndex":"DEPT_NAME","titleAlign":"center","itemId":"DEPT_NAME_COL1"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#PROJECT_NAME_COL#}","width":"150","dataIndex":"PROJECT_NAME","titleAlign":"center","itemId":"PROJECT_NAME_COL1"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#ACC_NAME_COL#}","width":"150","dataIndex":"ACC_NAME","titleAlign":"center","itemId":"ACC_NAME_COL1"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#CCID_NAME_COL#}","width":"150","dataIndex":"CCID_NAME","titleAlign":"center","itemId":"CCID_NAME_COL1"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#AMOUNT_COL#}","width":"100","align":"right","dataIndex":"AMOUNT","format":"0,000.00","titleAlign":"center","itemId":"AMOUNT_COL1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#AR_CREATED_BY_NAME_COL#}","hidden":"true","width":"150","dataIndex":"AR_CREATED_BY_NAME","titleAlign":"center","itemId":"AR_CREATED_BY_NAME_COL1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#DESCRIPTION_COL#}","dataIndex":"DESCRIPTION","titleAlign":"center","itemId":"DESCRIPTION_COL1","flex":"1"},"children":[],"expanded":true,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"},{"configs":{"region":"center","pagingBar":"false","hidden":"true","itemId":"grid2"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/ar/pay/DB/select_xc_ar_pay_l"},"events":{"beforeload":"operation.params = {\n  AR_PAY_H_ID : Wb.ar_pay_h_id\n};"},"children":[],"expanded":false,"type":"store"},{"configs":{"normalName":"grid2Tbar","itemId":"tbar"},"children":[{"configs":{"text":"{#selectArInvBtn2#}","itemId":"selectArInvBtn2","iconCls":"seek_icon"},"events":{"click":"var ledger_id = app.LEDGER_ID_XWL.LEDGER_ID.getValue();//账簿id\nvar customer_id = app.CUSTOM_ID_XWL.CUSTOMER_ID.getValue();//客户id\nvar project_id = app.PROJECT_ID_XWL.PROJECT_ID.getValue();//项目\nvar ar_contract_id = app.AR_CONTRACT_ID_XWL.AR_CONTRACT_ID.getValue();//合同\n//判断,过滤条件 账簿 有合同就按合同过滤，没有就算了\nif(Wb.isEmpty(ledger_id)){\n  Wb.toast('{#QXZZB#}');//请选择账簿！\n  return ;\n}\nif(Wb.isEmpty(customer_id)){\n  Wb.toast('{#QXZKH#}');//请选择客户！\n  return ;\n}\nvar curGrid = app.grid2;\nWb.run({\n  url: 'm?xwl=xc/ar/pay/LOV/LOV_SELECT_INV_WIN', \n  success: function(app) {\n    app.initWin({\n      LEDGER_ID : ledger_id,\n      CUSTOMER_ID : customer_id,\n      PROJECT_ID : project_id,\n      AR_CONTRACT_ID : ar_contract_id,\n      AR_CAT_DOC_CODE : 'SKD_JSK-H',\n      hideFun:function(recs){\n        Ext.each(recs,function(rec){\n          Wb.addEdit(curGrid,{\n            AR_PAY_L_ID : '',\n            AR_PAY_H_ID : Wb.ar_pay_h_id,\n            AR_INV_GL_H_ID : rec.data.AR_INV_GL_H_ID,\n            AR_INV_GL_H_CODE : rec.data.AR_INV_GL_H_CODE,\n            PROJECT_ID : rec.data.PROJECT_ID,\n            PROJECT_NAME : rec.data.PROJECT_NAME,\n            AR_CONTRACT_ID : rec.data.AR_CONTRACT_ID,\n            AR_CONTRACT_NAME : rec.data.AR_CONTRACT_NAME,\n            DEPT_ID : rec.data.DEPT_ID,\n            DEPT_NAME : rec.data.DEPT_NAME,\n            AR_DOC_CAT_CODE : rec.data.AR_DOC_CAT_CODE,\n            AMOUNT : rec.data.JS_AMOUNT,\n            ACC_ID : rec.data.AR_ACC_ID_DEBT,\n            ACC_NAME : rec.data.AR_ACC_NAME_DEBT,\n            CCID : rec.data.AR_CCID_DEBT,\n            CCID_NAME : rec.data.AR_CCID_NAME_DEBT,\n            AR_CREATED_BY_NAME : '{#XIP.empName#}',\n            DESCRIPTION : rec.data.DESCRIPTION\n          }, 'after', 1, false);\n        });\n        setProjectDisabled(true);\n      }\n    });\n    \n  }\n});\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#deleteBtn#}","itemId":"deleteBtn2","iconCls":"file_delete_icon"},"events":{"click":"Wb.remove(app.grid2);\n\nif(app.grid.store.getCount() === 0){\n  setProjectDisabled(false);\n}"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#rownum#}","align":"center","xtype":"rownumberer","titleAlign":"center","itemId":"rownum2"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#AR_INV_GL_H_CODE_COL#}","width":"200 ","dataIndex":"AR_INV_GL_H_CODE","titleAlign":"center","itemId":"AR_INV_GL_H_CODE_COL2"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#AR_DOC_CAT_CODE_COL#}","width":"100","dataIndex":"AR_DOC_CAT_CODE","titleAlign":"center","itemId":"AR_DOC_CAT_CODE_COL2","renderer":"if(value == 'YSD'){\n  return '应收单';\n}else if(value == 'YSD-HZ'){\n  return '应收单-红';\n}"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#AR_CONTRACT_NAME_COL#}","width":"150","dataIndex":"AR_CONTRACT_NAME","titleAlign":"center","itemId":"AR_CONTRACT_NAME_COL2"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#DEPT_NAME_COL#}","hidden":"true","width":"150","dataIndex":"DEPT_NAME","titleAlign":"center","itemId":"DEPT_NAME_COL2"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#PROJECT_NAME_COL#}","width":"150","dataIndex":"PROJECT_NAME","titleAlign":"center","itemId":"PROJECT_NAME_COL2"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#ACC_NAME_COL#}","width":"150","dataIndex":"ACC_NAME","titleAlign":"center","itemId":"ACC_NAME_COL2"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#CCID_NAME_COL#}","width":"150","dataIndex":"CCID_NAME","titleAlign":"center","itemId":"CCID_NAME_COL2"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#AMOUNT_COL#}","width":"100","align":"right","dataIndex":"AMOUNT","format":"0,000.00","titleAlign":"center","itemId":"AMOUNT_COL2"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#AR_CREATED_BY_NAME_COL#}","hidden":"true","dataIndex":"AR_CREATED_BY_NAME","titleAlign":"center","itemId":"AR_CREATED_BY_NAME_COL2"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#DESCRIPTION_COL#}","dataIndex":"DESCRIPTION","titleAlign":"center","itemId":"DESCRIPTION_COL2","flex":"1"},"children":[],"expanded":true,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"},{"configs":{"region":"center","pagingBar":"false","hidden":"true","itemId":"grid3","editable":"true"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/ar/pay/DB/select_xc_ar_pay_l"},"events":{"beforeload":"operation.params = {\n  AR_PAY_H_ID : Wb.ar_pay_h_id\n};"},"children":[],"expanded":false,"type":"store"},{"configs":{"normalName":"grid3Tbar","itemId":"tbar"},"children":[{"configs":{"text":"{#addTempBtn#}","itemId":"addTempBtn3","iconCls":"insert_icon"},"events":{"click":"if(app.grid3.store.getCount() !== 0){\n  Wb.toast('{#YSKMXZNY1T#}');//预收款明细数据只能有 1 条！\n  return ;\n}\n\nvar acc_id,acc_name;\n\nWb.request({\n  async : false,\n  url : 'm?xwl=xc/ar/pay/DB/select_pre_acc_by_ledger',\n  params : {\n    LEDGER_ID : app.LEDGER_ID_XWL.LEDGER_ID.getValue()\n  },\n  success : function(resp){\n    var data = Wb.decode(resp.responseText);\n    acc_id = data.ACC_ID;\n    acc_name = data.ACC_NAME;\n  }\n});\n\nif(Wb.isEmpty(acc_id)){\n  acc_id = '';\n  acc_name = '';\n}\n\nWb.addEdit(app.grid3,{\n  PROJECT_ID : app.PROJECT_ID_XWL.PROJECT_ID.getValue(),\n  PROJECT_NAME : app.PROJECT_ID_XWL.PROJECT_NAME.getValue(),\n  AR_CREATED_BY_NAME : '{#XIP.empName#}',\n  ACC_ID : acc_id,\n  ACC_NAME : acc_name\n},'first',0,false);\n\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#deleteBtn#}","itemId":"deleteBtn3","iconCls":"file_delete_icon"},"events":{"click":"Wb.remove(app.grid3);"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#rownum#}","align":"center","xtype":"rownumberer","titleAlign":"center","itemId":"rownum3"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#AR_DOC_CAT_CODE_COL#}","hidden":"true","dataIndex":"AR_DOC_CAT_CODE","titleAlign":"center","itemId":"AR_DOC_CAT_CODE_COL3"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"<font color = 'red'>*<\/font>{#AR_CONTRACT_NAME_COL#}","hidden":"true","width":"150","dataIndex":"AR_CONTRACT_NAME","titleAlign":"center","itemId":"AR_CONTRACT_NAME_COL3"},"children":[{"configs":{"labelWidth":"100","labelAlign":"right","normalName":"AR_CONTRACT_NAME_PICK3","itemId":"editor"},"children":[{"configs":{"tagConfigs":"minWidth:400","height":"300","itemId":"pickComp"},"events":{"itemdblclick":"var r=app.grid.getSelectionModel().getSelection()[0];\nr.set('AR_CONTRACT_ID',record.data.AR_CONTRACT_ID);\nr.set('AR_CONTRACT_NAME',record.data.AR_CONTRACT_NAME);\nr.dirty = true;\napp.AR_CONTRACT_NAME_PICK3.setValue(record.data.AR_CONTRACT_NAME);\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/ar/ar-com-lov/AR_CONTRACT_ID_PICK/DB/GRID_XC_AR_CONTRACT_SELECT"},"events":{"beforeload":"operation.params = Wb.getValue([app.form1,app.tbar]);"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"合同id","hidden":"true","dataIndex":"AR_CONTRACT_ID","itemId":"AR_CONTRACT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"合同编码","dataIndex":"AR_CONTRACT_CODE","itemId":"AR_CONTRACT_CODE_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"合同名称","dataIndex":"AR_CONTRACT_NAME","itemId":"AR_CONTRACT_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"100","emptyText":"合同编码/名称","labelAlign":"right","itemId":"QUERY_CODE_NAME"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.pickComp.getStore().load();\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":false,"type":"column"},{"configs":{"text":"<font color = 'red'>*<\/font>{#DEPT_NAME_COL#}","hidden":"true","width":"150","dataIndex":"DEPT_NAME","titleAlign":"center","itemId":"DEPT_NAME_COL3"},"children":[{"configs":{"labelWidth":"100","labelAlign":"right","normalName":"DEPT_NAME_PICK3","itemId":"editor"},"children":[{"configs":{"tagConfigs":"minWidth:400","height":"300","itemId":"pickComp"},"events":{"itemdblclick":"var r=app.grid.getSelectionModel().getSelection()[0];\nr.set('DEPT_ID',record.data.DEPT_ID);\nr.set('DEPT_NAME',record.data.DEPT_NAME);\nr.dirty = true;\napp.DEPT_NAME_PICK3.setValue(record.data.DEPT_NAME);\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/com-lov/DEPT_ID_PICK/DB/GRID_XIP_PUB_DEPTS_SELECT_LD"},"events":{"beforeload":"operation.params = Wb.getValue([app.form1,app.tbar]);"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"成本中心id","hidden":"true","dataIndex":"DEPT_ID","itemId":"DEPT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"成本中心编码","dataIndex":"DEPT_CODE","itemId":"DEPT_CODE_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"成本中心名称","dataIndex":"DEPT_NAME","itemId":"DEPT_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"100","emptyText":"成本中心编码/名称","labelAlign":"right","itemId":"QUERY_CODE_NAME"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.pickComp.getStore().load();\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":false,"type":"column"},{"configs":{"text":"{#PROJECT_NAME_COL#}","width":"150","dataIndex":"PROJECT_NAME","titleAlign":"center","itemId":"PROJECT_NAME_COL3"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"<font color = 'red'>*<\/font>{#ACC_NAME_COL#}","width":"150","dataIndex":"ACC_NAME","titleAlign":"center","itemId":"ACC_NAME_COL3"},"children":[{"configs":{"labelWidth":"100","allowBlank":"false","labelAlign":"right","normalName":"ACC_NAME_PICK3","itemId":"editor"},"events":{"change":"var r=app.grid.getSelectionModel().getSelection()[0];\nr.set('CCID','');\nr.set('CCID_NAME','');"},"children":[{"configs":{"tagConfigs":"minWidth:400","height":"300","itemId":"pickComp"},"events":{"itemdblclick":"var r=app.grid.getSelectionModel().getSelection()[0];\nr.set('ACC_ID',record.data.ACC_ID);\nr.set('ACC_NAME',record.data.ACC_NAME);\nr.dirty = true;\napp.ACC_NAME_PICK3.setValue(record.data.ACC_NAME);\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/com-lov/ACC_ID_PICK/DB/XC_BG_LD_ACCOUNTS_SELECT_LD"},"events":{"beforeload":"operation.params = Wb.getValue([app.form1,app.tbar]);"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"科目id","hidden":"true","dataIndex":"ACC_ID","itemId":"ACC_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"科目编码","dataIndex":"ACC_CODE","itemId":"ACC_CODE_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"科目名称","dataIndex":"ACC_NAME","itemId":"ACC_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"100","emptyText":"科目编码/名称","labelAlign":"right","itemId":"QUERY_CODE_NAME"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.pickComp.getStore().load();\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":false,"type":"column"},{"configs":{"text":"{#CCID_NAME_COL#}","width":"150","dataIndex":"CCID_NAME","titleAlign":"center","itemId":"CCID_NAME_COL3"},"children":[{"configs":{"displayField":"CCID_NAME","triggerCls":"x-form-search-trigger","valueField":"CCID","itemId":"editor","onTriggerClick":"  // 账簿\n  var ledgerId = app.LEDGER_ID_XWL.LEDGER_ID.getValue() ;\n  if(ledgerId === \"\" ||ledgerId === null || ledgerId === undefined){\n    Wb.info('请选择账簿!') ;\n    return false ;\n  }\n  \n  // 会计日期\n  var accDate = app.GL_DATE.getValue() ;\n  if(accDate === \"\" ||accDate === null || accDate === undefined){\n    Wb.info('请选择会计日期!') ;\n    return false ;\n  }else{\n\taccDate = Wb.dateToStr(accDate).substring(0,7);\n  }\n  \n  // TODO: 当前选中\n  var r = app.grid.getSelection()[0] ; \n  \n  // TODO: 显示科目选择窗口\n  Wb.run({\n    url:'m?xwl=xc/gl/journal/v-windows/handler-ccid-win',\n    params : {\n      'ledgerId' : ledgerId,\n      'vtype' : '{#vtype#}'\n    },          \n    success:function(appObj){\n      appObj.initWindow({\n        accName : r.data.ACC_NAME,\n        ledgerId : ledgerId,\n        periodCode : accDate ,\n        groupId : 'ALL',\n        handlerCCID : function(returnObj){\n          // TODO: 处理CCID信息\n          var rObj = Wb.decode(returnObj) ;\n          r.set('ACC_ID', rObj.acc_id) ;    \n          r.set('ACC_NAME', rObj.acc_name);\n          r.set('CCID', rObj.acc_ccid) ;    \n          r.set('CCID_NAME', rObj.acc_ccid_name);\n          if(!Wb.isEmpty(rObj.dim_id)){\n          r.set('DIM_ID', rObj.dim_id) ;\n          r.set('DIM_NAME', rObj.dim_name) ;\n          }\n          // 禁用账簿\n           app.LEDGER_ID_XWL.LEDGER_ID.setReadOnly(true) ;\n        }\n      });\n    }  \n  }) ;   "},"events":{"beforequery":"var combo = e.combo;\nif(!e.forceAll){\n  var value = e.query;\n  combo.store.filterBy(function(record,id){\n    var text = record.get(combo.displayField);\n    return (text.indexOf(value)!=-1);\n  });\n  combo.expand();\n  return false;\n}","specialkey":"// TODO: 按回车键执行借方和贷方金额切换\nif (e.getKey() == e.ENTER) {\n  // 账簿\n  var ledgerId = app.LEDGER_ID_XWL.LEDGER_ID.getValue() ;\n  if(ledgerId === \"\" ||ledgerId === null || ledgerId === undefined){\n    Wb.info('请选择账簿!') ;\n    return false ;\n  }\n  \n  // 会计日期\n  var accDate = app.GL_DATE.getValue();\n  if(accDate === \"\" ||accDate === null || accDate === undefined){\n    Wb.info('请选择会计日期!') ;\n    return false ;\n  }else{\n    accDate = Wb.dateToStr(accDate).substring(0,7);\n  }\n  \n  // TODO: 当前选中\n  var r = app.grid.getSelection()[0] ; \n  \n  // TODO: 显示科目选择窗口\n  Wb.run({\n    url:'m?xwl=xc/gl/journal/v-windows/handler-ccid-win',\n    params : {\n      'ledgerId' : ledgerId ,\n      'vtype' : '{#vtype#}'\n    },          \n    success:function(appObj){\n      appObj.initWindow({\n        accName : r.data.ACC_NAME,\n        ledgerId : ledgerId,\n        periodCode : accDate ,\n        groupId : 'ALL',\n        handlerCCID : function(returnObj){\n          // TODO: 处理CCID信息\n          var rObj = Wb.decode(returnObj) ;\n          r.set('ACC_ID', rObj.acc_id) ;    \n          r.set('ACC_NAME', rObj.acc_name);\n          r.set('CCID', rObj.acc_ccid) ;    \n          r.set('CCID_NAME', rObj.acc_ccid_name);\n          if(!Wb.isEmpty(rObj.dim_id)){\n            r.set('DIM_ID', rObj.dim_id) ;\n            r.set('DIM_NAME', rObj.dim_name) ;\n          }\n          // 禁用账簿\n           app.LEDGER_ID_XWL.LEDGER_ID.setReadOnly(true) ;\n        }\n      });\n    }  \n  }) ;   \n}"},"children":[],"expanded":true,"type":"combo"}],"expanded":true,"type":"column"},{"configs":{"text":"<font color = 'red'>*<\/font>{#AMOUNT_COL#}","width":"100","align":"right","dataIndex":"AMOUNT","format":"0,000.00","titleAlign":"center","itemId":"AMOUNT_COL3"},"children":[{"configs":{"allowBlank":"false","minValue":"0","value":"0","itemId":"editor"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"column"},{"configs":{"text":"{#AR_CREATED_BY_NAME_COL#}","hidden":"true","dataIndex":"AR_CREATED_BY_NAME","titleAlign":"center","itemId":"AR_CREATED_BY_NAME_COL3"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"<font color = 'red'>*<\/font>{#DESCRIPTION_COL#}","dataIndex":"DESCRIPTION","titleAlign":"center","itemId":"DESCRIPTION_COL3","flex":"1"},"children":[{"configs":{"itemId":"editor"},"children":[],"expanded":false,"type":"textarea"}],"expanded":true,"type":"column"}],"expanded":true,"type":"array"}],"expanded":false,"type":"grid"},{"configs":{"region":"center","pagingBar":"false","hidden":"true","itemId":"grid4","editable":"true"},"events":{"tagEvents":"{\n  beforeedit : function(editor,e,o){\n    if(app.SOURCE.getValue() == 'PAY_L'){\n      return false;\n    }else{\n      return true;\n    }\n  }\n}"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/ar/pay/DB/select_xc_ar_pay_l"},"events":{"beforeload":"operation.params = {\n  AR_PAY_H_ID : Wb.ar_pay_h_id\n};"},"children":[],"expanded":false,"type":"store"},{"configs":{"normalName":"grid4Tbar","itemId":"tbar"},"children":[{"configs":{"text":"{#selectArPayBtn4#}","hidden":"true","itemId":"selectArPayBtn4","iconCls":"seek_icon"},"events":{"tagEvents":"{\n  show : function(button, options){\n    \n    app.L_AR_PAY_H_CODE_COL4.show();\n  }\n}","click":"if(app.grid4.store.getCount() !== 0){\n  Wb.toast('{#YSKMXZNY1T#}');//预收款-红字明细数据只能有 1 条！\n  return;\n}\nvar ledger_id = app.LEDGER_ID_XWL.LEDGER_ID.getValue();//账簿id\nvar customer_id = app.CUSTOM_ID_XWL.CUSTOMER_ID.getValue();//客户id\nvar project_id = app.PROJECT_ID_XWL.PROJECT_ID.getValue();//项目\nvar ar_contract_id = app.AR_CONTRACT_ID_XWL.AR_CONTRACT_ID.getValue();//合同\n//判断,过滤条件 账簿 有合同就按合同过滤，没有就算了\nif(Wb.isEmpty(ledger_id)){\n  Wb.toast('{#QXZZB#}');//请选择账簿！\n  return ;\n}\nif(Wb.isEmpty(customer_id)){\n  Wb.toast('{#QXZKH#}');//请选择客户！\n  return ;\n}\nvar curGrid = app.grid4;\nWb.run({\n  url: 'm?xwl=xc/ar/pay/LOV/LOV_SELECT_PAY_WIN', \n  success: function(app) {\n    app.initWin({\n      LEDGER_ID : ledger_id,\n      CUSTOMER_ID : customer_id,\n      PROJECT_ID : project_id,\n      AR_CONTRACT_ID : ar_contract_id,\n      hideFun:function(recs){\n        Ext.each(recs,function(rec){\n          Wb.addEdit(curGrid,{\n            AR_PAY_L_ID : '',\n            AR_PAY_H_ID : Wb.ar_pay_h_id,\n            L_AR_PAY_H_ID : rec.data.AR_PAY_H_ID,\n            L_AR_PAY_H_CODE : rec.data.AR_PAY_H_CODE,\n            L_AR_PAY_L_ID : rec.data.AR_PAY_L_ID,\n            PROJECT_ID : rec.data.PROJECT_ID,\n            PROJECT_NAME : rec.data.PROJECT_NAME,\n            AR_CONTRACT_ID : rec.data.AR_CONTRACT_ID,\n            AR_CONTRACT_NAME : rec.data.AR_CONTRACT_NAME,\n            DEPT_ID : rec.data.DEPT_ID,\n            DEPT_NAME : rec.data.DEPT_NAME,\n            AR_DOC_CAT_CODE : rec.data.AR_DOC_CAT_CODE,\n            AMOUNT : Math.abs(rec.data.TK_AMT)*(-1),\n            ACC_ID : rec.data.L_ACC_ID,\n            ACC_NAME : rec.data.L_ACC_NAME,\n            CCID : rec.data.SALE_CCID,\n            CCID_NAME : rec.data.SALE_CCID_NAME,\n            AR_CREATED_BY_NAME : '{#XIP.empName#}',\n            DESCRIPTION : rec.data.DESCRIPTION\n          }, 'after', 1, false);\n        });\n      }\n    });\n    \n  }\n});\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#addTempBtn#}","hidden":"true","itemId":"addTempBtn4","iconCls":"insert_icon"},"events":{"click":"if(app.grid4.store.getCount() !== 0){\n  Wb.toast(\"预收款-红字明细数据只能有 1 条！\");\n  return;\n}\n\nvar acc_id,acc_name;\n\nWb.request({\n  async : false,\n  url : 'm?xwl=xc/ar/pay/DB/select_pre_acc_by_ledger',\n  params : {\n    LEDGER_ID : app.LEDGER_ID_XWL.LEDGER_ID.getValue()\n  },\n  success : function(resp){\n    var data = Wb.decode(resp.responseText);\n    acc_id = data.ACC_ID;\n    acc_name = data.ACC_NAME;\n  }\n});\n\nif(Wb.isEmpty(acc_id)){\n  acc_id = '';\n  acc_name = '';\n}\n\nWb.addEdit(app.grid4,{\n  PROJECT_ID : app.PROJECT_ID_XWL.PROJECT_ID.getValue(),\n  PROJECT_NAME : app.PROJECT_ID_XWL.PROJECT_NAME.getValue(),\n  AR_CREATED_BY_NAME : '{#XIP.empName#}',\n  ACC_ID : acc_id,\n  ACC_NAME : acc_name\n},'first',0,false);\n\n","tagEvents":"{\n  show : function(button, options){\n    \n    \n    app.L_AR_PAY_H_CODE_COL4.hide();\n  }\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#deleteBtn#}","itemId":"deleteBtn4","iconCls":"file_delete_icon"},"events":{"click":"Wb.remove(app.grid4);"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#rownum#}","align":"center","xtype":"rownumberer","titleAlign":"center","itemId":"rownum4"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#AR_DOC_CAT_CODE_COL#}","hidden":"true","dataIndex":"AR_DOC_CAT_CODE","titleAlign":"center","itemId":"AR_DOC_CAT_CODE_COL4"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#L_AR_PAY_H_CODE_COL#}","dataIndex":"L_AR_PAY_H_CODE","titleAlign":"center","itemId":"L_AR_PAY_H_CODE_COL4"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"<font color = 'red'>*<\/font>{#AR_CONTRACT_NAME_COL#}","hidden":"true","width":"150","dataIndex":"AR_CONTRACT_NAME","titleAlign":"center","itemId":"AR_CONTRACT_NAME_COL4"},"children":[{"configs":{"labelWidth":"100","labelAlign":"right","normalName":"AP_CONTRACT_NAME_PICK4","itemId":"editor"},"children":[{"configs":{"tagConfigs":"minWidth:400","height":"300","itemId":"pickComp"},"events":{"itemdblclick":"var r=app.grid.getSelectionModel().getSelection()[0];\nr.set('AP_CONTRACT_ID',record.data.AP_CONTRACT_ID);\nr.set('AP_CONTRACT_NAME',record.data.AP_CONTRACT_NAME);\nr.dirty = true;\napp.AP_CONTRACT_NAME_PICK4.setValue(record.data.AP_CONTRACT_NAME);\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/ap/ap-com-lov/AP_CONTRACT_ID_PICK/DB/GRID_XC_AP_CONTRACT_SELECT"},"events":{"beforeload":"operation.params = Wb.getValue([app.form1,app.tbar]);"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"合同id","hidden":"true","dataIndex":"AP_CONTRACT_ID","itemId":"AP_CONTRACT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"合同编码","dataIndex":"AP_CONTRACT_CODE","itemId":"AP_CONTRACT_CODE_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"合同名称","dataIndex":"AP_CONTRACT_NAME","itemId":"AP_CONTRACT_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"100","emptyText":"合同编码/名称","labelAlign":"right","itemId":"QUERY_CODE_NAME"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.pickComp.getStore().load();\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":false,"type":"picker"}],"expanded":true,"type":"column"},{"configs":{"text":"<font color = 'red'>*<\/font>{#DEPT_NAME_COL#}","hidden":"true","width":"150","dataIndex":"DEPT_NAME","titleAlign":"center","itemId":"DEPT_NAME_COL4"},"children":[{"configs":{"labelWidth":"100","labelAlign":"right","normalName":"DEPT_NAME_PICK4","itemId":"editor"},"children":[{"configs":{"tagConfigs":"minWidth:400","height":"300","itemId":"pickComp"},"events":{"itemdblclick":"var r=app.grid.getSelectionModel().getSelection()[0];\nr.set('DEPT_ID',record.data.DEPT_ID);\nr.set('DEPT_NAME',record.data.DEPT_NAME);\nr.dirty = true;\napp.DEPT_NAME_PICK4.setValue(record.data.DEPT_NAME);\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/com-lov/DEPT_ID_PICK/DB/GRID_XIP_PUB_DEPTS_SELECT_LD"},"events":{"beforeload":"operation.params = Wb.getValue([app.form1,app.tbar]);"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"成本中心id","hidden":"true","dataIndex":"DEPT_ID","itemId":"DEPT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"成本中心编码","dataIndex":"DEPT_CODE","itemId":"DEPT_CODE_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"成本中心名称","dataIndex":"DEPT_NAME","itemId":"DEPT_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"100","emptyText":"成本中心编码/名称","labelAlign":"right","itemId":"QUERY_CODE_NAME"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.pickComp.getStore().load();\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":false,"type":"picker"}],"expanded":true,"type":"column"},{"configs":{"text":"{#PROJECT_NAME_COL#}","width":"150","dataIndex":"PROJECT_NAME","titleAlign":"center","itemId":"PROJECT_NAME_COL4"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"<font color = 'red'>*<\/font>{#ACC_NAME_COL#}","width":"150","dataIndex":"ACC_NAME","titleAlign":"center","itemId":"ACC_NAME_COL4"},"children":[{"configs":{"labelWidth":"100","allowBlank":"false","labelAlign":"right","normalName":"ACC_NAME_PICK4","itemId":"editor"},"events":{"change":"var r=app.grid.getSelectionModel().getSelection()[0];\nr.set('CCID','');\nr.set('CCID_NAME','');"},"children":[{"configs":{"tagConfigs":"minWidth:400","height":"300","itemId":"pickComp"},"events":{"itemdblclick":"var r=app.grid.getSelectionModel().getSelection()[0];\nr.set('ACC_ID',record.data.ACC_ID);\nr.set('ACC_NAME',record.data.ACC_NAME);\nr.dirty = true;\napp.ACC_NAME_PICK4.setValue(record.data.ACC_NAME);\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/com-lov/ACC_ID_PICK/DB/XC_BG_LD_ACCOUNTS_SELECT_LD"},"events":{"beforeload":"operation.params = Wb.getValue([app.form1,app.tbar]);"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"科目id","hidden":"true","dataIndex":"ACC_ID","itemId":"ACC_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"科目编码","dataIndex":"ACC_CODE","itemId":"ACC_CODE_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"科目名称","dataIndex":"ACC_NAME","itemId":"ACC_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"100","emptyText":"科目编码/名称","labelAlign":"right","itemId":"QUERY_CODE_NAME"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.pickComp.getStore().load();\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":false,"type":"picker"}],"expanded":true,"type":"column"},{"configs":{"text":"{#CCID_NAME_COL#}","width":"150","dataIndex":"CCID_NAME","titleAlign":"center","itemId":"CCID_NAME_COL4"},"children":[{"configs":{"displayField":"CCID_NAME","triggerCls":"x-form-search-trigger","valueField":"CCID","itemId":"editor","onTriggerClick":"  // 账簿\n  var ledgerId = app.LEDGER_ID_XWL.LEDGER_ID.getValue() ;\n  if(ledgerId === \"\" ||ledgerId === null || ledgerId === undefined){\n    Wb.info('请选择账簿!') ;\n    return false ;\n  }\n  \n  // 会计日期\n  var accDate = app.GL_DATE.getValue() ;\n  if(accDate === \"\" ||accDate === null || accDate === undefined){\n    Wb.info('请选择会计日期!') ;\n    return false ;\n  }else{\n\taccDate = Wb.dateToStr(accDate).substring(0,7);\n  }\n  \n  // TODO: 当前选中\n  var r = app.grid.getSelection()[0] ; \n  \n  // TODO: 显示科目选择窗口\n  Wb.run({\n    url:'m?xwl=xc/gl/journal/v-windows/handler-ccid-win',\n    params : {\n      'ledgerId' : ledgerId,\n      'vtype' : '{#vtype#}'\n    },          \n    success:function(appObj){\n      appObj.initWindow({\n        accName : r.data.ACC_NAME,\n        ledgerId : ledgerId,\n        periodCode : accDate ,\n        groupId : 'ALL',\n        handlerCCID : function(returnObj){\n          // TODO: 处理CCID信息\n          var rObj = Wb.decode(returnObj) ;\n          r.set('ACC_ID', rObj.acc_id) ;    \n          r.set('ACC_NAME', rObj.acc_name);\n          r.set('CCID', rObj.acc_ccid) ;    \n          r.set('CCID_NAME', rObj.acc_ccid_name);\n          if(!Wb.isEmpty(rObj.dim_id)){\n          r.set('DIM_ID', rObj.dim_id) ;\n          r.set('DIM_NAME', rObj.dim_name) ;\n          }\n          // 禁用账簿\n           app.LEDGER_ID_XWL.LEDGER_ID.setReadOnly(true) ;\n        }\n      });\n    }  \n  }) ;   "},"events":{"beforequery":"var combo = e.combo;\nif(!e.forceAll){\n  var value = e.query;\n  combo.store.filterBy(function(record,id){\n    var text = record.get(combo.displayField);\n    return (text.indexOf(value)!=-1);\n  });\n  combo.expand();\n  return false;\n}","specialkey":"// TODO: 按回车键执行借方和贷方金额切换\nif (e.getKey() == e.ENTER) {\n  // 账簿\n  var ledgerId = app.LEDGER_ID_XWL.LEDGER_ID.getValue() ;\n  if(ledgerId === \"\" ||ledgerId === null || ledgerId === undefined){\n    Wb.info('请选择账簿!') ;\n    return false ;\n  }\n  \n  // 会计日期\n  var accDate = app.GL_DATE.getValue();\n  if(accDate === \"\" ||accDate === null || accDate === undefined){\n    Wb.info('请选择会计日期!') ;\n    return false ;\n  }else{\n    accDate = Wb.dateToStr(accDate).substring(0,7);\n  }\n  \n  // TODO: 当前选中\n  var r = app.grid.getSelection()[0] ; \n  \n  // TODO: 显示科目选择窗口\n  Wb.run({\n    url:'m?xwl=xc/gl/journal/v-windows/handler-ccid-win',\n    params : {\n      'ledgerId' : ledgerId ,\n      'vtype' : '{#vtype#}'\n    },          \n    success:function(appObj){\n      appObj.initWindow({\n        accName : r.data.ACC_NAME,\n        ledgerId : ledgerId,\n        periodCode : accDate ,\n        groupId : 'ALL',\n        handlerCCID : function(returnObj){\n          // TODO: 处理CCID信息\n          var rObj = Wb.decode(returnObj) ;\n          r.set('ACC_ID', rObj.acc_id) ;    \n          r.set('ACC_NAME', rObj.acc_name);\n          r.set('CCID', rObj.acc_ccid) ;    \n          r.set('CCID_NAME', rObj.acc_ccid_name);\n          if(!Wb.isEmpty(rObj.dim_id)){\n            r.set('DIM_ID', rObj.dim_id) ;\n            r.set('DIM_NAME', rObj.dim_name) ;\n          }\n          // 禁用账簿\n           app.LEDGER_ID_XWL.LEDGER_ID.setReadOnly(true) ;\n        }\n      });\n    }  \n  }) ;   \n}"},"children":[],"expanded":true,"type":"combo"}],"expanded":true,"type":"column"},{"configs":{"text":"<font color = 'red'>*<\/font>{#AMOUNT_COL#}","width":"100","align":"right","dataIndex":"AMOUNT","format":"0,000.00","titleAlign":"center","itemId":"AMOUNT_COL4"},"children":[{"configs":{"value":"-0","itemId":"editor","maxValue":"-0"},"events":{"change":"if( newValue > 0 ){\n  Wb.toast('该单据金额应小于 0 !');\n  number.setValue(-0);\n  return;\n}"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"column"},{"configs":{"text":"{#AR_CREATED_BY_NAME_COL#}","hidden":"true","width":"100","dataIndex":"AR_CREATED_BY_NAME","titleAlign":"center","itemId":"AR_CREATED_BY_NAME_COL4"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"<font color = 'red'>*<\/font>{#DESCRIPTION_COL#}","dataIndex":"DESCRIPTION","titleAlign":"center","itemId":"DESCRIPTION_COL4","flex":"1"},"children":[{"configs":{"itemId":"editor"},"children":[],"expanded":false,"type":"textarea"}],"expanded":true,"type":"column"}],"expanded":true,"type":"array"}],"expanded":false,"type":"grid"},{"configs":{"region":"center","pagingBar":"false","hidden":"true","itemId":"grid5","editable":"true"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/ar/pay/DB/select_xc_ar_pay_l"},"events":{"beforeload":"operation.params = {\n  AR_PAY_H_ID : Wb.ar_pay_h_id\n};"},"children":[],"expanded":false,"type":"store"},{"configs":{"normalName":"grid5Tbar","itemId":"tbar"},"children":[{"configs":{"text":"{#addSaleTypeBtn#}","itemId":"addSaleTypeBtn5","iconCls":"insert_icon"},"events":{"click":"// Wb.addEdit(app.grid5,{\n//   PROJECT_ID : app.PROJECT_ID_XWL.PROJECT_ID.getValue(),\n//   PROJECT_NAME : app.PROJECT_ID_XWL.PROJECT_NAME.getValue(),\n//   AR_CREATED_BY_NAME : '{#XIP.empName#}'\n// });\n\nvar ledgerId = app.LEDGER_ID_XWL.LEDGER_ID.getValue();\nvar arDocCatCode = app.AR_DOC_CAT_CODE.getValue();\n\nif(Wb.isEmpty(ledgerId)){\n  Wb.toast('请先选择账簿！');\n  return false;\n}\nvar curGrid = app.grid;\nWb.run({\n  url: 'm?xwl=xc/ar/pay/LOV/LOV_SELECT_SALE_TYPE_WIN', \n  success: function(app) {\n    app.initWin({\n      LEDGER_ID : ledgerId,\n      AR_DOC_CAT_CODE : arDocCatCode,\n      hideFun:function(rs){\n        Wb.each(rs, function(r) {\n          r.set('AR_SALE_TYPE_ID',r.get('AR_SALE_TYPE_ID'));\n          r.set('AR_SALE_TYPE_NAME',r.get('AR_SALE_TYPE_NAME'));\n          r.set('BG_ITEM_ID',r.get('BG_ITEM_ID'));\n          r.set('BG_ITEM_NAME',r.get('BG_ITEM_NAME'));\n          r.set('PRODUCT_ID',r.get('PRODUCT_ID'));\n          r.set('PRODUCT_NAME',r.get('PRODUCT_NAME'));\n          r.set('ACC_ID',r.get('ACC_ID'));\n          r.set('ACC_NAME',r.get('ACC_NAME'));\n          r.set('AMOUNT',r.get('PAY_AMT'));\n          \n          var grid1Store = curGrid.getStore();\n          for(var i=0;i<grid1Store.getCount();i++){\n            var gr = grid1Store.getAt(i);\n            if(gr.get('AR_PUR_TYPE_ID')==r.get('AR_PUR_TYPE_ID')){\n              return false;\n            }\n          }\n          Wb.add(curGrid,r.data, 'after', 1, false);\n        });\n      }\n    });\n  }\n});\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#deleteBtn#}","itemId":"deleteBtn5","iconCls":"file_delete_icon"},"events":{"click":"Wb.remove(app.grid5);\n"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#rownum#}","align":"center","xtype":"rownumberer","titleAlign":"center","itemId":"ROWNUM_COL5"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#AR_SALE_TYPE_NAME_COL#}","width":"150","dataIndex":"AR_SALE_TYPE_NAME","titleAlign":"center","itemId":"AR_SALE_TYPE_NAME_COL5"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#BG_ITEM_NAME_COL#}","hidden":"true","width":"150","dataIndex":"BG_ITEM_NAME","titleAlign":"center","itemId":"BG_ITEM_NAME_COL5"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#PRODUCT_NAME_COL#}","hidden":"true","width":"150","dataIndex":"PRODUCT_NAME","titleAlign":"center","itemId":"PRODUCT_NAME_COL5"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"<font color='red'>*<\/font>{#ACC_NAME_COL#}","dataIndex":"ACC_NAME","titleAlign":"center","itemId":"ACC_NAME_COL5"},"children":[{"configs":{"labelWidth":"100","allowBlank":"false","labelAlign":"right","normalName":"ACC_NAME_PICK5","itemId":"editor"},"events":{"change":"var r=app.grid.getSelectionModel().getSelection()[0];\nr.set('CCID','');\nr.set('CCID_NAME','');"},"children":[{"configs":{"tagConfigs":"minWidth:400","height":"300","itemId":"pickComp"},"events":{"itemdblclick":"var r=app.grid.getSelectionModel().getSelection()[0];\nr.set('ACC_ID',record.data.ACC_ID);\nr.set('ACC_NAME',record.data.ACC_NAME);\nr.dirty = true;\napp.ACC_NAME_PICK5.setValue(record.data.ACC_NAME);\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/com-lov/ACC_ID_PICK/DB/XC_BG_LD_ACCOUNTS_SELECT_LD"},"events":{"beforeload":"operation.params = Wb.getValue([app.form1,app.tbar]);"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"科目id","hidden":"true","dataIndex":"ACC_ID","itemId":"ACC_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"科目编码","dataIndex":"ACC_CODE","itemId":"ACC_CODE_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"科目名称","dataIndex":"ACC_NAME","itemId":"ACC_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"100","emptyText":"科目编码/名称","labelAlign":"right","itemId":"QUERY_CODE_NAME"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.pickComp.getStore().load();\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":false,"type":"picker"}],"expanded":false,"type":"column"},{"configs":{"text":"{#CCID_NAME_COL#}","dataIndex":"CCID_NAME","titleAlign":"center","itemId":"CCID_NAME_COL5"},"children":[{"configs":{"displayField":"CCID_NAME","triggerCls":"x-form-search-trigger","valueField":"CCID","itemId":"editor","onTriggerClick":"  // 账簿\n  var ledgerId = app.LEDGER_ID_XWL.LEDGER_ID.getValue() ;\n  if(ledgerId === \"\" ||ledgerId === null || ledgerId === undefined){\n    Wb.info('请选择账簿!') ;\n    return false ;\n  }\n  \n  // 会计日期\n  var accDate = app.GL_DATE.getValue() ;\n  if(accDate === \"\" ||accDate === null || accDate === undefined){\n    Wb.info('请选择会计日期!') ;\n    return false ;\n  }else{\n\taccDate = Wb.dateToStr(accDate).substring(0,7);\n  }\n  \n  // TODO: 当前选中\n  var r = app.grid.getSelection()[0] ; \n  \n  // TODO: 显示科目选择窗口\n  Wb.run({\n    url:'m?xwl=xc/gl/journal/v-windows/handler-ccid-win',\n    params : {\n      'ledgerId' : ledgerId,\n      'vtype' : '{#vtype#}'\n    },          \n    success:function(appObj){\n      appObj.initWindow({\n        accName : r.data.ACC_NAME,\n        ledgerId : ledgerId,\n        periodCode : accDate ,\n        groupId : 'ALL',\n        handlerCCID : function(returnObj){\n          // TODO: 处理CCID信息\n          var rObj = Wb.decode(returnObj) ;\n          r.set('ACC_ID', rObj.acc_id) ;    \n          r.set('ACC_NAME', rObj.acc_name);\n          r.set('CCID', rObj.acc_ccid) ;    \n          r.set('CCID_NAME', rObj.acc_ccid_name);\n          if(!Wb.isEmpty(rObj.dim_id)){\n          r.set('DIM_ID', rObj.dim_id) ;\n          r.set('DIM_NAME', rObj.dim_name) ;\n          }\n          // 禁用账簿\n           app.LEDGER_ID_XWL.LEDGER_ID.setReadOnly(true) ;\n        }\n      });\n    }  \n  }) ;   "},"events":{"beforequery":"var combo = e.combo;\nif(!e.forceAll){\n  var value = e.query;\n  combo.store.filterBy(function(record,id){\n    var text = record.get(combo.displayField);\n    return (text.indexOf(value)!=-1);\n  });\n  combo.expand();\n  return false;\n}","specialkey":"// TODO: 按回车键执行借方和贷方金额切换\nif (e.getKey() == e.ENTER) {\n  // 账簿\n  var ledgerId = app.LEDGER_ID_XWL.LEDGER_ID.getValue() ;\n  if(ledgerId === \"\" ||ledgerId === null || ledgerId === undefined){\n    Wb.info('请选择账簿!') ;\n    return false ;\n  }\n  \n  // 会计日期\n  var accDate = app.GL_DATE.getValue();\n  if(accDate === \"\" ||accDate === null || accDate === undefined){\n    Wb.info('请选择会计日期!') ;\n    return false ;\n  }else{\n    accDate = Wb.dateToStr(accDate).substring(0,7);\n  }\n  \n  // TODO: 当前选中\n  var r = app.grid.getSelection()[0] ; \n  \n  // TODO: 显示科目选择窗口\n  Wb.run({\n    url:'m?xwl=xc/gl/journal/v-windows/handler-ccid-win',\n    params : {\n      'ledgerId' : ledgerId ,\n      'vtype' : '{#vtype#}'\n    },          \n    success:function(appObj){\n      appObj.initWindow({\n        accName : r.data.ACC_NAME,\n        ledgerId : ledgerId,\n        periodCode : accDate ,\n        groupId : 'ALL',\n        handlerCCID : function(returnObj){\n          // TODO: 处理CCID信息\n          var rObj = Wb.decode(returnObj) ;\n          r.set('ACC_ID', rObj.acc_id) ;    \n          r.set('ACC_NAME', rObj.acc_name);\n          r.set('CCID', rObj.acc_ccid) ;    \n          r.set('CCID_NAME', rObj.acc_ccid_name);\n          if(!Wb.isEmpty(rObj.dim_id)){\n            r.set('DIM_ID', rObj.dim_id) ;\n            r.set('DIM_NAME', rObj.dim_name) ;\n          }\n          // 禁用账簿\n           app.LEDGER_ID_XWL.LEDGER_ID.setReadOnly(true) ;\n        }\n      });\n    }  \n  }) ;   \n}"},"children":[],"expanded":true,"type":"combo"}],"expanded":false,"type":"column"},{"configs":{"text":"<font color='red'>*<\/font>{#AMOUNT_COL#}","align":"right","dataIndex":"AMOUNT","titleAlign":"center","itemId":"AMOUNT_COL5","renderer":"return Ext.util.Format.number(value,'0,000.00');"},"children":[{"configs":{"allowBlank":"false","itemId":"editor"},"events":{"change":"if(newValue < 0){\n  Wb.toast('金额应大于 0 ！');\n  number.setValue(0);\n  return false;\n}"},"children":[],"expanded":false,"type":"number"}],"expanded":false,"type":"column"},{"configs":{"text":"<font color='red'>*<\/font>{#DESCRIPTION_COL#}","width":"200","dataIndex":"DESCRIPTION","titleAlign":"center","itemId":"DESCRIPTION_COL5"},"children":[{"configs":{"allowBlank":"false","itemId":"editor"},"children":[],"expanded":false,"type":"text"}],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"},{"configs":{"region":"center","pagingBar":"false","hidden":"true","itemId":"grid6","editable":"true"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/ar/pay/DB/select_xc_ar_pay_l"},"events":{"beforeload":"operation.params = {\n  AR_PAY_H_ID : Wb.ar_pay_h_id\n};"},"children":[],"expanded":false,"type":"store"},{"configs":{"normalName":"grid6Tbar","itemId":"tbar"},"children":[{"configs":{"text":"{#addSaleTypeBtn#}","itemId":"addSaleTypeBtn6","iconCls":"insert_icon"},"events":{"click":"var ledgerId = app.LEDGER_ID_XWL.LEDGER_ID.getValue();\nvar arDocCatCode = app.AR_DOC_CAT_CODE.getValue();\n\nif(Wb.isEmpty(ledgerId)){\n  Wb.toast('请先选择账簿！');\n  return false;\n}\nvar curGrid = app.grid;\nWb.run({\n  url: 'm?xwl=xc/ar/pay/LOV/LOV_SELECT_SALE_TYPE_WIN', \n  success: function(app) {\n    app.initWin({\n      LEDGER_ID : ledgerId,\n      AR_DOC_CAT_CODE : arDocCatCode,\n      hideFun:function(rs){\n        Wb.each(rs, function(r) {\n          r.set('AR_SALE_TYPE_ID',r.get('AR_SALE_TYPE_ID'));\n          r.set('AR_SALE_TYPE_NAME',r.get('AR_SALE_TYPE_NAME'));\n          r.set('BG_ITEM_ID',r.get('BG_ITEM_ID'));\n          r.set('BG_ITEM_NAME',r.get('BG_ITEM_NAME'));\n          r.set('PRODUCT_ID',r.get('PRODUCT_ID'));\n          r.set('PRODUCT_NAME',r.get('PRODUCT_NAME'));\n          r.set('ACC_ID',r.get('ACC_ID'));\n          r.set('ACC_NAME',r.get('ACC_NAME'));\n          r.set('AMOUNT',r.get('PAY_AMT'));\n          \n          var grid1Store = curGrid.getStore();\n          for(var i=0;i<grid1Store.getCount();i++){\n            var gr = grid1Store.getAt(i);\n            if(gr.get('AR_PUR_TYPE_ID')==r.get('AR_PUR_TYPE_ID')){\n              return false;\n            }\n          }\n          Wb.add(curGrid,r.data, 'after', 1, false);\n        });\n      }\n    });\n  }\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#deleteBtn#}","itemId":"deleteBtn6","iconCls":"file_delete_icon"},"events":{"click":"Wb.remove(app.grid6);\n"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#rownum#}","align":"center","xtype":"rownumberer","titleAlign":"center","itemId":"ROWNUM_COL6"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#AR_SALE_TYPE_NAME_COL#}","width":"150","dataIndex":"AR_SALE_TYPE_NAME","titleAlign":"center","itemId":"AR_SALE_TYPE_NAME_COL6"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#BG_ITEM_NAME_COL#}","hidden":"true","width":"150","dataIndex":"BG_ITEM_NAME","titleAlign":"center","itemId":"BG_ITEM_NAME_COL6"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#PRODUCT_NAME_COL#}","hidden":"true","width":"150","dataIndex":"PRODUCT_NAME","titleAlign":"center","itemId":"PRODUCT_NAME_COL6"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"<font color='red'>*<\/font>{#ACC_NAME_COL#}","dataIndex":"ACC_NAME","titleAlign":"center","itemId":"ACC_NAME_COL6"},"children":[{"configs":{"labelWidth":"100","allowBlank":"false","labelAlign":"right","normalName":"ACC_NAME_PICK5","itemId":"editor"},"events":{"change":"var r=app.grid.getSelectionModel().getSelection()[0];\nr.set('CCID','');\nr.set('CCID_NAME','');"},"children":[{"configs":{"tagConfigs":"minWidth:400","height":"300","itemId":"pickComp"},"events":{"itemdblclick":"var r=app.grid.getSelectionModel().getSelection()[0];\nr.set('ACC_ID',record.data.ACC_ID);\nr.set('ACC_NAME',record.data.ACC_NAME);\nr.dirty = true;\napp.ACC_NAME_PICK5.setValue(record.data.ACC_NAME);\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/com-lov/ACC_ID_PICK/DB/XC_BG_LD_ACCOUNTS_SELECT_LD"},"events":{"beforeload":"operation.params = Wb.getValue([app.form1,app.tbar]);"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"科目id","hidden":"true","dataIndex":"ACC_ID","itemId":"ACC_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"科目编码","dataIndex":"ACC_CODE","itemId":"ACC_CODE_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"科目名称","dataIndex":"ACC_NAME","itemId":"ACC_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"100","emptyText":"科目编码/名称","labelAlign":"right","itemId":"QUERY_CODE_NAME"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.pickComp.getStore().load();\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":false,"type":"column"},{"configs":{"text":"{#CCID_NAME_COL#}","dataIndex":"CCID_NAME","titleAlign":"center","itemId":"CCID_NAME_COL6"},"children":[{"configs":{"displayField":"CCID_NAME","triggerCls":"x-form-search-trigger","valueField":"CCID","itemId":"editor","onTriggerClick":"  // 账簿\n  var ledgerId = app.LEDGER_ID_XWL.LEDGER_ID.getValue() ;\n  if(ledgerId === \"\" ||ledgerId === null || ledgerId === undefined){\n    Wb.info('请选择账簿!') ;\n    return false ;\n  }\n  \n  // 会计日期\n  var accDate = app.GL_DATE.getValue() ;\n  if(accDate === \"\" ||accDate === null || accDate === undefined){\n    Wb.info('请选择会计日期!') ;\n    return false ;\n  }else{\n\taccDate = Wb.dateToStr(accDate).substring(0,7);\n  }\n  \n  // TODO: 当前选中\n  var r = app.grid.getSelection()[0] ; \n  \n  // TODO: 显示科目选择窗口\n  Wb.run({\n    url:'m?xwl=xc/gl/journal/v-windows/handler-ccid-win',\n    params : {\n      'ledgerId' : ledgerId,\n      'vtype' : '{#vtype#}'\n    },          \n    success:function(appObj){\n      appObj.initWindow({\n        accName : r.data.ACC_NAME,\n        ledgerId : ledgerId,\n        periodCode : accDate ,\n        groupId : 'ALL',\n        handlerCCID : function(returnObj){\n          // TODO: 处理CCID信息\n          var rObj = Wb.decode(returnObj) ;\n          r.set('ACC_ID', rObj.acc_id) ;    \n          r.set('ACC_NAME', rObj.acc_name);\n          r.set('CCID', rObj.acc_ccid) ;    \n          r.set('CCID_NAME', rObj.acc_ccid_name);\n          if(!Wb.isEmpty(rObj.dim_id)){\n          r.set('DIM_ID', rObj.dim_id) ;\n          r.set('DIM_NAME', rObj.dim_name) ;\n          }\n          // 禁用账簿\n           app.LEDGER_ID_XWL.LEDGER_ID.setReadOnly(true) ;\n        }\n      });\n    }  \n  }) ;   "},"events":{"beforequery":"var combo = e.combo;\nif(!e.forceAll){\n  var value = e.query;\n  combo.store.filterBy(function(record,id){\n    var text = record.get(combo.displayField);\n    return (text.indexOf(value)!=-1);\n  });\n  combo.expand();\n  return false;\n}","specialkey":"// TODO: 按回车键执行借方和贷方金额切换\nif (e.getKey() == e.ENTER) {\n  // 账簿\n  var ledgerId = app.LEDGER_ID_XWL.LEDGER_ID.getValue() ;\n  if(ledgerId === \"\" ||ledgerId === null || ledgerId === undefined){\n    Wb.info('请选择账簿!') ;\n    return false ;\n  }\n  \n  // 会计日期\n  var accDate = app.GL_DATE.getValue();\n  if(accDate === \"\" ||accDate === null || accDate === undefined){\n    Wb.info('请选择会计日期!') ;\n    return false ;\n  }else{\n    accDate = Wb.dateToStr(accDate).substring(0,7);\n  }\n  \n  // TODO: 当前选中\n  var r = app.grid.getSelection()[0] ; \n  \n  // TODO: 显示科目选择窗口\n  Wb.run({\n    url:'m?xwl=xc/gl/journal/v-windows/handler-ccid-win',\n    params : {\n      'ledgerId' : ledgerId ,\n      'vtype' : '{#vtype#}'\n    },          \n    success:function(appObj){\n      appObj.initWindow({\n        accName : r.data.ACC_NAME,\n        ledgerId : ledgerId,\n        periodCode : accDate ,\n        groupId : 'ALL',\n        handlerCCID : function(returnObj){\n          // TODO: 处理CCID信息\n          var rObj = Wb.decode(returnObj) ;\n          r.set('ACC_ID', rObj.acc_id) ;    \n          r.set('ACC_NAME', rObj.acc_name);\n          r.set('CCID', rObj.acc_ccid) ;    \n          r.set('CCID_NAME', rObj.acc_ccid_name);\n          if(!Wb.isEmpty(rObj.dim_id)){\n            r.set('DIM_ID', rObj.dim_id) ;\n            r.set('DIM_NAME', rObj.dim_name) ;\n          }\n          // 禁用账簿\n           app.LEDGER_ID_XWL.LEDGER_ID.setReadOnly(true) ;\n        }\n      });\n    }  \n  }) ;   \n}"},"children":[],"expanded":true,"type":"combo"}],"expanded":false,"type":"column"},{"configs":{"text":"<font color='red'>*<\/font>{#AMOUNT_COL#}","align":"right","dataIndex":"AMOUNT","titleAlign":"center","itemId":"AMOUNT_COL6","renderer":"return Ext.util.Format.number(value,'0,000.00');"},"children":[{"configs":{"allowBlank":"false","itemId":"editor"},"events":{"change":"if(newValue > 0){\n  Wb.toast('金额应小于 0 ！');\n  number.setValue(0);\n  return false;\n}"},"children":[],"expanded":false,"type":"number"}],"expanded":false,"type":"column"},{"configs":{"text":"<font color='red'>*<\/font>{#DESCRIPTION_COL#}","width":"200","dataIndex":"DESCRIPTION","titleAlign":"center","itemId":"DESCRIPTION_COL6"},"children":[{"configs":{"allowBlank":"false","itemId":"editor"},"children":[],"expanded":false,"type":"text"}],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"},{"configs":{"region":"south","itemId":"form2"},"children":[{"configs":{"layout":"column","margin":"5 10 5 10","border":"false","itemId":"tr1"},"children":[{"configs":{"layout":"fit","columnWidth":".25","border":"false","itemId":"td1"},"children":[{"configs":{"itemId":"CREATED_BY"},"children":[],"expanded":false,"type":"hidden"},{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"CREATED_BY_NAME","fieldLabel":"{#CREATED_BY_NAME#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".25","border":"false","itemId":"td2"},"children":[{"configs":{"itemId":"SIGNATORY_ID"},"children":[],"expanded":false,"type":"hidden"},{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"SIGNATORY","fieldLabel":"{#SIGNATORY#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".25","border":"false","itemId":"td3"},"children":[{"configs":{"itemId":"V_HEAD_ID"},"children":[],"expanded":false,"type":"hidden"},{"configs":{"labelWidth":"80","readOnly":"true","hidden":"true","labelAlign":"right","itemId":"V_STATUS","fieldLabel":"{#V_STATUS#}"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"V_STATUS_NAME","fieldLabel":"{#V_STATUS#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"form"}],"expanded":true,"type":"panel"},{"configs":{"file":"m?xwl=xc/gl/journal/v-windows/new-xwl-voucher","itemId":"edit_v_xwl"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"tab"}],"expanded":true,"type":"window"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}