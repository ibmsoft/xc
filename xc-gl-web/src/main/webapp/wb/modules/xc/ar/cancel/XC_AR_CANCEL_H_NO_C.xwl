{"inframe":false,"title":"","hidden":false,"roles":{"default":1},"children":[{"configs":{"serverScript":"//三方语言,引入对应的json文件\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,'xc/ar/cancel/json/XC_AR_CANCEL_H_NO_C');\n\nvar contextPath = request.getContextPath();\nrequest.setAttribute(\"contextPath\",contextPath);\nrequest.setAttribute('opmode','view');\nrequest.setAttribute('vtype','normal');","head":"<style type=\"text/css\">\n  .my_custom_grid .x-grid-row{\n      height:50px;\n  }\n  .my_custom_grid .x-grid-editor .x-form-text{\n      height:49px;\n  }\n  .my_custom_grid .x-grid-cell{\n      font: normal 12px/13px tahoma, arial, verdana, sans-serif;\n  }\n  .my_custom_grid .x-grid-cell{\n      border-color: #d0d0d0;\n  }\n  .my_custom_grid .x-grid-with-col-lines .x-grid-cell {\n    border-right-width: 1px;\n  }\n  .my_custom_grid .x-grid-with-row-lines .x-grid-td {\n    border-bottom-width: 1px;\n}\n<\/style>","itemId":"module"},"events":{"initialize":"Wb.keyValue = '';\nWb.isInsert = 'Y';\nWb.arCancelType = 'YSHYUS';\nWb.ar_inv_gl_h_id = '';//应收单id\nWb.ar_inv_h_id = '';//发票id\nWb.flag = '';\nWb.vAmount = 0;\nvar deleteDtl = [];\nWb.formValue = '';\nExt.apply(app, {\n  initWin: function(params) {\n    Ext.apply(app, params);\n    app.editWinN = new Ext.window.Window(app.editWinN);\n    app.editWinN.show();\n    app.AR_CANCEL_TYPE.setValue(params.AR_CANCEL_TYPE);\n    Wb.isInsert = params.IS_INSERT;\n    Wb.keyValue = params.AR_CANCEL_H_ID;\n    Wb.arCancelType = params.AR_CANCEL_TYPE;\n    Wb.ar_inv_gl_h_id = params.AR_INV_GL_H_ID;\n    Wb.ar_inv_h_id = params.AR_INV_H_ID;\n    Wb.flag = params.flag;\n    app.AR_DOC_CAT_CODE.setValue(params.AR_DOC_CAT_CODE);\n    app.NO_CANCEL_AMT.setValue(params.NO_CANCEL_AMT);\n    //          \n    //隐藏新增按钮\n    if(Wb.flag == 'cancel'){\n      app.addBtn.hide();\n    }\n    if(Wb.isInsert=='Y'){//新增\n      app.AR_CANCEL_H_ID.setValue(Xip.getId());\n      app.GL_DATE.setValue(new Date());\n      app.grid1.getStore().reload({params:{\n        AR_CANCEL_H_ID:app.AR_CANCEL_H_ID.getValue()\n      }});\n      if(Wb.arCancelType=='YSHYUS'){//应收核预收\n        app.gridSelect.setText('{#initMsg1#}');\n        app.TARGET_CODE.setText('<span style=\"color: rgb(255, 0, 0); padding-left: 2px;\">*<\/span>'+'{#receiveDoc#}');\n        app.td_2_1_1.show();\n        app.AR_INV_GL_H_ID_XWL.QUERY_CANCEL_TYPE.setValue('YSHYUS');\n        app.AR_INV_GL_H_ID_XWL.AR_INV_GL_H_CODE.allowBlank=false;\n        app.AR_INV_GL_H_ID_XWL.AR_INV_GL_H_CODE.setFieldLabel('<span style=\"color: rgb(255, 0, 0); padding-left: 2px;\">*<\/span>'+'{#shouldReceiveDoc#}');\n      }\n      if(Wb.arCancelType=='YSHLDC'){//应收红蓝对冲\n        app.gridSelect.setText('{#initMsg2#}');\n        app.TARGET_CODE.setText('<span style=\"color: rgb(255, 0, 0); padding-left: 2px;\">*<\/span>'+'{#shouldReceiveDoc#}');\n        app.td_2_1_1.show();\n        app.AR_INV_GL_H_ID_XWL.QUERY_CANCEL_TYPE.setValue('YSHLDC');\n        app.AR_INV_GL_H_ID_XWL.AR_INV_GL_H_CODE.allowBlank=false;\n        app.AR_INV_GL_H_ID_XWL.AR_INV_GL_H_CODE.setFieldLabel('<span style=\"color: rgb(255, 0, 0); padding-left: 2px;\">*<\/span>'+'{#shouldReceiveDoc#}');\n        app.AR_INV_GL_H_ID_XWL.AR_INV_GL_H_CODE.getPicker().store.proxy.url = 'm?xwl=xc/ar/ar-com-lov/AR_INV_GL_H_ID_PICK/DB/XC_AR_INQ_GL_H_SELECT_HL1';\n      }\n      if(Wb.arCancelType=='YSHYF'){//应收核应付\n        app.gridSelect.setText('{#initMsg3#}');\n        app.TARGET_CODE.setText('<span style=\"color: rgb(255, 0, 0); padding-left: 2px;\">*<\/span>'+'{#shouldPayDoc#}');\n        app.td_2_1_1.show();\n        app.AR_INV_GL_H_ID_XWL.QUERY_CANCEL_TYPE.setValue('YSHYF');\n        app.AR_INV_GL_H_ID_XWL.AR_INV_GL_H_CODE.allowBlank=false;\n        app.AR_INV_GL_H_ID_XWL.AR_INV_GL_H_CODE.setFieldLabel('<span style=\"color: rgb(255, 0, 0); padding-left: 2px;\">*<\/span>'+'{#shouldReceiveDoc#}');\n        app.AR_INV_GL_H_ID_XWL.AR_INV_GL_H_CODE.getPicker().store.proxy.url = 'm?xwl=xc/ar/ar-com-lov/AR_INV_GL_H_ID_PICK/DB/XC_AR_INQ_GL_H_SELECT_HL2';\n      }\n      if(Wb.arCancelType=='YUSHLDC'){//预收红蓝对冲\n        app.gridSelect.setText('{#initMsg1#}');\n        app.TARGET_CODE.setText('<span style=\"color: rgb(255, 0, 0); padding-left: 2px;\">*<\/span>'+'{#receiveDoc#}');\n        app.td_2_1_2.show();\n        app.AR_PAY_H_ID_XWL.AR_PAY_H_CODE.allowBlank=false;\n        app.AR_PAY_H_ID_XWL.AR_PAY_H_CODE.setFieldLabel('<span style=\"color: rgb(255, 0, 0); padding-left: 2px;\">*<\/span>'+'{#receiveDoc#}');\n      }\n\n\n      //判断应收单id是否为空\n      if(!Wb.isEmpty(Wb.ar_inv_gl_h_id)){\n        Wb.request({\n          url: 'm?xwl=xc/ar/gl/DB/XC_AR_INV_GL_H_SELECT_BY_ID',\n          params: {AR_INV_GL_H_ID:Wb.ar_inv_gl_h_id},\n          success: function(resp) {\n            var r = Wb.decode(resp.responseText);\n            app.LEDGER_ID_XWL.LEDGER_ID.setValue(r.LEDGER_ID);\n            app.LEDGER_ID_XWL.LEDGER_NAME.setValue(r.LEDGER_NAME);\n            app.AR_INV_GL_H_ID_XWL.AR_INV_GL_H_ID.setValue(Wb.ar_inv_gl_h_id);\n            app.AR_INV_GL_H_ID_XWL.AR_INV_GL_H_CODE.setValue(r.AR_INV_GL_H_CODE);\n            app.CUSTOMER_ID_XWL.CUSTOMER_ID.setValue(r.CUSTOMER_ID);\n            app.CUSTOMER_ID_XWL.CUSTOMER_NAME.setValue(r.CUSTOMER_NAME);\n            app.SRC_AMT.setValue(r.CANCEL_AMT);\n            app.SRC_ID.setValue(Wb.ar_inv_gl_h_id);\n            app.AR_INV_GL_H_ID.setValue(Wb.ar_inv_gl_h_id);\n\n            app.LEDGER_ID_XWL.LEDGER_NAME.setReadOnly(true);\n            app.AR_INV_GL_H_ID_XWL.AR_INV_GL_H_CODE.setReadOnly(true);\n            app.CUSTOMER_ID_XWL.CUSTOMER_NAME.setReadOnly(true);\n            app.SRC_AMT.setReadOnly(true);\n\n            app.AR_CONTRACT_ID.setValue(r.AR_CONTRACT_ID);\n\n          }\n        });\n      }\n      //判断发票id是否为空\n      if(!Wb.isEmpty(Wb.ar_inv_h_id)){\n        Wb.request({\n          url: 'm?xwl=xc/ar/cancel/DB/XC_AR_INV_PRE_SELECT',\n          params: {\n            AR_INV_H_ID:Wb.ar_inv_h_id,\n            AR_CANCEL_H_ID:app.AR_CANCEL_H_ID.getValue(),\n            AR_CANCEL_TYPE:'YSHYUS'\n          },\n          success: function(resp) {\n            var r = Wb.decode(resp.responseText);\n            var i = 0;\n            Wb.each(r.rows, function(row) {\n              Wb.add(app.grid1, {\n                AR_CANCEL_L_ID:Xip.getId(),\n                AR_CANCEL_H_ID:app.AR_CANCEL_H_ID.getValue(),\n                AR_CANCEL_TYPE:Wb.arCancelType,\n                TARGET_ID:row.AR_PAY_H_ID,\n                TARGET_AMT:row.CANCEL_AMT,\n                SRC_CODE:row.AR_PAY_H_CODE,\n                AR_CONTRACT_NAME:row.AR_CONTRACT_NAME,\n                CUSTOMER_NAME:row.CUSTOMER_NAME,\n                DEPT_NAME:row.DEPT_NAME,\n                PROJECT_NAME:row.PROJECT_NAME,\n                ACC_NAME:row.SALE_ACC_NAME,\n                DESCRIPTION:row.DESCRIPTION\n              }, 'after', 1, false);\n            });\n          }\n        });\n      }\n\n      //若应付单id和采购发票id都为空，则进行初始化操作\n      if(Ext.isEmpty(Wb.ar_inv_gl_h_id) && Ext.isEmpty(Wb.ar_inv_h_id)){\n        app.ldInitStore.load();\n      }\n    }//Y结束\n\n    if(Wb.isInsert=='N'){//修改\n      Wb.request({\n        url: 'm?xwl=xc/ar/cancel/DB/XC_AR_CANCEL_H_SELECT_BY_ID',\n        params: {AR_CANCEL_H_ID:Wb.keyValue},\n        success: function(resp) {\n          var r = Wb.decode(resp.responseText);\n\n          r.GL_DATE=Wb.strToDate(r.GL_DATE);\n          if(r.V_STATUS === '1' || r.V_STATUS_NAME === '' || r.V_STATUS_NAME === null){//凭证状态为草稿，空\n            app.saveBtn.setDisabled(false);\n            app.verfyBtn.setDisabled(false);\n          }\n          else{\n            app.saveBtn.setDisabled(true);\n            app.verfyBtn.setDisabled(true);\n            app.cancelVerfyBtn.setDisabled(false);\n          }\n          Wb.setValue(app.editWinN,r);//赋值\n          app.LEDGER_ID_XWL.LEDGER_NAME.setReadOnly(true);\n          app.CUSTOMER_ID_XWL.CUSTOMER_NAME.setReadOnly(true);\n          app.AR_INV_GL_H_ID_XWL.AR_INV_GL_H_CODE.setReadOnly(true);\n          app.AR_PAY_H_ID_XWL.AR_PAY_H_CODE.setReadOnly(true);\n          Wb.arCancelType = r.AR_CANCEL_TYPE;\n          app.AR_INV_GL_H_ID_XWL.QUERY_CUSTOMER_ID.setValue(r.CUSTOMER_ID);\n          app.AR_PAY_H_ID_XWL.QUERY_CUSTOMER_ID.setValue(r.CUSTOMER_ID);\n          app.grid1.getStore().reload({\n            params:{'AR_CANCEL_H_ID':Wb.keyValue}\n          });\n\n          if(Wb.arCancelType=='YUSHLDC'){//预收红蓝对冲\n            app.gridSelect.setText('{#initMsg1#}');\n            app.TARGET_CODE.setText('<span style=\"color: rgb(255, 0, 0); padding-left: 2px;\">*<\/span>'+'{#receiveDoc#}');\n            app.td_2_1_2.show();\n            app.AR_PAY_H_ID_XWL.AR_PAY_H_CODE.allowBlank=false;\n            app.AR_PAY_H_ID_XWL.AR_PAY_H_CODE.setFieldLabel('<span style=\"color: rgb(255, 0, 0); padding-left: 2px;\">*<\/span>'+'{#receiveDoc#}');\n          }\n          if(Wb.arCancelType=='YSHLDC'){//应收红蓝对冲\n            app.gridSelect.setText('{#initMsg2#}');\n            app.TARGET_CODE.setText('<span style=\"color: rgb(255, 0, 0); padding-left: 2px;\">*<\/span>'+'{#shouldReceiveDoc#}');\n            app.td_2_1_1.show();\n            app.AR_INV_GL_H_ID_XWL.AR_INV_GL_H_CODE.allowBlank=false;\n            app.AR_INV_GL_H_ID_XWL.AR_INV_GL_H_CODE.setFieldLabel('<span style=\"color: rgb(255, 0, 0); padding-left: 2px;\">*<\/span>'+'{#shouldReceiveDoc#}');\n          }\n          if(Wb.arCancelType=='YSHYUS'){//应收核预收\n            app.gridSelect.setText('{#initMsg1#}');\n            app.TARGET_CODE.setText('<span style=\"color: rgb(255, 0, 0); padding-left: 2px;\">*<\/span>'+'{#receiveDoc#}');\n            app.td_2_1_1.show();\n            app.AR_INV_GL_H_ID_XWL.AR_INV_GL_H_CODE.allowBlank=false;\n            app.AR_INV_GL_H_ID_XWL.AR_INV_GL_H_CODE.setFieldLabel('<span style=\"color: rgb(255, 0, 0); padding-left: 2px;\">*<\/span>'+'{#shouldReceiveDoc#}');\n          }\n          if(Wb.arCancelType=='YSHYF'){//应收核应付\n            app.gridSelect.setText('{#initMsg3#}');\n            app.TARGET_CODE.setText('<span style=\"color: rgb(255, 0, 0); padding-left: 2px;\">*<\/span>'+'{#shouldPayDoc#}');\n            app.td_2_1_1.show();\n            app.AR_INV_GL_H_ID_XWL.QUERY_CANCEL_TYPE.setValue('YSHYF');\n            app.AR_INV_GL_H_ID_XWL.AR_INV_GL_H_CODE.allowBlank=false;\n            app.AR_INV_GL_H_ID_XWL.AR_INV_GL_H_CODE.setFieldLabel('<span style=\"color: rgb(255, 0, 0); padding-left: 2px;\">*<\/span>'+'{#shouldReceiveDoc#}');\n          }\n          Wb.formValue = Wb.encode(Wb.getValue(app.form1));\n\n        }\n\n      });\n      Wb.ar_inv_gl_h_id='';\n      app.AR_INV_GL_H_ID_XWL.AR_INV_GL_H_CODE.on({\n      \tfocus:function(picker,e,op){\n          Wb.request({\n          \turl:'m?xwl=xc/ar/cancel/DB/getArInvNoCancelAmt',\n            params:{'srcId':app.AR_INV_GL_H_ID_XWL.AR_INV_GL_H_ID.getValue()},\n            success:function(resp){\n              var rec = Wb.decode(resp.responseText);\n              Wb.toast('{#focusMsg1#}'+rec.rows[0].NO_PAY_AMT);\n          }\n          });\n        }\n      });\n      app.AR_PAY_H_ID_XWL.AR_PAY_H_CODE.on({\n      \tfocus:function(picker,e,op){\n          Wb.request({\n          \turl:'m?xwl=xc/ar/cancel/DB/getArPayNoCancelAmt',\n            params:{'srcId':app.AR_PAY_H_ID_XWL.AR_PAY_H_ID.getValue()},\n            success:function(resp){\n               var rec = Wb.decode(resp.responseText);\n               Wb.toast('{#focusMsg2#}'+rec.rows[0].NO_CANCEL_AMT);\n            }\n          });\n        }\n      });\n    }\n\n    if(Wb.isInsert=='S'){//查看\n      Wb.request({\n        url: 'm?xwl=xc/ar/cancel/DB/XC_AR_CANCEL_H_SELECT_BY_ID',\n        params: {AR_CANCEL_H_ID:Wb.keyValue},\n        success: function(resp) {\n          var r = Wb.decode(resp.responseText);\n          r.GL_DATE=Wb.strToDate(r.GL_DATE);\n          Wb.setValue(app.editWinN,r);//赋值\n          app.AR_INV_GL_H_ID_XWL.QUERY_CUSTOMER_ID.setValue(r.CUSTOMER_ID);\n          app.AR_PAY_H_ID_XWL.QUERY_CUSTOMER_ID.setValue(r.CUSTOMER_ID);\n          Wb.arCancelType = r.AR_CANCEL_TYPE;\n          app.grid1.getStore().reload({params:{\n            AR_CANCEL_H_ID:Wb.keyValue\n          }});\n          if(Wb.arCancelType=='YUSHLDC'){//预收红蓝对冲\n            app.gridSelect.setText('{#initMsg1#}');\n            app.TARGET_CODE.setText('<span style=\"color: rgb(255, 0, 0); padding-left: 2px;\">*<\/span>'+'{#receiveDoc#}');\n            app.td_2_1_2.show();\n            app.AR_PAY_H_ID_XWL.AR_PAY_H_CODE.allowBlank=false;\n            app.AR_PAY_H_ID_XWL.AR_PAY_H_CODE.setFieldLabel('<span style=\"color: rgb(255, 0, 0); padding-left: 2px;\">*<\/span>'+'{#receiveDoc#}');\n          }\n          if(Wb.arCancelType=='YSHLDC'){//应收红蓝对冲\n            app.gridSelect.setText('{#initMsg2#}');\n            app.TARGET_CODE.setText('<span style=\"color: rgb(255, 0, 0); padding-left: 2px;\">*<\/span>'+'{#shouldReceiveDoc#}');\n            app.td_2_1_1.show();\n            app.AR_INV_GL_H_ID_XWL.AR_INV_GL_H_CODE.allowBlank=false;\n            app.AR_INV_GL_H_ID_XWL.AR_INV_GL_H_CODE.setFieldLabel('<span style=\"color: rgb(255, 0, 0); padding-left: 2px;\">*<\/span>'+'{#shouldReceiveDoc#}');\n          }\n          if(Wb.arCancelType=='YSHYUS'){//应收核预收\n            app.gridSelect.setText('{#initMsg1#}');\n            app.TARGET_CODE.setText('<span style=\"color: rgb(255, 0, 0); padding-left: 2px;\">*<\/span>'+'{#receiveDoc#}');\n            app.td_2_1_1.show();\n            app.AR_INV_GL_H_ID_XWL.AR_INV_GL_H_CODE.allowBlank=false;\n            app.AR_INV_GL_H_ID_XWL.AR_INV_GL_H_CODE.setFieldLabel('<span style=\"color: rgb(255, 0, 0); padding-left: 2px;\">*<\/span>'+'{#shouldReceiveDoc#}');\n          }\n          if(Wb.arCancelType=='YSHYF'){//应收核应付\n            app.gridSelect.setText('{#initMsg3#}');\n            app.TARGET_CODE.setText('<span style=\"color: rgb(255, 0, 0); padding-left: 2px;\">*<\/span>'+'{#shouldPayDoc#}');\n            app.td_2_1_1.show();\n            app.AR_INV_GL_H_ID_XWL.QUERY_CANCEL_TYPE.setValue('YSHYF');\n            app.AR_INV_GL_H_ID_XWL.AR_INV_GL_H_CODE.allowBlank=false;\n            app.AR_INV_GL_H_ID_XWL.AR_INV_GL_H_CODE.setFieldLabel('<span style=\"color: rgb(255, 0, 0); padding-left: 2px;\">*<\/span>'+'{#shouldReceiveDoc#}');\n          }\n        }\n      });\n      app.form1Tbar.hide();\n      app.grid1Tbar.hide();\n      Wb.ar_inv_gl_h_id='';\n    }\n    app.LEDGER_ID_XWL.LEDGER_NAME.allowBlank=false;\n\n  }\n});\nfunction returnRowFn(r,type){\n  if(type=='xc_gl_ledgers'){//选中账簿\n    app.AR_INV_GL_H_ID_XWL.QUERY_LEDGER_ID.setValue(r.data.LEDGER_ID);\n    app.CUSTOMER_ID_XWL.QUERY_LEDGER_ID.setValue(r.data.LEDGER_ID);\n    app.CUSTOMER_ID_XWL.CUSTOMER_NAME.getPicker().getStore().removeAll();\n    app.AR_PAY_H_ID_XWL.QUERY_LEDGER_ID.setValue(r.data.LEDGER_ID);\n    app.CUSTOMER_ID_XWL.CUSTOMER_ID.setValue('');\n    app.CUSTOMER_ID_XWL.CUSTOMER_NAME.setValue('');\n    app.AR_INV_GL_H_ID_XWL.AR_INV_GL_H_CODE.setValue('');\n    app.AR_INV_GL_H_ID_XWL.AR_INV_GL_H_ID.setValue('');\n    app.AR_INV_GL_H_ID_XWL.AR_INV_GL_H_CODE.getPicker().getStore().removeAll();\n    app.AR_PAY_H_ID_XWL.AR_PAY_H_CODE.setValue('');\n    app.AR_PAY_H_ID_XWL.AR_PAY_H_ID.setValue('');\n    app.AR_PAY_H_ID_XWL.AR_PAY_H_CODE.getPicker().getStore().removeAll();\n    Wb.request({\n      url:'m?xwl=xc/ap/req/DB/getPeriodDate',\n      params:{'LEDGER_ID':r.data.LEDGER_ID},\n      success:function(resp){\n        var rec = Wb.decode(resp.responseText);\n        app.GL_DATE.setMinValue(new Date(rec.rows[0].START_DATE));\n      }\n    });\n  }\n  if(type=='xc_ar_inv_gl_h'){//选中应收单\n    app.SRC_ID.setValue(r.data.AR_INV_GL_H_ID);\n    app.CUSTOMER_ID_XWL.CUSTOMER_ID.setValue(r.data.CUSTOMER_ID);\n    app.CUSTOMER_ID_XWL.CUSTOMER_NAME.setValue(r.data.CUSTOMER_NAME);\n    app.AR_DOC_CAT_CODE.setValue(r.data.AR_DOC_CAT_CODE);\n    app.AR_INV_GL_H_ID.setValue(r.data.AR_INV_GL_H_ID);\n    app.NO_CANCEL_AMT.setValue(app.AR_INV_GL_H_ID_XWL.AR_INV_GL_H_CODE.getPicker().getSelection()[0].data.NO_PAY_AMT); \n    Wb.vAmount = Math.abs(app.AR_INV_GL_H_ID_XWL.AR_INV_GL_H_CODE.getPicker().getSelection()[0].data.NO_PAY_AMT);\n  }\n  if(type=='xc_ar_pay_h'){//选中收款单\n    app.SRC_ID.setValue(r.data.AR_PAY_H_ID);\n    app.CUSTOMER_ID_XWL.CUSTOMER_ID.setValue(r.data.CUSTOMER_ID);\n    app.CUSTOMER_ID_XWL.CUSTOMER_NAME.setValue(r.data.CUSTOMER_NAME);\n    app.AR_DOC_CAT_CODE.setValue(r.data.AR_DOC_CAT_CODE);\n    app.NO_CANCEL_AMT.setValue(Math.abs(app.AR_PAY_H_ID_XWL.AR_PAY_H_CODE.getPicker().getSelection()[0].data.NO_CANCEL_AMT)); \n    Wb.vAmount = Math.abs(app.AR_PAY_H_ID_XWL.AR_PAY_H_CODE.getPicker().getSelection()[0].data.NO_CANCEL_AMT);\n  }\n  if (type == 'xc_ar_customers') {//选中客户\n    app.AR_INV_GL_H_ID_XWL.QUERY_CUSTOMER_ID.setValue(r.data.CUSTOMER_ID);\n    app.AR_INV_GL_H_ID_XWL.AR_INV_GL_H_CODE.setValue('');\n    app.AR_INV_GL_H_ID_XWL.AR_INV_GL_H_ID.setValue('');\n    app.AR_PAY_H_ID_XWL.QUERY_CUSTOMER_ID.setValue(r.data.CUSTOMER_ID);\n    app.AR_PAY_H_ID_XWL.AR_PAY_H_CODE.setValue('');\n    app.AR_PAY_H_ID_XWL.AR_PAY_H_ID.setValue('');\n  }\n}\n\nfunction clearOtherFn(type){\n  if(type=='xc_gl_ledgers'){//选中账簿\n    app.SRC_ID.setValue('');\n    app.CUSTOMER_ID_XWL.QUERY_LEDGER_ID.setValue('');\n    app.CUSTOMER_ID_XWL.CUSTOMER_ID.setValue('');\n    app.CUSTOMER_ID_XWL.CUSTOMER_NAME.setValue('');\n    app.CUSTOMER_ID_XWL.CUSTOMER_NAME.getPicker().getStore().removeAll();\n    app.AR_INV_GL_H_ID_XWL.QUERY_LEDGER_ID.setValue('');\n    app.AR_INV_GL_H_ID_XWL.AR_INV_GL_H_CODE.setValue('');\n    app.AR_INV_GL_H_ID_XWL.AR_INV_GL_H_ID.setValue('');\n    app.AR_INV_GL_H_ID_XWL.AR_INV_GL_H_CODE.getPicker().getStore().removeAll();\n    app.AR_PAY_H_ID_XWL.QUERY_LEDGER_ID.setValue('');\n    app.AR_PAY_H_ID_XWL.AR_PAY_H_CODE.setValue('');\n    app.AR_PAY_H_ID_XWL.AR_PAY_H_ID.setValue('');\n    app.AR_PAY_H_ID_XWL.AR_PAY_H_CODE.getPicker().getStore().removeAll();\n  }\n  if(type=='xc_ar_customers'){\n    app.AR_INV_GL_H_ID_XWL.AR_INV_GL_H_CODE.setValue('');\n    app.AR_INV_GL_H_ID_XWL.AR_INV_GL_H_ID.setValue('');\n    app.AR_INV_GL_H_ID_XWL.AR_INV_GL_H_CODE.getPicker().getStore().removeAll();\n    app.AR_PAY_H_ID_XWL.AR_PAY_H_CODE.setValue('');\n    app.AR_PAY_H_ID_XWL.AR_PAY_H_ID.setValue('');\n    app.AR_PAY_H_ID_XWL.AR_PAY_H_CODE.getPicker().getStore().removeAll();\n  }\n  if(type=='xc_ar_pay_h'){\n  }\n}\n"},"children":[{"configs":{"itemId":"request"},"children":[{"configs":{"itemId":"ldInitStore","url":"m?xwl=xc/com-lov/LEDGER_ID_PICK/DB/XC_GL_LEDGERS_SELECT_SEC"},"events":{"load":"if(!Wb.isEmpty(Wb.ar_inv_gl_h_id)||Wb.ar_inv_gl_h_id==''){//当应收单ID或发票ID为空时\n}else{\n  Wb.ledgerStore = store;\n  app.LEDGER_ID_XWL.LEDGER_ID.setValue(store.getAt(0).get('LEDGER_ID'));\n  app.LEDGER_ID_XWL.LEDGER_NAME.setValue(store.getAt(0).get('LEDGER_NAME'));\n\n  app.AR_INV_GL_H_ID_XWL.QUERY_LEDGER_ID.setValue(store.getAt(0).get('LEDGER_ID'));\n  app.CUSTOMER_ID_XWL.QUERY_LEDGER_ID.setValue(store.getAt(0).get('LEDGER_ID'));\n  app.AR_PAY_H_ID_XWL.QUERY_LEDGER_ID.setValue(store.getAt(0).get('LEDGER_ID'));\n}"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"folder"},{"configs":{"itemId":"form1Tbar"},"children":[{"configs":{"text":"{#add#}","itemId":"addBtn","iconCls":"file_add_icon"},"events":{"click":"app.form1.getForm().reset();//查询表格数据重置\napp.AR_CANCEL_H_ID.setValue(Xip.getId());//核销单主表ID赋值\napp.AR_CANCEL_TYPE.setValue(Wb.arCancelType);//核销类型赋值\napp.saveBtn.setDisabled(false);\napp.GL_DATE.setValue(new Date());//业务日期\nvar lstore = app.LEDGER_ID_XWL.LEDGER_NAME.getPicker().getStore();\napp.LEDGER_ID_XWL.LEDGER_NAME.setReadOnly(false);\napp.CUSTOMER_ID_XWL.CUSTOMER_NAME.setReadOnly(false);\napp.AR_INV_GL_H_ID_XWL.AR_INV_GL_H_CODE.setReadOnly(false);\napp.AR_PAY_H_ID_XWL.AR_PAY_H_CODE.setReadOnly(false);\n/*app.LEDGER_ID_XWL.LEDGER_ID.setValue(lstore.getAt(0).get('LEDGER_ID'));\napp.LEDGER_ID_XWL.LEDGER_NAME.setValue(lstore.getAt(0).get('LEDGER_NAME'));\n\napp.AR_INV_GL_H_ID_XWL.QUERY_LEDGER_ID.setValue(lstore.getAt(0).get('LEDGER_ID'));\napp.CUSTOMER_ID_XWL.QUERY_LEDGER_ID.setValue(lstore.getAt(0).get('LEDGER_ID'));\napp.AR_PAY_H_ID_XWL.QUERY_LEDGER_ID.setValue(lstore.getAt(0).get('LEDGER_ID'));\n*/\nWb.isInsert = 'Y';\napp.grid1.getStore().removeAll();\n\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#save#}","itemId":"saveBtn","iconCls":"save_icon"},"events":{"click":"var srcAmt = 0;\nvar noCancelAmount = 0;\nvar str = '(';\nvar dtlCount = app.grid1.getStore().getCount();\nfor(var i = 0;i < app.grid1.getStore().getCount();i++){//计算总的核销金额\n  var r = app.grid1.getStore().getAt(i);\n  srcAmt = srcAmt+r.get('TARGET_AMT');\n  str = str + \"'\"+r.get('AR_CANCEL_L_ID')+ \"',\";\n  if(i==app.grid1.getStore().getCount()-1){\n    str = str +\"'\"+\"'\"+')';\n  }\n}\nif(Wb.arCancelType=='YSHLDC'||Wb.arCancelType=='YUSHLDC'){\n  app.SRC_AMT.setValue(srcAmt*(-1));\n}else if(Wb.arCancelType=='YSHYF'||Wb.arCancelType=='YSHYUS'){\n  app.SRC_AMT.setValue(srcAmt);\n}\nif(Wb.arCancelType=='YSHYF'||Wb.arCancelType=='YSHYUS'||Wb.arCancelType=='YSHLDC'){//应收核应付，应收核预收，应收红蓝对冲\n  if(Wb.isInsert=='Y'){//新增\n    //控制核销金额\n    Wb.request({\n      url:'m?xwl=xc/ar/cancel/DB/getArInvNoCancelAmt',\n      params:{'srcId':app.AR_INV_GL_H_ID_XWL.AR_INV_GL_H_ID.getValue()},\n      success:function(resp){\n        var rec = Wb.decode(resp.responseText);\n\n        if( Math.abs(srcAmt)>Math.abs(rec.rows[0].NO_PAY_AMT)){\n          Wb.toast('{#saveMsg6#}');\n          return;\n        }else{\n          if(!Wb.verify(app.form1)){//判断数据是否合法\n            Wb.toast('{#saveMsg1#}');\n            return;\n          }\n          if(!Wb.verifyGrid(app.grid1)){//判断数据是否合法\n            Wb.toast('{#saveMsg1#}');\n            return;\n          }\n          var getCount = app.grid1.getStore().getCount();//表格store中数据的数量\n          if(getCount===0){\n            Wb.toast('{#saveMsg2#}');\n            return;\n          }\n          var r = app.grid1.getStore().getRange(0,dtlCount);//获取表格中所有的数据\n          Wb.request({\n            url:'{#contextPath#}'+'/arCancelBaseAction.do?method=saveCancel',//调用后台保存核销单的方法\n            params:{'cancelJson':Wb.getValue(app.form1),'deleteDtl':deleteDtl,'grid':Wb.getData(r)},\n            async:false,\n            success:function(resp){\n              var record = Wb.decode(resp.responseText);\n              if(record.flag == \"0\"){\n                Wb.toast('{#saveMsg3#}');\n                app.V_HEAD_ID.setValue(record.headId);//凭证头ID赋值\n                app.V_STATUS_NAME.setValue('{#draft#}');//凭证状态赋值\n                app.edit_v_xwl.v_head_id.setValue(record.headId);\n                Wb.isInsert = 'N';\n                //重新加载表格\n                app.grid1.store.reload({\n                  params:{'AR_CANCEL_H_ID':app.AR_CANCEL_H_ID.getValue()}\n                });\n                app.verfyBtn.setDisabled(false);\n                Wb.request({\n                  url:'m?xwl=xc/ar/cancel/DB/getCancelCode',//给核销单号赋值\n                  params:{'AR_CANCEL_H_ID':app.AR_CANCEL_H_ID.getValue()},\n                  async:false,\n                  success:function(resp){\n                    var rec = Wb.decode(resp.responseText);\n                    app.AR_CANCEL_H_CODE.setValue(rec.rows[0].AR_CANCEL_H_CODE);\n                    Wb.formValue = Wb.encode(Wb.getValue(app.form1));\n                  }\n                });\n              }else if(record.flag == \"1\"){//异常情况\n                Wb.toast(record.msg);\n              }\n\n\n            }\n          });\n        }\n      }\n    });\n  }else{//修改\n    //控制核销金额\n    Wb.request({\n      url:'m?xwl=xc/ar/cancel/DB/getArInvNoCancelAmt1',\n      params:{'srcId':app.AR_INV_GL_H_ID_XWL.AR_INV_GL_H_ID.getValue(),'cancelLId':str},\n      success:function(resp){\n        var rec = Wb.decode(resp.responseText);\n\n        if( Math.abs(srcAmt)>Math.abs(rec.rows[0].NO_PAY_AMT)){\n          Wb.toast('{#saveMsg6#}');\n          return;\n        }else{\n          if(!Wb.verify(app.form1)){//判断数据是否合法\n            Wb.toast('{#saveMsg1#}');\n            return;\n          }\n          if(!Wb.verifyGrid(app.grid1)){//判断数据是否合法\n            Wb.toast('{#saveMsg1#}');\n            return;\n          }\n          var getCount = app.grid1.getStore().getCount();//表格store中数据的数量\n          if(getCount===0){\n            Wb.toast('{#saveMsg2#}');\n            return;\n          }\n          var r = app.grid1.getStore().getRange(0,dtlCount);//获取表格中所有的数据\n          Wb.request({\n            url:'{#contextPath#}'+'/arCancelBaseAction.do?method=saveCancel',//调用后台保存核销单的方法\n            params:{'cancelJson':Wb.getValue(app.form1),'deleteDtl':deleteDtl,'grid':Wb.getData(r)},\n            async:false,\n            success:function(resp){\n              var record = Wb.decode(resp.responseText);\n              if(record.flag == \"0\"){\n                Wb.toast('{#saveMsg3#}');\n                app.V_HEAD_ID.setValue(record.headId);//凭证头ID赋值\n                app.V_STATUS_NAME.setValue('{#draft#}');//凭证状态赋值\n                app.edit_v_xwl.v_head_id.setValue(record.headId);\n                Wb.isInsert = 'N';\n                app.grid1.store.reload({\n                  params:{'AR_CANCEL_H_ID':app.AR_CANCEL_H_ID.getValue()}\n                });\n                app.verfyBtn.setDisabled(false);\n                Wb.request({\n                  url:'m?xwl=xc/ar/cancel/DB/getCancelCode',//给核销单号赋值\n                  params:{'AR_CANCEL_H_ID':app.AR_CANCEL_H_ID.getValue()},\n                  async:false,\n                  success:function(resp){\n                    var rec = Wb.decode(resp.responseText);\n                    app.AR_CANCEL_H_CODE.setValue(rec.rows[0].AR_CANCEL_H_CODE);\n                    Wb.formValue = Wb.encode(Wb.getValue(app.form1));\n                  }\n                });\n              }else if(record.flag == \"1\"){//异常情况\n                Wb.toast(record.msg);\n              }\n\n\n            }\n          });\n        }\n      }\n    });\n  }\n\n}else if(Wb.arCancelType=='YUSHLDC'){//预收红蓝对冲\n  if(Wb.isInsert=='Y'){//新增\n    //控制核销金额\n    Wb.request({\n      url:'m?xwl=xc/ar/cancel/DB/getArPayNoCancelAmt',\n      params:{'srcId':app.AR_PAY_H_ID_XWL.AR_PAY_H_ID.getValue()},\n      success:function(resp){\n        var rec = Wb.decode(resp.responseText);\n        if(Math.abs(srcAmt)>Math.abs(rec.rows[0].NO_PAY_AMT)){\n          Wb.toast('{#saveMsg6#}');\n          return;\n        }else{\n          if(!Wb.verify(app.form1)){//判断数据是否合法\n            Wb.toast('{#saveMsg1#}');\n            return;\n          }\n          if(!Wb.verifyGrid(app.grid1)){//判断数据是否合法\n            Wb.toast('{#saveMsg1#}');\n            return;\n          }\n          var getCount = app.grid1.getStore().getCount();//表格store中数据的数量\n          if(getCount===0){\n            Wb.toast('{#saveMsg2#}');\n            return;\n          }\n          var r = app.grid1.getStore().getRange(0,dtlCount);//获取表格中所有的数据\n          Wb.request({\n            url:'{#contextPath#}'+'/arCancelBaseAction.do?method=saveCancel',//调用后台保存核销单的方法\n            params:{'cancelJson':Wb.getValue(app.form1),'deleteDtl':deleteDtl,'grid':Wb.getData(r)},\n            async:false,\n            success:function(resp){\n              var record = Wb.decode(resp.responseText);\n              if(record.flag == \"0\"){\n                Wb.toast('{#saveMsg3#}');\n                app.V_HEAD_ID.setValue(record.headId);//凭证头ID赋值\n                app.V_STATUS_NAME.setValue('{#draft#}');//凭证状态赋值\n                app.edit_v_xwl.v_head_id.setValue(record.headId);\n                Wb.isInsert = 'N';\n                app.grid1.store.reload({\n                  params:{'AR_CANCEL_H_ID':app.AR_CANCEL_H_ID.getValue()}\n                });\n                app.verfyBtn.setDisabled(false);\n                Wb.request({\n                  url:'m?xwl=xc/ar/cancel/DB/getCancelCode',//给核销单号赋值\n                  params:{'AR_CANCEL_H_ID':app.AR_CANCEL_H_ID.getValue()},\n                  async:false,\n                  success:function(resp){\n                    var rec = Wb.decode(resp.responseText);\n                    app.AR_CANCEL_H_CODE.setValue(rec.rows[0].AR_CANCEL_H_CODE);\n                    Wb.formValue = Wb.encode(Wb.getValue(app.form1));\n                  }\n                });\n              }else if(record.flag == \"1\"){//异常情况\n                Wb.toast(record.msg);\n              }\n\n\n            }\n          });\n        }\n      }\n    });\n  }else{//修改\n    //控制核销金额\n    Wb.request({\n      url:'m?xwl=xc/ar/cancel/DB/getArPayNoCancelAmt',\n      params:{'srcId':app.AR_PAY_H_ID_XWL.AR_PAY_H_ID.getValue(),'cancelLId':str},\n      success:function(resp){\n        var rec = Wb.decode(resp.responseText);\n        if(Math.abs(srcAmt)>Math.abs(rec.rows[0].NO_PAY_AMT)){\n          Wb.toast('{#saveMsg6#}');\n          return;\n        }else{\n          if(!Wb.verify(app.form1)){//判断数据是否合法\n            Wb.toast('{#saveMsg1#}');\n            return;\n          }\n          if(!Wb.verifyGrid(app.grid1)){//判断数据是否合法\n            Wb.toast('{#saveMsg1#}');\n            return;\n          }\n          var getCount = app.grid1.getStore().getCount();//表格store中数据的数量\n          if(getCount===0){\n            Wb.toast('{#saveMsg2#}');\n            return;\n          }\n          var r = app.grid1.getStore().getRange(0,dtlCount);//获取表格中所有的数据\n          Wb.request({\n            url:'{#contextPath#}'+'/arCancelBaseAction.do?method=saveCancel',//调用后台保存核销单的方法\n            params:{'cancelJson':Wb.getValue(app.form1),'deleteDtl':deleteDtl,'grid':Wb.getData(r)},\n            async:false,\n            success:function(resp){\n              var record = Wb.decode(resp.responseText);\n              if(record.flag == \"0\"){\n                Wb.toast('{#saveMsg3#}');\n                app.V_HEAD_ID.setValue(record.headId);//凭证头ID赋值\n                app.V_STATUS_NAME.setValue('{#draft#}');//凭证状态赋值\n                app.edit_v_xwl.v_head_id.setValue(record.headId);\n                Wb.isInsert = 'N';\n                app.grid1.store.reload({\n                  params:{'AR_CANCEL_H_ID':app.AR_CANCEL_H_ID.getValue()}\n                });\n                app.verfyBtn.setDisabled(false);\n                Wb.request({\n                  url:'m?xwl=xc/ar/cancel/DB/getCancelCode',//给核销单号赋值\n                  params:{'AR_CANCEL_H_ID':app.AR_CANCEL_H_ID.getValue()},\n                  async:false,\n                  success:function(resp){\n                    var rec = Wb.decode(resp.responseText);\n                    app.AR_CANCEL_H_CODE.setValue(rec.rows[0].AR_CANCEL_H_CODE);\n                    Wb.formValue = Wb.encode(Wb.getValue(app.form1));\n                  }\n                });\n              }else if(record.flag == \"1\"){//异常情况\n                Wb.toast(record.msg);\n              }\n\n\n            }\n          });\n        }\n      }\n    });\n  }\n\n}\n\n\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#verify#}","itemId":"verfyBtn","disabled":"true","iconCls":"user_edit_icon"},"events":{"click":"var headId = app.V_HEAD_ID.getValue();//凭证头ID\nif(Wb.encode(Wb.getValue(app.form1))!=Wb.formValue&&Wb.formValue!=''){\n  Wb.toast('{#verifyMsg1#}');\n  return;\n}\n    var docArray = [] ;\n    var paramJson = {'headId' : app.V_HEAD_ID.getValue(),'arId':app.AR_CANCEL_H_ID.getValue(),arCatCode:'HXD'} ;\n    docArray.push(paramJson) ;\n    Wb.request({\n        url: '{#contextPath#}'+'/arCancelBaseAction.do?method=checkArVoucher',//调用后台方法\n        params: Wb.apply({arInfo: docArray}),\n        success: function(resp) {\n            var record = Wb.decode(resp.responseText);\n            if(record.flag === \"0\"){//正常情况\n                Wb.toast(record.msg);\n                app.V_STATUS_NAME.setValue('{#verifyAccess#}');\n                app.saveBtn.setDisabled(true);\n              \tapp.verfyBtn.setDisabled(true);\n              \tapp.cancelVerfyBtn.setDisabled(false);\n            }\n            if(record.flag === \"1\"){//异常情况\n                Wb.toast(record.msg);\n            }\n        }\n\t});\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#cancelVerify#}","itemId":"cancelVerfyBtn","disabled":"true","iconCls":"user_delete_icon"},"events":{"click":"var headId = app.V_HEAD_ID.getValue();//凭证头ID\nif(headId === '' || headId === null){//凭证头ID为空\n    Wb.toast('{#cancelVerifyMsg1#}');\n    return;\n}\nif(app.V_STATUS_NAME.getValue() === '{#draft#}'){//凭证状态为草稿\n    Wb.toast('{#cancelVerifyMsg1#}');\n    return;\n}\nelse{\n    var docArray = [] ;\n    var paramJson = {'headId' : app.V_HEAD_ID.getValue(),'arId':app.AR_CANCEL_H_ID.getValue(),arCatCode:'HXD'} ;\n    docArray.push(paramJson) ;\n    Wb.request({\n        url: '{#contextPath#}'+'/arCancelBaseAction.do?method=cancelCheckArVoucher',//调用后台方法\n        params: Wb.apply({arInfo: docArray}),\n        success: function(resp) {\n            var record = Wb.decode(resp.responseText);\n            if(record.flag === \"0\"){//正常情况\n                Wb.toast(record.msg);\n                app.V_STATUS_NAME.setValue('{#draft#}');\n                app.saveBtn.setDisabled(false);\n              \tapp.verfyBtn.setDisabled(false);\n              \tapp.cancelVerfyBtn.setDisabled(true);\n            }\n            if(record.flag === \"1\"){//异常情况\n                Wb.toast(record.msg);\n            }\n        }\n\t});\n}"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"maximized":"true","height":"600","layout":"fit","width":"1000","closeAction":"hide","itemId":"editWinN"},"events":{"hide":"app.hideFun();"},"children":[{"configs":{"itemId":"tabs","border":"false"},"events":{"beforetabchange":" //加载凭证信息\nif(newCard.title === app.edit_v_xwl.xwl_v_panel.title){\n    Wb.request({\n        url: 'm?xwl=xc/gl/journal/data-db/common-data/select-v-head',\n        params: {'headId' : app.V_HEAD_ID.getValue()},\n        success: function(resp) {\n            var headJson = Wb.decode(resp.responseText);\n            Wb.setValue(app.edit_v_xwl.form1,headJson);\n            Wb.setValue(app.edit_v_xwl.bbar,headJson);\n            //处理会计日期\n            var accDate = headJson.accountDate;\n            app.edit_v_xwl.accountDate.setValue(Wb.strToDate(accDate));\n        }\n    });\n    // 加载凭证分录行\n    app.edit_v_xwl.grid1.getStore().load({params :{'headId':app.V_HEAD_ID.getValue()}});\n}\n\n"},"children":[{"configs":{"title":"{#panel1#}","layout":"border","itemId":"tab1"},"children":[{"configs":{"region":"north","tbar":"app.form1Tbar","height":"{#formHeight#}","itemId":"form1"},"children":[{"configs":{"style":"fontSize:20px","margin":"10 0 20 0","html":"<font style=\"\">{#title#}<\/font>","labelAlign":"center","itemId":"title"},"children":[],"expanded":false,"type":"label"},{"configs":{"layout":"column","itemId":"tr1","border":"false"},"children":[{"configs":{"layout":"form","columnWidth":".245","itemId":"td_1_1","border":"false"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/LEDGER_ID_PICK/LEDGER_ID_PICK_SEC","itemId":"LEDGER_ID_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".245","itemId":"td_1_2","border":"false"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","allowBlank":"false","labelAlign":"right","pickList":"[\n\t['YSHYUS','{#YSHYUS#}'],\n  \t['YSHYF','{#YSHYF#}'],\n  \t['YSHLDC','{#YSHLDC#}'],\n  \t['YUSHLDC','{#YUSHLDC#}']\n]","itemId":"AR_CANCEL_TYPE","fieldLabel":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#cancelType#}"},"children":[],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".245","itemId":"td_1_3","border":"false"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"AR_CANCEL_H_CODE","fieldLabel":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#cancelcode#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".245","itemId":"td_1_4","border":"false"},"children":[{"configs":{"labelWidth":"80","allowBlank":"false","labelAlign":"right","itemId":"GL_DATE","fieldLabel":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#bizDate#}","editable":"false"},"events":{"expand":"Wb.request({\n  url:'m?xwl=xc/ap/req/DB/getPeriodDate',\n  params:{'LEDGER_ID':app.LEDGER_ID_XWL.LEDGER_ID.getValue()},\n  success:function(resp){\n    var rec = Wb.decode(resp.responseText);\n    app.GL_DATE.setMinValue(new Date(rec.rows[0].START_DATE));\n  }\n});"},"children":[],"expanded":false,"type":"date"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"layout":"column","itemId":"tr2","border":"false"},"children":[{"configs":{"hidden":"true","layout":"form","columnWidth":".245","itemId":"td_2_1","border":"false"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"SRC_ID","fieldLabel":"{#yusCode#}"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"AR_DOC_CAT_CODE"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".245","border":"false","itemId":"td_2_2"},"children":[{"configs":{"file":"m?xwl=xc/ar/ar-com-lov/AR_CUSTOMER_ID_PICK/AR_CUSTOMER_ID_PICK","itemId":"CUSTOMER_ID_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"hidden":"true","layout":"form","columnWidth":".245","border":"false","itemId":"td_2_1_1"},"children":[{"configs":{"file":"m?xwl=xc/ar/ar-com-lov/AR_INV_GL_H_ID_PICK/AR_INV_GL_H_ID_PICK_HL","itemId":"AR_INV_GL_H_ID_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"hidden":"true","layout":"form","columnWidth":".245","border":"false","itemId":"td_2_1_2"},"children":[{"configs":{"file":"m?xwl=xc/ar/ar-com-lov/AR_PAY_H_ID_PICK/AR_PAY_H_ID_PICK_ALL","itemId":"AR_PAY_H_ID_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_2_3"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"SRC_AMT","fieldLabel":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#cancelAmount#}"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_2_4"},"children":[{"configs":{"labelWidth":"80","allowBlank":"false","labelAlign":"right","itemId":"DESCRIPTION","fieldLabel":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#description#}"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"NO_CANCEL_AMT","fieldLabel":"NO_CANCEL_AMT"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"hidden":"true","itemId":"hidden_p"},"children":[{"configs":{"hidden":"true","itemId":"AR_CANCEL_H_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","value":"{#XIP.userId#}","itemId":"USER_ID","fieldLabel":"USER_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"V_HEAD_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"AR_CONTRACT_ID","fieldLabel":"合同id"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"80","readOnly":"true","value":"草稿","labelAlign":"right","itemId":"V_STATUS_NAME","fieldLabel":"凭证状态"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"80","readOnly":"true","value":"1","labelAlign":"right","itemId":"V_STATUS","fieldLabel":"凭证状态"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"AR_INV_GL_H_ID","fieldLabel":"应收单ID"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"form"},{"configs":{"region":"center","itemId":"grid1","editable":"true"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/ar/cancel/DB/XC_AR_CANCEL_L_SELECT"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"tbar","normalName":"grid1Tbar"},"children":[{"configs":{"text":"{#initMsg1#}","itemId":"gridSelect","iconCls":"select_all_icon"},"events":{"click":"if(Wb.arCancelType=='YSHYF'||Wb.arCancelType=='YSHYUS'||Wb.arCancelType=='YSHLDC'){//应收核应付，应收核预收，应收红蓝对冲\n Wb.request({\n  \turl:'m?xwl=xc/ar/cancel/DB/getArInvNoCancelAmt',\n   \tparams:{'srcId':app.AR_INV_GL_H_ID_XWL.AR_INV_GL_H_ID.getValue()},\n   \tsuccess:function(resp){\n      var rec = Wb.decode(resp.responseText);\n      app.NO_CANCEL_AMT.setValue(rec.rows[0].NO_PAY_AMT);\n    }\n});\n}else if(Wb.arCancelType=='YUSHLDC'){//预收红蓝对冲\n   Wb.request({\n  \turl:'m?xwl=xc/ar/cancel/DB/getArPayNoCancelAmt',\n   \tparams:{'srcId':app.AR_PAY_H_ID_XWL.AR_PAY_H_ID.getValue()},\n   \tsuccess:function(resp){\n      var rec = Wb.decode(resp.responseText);\n      app.NO_CANCEL_AMT.setValue(Math.abs(rec.rows[0].NO_CANCEL_AMT));\n    }\n});\n}\n\nvar arCancelHId = app.AR_CANCEL_H_ID.getValue();//核销单主表ID\nvar arCancelType = app.AR_CANCEL_TYPE.getValue();//核销类型\n\nvar ledgerId = app.LEDGER_ID_XWL.LEDGER_ID.getValue();//账簿ID\nvar ar_doc_cat_code = app.AR_DOC_CAT_CODE.getValue();//单据类型\nvar customerId = app.CUSTOMER_ID_XWL.CUSTOMER_ID.getValue();//客户ID\nvar arInvGlHId = app.AR_INV_GL_H_ID.getValue();//应收单ID\nvar noCancelAmt = app.NO_CANCEL_AMT.getValue();//未核销金额\nvar contractId = app.AR_CONTRACT_ID.getValue();//合同ID\nif(Wb.isEmpty(ledgerId)){//账簿为空\n\tWb.toast('{#gridSelectMsg1#}');\n    return false;\n}\nif(Wb.isEmpty(customerId)){//客户为空\n\tWb.toast('{#gridSelectMsg2#}');\n    return false;\n}\nif(Wb.arCancelType=='YUSHLDC'){//预收红蓝对冲\n  if(Wb.isEmpty(app.AR_PAY_H_ID_XWL.AR_PAY_H_ID.getValue())){\n     Wb.toast('{#gridSelectMsg3#}');\n  \t return false;\n  }\n \n}else if(Wb.isEmpty(arInvGlHId)){//应收单为空\n\tWb.toast('{#gridSelectMsg4#}');\n    return false;\n}\n\nvar curGrid = app.grid1;\nvar NO_CANCEL_AMT_TXT = app.NO_CANCEL_AMT;\nif(Wb.arCancelType=='YSHYUS'||Wb.arCancelType=='YUSHLDC'){//应收核预收，预收红蓝对冲\n   Wb.run({\n      url: 'm?xwl=xc/ar/cancel/LOV/LOV_XC_AR_PAY_H', \n      success: function(app) {\n        app.initWin({\n            AR_CANCEL_H_ID:arCancelHId,\n            AR_CANCEL_TYPE:arCancelType,\n            AR_DOC_CAT_CODE:ar_doc_cat_code,\n            CUSTOMER_ID:customerId,\n            LEDGER_ID:ledgerId,\n            CONTRACT_ID:contractId,\n            AR_INV_GL_H_ID:arInvGlHId,\n          \tNO_CANCEL_AMT:noCancelAmt,\n            hideFun:function(rs){\n              Wb.each(rs, function(r) {\n                r.set('AR_CANCEL_L_ID',Xip.getId());\n                r.set('AR_CANCEL_H_ID',arCancelHId);\n                r.set('AR_CANCEL_TYPE',arCancelType);\n                r.set('TARGET_ID',r.get('AR_PAY_H_ID'));\n                r.set('TARGET_AMT',r.get('PAY_AMT'));\n                r.set('SRC_CODE',r.get('AR_PAY_H_CODE'));\n                var grid1Store = curGrid.getStore();\n                for(var i=0;i<grid1Store.getCount();i++){\n                  var gr = grid1Store.getAt(i);\n                  if(gr.get('TARGET_ID')==r.get('TARGET_ID')){\n                    return false;\n                  }\n                }\n                Wb.add(curGrid, {\n                  AR_CANCEL_L_ID:Xip.getId(),\n                  AR_CANCEL_H_ID:arCancelHId,\n                  AR_CANCEL_TYPE:arCancelType,\n                  TARGET_ID:r.get('AR_PAY_H_ID'),\n                  TARGET_AMT:r.get('PAY_AMT'),\n                  SRC_CODE:r.get('AR_PAY_H_CODE'),\n                  AR_CONTRACT_NAME:r.get('AR_CONTRACT_NAME'),\n                  CUSTOMER_NAME:r.get('CUSTOMER_NAME'),\n                  DEPT_NAME:r.get('DEPT_NAME'),\n                  PROJECT_NAME:r.get('PROJECT_NAME'),\n                  ACC_NAME:r.get('SALE_ACC_NAME'),\n                  DESCRIPTION:r.get('DESCRIPTION')\n                }, 'after', 1, false);\n                 NO_CANCEL_AMT_TXT.setValue(noCancelAmt-r.get('PAY_AMT'));\n              });\n           \n            }\n        });\n      }\n    });\n}\nif(Wb.arCancelType=='YSHLDC'){//应收红蓝对冲\n    Wb.run({\n        url: 'm?xwl=xc/ar/cancel/LOV/LOV_XC_AR_INV_GL_H', \n        success: function(app) {\n          app.initWin({\n              AR_CANCEL_H_ID:arCancelHId,\n              AR_CANCEL_TYPE:arCancelType,\n              AR_DOC_CAT_CODE:ar_doc_cat_code,\n              LEDGER_ID:ledgerId,\n              CONTRACT_ID:contractId,\n              CUSTOMER_ID:customerId,\n              AR_INV_GL_H_ID:arInvGlHId,\n              NO_CANCEL_AMT:noCancelAmt,\n              hideFun:function(rs){\n                Wb.each(rs, function(r) {\n                  r.set('AR_CANCEL_L_ID',Xip.getId());\n                  r.set('AR_CANCEL_H_ID',arCancelHId);\n                  r.set('AR_CANCEL_TYPE',arCancelType);\n                  r.set('TARGET_ID',r.get('AR_INV_GL_H_ID'));\n                  r.set('TARGET_AMT',r.get('PAY_AMT'));\n                  r.set('SRC_CODE',r.get('AR_INV_GL_H_CODE'));\n                  var grid1Store = curGrid.getStore();\n                  for(var i=0;i<grid1Store.getCount();i++){\n                    var gr = grid1Store.getAt(i);\n                    if(gr.get('TARGET_ID')==r.get('TARGET_ID')){\n                      return false;\n                    }\n                  }\n                  Wb.add(curGrid, {\n                    AR_CANCEL_L_ID:Xip.getId(),\n                    AR_CANCEL_H_ID:arCancelHId,\n                    AR_CANCEL_TYPE:arCancelType,\n                    TARGET_ID:r.get('AR_INV_GL_H_ID'),\n                    TARGET_AMT:r.get('PAY_AMT'),\n                    SRC_CODE:r.get('AR_INV_GL_H_CODE'),\n                    AR_CONTRACT_NAME:r.get('AR_CONTRACT_NAME'),\n                    CUSTOMER_NAME:r.get('CUSTOMER_NAME'),\n                    DEPT_NAME:r.get('DEPT_NAME'),\n                    PROJECT_NAME:r.get('PROJECT_NAME'),\n                    ACC_NAME:r.get('ACC_NAME'),\n                    DESCRIPTION:r.get('DESCRIPTION')\n                  }, 'after', 1, false);\n                });\n              }\n          });\n        }\n      });\n}\nif(Wb.arCancelType=='YSHYF'){//应收核应付\n  \t\n    Wb.run({\n        url: 'm?xwl=xc/ar/cancel/LOV/LOV_XC_AP_INV_GL_H', \n        success: function(app) {\n          app.initWin({\n              AP_CANCEL_H_ID:arCancelHId,\n              AP_CANCEL_TYPE:arCancelType,\n              AP_DOC_CAT_CODE:ar_doc_cat_code,\n              LEDGER_ID:ledgerId,\n              CUSTOMER_ID:customerId,\n              NO_CANCEL_AMT:noCancelAmt,\n              hideFun:function(rs){\n                Wb.each(rs, function(r) {\n                  r.set('AR_CANCEL_L_ID',Xip.getId());\n                  r.set('AR_CANCEL_H_ID',arCancelHId);\n                  r.set('AR_CANCEL_TYPE',arCancelType);\n                  r.set('TARGET_ID',r.get('AP_INV_GL_H_ID'));\n                  r.set('TARGET_AMT',r.get('PAY_AMT'));\n                  r.set('SRC_CODE',r.get('AP_INV_GL_H_CODE'));\n                  var grid1Store = curGrid.getStore();\n                  for(var i=0;i<grid1Store.getCount();i++){\n                    var gr = grid1Store.getAt(i);\n                    if(gr.get('TARGET_ID')==r.get('TARGET_ID')){\n                      return false;\n                    }\n                  }\n                  Wb.add(curGrid, {\n                    AR_CANCEL_L_ID:Xip.getId(),\n                    AR_CANCEL_H_ID:arCancelHId,\n                    AR_CANCEL_TYPE:arCancelType,\n                    TARGET_ID:r.get('AP_INV_GL_H_ID'),\n                    TARGET_AMT:r.get('PAY_AMT'),\n                    SRC_CODE:r.get('AP_INV_GL_H_CODE'),\n                    AR_CONTRACT_NAME:r.get('AP_CONTRACT_NAME'),\n                    CUSTOMER_NAME:r.get('VENDOR_NAME'),\n                    DEPT_NAME:r.get('DEPT_NAME'),\n                    PROJECT_NAME:r.get('PROJECT_NAME'),\n                    ACC_NAME:r.get('ACC_NAME'),\n                    DESCRIPTION:r.get('DESCRIPTION')\n                  }, 'after', 1, false);\n                });\n              }\n          });\n        }\n      });\n}\n\n\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#delete#}","itemId":"delBtn","iconCls":"file_delete_icon"},"events":{"click":"var rec = app.grid1.getSelection()[0];//删除的行\nExt.Msg.confirm('{#prompt#}', '{#deletMsg2#}', function (button) {\n    if (button == \"yes\") {\n      var deleteData = {'AR_CANCEL_L_ID':rec.data.AR_CANCEL_L_ID};\n      deleteDtl.push(deleteData);\n      Wb.remove(app.grid1);\n      app.NO_CANCEL_AMT.setValue(parseInt(app.NO_CANCEL_AMT.getValue())+rec.data.TARGET_AMT);\n    }\n});"},"children":[],"expanded":false,"type":"button"}],"expanded":false,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#rowNum#}","xtype":"rownumberer","width":"50","align":"center","titleAlign":"center","itemId":"rowNumCol"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"AR_CANCEL_L_ID","itemId":"AR_CANCEL_L_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"AR_CANCEL_H_ID","itemId":"AR_CANCEL_H_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"AR_CANCEL_TYPE","itemId":"AR_CANCEL_TYPE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"TARGET_ID","itemId":"TARGET_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#srcCode#}","width":"150","dataIndex":"SRC_CODE","titleAlign":"center","itemId":"SRC_CODE_COL","normalName":"TARGET_CODE"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#contract#}","width":"150","dataIndex":"AR_CONTRACT_NAME","titleAlign":"center","itemId":"AR_CONTRACT_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#customer#}","width":"200","dataIndex":"CUSTOMER_NAME","titleAlign":"center","itemId":"CUSTOMER_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#dept#}","width":"100","dataIndex":"DEPT_NAME","titleAlign":"center","itemId":"DEPT_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#project#}","width":"100","dataIndex":"PROJECT_NAME","titleAlign":"center","itemId":"PROJECT_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#account#}","width":"100","dataIndex":"ACC_NAME","titleAlign":"center","itemId":"ACC_NAME_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#cancelAmount#}","align":"right","width":"100","dataIndex":"TARGET_AMT","titleAlign":"center","itemId":"TARGET_AMT_COL","renderer":"if(value>0){\n  return Wb.format(value,'0,000.00');\n}else{\n  return '<font color=red>'+Wb.format(value,'0,000.00')+'<\/font>';\n}\n\n"},"children":[{"configs":{"itemId":"editor"},"events":{"change":"var cancelType = app.AR_CANCEL_TYPE.getValue();\nvar vrec = app.grid1.getSelection()[0];\n//控制核销金额\nif(cancelType=='YSHYUS'){\n  if(app.AR_DOC_CAT_CODE.getValue()=='YSD-HZ'){\n    number.setMaxValue(0);\n  }else{\n    number.setMinValue(0);\n  }\n  if(Wb.isInsert=='Y'){\n    Wb.request({\n      url:'m?xwl=xc/ar/cancel/DB/getArInvNoCancelAmt',\n      params:{'srcId':app.AR_INV_GL_H_ID_XWL.AR_INV_GL_H_ID.getValue()},\n      success:function(resp){\n        var rec = Wb.decode(resp.responseText);\n        if(Math.abs(newValue)>Math.abs(rec.rows[0].NO_PAY_AMT)){\n          Wb.toast('{#saveMsg6#}');\n          number.setValue(rec.rows[0].NO_PAY_AMT);\n        }else{\n          Wb.request({\n            url:'m?xwl=xc/ar/cancel/DB/getArPayNoCancelAmt',\n            params:{'srcId':vrec.data.TARGET_ID},\n            success:function(resp){\n              var rec = Wb.decode(resp.responseText);\n              if(Math.abs(newValue)>Math.abs(rec.rows[0].NO_CANCEL_AMT)){\n                Wb.toast('{#saveMsg6#}');\n                number.setValue(rec.rows[0].NO_CANCEL_AMT);\n              }\n            }\n          });\n        }\n      }\n    });\n  }else{\n   \n    Wb.request({\n      url:'m?xwl=xc/ar/cancel/DB/getArInvNoCancelAmt1',\n      params:{'srcId':app.AR_INV_GL_H_ID_XWL.AR_INV_GL_H_ID.getValue(),'cancelLId':'(\"'+vrec.data.AR_CANCEL_L_ID+'\")'},\n      success:function(resp){\n        var rec = Wb.decode(resp.responseText);\n        if(Math.abs(newValue)>Math.abs(rec.rows[0].NO_PAY_AMT)){\n          Wb.toast('{#saveMsg6#}');\n          number.setValue(rec.rows[0].NO_PAY_AMT);\n        }else{\n          Wb.request({\n            url:'m?xwl=xc/ar/cancel/DB/getArPayNoCancelAmt1',\n            params:{'srcId':vrec.data.TARGET_ID,'cancelLId':'(\"'+vrec.data.AR_CANCEL_L_ID+'\")'},\n            success:function(resp){\n              var rec = Wb.decode(resp.responseText);\n              if(Math.abs(newValue)>Math.abs(rec.rows[0].NO_CANCEL_AMT)){\n                Wb.toast('{#saveMsg6#}');\n                number.setValue(rec.rows[0].NO_CANCEL_AMT);\n              }\n            }\n          });\n        }\n      }\n    });\n  }\n}else if(cancelType=='YSHYF'){\n  number.setMinValue(0);\n  if(Wb.isInsert=='Y'){\n    Wb.request({\n      url:'m?xwl=xc/ar/cancel/DB/getArInvNoCancelAmt',\n      params:{'srcId':app.AR_INV_GL_H_ID_XWL.AR_INV_GL_H_ID.getValue()},\n      success:function(resp){\n        var rec = Wb.decode(resp.responseText);\n        if(Math.abs(newValue)>Math.abs(rec.rows[0].NO_PAY_AMT)){\n          Wb.toast('{#saveMsg6#}');\n          number.setValue(rec.rows[0].NO_PAY_AMT);\n        }else{\n          Wb.request({\n            url:'m?xwl=xc/ar/cancel/DB/getApInvNoCancelAmt',\n            params:{'srcId':vrec.data.TARGET_ID},\n            success:function(resp){\n              var rec = Wb.decode(resp.responseText);\n              if(Math.abs(newValue)>Math.abs(rec.rows[0].NO_PAY_AMT)){\n                Wb.toast('{#saveMsg6#}');\n                number.setValue(rec.rows[0].NO_PAY_AMT);\n              }\n            }\n          });\n        }\n      }\n    });\n  }else{\n    Wb.request({\n      url:'m?xwl=xc/ar/cancel/DB/getArInvNoCancelAmt1',\n      params:{'srcId':app.AR_INV_GL_H_ID_XWL.AR_INV_GL_H_ID.getValue(),'cancelLId':'(\"'+vrec.data.AR_CANCEL_L_ID+'\")'},\n      success:function(resp){\n        var rec = Wb.decode(resp.responseText);\n        if(Math.abs(newValue)>Math.abs(rec.rows[0].NO_PAY_AMT)){\n          Wb.toast('{#saveMsg6#}');\n          number.setValue(rec.rows[0].NO_PAY_AMT);\n        }else{\n          Wb.request({\n            url:'m?xwl=xc/ar/cancel/DB/getApInvNoCancelAmt1',\n            params:{'srcId':vrec.data.TARGET_ID,'cancelLId':'(\"'+vrec.data.AR_CANCEL_L_ID+'\")'},\n            success:function(resp){\n              var rec = Wb.decode(resp.responseText);\n              if(Math.abs(newValue)>Math.abs(rec.rows[0].NO_PAY_AMT)){\n                Wb.toast('{#saveMsg6#}');\n                number.setValue(rec.rows[0].NO_PAY_AMT);\n              }\n            }\n          });\n        }\n      }\n    });\n  }\n}else if(cancelType=='YSHLDC'){\n  number.setMinValue(0);\n  if(Wb.isInsert=='Y'){\n    Wb.request({\n      url:'m?xwl=xc/ar/cancel/DB/getArInvNoCancelAmt',\n      params:{'srcId':app.AR_INV_GL_H_ID_XWL.AR_INV_GL_H_ID.getValue()},\n      success:function(resp){\n        var rec = Wb.decode(resp.responseText);\n        if(Math.abs(newValue)>Math.abs(rec.rows[0].NO_PAY_AMT)){\n          Wb.toast('{#saveMsg6#}');\n          number.setValue(rec.rows[0].NO_PAY_AMT);\n        }else{\n          Wb.request({\n            url:'m?xwl=xc/ar/cancel/DB/getArInvNoCancelAmt',\n            params:{'srcId':vrec.data.TARGET_ID},\n            success:function(resp){\n              var rec = Wb.decode(resp.responseText);\n              if(Math.abs(newValue)>Math.abs(rec.rows[0].NO_PAY_AMT)){\n                Wb.toast('{#saveMsg6#}');\n                number.setValue(rec.rows[0].NO_PAY_AMT);\n              }\n            }\n          });\n        }\n      }\n    });\n  }else{\n    Wb.request({\n      url:'m?xwl=xc/ar/cancel/DB/getArInvNoCancelAmt1',\n      params:{'srcId':app.AR_INV_GL_H_ID_XWL.AR_INV_GL_H_ID.getValue(),'cancelLId':'(\"'+vrec.data.AR_CANCEL_L_ID+'\")'},\n      success:function(resp){\n        var rec = Wb.decode(resp.responseText);\n        if(Math.abs(newValue)>Math.abs(rec.rows[0].NO_PAY_AMT)){\n          Wb.toast('{#saveMsg6#}');\n          number.setValue(rec.rows[0].NO_PAY_AMT);\n        }else{\n          Wb.request({\n            url:'m?xwl=xc/ar/cancel/DB/getArInvNoCancelAmt1',\n            params:{'srcId':vrec.data.TARGET_ID,'cancelLId':'(\"'+vrec.data.AR_CANCEL_L_ID+'\")'},\n            success:function(resp){\n              var rec = Wb.decode(resp.responseText);\n              if(Math.abs(newValue)>Math.abs(rec.rows[0].NO_PAY_AMT)){\n                Wb.toast('{#saveMsg6#}');\n                number.setValue(rec.rows[0].NO_PAY_AMT);\n              }\n            }\n          });\n        }\n      }\n    });\n  }\n\n}else if(cancelType=='YUSHLDC'){\n  number.setMinValue(0);\n  if(Wb.isInsert=='Y'){\n    Wb.request({\n      url:'m?xwl=xc/ar/cancel/DB/getArPayNoCancelAmt',\n      params:{'srcId':app.AR_PAY_H_ID_XWL.AR_PAY_H_ID.getValue()},\n      success:function(resp){\n        var rec = Wb.decode(resp.responseText);\n        if(Math.abs(newValue)>Math.abs(rec.rows[0].NO_CANCEL_AMT)){\n          Wb.toast('{#saveMsg6#}');\n          number.setValue(rec.rows[0].NO_CANCEL_AMT);\n        }else{\n          Wb.request({\n            url:'m?xwl=xc/ar/cancel/DB/getArPayNoCancelAmt',\n            params:{'srcId':vrec.data.TARGET_ID},\n            success:function(resp){\n              var rec = Wb.decode(resp.responseText);\n              if(Math.abs(newValue)>Math.abs(rec.rows[0].NO_CANCEL_AMT)){\n                Wb.toast('{#saveMsg6#}');\n                number.setValue(rec.rows[0].NO_CANCEL_AMT);\n              }\n            }\n          });\n        }\n      }\n    });\n  }else{\n    Wb.request({\n      url:'m?xwl=xc/ar/cancel/DB/getArPayNoCancelAmt1',\n      params:{'srcId':app.AR_PAY_H_ID_XWL.AR_PAY_H_ID.getValue(),'cancelLId':'(\"'+vrec.data.AR_CANCEL_L_ID+'\")'},\n      success:function(resp){\n        var rec = Wb.decode(resp.responseText);\n        if(Math.abs(newValue)>Math.abs(rec.rows[0].NO_CANCEL_AMT)){\n          Wb.toast('{#saveMsg6#}');\n          number.setValue(rec.rows[0].NO_CANCEL_AMT);\n        }else{\n          Wb.request({\n            url:'m?xwl=xc/ar/cancel/DB/getArPayNoCancelAmt1',\n            params:{'srcId':vrec.data.TARGET_ID,'cancelLId':'(\"'+vrec.data.AR_CANCEL_L_ID+'\")'},\n            success:function(resp){\n              var rec = Wb.decode(resp.responseText);\n              if(Math.abs(newValue)>Math.abs(rec.rows[0].NO_CANCEL_AMT)){\n                Wb.toast('{#saveMsg6#}');\n                number.setValue(rec.rows[0].NO_CANCEL_AMT);\n              }\n            }\n          });\n        }\n      }\n    });\n  }\n\n}"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"column"},{"configs":{"text":"{#description#}","width":"250","dataIndex":"DESCRIPTION","titleAlign":"center","itemId":"DESCRIPTION_COL"},"children":[{"configs":{"itemId":"editor"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"column"}],"expanded":true,"type":"array"}],"expanded":false,"type":"grid"}],"expanded":true,"type":"panel"},{"configs":{"file":"m?xwl=xc/gl/journal/v-windows/new-xwl-voucher","itemId":"edit_v_xwl"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"tab"}],"expanded":true,"type":"window"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}