{"inframe":false,"title":"","hidden":false,"roles":{"default":1},"children":[{"configs":{"initScript":"var lang = request.getSession().getAttribute(\"XzSessionVars\").get('language');\nrequest.setAttribute(\"language\",lang);","serverScript":"//---------------------获取当前模块语言对应的.json文件，放到request中----------------\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xc/ar/trans/json/XC_AR_INV_TRANS_ALL\");","itemId":"module"},"events":{"initialize":"Ext.apply(app, {\n  initWin: function(params) {\n    Ext.apply(app, params);\n    app.editWinN = new Ext.window.Window(app.editWinN);\n    app.editWinN.show();\n    app.AR_PAY_H_ID.setValue(params.AR_PAY_H_ID);\n    app.AR_INV_GL_H_ID.setValue(params.AR_INV_GL_H_ID);\n    app.SOURCE_ID.setValue(params.SOURCE_ID);\n    app.AR_CONTRACT_ID.setValue(params.AR_CONTRACT_ID);\n    Wb.request({\n        url: 'm?xwl=xc/ar/gl/DB/XC_AR_INV_GL_H_SELECT_BY_ID',\n        params: {AR_INV_GL_H_ID: params.AR_INV_GL_H_ID},\n        success: function(resp) {\n            var r = Wb.decode(resp.responseText);\n            app.L_AR_INV_GL_H_ID.setValue(r.L_AR_INV_GL_H_ID);\n            app.grid1.store.load({params : Wb.getValue(app.form1)});\n        }\n    });\n   }\n});\n// TODO: 增加合计行\nfunction addTotalLine(){\n    Ext.define('lineModel', {  \n        extend: 'Ext.data.Model',  \n        fields: [  \n            {name: 'DESCRIPTION'},\n            {name: 'GL_DATE'},  \n            {name: 'SOURCE_CODE'},\n            {name: 'AR_DOC_CAT_NAME'},\n            {name: 'DFJE'},  \n            {name: 'JFJE'},\n            {name: 'AMOUNT'}\n        ]  \n    });\n    var r = Ext.create('lineModel', {\n        'DESCRIPTION':'',\n        'GL_DATE':'',\n        'SOURCE_CODE':'',\n        'AR_DOC_CAT_NAME':'{#total#}',\n        'DFJE':'',\n        'JFJE':'',\n        'AMOUNT': ''\n    });\n    var p = app.grid1.store.getCount() ;\n    app.grid1.store.insert(p,r);\n}"},"children":[{"configs":{"maximized":"true","layout":"border","itemId":"editWinN","modal":"true"},"children":[{"configs":{"region":"north","hidden":"true","itemId":"form1"},"children":[{"configs":{"itemId":"SOURCE_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"AR_DOC_CAT_CODE"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"AR_INV_GL_H_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"AR_PAY_H_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"AR_CONTRACT_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"L_AR_INV_GL_H_ID"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"form"},{"configs":{"region":"center","itemId":"grid1"},"events":{"itemdblclick":"app.seekBtn.fireEvent('click');"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/ar/trans/DB/XC_AR_INV_TRANS_SELECT"},"events":{"load":"//增加合计行\naddTotalLine();\nvar i = store.find('AR_DOC_CAT_NAME','{#total#}');\nvar r = store.getAt(i) ;\n// 设置原币借方和贷方合计数\nvar t_edr = 0;\nvar t_ecr = 0;\nvar inv_amount = 0;\nWb.each(records, function(rec){\n    var edr = rec.data.JFJE;\n    if(edr === \"\" || edr === null || edr === undefined){edr = 0;}\n    var ecr = rec.data.DFJE;\n    if(ecr === \"\" || ecr === null || ecr === undefined){ecr = 0;}\n    var inv = rec.data.INV_AMOUNT;\n    if(inv === \"\" || inv === null || inv === undefined){inv = 0;}\n    t_edr += edr;\n    t_ecr += ecr;\n    inv_amount = inv;\n    if(app.L_AR_INV_GL_H_ID.getValue() !== '' && app.L_AR_INV_GL_H_ID.getValue() !== null)\n        rec.set('INV_AMOUNT', Wb.format(0,'0,000.00'));\n    else\n        rec.set('INV_AMOUNT', Wb.format(t_edr - t_ecr,'0,000.00'));\n});\nr.set('JFJE', t_edr);\nr.set('DFJE', t_ecr);\nif(app.L_AR_INV_GL_H_ID.getValue() !== '' && app.L_AR_INV_GL_H_ID.getValue() !== null)\n\tr.set('INV_AMOUNT', Wb.format(0,'0,000.00'));\nelse\n\tr.set('INV_AMOUNT', Wb.format(t_edr - t_ecr,'0,000.00'));\nstore.commitChanges();"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"{#seekBtn#}","itemId":"seekBtn","iconCls":"seek_icon"},"events":{"click":"var recs = app.grid1.getSelection();\nif(recs.length !== 1){\n  Wb.toast('{#selectRec#}');\n    return;\n}\nvar ar_doc_cat_code = recs[0].data.AR_DOC_CAT_CODE;//获取单据类型\nvar source_id = recs[0].data.SOURCE_ID;//获取来源单据id\nvar ar_pay_h_id = recs[0].data.AR_PAY_H_ID;\nif(ar_doc_cat_code == 'YSD' || ar_doc_cat_code == 'YSD-HZ'){//应收单\n    Wb.run({\n        url: 'm?xwl=xc/ar/gl/XC_AR_INV_GL_H_NO_C', \n        success: function(app) {\n            app.initWin({\n                AR_INV_GL_H_ID:source_id,\n                IS_INSERT:'S',\n                AR_DOC_CAT_CODE:ar_doc_cat_code,\n                hideFun:function(){\n                    Wb.isInsert = 'N';\n                }\n            });\n        }\n    });\n}\nelse if(ar_doc_cat_code == 'YSHLDC' || ar_doc_cat_code == 'YSHYUS' || ar_doc_cat_code == 'YUSHLDC' || ar_doc_cat_code == 'YSHYF'){//核销\n    Wb.run({\n        url: 'm?xwl=xc/ar/cancel/XC_AR_CANCEL_H_NO_C', \n        success: function(app) {\n            app.initWin({\n                AR_CANCEL_H_ID:source_id,\n                IS_INSERT:'S',\n                hideFun:function(){\n                    Wb.isInsert = 'N';\n                }\n            });\n        }\n    });\n}\nelse if(ar_doc_cat_code == 'YFHYS'){//核销(应付核应收)\n    Wb.run({\n        url: 'm?xwl=xc/ap/cancel/XC_AP_CANCEL_H_NO_C', \n        success: function(app) {\n            app.initWin({\n                AP_CANCEL_H_ID:source_id,\n                IS_INSERT:'S',\n                hideFun:function(){\n                    Wb.isInsert = 'N';\n                }\n            });\n        }\n    });\n}\nelse if(ar_doc_cat_code == 'YUETZD'){//调整\n    Wb.run({\n        url: 'm?xwl=xc/ar/adj/XC_AR_INV_GL_ADJ_NO_C', \n        success: function(app) {\n            app.initWin({\n                GL_ADJ_ID:source_id,\n                IS_INSERT:'S',\n                hideFun:function(){\n                    Wb.isInsert = 'N';\n                }\n            });\n        }\n    });\n}\nelse if(ar_doc_cat_code == 'SKD_JSK' || ar_doc_cat_code == 'SKD_JSK-H'){//结算款\n    Wb.run({\n        url: 'm?xwl=xc/ar/pay/XC_AR_PAY_H_NO_C', \n        success: function(app) {\n            app.initWin({\n                AR_PAY_H_ID:source_id,\n                DOC_STATUS : 'zd',\n                AR_DOC_CAT_CODE:ar_doc_cat_code,\n                hideFun:function(){\n                    Wb.isInsert = 'N';\n                }\n            });\n        }\n    });\n}"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#order#}","align":"center","xtype":"rownumberer","width":"50","titleAlign":"center","itemId":"ORDERBY"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#AR_DOC_CAT_NAME#}","width":"160","dataIndex":"AR_DOC_CAT_NAME","titleAlign":"center","itemId":"AR_DOC_CAT_NAME_COL","renderer":"if('{#language#}' == 'zh'){\n\tif(value === '应收单')\n\t\tvalue = '应收单';\n\tif(value === '应收单-红字')\n\t\tvalue = '应收单-红字';\n\tif(value === '应收红蓝对冲')\n\t\tvalue = '应收红蓝对冲';\n\tif(value === '应付核应收')\n\t\tvalue = '应付核应收';\n\tif(value === '应收核应付')\n\t\tvalue = '应收核应付';\n\tif(value === '应收核预收')\n\t\tvalue = '应收核预收';\n\tif(value === '余额调整单')\n\t\tvalue = '余额调整单';\n\tif(value === '结算款')\n\t\tvalue = '结算款';\n\tif(value === '结算款-红字')\n\t\tvalue = '结算款-红字';\n}\nelse if('{#language#}' == 'en'){\n\tif(value === '应收单')\n\t\tvalue = 'Receivable Doc';\n\tif(value === '应收单-红字')\n\t\tvalue = 'Receivable Doc-Letter';\n\tif(value === '应收红蓝对冲')\n\t\tvalue = 'Red and blue hedge';\n\tif(value === '应付核应收')\n\t\tvalue = 'Accounts payable';\n\tif(value === '应收核应付')\n\t\tvalue = 'Accounts receivable';\n\tif(value === '应收核预收')\n\t\tvalue = 'Nuclear advance receivable';\n\tif(value === '余额调整单')\n\t\tvalue = 'Balance sheet';\n\tif(value === '结算款')\n\t\tvalue = 'Settlement funds';\n\tif(value === '结算款-红字')\n\t\tvalue = 'Settlement funds-Letter';\n}\nreturn value;"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#SOURCE_CODE#}","width":"200","dataIndex":"AR_DOC_CODE","titleAlign":"center","itemId":"AR_DOC_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#GL_DATE#}","width":"100","xtype":"datecolumn","dataIndex":"GL_DATE","titleAlign":"center","itemId":"GL_DATE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#DESCRIPTION#}","width":"200","dataIndex":"DESCRIPTION","titleAlign":"center","itemId":"DESCRIPTION_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#JFJE#}","align":"right","width":"120","dataIndex":"JFJE","format":"0,000.00","titleAlign":"center","itemId":"JFJE_COL","renderer":"if(value === null || value === '')\n    return Wb.format(0,'0,000.00');\nelse\n    return Wb.format(value,'0,000.00');"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#DFJE#}","align":"right","width":"120","dataIndex":"DFJE","format":"0,000.00","titleAlign":"center","itemId":"DFJE_COL","renderer":"if(value === null || value === '')\n    return Wb.format(0,'0,000.00');\nelse\n    return Wb.format(value,'0,000.00');"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#AMOUNT#}","align":"right","width":"120","dataIndex":"INV_AMOUNT","format":"0,000.00","titleAlign":"center","itemId":"AMOUNT_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#AMOUNT#}","hidden":"true","align":"right","width":"120","dataIndex":"AMOUNT","format":"0,000.00","titleAlign":"center","itemId":"AMOUNT_COL1","renderer":"if(value === null || value === '')\n    return Wb.format(0,'0,000.00');\nelse\n    return Wb.format(value,'0,000.00');"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"window"}],"expanded":true,"type":"module"}],"pageLink":"{container:false}","iconCls":""}