{"inframe":false,"title":"","hidden":false,"roles":{"default":1},"children":[{"configs":{"jsLinks":"[\"platform/util/platformUtil.js\"]","serverScript":"//---------------------获取当前模块语言对应的.json文件，放到request中----------------\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xc/ar/inv/json/XC_AR_INVOICE_H_NO_C\");\nvar userId = request.getSession().getAttribute(\"XzSessionVars\").get('userId');\n\nvar protocol = request.getProtocol() ;\nvar ipAddr = request.getServerName();\nvar port = request.getServerPort() ;\nvar ctxPath = request.getContextPath() ;\n\nvar pp = protocol.substr(0,5) ;\nprotocol = (pp.indexOf(\"https\") == -1 ? \"http\" : \"https\") ;\nvar url = protocol + \"://\" + ipAddr +\":\" + port + ctxPath ;\n\nrequest.setAttribute('contextPath',ctxPath);\nrequest.setAttribute(\"userId\",userId);\nrequest.setAttribute(\"appIP\",url);\nvar appId = request.getSession().getAttribute(\"XzSessionVars\").get('appId');\nrequest.setAttribute(\"funId\",request.getParameter('funId'));\nrequest.setAttribute(\"appId\",request.getParameter('appId'));","itemId":"module"},"events":{"finalize":"var tableValue = '';//窗口中的所有信息\nvar isEditCol = 'N';//判断是否更新过行信息\nvar deleteDtl = [];\n//判断销售发票明细是否为空\nfunction judgemDtlIsNull(){\n    var returnMsg = '';\n    var store = app.grid1.store;\n    for(var i = 0;i < store.getCount();i++){\n        var data = store.getAt(i);\n        if(Ext.isEmpty(data.get('AR_SALE_TYPE_ID'))){\n            returnMsg = '{#saveDtlWarn1#}' + (i + 1) + '：{#saveDtlWarn2#}';\n            break;\n        }\n        if(Ext.isEmpty(data.get('DIM_NAME'))){\n            returnMsg = '{#saveDtlWarn1#}' + (i + 1) + '：{#saveDtlWarn3#}';\n            break;\n        }\n        if(Ext.isEmpty(data.get('QTY'))){\n            returnMsg = '{#saveDtlWarn1#}' + (i + 1) + '：{#saveDtlWarn4#}';\n            break;\n        }\n        if(Ext.isEmpty(data.get('TAX')) && Wb.docCatCode !== \"ZZSPT\" && Wb.docCatCode !== \"ZZSPT-HZ\"){\n            returnMsg = '{#saveDtlWarn1#}' + (i + 1) + '：{#saveDtlWarn5#}';\n            break;\n        }\n        if(Ext.isEmpty(data.get('TAX_AMT')) && Wb.docCatCode !== \"ZZSPT\" && Wb.docCatCode !== \"ZZSPT-HZ\"){\n            returnMsg = '{#saveDtlWarn1#}' + (i + 1) + '：{#saveDtlWarn6#}';\n            break;\n        }\n        if(Ext.isEmpty(data.get('INV_AMOUNT'))){\n            returnMsg = '{#saveDtlWarn1#}' + (i + 1) + '：{#saveDtlWarn7#}';\n            break;\n        }\n    }\n    return returnMsg;\n}","initialize":"Wb.keyValue = '';\nWb.isInsert = 'Y';\nWb.docCatCode = 'ZZS';\nWb.flag = '';\nWb.LEDGER_ID = '';\nWb.LEDGER_NAME = '';\nExt.apply(app, {\n    initWin: function(params) {\n        Ext.apply(app, params);\n        app.editWinN = new Ext.window.Window(app.editWinN);\n        app.editWinN.show();\n        Wb.isInsert = params.IS_INSERT;\n        Wb.keyValue = params.AR_INV_H_ID;\n        Wb.docCatCode = params.AR_DOC_CAT_CODE;\n        app.AR_DOC_CAT_CODE.setValue(Wb.docCatCode);\n        Wb.LEDGER_ID = params.LEDGER_ID;\n        Wb.LEDGER_NAME = params.LEDGER_NAME;\n        Wb.flag = params.flag;\n        if(Wb.flag === 'update'){\n            app.addBtn.hide();\n        }\n        //设置税额和数量（红字应该小于0）\n        if (Wb.docCatCode == 'ZZS-HZ' || Wb.docCatCode == 'ZZSPT-HZ') {\n            app.td_2_2.show();\n        }\n        if (Wb.isInsert == 'Y') {//新增\n\t\t\tWb.request({\n                url : 'm?xwl=xc/ar/inv/DB/selectDeptInfoByUserId',\n                params : {USER_ID : '{#userId#}'},\n                async : false,\n                success : function(resp){\n                    var temp = Wb.decode(resp.responseText);\n                    app.DEPT_ID_XWL.DEPT_ID.setValue(temp.DEPT_ID);\n                    app.DEPT_ID_XWL.DEPT_NAME.setValue(temp.DEPT_NAME);\n                }\n            });\n            app.AR_INV_H_ID.setValue(Xip.getId());\n            app.BIZ_DATE.setValue(new Date());\n            app.AUDIT_STATUS.setValue('A');\n            app.SYS_AUDIT_STATUS.setValue('A');\n            app.XC_AP_SYS_AUDIT_STATUS.setValue('{#A_SYS_STATUS#}');\n            app.ldInitStore.load();\n            app.grid1.getStore().reload({params: {AR_INV_H_ID: app.AR_INV_H_ID.getValue()}});\n        }\n        if (Wb.isInsert == 'N') {//修改\n            Wb.request({\n                url: 'm?xwl=xc/ar/inv/DB/XC_AR_INVOICE_H_SELECT_BY_ID',\n                params: {AR_INV_H_ID: Wb.keyValue},\n                async : false,\n                success: function(resp) {\n                    var r = Wb.decode(resp.responseText);\n                    if (r.SYS_AUDIT_STATUS !== 'A' && r.SYS_AUDIT_STATUS !== null) {\n                        app.saveBtn.setDisabled(true);\n                        app.submitButton.setDisabled(true);\n                    }\n                    r.BIZ_DATE = Wb.strToDate(r.BIZ_DATE);\n                    Wb.setValue(app.editWinN, r);\n                    setLedger(r.LEDGER_ID);\n                    setMinDate(r.LEDGER_ID);\n                    returnRowFn(r,'xip_pub_depts');\n                    //为合同名称加上筛选条件\n                    app.AR_CONTRACT_ID_XWL.QUERY_CUSTOMER_ID.setValue(r.CUSTOMER_ID);\n\t\t\t\t\tif (!Wb.isEmpty(r.L_AR_INV_H_CODE)) {\n                        app.AR_INVOICE_H_ID_PICK.L_AR_INV_H_CODE.setValue(r.L_AR_INV_H_CODE);\n                        Wb.request({\n                            url : 'm?xwl=xc/ar/inv/DB/XC_AR_INVOICE_H_SELECT_BY_ID',\n                            params : {AR_INV_H_ID : r.L_AR_INV_H_ID},\n                            success : function(res){\n                                var resp = Wb.decode(res.responseText);\n                                app.TAX_AMT.setMinValue(resp.TAX_AMT * -1);\n                                app.INV_AMOUNT.setMinValue(resp.INV_AMOUNT * -1);\n                                app.TAX_RATE.setMaxValue(resp.TAX_RATE);\n                                app.store1.load({\t\n                                    params: {AR_INV_H_ID : r.L_AR_INV_H_ID},\n                                    callback: function() {\n                                        for (var i = 0; i < app.store1.getCount(); i++) {\n                                            var rs = app.store1.getAt(i);\n                                            app.QTY_COL.getEditor().setMinValue(rs.get('QTY') * -1);\n                                            app.AMOUNT_COL.getEditor().setMinValue(rs.get('AMOUNT') * -1);\n                                            app.INV_AMOUNT_COL.getEditor().setMinValue(rs.get('INV_AMOUNT') * -1);\n                                            app.TAX_AMT_COL.getEditor().setMinValue(rs.get('TAX_AMT') * -1);\n                                            app.INV_PRICE_COL.getEditor().setMaxValue(rs.get('INV_PRICE'));\n                                            app.TAX_RATE_COL.getEditor().setMaxValue(rs.get('TAX'));\n                                            app.PRICE_COL.getEditor().setMaxValue(rs.get('PRICE'));\n                                        }\n                                    }\n                                });\n                            }\n                        });\n                    }\n                    //账薄、客户、蓝字发表设置为不可修改状态\n                    setSomeReadOnly(true);\n                    app.grid1.getStore().load({params: {AR_INV_H_ID: Wb.keyValue}});\n                  \n                    if (Wb.isEmpty(app.AR_INVOICE_H_ID_PICK.L_AR_INV_H_ID.getValue())) {\n                        app.td_2_2.hide();\n                    }else {\n                        app.AR_INVOICE_H_ID_PICK.L_AR_INV_H_CODE.setReadOnly(true);\n                    }\n                    tableValue = Wb.encode(Wb.getValue(app.form1));\n                }\n            });\n        }\n        if (Wb.isInsert == 'C') {//复制\n            Wb.isInsert = 'Y';\n            Wb.request({\n                url: 'm?xwl=xc/ar/inv/DB/XC_AR_INVOICE_H_SELECT_BY_ID',\n                params: {AR_INV_H_ID: Wb.keyValue},\n                async : false,\n                success: function(resp) {\n                    var r = Wb.decode(resp.responseText);\n                    \n                    Wb.setValue(app.editWinN, r);\n                    app.AR_INV_H_ID.setValue(Xip.getId());\n                    app.BIZ_DATE.setValue(new Date());\n                    app.CREATED_BY_NAME.setValue('{#XIP.empName#}');\n                    app.AR_INV_H_CODE.reset();\n                    app.FIN_USER_NAME.reset();\n                    app.XC_AP_SYS_AUDIT_STATUS.reset();\n                    app.INS_CODE.reset();\n                    app.AUDIT_STATUS.setValue('A');\n                    app.SYS_AUDIT_STATUS.setValue('A');\n                    app.XC_AP_SYS_AUDIT_STATUS.setValue('{#A_SYS_STATUS#}');\n                    setLedger(r.LEDGER_ID);\n                    setMinDate(r.LEDGER_ID);\n                    returnRowFn(r,'xip_pub_depts');\n                    //为合同名称加上筛选条件\n                    app.AR_CONTRACT_ID_XWL.QUERY_CUSTOMER_ID.setValue(r.CUSTOMER_ID);\n\n                    //账薄、客户、蓝字发表设置为不可修改状态\n                    setSomeReadOnly(true);\n\n                    app.grid1.getStore().load({params: {AR_INV_H_ID: Wb.keyValue},callback : function(){\n                        var store = app.grid1.store;\n\t\t\t\t\t\tfor(var i = 0;i < store.getCount();i++){\n                            var data = store.getAt(i);\n                            data.set('AR_INV_L_ID',null);\n                            data.set('AR_INV_H_ID',null);\n                        }\n                    }});\n                  \n                    if (Wb.isEmpty(app.AR_INVOICE_H_ID_PICK.L_AR_INV_H_ID.getValue())) {\n                        app.td_2_2.hide();\n                    }else {\n                        app.AR_INVOICE_H_ID_PICK.L_AR_INV_H_CODE.setReadOnly(true);\n                    }\n                }\n            });\n        }\n        if (Wb.isInsert == 'S') {//查看\n            Wb.request({\n                url: 'm?xwl=xc/ar/inv/DB/XC_AR_INVOICE_H_SELECT_BY_ID',\n                params: {AR_INV_H_ID: Wb.keyValue},\n                async : false,\n                success: function(resp) {\n                    var r = Wb.decode(resp.responseText);\n                    r.BIZ_DATE = Wb.strToDate(r.BIZ_DATE);\n                    Wb.setValue(app.editWinN, r);\n\n                    //为合同名称加上筛选条件\n                    app.AR_CONTRACT_ID_XWL.QUERY_CUSTOMER_ID.setValue(r.CUSTOMER_ID);\n                    app.AR_CONTRACT_ID_XWL.QUERY_LEDGER_ID.setValue(r.LEDGER_ID);\n\n                    //账薄、客户、蓝字发表设置为不可修改状态\n                    setAllReadOnly(true);\n\n                    app.grid1.getStore().load({params: {AR_INV_H_ID: Wb.keyValue}});\n                  \n                    if (Wb.isEmpty(app.AR_INVOICE_H_ID_PICK.L_AR_INV_H_ID.getValue())) {\n                        app.td_2_2.hide();\n                    }else {\n                        app.AR_INVOICE_H_ID_PICK.L_AR_INV_H_CODE.setReadOnly(true);\n                    }\n                }\n            });\n            setButtonHide();\n        }\n        if (Wb.isInsert == 'K') {//开票时查看\n            Wb.request({\n                url: 'm?xwl=xc/ar/inv/DB/XC_AR_INVOICE_H_SELECT_BY_ID',\n                params: {AR_INV_H_ID: Wb.keyValue},\n                async : false,\n                success: function(resp) {\n                    var r = Wb.decode(resp.responseText);\n                    r.BIZ_DATE = Wb.strToDate(r.BIZ_DATE);\n                    Wb.setValue(app.editWinN, r);\n\n                    //账薄、客户、蓝字发表设置为不可修改状态\n                    setAllReadOnly(true);\n//                     app.TAX_AMT.setReadOnly(false);\n                    app.INV_NO.setReadOnly(false);\n                    app.CANCEL_AMT.hide();\n\n                    if (Wb.isEmpty(app.AR_INVOICE_H_ID_PICK.L_AR_INV_H_ID.getValue())) {\n                        app.td_2_2.hide();\n                    }else {\n                        app.AR_INVOICE_H_ID_PICK.L_AR_INV_H_CODE.setReadOnly(true);\n                    }\n                    app.grid1.getStore().load({params: {AR_INV_H_ID: Wb.keyValue}});\n                }\n            });\n            setButtonHide();\n            app.openBtn.show();\n            app.saveBtn.show();\n            app.enclosureBtn.show();\n        }\n        app.LEDGER_ID_XWL.LEDGER_NAME.allowBlank = false;\n        app.CUSTOMER_ID_XWL.CUSTOMER_NAME.allowBlank = false;\n    }\n});\nfunction returnRowFn(r, type) {\n    if (type == 'xc_gl_ledgers') {\n\t\tclearAll();\n        setLedger(r.data.LEDGER_ID);\n        setMinDate(r.data.LEDGER_ID);\n        if (Wb.docCatCode == 'ZZS-HZ') {\n            app.AR_INVOICE_H_ID_PICK.QUERY_AR_DOC_CAT_CODE.setValue('ZZS');\n        }\n        if (Wb.docCatCode == 'ZZSPT-HZ') {\n            app.AR_INVOICE_H_ID_PICK.QUERY_AR_DOC_CAT_CODE.setValue('ZZSPT');\n        }\n    }\n    //选择合同名称后为客户赋值\n    if (type == 'xc_ar_contract') {\n        app.CUSTOMER_ID_XWL.CUSTOMER_ID.setValue(r.data.CUSTOMER_ID);\n        app.CUSTOMER_ID_XWL.CUSTOMER_NAME.setValue(r.data.CUSTOMER_NAME);\n    }\n    //选择客户后为合同名称加筛选条件\n    if (type == 'xc_ar_customers') {\n        if(app.AR_INVOICE_H_ID_PICK.L_AR_INV_H_CODE.getValue() !== null && app.AR_INVOICE_H_ID_PICK.L_AR_INV_H_CODE.getValue() !== ''){\n            clearAll();\n            app.CUSTOMER_ID_XWL.CUSTOMER_ID.setValue(r.data.CUSTOMER_ID);\n            app.CUSTOMER_ID_XWL.CUSTOMER_NAME.setValue(r.data.CUSTOMER_NAME);\n        }\n        else{\n            app.AR_CONTRACT_ID_XWL.QUERY_CUSTOMER_ID.setValue(app.CUSTOMER_ID_XWL.CUSTOMER_ID.getValue());\n            app.AR_CONTRACT_ID_XWL.AR_CONTRACT_ID.setValue('');\n            app.AR_CONTRACT_ID_XWL.AR_CONTRACT_NAME.setValue('');\n        }\n    }\n    //为蓝字发票筛选时带上客户条件\n    if (type == 'xc_ar_invoice_h_before' || type == 'xc_ar_contract_before') {\n        app.AR_CONTRACT_ID_XWL.QUERY_CUSTOMER_ID.setValue(app.CUSTOMER_ID_XWL.CUSTOMER_ID.getValue());\n        app.AR_INVOICE_H_ID_PICK.QUERY_CUSTOMER_ID.setValue(app.CUSTOMER_ID_XWL.CUSTOMER_ID.getValue());\n    }\n\t//选择蓝字发票给其它赋值\n    if (type == 'xc_ar_invoice_h') {\n        setMaxOrMinValue(null);\n        //选择蓝字发票都为项目和成本中心与供应商赋值\n        app.DEPT_ID_XWL.DEPT_ID.setValue(r.data.DEPT_ID);\n        app.DEPT_ID_XWL.DEPT_NAME.setValue(r.data.DEPT_NAME);\n        app.PROJECT_ID_XWL.PROJECT_ID.setValue(r.data.PROJECT_ID);\n        app.PROJECT_ID_XWL.PROJECT_NAME.setValue(r.data.PROJECT_NAME);\n        app.CUSTOMER_ID_XWL.CUSTOMER_ID.setValue(r.data.CUSTOMER_ID);\n        app.CUSTOMER_ID_XWL.CUSTOMER_NAME.setValue(r.data.CUSTOMER_NAME);\n        app.AR_CONTRACT_ID_XWL.AR_CONTRACT_ID.setValue(r.data.AR_CONTRACT_ID);\n        app.AR_CONTRACT_ID_XWL.AR_CONTRACT_NAME.setValue(r.data.AR_CONTRACT_NAME);\n\n        app.TAX_AMT.setValue(r.get('TAX_AMT') * -1);\n        app.TAX_AMT.setMaxValue(0);\n        app.TAX_AMT.setMinValue(r.get('TAX_AMT') * -1);\n        app.INV_AMOUNT.setValue(r.get('INV_AMOUNT') * -1);\n        app.INV_AMOUNT.setMaxValue(0);\n        app.INV_AMOUNT.setMinValue(r.get('INV_AMOUNT') * -1);\n        app.TAX_RATE.setValue(r.get('TAX_RATE'));\n        app.TAX_RATE.setMaxValue(r.get('TAX_RATE'));\n        app.DESCRIPTION.setValue(r.data.DESCRIPTION);\n\n        app.store1.load({\n            params: {\n                AR_INV_H_ID: app.AR_INVOICE_H_ID_PICK.L_AR_INV_H_ID.getValue()\n            },\n            callback: function() {\n                //考虑区分新增和修改状态\n                //避免累加\n                /*app.grid1.getStore().reload({\n                  params: {\n                    AP_INV_H_ID: app.AP_INVOICE_H_ID_PICK.L_AP_INV_H_ID.getValue()\n                  }\n                });*/\n                app.grid1.getStore().removeAll();\n                for (var i = 0; i < app.store1.getCount(); i++) {\n                    var r = app.store1.getAt(i);\n                    r.set('L_AR_INV_H_ID',r.get('AR_INV_H_ID'));\n                    r.set('L_AR_INV_L_ID',r.get('AR_INV_L_ID'));\n                    r.set('AR_INV_L_ID',null);\n                    r.set('AR_INV_H_ID',null);\n                    r.set('AMOUNT',r.get('AMOUNT') * -1);\n                    r.set('QTY',r.get('QTY') * -1);\n                    r.set('TAX_AMT',r.get('TAX_AMT') * -1);\n                    r.set('INV_AMOUNT',r.get('INV_AMOUNT') * -1);\n                    app.QTY_COL.getEditor().setMinValue(r.get('QTY'));\n                    app.AMOUNT_COL.getEditor().setMinValue(r.get('AMOUNT'));\n                    app.INV_AMOUNT_COL.getEditor().setMinValue(r.get('INV_AMOUNT'));\n                    app.TAX_AMT_COL.getEditor().setMinValue(r.get('TAX_AMT'));\n                    app.INV_PRICE_COL.getEditor().setMaxValue(r.get('INV_PRICE'));\n                    app.TAX_RATE_COL.getEditor().setMaxValue(r.get('TAX'));\n                    app.PRICE_COL.getEditor().setMaxValue(r.get('PRICE'));\n                    app.grid1.getStore().add(r.getData());\n                }\n                app.saleTypeBtn.hide();\n            }\n        });\n    }\n    //选择项目带回成本中心\n    if(type == 'xc_pm_projects') {\n        app.DEPT_ID_XWL.DEPT_ID.setValue(r.data.DEPT_ID);\n        app.DEPT_ID_XWL.DEPT_NAME.setValue(r.data.DEPT_NAME);\n    }\n    //选择成本中心为项目查询的成本中心赋值\n    if(type == 'xip_pub_depts') {\n        if(r.data === undefined)\n            app.PROJECT_ID_XWL.QUERY_DEPT_ID.setValue(r.DEPT_ID);\n        else\n            app.PROJECT_ID_XWL.QUERY_DEPT_ID.setValue(r.data.DEPT_ID);\n    }\n}\nfunction clearOtherFn(type) {\n    //清空客户信息时，同时清空合同名称和蓝字发票\n    if (type == 'xc_ar_customers') {\n        if(app.AR_INVOICE_H_ID_PICK.L_AR_INV_H_CODE.getValue() !== null && app.AR_INVOICE_H_ID_PICK.L_AR_INV_H_CODE.getValue() !== ''){\n            clearAll();\n            setMaxOrMinValue(null);\n        }\n        else{\n            app.AR_CONTRACT_ID_XWL.QUERY_CUSTOMER_ID.setValue('');\n            app.AR_CONTRACT_ID_XWL.AR_CONTRACT_ID.setValue('');\n            app.AR_CONTRACT_ID_XWL.AR_CONTRACT_NAME.setValue('');\n        }\n    }\n    //清空账薄时清空面板中所有信息\n    if (type == 'xc_gl_ledgers') {\n\t\tclearAll();\n        setLedger('');\n        setMinDate(null);\n\n    }\n    //清空成本中心同时清空项目查询条件里的成本中心\n    if(type == 'xip_pub_depts') {\n        app.PROJECT_ID_XWL.QUERY_DEPT_ID.setValue('');\n    }\n    //清空蓝字发票，清空明细和税额\n    if(type == 'cancelArInvoice'){\n\t\tclearAll();\n        setMaxOrMinValue(null);\n    }\n}\n\nfunction setLedger(ledgerId) {\n    app.CUSTOMER_ID_XWL.QUERY_LEDGER_ID.setValue(ledgerId);\n    app.PROJECT_ID_XWL.QUERY_LEDGER_ID.setValue(ledgerId);\n    app.DEPT_ID_XWL.QUERY_LEDGER_ID.setValue(ledgerId);\n    app.AR_CONTRACT_ID_XWL.QUERY_LEDGER_ID.setValue(ledgerId);\n    app.AR_INVOICE_H_ID_PICK.QUERY_LEDGER_ID.setValue(ledgerId);\n}\nfunction clearAll(){\n\tapp.DEPT_ID_XWL.DEPT_ID.setValue('');\n    app.DEPT_ID_XWL.DEPT_NAME.setValue('');\n    app.PROJECT_ID_XWL.PROJECT_ID.setValue('');\n    app.PROJECT_ID_XWL.PROJECT_NAME.setValue('');\n    app.CUSTOMER_ID_XWL.CUSTOMER_ID.setValue('');\n    app.CUSTOMER_ID_XWL.CUSTOMER_NAME.setValue('');\n    app.AR_CONTRACT_ID_XWL.AR_CONTRACT_ID.setValue('');\n    app.AR_CONTRACT_ID_XWL.AR_CONTRACT_NAME.setValue('');\n    app.AR_CONTRACT_ID_XWL.QUERY_CUSTOMER_ID.setValue('');\n    app.AR_INVOICE_H_ID_PICK.L_AR_INV_H_ID.setValue('');\n    app.AR_INVOICE_H_ID_PICK.L_AR_INV_H_CODE.setValue('');\n    app.INV_AMOUNT.reset();  \n    app.TAX_AMT.reset();\n    app.TAX_RATE.reset();\n    app.DESCRIPTION.reset();\n  \n    //清空下面的发票详情\n    app.grid1.getStore().removeAll();\n    //显示选择销售类型按钮\n    app.saleTypeBtn.show();\n}\n//账薄、供应商、蓝字发票设置为可修改/不可修改状态\nfunction setSomeReadOnly(flag){\n    app.LEDGER_ID_XWL.LEDGER_NAME.setReadOnly(flag);\n    app.CUSTOMER_ID_XWL.CUSTOMER_NAME.setReadOnly(flag);\n    app.AR_INVOICE_H_ID_PICK.L_AR_INV_H_CODE.setReadOnly(flag);\n}\nfunction setAllReadOnly(flag){\n    setSomeReadOnly(flag);\n    app.DEPT_ID_XWL.DEPT_NAME.setReadOnly(flag);\n    app.PROJECT_ID_XWL.PROJECT_NAME.setReadOnly(flag);\n    app.AR_CONTRACT_ID_XWL.AR_CONTRACT_NAME.setReadOnly(flag);\n    app.INV_AMOUNT.setReadOnly(flag);\n    app.BIZ_DATE.setReadOnly(flag);\n    app.TAX_AMT.setReadOnly(flag);\n    app.TAX_RATE.setReadOnly(flag);\n    app.DESCRIPTION.setReadOnly(flag);\n    app.INV_NO.setReadOnly(flag);\n    app.AMOUNT_COL.getEditor().setReadOnly(flag);\n    app.TAX_AMT_COL.getEditor().setReadOnly(flag);\n    app.TAX_RATE_COL.getEditor().setReadOnly(flag);\n    app.INV_AMOUNT_COL.getEditor().setReadOnly(flag);\n    app.PRICE_COL.getEditor().setReadOnly(flag);\n    app.INV_PRICE_COL.getEditor().setReadOnly(flag);\n    app.PRODUCT_NAME_COL.getEditor().setReadOnly(flag);\n    app.MODEL_COL.getEditor().setReadOnly(flag);\n    app.PRODUCT_NAME_COL1.getEditor().setReadOnly(flag);\n    app.QTY_COL.getEditor().setReadOnly(flag);\n    app.DIM_NAME_COL.getEditor().setReadOnly(flag);\n    app.DESCRIPTION_COL.getEditor().setReadOnly(flag);\n}\nfunction setMaxOrMinValue(flag){\n    app.TAX_AMT.setMinValue(flag);\n    app.INV_AMOUNT.setMinValue(flag);\n    app.TAX_RATE.setMaxValue(17);\n    app.QTY_COL.getEditor().setMinValue(flag);\n    app.AMOUNT_COL.getEditor().setMinValue(flag);\n    app.INV_AMOUNT_COL.getEditor().setMinValue(flag);\n    app.TAX_AMT_COL.getEditor().setMinValue(flag);\n    app.INV_PRICE_COL.getEditor().setMaxValue(flag);\n    app.TAX_RATE_COL.getEditor().setMaxValue(17);\n    app.PRICE_COL.getEditor().setMaxValue(flag);\n}\nfunction setButtonHide(){\n\tapp.addBtn.hide();\n\tapp.saveBtn.hide();\n\tapp.submitButton.hide();\n\tapp.monitorBtn.hide();\n\tapp.withdrawBtn.hide();\n\tapp.cancelPayBtn.hide();\n\tapp.enclosureBtn.hide();\n    app.saleTypeBtn.hide();\n    app.delBtns.hide();\n}\nfunction setButtonShow(){\n\tapp.addBtn.show();\n\tapp.saveBtn.show();\n\tapp.submitButton.show();\n\tapp.monitorBtn.show();\n\tapp.withdrawBtn.show();\n\tapp.cancelPayBtn.show();\n\tapp.enclosureBtn.show();\n    app.saleTypeBtn.show();\n    app.delBtns.show();\n}\nfunction setMinDate(ledgerId){\n    Wb.request({//账簿会计期查询\n        url : 'm?xwl=xc/ar/inv/DB/ledgerDateSelect',\n        params : {LEDGER_ID : ledgerId},\n        async : false,\n        success : function(resp){\n            var temp = Wb.decode(resp.responseText);\n            if(temp.rows[0].START_DATE !== null && temp.rows[0].START_DATE !== \"\"){\n                app.BIZ_DATE.setMinValue(Wb.strToDate(temp.rows[0].START_DATE));\n//                 app.BIZ_DATE.setValue(new Date());\n                app.BIZ_DATE.setReadOnly(false);\n            }\n            else {\n                if(app.LEDGER_ID_XWL.LEDGER_ID.getValue() !== null && app.LEDGER_ID_XWL.LEDGER_ID.getValue() !== \"\"){\n                    Wb.toast('{#ledgerNoDate#}');\n//                     app.BIZ_DATE.setValue(null);\n                    app.BIZ_DATE.setReadOnly(true);\n                }\n            }\n        }\n    });\n}"},"children":[{"configs":{"itemId":"request"},"children":[{"configs":{"itemId":"ldInitStore","url":"m?xwl=xc/com-lov/LEDGER_ID_PICK/DB/XC_GL_LEDGERS_SELECT_SEC"},"events":{"load":"if (Wb.isInsert == 'Y') {\n    if(Wb.isEmpty(Wb.LEDGER_ID)){\n        setValue(store.getAt(0).get('LEDGER_ID'));\n        app.LEDGER_ID_XWL.LEDGER_NAME.setValue(store.getAt(0).get('LEDGER_NAME'));\n    }\n    else{\n        setValue(Wb.LEDGER_ID);\n        app.LEDGER_ID_XWL.LEDGER_NAME.setValue(Wb.LEDGER_NAME);\n    }\n}\nfunction setValue(ledgerId){\n    app.LEDGER_ID_XWL.LEDGER_ID.setValue(ledgerId);\n    setLedger(ledgerId);\n    setMinDate(ledgerId);\n}"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"store1","url":"m?xwl=xc/ar/inv/DB/XC_AR_INVOICE_L_SELECT"},"children":[],"expanded":false,"type":"store"}],"expanded":false,"type":"folder"},{"configs":{"itemId":"form1Tbar"},"children":[{"configs":{"text":"{#openBtn#}","hidden":"true","itemId":"openBtn","iconCls":"open_icon"},"events":{"click":"var invoiceArray = [] ;\nvar deleteData =  {AR_INV_H_ID : app.AR_INV_H_ID.getValue()};\ninvoiceArray.push(deleteData);\n//调用开票销售发票的后台程序\nWb.request({\n    url : '{#contextPath#}' + '/arInvoiceAction.do?method=printArInvoice',\n    params : Wb.apply({invoiceId: invoiceArray,opType : '0'}),\n    success : function(resp){\n        var record = Wb.decode(resp.responseText);\n        var msg = record.msg;\n        if(record.flag === '0'){\n            Wb.toast('{#signRec1#}');\n            app.saveBtn.setDisabled(true);\n            app.openBtn.setDisabled(true);\n            app.PRINT_USER_NAME.setValue('{#XIP.empName#}');\n        }\n        else{\n            Wb.toast(msg);\n        }\n    }\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#addBtn#}","itemId":"addBtn","iconCls":"file_add_icon"},"events":{"click":"app.form1.getForm().reset();\napp.AR_INV_H_ID.setValue(Xip.getId());\napp.AR_DOC_CAT_CODE.setValue(Wb.docCatCode);\napp.BIZ_DATE.setValue(new Date());\napp.AUDIT_STATUS.setValue('A');\napp.XC_AP_SYS_AUDIT_STATUS.setValue('{#A_SYS_STATUS#}');\napp.ldInitStore.load();\napp.saleTypeBtn.show();\napp.grid1.getStore().reload({params:{AR_INV_H_ID:app.AR_INV_H_ID.getValue()}});\nWb.isInsert = 'Y';\n//账薄、客户、蓝字发表设置为可修改状态\nsetSomeReadOnly(false);\nif (Wb.docCatCode == 'ZZS-HZ' || Wb.docCatCode == 'ZZSPT-HZ')\n    setMaxOrMinValue(null);\napp.submitButton.setDisabled(false);\napp.saveBtn.setDisabled(false);"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#saveBtn#}","itemId":"saveBtn","iconCls":"save_icon"},"events":{"click":"if(!app.form1.getForm().isValid()){\n    Wb.toast('{#saveWarn4#}');\n    return;\n}\n//判断是否有销售发票明细\nvar store = app.grid1.store;\nif(store.getCount() === 0){\n    Wb.toast('{#saveWarn1#}');\n    return;\n}\n//判断明细是否为空\nvar message = judgemDtlIsNull();\nif(message !== ''){\n    Wb.verifyGrid(app.grid1);\n    Wb.toast(message);\n    return;\n}\n//通过明细算出主表中的金额值\nvar INV_AMOUNT = 0;//价税合计\nvar AMOUNT = 0;//金额(无税)\nvar TAX_AMT = 0;//税额\nfor (var i = 0; i < app.grid1.getStore().getCount(); i++) {\n    var r = app.grid1.getStore().getAt(i);\n    INV_AMOUNT = INV_AMOUNT + r.get('INV_AMOUNT');\n    AMOUNT = AMOUNT + r.get('AMOUNT');\n    TAX_AMT = TAX_AMT + r.get('TAX_AMT');\n    //行摘要\n    var DESCRIPTION = r.get('DESCRIPTION');\n    if(DESCRIPTION === null || DESCRIPTION === ''){\n\t\tr.set('DESCRIPTION',app.DESCRIPTION.getValue());\n    }\n}\napp.AMOUNT.setValue(AMOUNT);\napp.TAX_AMT.setValue(TAX_AMT);\napp.INV_AMOUNT.setValue(INV_AMOUNT);\nvar remove = app.grid1.getStore().getRemovedRecords();\nfor(var i = 0;i < remove.length;i++){\n    var deleteData =  {AR_INV_L_ID : remove[i].data.AR_INV_L_ID};\n    deleteDtl.push(deleteData);\n}\nWb.request({\n\turl : '{#contextPath#}'+'/arInvoiceAction.do?method=saveOrUpdateArInvoice',\n    params : {'mainTabInfo' : Wb.encode(Wb.getValue(app.form1)),rowTabInfo : Wb.encode(Wb.getData(app.grid1)),deleteDtl : deleteDtl},\n    success : function(resp){\n        var record = Wb.decode(resp.responseText);\n        var msg = record.msg;\n        if(record.flag === '0'){\n            setSomeReadOnly(true);\n            app.AR_INV_H_CODE.setValue(record.arDocCode);\n            Wb.isInsert = 'N';\n            app.grid1.getStore().load({params: {AR_INV_H_ID: app.AR_INV_H_ID.getValue()}});\n        }\n        Wb.toast(msg);\n        tableValue = Wb.encode(Wb.getValue(app.form1));\n        isEditCol = 'N';\n    }\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#submitButton#}","itemId":"submitButton","iconCls":"check_icon"},"events":{"click":"if(Wb.isInsert=='Y' || tableValue !== Wb.encode(Wb.getValue(app.form1)) || isEditCol == 'Y'){\n    Wb.toast('{#submitWarn1#}');\n    return false;\n}\nif(!app.form1.getForm().isValid()){\n    Wb.toast('{#saveWarn4#}');\n    return;\n}\nvar AR_DOC_CAT_CODE = app.AR_DOC_CAT_CODE.getValue();\nWb.request({\n    url : 'm?xwl=xc/ar/inv/DB/XC_AR_INVOICE_L_SELECT',\n    params : {AR_INV_H_ID : app.AR_INV_H_ID.getValue()},\n    success : function(resp){\n        if(Wb.decode(resp.responseText).total === 0){\n            Wb.toast('{#submitWarn5#}\"'+app.AR_INV_H_CODE.getValue()+'\"{#submitWarn6#}');\n            return;\n        }\n        Wb.request({\n            url : '{#contextPath#}' + '/arInvoiceAction.do?method=getArInvoiceProcAndForms',\n            params : {LEDGER_ID : app.LEDGER_ID_XWL.LEDGER_ID.getValue(),\n                      AR_DOC_CAT_CODE : AR_DOC_CAT_CODE\n            },\n            success : function(resp){\n                var temp = Wb.decode(resp.responseText);\n                if(temp.flag === '0'){\n                    //取得流程编码、电脑端审批表单和移动端审批表单\n                    var processCODE = temp.PROCESS_CODE;\n                    var pcApproveForm = temp.PC_A_FORM_URL;\n                    var mobileApproveForm = temp.M_A_FORM_URL;\n                    var orgId = temp.ORG_ID;\n                    if(pcApproveForm === \"\" || pcApproveForm === null || pcApproveForm === undefined){\n                        Wb.toast('{#submitWarn7#}：'+app.AR_DOC_CAT_CODE.getDisplayValue()+'{#submitWarn8#}');\n                        return;\n                    }\n                    //电脑端和移动端审批表单为变量需要设置为全路径\n                    pcApproveForm = '{#appIP#}' +  '/' + pcApproveForm;\n                    mobileApproveForm = '{#appIP#}' +  mobileApproveForm;\n                    //如果流程编码存在, 则提交流程审批处理\n                    if(processCODE !== \"\" && processCODE !== null && processCODE !== undefined){\n                        //如果项目未指定，则设置默认值为 \"-1\"\n                        var prjId = app.PROJECT_ID_XWL.PROJECT_ID.getValue();\n                        if(prjId === null || prjId === \"\" || prjId === undefined){\n                            prjId = \"-1\" ;\n                        }\n                        var auditStatus = app.AUDIT_STATUS.getValue();\n                        var json = {\n                            'APP_IP'\t\t\t: '{#appIP#}',\n                            'EMP_ID'\t\t\t: '{#XIP.empId#}',\n                            'loginName'\t\t\t: '{#XIP.userName#}',\n                            'AR_DOC_CAT_CODE'\t: app.AR_DOC_CAT_CODE.getDisplayValue(),\n                            'M_A_FORM'\t\t\t: mobileApproveForm,\n                            'PC_A_FORM'\t\t\t: pcApproveForm,\n                            'arCatCode'\t\t\t: 'XSFP',\n                            'billType'\t\t\t: app.AR_DOC_CAT_CODE.getValue(),\n                            'DEPT_ID'\t\t\t: app.DEPT_ID_XWL.DEPT_ID.getValue() ,\n                            'DEPT_NAME'\t\t\t: app.DEPT_ID_XWL.DEPT_NAME.getValue(),\n                            'PROJECT_ID'\t\t: prjId,\n                            'ORG_ID'\t\t\t: orgId,\n                            'ledgerId'\t\t\t: app.LEDGER_ID_XWL.LEDGER_ID.getValue(),\n                            'AMT'\t\t\t\t: app.INV_AMOUNT.getValue(),\n                            'ABSAMT'\t\t\t: Math.abs(app.INV_AMOUNT.getValue()),//金额绝对值\n                            'e_business_id'\t\t: app.AR_INV_H_ID.getValue()\n                        };\n                        if(auditStatus === 'A'){//起草状态\n                            XipWf.startAndSubmitByProcess(processCODE,json,function(e){//提交流程\n                                if(e.flag === 0){\n                                    app.INS_CODE.setValue(e.instanceCode);\n                                    submitSuccess();\n                                }\n                                else if(e.flag === 1){\n                                    Wb.toast(e.msg) ;\n                                }else{}\n                            });\n                        }\n                        else if(auditStatus === 'D'){//驳回状态\n                            XipWf.submitInstance(app.INS_CODE.getValue(),json,function(e){//提交流程\n                                if(e.flag === 0){\n                                    submitSuccess();\n                                }\n                                else if(e.flag === 1){\n                                    Wb.toast(e.msg) ;\n                                }else{}\n                            });\n                        }\n                        else if(auditStatus === 'R'){//撤回状态\n                            XipWf.restartAndSubmitByProcess(app.INS_CODE.getValue(),processCODE,json,function(e){//提交流程\n                                if(e.flag === 0){\n                                    submitSuccess();\n                                }\n                                else if(e.flag === 1){\n                                    Wb.toast(e.msg) ;\n                                }else{}\n                            });\n                        }\n                        else if(auditStatus === 'E' || auditStatus === 'C'){//运行中、结束状态\n                            Wb.toast('{#submitWarn3#}');\n                            return false;\n                        }\n                        else{\n                            Wb.toast('{#submitWarn4#}');\n                            return false;\n                        }\n                    }\n                    else{\n                        Wb.toast('{#submitWarn7#}：'+app.AR_DOC_CAT_CODE.getDisplayValue()+'{#submitWarn9#}');\n                    }\n                }\n                else{\n                    Wb.toast(temp.msg);\n                }\n            }\n        });\n    }\n});\nfunction submitSuccess(){\n    Wb.request({\n        url : 'm?xwl=xc/ar/inv/DB/XC_AR_INVOICE_H_SELECT_BY_ID',\n        params : {AR_INV_H_ID : app.AR_INV_H_ID.getValue()},\n        success : function(resp){\n            var r = Wb.decode(resp.responseText);\n            if(r.SYS_AUDIT_STATUS == 'E'){\n                app.SYS_AUDIT_STATUS.setValue('E');\n                app.AUDIT_STATUS.setValue('E');\n                app.XC_AP_SYS_AUDIT_STATUS.setValue('{#E_SYS_STATUS#}');\n            }\n            else{\n                app.SYS_AUDIT_STATUS.setValue('C');\n                app.AUDIT_STATUS.setValue('C');\n                app.XC_AP_SYS_AUDIT_STATUS.setValue('{#C_SYS_STATUS#}');\n            }\n            tableValue = Wb.encode(Wb.getValue(app.form1));\n        }\n    });\n\tapp.submitButton.setDisabled(true);\n    app.saveBtn.setDisabled(true);\n    Wb.toast('{#submitWarn2#}');\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#monitorBtn#}","itemId":"monitorBtn","iconCls":"viewport_icon"},"events":{"click":"if(app.INS_CODE.getValue() === null || app.INS_CODE.getValue() === ''){\n    Wb.toast('{#monitorWarn1#}');\n    return;\n}\nelse{\n    XipWf.showMonitorPage(app.INS_CODE.getValue());\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#withdrawBtn#}","itemId":"withdrawBtn","iconCls":"cancel_icon"},"events":{"click":"if(app.INS_CODE.getValue() === null || app.INS_CODE.getValue() === '') {\n    Wb.toast('{#withdrawWarn1#}');\n\treturn;\n}\nelse if(app.AUDIT_STATUS.getValue() === 'E') {\n    Wb.toast('{#withdrawWarn2#}');\n\treturn;\n}\nelse if(app.AUDIT_STATUS.getValue() === 'R'){\n    Wb.toast('{#withdrawWarn3#}');\n    return;\n}\nelse if(app.AUDIT_STATUS.getValue() === 'D'){\n\tWb.toast('{#withdrawWarn5#}');\n    return;\n}\nelse {\n\t//撤回流程\n\tXipWf.revokeByInstance(app.INS_CODE.getValue(),function(e){\n        if(e.flag === '0'){\n            app.AUDIT_STATUS.setValue('R');\n            app.SYS_AUDIT_STATUS.setValue('A');\n            app.XC_AP_SYS_AUDIT_STATUS.setValue('{#A_SYS_STATUS#}');\n            app.submitButton.setDisabled(false);\n            app.saveBtn.setDisabled(false);\n        }\n        Wb.toast(e.msg);\n        tableValue = Wb.encode(Wb.getValue(app.form1));\n\t});\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#cancelPayBtn#}","itemId":"cancelPayBtn","iconCls":"pay_icon"},"events":{"click":"var ar_inv_h_id = app.AR_INV_H_ID.getValue();\nvar ar_customer_id = app.CUSTOMER_ID_XWL.CUSTOMER_ID.getValue();\nvar contract_id = app.AR_CONTRACT_ID_XWL.AR_CONTRACT_ID.getValue();\nvar L_AR_INV_H_ID = app.AR_INVOICE_H_ID_PICK.L_AR_INV_H_ID.getValue();\nvar ar_doc_cat_code = 'SKD_YUSK';\nvar curGrid = app.grid1;\nif(tableValue !== Wb.encode(Wb.getValue(app.form1)) || isEditCol == 'Y'){\n    Wb.toast('{#cancelPayWarn1#}');\n    return false;\n}\nif(app.SYS_AUDIT_STATUS.getValue() !== 'A'){\n    Wb.toast('{#cancelPayWarn2#}');\n    return;\n}\nif(L_AR_INV_H_ID !== null && L_AR_INV_H_ID !== ''){\n    Wb.toast('{#cancelPayWarn3#}');\n    return false;\n}\nif (app.AR_DOC_CAT_CODE.getValue() == 'ZZS' || app.AR_DOC_CAT_CODE.getValue() == 'ZZSPT') {\n    ar_doc_cat_code = 'SKD_YUSK';\n} else {\n    ar_doc_cat_code = 'SKD_YUSK-H';\n}\nvar ledger_id = app.LEDGER_ID_XWL.LEDGER_ID.getValue();\n\nWb.run({\n    url: 'm?xwl=xc/ar/inv/LOV/LOV_XC_AR_INV_PRE',\n    success: function(apps) {\n        apps.initWin({\n            AR_INV_H_ID : ar_inv_h_id,\n            LEDGER_ID : ledger_id,\n            CUSTOMER_ID : ar_customer_id,\n            AR_CONTRACT_ID : contract_id,\n            AR_DOC_CAT_CODE : ar_doc_cat_code,\n            hideFun : function(rs) {\n                app.CANCEL_AMT.setValue(rs);\n                Wb.reload(curGrid.store);\n                tableValue = Wb.encode(Wb.getValue(app.form1));\n            }\n        });\n    }\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#enclosureBtn#}","itemId":"enclosureBtn","iconCls":"attach_icon"},"events":{"click":"if(Wb.isInsert == 'Y'){\n    Wb.toast('{#enclosureWarn1#}');\n    return false;\n}\nvar temp_id = app.AR_INV_H_ID.getValue();\nvar temp_code = app.AR_INV_H_CODE.getValue();\nWb.request({\n    url : '{#contextPath#}' + '/arInvoiceAction.do?method=getArAttCatCode',\n    params : {LEDGER_ID : app.LEDGER_ID_XWL.LEDGER_ID.getValue(),AR_DOC_CAT_CODE : app.AR_DOC_CAT_CODE.getValue()},\n    success : function(resp){\n        var temp = Wb.decode(resp.responseText);\n        if(temp.flag == '0'){\n            var attCatCode = temp.attCatCode;\n            Xip.showAttachmentManager('{#XIP.userId#}',temp_id,'',attCatCode,temp_code,'Y','Y','Y',function(){},10); \n        }\n        else{\n            Wb.toast(temp.msg);\n        }\n    }\n});"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"maximized":"true","autoScroll":"true","layout":"border","itemId":"editWinN","modal":"true"},"events":{"close":"app.hideFun();"},"children":[{"configs":{"region":"north","tbar":"app.form1Tbar","autoScroll":"true","border":"false","itemId":"form1"},"children":[{"configs":{"style":"fontSize:20px","html":"<font style=\"\">销售发票<\/font>","margin":"10 0 20 0","labelAlign":"center","itemId":"title"},"children":[],"expanded":false,"type":"label"},{"configs":{"layout":"column","margin":"10 0 0 0","border":"false","itemId":"tr1"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_1_1"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/LEDGER_ID_PICK/LEDGER_ID_PICK_SEC","itemId":"LEDGER_ID_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":false,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_1_2"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","pickList":"[\n  ['ZZS','{#zzs#}'],\n  ['ZZSPT','{#zzspt#}'],\n  ['ZZS-HZ','{#zzsH#}'],\n  ['ZZSPT-HZ','{#zzsptH#}']\n]","labelAlign":"right","itemId":"AR_DOC_CAT_CODE","fieldLabel":"{#AR_DOC_CAT_CODE#}"},"events":{"change":"if(newValue == 'ZZS'){\n    app.CUSTOMER_ID_XWL.TAX_NO.setValue('AND TAX_NO IS NOT NULL');\n    app.title.setText('{#zzs#}',false);\n    setMinAndStyle();\n}\nif(newValue == 'ZZSPT'){\n    app.title.setText('{#zzspt#}',false);\n    setPTFPStyle();\n    setMinAndStyle();\n}\nif(newValue == 'ZZS-HZ'){\n    app.CUSTOMER_ID_XWL.TAX_NO.setValue('AND TAX_NO IS NOT NULL');\n    app.title.setText('<font style=\"color:red;\">{#zzs#}<\/font>',false);\n    app.AR_INVOICE_H_ID_PICK.QUERY_AR_DOC_CAT_CODE.setValue('ZZS');\n    setMaxAndStyle();\n}\nif(newValue == 'ZZSPT-HZ'){\n    app.title.setText('<font style=\"color:red;\">{#zzspt#}<\/font>',false);\n    app.AR_INVOICE_H_ID_PICK.QUERY_AR_DOC_CAT_CODE.setValue('ZZSPT');\n    setPTFPStyle();\n    setMaxAndStyle();\n}\nfunction setMaxAndStyle(){\n    app.INV_AMOUNT.setFieldStyle('color:red;');\n    app.TAX_AMT.setFieldStyle('color:red;');\n    app.QTY_COL.getEditor().setFieldStyle('color:red;');\n    app.AMOUNT_COL.getEditor().setFieldStyle('color:red;');\n    app.INV_AMOUNT_COL.getEditor().setFieldStyle('color:red;');\n    app.TAX_AMT_COL.getEditor().setFieldStyle('color:red;');\n    app.TAX_AMT.setMaxValue(0);\n    app.INV_AMOUNT.setMaxValue(0);\n    app.QTY_COL.getEditor().setMaxValue(0);\n    app.AMOUNT_COL.getEditor().setMaxValue(0);\n    app.INV_AMOUNT_COL.getEditor().setMaxValue(0);\n    app.TAX_AMT_COL.getEditor().setMaxValue(0);\n}\nfunction setMinAndStyle(){\n    app.TAX_AMT.setMinValue(0);\n    app.INV_AMOUNT.setMinValue(0);\n    app.QTY_COL.getEditor().setMinValue(0);\n    app.AMOUNT_COL.getEditor().setMinValue(0);\n    app.INV_AMOUNT_COL.getEditor().setMinValue(0);\n    app.TAX_AMT_COL.getEditor().setMinValue(0);\n}\nfunction setPTFPStyle(){\n\tapp.TAX_AMT.setFieldLabel('{#TAX_AMT#}');\n    app.TAX_RATE.setFieldLabel('{#TAX_RATE#}');\n    app.TAX_AMT_COL.setText('{#TAX_AMT#}');\n    app.TAX_RATE_COL.setText('{#TAX_RATE#}(%)');\n    app.TAX_RATE.setValue(0);\n    app.TAX_AMT.allowBlank = true;\n    app.TAX_RATE.allowBlank = true;\n    app.TAX_AMT_COL.getEditor().allowBlank = true;\n    app.TAX_RATE_COL.getEditor().allowBlank = true;\n}"},"children":[],"expanded":false,"type":"combo"},{"configs":{"labelWidth":"80","readOnly":"true","displayField":"VAL_NAME","hidden":"true","valueField":"VAL_CODE","labelAlign":"right","itemId":"AR_DOC_CAT_CODE1","fieldLabel":"{#AR_DOC_CAT_CODE#}"},"events":{"change":"if(newValue == 'ZZS'){\n    app.CUSTOMER_ID_XWL.TAX_NO.setValue('AND TAX_NO IS NOT NULL');\n    app.title.setText('{#zzs#}',false);\n    setMinAndStyle();\n}\nif(newValue == 'ZZSPT'){\n    app.title.setText('{#zzspt#}',false);\n    setPTFPStyle();\n    setMinAndStyle();\n}\nif(newValue == 'ZZS-HZ'){\n    app.CUSTOMER_ID_XWL.TAX_NO.setValue('AND TAX_NO IS NOT NULL');\n    app.title.setText('<font style=\"color:red;\">{#zzs#}<\/font>',false);\n    app.AR_INVOICE_H_ID_PICK.QUERY_AR_DOC_CAT_CODE.setValue('ZZS');\n    setMaxAndStyle();\n}\nif(newValue == 'ZZSPT-HZ'){\n    app.title.setText('<font style=\"color:red;\">{#zzspt#}<\/font>',false);\n    app.AR_INVOICE_H_ID_PICK.QUERY_AR_DOC_CAT_CODE.setValue('ZZSPT');\n    setPTFPStyle();\n    setMaxAndStyle();\n}\nfunction setMaxAndStyle(){\n    app.INV_AMOUNT.setFieldStyle('color:red;');\n    app.TAX_AMT.setFieldStyle('color:red;');\n    app.QTY_COL.getEditor().setFieldStyle('color:red;');\n    app.AMOUNT_COL.getEditor().setFieldStyle('color:red;');\n    app.INV_AMOUNT_COL.getEditor().setFieldStyle('color:red;');\n    app.TAX_AMT_COL.getEditor().setFieldStyle('color:red;');\n    app.TAX_AMT.setMaxValue(0);\n    app.INV_AMOUNT.setMaxValue(0);\n    app.QTY_COL.getEditor().setMaxValue(0);\n    app.AMOUNT_COL.getEditor().setMaxValue(0);\n    app.INV_AMOUNT_COL.getEditor().setMaxValue(0);\n    app.TAX_AMT_COL.getEditor().setMaxValue(0);\n}\nfunction setMinAndStyle(){\n    app.TAX_AMT.setMinValue(0);\n    app.INV_AMOUNT.setMinValue(0);\n    app.QTY_COL.getEditor().setMinValue(0);\n    app.AMOUNT_COL.getEditor().setMinValue(0);\n    app.INV_AMOUNT_COL.getEditor().setMinValue(0);\n    app.TAX_AMT_COL.getEditor().setMinValue(0);\n}\nfunction setPTFPStyle(){\n\tapp.TAX_AMT.setFieldLabel('{#TAX_AMT#}');\n    app.TAX_RATE.setFieldLabel('{#TAX_RATE#}');\n    app.TAX_AMT_COL.setText('{#TAX_AMT#}');\n    app.TAX_RATE_COL.setText('{#TAX_RATE#}(%)');\n    app.TAX_RATE.setValue(0);\n    app.TAX_AMT.allowBlank = true;\n    app.TAX_RATE.allowBlank = true;\n    app.TAX_AMT_COL.getEditor().allowBlank = true;\n    app.TAX_RATE_COL.getEditor().allowBlank = true;\n}"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/ar/inv/DB/XC_AR_XSFP_CLASS_SELECT"},"children":[],"expanded":false,"type":"store"}],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_1_3"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","emptyText":"{#SystemAutomaticGeneration#}","labelAlign":"right","itemId":"AR_INV_H_CODE","fieldLabel":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#AR_INV_H_CODE#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_1_4"},"children":[{"configs":{"labelWidth":"80","allowBlank":"false","labelAlign":"right","itemId":"BIZ_DATE","fieldLabel":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#BIZ_DATE#}"},"children":[],"expanded":false,"type":"date"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"layout":"column","margin":"10 0 0 0","border":"false","itemId":"tr2"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_2_1"},"children":[{"configs":{"file":"m?xwl=xc/ar/ar-com-lov/AR_CUSTOMER_ID_PICK/AR_CUSTOMER_ID_PICK_INV","itemId":"CUSTOMER_ID_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","hidden":"true","layout":"form","columnWidth":".245","itemId":"td_2_2"},"children":[{"configs":{"file":"m?xwl=xc/ar/ar-com-lov/AR_INVOICE_H_PICK/AR_INVOICE_H_PICK_INV_L","itemId":"AR_INVOICE_H_ID_PICK"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_2_3"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/DEPT_ID_PICK/DEPT_ID_LD","itemId":"DEPT_ID_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_2_4"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/PROJECT_ID_PICK/PROJECT_ID_LD","itemId":"PROJECT_ID_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"}],"expanded":false,"type":"panel"},{"configs":{"layout":"column","margin":"10 0 0 0","border":"false","itemId":"tr3"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_3_1"},"children":[{"configs":{"file":"m?xwl=xc/ar/ar-com-lov/AR_CONTRACT_ID_PICK/AR_CONTRACT_ID_PICK_ALL","itemId":"AR_CONTRACT_ID_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_3_2"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"INV_AMOUNT","fieldLabel":"<span style='color:red'>*<\/span>{#INV_AMOUNT#}"},"children":[],"expanded":false,"type":"number"},{"configs":{"labelWidth":"80","readOnly":"true","hidden":"true","labelAlign":"right","itemId":"AMOUNT","fieldLabel":"{#AMOUNT#}"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_3_3"},"children":[{"configs":{"tagConfigs":"baseChars:\"-.0123456789\"","labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"TAX_AMT","fieldLabel":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#TAX_AMT#}"},"events":{"change":"\n","blur":"if(number.getValue()==0){\n  number.setValue('');\n}"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_3_4"},"children":[{"configs":{"labelWidth":"80","allowBlank":"false","minValue":"0","value":"17","labelAlign":"right","itemId":"TAX_RATE","fieldLabel":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#TAX_RATE#}(%)","maxValue":"17"},"events":{"change":"if(number.getValue() > number.maxValue){\n    number.setValue(number.maxValue);\n}","blur":"if(number.value === 0 && Wb.docCatCode !== \"ZZSPT\" && Wb.docCatCode !== \"ZZSPT-HZ\"){\n    app.TAX_RATE.setValue(null);\n}\nfor(var i = 0;i < app.grid1.getStore().getCount();i++){\n    var rec = app.grid1.getStore().getAt(i);\n    rec.set('TAX',number.value);\n  \n    //税额\n    var taxAmt = rec.get('AMOUNT') * rec.get('TAX') / 100;\n    rec.set('TAX_AMT',Ext.util.Format.round(taxAmt,2));\n  \n    //价税合计\n    var invAmount = rec.get('AMOUNT') + rec.get('TAX_AMT');\n    rec.set('INV_AMOUNT',invAmount);\n  \n    //含税单价\n    var invPrice = rec.get('INV_AMOUNT') / rec.get('QTY');\n    rec.set('INV_PRICE',Ext.util.Format.round(invPrice,6));\n}"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"layout":"column","margin":"10 0 0 0","border":"false","itemId":"tr4"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".49","itemId":"td_4_1"},"children":[{"configs":{"labelWidth":"80","allowBlank":"false","labelAlign":"right","itemId":"DESCRIPTION","fieldLabel":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#DESCRIPTION#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_4_2"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"INV_NO","fieldLabel":"{#INV_NO#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_4_3"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"CANCEL_AMT","fieldLabel":"{#CANCEL_AMT#}"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"layout":"column","margin":"10 0 10 0","border":"false","itemId":"tr5"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_5_1"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","value":"{#XIP.empName#}","labelAlign":"right","itemId":"CREATED_BY_NAME","fieldLabel":"{#CREATED_BY_NAME#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_5_2"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"PRINT_USER_NAME","fieldLabel":"{#PRINT_USER_NAME#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_5_3"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"FIN_USER_NAME","fieldLabel":"{#FIN_USER_NAME#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_5_4"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"XC_AP_SYS_AUDIT_STATUS","fieldLabel":"{#SYS_AUDIT_STATUS_DESC#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"hidden":"true","itemId":"hidden_p"},"children":[{"configs":{"hidden":"true","itemId":"AR_INV_H_ID","fieldLabel":"销售发票ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"INS_CODE","fieldLabel":"实例编码"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"AUDIT_STATUS","fieldLabel":"审批状态"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"SYS_AUDIT_STATUS","fieldLabel":"审批状态"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","value":"{#XIP.userId#}","itemId":"USER_ID","fieldLabel":"当前登录人"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"form"},{"configs":{"region":"center","pagingBar":"false","selType":"checkboxmodel","itemId":"grid1","editable":"true"},"events":{"tagEvents":"'cellclick' : function(grid1,td,cellIndex,record,tr,rowIndex,e,eOpts){\n    if(cellIndex == 13){\n        var store = grid1.getStore();\n        var DIM_NAME = record.data.DIM_NAME;\n        var DIM_CODE = record.data.DIM_CODE;\n        if(rowIndex > 0){\n            if(DIM_CODE === '' || DIM_CODE === null){\n                var r = store.getAt(0);\n                record.set('DIM_CODE',r.data.DIM_CODE);\n                record.set('DIM_NAME',r.data.DIM_NAME);\n            }\n        }\n    }\n}"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/ar/inv/DB/XC_AR_INVOICE_L_SELECT"},"events":{"update":"isEditCol = 'Y';","remove":"isEditCol = 'Y';","add":"isEditCol = 'Y';"},"children":[],"expanded":false,"type":"store"},{"configs":{"normalName":"grid1Tbar","itemId":"tbar"},"children":[{"configs":{"text":"{#saleTypeBtn#}","itemId":"saleTypeBtn","iconCls":"db_form_add_icon"},"events":{"click":"var invHId = app.AR_INV_H_ID.getValue();\nvar taxRate = app.TAX_RATE.getValue();\nvar ledgerId = app.LEDGER_ID_XWL.LEDGER_ID.getValue();\nif(Wb.isEmpty(ledgerId)){\n    Wb.toast('{#selectInfo1#}');\n    return false;\n}\n//设置数量\nvar tempQty = 1;\nif (Wb.docCatCode == 'ZZS-HZ' || Wb.docCatCode == 'ZZSPT-HZ') {\n\ttempQty = -1;\n}\n\nvar curGrid = app.grid1;\nWb.run({\n    url: 'm?xwl=xc/ar/inv/LOV/LOV_XC_AR_SALE_TYPE', \n    params:{docCatCode : Wb.docCatCode},//发票类型\n    success: function(app) {\n        app.initWin({\n            AR_DOC_CAT_CODE : '',\n            LEDGER_ID : ledgerId,\n            hideFun : function(rs){\n                Wb.each(rs, function(r) {\n                    r.set('AR_INV_L_ID',Xip.getId());\n                    r.set('AR_INV_H_ID',invHId);\n                    r.set('QTY',tempQty);\n                    r.set('TAX',taxRate);\n                    var grid1Store = curGrid.getStore();\n                    if(grid1Store.getCount() > 0){\n                        r.set('DIM_CODE',grid1Store.getAt(0).get('DIM_CODE'));\n                        r.set('DIM_NAME',grid1Store.getAt(0).get('DIM_NAME'));\n                    }\n                    for(var i = 0;i < grid1Store.getCount();i++){\n                        var gr = grid1Store.getAt(i);\n                        if(gr.get('AR_SALE_TYPE_ID') == r.get('AR_SALE_TYPE_ID')){\n//                             return false;\n                            curGrid.getStore().removeAt(i);\n                        }\n                    }\n                    Wb.add(curGrid, {\n//                         AR_INV_L_ID : r.get('AR_INV_L_ID'),\n//                         AR_INV_H_ID : r.get('AR_INV_H_ID'),\n                        AR_SALE_TYPE_ID : r.get('AR_SALE_TYPE_ID'),\n                        AR_SALE_TYPE_NAME : r.get('AR_SALE_TYPE_NAME'),\n                        BG_ITEM_ID : r.get('BG_ITEM_ID'),\n                        BG_ITEM_NAME : r.get('BG_ITEM_NAME'),\n                        PRODUCT_ID : r.get('PRODUCT_ID'),\n                        PRODUCT_NAME : r.get('PRODUCT_NAME'),\n                        AMOUNT : r.get('PAY_AMT'),\n                        DIM_CODE:r.get('DIM_CODE'),\n                        DIM_NAME:r.get('DIM_NAME'),\n                        QTY : r.get('QTY'),\n                        TAX : r.get('TAX'),\n                        PRICE : Ext.util.Format.round(r.get('PAY_AMT') / r.get('QTY'),6),\n                        TAX_AMT : Ext.util.Format.round(r.get('PAY_AMT') * r.get('TAX') / 100,2),\n                        INV_AMOUNT : (r.get('PAY_AMT') + Ext.util.Format.round(r.get('PAY_AMT') * r.get('TAX') / 100,2)),\n                        INV_PRICE : Ext.util.Format.round((r.get('PAY_AMT') + Ext.util.Format.round(r.get('PAY_AMT') * r.get('TAX') / 100,2)) / r.get('QTY')),\n                        DESCRIPTION : r.get('DESCRIPTION')\n                    },'after', 1, false);\n              });\n            }\n        });\n    }\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#delBtns#}","itemId":"delBtns","iconCls":"file_delete_icon"},"events":{"click":"//删除原则，先将选中记录在表格中移除，点击主单保存时，才真正从数据库删除。\nvar recs = app.grid1.getSelection();\nif (!recs.length) {\n    Wb.toast('{#deleteRec#}');\n    return;\n}\nWb.confirm('{#confirm2#} ' + recs.length + ' {#confirm#}', function() {\n\tWb.remove(app.grid1,recs);\n});"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#AR_INV_L_ID#}","hidden":"true","dataIndex":"AR_INV_L_ID","titleAlign":"center","itemId":"AR_INV_L_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#AR_INV_H_ID#}","hidden":"true","dataIndex":"AR_INV_H_ID","titleAlign":"center","itemId":"AR_INV_H_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#L_AR_INV_H_ID#}","hidden":"true","dataIndex":"L_AR_INV_H_ID","titleAlign":"center","itemId":"L_AR_INV_H_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#L_AR_INV_L_ID#}","hidden":"true","dataIndex":"L_AR_INV_L_ID","titleAlign":"center","itemId":"L_AR_INV_L_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#AR_SALE_TYPE_ID#}","hidden":"true","dataIndex":"AR_SALE_TYPE_ID","titleAlign":"center","itemId":"AR_SALE_TYPE_ID_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"<font color=\"red\">*<\/font>{#AR_SALE_TYPE_NAME#}","width":"150","dataIndex":"AR_SALE_TYPE_NAME","titleAlign":"center","itemId":"AR_SALE_TYPE_NAME_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#PRODUCT_ID#}","hidden":"true","dataIndex":"PRODUCT_ID","titleAlign":"center","itemId":"PRODUCT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#PRODUCT_NAME#}","width":"100","dataIndex":"PRODUCT_NAME","titleAlign":"center","itemId":"PRODUCT_NAME_COL"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","normalName":"PRODUCT_NAME_PICK","itemId":"editor"},"events":{"expand":"app.pickComp.getStore().load();"},"children":[{"configs":{"tagConfigs":"minWidth:400","height":"300","barExportButtons":"false","barExportAllButtons":"false","itemId":"pickComp"},"events":{"itemdblclick":"var r=app.grid1.getSelectionModel().getSelection()[0];\nr.set('PRODUCT_ID',record.data.PRODUCT_ID);\nr.set('PRODUCT_NAME',record.data.PRODUCT_NAME);\napp.PRODUCT_NAME_PICK.setValue(record.data.PRODUCT_NAME);\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/ar/inv/DB/selectProductInfo"},"events":{"beforeload":"operation.params = Wb.getValue([app.form1,app.tbar]);"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"ID","hidden":"true","dataIndex":"PRODUCT_ID","itemId":"PRODUCT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#PRODUCT_CODE_COL#}","dataIndex":"PRODUCT_CODE","itemId":"PRODUCT_CODE_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#PRODUCT_NAME_COL#}","dataIndex":"PRODUCT_NAME","itemId":"PRODUCT_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":false,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"100","emptyText":"{#PRODUCT_CODE_NAME#}","labelAlign":"right","itemId":"QUERY_CODE_NAME"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.pickComp.getStore().load();\n}"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"searchButton","iconCls":"seek_icon"},"events":{"click":"app.pickComp.getStore().load();"},"children":[],"expanded":false,"type":"button"},{"configs":{"itemId":"cancelBtn","iconCls":"delete_icon"},"events":{"click":"var r=app.grid1.getSelectionModel().getSelection()[0];\nr.set('PRODUCT_ID',null);\nr.set('PRODUCT_NAME',null);\napp.PRODUCT_NAME_PICK.setValue(null);\napp.PRODUCT_NAME_PICK.getPicker().hide();"},"children":[],"expanded":true,"type":"item"}],"expanded":false,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":false,"type":"column"},{"configs":{"text":"{#PRODUCT_NAME1#}","width":"150","dataIndex":"PRODUCT_NAMES","titleAlign":"center","itemId":"PRODUCT_NAME_COL1"},"children":[{"configs":{"itemId":"editor"},"children":[],"expanded":false,"type":"text"}],"expanded":false,"type":"column"},{"configs":{"text":"{#MODEL#}","width":"100","dataIndex":"MODEL","titleAlign":"center","itemId":"MODEL_COL"},"children":[{"configs":{"itemId":"editor"},"children":[],"expanded":false,"type":"text"}],"expanded":false,"type":"column"},{"configs":{"text":"<font color=\"red\">*<\/font>{#QTY#}","align":"right","width":"100","dataIndex":"QTY","titleAlign":"center","itemId":"QTY_COL","renderer":"if (Wb.docCatCode == 'ZZS-HZ' || Wb.docCatCode == 'ZZSPT-HZ') {\n    value = '<font style=\"color:red;\">'+value+'<\/font>';\n}\nreturn value;"},"children":[{"configs":{"decimalPrecision":"6","allowBlank":"false","itemId":"editor"},"events":{"blur":"/*\t无税金额\t= ROUND（无税单价*数量，2）\n\t税额\t\t= ROUND（无税金额*税率/100，2）\n    价税合计\t= 无税金额+税额\n    含税单价\t= ROUND（价税合计/数量，6）\n*/\nif(number.value === 0){\n\tnumber.setValue(null);\n    return;\n}\nvar rec = app.grid1.getSelection()[0];\n\n//无税金额\nvar amount = number.value * rec.data.PRICE;\nrec.set('AMOUNT',Ext.util.Format.round(amount,2));\n\n//税额\nvar taxAmt = rec.get('AMOUNT') * rec.get('TAX') / 100;\nrec.set('TAX_AMT',Ext.util.Format.round(taxAmt,2));\n\n//价税合计\nvar invAmount = rec.get('AMOUNT') + rec.get('TAX_AMT');\nrec.set('INV_AMOUNT',invAmount);\n\n//含税单价\nvar invPrice = rec.get('INV_AMOUNT') / number.value;\nrec.set('INV_PRICE',Ext.util.Format.round(invPrice,6));"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"column"},{"configs":{"text":"{#DIM_CODE#}","hidden":"true","dataIndex":"DIM_CODE","titleAlign":"center","itemId":"DIM_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"<font color=\"red\">*<\/font>{#DIM_NAME#}","width":"80","dataIndex":"DIM_NAME","titleAlign":"center","itemId":"DIM_NAME_COL"},"children":[{"configs":{"labelWidth":"80","allowBlank":"false","labelAlign":"right","normalName":"DIM_NAME_PICK","itemId":"editor"},"events":{"expand":"app.pickComp.getStore().load();"},"children":[{"configs":{"tagConfigs":"minWidth:400","height":"300","barExportButtons":"false","barExportAllButtons":"false","itemId":"pickComp"},"events":{"itemdblclick":"var r=app.grid1.getSelectionModel().getSelection()[0];\nr.set('DIM_CODE',record.data.DIM_CODE);\nr.set('DIM_NAME',record.data.DIM_NAME);\napp.DIM_NAME_PICK.setValue(record.data.DIM_NAME);\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/ap/inv/DB/XC_GL_DIMENSIONS_SELECT"},"events":{"beforeload":"operation.params = Wb.getValue(app.tbar);"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","dataIndex":"DIM_ID","itemId":"DIM_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#DIM_CODE_COL#}","dataIndex":"DIM_CODE","itemId":"DIM_CODE_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#DIM_NAME_COL#}","dataIndex":"DIM_NAME","itemId":"DIM_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":false,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"100","emptyText":"{#DIM_CODE_NAME#}","labelAlign":"right","itemId":"QUERY_CODE_NAME"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.pickComp.getStore().load();\n}"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"searchButton","iconCls":"seek_icon"},"events":{"click":"app.pickComp.getStore().load();"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":false,"type":"column"},{"configs":{"text":"{#PRICE#}","width":"100","align":"right","dataIndex":"PRICE","format":"0,000.00","titleAlign":"center","itemId":"PRICE_COL"},"children":[{"configs":{"decimalPrecision":"6","minValue":"0","itemId":"editor"},"events":{"focus":"var rec = app.grid1.getSelection()[0];\nif(rec.data.QTY === 0 || rec.data.QTY === null || Wb.isInsert == 'S' || Wb.isInsert == 'K'){\n\tnumber.setReadOnly(true);\n}\nelse{\n\tnumber.setReadOnly(false);\n}","blur":"/*\t无税金额\t= ROUND（无税单价*数量，2）\n\t税额\t\t= ROUND（无税金额*税率/100，2）\n    价税合计\t= 无税金额+税额\n    含税单价\t= ROUND（价税合计/数量，6）\n*/\n\nvar rec = app.grid1.getSelection()[0];\n\n//无税金额\nvar amount = number.value * rec.get('QTY');\nrec.set('AMOUNT',Ext.util.Format.round(amount,2));\n\n//税额\nvar taxAmt = rec.get('AMOUNT') * rec.get('TAX') / 100;\nrec.set('TAX_AMT',Ext.util.Format.round(taxAmt,2));\n\n//价税合计\nvar invAmount = rec.get('AMOUNT') + rec.get('TAX_AMT');\nrec.set('INV_AMOUNT',invAmount);\n\n//含税单价\nvar invPrice = rec.get('INV_AMOUNT') / rec.get('QTY');\nrec.set('INV_PRICE',Ext.util.Format.round(invPrice,6));"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"column"},{"configs":{"text":"{#INV_PRICE#}","width":"100","align":"right","dataIndex":"INV_PRICE","format":"0,000.00","titleAlign":"center","itemId":"INV_PRICE_COL"},"children":[{"configs":{"readOnly":"true","decimalPrecision":"6","minValue":"0","itemId":"editor"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"column"},{"configs":{"text":"{#AMOUNT#}","width":"100","align":"right","dataIndex":"AMOUNT","format":"0,000.00","titleAlign":"center","itemId":"AMOUNT_COL","renderer":"if (Wb.docCatCode == 'ZZS-HZ' || Wb.docCatCode == 'ZZSPT-HZ') {\n    value = '<font color=red>'+Wb.format(value,'0,000.00')+'<\/font>';\n}\nelse {\n    value = Wb.format(value,'0,000.00');\n}\nreturn value;"},"children":[{"configs":{"decimalPrecision":"6","itemId":"editor"},"events":{"focus":"var rec = app.grid1.getSelection()[0];\nif(rec.data.QTY === 0 || rec.data.QTY === null || Wb.isInsert == 'S'){\n\tnumber.setReadOnly(true);\n}\nelse{\n\tnumber.setReadOnly(false);\n}","blur":"/*\n\t无税单价\t= ROUND（无税金额/数量，6）\n    税额\t\t= ROUND（无税金额*税率/100，2）\n    价税合计\t= 无税金额+税额\n    含税单价\t= ROUND（价税合计/数量，6）\n*/\nvar rec = app.grid1.getSelection()[0];\n\n//无税单价\nvar price = number.value / rec.get('QTY');\nrec.set('PRICE',Ext.util.Format.round(price,6));\n\n//税额\nvar taxAmt = number.value * rec.get('TAX') / 100;\nrec.set('TAX_AMT',Ext.util.Format.round(taxAmt,2));\n\n//价税合计\nvar invAmount = number.value + rec.get('TAX_AMT');\nrec.set('INV_AMOUNT',invAmount);\n\n//含税单价\nvar invPrice = rec.get('INV_AMOUNT') / rec.get('QTY');\nrec.set('INV_PRICE',Ext.util.Format.round(invPrice,6));"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"column"},{"configs":{"text":"<font color=\"red\">*<\/font>{#TAX_RATE#}(%)","width":"100","align":"right","dataIndex":"TAX","titleAlign":"center","itemId":"TAX_RATE_COL"},"children":[{"configs":{"allowBlank":"false","minValue":"0","itemId":"editor","maxValue":"17"},"events":{"change":"if(number.getValue() > number.maxValue){\n    number.setValue(number.maxValue);\n}","blur":"/*\n\t无税单价\t= ROUND（无税金额/数量，6）\n    税额\t\t= ROUND（无税金额*税率/100，2）\n    价税合计\t= 无税金额+税额\n    含税单价\t= ROUND（价税合计/数量，6）\n*/\nvar rec = app.grid1.getSelection()[0];\n\n//税额\nvar taxAmt = rec.get('AMOUNT') * number.value / 100;\nrec.set('TAX_AMT',Ext.util.Format.round(taxAmt,2));\n\n//价税合计\nvar invAmount = rec.get('AMOUNT') + rec.get('TAX_AMT');\nrec.set('INV_AMOUNT',invAmount);\n\n//含税单价\nvar invPrice = rec.get('INV_AMOUNT') / rec.get('QTY');\nrec.set('INV_PRICE',Ext.util.Format.round(invPrice,6));"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"column"},{"configs":{"text":"<font color=\"red\">*<\/font>{#TAX_AMT#}","width":"100","align":"right","dataIndex":"TAX_AMT","format":"0,000.00","titleAlign":"center","itemId":"TAX_AMT_COL","renderer":"if (Wb.docCatCode == 'ZZS-HZ' || Wb.docCatCode == 'ZZSPT-HZ') {\n    value = '<font color=red>'+Wb.format(value,'0,000.00')+'<\/font>';\n}\nelse {\n    value = Wb.format(value,'0,000.00');\n}\nreturn value;"},"children":[{"configs":{"allowBlank":"false","itemId":"editor"},"events":{"change":"if(number.value > number.maxValue)\n    number.setValue(number.maxValue);\nif(number.value < number.minValue)\n    number.setValue(number.minValue);","focus":"var rec = app.grid1.getSelection()[0];\nif (Wb.docCatCode == 'ZZS-HZ' || Wb.docCatCode == 'ZZSPT-HZ') {\n    if(app.AR_INVOICE_H_ID_PICK.L_AR_INV_H_CODE.getValue() === null || app.AR_INVOICE_H_ID_PICK.L_AR_INV_H_CODE.getValue() === '')\n        number.setMinValue(rec.get('INV_AMOUNT'));\n}\nelse{\n    if(app.AR_INVOICE_H_ID_PICK.L_AR_INV_H_CODE.getValue() === null || app.AR_INVOICE_H_ID_PICK.L_AR_INV_H_CODE.getValue() === '')\n        number.setMaxValue(rec.get('INV_AMOUNT'));\n}\nif(rec.data.QTY === 0 || rec.data.QTY === null || Wb.isInsert == 'S'){\n\tnumber.setReadOnly(true);\n}\nelse{\n\tnumber.setReadOnly(false);\n}","blur":"/*\n\t无税金额\t= 价税合计-税额\n    无税单价\t= ROUND（无税金额/数量，6）\n    含税单价\t= ROUND（价税合计/数量，6）\n*/\nvar rec = app.grid1.getSelection()[0];\n\n//无税金额\nvar amount = rec.get('INV_AMOUNT') - number.value;\nrec.set('AMOUNT',Ext.util.Format.round(amount,2));\n\n//无税单价\nvar price = rec.get('AMOUNT') / rec.get('QTY');\nrec.set('PRICE',Ext.util.Format.round(price,6));\n\n//含税单价\nvar invPrice = rec.get('INV_AMOUNT') / rec.get('QTY');\nrec.set('INV_PRICE',Ext.util.Format.round(invPrice,6));"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"column"},{"configs":{"text":"<font color=\"red\">*<\/font>{#INV_AMOUNT#}","width":"100","align":"right","dataIndex":"INV_AMOUNT","format":"0,000.00","titleAlign":"center","itemId":"INV_AMOUNT_COL","renderer":"if (Wb.docCatCode == 'ZZS-HZ' || Wb.docCatCode == 'ZZSPT-HZ') {\n    value = '<font color=red>'+Wb.format(value,'0,000.00')+'<\/font>';\n}\nelse {\n    value = Wb.format(value,'0,000.00');\n}\nreturn value;"},"children":[{"configs":{"readOnly":"true","allowBlank":"false","itemId":"editor"},"children":[],"expanded":false,"type":"number"}],"expanded":false,"type":"column"},{"configs":{"text":"{#DESCRIPTION#}","width":"300","dataIndex":"DESCRIPTION","titleAlign":"center","itemId":"DESCRIPTION_COL"},"children":[{"configs":{"itemId":"editor"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"window"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}