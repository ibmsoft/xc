{"inframe":false,"title":"应收单查询","hidden":false,"roles":{"default":1},"children":[{"configs":{"loginRequired":"false","jsLinks":"[\"platform/util/platformUtil.js\"]","serverScript":"//---------------------获取当前模块语言对应的.json文件，放到request中----------------\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xc/ar/gl/json/XC_AR_INV_GL_H_ALL\");\nvar contextPath = request.getContextPath();\nrequest.setAttribute(\"contextPath\",contextPath);","itemId":"module"},"events":{"finalize":"function returnRowFn(r,type){\n    if(type==='xc_gl_ledgers'){\n        app.searchButton.fireEvent('click');\n    }\n}\nfunction clearOtherFn(type){\n    //清空账薄时清空面板中所有信息\n    if(type=='xc_gl_ledgers'){\n        app.LEDGER_XWL.LEDGER_ID.setValue('');\n        app.LEDGER_XWL.LEDGER_NAME.setValue('');\n        app.searchButton.fireEvent('click');\n    }\n}"},"children":[{"configs":{"itemId":"request"},"children":[{"configs":{"itemId":"ldInitStore","autoLoad":"true","url":"m?xwl=xc/com-lov/LEDGER_ID_PICK/DB/XC_GL_LEDGERS_SELECT_SEC"},"events":{"load":"if(store.getCount() > 0){\n    app.LEDGER_XWL.LEDGER_ID.setValue(store.getAt(0).get('LEDGER_ID'));\n    app.LEDGER_XWL.LEDGER_NAME.setValue(store.getAt(0).get('LEDGER_NAME'));\n    app.searchButton.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"folder"},{"configs":{"layout":"border","itemId":"viewport1"},"children":[{"configs":{"region":"north","itemId":"search_form"},"children":[{"configs":{"layout":"column","margin":"10 0 0 0","itemId":"row1","border":"false"},"children":[{"configs":{"layout":"form","columnWidth":".33","itemId":"row1_1","border":"false"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/LEDGER_ID_PICK/LEDGER_ID_PICK_SEC","itemId":"LEDGER_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".33","itemId":"row1_2","border":"false"},"children":[{"configs":{"labelWidth":"80","value":"All","labelAlign":"right","pickList":"[\n  ['All','{#all#}'],\n  ['YSD','{#ysd#}'],\n  ['YSD-HZ','{#ysdH#}'],\n]","itemId":"AR_DOC_CAT_CODE","fieldLabel":"{#AR_DOC_CAT_CODE#}"},"events":{"select":"app.searchButton.fireEvent('click');","specialkey":"if(e.getKey()===13) {\n  app.searchButton.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"combo"},{"configs":{"labelWidth":"80","displayField":"VAL_NAME","hidden":"true","valueField":"VAL_CODE","labelAlign":"right","itemId":"AR_DOC_CAT_CODE1","fieldLabel":"{#AR_DOC_CAT_CODE#}"},"events":{"select":"app.searchButton.fireEvent('click');","specialkey":"if(e.getKey()===13) {\n  app.searchButton.fireEvent('click');\n}"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/ar/gl/DB/XC_AR_YSD_CLASS_SELECT"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".33","itemId":"row1_3","border":"false"},"children":[{"configs":{"labelWidth":"80","emptyText":"{#CONTRACT_CODE#}","labelAlign":"right","itemId":"AR_INV_GL_H_CODE","fieldLabel":"{#AR_INV_GL_H_CODE#}"},"events":{"specialkey":"if(e.getKey()===13) {\n  app.searchButton.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"layout":"column","margin":"10 0 0 0","itemId":"row2","border":"false"},"children":[{"configs":{"layout":"fit","columnWidth":".33","itemId":"row2_1","border":"false"},"children":[{"configs":{"layout":"column","itemId":"row2_1_1","border":"false"},"children":[{"configs":{"text":"{#INV_AMOUNT_START#}：","width":"80","margin":"0 3 0 0","labelAlign":"right","itemId":"label"},"children":[],"expanded":false,"type":"label"},{"configs":{"tagConfigs":"columnWidth : 0.5","labelWidth":"80","labelAlign":"right","itemId":"INV_AMOUNT_START"},"events":{"specialkey":"if(e.getKey()===13) {\n  app.searchButton.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"number"},{"configs":{"text":"--","itemId":"label1"},"children":[],"expanded":false,"type":"label"},{"configs":{"tagConfigs":"columnWidth : 0.5","labelWidth":"20","itemId":"INV_AMOUNT_END"},"events":{"specialkey":"if(e.getKey()===13) {\n  app.searchButton.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".33","itemId":"row2_2","border":"false"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"CUSTOMER_NAME","fieldLabel":"{#CUSTOMER_NAME#}"},"events":{"specialkey":"if(e.getKey()===13) {\n  app.searchButton.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".33","itemId":"row2_3","border":"false"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"PROJECT_NAME","fieldLabel":"{#PROJECT_NAME#}"},"events":{"specialkey":"if(e.getKey()===13) {\n  app.searchButton.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"layout":"column","margin":"10 0 0 0","itemId":"row3","border":"false"},"children":[{"configs":{"layout":"form","columnWidth":".33","itemId":"row3_1","border":"false"},"children":[{"configs":{"layout":"column","itemId":"row3_1_1","border":"false"},"children":[{"configs":{"text":"{#GL_DATE_START#}：","width":"80","margin":"0 3 0 0","labelAlign":"right","itemId":"label"},"children":[],"expanded":false,"type":"label"},{"configs":{"tagConfigs":"columnWidth : 0.5","labelWidth":"80","labelAlign":"right","itemId":"BIZ_DATE_START"},"events":{"select":"app.searchButton.fireEvent('click');","specialkey":"if(e.getKey()===13) {\n  app.searchButton.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"date"},{"configs":{"text":"--","itemId":"label1"},"children":[],"expanded":false,"type":"label"},{"configs":{"tagConfigs":"columnWidth : 0.5","labelWidth":"20","itemId":"BIZ_DATE_END"},"events":{"select":"app.searchButton.fireEvent('click');","specialkey":"if(e.getKey()===13) {\n  app.searchButton.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"date"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".33","itemId":"row3_2","border":"false"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"DEPT_NAME","fieldLabel":"{#DEPT_NAME#}"},"events":{"specialkey":"if(e.getKey()===13) {\n  app.searchButton.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".33","itemId":"row3_3","border":"false"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"ACC_NAME","fieldLabel":"{#AR_ACC_NAME_DEBT#}"},"events":{"specialkey":"if(e.getKey()===13) {\n  app.searchButton.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"layout":"column","margin":"10 0 10 0","itemId":"row4","border":"false"},"children":[{"configs":{"layout":"form","columnWidth":".33","itemId":"row4_1","border":"false"},"children":[{"configs":{"labelWidth":"80","value":"ALL","labelAlign":"right","pickList":"[\n  ['ALL','{#all#}'],\n  ['GL','{#SOURCE_INV_GL#}'],\n  ['INV','{#SOURCE_INV#}'],\n  ['TEMP','{#SOURCE_TEMP#}']\n]","itemId":"SOURCE","fieldLabel":"{#SOURCE#}"},"events":{"select":"app.searchButton.fireEvent('click');","specialkey":"if(e.getKey()===13) {\n  app.searchButton.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".33","itemId":"row4_2","border":"false"},"children":[{"configs":{"tagConfigs":"columnWidth : 1","labelWidth":"80","labelAlign":"right","itemId":"CREATED_NAME","fieldLabel":"{#CREATED_BY_NAME#}"},"events":{"specialkey":"if(e.getKey()===13) {\n  app.searchButton.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"80","hidden":"true","value":"2","labelAlign":"right","itemId":"INIT","fieldLabel":"期初"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".33","itemId":"row4_3","border":"false"},"children":[{"configs":{"layout":"column","itemId":"row4_3_1","border":"false"},"children":[{"configs":{"tagConfigs":"columnWidth : 1","labelWidth":"80","value":"ALL","pickList":"[\n  ['ALL','{#all#}'],\n  ['1','{#1_STATUS#}'],\n  ['3','{#3_STATUS#}']\n]","labelAlign":"right","itemId":"V_STATUS","fieldLabel":"{#V_STATUS#}"},"events":{"select":"app.searchButton.fireEvent('click');","specialkey":"if(Ext.EventObject.getKey()==13){\n    app.searchButton.fireEvent('click');\n}"},"children":[],"expanded":true,"type":"combo"},{"configs":{"text":"{#searchButton#}","itemId":"searchButton","iconCls":"seek_icon"},"events":{"click":"app.grid.store.load({params : Wb.getValue(app.search_form)});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#resetButton#}","itemId":"resetButton","iconCls":"refresh_icon"},"events":{"click":"app.search_form.getForm().reset();\napp.searchButton.fireEvent('click');"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"form"},{"configs":{"region":"center","selType":"checkboxmodel","itemId":"grid"},"events":{"itemdblclick":"app.updateBtn.fireEvent('click');"},"children":[{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"{#insertBtn#}","itemId":"addBtn","iconCls":"file_add_icon"},"children":[{"configs":{"text":"{#ysd#}","itemId":"addYSDBtn","iconCls":"file_add_icon"},"events":{"click":"var curGrid = app.grid;\nWb.run({\n    url: 'm?xwl=xc/ar/gl/XC_AR_INV_GL_H_NO_C', \n    success: function(apps) {\n        apps.initWin({\n            AR_INV_GL_H_ID : '',\n            IS_INSERT : 'Y',\n            AR_DOC_CAT_CODE : 'YSD',\n            LEDGER_ID : app.LEDGER_XWL.LEDGER_ID.getValue(),\n            LEDGER_NAME : app.LEDGER_XWL.LEDGER_NAME.getValue(),\n            hideFun : function(){\n                app.searchButton.fireEvent('click');\n            }\n        });\n    }\n});\n"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#ysdH#}","itemId":"addYSD-HZBtn","iconCls":"file_add_icon"},"events":{"click":"var curGrid = app.grid;\nWb.run({\n    url: 'm?xwl=xc/ar/gl/XC_AR_INV_GL_H_NO_C', \n    success: function(apps) {\n        apps.initWin({\n            AR_INV_GL_H_ID : '',\n            IS_INSERT : 'Y',\n            AR_DOC_CAT_CODE : 'YSD-HZ',\n            LEDGER_ID : app.LEDGER_XWL.LEDGER_ID.getValue(),\n            LEDGER_NAME : app.LEDGER_XWL.LEDGER_NAME.getValue(),\n            hideFun : function(){\n                app.searchButton.fireEvent('click');\n            }\n        });\n    }\n});\n"},"children":[],"expanded":false,"type":"item"}],"expanded":true,"type":"item"},{"configs":{"text":"{#copyBtn#}","itemId":"copyBtn","iconCls":"copy_icon"},"events":{"click":"var curGrid = app.grid;\nvar recs = curGrid.getSelection();\nif (recs.length > 1 || recs.length === 0) {//大于一条或没选择会警告\n    Wb.toast('{#copyRecGL#}');\n    return;\n}\nWb.run({\n    url : 'm?xwl=xc/ar/gl/XC_AR_INV_GL_H_NO_C',\n    params : {'businessId' : recs[0].data.AR_INV_H_ID},\n    success : function(apps) {\n        apps.initWin({\n            AR_INV_GL_H_ID : recs[0].data.AR_INV_GL_H_ID,\n            IS_INSERT : 'C',\n            flag : 'inv_h',\n            AR_DOC_CAT_CODE : recs[0].data.AR_DOC_CAT_CODE,\n            hideFun : function(){\n                app.searchButton.fireEvent('click');\n            }\n        });\n    }\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#updateBtn#}","itemId":"updateBtn","iconCls":"file_edit_icon"},"events":{"click":"var curGrid = app.grid;\nvar recs = curGrid.getSelection();\nif (recs.length > 1 || recs.length === 0) {//大于一条或没选择会警告\n    Wb.toast('{#updateRecGL#}');\n    return;\n}\nWb.run({\n    url : 'm?xwl=xc/ar/gl/XC_AR_INV_GL_H_NO_C',\n    success : function(apps) {\n        apps.initWin({\n            AR_INV_GL_H_ID : recs[0].data.AR_INV_GL_H_ID,\n            IS_INSERT : 'N',\n            flag : 'inv_h',\n            AR_DOC_CAT_CODE : recs[0].data.AR_DOC_CAT_CODE,\n            hideFun : function(){\n                app.searchButton.fireEvent('click');\n            }\n        });\n    }\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#delBtn#}","itemId":"delBtn","iconCls":"file_delete_icon"},"events":{"click":"var recs = app.grid.getSelection();\nif (!recs.length) {\n    Wb.toast('{#deleteRecGL#}');\n    return;\n}\nvar arArray = [] ;\nfor(var i = 0;i < recs.length;i++){\n    if(!Wb.isEmpty(recs[i].data.AR_INV_H_ID)){\n        Wb.toast('{#deleteRec1GL#}');\n        return;\n    }\n\tif(recs[i].data.V_STATUS == '1' || recs[i].data.V_STATUS === '' || recs[i].data.V_STATUS === null){\n        var deleteData = {'arId' : recs[i].data.AR_INV_GL_H_ID,arCatCode : 'YSD'} ;\n        arArray.push(deleteData);\n    }\n}\nif(arArray.length === 0){\n    Wb.toast('{#deleteRec2GL#}');\n    return;\n}\nWb.confirm('{#confirm2#} ' + recs.length + ' {#confirm#}', function() {\n    //调用删除销售发票的后台程序\n    Wb.request({\n        url : '{#contextPath#}' + '/arDocsAction.do?method=deleteArDoc',\n        params : Wb.apply({arInfo: arArray}),\n        success : function(resp){\n            var record = Wb.decode(resp.responseText);\n            var msg = record.msg;\n            Wb.toast(msg);\n            app.searchButton.fireEvent('click');\n        }\n    });\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#verfyBtn#}","itemId":"verfyBtn","iconCls":"check_icon"},"events":{"click":"var rows = app.grid.getSelection();\nif(rows.length === 0){\n    Wb.toast(\"{#verfyRecGL#}\");\n    return;\n}\nelse{\n    //单据ID数组\n    var docArray = [];\n    var z = 0;\n    for(var i = 0;i < rows.length;i++){\n        var headId = rows[i].data.V_HEAD_ID;//凭证头ID\n        if(headId === '' || headId === null){\n            z++;\n        }\n        if(rows[i].data.V_STATUS == '1'){\n            var arId = rows[i].data.AR_INV_GL_H_ID;//单据ID\n            var paramJson = {'arId' : arId,arCatCode : 'YSD'};\n            docArray.push(paramJson);\n        }\n    }\n    if(z > 0){\n        Wb.toast(\"{#verfyRec1GL#}\");\n        return;\n    }\n    if(docArray.length === 0){\n        Wb.toast('{#verfyRec2GL#}');\n        return;\n    }\n    Wb.request({\n        url: '{#contextPath#}'+'/arDocsAction.do?method=checkArVoucher',\n        params: Wb.apply({arInfo: docArray}),\n        success: function(resp) {\n            var record = Wb.decode(resp.responseText);\n            var msg = record.msg;\n            app.searchButton.fireEvent('click');\n            Wb.toast(msg);\n        }\n\t});\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#cancelVerfyBtn#}","itemId":"cancelVerfyBtn","iconCls":"delete_icon"},"events":{"click":"var rows = app.grid.getSelection();\nif(rows.length === 0){\n    Wb.toast(\"{#cancelVerfyRecGL#}\");\n    return;\n}\nelse{\n    //单据ID数组\n    var docArray = [];\n    var z = 0;\n    for(var i = 0;i < rows.length;i++){\n        var headId = rows[i].data.V_HEAD_ID;//凭证头ID\n        if(headId === '' || headId === null){\n            z++;\n        }\n        if(rows[i].data.V_STATUS == '3'){\n            var arId = rows[i].data.AR_INV_GL_H_ID;//单据ID\n            var headId = rows[i].data.V_HEAD_ID;//凭证头ID\n            var paramJson = {'arId' : arId,arCatCode : 'YSD'};\n            docArray.push(paramJson);\n        }\n    }\n    if(z > 0){\n        Wb.toast(\"{#verfyRec1GL#}\");\n        return;\n    }\n    if(docArray.length === 0){\n        Wb.toast(\"{#cancelVerfyRec2GL#}\");\n        return;\n    }\n    Wb.request({\n        url: '{#contextPath#}' + '/arDocsAction.do?method=cancelCheckArVoucher',\n        params: Wb.apply({\n            arInfo: docArray\n        }),\n        success: function(resp) {\n            var record = Wb.decode(resp.responseText);\n            var msg = record.msg;\n            app.searchButton.fireEvent('click');\n            Wb.toast(msg);\n        }\n    });\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#seekBtn#}","itemId":"lookDtlBtn","iconCls":"seek_icon"},"events":{"click":"var curGrid = app.grid;\nvar recs = curGrid.getSelection();\nif (recs.length > 1 || recs.length === 0) {//大于一条或没选择会警告\n    Wb.toast(\"{#seekRecGL#}\");\n    return;\n}\nWb.run({\n    url : 'm?xwl=xc/ar/gl/XC_AR_INV_GL_H_NO_C', \n    success : function(apps) {\n        apps.initWin({\n            AR_INV_GL_H_ID : recs[0].data.AR_INV_GL_H_ID,\n            IS_INSERT : 'S',\n            AR_DOC_CAT_CODE : recs[0].data.AR_DOC_CAT_CODE,\n            hideFun : function(){\n                app.searchButton.fireEvent('click');\n            }\n        });\n    }\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#cancelPayBtn#}","itemId":"cancelPayBtn","iconCls":"pay_icon"},"events":{"click":"var curGrid = app.grid;\nvar r = curGrid.getSelectionModel().getSelection()[0];\nvar rec = curGrid.getSelection();\nif (rec.length > 1 || rec.length === 0) {//大于一条或没选择会警告\n    Wb.toast(\"{#cancelRecGL#}\");\n    return;\n}\nif (Wb.isEmpty(r.get('V_STATUS')) || parseInt(r.get('V_STATUS'))<3) {\n    Wb.toast(\"{#cancelRec1GL#}\");\n    return;\n}\nvar AR_INV_H_ID = r.get('AR_INV_H_ID');//发票ID\nif(r.get('CANCEL_AMT') !== null && r.get('CANCEL_AMT') !== '' && r.get('CANCEL_AMT') !== 0){\n\tAR_INV_H_ID = null;\n}\nWb.request({\n    url: 'm?xwl=xc/ar/gl/DB/XC_AR_INV_GL_H_PUB_ERROR_ALERT',\n    params: {\n        AR_INV_GL_H_ID: r.get('AR_INV_GL_H_ID'),\n        sql: 'select 1 FROM xc_ar_inv_gl_h WHERE AR_INV_GL_H_ID={?AR_INV_GL_H_ID?} AND NO_PAY_AMT=0',\n        errorMsg: '{#cancelRec2GL#}'\n    },\n    success : function(){\n        Wb.run({\n            url: 'm?xwl=xc/ar/cancel/XC_AR_CANCEL_H_NO_C', \n            success: function(apps) {\n                apps.initWin({\n                    AR_CANCEL_H_ID:'',\n                    AR_INV_GL_H_ID:r.get('AR_INV_GL_H_ID'),\n                    AR_INV_H_ID:AR_INV_H_ID,\n                    IS_INSERT:'Y',\n                    flag:'cancel',\n                    AR_DOC_CAT_CODE:r.get('AR_DOC_CAT_CODE'),\n                    AR_CANCEL_TYPE:'YSHYUS',\n                    CUSTOMER_NAME:r.get('CUSTOMER_NAME'),\n                    CUSTOMER_ID:r.get('CUSTOMER_ID'),\n                    hideFun:function(){\n                        app.searchButton.fireEvent('click');\n                    }\n                });\n            }\n        });\n    }\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#payBtn#}","itemId":"paymentBtn"},"events":{"click":"var ar_doc_cat_code = 'SKD_JSK';\nvar curGrid = app.grid;\nvar r = curGrid.getSelectionModel().getSelection()[0];\nvar rec = curGrid.getSelection();\nif (rec.length > 1 || rec.length === 0) {//大于一条或没选择会警告\n    Wb.toast(\"{#payRecGL#}\");\n    return;\n}\nif (Wb.isEmpty(r.get('V_STATUS')) || parseInt(r.get('V_STATUS'))<3) {\n    Wb.toast(\"{#payRec1GL#}\");\n    return;\n}\nif (r.get('AR_DOC_CAT_CODE').indexOf('-HZ') != -1) {\n    ar_doc_cat_code = 'SKD_JSK-H';\n}\nWb.request({\n    url: 'm?xwl=xc/ar/gl/DB/XC_AR_INV_GL_H_PUB_ERROR_ALERT',\n    params: {\n        AR_INV_GL_H_ID: r.get('AR_INV_GL_H_ID'),\n        sql: 'select 1 FROM xc_ar_inv_gl_h WHERE AR_INV_GL_H_ID={?AR_INV_GL_H_ID?} AND (ABS(NO_PAY_AMT))<=0',\n        errorMsg: '{#payRec2GL#}！'\n    },\n    success: function(resp) {\n        Wb.run({\n            url: 'm?xwl=xc/ar/pay/XC_AR_PAY_H_NO_C',\n            success: function(apps) {\n                apps.initWin({\n                    AR_PAY_H_ID: '',\n                    H_AR_INV_GL_H_ID: r.get('AR_INV_GL_H_ID'),\n                    DOC_STATUS: 'xz',\n                    AR_DOC_CAT_CODE: ar_doc_cat_code,\n                    hideFun: function() {\n                        app.searchButton.fireEvent('click');\n                    }\n                });\n            }\n        });\n    }\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#invGlBtn#}","itemId":"offsettingBtn"},"events":{"click":"var curGrid = app.grid;\nvar r = curGrid.getSelectionModel().getSelection()[0];\nvar rec = curGrid.getSelection();\nif (rec.length > 1 || rec.length === 0) {//大于一条或没选择会警告\n    Wb.toast(\"{#invGlRecGL#}\");\n    return;\n}\nif (Wb.isEmpty(r.get('V_STATUS')) || parseInt(r.get('V_STATUS'))<3) {\n    Wb.toast(\"{#invGlRec1GL#}\");\n    return;\n}\nif (r.get('AR_DOC_CAT_CODE') == 'YSD') {\n    Wb.request({\n        url: 'm?xwl=xc/ar/gl/DB/XC_AR_INV_GL_H_PUB_ERROR_ALERT',\n        params: {\n            sql: 'SELECT 1 FROM xc_ar_inv_gl_h WHERE NO_PAY_AMT<=0 and AR_INV_GL_H_ID={?AR_INV_GL_H_ID?}',\n            errorMsg: '{#invGlRec2GL#}',\n            AR_INV_GL_H_ID:r.get('AR_INV_GL_H_ID')\n        },\n        success: function(resp) {\n            Wb.run({\n                url: 'm?xwl=xc/ar/gl/XC_AR_INV_GL_H_NO_C',\n                success: function(apps) {\n                    apps.initWin({\n                        H_AR_INV_GL_H_ID: r.get('AR_INV_GL_H_ID'),\n                        IS_INSERT: 'Y',\n                        flag:'inv_h',\n                        AR_DOC_CAT_CODE: r.get('AR_DOC_CAT_CODE') + '-HZ',\n                        hideFun: function() {\n                            app.searchButton.fireEvent('click');\n                        }\n                    });\n                }\n            });\n        }\n    });\n}\nelse {\n    Wb.toast('{#invGlRec3GL#}');\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#payListBtn#}","itemId":"payListBtn","iconCls":"aim_icon"},"events":{"click":"var curGrid = app.grid;\nvar rec = curGrid.getSelection();\nif (rec.length > 1 || rec.length === 0) {\n    Wb.toast(\"{#payListRecGL#}\");\n    return;\n}\nWb.run({\n    url: 'm?xwl=xc/ar/trans/XC_AR_INV_TRANS_ALL', \n    success: function(app) {\n        app.initWin({\n            SOURCE_ID:rec[0].data.AR_INV_GL_H_ID,\n            AR_INV_GL_H_ID:rec[0].data.AR_INV_GL_H_ID\n        });\n    }\n});\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#enclosureBtn#}","itemId":"enclosureBtn","iconCls":"attach_icon"},"events":{"click":"var rows = app.grid.getSelection();\nif (rows.length > 1 || rows.length === 0) {\n    Wb.toast(\"{#enclosureRecGL#}\");\n    return;\n}\nelse{\n    var temp_id = rows[0].data.AR_INV_GL_H_ID;\n    var temp_code = rows[0].data.AR_INV_H_CODE;\n    Wb.request({\n        url : '{#contextPath#}' + '/arInvoiceAction.do?method=getArAttCatCode',\n        params : {LEDGER_ID : rows[0].data.LEDGER_ID,AR_DOC_CAT_CODE : rows[0].data.AR_DOC_CAT_CODE},\n        success : function(resp){\n            var temp = Wb.decode(resp.responseText);\n            if(temp.flag == '0'){\n                var attCatCode = temp.attCatCode;\n                Xip.showAttachmentManager('{#XIP.userId#}',temp_id,'',attCatCode,temp_code,'Y','Y','Y',function(){},10); \n            }\n            else{\n                Wb.toast(temp.msg);\n            }\n        }\n    });\n}"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"store","url":"m?xwl=xc/ar/gl/DB/XC_AR_INV_GL_H_SELECT"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#order#}","align":"center","xtype":"rownumberer","width":"50","titleAlign":"center","itemId":"ORDERBY"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"账簿","hidden":"true","width":"150","dataIndex":"LEDGER_NAME","titleAlign":"center","itemId":"LEDGER_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#AR_CAT_NAME#}","width":"160","dataIndex":"AR_CAT_NAME","titleAlign":"center","itemId":"AR_CAT_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#AR_INV_GL_H_CODE#}","width":"200","dataIndex":"AR_INV_GL_H_CODE","titleAlign":"center","itemId":"AR_INV_GL_H_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#GL_DATE#}","xtype":"datecolumn","width":"100","dataIndex":"GL_DATE","titleAlign":"center","itemId":"GL_DATE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#CUSTOMER_NAME#}","width":"200","dataIndex":"CUSTOMER_NAME","titleAlign":"center","itemId":"CUSTOMER_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#AR_CONTRACT_NAME#}","width":"150","dataIndex":"AR_CONTRACT_NAME","titleAlign":"center","itemId":"AR_CONTRACT_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#AR_ACC_NAME_DEBT#}","width":"150","dataIndex":"AR_ACC_NAME_DEBT","titleAlign":"center","itemId":"AR_ACC_NAME_DEBT_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#DEPT_NAME#}","width":"150","dataIndex":"DEPT_NAME","titleAlign":"center","itemId":"DEPT_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#PROJECT_NAME#}","width":"150","dataIndex":"PROJECT_NAME","titleAlign":"center","itemId":"PROJECT_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#INV_AMOUNT#}","width":"120","align":"right","dataIndex":"INV_AMOUNT","format":"0,000.00","titleAlign":"center","itemId":"INV_AMOUNT_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#NO_PAY_AMT#}","align":"right","width":"120","dataIndex":"NO_PAY_AMT","format":"0,000.00","titleAlign":"center","itemId":"NO_PAY_AMT_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#TAX_RATE#}","width":"100","align":"right","dataIndex":"TAX_RATE","titleAlign":"center","itemId":"TAX_RATE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#TAX_AMT#}","width":"120","align":"right","dataIndex":"TAX_AMT","format":"0,000.00","titleAlign":"center","itemId":"TAX_AMT_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"需核销预收","hidden":"true","align":"right","width":"120","dataIndex":"INV_CANCEL_AMT","format":"0,000.00","titleAlign":"center","itemId":"INV_CANCEL_AMT_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#DESCRIPTION#}","width":"150","dataIndex":"DESCRIPTION","titleAlign":"center","itemId":"DESCRIPTION_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#CREATED_BY_NAME#}","width":"100","dataIndex":"CREATED_BY_NAME","titleAlign":"center","itemId":"CREATED_BY_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#V_STATUS#}","width":"100","dataIndex":"V_STATUS_NAME","titleAlign":"center","itemId":"V_STATUS_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#SOURCE#}","width":"100","dataIndex":"SOURCE_NAME","titleAlign":"center","itemId":"SOURCE_NAME_COL","renderer":"if(value == 'TEMP')\n    return '{#SOURCE_TEMP#}';\nif(value == 'GL')\n    return '{#SOURCE_INV_GL#}';\nif(value == 'INV')\n    return '{#SOURCE_INV#}';"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"ID","hidden":"true","dataIndex":"AR_INV_GL_H_ID","titleAlign":"center","itemId":"AR_INV_GL_H_ID_COL"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}