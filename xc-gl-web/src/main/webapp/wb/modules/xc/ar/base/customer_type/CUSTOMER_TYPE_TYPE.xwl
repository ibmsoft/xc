{"inframe":false,"title":"客户分类","hidden":false,"roles":{"default":1},"children":[{"configs":{"initScript":"com.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xc/ar/base/customer_type/CUSTOMER_TYPE_TYPE\");","itemId":"module"},"children":[{"configs":{"layout":"border","itemId":"viewport1"},"children":[{"configs":{"region":"north","pagingBar":"false","title":"{#CSTM_TYPE_CODE_COL#}","multiSelect":"false","selType":"rowmodel","width":"330","itemId":"grid1","simpleSelect":"false","editable":"true","viewConfig":"{\n enableTextSelection:true\n}"},"events":{"itemclick":"var docClass = record.data.CSTM_TYPE_CODE;\napp.grid2.store.load({params:{CSTM_TYPE_CODE:docClass}} );\nWb.typeRecord = record;//当前选择行"},"children":[{"configs":{"itemId":"store","autoLoad":"true","url":"m?xwl=xc/ar/base/customer_type/data/selectType"},"events":{"load":"var length = app.grid1.store.getCount( );\nif(length<1){\n  return;\n}\n\nvar row = app.grid1.store.getAt(0);\nvar docClass =row.data.CSTM_TYPE_CODE;//票据大类\n// app.grid2.store.load( {  params:{DOC_CLASS:docClass}} );"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"xtype":"rownumberer","itemId":"Row_num"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#CSTM_TYPE_CODE_COL#}","align":"center","width":"120","dataIndex":"CSTM_TYPE_CODE","itemId":"CSTM_TYPE_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#CSTM_TYPE_NAME_COL#}","align":"center","width":"250","dataIndex":"CSTM_TYPE_NAME","itemId":"CSTM_TYPE_NAME_COL"},"children":[{"configs":{"allowBlank":"false","itemId":"editor"},"events":{"focus":"var oldtext = text.getValue();\n\nWb.oldText = oldtext;\n\n\n","blur":"var val = text.getValue();\nvar  r = Wb.typeRecord;\nvar code = r.data.CSTM_TYPE_CODE;\n\nvar oldval = Wb.oldText;\n\n\nif(val==oldval){\n\n  return;\n}\n\nvar json = {\n  CSTM_TYPE_CODE:code,\n  CSTM_TYPE_NAME:val,\n   IS_USE:r.data.IS_USE\n};\n  Wb.request({\n    url: 'm?xwl=xc/ar/base/customer_type/data/updatecustomer_type', \n    params: json,\n    success: function() {\n\t   Wb.toast('{#EDITETIP#}');\n      app.grid1.store.reload();\n     \n\n\n    }\n  });"},"children":[],"expanded":false,"type":"text"}],"expanded":false,"type":"column"},{"configs":{"text":"{#IS_USE_COL#}","xtype":"checkcolumn","width":"80","dataIndex":"IS_USE","itemId":"IS_USE_COL"},"events":{"checkchange":"var record = app.grid1.store.getAt(rowIndex);\nvar code = record.data.CSTM_TYPE_CODE;\nvar json = {\n  CSTM_TYPE_CODE:code,\n  IS_USE:checked,\n   CSTM_TYPE_NAME:record.data.CSTM_TYPE_NAME\n};\n  Wb.request({\n    url: 'm?xwl=xc/ar/base/customer_type/data/updatecustomer_type', \n    params: json,\n    success: function() {\n\t   Wb.toast('修改成功！');\n      app.grid1.store.reload();\n     \n\n\n    }\n  });"},"children":[],"expanded":true,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"},{"configs":{"region":"center","selType":"checkboxmodel","itemId":"grid2","border":"true","editable":"true"},"children":[{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"-","itemId":"item1"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#addBtn#}","itemId":"addBtn","iconCls":"new_icon"},"events":{"click":"\nvar rows = app.grid1.getSelection();\nif (rows.length != 1) {\n  Wb.toast('{#MSG1#}');\n\n  return;\n} else {\n   var record = rows[0];\n  var docClass = record.data.CSTM_TYPE_CODE;\n   var typeName = record.data.CSTM_TYPE_NAME;\n  \n  Wb.addEdit(app.grid2,[{CSTM_TYPE_CODE:docClass,CSTM_SORT_CODE:'',CSTM_SORT_NAME:'',CSTM_TYPE_NAME:typeName,OPTYPE:'add'}]);\n}\n\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item11"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#saveBtn#}","itemId":"saveBtn","iconCls":"ok_icon"},"events":{"click":"if (!Wb.verifyGrid(app.grid2)) //验证数据是否合法\n  return;\n\n\nvar rec = app.grid2.store.getModifiedRecords();\n\nfor(var i=0;i<rec.length;i++){\n  for(var j=0;j<rec.length;j++){\n    if(rec[i].data.CSTM_SORT_CODE==rec[j].data.CSTM_SORT_CODE&&i!=j){\n      Ext.Msg.alert('{#TIP#}',rec[i].data.CSTM_SORT_CODE+\"{#CODEMSG#}\");\n      return false;\n    }\n  }\n\n /** var flag=true;\n  var msg=\"\";\n  var vcode = rec[i].data.CSTM_SORT_CODE;\n  Wb.request({\n    url: 'm?xwl=xc/ar/base/customer_type/data/selectExist',\n    params:{AP_PUR_TYPE_NAME:vcode,AP_PUR_TYPE_ID:rec[i].data.AP_PUR_TYPE_ID},\n    async:false,\n    method: 'POST',\n    success:function(response){\n      var rep = Ext.JSON.decode(response.responseText);\n      var num = rep.NUM;\n\n      if( num>0){\n\n        msg = vcode+\"采购类型不可重复！\";\n        flag = false;\n\n\n      }\n    }\n  });\n\n  if(flag==false){\n    Ext.Msg.alert('提示',msg);\n    return;\n  }**/\n\n} \n\n\n\nWb.sync({\n  grid: app.grid2,\n  url: 'm?xwl=xc/ar/base/customer_type/data/save',\n  message: '{#message#}',\n  success: function(resp) {\n    \n    Wb.reload(app.grid2);\n    Wb.toast('{#SAVETIP#}');\n  }\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item1211"},"children":[],"expanded":true,"type":"item"},{"configs":{"text":"{#delBtn#}","itemId":"delBtn","iconCls":"application_delete_icon"},"events":{"click":"var rows=app.grid2.getSelectionModel().getSelection();\nif(rows.length===0){\n   Wb.toast('{#DELTIP#}');\n \n  return;\n}\nelse{\n   Ext.Msg.confirm('{#TIP#}','{#DELOKTIP#}',function(a){\n     \n\n     \n    // Wb.remove(app.grid2);\n    // app.saveBtn.fireEvent('click');\n     \n     \n      if(a=='yes'){\n      var idList = \"\" ;\n        var id='';\n      Ext.each(rows,function(r){\n        var type = r.data.OPTYPE;\n        if(type=='add'){\n          \n        }else{\n           id = \"'\" + r.data.CSTM_SORT_CODE + \"'\";\n        }\n       \n        if(idList === \"\"){\n          idList = id ;\n        }else{\n          idList = idList+\",\"+id ;\n        }\n      });\n        if(idList==''){\n          idList=\"''\";\n        }\n      var json = {'ids' : idList} ;\n        Wb.request({\n         url : 'm?xwl=xc/ar/base/customer_type/data/delete',\n         params : json,\n         success :function(response){\n           Wb.toast('{#DELTIP1#}');\n           Wb.remove(app.grid2,rows);\n            app.grid2.plugins[0].completeEdit();\n          //  app.grid2.store.commitChanges();\n\n       //    app.grid2.store.reload();\n           \n         }\n      });\n     \n    }else{\n      return false ;\n    }\n  });\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item12111"},"children":[],"expanded":true,"type":"item"},{"configs":{"text":"{#importBtn#}","itemId":"importBtn"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item13"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#exportBtn#}","itemId":"exportBtn"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item14"},"children":[],"expanded":false,"type":"item"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"store","autoLoad":"false","url":"m?xwl=xc/ar/base/customer_type/data/selectcustomer_sort"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#XH#}","xtype":"rownumberer","width":"55","itemId":"column1"},"events":{"afterrender":"\n\n"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#OPTYPE_COL#}","hidden":"true","align":"center","dataIndex":"OPTYPE","itemId":"OPTYPE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#CSTM_TYPE_CODE_COL#}","hidden":"true","align":"center","dataIndex":"CSTM_TYPE_CODE","itemId":"CSTM_TYPE_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"<font color='red'>*<\/font>{#CSTM_SORT_CODE_COL#}","align":"center","width":"150","dataIndex":"CSTM_SORT_CODE","itemId":"CSTM_SORT_CODE_COL"},"children":[{"configs":{"allowBlank":"false","itemId":"editor"},"children":[],"expanded":false,"type":"text"}],"expanded":false,"type":"column"},{"configs":{"text":"<font color='red'>*<\/font>{#CSTM_SORT_NAME_COL#}","align":"center","width":"250","dataIndex":"CSTM_SORT_NAME","itemId":"CSTM_SORT_NAME_COL"},"children":[{"configs":{"allowBlank":"false","itemId":"editor"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"column"},{"configs":{"text":"<font color='red'>*<\/font>{#CSTM_TYPE_NAME_COL1#}","width":"250","dataIndex":"CSTM_TYPE_NAME","itemId":"CSTM_TYPE_NAME_COL"},"children":[],"expanded":true,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}