{"inframe":false,"title":"收款单选择LOV","hidden":false,"roles":{"default":1},"children":[{"configs":{"serverScript":"com.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,'xc/ar/cancel/LOV/json/LOV_XC_AR_PAY_H');","itemId":"module"},"events":{"initialize":"Wb.arCancelHId = '';\nWb.arCancelType = 'JS';\nWb.ar_doc_cat_code = '';\nWb.ledger_id = '';\nWb.customer_id = '';\nWb.no_cancel_amt = 0;\nExt.apply(app, {\n  initWin: function(params) {\n    Ext.apply(app, params);\n    app.lovWinN = new Ext.window.Window(app.lovWinN);\n    app.lovWinN.show();\n    Wb.arCancelHId = params.AR_CANCEL_H_ID;\n    Wb.arCancelType = params.AR_CANCEL_TYPE;\n    Wb.ar_doc_cat_code = params.AR_DOC_CAT_CODE;\n    Wb.ledger_id = params.LEDGER_ID;\n    Wb.customer_id = params.CUSTOMER_ID;\n    app.CUSTOMER_ID.setValue(params.CUSTOMER_ID);\n    app.AR_CONTRACT_ID.setValue(params.CONTRACT_ID);\n    var contractId= params.CONTRACT_ID;\n    app.AR_INV_GL_H_ID.setValue(params.AR_INV_GL_H_ID);\n\tWb.no_cancel_amt = params.NO_CANCEL_AMT;\n    //预收红蓝对冲\n    \n    if((Wb.ar_doc_cat_code).indexOf('SKD_')>-1){\n        if(Wb.ar_doc_cat_code.indexOf('-H')>-1){//如果是收款单-红字，选的是预收款单-蓝字\n\t\t\tapp.AR_DOC_CAT_CODE.setValue(\" and AR_DOC_CAT_CODE = 'SKD_YUSK' \");\n        }\n    }else{\n      //应收核预收\n\t\tif(Wb.ar_doc_cat_code.indexOf('-H')>-1||Wb.ar_doc_cat_code.indexOf('-HZ')>-1){//如果是应收单-红字,选的是预收款单-红字\n\t\t\tapp.AR_DOC_CAT_CODE.setValue(\" and AR_DOC_CAT_CODE = 'SKD_YUSK-H' \");\n        }else{//如果是应收单-蓝字，选的是预收款单-蓝字\n            app.AR_DOC_CAT_CODE.setValue(\" and AR_DOC_CAT_CODE = 'SKD_YUSK' \");\n        }\n    }\n    app.LEDGER_ID.setValue(Wb.ledger_id);\n    app.grid1.getStore().load();\n  }\n});\n"},"children":[{"configs":{"maximized":"true","layout":"border","itemId":"lovWinN","modal":"true"},"children":[{"configs":{"region":"north","itemId":"form1"},"children":[{"configs":{"layout":"column","border":"false","itemId":"tr1"},"children":[{"configs":{"layout":"form","columnWidth":".245","border":"false","itemId":"td_1_1"},"children":[{"configs":{"labelWidth":"100","labelAlign":"right","itemId":"AR_CONTRACT_NAME","fieldLabel":"{#contractCodeName#}"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n    app.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".245","border":"false","itemId":"td_1_2"},"children":[{"configs":{"labelWidth":"100","labelAlign":"right","itemId":"AR_PAY_H_CODE","fieldLabel":"{#docCodeName#}"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n    app.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".245","border":"false","itemId":"td_1_3"},"children":[{"configs":{"labelWidth":"100","labelAlign":"right","itemId":"CREATED_BY_NAME","fieldLabel":"{#documentMaker#}"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n    app.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"100","hidden":"true","labelAlign":"right","itemId":"AR_DOC_CAT_CODE"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"100","hidden":"true","labelAlign":"right","itemId":"LEDGER_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"100","hidden":"true","labelAlign":"right","itemId":"CUSTOMER_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"100","hidden":"true","labelAlign":"right","itemId":"AR_CONTRACT_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"AR_INV_GL_H_ID","fieldLabel":"应收单ID"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".245","border":"false","itemId":"td_3_2"},"children":[{"configs":{"layout":"column","border":"false","itemId":"tr_3_2_1"},"children":[{"configs":{"layout":"form","columnWidth":".02","border":"false","itemId":"td_3_2_1_1"},"children":[{"configs":{"itemId":"空格"},"children":[],"expanded":false,"type":"label"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".25","border":"false","itemId":"td_3_2_1_2"},"children":[{"configs":{"text":"{#seek#}","itemId":"queryBtn","iconCls":"seek_icon"},"events":{"click":"Wb.reload(app.grid1);"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".30","border":"false","itemId":"td_3_2_1_3"},"children":[{"configs":{"text":"{#reset#}","itemId":"clearBtn","iconCls":"refresh_icon"},"events":{"click":"//三个 文本框\napp.AR_CONTRACT_NAME.reset();//合同\napp.AR_PAY_H_CODE.reset();//单据\napp.CREATED_BY_NAME.reset();//制单人\napp.queryBtn.fireEvent('click');\n"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":false,"type":"form"},{"configs":{"region":"center","selType":"checkboxmodel","itemId":"grid1","editable":"true"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/ar/cancel/LOV/DB/XC_AR_PAY_H_SELECT"},"events":{"beforeload":"operation.params = Wb.getValue(app.form1);"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"{#ok#}","itemId":"commitBtn","iconCls":"ok_icon"},"events":{"click":"var recs = app.grid1.getSelection();\nif (!recs.length) {\n  Wb.toast('{#okMsg1#}');\n  return;\n}\nvar rows = Wb.getData(recs);\nvar isContinue = false;\nWb.each(rows, function(row) {\n  if(Wb.isEmpty(row.PAY_AMT)){\n    Wb.toast('{#okMsg2#}');\n    isContinue = false;\n    return false;\n  }\n\n  if(Math.abs(row.PAY_AMT)>Math.abs(row.NO_CANCEL_AMT)){\n    Wb.toast('{#msg1#}');\n    isContinue = false;\n    return false;\n  } \n  isContinue = true;\n});\nif(isContinue){\n  Wb.confirm('{#okMsg3#}' + recs.length + '{#okMsg4#}', function() {\n    app.hideFun(recs);\n    app.lovWinN.close();\n  });\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#cancel#}","itemId":"closeBtn","iconCls":"cancel_icon"},"events":{"click":"app.lovWinN.close();"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#glDate#}","xtype":"datecolumn","width":"100","dataIndex":"GL_DATE","titleAlign":"center","itemId":"GL_DATE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#payDocCode#}","width":"150","dataIndex":"AR_PAY_H_CODE","titleAlign":"center","itemId":"AR_PAY_H_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#description#}","width":"200","dataIndex":"DESCRIPTION","titleAlign":"center","itemId":"DESCRIPTION_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#contract#}","width":"200","dataIndex":"AR_CONTRACT_NAME","titleAlign":"center","itemId":"AR_CONTRACT_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#customer#}","width":"200","dataIndex":"CUSTOMER_NAME","titleAlign":"center","itemId":"CUSTOMER_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#canCancelAmount#}","align":"right","width":"100","dataIndex":"NO_CANCEL_AMT","titleAlign":"center","itemId":"NO_CANCEL_AMT_COL","renderer":"if(value>0){\n  return Wb.format(value,'0,000.00');\n}else if(value<0){\n  return '<font color=red>'+Wb.format(value,'0,000.00')+'<\/font>';\n}\n\n"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#cancelAmount#}","align":"right","width":"100","dataIndex":"PAY_AMT","titleAlign":"center","itemId":"PAY_AMT_COL","renderer":"metaData.style='background-color:#ffffd0';\nif(value>0){\n  return Wb.format(value,'0,000.00');\n}else if(value<0){\n  return '<font color=red>'+Wb.format(value,'0,000.00')+'<\/font>';\n}\n\n"},"children":[{"configs":{"itemId":"editor"},"events":{"change":"var rec = app.grid1.getSelection()[0];\nvar amt = rec.data.NO_CANCEL_AMT;\nif(rec.data.AR_DOC_CAT_CODE=='SKD_YUSK-H'){\n  number.setMaxValue(0);\n}else{\n  number.setMinValue(0);\n}\nif(amt<0&&newValue>0){\n  Wb.toast('{#editoeMsg1#}');\n  return;\n}else if(amt>0&&newValue<0){\n   Wb.toast('{#editoeMsg2#}');\n  return;\n}\nif(Math.abs(amt)<Math.abs(newValue)&&Math.abs(Wb.no_cancel_amt)<Math.abs(newValue)){\n  Wb.toast('{#msg1#}');\n  if(amt>=Wb.no_cancel_amt){\n    number.setValue(Wb.no_cancel_amt);  \n  }else{\n    number.setValue(amt); \n  }\n}\n\n\n"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"column"},{"configs":{"text":"{#dept#}","width":"100","dataIndex":"DEPT_NAME","titleAlign":"center","itemId":"DEPT_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#project#}","width":"100","dataIndex":"PROJECT_NAME","titleAlign":"center","itemId":"PROJECT_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#account#}","width":"100","dataIndex":"SALE_ACC_NAME","titleAlign":"center","itemId":"ACC_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#ccid#}","width":"150","dataIndex":"SALE_CCID_NAME","titleAlign":"center","itemId":"CCID_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","width":"150","dataIndex":"AR_DOC_CAT_CODE","titleAlign":"center","itemId":"AR_DOC_CAT_CODE_COL"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"window"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}