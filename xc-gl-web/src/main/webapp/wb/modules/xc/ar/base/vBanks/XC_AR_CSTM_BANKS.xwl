{"inframe":false,"title":"供应商银行账户管理","hidden":false,"roles":{"default":1},"children":[{"configs":{"serverScript":"com.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xc/ar/base/customer_mange/XC_AR_CUSTOMERS\");","itemId":"module"},"children":[{"configs":{"title":"{#BANK#}","selType":"checkboxmodel","itemId":"grid","editable":"true"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/ar/base/vBanks/data/select"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"-","itemId":"item1"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#addBtn#}","itemId":"addBtn","iconCls":"new_icon"},"events":{"click":"//var type = app.optype.getValue();\nif(Wb.winState==\"add\"){\n \n   Wb.toast('{#MSG14#}');\n  return false ;\n}\n\n\nvar bkid =  Xip.getId();\nvar vid = app.CUSTOMER_ID.getValue();\n\nvar myDate = new  Date();\n\nvar time = Ext.Date.parseDate(\"2099-12-31\", \"Y-m-d\"); \nvar mytime=Ext.Date.format(myDate, \"Y-m-d\"); \nvar curdtate = Ext.Date.parseDate(mytime, \"Y-m-d\"); \n\nWb.addEdit(app.grid,[{BANK_ID:bkid,CUSTOMER_ID:vid,ACCOUNT_NAME:'',BANK_NAME:'',DEPOSIT_BANK_NAME:'',BANK_ACCOUNT:'',CORRESPONDENT:'',IS_DEFAULT:'' ,START_DATE:curdtate,END_DATE:time}]);"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item11"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#delBtn#}","itemId":"delBtn","iconCls":"delete_icon"},"events":{"click":"\nvar rows=app.grid.getSelectionModel().getSelection();\nif(rows.length===0){\n  Ext.Msg.alert('{#TIP#}','{#DELTIP#}!');\n  return;\n}\nelse{\n   Ext.Msg.confirm('{#TIP#}','{#DELOKTIP#}',function(a){\n      if(a=='yes'){\n      var idList = \"\" ;\n      Ext.each(rows,function(r){\n        var id = \"'\" + r.data.BANK_ID + \"'\";\n        if(idList === \"\"){\n          idList = id ;\n        }else{\n          idList = idList+\",\"+id ;\n        }\n      });\n      var json = {'ids' : idList} ;\n        Wb.request({\n         url : 'm?xwl=xc/ar/base/vBanks/data/delete',\n         params : json,\n         success :function(response){\n           Wb.toast('{#DELTIP1#}');\n         //  Ext.Msg.alert(\"提示\",\"删除成功!\");\n           Wb.remove(app.grid,rows);\n\n          \n           \n         }\n      });\n     \n    }else{\n      return false ;\n    }\n  });\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item111"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#saveBtn#}","itemId":"saveBtn","iconCls":"ok_icon"},"events":{"click":"\nif (!Wb.verifyGrid(app.grid)) //验证数据是否合法\n  return;\n\nvar rec = app.grid.store.getModifiedRecords();\n\n\n\nfor(var i=0;i<rec.length;i++){\n  for(var j=0;j<rec.length;j++){\n    if(rec[i].data.BANK_ACCOUNT==rec[j].data.BANK_ACCOUNT&&rec[i].data.BANK_ID!=rec[j].data.BANK_ID){\n      Ext.Msg.alert('{#TIP#}',rec[i].data.BANK_ACCOUNT+\"{#MSG15#}\");\n      return false;\n    }\n  }\n\n  var flag=true;\n  var msg=\"\";\n  var vcode = rec[i].data.BANK_ACCOUNT;\n  Wb.request({\n    url: 'm?xwl=xc/ar/base/vBanks/data/selectExist',\n    params:{BANK_ACCOUNT:vcode,BANK_ID:rec[i].data.BANK_ID,CUSTOMER_ID:app.CUSTOMER_ID.getValue()},\n    async:false,\n    method: 'POST',\n    success:function(response){\n      var rep = Ext.JSON.decode(response.responseText);\n      var num = rep.NUM;\n\n      if( num>0){\n\n        msg = vcode+\"{#MSG15#}\";\n        flag = false;\n\n\n      }\n    }\n  });\n\n  if(flag==false){\n    Ext.Msg.alert('{#TIP#}',msg);\n    return;\n  }\n\n} \n\n\n\nWb.sync({\n  grid: app.grid,\n  url: 'm?xwl=xc/ar/base/vBanks/data/save',\n  message: '{#message#}',\n  success: function(resp) {\n\n   \n    app.grid.store.load({params:{CUSTOMER_ID:app.CUSTOMER_ID.getValue()}} );\n    Wb.toast('{#SAVETIP#}');\n  }\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item1111"},"children":[],"expanded":false,"type":"item"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#XH#}","align":"center","width":"50","xtype":"rownumberer","titleAlign":"center","itemId":"column1"},"events":{"afterrender":"\n\n"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#BANK_ID#}","hidden":"true","dataIndex":"BANK_ID","itemId":"BANK_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"CUSTOMER_ID","itemId":"CUSTOMER_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"<font color='red'>*<\/font>{#ACCOUNT_NAME#}","width":"150","dataIndex":"ACCOUNT_NAME","itemId":"ACCOUNT_NAME_COL"},"children":[{"configs":{"allowBlank":"false","itemId":"editor"},"children":[],"expanded":false,"type":"text"}],"expanded":false,"type":"column"},{"configs":{"text":"{#BANK_NAME#}","width":"150","dataIndex":"BANK_NAME","itemId":"BANK_NAME_COL"},"children":[{"configs":{"itemId":"editor"},"children":[],"expanded":false,"type":"text"}],"expanded":false,"type":"column"},{"configs":{"text":"<font color='red'>*<\/font>{#DEPOSIT_BANK_NAME#}","width":"150","dataIndex":"DEPOSIT_BANK_NAME","itemId":"DEPOSIT_BANK_NAME_COL"},"children":[{"configs":{"allowBlank":"false","itemId":"editor"},"children":[],"expanded":false,"type":"text"}],"expanded":false,"type":"column"},{"configs":{"text":"<font color='red'>*<\/font>{#BANK_ACCOUNT#}","width":"150","dataIndex":"BANK_ACCOUNT","itemId":"BANK_ACCOUNT_COL"},"children":[{"configs":{"allowBlank":"false","itemId":"editor"},"children":[],"expanded":false,"type":"text"}],"expanded":false,"type":"column"},{"configs":{"text":"{#CORRESPONDENT#}","width":"150","dataIndex":"CORRESPONDENT","itemId":"CORRESPONDENT_COL"},"children":[{"configs":{"itemId":"editor"},"children":[],"expanded":false,"type":"text"}],"expanded":false,"type":"column"},{"configs":{"text":"{#IS_DEFAULT#}","width":"80","xtype":"checkcolumn","dataIndex":"IS_DEFAULT","itemId":"IS_DEFAULT_COL"},"events":{"checkchange":"var record = app.grid.store.getAt(rowIndex);\n\nif(record.data.IS_DEFAULT===0){\n  return;\n}else{\n  var len = app.store.getCount();\n \n  for(var i=0; i<len; i++){\n    var r = app.store.getAt(i);\n    if(r.data.IS_DEFAULT===1&&r.data.BANK_ID!=record.data.BANK_ID){\n      record.set(\"IS_DEFAULT\", 1);\n      r.set(\"IS_DEFAULT\", 0);\n      return ;\n    }\n  }\n  \n  \n  \n}\n\n"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"<font color='red'>*<\/font>{#START_DATE1#}","width":"120","dataIndex":"START_DATE","itemId":"START_DATE_COL"},"children":[{"configs":{"allowBlank":"false","showToday":"true","format":"Y-m-d","itemId":"editor"},"children":[],"expanded":false,"type":"date"}],"expanded":false,"type":"column"},{"configs":{"text":"<font color='red'>*<\/font>{#END_DATE1#}","width":"120","dataIndex":"END_DATE","itemId":"END_DATEE_COL"},"children":[{"configs":{"allowBlank":"false","format":"Y-m-d","itemId":"editor"},"children":[],"expanded":false,"type":"date"}],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"},{"configs":{"hidden":"true","itemId":"CUSTOMER_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","value":"add","itemId":"optype"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}