{"inframe":false,"title":"余额调整单查询","hidden":false,"roles":{"default":1},"children":[{"configs":{"serverScript":"var contextPath = request.getContextPath();\nrequest.setAttribute(\"contextPath\",contextPath);\n//三方语言,引入对应的json文件\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,'xc/ar/adj/json/XC_AR_INV_GL_ADJ_ALL');","itemId":"module"},"events":{"finalize":"function returnRowFn(r,type){\n  if(type==='xc_gl_ledgers'){\n    Wb.reload(app.grid1);\n  }\n}\nfunction clearOtherFn(type){\n  if(type=='xc_gl_ledgers'){\n  }\n  \n}"},"children":[{"configs":{"itemId":"request"},"children":[{"configs":{"autoLoad":"true","itemId":"ldInitStore","url":"m?xwl=xc/com-lov/LEDGER_ID_PICK/DB/XC_GL_LEDGERS_SELECT_SEC"},"events":{"load":"app.LEDGER_XWL.LEDGER_ID.setValue(store.getAt(0).get('LEDGER_ID'));\napp.LEDGER_XWL.LEDGER_NAME.setValue(store.getAt(0).get('LEDGER_NAME'));\napp.grid1.getStore().load();"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"folder"},{"configs":{"layout":"border","itemId":"viewport1"},"children":[{"configs":{"region":"north","itemId":"form1","border":"false"},"children":[{"configs":{"layout":"column","itemId":"tr_1","border":"false"},"children":[{"configs":{"tagConfigs":"{\n  baseCls:'my-panel-no-border'\n\n}","layout":"form","columnWidth":".25","itemId":"td_1","border":"false"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/LEDGER_ID_PICK/LEDGER_ID_PICK_SEC","itemId":"LEDGER_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"{\n  baseCls:'my-panel-no-border'\n\n}","layout":"form","columnWidth":".25","itemId":"td_2","border":"false"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"CUSTOMER_NAME","fieldLabel":"{#customer#}"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n  app.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"{\n  baseCls:'my-panel-no-border'\n\n}","layout":"form","columnWidth":".3","itemId":"td_3","border":"false"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"DESCRIPTION","fieldLabel":"{#description#}"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n  app.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"{\n  baseCls:'my-panel-no-border'\n\n}","layout":"column","itemId":"tr_2"},"children":[{"configs":{"tagConfigs":"{\n  baseCls:'my-panel-no-border'\n\n}","layout":"form","columnWidth":".25","itemId":"td_2_1","border":"false"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"CREATED_BY_NAME","fieldLabel":"{#createByName#}"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n  app.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":false,"type":"panel"},{"configs":{"tagConfigs":"{\n  baseCls:'my-panel-no-border'\n\n}","layout":"form","columnWidth":".25","itemId":"td_2_2","border":"false"},"children":[{"configs":{"labelWidth":"80","displayField":"VAL_NAME","valueField":"VAL_CODE","pickList":"[['1','{#draft#}'],['3','{#auditPass#}'],['','{#all#}']]","labelAlign":"right","itemId":"V_STATUS","fieldLabel":"{#vStatus#}"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){//回车事件\n  app.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":true,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"{\n  baseCls:'my-panel-no-border'\n\n}","layout":"fit","columnWidth":".3","itemId":"td_4","border":"false"},"children":[{"configs":{"tagConfigs":"{\n  baseCls:'my-panel-no-border'\n\n}","layout":"column","columnWidth":".33","itemId":"tr_4_1","border":"false"},"children":[{"configs":{"tagConfigs":"{\n  baseCls:'my-panel-no-border'\n\n}","layout":"form","columnWidth":".6","itemId":"td_4_1_1","border":"false"},"children":[{"configs":{"labelWidth":"80","allowBlank":"true","labelAlign":"right","itemId":"GL_DATE_START","fieldLabel":"{#glDate#}"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n  app.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"date"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"{\n  baseCls:'my-panel-no-border'\n\n}","layout":"form","columnWidth":".1","itemId":"td_4_1_2","border":"false"},"children":[{"configs":{"text":"-","labelAlign":"center","itemId":"label1"},"children":[],"expanded":false,"type":"label"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"{\n  baseCls:'my-panel-no-border'\n\n}","layout":"form","columnWidth":".3","itemId":"td_4_1_3","border":"false"},"children":[{"configs":{"allowBlank":"true","labelAlign":"right","itemId":"GL_DATE_END"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n  app.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"date"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":false,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"layout":"column","border":"false","itemId":"tr3"},"children":[{"configs":{"layout":"form","columnWidth":".25","border":"false","itemId":"td1"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"ADJ_CODE","fieldLabel":"{#adjCode#}"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n  app.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"layout":"column","columnWidth":".3","border":"false","itemId":"td_2_3"},"children":[{"configs":{"text":"{#query#}","margin":"0 0 0 10","itemId":"queryBtn","iconCls":"seek_icon"},"events":{"click":"Wb.reload(app.grid1);"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#reset#}","margin":"0 0 0 10","itemId":"clearBtn","iconCls":"refresh_icon"},"events":{"click":"app.form1.getForm().reset();\napp.grid1.getStore().removeAll();"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"form"},{"configs":{"region":"center","selType":"checkboxmodel","itemId":"grid1"},"events":{"itemdblclick":"app.ModifyBtn.fireEvent('click');"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/ar/adj/DB/XC_AR_INV_GL_ADJ_SELECT"},"events":{"beforeload":"operation.params = Wb.getValue(app.form1);"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"{#add#}","itemId":"AddBtn","iconCls":"file_add_icon"},"events":{"click":"var curGrid = app.grid1;\nWb.run({\n  url: 'm?xwl=xc/ar/adj/XC_AR_INV_GL_ADJ_NO_C', \n  success: function(app) {\n    app.initWin({\n\t\tGL_ADJ_ID:'',\n        IS_INSERT:'Y',\n        hideFun:function(){\n          Wb.reload(curGrid.store);\n        }\n    });\n  }\n});\n\n\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#modify#}","itemId":"ModifyBtn","iconCls":"file_edit_icon"},"events":{"click":"var curGrid = app.grid1;\nvar rec = curGrid.getSelection();\nif (rec.length > 1 || rec.length === 0) {//大于一条或没选择会警告\n    Wb.toast('{#modifyMsg1#}');\n    return;\n}\nvar headId = rec[0].data.V_HEAD_ID;\nWb.run({\n  url: 'm?xwl=xc/ar/adj/XC_AR_INV_GL_ADJ_NO_C',\n  params:{\n    'vHeadId' : headId\n  },\n  success: function(app) {\n    app.initWin({\n\t\tGL_ADJ_ID:rec[0].data.GL_ADJ_ID,\n        IS_INSERT:'N',\n        hideFun:function(){\n          Wb.reload(curGrid.store);\n        }\n    });\n  }\n});\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#delete#}","itemId":"delBtn","iconCls":"file_delete_icon"},"events":{"click":"var rows = app.grid1.getSelection();//删除的行\nif(rows.length === 0){//没选中行\n  Wb.toast('{#deleteMsg1#}');\n  return;\n}\nfor(var i=0;i<rows.length;i++){\n  if(rows[i].data.V_STATUS>='3'){\n    Wb.toast('{#deleteMsg4#}');\n    return;\n  }\n}\nExt.Msg.confirm('{#prompt#}','{#deleteMsg3#}',function(btn){\n  if(btn=='yes'){\n    //单据ID数组\n    var docArray = [];\n    Wb.each(rows,function(r){\n      var arId = r.data.GL_ADJ_ID;//单据ID\n      var paramJson = {'arId':arId,arCatCode:'TZD'} ;\n      docArray.push(paramJson) ;\n    });\n    Wb.request({\n      url: '{#contextPath#}'+'/arInvGlAdjAction.do?method=deleteAdj',//调用后台方法\n      params: Wb.apply({arInfo: docArray}),\n      success: function(resp) {          \n        var record = Wb.decode(resp.responseText);\n        if ('0' == record.flag) {\n          Wb.remove(app.grid1);\n          Wb.toast('{#deleteMsg2#}');\n          app.grid1.getStore().reload();\n        } else {\n          Wb.toast(record.msg);\n        }\n      }\n    });\n  }\n});\n\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#verify#}","itemId":"verfyBtn","iconCls":"user_edit_icon"},"events":{"click":"var rows = app.grid1.getSelection();//审核的行\nif(rows.length === 0){//没选行\n    Wb.toast('{#verifyMsg1#}');\n    return;\n}\nelse{\n    //单据ID数组\n    var docArray = [];\n    var i = 0;//判断是否生成凭证\n    var j = 0;//判断是否审核通过\n    Wb.each(rows,function(r){\n        var arId = r.data.GL_ADJ_ID;//单据ID\n        var headId = r.data.V_HEAD_ID;//凭证头ID\n        if(headId === '' || headId === null){\n            i++;\n        }\n        if(r.data.V_STATUS_NAME !== '{#draft#}'){\n            j++;\n        }\n        var paramJson = {'headId' : headId,'arId':arId,arCatCode:'TZD'} ;\n        docArray.push(paramJson) ;\n    });\n    if(i > 0){\n        Wb.toast('{#verifyMsg2#}');\n        return;\n    }\n    if(j > 0){\n        Wb.toast('{#verifyMsg3#}');\n        return;\n    }\n    Wb.request({\n        url: '{#contextPath#}'+'/arInvGlAdjAction.do?method=checkArVoucher',//调用后台方法\n        params: Wb.apply({arInfo: docArray}),\n        success: function(resp) {\n            var record = Wb.decode(resp.responseText);\n            var msg = record.msg;\n            Wb.reload(app.grid1.store);\n            Wb.toast(msg);\n        }\n\t});\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#cancelVerify#}","itemId":"cancelVerfyBtn","iconCls":"user_delete_icon"},"events":{"click":"var rows = app.grid1.getSelection();//取消审核的行\nif(rows.length === 0){//没选中行\n    Wb.toast('{#cancelMsg1#}');\n    return;\n}\nelse{\n    //单据ID数组\n    var docArray = [];\n    var i = 0;//判断是否生成凭证\n    var j = 0;//判断是否审核通过\n    Wb.each(rows,function(r){\n        var arId = r.data.GL_ADJ_ID;//单据ID\n        var headId = r.data.V_HEAD_ID;//凭证头ID\n        if(headId === '' || headId === null){\n            i++;\n        }\n        if(r.data.V_STATUS_NAME !== '{#auditPass#}'){\n            j++;\n        }\n        var paramJson = {'headId' : headId,'arId':arId,arCatCode:'TZD'} ;\n        docArray.push(paramJson) ;\n    });\n    if(i > 0){\n        Wb.toast('{#cancelMsg2#}');\n        return;\n    }\n    if(j > 0){\n        Wb.toast('{#cancelMsg3#}');\n        return;\n    }\n    Wb.request({\n        url: '{#contextPath#}'+'/arInvGlAdjAction.do?method=cancelCheckArVoucher',//调用后台方法\n        params: Wb.apply({arInfo: docArray}),\n        success: function(resp) {\n            var record = Wb.decode(resp.responseText);\n            var msg = record.msg;\n            Wb.reload(app.grid1.store);\n            Wb.toast(msg);\n        }\n\t});\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#showDetail#}","itemId":"showBtn","iconCls":"seek_icon"},"events":{"click":"var curGrid = app.grid1;\nvar rec = curGrid.getSelection();//查看的行\nif (rec.length > 1 || rec.length === 0) {//大于一条或没选择会警告\n    Wb.toast('{#showMsg#}');\n    return;\n}\nvar headId = rec[0].data.V_HEAD_ID;\nWb.run({\n  url: 'm?xwl=xc/ar/adj/XC_AR_INV_GL_ADJ_NO_C', \n   params:{\n    'vHeadId' : headId\n  },\n  success: function(app) {\n    app.initWin({\n\t\tGL_ADJ_ID:rec[0].data.GL_ADJ_ID,\n        IS_INSERT:'S',\n        hideFun:function(){\n          Wb.reload(curGrid.store);\n        }\n    });\n  }\n});"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#rowNum#}","width":"50","xtype":"rownumberer","titleAlign":"center","itemId":"rowNumCol"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#glAdjCode#}","width":"200","dataIndex":"GL_ADJ_CODE","titleAlign":"center","itemId":"GL_ADJ_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#glDate#}","width":"100","dataIndex":"GL_DATE","titleAlign":"center","itemId":"GL_DATE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#customer#}","hidden":"true","width":"200","dataIndex":"CUSTOMER_ID","titleAlign":"center","itemId":"CUSTOMER_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#customer#}","width":"200","dataIndex":"CUSTOMER_NAME","titleAlign":"center","itemId":"CUSTOMER_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#description#}","dataIndex":"DESCRIPTION","titleAlign":"center","itemId":"DESCRIPTION_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#adjAmt#}","align":"right","dataIndex":"ADJ_AMT","titleAlign":"center","itemId":"ADJ_AMT_COL","renderer":"if(value>0){\n  return Wb.format(value,'0,000.00');\n}else{\n  return '<font color=red>'+Wb.format(value,'0,000.00')+'<\/font>';\n}\n\n"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#createByName#}","dataIndex":"CREATED_BY_NAME","titleAlign":"center","itemId":"CREATED_BY_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#vStatus#}","dataIndex":"V_STATUS_NAME","titleAlign":"center","itemId":"V_STATUS_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#vStatus#}","hidden":"true","dataIndex":"V_STATUS","titleAlign":"center","itemId":"V_STATUS_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#vheadId#}","hidden":"true","dataIndex":"V_HEAD_ID","titleAlign":"center","itemId":"V_HEAD_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#glAdjId#}","hidden":"true","dataIndex":"GL_ADJ_ID","titleAlign":"center","itemId":"GL_ADJ_ID_COL"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":false,"type":"grid"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}