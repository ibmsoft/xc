{"inframe":false,"title":"客户分类","hidden":false,"roles":{"default":1},"children":[{"configs":{"itemId":"module"},"children":[{"configs":{"layout":"border","itemId":"viewport1"},"children":[{"configs":{"region":"north","pagingBar":"false","title":"客户分类","multiSelect":"false","selType":"rowmodel","width":"330","itemId":"grid1","simpleSelect":"false","editable":"true","viewConfig":"{\n enableTextSelection:true\n}"},"events":{"itemclick":"var docClass = record.data.CSTM_TYPE_CODE;\napp.grid2.store.load({params:{CSTM_TYPE_CODE:docClass}} );\nWb.typeRecord = record;//当前选择行"},"children":[{"configs":{"itemId":"store","autoLoad":"true","url":"m?xwl=xc/ar/base/customer_type/data/selectType"},"events":{"load":"var length = app.grid1.store.getCount( );\nif(length<1){\n  return;\n}\n\nvar row = app.grid1.store.getAt(0);\nvar docClass =row.data.CSTM_TYPE_CODE;//票据大类\n// app.grid2.store.load( {  params:{DOC_CLASS:docClass}} );"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"xtype":"rownumberer","itemId":"Row_num"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"客户分类","width":"120","dataIndex":"CSTM_TYPE_CODE","itemId":"CSTM_TYPE_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"别名","width":"250","dataIndex":"CSTM_TYPE_NAME","itemId":"CSTM_TYPE_NAME_COL"},"children":[{"configs":{"allowBlank":"false","itemId":"editor"},"events":{"blur":"var val = text.getValue();\nvar  r = Wb.typeRecord;\nvar code = r.data.CSTM_TYPE_CODE;\nvar json = {\n  CSTM_TYPE_CODE:code,\n  CSTM_TYPE_NAME:val,\n   IS_USE:r.data.IS_USE\n};\n  Wb.request({\n    url: 'm?xwl=xc/ar/base/customer_type/data/updatecustomer_type', \n    params: json,\n    success: function() {\n\t   Wb.toast('修改成功！');\n      app.grid1.store.reload();\n     \n\n\n    }\n  });"},"children":[],"expanded":false,"type":"text"}],"expanded":false,"type":"column"},{"configs":{"text":"启用","xtype":"checkcolumn","width":"80","dataIndex":"IS_USE","itemId":"IS_USE_COL"},"events":{"checkchange":"var record = app.grid1.store.getAt(rowIndex);\nvar code = record.data.CSTM_TYPE_CODE;\nvar json = {\n  CSTM_TYPE_CODE:code,\n  IS_USE:checked,\n   CSTM_TYPE_NAME:record.data.CSTM_TYPE_NAME\n};\n  Wb.request({\n    url: 'm?xwl=xc/ar/base/customer_type/data/updatecustomer_type', \n    params: json,\n    success: function() {\n\t   Wb.toast('修改成功！');\n      app.grid1.store.reload();\n     \n\n\n    }\n  });"},"children":[],"expanded":true,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"},{"configs":{"region":"center","selType":"checkboxmodel","itemId":"grid2","border":"true","editable":"true"},"children":[{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"-","itemId":"item1"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"增加","itemId":"addBtn","iconCls":"new_icon"},"events":{"click":"\nvar rows = app.grid1.getSelection();\nif (rows.length != 1) {\n  Wb.toast('请选择客户分类数据!');\n\n  return;\n} else {\n   var record = rows[0];\n  var docClass = record.data.CSTM_TYPE_CODE;\n   var typeName = record.data.CSTM_TYPE_NAME;\n  \n  Wb.addEdit(app.grid2,[{CSTM_TYPE_CODE:docClass,CSTM_SORT_CODE:'',CSTM_SORT_NAME:'',CSTM_TYPE_NAME:typeName}]);\n}\n\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item11"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"保存","itemId":"saveBtn","iconCls":"ok_icon"},"events":{"click":"if (!Wb.verifyGrid(app.grid2)) //验证数据是否合法\n  return;\n\n\nvar rec = app.grid2.store.getModifiedRecords();\n\nfor(var i=0;i<rec.length;i++){\n  for(var j=0;j<rec.length;j++){\n    if(rec[i].data.CSTM_SORT_CODE==rec[j].data.CSTM_SORT_CODE&&i!=j){\n      Ext.Msg.alert('提示',rec[i].data.CSTM_SORT_CODE+\"编码重复！\");\n      return false;\n    }\n  }\n\n /** var flag=true;\n  var msg=\"\";\n  var vcode = rec[i].data.CSTM_SORT_CODE;\n  Wb.request({\n    url: 'm?xwl=xc/ar/base/customer_type/data/selectExist',\n    params:{AP_PUR_TYPE_NAME:vcode,AP_PUR_TYPE_ID:rec[i].data.AP_PUR_TYPE_ID},\n    async:false,\n    method: 'POST',\n    success:function(response){\n      var rep = Ext.JSON.decode(response.responseText);\n      var num = rep.NUM;\n\n      if( num>0){\n\n        msg = vcode+\"采购类型不可重复！\";\n        flag = false;\n\n\n      }\n    }\n  });\n\n  if(flag==false){\n    Ext.Msg.alert('提示',msg);\n    return;\n  }**/\n\n} \n\n\n\nWb.sync({\n  grid: app.grid2,\n  url: 'm?xwl=xc/ar/base/customer_type/data/save',\n  message: '正在保存中...',\n  success: function(resp) {\n    \n    Wb.reload(app.grid2);\n    Wb.toast('保存成功！');\n  }\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item1211"},"children":[],"expanded":true,"type":"item"},{"configs":{"text":"删除","itemId":"delBtn","iconCls":"application_delete_icon"},"events":{"click":"var rows=app.grid2.getSelectionModel().getSelection();\nif(rows.length===0){\n   Wb.toast('请选择要删除的记录!');\n \n  return;\n}\nelse{\n   Ext.Msg.confirm('提示','您确定要删除？',function(a){\n      if(a=='yes'){\n      var idList = \"\" ;\n      Ext.each(rows,function(r){\n        var id = \"'\" + r.data.CSTM_SORT_CODE + \"'\";\n        if(idList === \"\"){\n          idList = id ;\n        }else{\n          idList = idList+\",\"+id ;\n        }\n      });\n      var json = {'ids' : idList} ;\n        Wb.request({\n         url : 'm?xwl=xc/ar/base/customer_type/data/delete',\n         params : json,\n         success :function(response){\n           Wb.toast('删除成功');\n           app.grid2.store.load();\n           \n         }\n      });\n     \n    }else{\n      return false ;\n    }\n  });\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item12111"},"children":[],"expanded":true,"type":"item"},{"configs":{"text":"导入","itemId":"importBtn"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item13"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"导出","itemId":"exportBtn"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item14"},"children":[],"expanded":false,"type":"item"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"store","autoLoad":"false","url":"m?xwl=xc/ar/base/customer_type/data/selectcustomer_sort"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"序号","xtype":"rownumberer","width":"55","itemId":"column1"},"events":{"afterrender":"\n\n"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"客户分类","hidden":"true","dataIndex":"CSTM_TYPE_CODE","itemId":"CSTM_TYPE_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"<font color='red'>*<\/font>编码","width":"150","dataIndex":"CSTM_SORT_CODE","itemId":"CSTM_SORT_CODE_COL"},"children":[{"configs":{"allowBlank":"false","itemId":"editor"},"children":[],"expanded":false,"type":"text"}],"expanded":false,"type":"column"},{"configs":{"text":"<font color='red'>*<\/font>名称","width":"250","dataIndex":"CSTM_SORT_NAME","itemId":"CSTM_SORT_NAME_COL"},"children":[{"configs":{"allowBlank":"false","itemId":"editor"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"column"},{"configs":{"text":"<font color='red'>*<\/font>客户分类","width":"250","dataIndex":"CSTM_TYPE_NAME","itemId":"CSTM_TYPE_NAME_COL"},"children":[{"configs":{"labelWidth":"80","allowBlank":"false","labelAlign":"right","itemId":"editor","normalName":"CSTM_TYPE_NAME_PICK"},"children":[{"configs":{"tagConfigs":"minWidth:300","itemId":"pickComp"},"events":{"itemdblclick":"var r=app.grid2.getSelectionModel().getSelection()[0];\nr.set('CSTM_TYPE_CODE',record.data.CSTM_TYPE_CODE);\nr.set('CSTM_TYPE_NAME',record.data.CSTM_TYPE_NAME);\nr.dirty = true;\napp.CSTM_TYPE_NAME_PICK.setValue(record.data.CSTM_TYPE_NAME);\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"pageSize":"5","itemId":"store","autoLoad":"true","url":"m?xwl=xc/ar/base/customer_type/data/selectTypeUsed"},"events":{"beforeload":"operation.params = Wb.getValue(app.tbar);"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"客户分类","dataIndex":"CSTM_TYPE_CODE","itemId":"CSTM_TYPE_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"别名","dataIndex":"CSTM_TYPE_NAME","itemId":"CSTM_TYPE_NAME_COL"},"children":[],"expanded":true,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"100","labelAlign":"right","itemId":"QUERY_CODE_NAME","fieldLabel":"分类编码/名称"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.pickComp.getStore().load();\n}"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"cancelBtn","iconCls":"delete_icon"},"events":{"click":"\n\nvar r=app.grid2.getSelectionModel().getSelection()[0];\nr.set('CSTM_TYPE_CODE','');\nr.set('CSTM_TYPE_NAME','');\nr.dirty = true;\napp.CSTM_TYPE_NAME_PICK.setValue('');\napp.pickComp.hide();\n"},"children":[],"expanded":false,"type":"item"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":false,"type":"picker"}],"expanded":true,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}