{"inframe":false,"title":"账簿属性设置","hidden":false,"roles":{"default":1},"children":[{"configs":{"serverScript":"com.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xc/ar/ld/ledgers/XC_GL_LEDGERS\");","itemId":"module"},"events":{"finalize":"function returnRowFn(r,type){\n\n  var P_LEDGER_ID = r.data.LEDGER_ID;\n  if(type==='xc_gl_ledgers'){\n    //Wb.edit(app.form1);\n    Wb.request({\n      url: 'm?xwl=xc/ar/ld/ledgers/DB/XC_GL_LEDGERS_SELECT_BY_ID',\n      params: {LEDGER_ID:P_LEDGER_ID},\n      success: function(resp) {\n        var r = Wb.decode(resp.responseText);\n        Wb.setValue(app.form1,r);\n       app.AR_PERIOD_CODE.getStore().load({params:{LEDGER_ID:P_LEDGER_ID}});\n        Wb.request({\n          url: 'm?xwl=xc/ar/ld/ledgers/DB/XC_AR_INV_GL_H_SELECT',\n          params: {LEDGER_ID:P_LEDGER_ID},\n          success: function(resp) {\n            var r = Wb.decode(resp.responseText);\n            if(r.INIT_COUNT>0){\n               app.AR_PERIOD_CODE.setReadOnly(true);\n            }else{\n               app.AR_PERIOD_CODE.setReadOnly(false);\n               if(Wb.isEmpty(app.AR_PERIOD_CODE.getValue())){\n                 Wb.request({\n                   url: 'm?xwl=xc/ar/ld/ledgers/DB/XC_GL_LD_PERIOD_SELECT',\n                   params: {LEDGER_ID:P_LEDGER_ID},\n                   success: function(resp) {\n                     var r = Wb.decode(resp.responseText);\n                     app.AR_PERIOD_CODE.setValue(r.PERIOD_CODE);\n                   }\n                 });\n               }\n            }\n          }\n        });\n      }\n    });\n    app.AR_ACC_ID_DEBT_XWL.QUERY_LEDGER_ID.setValue(P_LEDGER_ID);\n    app.AR_ACC_ID_PRE_XWL.QUERY_LEDGER_ID.setValue(P_LEDGER_ID);\n    app.AR_ACC_ID_TAX_XWL.QUERY_LEDGER_ID.setValue(P_LEDGER_ID);\n\n    \n    \n  }\n    \n}\n/*function clearOtherFn(type){\n  if(type=='xc_gl_ledgers'){\n    app.CCID_XWL.CCID.setValue('');\n    app.CCID_XWL.CCID_NAME.setValue('');\n    app.VENDOR_XWL.VENDOR_ID.setValue('');\n    app.VENDOR_XWL.VENDOR_NAME.setValue('');\n  }*/\nfunction clearOtherFn(type){\n  if(type=='xc_gl_ledgers'){\n    app.AR_INTERVAL_ID.setValue('');\n    app.AR_PERIOD_CODE.setValue('');\n  }\n  \n  //清空账薄时清空面板中所有信息\n  if(type=='cancelLedger'){\n    app.form1.getForm().reset();\n    app.AR_INTERVAL_ID.setValue('');\n    app.AR_PERIOD_CODE.setValue('');\n  }\n  \n}\n\n//设置账簿的输入框背景色，并且设置必输。\napp.LEDGER_XWL.LEDGER_NAME.setFieldStyle('background-color: #ffffd0; background-image: none;');\napp.LEDGER_XWL.LEDGER_NAME.allowBlank=false;\n\napp.AR_ACC_ID_DEBT_XWL.AR_ACC_NAME_DEBT.allowBlank=true;\napp.AR_ACC_ID_DEBT_XWL.AR_ACC_NAME_DEBT.setFieldLabel('{#ar_acc_id_dept#}');\n\napp.AR_ACC_ID_TAX_XWL.AR_ACC_NAME_TAX.allowBlank=true;\napp.AR_ACC_ID_TAX_XWL.AR_ACC_NAME_TAX.setFieldLabel('{#ar_acc_id_tax#}');\n\n\n\n\n"},"children":[{"configs":{"itemId":"request"},"children":[{"configs":{"autoLoad":"true","itemId":"ldInitStore","url":"m?xwl=xc/com-lov/LEDGER_ID_PICK/DB/XC_GL_LEDGERS_SELECT_SEC"},"events":{"load":"app.LEDGER_XWL.LEDGER_ID.setValue(store.getAt(0).get('LEDGER_ID'));\napp.LEDGER_XWL.LEDGER_NAME.setValue(store.getAt(0).get('LEDGER_NAME'));\nWb.request({\n    url: 'm?xwl=xc/ar/ld/ledgers/DB/XC_GL_LEDGERS_SELECT_BY_ID',\n    params: {LEDGER_ID:store.getAt(0).get('LEDGER_ID')},\n    success: function(resp) {\n      var r = Wb.decode(resp.responseText);\n      Wb.setValue(app.form1,r);\n      \n      Wb.request({\n          url: 'm?xwl=xc/ar/ld/ledgers/DB/XC_AR_INV_GL_H_SELECT',\n          params: {LEDGER_ID:store.getAt(0).get('LEDGER_ID')},\n          success: function(resp) {\n            var r = Wb.decode(resp.responseText);\n            \n            if(r.INIT_COUNT>0){\n               app.AR_PERIOD_CODE.setReadOnly(true);\n            }else{\n               app.AR_PERIOD_CODE.setReadOnly(false);\n               if(Wb.isEmpty(app.AR_PERIOD_CODE.getValue())){\n                 Wb.request({\n                   url: 'm?xwl=xc/ar/ld/ledgers/DB/XC_GL_LD_PERIOD_SELECT',\n                   params: {LEDGER_ID:store.getAt(0).get('LEDGER_ID')},\n                   success: function(resp) {\n                     var r = Wb.decode(resp.responseText);\n                     app.AR_PERIOD_CODE.setValue(r.PERIOD_CODE);\n                   }\n                 });\n               }\n            }\n          }\n        });\n   }\n});\napp.AR_ACC_ID_DEBT_XWL.QUERY_LEDGER_ID.setValue(store.getAt(0).get('LEDGER_ID'));\napp.AR_ACC_ID_PRE_XWL.QUERY_LEDGER_ID.setValue(store.getAt(0).get('LEDGER_ID'));\napp.AR_ACC_ID_TAX_XWL.QUERY_LEDGER_ID.setValue(store.getAt(0).get('LEDGER_ID'));\n"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"folder"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"{#saveBtn#}","itemId":"saveBtn","iconCls":"ok_icon"},"events":{"click":"// if (!app.AR_INTERVAL_ID.getValue()) {\n//     Wb.toast('账龄区间不能为空！');\n//     return false;\n// } else\n  \n  if (!app.AR_PERIOD_CODE.getValue()) {\n    Wb.toast('{#MSG1#}');\n    return false;\n}\nif (app.form1.isValid()) {\n    Wb.request({\n        url: 'm?xwl=xc/ar/ld/ledgers/DB/XC_GL_LD_PERIOD_SELECT',\n        params: {\n            LEDGER_ID: app.LEDGER_XWL.LEDGER_ID.getValue()\n        },\n        success: function(resp) {\n            var r = Wb.decode(resp.responseText);\n\t\t\tif(r.PERIOD_CODE<app.AR_PERIOD_CODE.getValue()){\n              Wb.toast('{#MSG2#}<'+r.PERIOD_CODE+'> !');\n            }else{\n             \n              Wb.request({\n                  url: 'm?xwl=xc/ar/ld/ledgers/DB/XC_GL_LEDGERS_UPDATE',\n                  params: Wb.getValue(app.form1),\n                \n                  success: function(resp) {\n                      Wb.toast('{#SAVETIP#}');\n                  }\n              });\n            }\n        }\n    });\n\n} else {\n    Wb.toast('{#MSG3#}');\n}"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"layout":"border","itemId":"viewport1"},"children":[{"configs":{"tbar":"app.tbar","region":"center","bodyPadding":"padding:1% 20% 1% 20%;","border":"false","itemId":"form1"},"children":[{"configs":{"title":"{#fieldset1label#}","itemId":"fieldset1"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","height":"35","layout":"column","border":"false","itemId":"tr1"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".25","border":"false","itemId":"td_1_1"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/LEDGER_ID_PICK/LEDGER_ID_PICK_SEC","itemId":"LEDGER_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"fieldset"},{"configs":{"title":"{#fieldset2name#}","itemId":"fieldset2"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"column","border":"false","itemId":"tr2"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".33","border":"false","itemId":"td_2_1"},"children":[{"configs":{"labelWidth":"100","displayField":"PERIOD_CODE","valueField":"PERIOD_CODE","labelAlign":"right","itemId":"AR_PERIOD_CODE","fieldLabel":"<span style=\"color: rgb(255, 0, 0); \">*<\/span>{#ar_period_code#}"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/ar/ld/ledgers/DB/getPeriod"},"events":{"beforeload":"operation.params = Wb.getValue(app.form1);"},"children":[],"expanded":false,"type":"store"}],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".33","border":"false","itemId":"td_2_2"},"children":[{"configs":{"file":"m?xwl=xc/ar/ar-com-lov/ACC_ID_PICK/AR_ACC_ID_DEBT","itemId":"AR_ACC_ID_DEBT_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","height":"35","layout":"column","border":"false","itemId":"tr3"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".33","border":"false","itemId":"td_2_3"},"children":[{"configs":{"file":"m?xwl=xc/ar/ar-com-lov/ACC_ID_PICK/AR_ACC_ID_PRE","itemId":"AR_ACC_ID_PRE_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".33","border":"false","itemId":"td_3_2"},"children":[{"configs":{"file":"m?xwl=xc/ar/ar-com-lov/ACC_ID_PICK/AR_ACC_ID_TAX","itemId":"AR_ACC_ID_TAX_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".33","border":"false","itemId":"td_3_1"},"children":[{"configs":{"labelWidth":"100","displayField":"VAL_NAME","hidden":"true","valueField":"VAL_CODE","labelAlign":"right","itemId":"AR_INTERVAL_ID","fieldLabel":"<span style=\"color: rgb(255, 0, 0); \">*<\/span>{#ar_interval_id#}"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/ar/ld/ledgers/DB/XC_AR_AGING_INTERVAL_SELECT"},"children":[],"expanded":false,"type":"store"}],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"fieldset"}],"expanded":true,"type":"form"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}