{"inframe":true,"title":"我的销售发票","hidden":false,"roles":{"default":1},"children":[{"configs":{"jsLinks":"[\"xip/js/xipWfTouch.js\"]","serverScript":"//---------------------获取当前模块语言对应的.json文件，放到request中----------------\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xc/ar/touch/inv/json/XC_AR_INVOICE_H_MY\");\nvar userId = request.getSession().getAttribute(\"XzSessionVars\").get('userId');\n\nvar protocol = request.getProtocol() ;\nvar ipAddr = request.getServerName();\nvar port = request.getServerPort() ;\nvar ctxPath = request.getContextPath() ;\n\nprotocol = (protocol == \"HTTP/1.1\" ? \"http\" : \"https\") ;\nvar url = protocol + \"://\" + ipAddr +\":\" + port + ctxPath ;\n\nrequest.setAttribute('contextPath',ctxPath);\nrequest.setAttribute(\"userId\",userId);\nrequest.setAttribute(\"appIP\",url);\nvar appId = request.getSession().getAttribute(\"XzSessionVars\").get('appId');\nrequest.setAttribute(\"funId\",request.getParameter('funId'));\nrequest.setAttribute(\"appId\",request.getParameter('appId'));","itemId":"module"},"events":{"finalize":"var flag = 'false';\nvar clickCount = 1;","initialize":"var url = 'm?xwl=xc/ar/touch/inv/xc_ar_invoice_my_window';\nvar op = 'insert';\nvar arInvHId = Xip.getId();\nWb.apply(app,{\n\tinit : function(x){\n\t\tmainNav = x;\n\t},\n\taddPTFP : function(rec,handler){\n        var ledgerId = app.LEDGER_ID.getValue();\n        var title = '{#ptfp#}';\n        var arDocCat = 'ZZSPT';\n        getUrlAndTitle(url,op,title,arDocCat,arInvHId,ledgerId);\n    },\n\taddZZSFP : function(rec,handler){\n        var ledgerId = app.LEDGER_ID.getValue();\n        var title = '{#zzszyfp#}';\n        var arDocCat = 'ZZS';\n        getUrlAndTitle(url,op,title,arDocCat,arInvHId,ledgerId);\n    }\n});\nfunction getUrlAndTitle(url,op,title,arDocCat,arInvHId,ledgerId){\n\tvar found;\n\tmainNav.items.each(function(item){\n        if(item.__url == url){\n            found = true;\n            mainNav.setActiveItem(item);\n            return;\n        }\n    });\n\tif(found)\n\t\treturn;\n    Wb.run({\n        url : url,\n        params : {'op' : op,'arDocCat' : arDocCat,'arInvHId' : arInvHId,'ledgerId' : ledgerId},\n        success : function(scope) {\n            Wb.each(scope,function(k,v) {\n                if(scope.flashStore){\n                    scope.flashStore(app.list1);\n                }\n                if (v && (v.isViewport || v.initialConfig && v.initialConfig.isViewport)) {\n                    if(scope.init){\n                        scope.init(mainNav);\n                    }\n                    var newCard = Ext.create('Ext.Container',{\n                        layout : 'fit',\n                        title : title\n                    });\n                    newCard.add(v);\n                    newCard.__title = title;\n                    newCard.__url = url;\n                    mainNav.push(newCard);\n                    return false;\n\t\t\t\t}\n\t\t\t});\n        }\n    });\n}"},"children":[{"configs":{"height":"75","hidden":"true","width":"180","layout":"fit","left":"0","itemId":"menu","modal":"true","top":"0","hideOnMaskTap":"true"},"children":[{"configs":{"itemTpl":"<div style='height:40px'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{text}<\/div>","scrollable":"false","padding":"8","itemId":"dataview"},"events":{"itemtap":"app.menu.hide();\nrecord.get('handler')();"},"children":[{"configs":{"data":"[{\n\ttext: '{#ptfp#}',\n\thandler: app.addPTFP\n},{\n\ttext: '{#zzszyfp#}',\n\thandler: app.addZZSFP\n}]","itemId":"store","fields":"['text','handler']"},"children":[],"expanded":false,"type":"tstore"}],"expanded":true,"type":"tdataview"}],"expanded":true,"type":"tpanel"},{"configs":{"appGlyph":"f015","layout":"fit","itemId":"viewport"},"children":[{"configs":{"layout":"fit","itemId":"container"},"children":[{"configs":{"docked":"top","itemId":"toolbar"},"children":[{"configs":{"labelWidth":"60","store":"app.store","displayField":"LEDGER_NAME","valueField":"LEDGER_ID","label":"<font color=\"red\">*<\/font>{#LEDGER#}","labelAlign":"left","itemId":"LEDGER_ID"},"events":{"change":"app.searchButton.fireEvent('tap');"},"children":[{"configs":{"itemId":"store","autoLoad":"true","url":"m?xwl=xc/ar/touch/inv/xc_ar_invoice_myDB/ledgersSelect"},"events":{"success":"if(store.getCount() > 0){\n    if(flag == 'false'){\n        app.LEDGER_ID.setValue(store.getAt(0).get('LEDGER_ID'));\n        flag = 'true';\n    }\n}"},"children":[],"expanded":false,"type":"tstore"}],"expanded":true,"type":"tselect"}],"expanded":true,"type":"ttoolbar"},{"configs":{"docked":"top","style":"background:0;","itemId":"toolbar1"},"children":[{"configs":{"glyph":"f067","itemId":"addButton"},"events":{"tap":"app.menu.showBy(button);"},"children":[],"expanded":false,"type":"tbutton"},{"configs":{"placeHolder":"{#CUSTOMER#}","labelWidth":"100","labelAlign":"left","itemId":"CUSTOMER_ID"},"events":{"action":"app.searchButton.fireEvent('tap');"},"children":[],"expanded":true,"type":"ttext"},{"configs":{"glyph":"f002","itemId":"searchButton"},"events":{"tap":"var params = {\n    LEDGER_ID : app.LEDGER_ID.getValue(),\n\tCUSTOMER_INFO : app.CUSTOMER_ID.getValue()\n};\napp.list1.store.load({params : params});//查询（重新加载数据）"},"children":[],"expanded":false,"type":"tbutton"}],"expanded":true,"type":"ttoolbar"},{"configs":{"style":"background:0","itemTpl":"<div style=\"width:100%\">\n\t<div style=\"margin:5px 0px;width:100%;height:33%\">\n\t\t<div style=\"float:left;;width:100%;height:33%\">{#AR_INV_H_CODE#}：{AR_INV_H_CODE}<\/div>\n\t<\/div>\n\t<div style=\"margin:5px 0px;width:100%;height:33%\">\n\t\t<div style=\"float:left;width:100%;height:100%\">{#AR_DOC_CAT_NAME#}：{AR_CAT_NAME}<\/div>\n\t<\/div>\n \t<div style=\"margin:5px 0px;width:100%;height:33%\">\n\t\t<div style=\"float:left;;width:100%;height:30%\">{#CUSTOMER_NAME#}：{CUSTOMER_NAME}<\/div>\n\t<\/div>\n \t<div style=\"margin:5px 0px;width:100%;height:33%\">\n\t\t<div style=\"float:left;width:100%;height:100%\">{#INV_AMOUNT#}：{INV_AMOUNT}<\/div>\n\t<\/div>\n    <div style=\"margin:5px 0px;width:100%;height:33%\">\n\t\t<div style=\"float:left;;width:100%;height:30%\">{#DESCRIPTION#}：{DESCRIPTION}<\/div>\n\t<\/div>\n    <div style=\"margin:5px 0px;width:100%;height:33%\">\n        <div style=\"width:100%;word-wrap:break-word;word-break:break-all\">{#SYS_AUDIT_STATUS_DESC#}：{VAL_NAME}<\/div>\n\t<\/div>\n<\/div>","autoPaging":"true","itemId":"list1"},"events":{"itemtap":"if(clickCount == 1){\n    var arDocCatCode = record.get('AR_DOC_CAT_CODE');//单据类型\n    var sysAuditStatus = record.get('SYS_AUDIT_STATUS');//业务状态\t根据状态修改或查看采购发票：草稿为修改发票、其他状态为查看发票\n    var op = 'update';\n    var title = '';\n    var url = 'm?xwl=xc/ar/touch/inv/xc_ar_invoice_my_window';\n    if(arDocCatCode === 'ZZSPT'){//普通发票\n        title = '{#ptfp#}';\n    }\n    if(arDocCatCode === 'ZZS'){//增值税专用发票\n        title = '{#zzszyfp#}';\n    }\n    getUrlAndTitle(url,op,title,arDocCatCode,record.get('AR_INV_H_ID'));\n}","itemtaphold":"clickCount = 2;\nExt.Msg.confirm('{#confirm#}','{#confirm1#} ' + record.get('AR_INV_H_CODE') + ' {#confirm2#}吗？',function(btn){\n    if(btn === 'yes'){\n        var invoiceArray = [] ;\n        var paramJson = {'AR_INV_H_ID' : record.get('AR_INV_H_ID')} ;\n        invoiceArray.push(paramJson) ;\n        //调用删除采购发票的后台程序\n        Wb.request({\n            url : '{#contextPath#}' + '/arInvoiceAction.do?method=deleteArInvoice',\n            params : Wb.apply({invoiceId: invoiceArray}),\n            success : function(resp){\n                var record = Wb.decode(resp.responseText);\n                var msg = record.msg;\n                Wb.info(msg);\n                app.searchButton.fireEvent('tap');\n            }\n        });\n\t}\n    clickCount = 1;\n});"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/ar/touch/inv/xc_ar_invoice_myDB/ar_invoiceHSelect"},"children":[],"expanded":false,"type":"tstore"}],"expanded":true,"type":"tlist"}],"expanded":true,"type":"tcontainer"}],"expanded":true,"type":"tviewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}