{"inframe":false,"title":"单个资产明细账","hidden":false,"roles":{"default":1},"children":[{"configs":{"serverScript":"// 获取模块语言对应的json文件\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xc/fa/report/fa_dgzcmxz/fa_report\");\nrequest.setAttribute('contextPath',request.getContextPath());\nvar dbType = com.xzsoft.xip.platform.util.PlatformUtil.getDbType() ;\nvar language = request.getSession().getAttribute(\"XzSessionVars\").get(\"language\");\nrequest.setAttribute('dbType',dbType);\nrequest.setAttribute('language',language);","itemId":"module"},"events":{"finalize":"var ZCMC = null;\nvar GGXH = null;","initialize":"function getAllChildrenNodes(node){\n//     var children = [];\n// \tif(!node.isLeaf()){//是目录\n//         for(var i = 0;i < node.childNodes.length;i++){\n//             children.push(node.data[i]);alert(node.data.CAT_CODE);\n//         }\n//     }\n//     alert(children);\n//     return children;\n}"},"children":[{"configs":{"itemId":"tools"},"children":[{"configs":{"itemId":"treeStore","url":"m?xwl=xc/fa/report/xc_fa_zcmxz/DB/getFaCats"},"events":{"beforeload":"// if(!Wb.isEmpty(app.LEDGER_NAME.getValue()))\noperation.params.UP_CODE = operation.node.isRoot() ? (app.FA_PROPERTY.getValue()+\"_ROOT\") : operation.node.data.CAT_CODE;"},"children":[],"expanded":false,"type":"treestore"}],"expanded":true,"type":"folder"},{"configs":{"layout":"border","itemId":"viewport1"},"children":[{"configs":{"region":"north","itemId":"queryForm"},"children":[{"configs":{"layout":"column","margin":"5 0 5 0","itemId":"tr1","border":"false"},"children":[{"configs":{"layout":"form","columnWidth":".3","itemId":"td_1_1","border":"false"},"children":[{"configs":{"labelWidth":"100","displayField":"NAME","valueField":"CODE","labelAlign":"right","itemId":"LEDGER_NAME","fieldLabel":"{#LEDGER_NAME#}","editable":"false"},"events":{"beforequery":"var combo = plan.combo;\nif (!plan.forceAll) {\n  var value = plan.query;\n  combo.store.filterBy(function(record, id) {\n    var text = record.get(combo.displayField);\n    return (text.indexOf(value) != -1);\n  });\n  combo.expand();\n  return false;\n}","select":"app.DEPT_NAME.reset();\napp.PERIOD_START.reset();\napp.PERIOD_END.reset();\napp.FA_PROPERTY.reset();\napp.FA_CAT.reset();\napp.FA_CODE_START.reset();\napp.ORG_ID.setValue(records[0].data.ORG_ID);\napp.ORG_NAME.setValue(records[0].data.ORG_NAME);"},"children":[{"configs":{"pageSize":"-1","itemId":"store","url":"m?xwl=xc/gl/report/daily-accounts/cash-daily-account/data/getAllLedger"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"}],"expanded":false,"type":"panel"},{"configs":{"layout":"column","columnWidth":".3","itemId":"td_1_2","border":"false"},"children":[{"configs":{"layout":"form","columnWidth":".6","itemId":"td_1_2_1","border":"false"},"children":[{"configs":{"labelWidth":"100","displayField":"PERIOD_CODE","valueField":"PERIOD_CODE","labelAlign":"right","itemId":"PERIOD_START","fieldLabel":"{#PERIOD_START#}","editable":"false"},"events":{"beforequery":"var combo = plan.combo;\nif (!plan.forceAll) {\n  var value = plan.query;\n  combo.store.filterBy(function(record, id) {\n    var text = record.get(combo.displayField);\n    return (text.indexOf(value) != -1);\n  });\n  combo.expand();\n  return false;\n}"},"children":[{"configs":{"pageSize":"-1","itemId":"store","url":"m?xwl=xc/fa/report/fa_dgzcmxz/data/select-period-info-by-ledger"},"events":{"beforeload":"store.proxy.extraParams.ledgerId = app.LEDGER_NAME.getValue();"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"}],"expanded":false,"type":"panel"},{"configs":{"layout":"form","columnWidth":".4","itemId":"td_1_2_2","border":"false"},"children":[{"configs":{"labelWidth":"20","displayField":"PERIOD_CODE","valueField":"PERIOD_CODE","labelAlign":"right","itemId":"PERIOD_END","fieldLabel":"{#PERIOD_END#}","editable":"false"},"events":{"beforequery":"var combo = plan.combo;\nif (!plan.forceAll) {\n  var value = plan.query;\n  combo.store.filterBy(function(record, id) {\n    var text = record.get(combo.displayField);\n    return (text.indexOf(value) != -1);\n  });\n  combo.expand();\n  return false;\n}"},"children":[{"configs":{"pageSize":"-1","itemId":"store","url":"m?xwl=xc/fa/report/fa_dgzcmxz/data/select-period-info-by-ledger"},"events":{"beforeload":"store.proxy.extraParams.ledgerId = app.LEDGER_NAME.getValue();"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"}],"expanded":false,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".3","itemId":"td_1_3","border":"false"},"children":[{"configs":{"labelWidth":"100","displayField":"DEPT_NAME","valueField":"DEPT_ID","labelAlign":"right","itemId":"DEPT_NAME","fieldLabel":"{#DEPT_NAME#}"},"children":[{"configs":{"pageSize":"-1","itemId":"store","url":"m?xwl=xc/fa/report/fa_dgzcmxz/data/select-dept-info-by-ledger"},"events":{"beforeload":"store.proxy.extraParams.ledgerId = app.LEDGER_NAME.getValue();"},"children":[],"expanded":false,"type":"store"}],"expanded":false,"type":"combo"}],"expanded":false,"type":"panel"},{"configs":{"layout":"form","columnWidth":".1","itemId":"td_1_4","border":"false"},"children":[{"configs":{"text":"{#queryBtn#}","itemId":"queryBtn","iconCls":"seek_icon"},"events":{"click":"if(Wb.isEmpty(app.LEDGER_NAME.getValue())){\n//     Wb.toast('请选择账簿！');\n    Wb.toast('{#query1#}');\n    return;\n}\nif(Wb.isEmpty(app.PERIOD_START.getValue())){\n//     Wb.toast('请选择开始会计期！');\n    Wb.toast('{#query2#}');\n    return;\n}\nif(Wb.isEmpty(app.PERIOD_END.getValue())){\n//     Wb.toast('请选择结束会计期！');\n    Wb.toast('{#query3#}');\n    return;\n}\nif(Wb.isEmpty(app.FA_PROPERTY.getValue())){\n//     Wb.toast('请选择资产属性！');\n    Wb.toast('{#query5#}');\n    return;\n}\nif(Wb.isEmpty(app.FA_CODE_START.getValue())){\n//     Wb.toast('请选择开始资产编号！');\n    Wb.toast('{#query4#}');\n    return;\n}\nvar map = new Ext.util.HashMap();\n\nvar lastPeriod = null;\nvar store = app.PERIOD_START.store;\nvar count = store.getCount();\nfor(var i = 0;i < count;i++){\n    if(store.getAt(i).data.PERIOD_CODE == app.PERIOD_START.getValue() && (i - 1) >= 0)\n\t\tlastPeriod = store.getAt(i-1).data.PERIOD_CODE;\n}\nvar catCodeInfo = 'IN (' + '\"' + app.CAT_CODE.getValue() + '\"';\nWb.request({\n\turl : 'm?xwl=xc/fa/report/fa_dgzcmxz/data/select-faCat-by-catCode',\n    params : {UP_CODE : app.CAT_CODE.getValue()},\n    success : function(resp){\n        var r = Wb.decode(resp.responseText);\n        var total = r.total;\n        if(app.CAT_CODE.getValue() === null || app.CAT_CODE.getValue() === ''){\n            catCodeInfo = '= fa.CAT_CODE';\n        }\n        else{\n            if(total > 0){\n                for(var i = 0;i < total;i++){\n                    var catCode = r.rows[i].CAT_CODE;\n                    catCodeInfo = catCodeInfo + ',' + '\"'+catCode+'\"';\n                }\n                catCodeInfo = catCodeInfo + ')';\n            }\n            else{\n                catCodeInfo = catCodeInfo + ')';\n            }\n        }\n        map.add('ledgerId',app.LEDGER_NAME.getValue());\n        map.add('deptId',(Wb.isEmpty(app.DEPT_NAME.getValue()) ? \"\" : app.DEPT_NAME.getValue()));\n        map.add('lastPeriod',(Wb.isEmpty(lastPeriod) ? \"\" : lastPeriod));\n        map.add('periodStart',app.PERIOD_START.getValue());\n        map.add('periodEnd',app.PERIOD_END.getValue());\n        map.add('transDateStart',app.PERIOD_START.getValue() + '-01');\n        map.add('transDateEnd',app.PERIOD_END.getValue() + '-31');\n        map.add('faCat',(Wb.isEmpty(app.CAT_CODE.getValue()) ? \"\" : app.CAT_CODE.getValue()));\n        map.add('faProperty',(Wb.isEmpty(app.FA_PROPERTY.getValue()) ? \"\" : app.FA_PROPERTY.getValue()));\n        map.add('faName',ZCMC);\n        map.add('faCode',app.FA_CODE_START.getValue());\n        map.add('orgName',app.ORG_NAME.getValue());\n        map.add('model',GGXH);\n        map.add('language',\"{#language#}\");\n        map.add('query',\"click\");\n        map.add('catCodeInfo',catCodeInfo);\n      \n        var targetUrl = '{#contextPath#}/ReportServer?reportlet=xc_fa/fa_dgzcmxz.cpt&__bypagesize__=false';\n        var reportFrame = document.getElementById('fa_dgzcmxz');\n        var params = '';\n        map.each(function(key, value, length){\n            params +='&'+key+'='+value;\n        });\n        params = targetUrl+params;\n        reportFrame.src = params;\n    }\n});"},"children":[],"expanded":false,"type":"button"}],"expanded":false,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"layout":"column","margin":"0 0 5 0","itemId":"tr2","border":"false"},"children":[{"configs":{"layout":"form","columnWidth":".3","itemId":"td_2_1","border":"false"},"children":[{"configs":{"labelWidth":"100","displayField":"VAL_NAME","valueField":"VAL_CODE","labelAlign":"right","itemId":"FA_PROPERTY","fieldLabel":"{#FA_PROPERTY#}","editable":"false"},"events":{"change":"app.FA_CAT.reset();\n// if(!Wb.isEmpty(app.LEDGER_NAME.getValue()))\napp.treeStore.load();\napp.FA_CODE_START.reset();"},"children":[{"configs":{"pageSize":"-1","itemId":"store","url":"m?xwl=xc/fa/common/FA_INFO_PANEL/data/getFaProperty"},"events":{"beforeload":"store.proxy.extraParams.ledgerId = app.LEDGER_NAME.getValue();"},"children":[],"expanded":false,"type":"store"}],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".3","itemId":"td_2_2","border":"false"},"children":[{"configs":{"labelWidth":"100","displayField":"CAT_NAME","hidden":"true","valueField":"CAT_CODE","labelAlign":"right","itemId":"FA_CAT1","fieldLabel":"{#FA_CAT#}"},"children":[{"configs":{"pageSize":"-1","itemId":"store","url":"m?xwl=xc/fa/common/FA_INFO_PANEL/data/getFaCats"},"events":{"beforeload":"store.proxy.extraParams.ledgerId = app.LEDGER_NAME.getValue();\nstore.proxy.extraParams.faProperty = app.FA_PROPERTY.getValue();"},"children":[],"expanded":false,"type":"store"}],"expanded":false,"type":"combo"},{"configs":{"labelWidth":"100","labelAlign":"right","itemId":"FA_CAT","fieldLabel":"{#FA_CAT#}","editable":"true"},"events":{"change":"if(newValue === null || newValue === '')\n    app.CAT_CODE.reset();\napp.FA_CODE_START.reset();","expand":"app.tree.expandAll(function(){});"},"children":[{"configs":{"rootVisible":"false","tagConfigs":"minWidth:300","multiSelect":"true","height":"300","store":"app.treeStore","normalName":"tree","itemId":"pickComp"},"events":{"itemclick":"var picker = this.ownerCmp;\npicker.setValue(Wb.getSection(record.getPath('text'), '/', 2));\napp.CAT_CODE.setValue(record.data.CAT_CODE);\ngetAllChildrenNodes(record);\npicker.collapse();"},"children":[],"expanded":true,"type":"tree"}],"expanded":true,"type":"picker"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".3","itemId":"td_2_3","border":"false"},"children":[{"configs":{"labelWidth":"100","labelAlign":"right","itemId":"FA_CODE_START","fieldLabel":"{#FA_CODE_START#}"},"events":{"expand":"if(Wb.isEmpty(app.LEDGER_NAME.getValue())){\n    Wb.toast('{#query1#}');\n    return;\n}\nif(Wb.isEmpty(app.PERIOD_START.getValue())){\n    Wb.toast('{#query2#}');\n    return;\n}\nif(Wb.isEmpty(app.PERIOD_END.getValue())){\n    Wb.toast('{#query3#}');\n    return;\n}\nif(Wb.isEmpty(app.FA_PROPERTY.getValue())){\n    Wb.toast('{#query5#}');\n    return;\n}\napp.pickComp.getStore().load();","collapse":"app.QUERY_CODE_NAME.reset();"},"children":[{"configs":{"tagConfigs":"minWidth:400","height":"300","barExportButtons":"false","barExportAllButtons":"false","itemId":"pickComp"},"events":{"itemclick":"app.FA_CODE_START.setValue(record.data.ZCBM);\nZCMC = record.data.ZCMC;\nGGXH = record.data.GGXH;\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/fa/report/fa_dgzcmxz/data/select-fa-info-by-ledger"},"events":{"beforeload":"operation.params = Wb.getValue([app.queryForm,app.tbar]);"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","dataIndex":"ASSET_ID","itemId":"ASSET_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#ZCBM#}","dataIndex":"ZCBM","itemId":"ZCBM_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#ZCMC#}","dataIndex":"ZCMC","itemId":"ZCMC_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"100","emptyText":"{#ZCBMORZCMC#}","labelAlign":"right","itemId":"QUERY_CODE_NAME"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.pickComp.getStore().load();\n}"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"searchButton","iconCls":"seek_icon"},"events":{"click":"app.pickComp.getStore().load();"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"}],"expanded":false,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".1","itemId":"td_2_4","border":"false"},"children":[{"configs":{"text":"{#resetBtn#}","itemId":"clearBtn","iconCls":"refresh_icon"},"events":{"click":"app.queryForm.getForm().reset();\nvar map = new Ext.util.HashMap();\nmap.add('language',\"{#language#}\");\nvar targetUrl = '{#contextPath#}/ReportServer?reportlet=xc_fa/fa_dgzcmxz.cpt&__bypagesize__=false';\nvar reportFrame = document.getElementById('fa_dgzcmxz');\nvar params = '';\nmap.each(function(key, value, length){\n    params +='&'+key+'='+value;\n});\nparams = targetUrl+params;\nreportFrame.src = params;"},"children":[],"expanded":false,"type":"button"},{"configs":{"hidden":"true","layout":"form","border":"false","itemId":"td_2_3_1_3"},"children":[{"configs":{"itemId":"ORG_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"ORG_NAME"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"CAT_CODE"},"children":[],"expanded":false,"type":"text"}],"expanded":false,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":false,"type":"panel"}],"expanded":true,"type":"form"},{"configs":{"region":"center","html":"<iframe  scrolling=no frameborder=0 width=100% height=100% id=fa_dgzcmxz name=classifyReport src='{#contextPath#}/ReportServer?reportlet=xc_fa/fa_dgzcmxz.cpt&language={#language#}&dbType={#dbType#}&__bypagesize__=false'><\/iframe>","itemId":"reportForm"},"children":[],"expanded":false,"type":"panel"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}