{"inframe":false,"title":"","hidden":false,"roles":{"default":1},"children":[{"configs":{"loginRequired":"false","serverScript":"var ledgerId = request.getParameter(\"LEDGER_ID\");\nvar periodCode = request.getParameter(\"PERIOD_CODE\");\n\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xc/fa/ld-base/fa-ld-period/XC_FA_LD_PERIOD\");\n\n/* \n  期间关闭校验规则\n    1、没有未计提折旧的资产\n    2、本期间的凭证接口的数据都已经生成凭证\n    3、本期间调整单都已经提交\n    4、所有凭证都已经审核通过。不满足时提示：存在未审核的凭证，不能关闭会计期\n*/\n\n/* 1、没有未计提折旧的资产 */\napp.run(\n  \"select 1 from xc_fa_additions where jz>0 and QLQJ is null and SFZJ = 'Y' and LEDGER_ID = '\"+ledgerId+\"' and JTQJ != '\"+periodCode+\"' and '\"+periodCode+\"' between KSJTQJ and TYQJ\", \n  {errorText: request.getAttribute('additionHasJt')\n});\n\n/* 4、所有凭证都已经审核通过 */\napp.run(\n  \"select 1 from xc_gl_v_interface_heads h left join xc_gl_v_heads vh on h.V_HEAD_ID = vh.V_HEAD_ID where h.LEDGER_ID = '\"+ledgerId+\"' and h.PERIOD_CODE = '\"+periodCode+\"' and vh.V_STATUS = 1\", \n  {errorText: request.getAttribute('interfaceNotPass')}\n);\n\n/* 3、本期间调整单都已经提交 */\napp.run(\n  \"select 1 from xc_fa_adj_h where ADJ_DATE >= DATE_FORMAT('\"+periodCode+\"-01'\"+\", '%Y-%m-%d') and ADJ_DATE <= DATE_FORMAT('\"+periodCode+\"-31'\"+\", '%Y-%m-%d') and LEDGER_ID = '\"+ledgerId+\"' and AUDIT_STATUS = 'C'\", \n  {errorText: request.getAttribute('adjsNotSubmit')}\n);\n\n/* 2、本期间的凭证接口的数据都已经生成凭证 */\napp.run(\n  \"select 1 from xc_gl_v_interface where (I_HEAD_ID is null or I_HEAD_ID = '') and LEDGER_ID = '\"+ledgerId+\"' and PERIOD_CODE = '\"+periodCode+\"'\", \n  {errorText: request.getAttribute('interfaceNotGenerate')}\n);\n\n\n\n\n","itemId":"module"},"children":[{"configs":{"sql":"update xc_fa_ld_periods set STATUS='2' where LD_PERIOD_ID={?LD_PERIOD_ID?}","transaction":"commit","itemId":"query2"},"children":[],"expanded":false,"type":"query"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}