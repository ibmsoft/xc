{"inframe":false,"title":"批量资产调整","hidden":false,"roles":{"default":1},"children":[{"configs":{"loginRequired":"false","serverScript":"request.setAttribute('contextPath',request.getContextPath());\n//---------------------获取当前模块语言对应的.json文件，放到request中----------------\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xc/fa/daily-business/fa-adj/fa-adj-batch/FA_ADJ_BATCH\");","itemId":"module"},"events":{"initialize":"//点击树回调函数\nfunction returnRowFn(record, type){\n  if(type == 'cat_code'){\n    var catCode = '';\n\n    if(record.data.UP_CODE=='-1'){\n      catCode = record.data.CAT_CODE.split('_')[0];\n    }else{\n      catCode = record.data.CAT_CODE;\n    }\n    \n    app.subGrid.getStore().getProxy().extraParams.catCode = catCode;\n    if(Ext.isEmpty(app.ADJ_TYPE.getValue())){\n      app.subGrid.getStore().getProxy().extraParams.oldValue = '';\n    }\n    app.subGrid.getStore().load();\n  }else if(type == 'KM_XWL'){\n    for(var i=0; i<app.subGrid.getStore().getCount(); i++){\n      var res = app.subGrid.getStore().getAt(i);\n      res.set('NEW_VAL', record.get('ACC_CODE'));\n      res.set('NEW_VAL_VIEW', record.get('ACC_NAME'));\n    }\n  }else if(type == 'DFKM_XWL'){\n    for(var i=0; i<app.subGrid.getStore().getCount(); i++){\n      var res = app.subGrid.getStore().getAt(i);\n      res.set('DFKM', record.get('ACC_CODE'));\n      res.set('DFKM_VIEW', record.get('ACC_NAME'));\n    }\n  }\n}\n\n//设置调整后值\nfunction setSubGridNewVal(newVal, newViewVal){\n  for(var i=0; i<app.subGrid.getStore().getCount(); i++){\n    var record = app.subGrid.getStore().getAt(i);\n    record.set('NEW_VAL', newVal);\n    record.set('NEW_VAL_VIEW', newViewVal);\n  }\n}\n\n//选择调整类型后，控件的显示与隐藏\nfunction hideComps(comp){\n  app.CAT_CODE.hide();\n  app.ZJFF.hide();\n  app.NUM_FIELD.hide();\n  app.ZCYT.hide();\n  app.SFZJ.hide();\n  app.KM_XWL.ACC_NAME.hide();\n  \n  comp.show();\n}"},"children":[{"configs":{"layout":"border","itemId":"viewport"},"children":[{"configs":{"region":"north","bodyPadding":"5","border":"false","itemId":"queryFormPanel"},"children":[{"configs":{"height":"30","layout":"column","columnWidth":"1","border":"false","itemId":"tr1"},"children":[{"configs":{"layout":"fit","columnWidth":".3","border":"false","itemId":"tr1_1"},"children":[{"configs":{"labelWidth":"120","displayField":"NAME","valueField":"ID","labelAlign":"right","itemId":"queryLedger","fieldLabel":"{#queryLedger#}","editable":"false"},"events":{"select":"app.TREE_XWL.LEDGER_ID.setValue(combo.getValue());\napp.TREE_XWL.tree.getStore().load();\napp.TREE_XWL.tree.expandAll(function(){});\napp.queryBtn.fireEvent('click');\n\napp.KM_XWL.QUERY_LEDGER_ID.setValue(combo.getValue());\napp.DFKM_XWL.QUERY_LEDGER_ID.setValue(combo.getValue());"},"children":[{"configs":{"itemId":"store","autoLoad":"true","url":"m?xwl=xc/com-qry/gl-ledgers/select-sec-ledger"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".3","border":"false","itemId":"tr1_2"},"children":[{"configs":{"labelWidth":"120","labelAlign":"right","itemId":"queryCodeName","fieldLabel":"{#queryCodeName#}"},"events":{"specialkey":"app.queryBtn.fireEvent('click');"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".3","border":"false","itemId":"tr1_3"},"children":[{"configs":{"labelWidth":"120","displayField":"PERIOD_CODE","valueField":"PERIOD_CODE","labelAlign":"right","itemId":"queryPeriodCode","fieldLabel":"{#queryPeriodCode#}"},"events":{"select":"app.queryBtn.fireEvent('click');"},"children":[{"configs":{"itemId":"store","autoLoad":"true","url":"m?xwl=xc/fa/ld-base/fa_ld_param/data/SELECT_LD_PERIOD"},"events":{"beforeload":"store.getProxy().extraParams.LEDGER_ID = app.queryLedger.getValue();\n"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":"0.05","border":"false","itemId":"tr1_4","x":"10"},"children":[{"configs":{"text":"{#queryBtn#}","itemId":"queryBtn","iconCls":"seek_icon"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"height":"30","layout":"column","columnWidth":"1","border":"false","itemId":"tr2"},"children":[{"configs":{"layout":"fit","columnWidth":".3","border":"false","itemId":"tr2_1"},"children":[{"configs":{"labelWidth":"120","triggerCls":"x-form-search-trigger","labelAlign":"right","itemId":"queryCbzx","fieldLabel":"{#queryCbzx#}","editable":"false"},"events":{"expand":"app.findLdDepts.fireEvent('click') ;"},"children":[{"configs":{"tagConfigs":"minWidth:420","height":"240","barExportAllButtons":"false","barExportButtons":"false","itemId":"pickComp","forceFit":"true"},"events":{"itemclick":"// 选择成本中心\nvar deptId = record.get('DEPT_ID');\nvar deptName = record.get('DEPT_NAME');\n\napp.CBZX_NAME.setValue(deptName);\napp.CBZX.setValue(deptId);\n\n// 清空项目\napp.PROJECT_ID.setValue();\napp.PROJECT_NAME.setValue();\n\n// app.pickComp.hide() ;\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/fa/common/FA_INFO_PANEL/data/getDepts"},"events":{"beforeload":"store.proxy.extraParams.textStr = app.deptCodeOrName.getValue() ;"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","width":"50","dataIndex":"DEPT_ID","titleAlign":"center","itemId":"DEPT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#DEPT_CODE#}","width":"100","dataIndex":"DEPT_CODE","titleAlign":"center","itemId":"DEPT_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#DEPT_NAME#}","width":"200","dataIndex":"DEPT_NAME","titleAlign":"center","itemId":"DEPT_NAME_COL"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"emptyText":"按编码或名称进行查询","itemId":"deptCodeOrName"},"events":{"specialkey":"if(Ext.EventObject.getKey() == 13){\n  app.findLdDepts.fireEvent('click') ;\n}"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"findLdDepts","iconCls":"seek_icon"},"events":{"click":"// TODO: 加载成本中心\napp.pickComp.getStore().load() ;"},"children":[],"expanded":false,"type":"button"},{"configs":{"itemId":"clearLdDepts","iconCls":"cancel_icon","tooltip":"清空已选择的数据"},"events":{"click":"app.CBZX.setValue();\napp.CBZX_NAME.setValue() ;\napp.deptCodeOrName.setValue() ;\napp.findLdDepts.fireEvent('click') ;"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":false,"type":"picker"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".3","border":"false","itemId":"tr2_2"},"children":[{"configs":{"labelWidth":"120","displayField":"EMP_NAME","valueField":"USER_ID","labelAlign":"right","itemId":"queryBgr","fieldLabel":"{#queryBgr#}"},"children":[{"configs":{"pageSize":"-1","itemId":"store","url":"m?xwl=xc/fa/common/FA_INFO_PANEL/data/getZjfs"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".3","border":"false","itemId":"tr2_3"},"children":[{"configs":{"labelWidth":"120","labelAlign":"right","itemId":"queryLy","fieldLabel":"{#queryLy#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":"0.05","border":"false","itemId":"tr2_4","x":"10"},"children":[{"configs":{"text":"{#resetBtn#}","itemId":"resetBtn","iconCls":"refresh_icon"},"events":{"click":"Wb.reset(app.queryFormPanel);\napp.queryBtn.fireEvent('click');"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"form"},{"configs":{"region":"center","layout":"border","itemId":"panel1"},"children":[{"configs":{"region":"west","width":"200","itemId":"treePanel"},"children":[{"configs":{"file":"m?xwl=xc/fa/common/FA_CATS_TREE/FA_CATS_TREE","itemId":"TREE_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"region":"center","layout":"border","itemId":"gridPanel"},"children":[{"configs":{"region":"north","height":"77","bodyPadding":"10 20 0 10","itemId":"mainForm"},"events":{"afterrender":"app.KM_XWL.ACC_NAME.hide();\n\napp.KM_XWL.ACC_NAME.fieldLabel = '{#AFTER_ADJ#}';\napp.DFKM_XWL.ACC_NAME.fieldLabel = '{#DFKM#}';\n\napp.KM_XWL.returnFunType.setValue('KM_XWL');\napp.DFKM_XWL.returnFunType.setValue('DFKM_XWL');"},"children":[{"configs":{"style":"border-width:0px;","layout":"column","border":"false","itemId":"t1"},"children":[{"configs":{"style":"border-width:0px;","layout":"form","columnWidth":".4","border":"false","itemId":"d1"},"children":[{"configs":{"labelWidth":"120","displayField":"TRANS_DESC","valueField":"TRANS_CODE","labelAlign":"right","itemId":"ADJ_TYPE","fieldLabel":"{#ADJ_TYPE#}"},"events":{"select":"var adjType = combo.getValue();\n\nif(adjType=='CAT_CODE'){\n  hideComps(app.CAT_CODE);\n}else if(adjType=='ZJFF'){\n  hideComps(app.ZJFF);\n}else if(adjType=='CZL' || adjType=='JZZB' || adjType=='LJZJ_LJTX' || adjType=='SYNX' || adjType=='YZ'){\n  hideComps(app.NUM_FIELD);\n}else if(adjType=='ZCYT'){\n  hideComps(app.ZCYT);\n}else if(adjType=='SFZJ'){\n  hideComps(app.SFZJ);\n}else if(adjType=='JZZBKM' || adjType=='LJZJTXKM' || adjType=='ZCKM'){\n  hideComps(app.KM_XWL.ACC_NAME);\n}\n\nif(adjType=='JZZB' || adjType=='LJZJ_LJTX' || adjType=='YZ'){\n  app.t2.show();\n  app.mainForm.setHeight(110);\n}else{\n  app.mainForm.setHeight(77);\n  app.t2.hide();\n}\n\napp.subGrid.getStore().getProxy().extraParams.oldValue = ' xfa.'+adjType+' OLD_VAL, ';\napp.subGrid.getStore().getProxy().extraParams.adjType = adjType;\napp.subGrid.getStore().load(function(){\n\n  for(var i=0; i<app.subGrid.getStore().getCount(); i++){\n    var record = app.subGrid.getStore().getAt(i);\n    //record.set('ADJ_TYPE', records[0].get('TRANS_CODE'));\n    //record.set('ADJ_TYPE_VIEW', records[0].get('TRANS_DESC'));\n    record.set('VOUCHER_FLAG', records[0].get('VOUCHER_FLAG'));\n  }\n\n});"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/fa/daily-business/fa-adj/data/getTranTypes"},"children":[],"expanded":false,"type":"store"}],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"style":"border-width:0px;","layout":"form","columnWidth":".4","border":"false","itemId":"d2"},"children":[{"configs":{"labelWidth":"120","displayField":"CAT_NAME","hidden":"true","valueField":"CAT_CODE","labelAlign":"right","itemId":"CAT_CODE","fieldLabel":"{#AFTER_ADJ#}"},"events":{"select":"setSubGridNewVal(combo.getValue(), combo.getRawValue());"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/fa/daily-business/fa-adj/data/getCatType"},"children":[],"expanded":false,"type":"store"}],"expanded":false,"type":"combo"},{"configs":{"labelWidth":"120","displayField":"METHOD_NAME","hidden":"true","valueField":"METHOD_CODE","labelAlign":"right","itemId":"ZJFF","fieldLabel":"{#AFTER_ADJ#}"},"events":{"select":"setSubGridNewVal(combo.getValue(), combo.getRawValue());"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/fa/daily-business/fa-adj/data/getZjff"},"children":[],"expanded":false,"type":"store"}],"expanded":false,"type":"combo"},{"configs":{"labelWidth":"120","hidden":"true","minValue":"0","labelAlign":"right","itemId":"NUM_FIELD","fieldLabel":"{#AFTER_ADJ#}"},"events":{"blur":"setSubGridNewVal(this.getValue(), this.getValue());"},"children":[],"expanded":false,"type":"number"},{"configs":{"labelWidth":"120","displayField":"USE_NAME","hidden":"true","valueField":"USE_CODE","labelAlign":"right","itemId":"ZCYT","fieldLabel":"{#AFTER_ADJ#}"},"events":{"select":"setSubGridNewVal(combo.getValue(), combo.getRawValue());"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/fa/daily-business/fa-adj/data/getZcyt"},"children":[],"expanded":false,"type":"store"}],"expanded":false,"type":"combo"},{"configs":{"labelWidth":"120","hidden":"true","labelAlign":"right","pickList":"[['Y','是'],['N','否']]","itemId":"SFZJ","fieldLabel":"{#AFTER_ADJ#}"},"events":{"select":"setSubGridNewVal(combo.getValue(), combo.getRawValue());"},"children":[],"expanded":true,"type":"combo"},{"configs":{"file":"m?xwl=xc/fa/common/ACC_PICK/ACC_LD","itemId":"KM_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"style":"border-width:0px;","hidden":"true","layout":"column","border":"false","itemId":"t2"},"children":[{"configs":{"style":"border-width:0px;","layout":"form","columnWidth":".8","border":"false","itemId":"d1"},"children":[{"configs":{"file":"m?xwl=xc/fa/common/ACC_PICK/ACC_LD","itemId":"DFKM_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"style":"border-width:0px;","layout":"column","border":"false","itemId":"t3"},"children":[{"configs":{"style":"border-width:0px;","layout":"form","columnWidth":".8","border":"false","itemId":"d1"},"children":[{"configs":{"labelWidth":"120","labelAlign":"right","itemId":"BZSM","fieldLabel":"{#BZSM#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"style":"border-width:0px;","layout":"form","columnWidth":".1","border":"false","itemId":"d2","y":"1","x":"5"},"children":[{"configs":{"text":"{#saveBtn#}","width":"80","itemId":"saveBtn","iconCls":"save_icon"},"events":{"click":"if(Ext.isEmpty(app.LEDGER.getValue())){\n  Wb.toast('selectLedgerMsgTips');\n  return;\n}\n\nfor(var i=0; i<app.subGrid.getStore().getCount(); i++){\n  var recordi = app.subGrid.getStore().getAt(i);\n  \n  // 检查信息是否填写完整\n  if(Ext.isEmpty(recordi.get('ADJ_TYPE'))){\n    Wb.toast('{#selectAdjTypeFirst#}');\n    return;\n  }\n  if(Ext.isEmpty(recordi.get('NEW_VAL'))){\n    Wb.toast('{#selectNewValueFirst#}');\n    return;\n  }\n  \n  //减值准备、原值、累计折旧必须录入对方科目\n  if(recordi.get('ADJ_TYPE')=='JZZB' || recordi.get('ADJ_TYPE')=='YZ' || recordi.get('ADJ_TYPE')=='LJZJ_LJTX'){\n    if(Ext.isEmpty(recordi.get('DFKM'))){\n      Wb.toast('{#dfkmIsNotNull#}');\n      return;\n    }\n  }\n  \n  //不能存在相同资产，相同调整类型的记录\n  var sameRecordSize = 0;\n  for(var j=0; j<app.subGrid.getStore().getCount(); j++){\n    if(i==j){\n      continue;\n    }\n    var recordj = app.subGrid.getStore().getAt(j);\n    if(!Ext.isEmpty(recordi.get('ADJ_TYPE')) && !Ext.isEmpty(recordj.get('ADJ_TYPE')) && recordi.get('ADJ_TYPE')==recordj.get('ADJ_TYPE')){\n      sameRecordSize++;\n    }\n  }\n  if(sameRecordSize>=1){\n    Wb.toast('{#checkSameRecord#}');\n    return;\n  }\n}\n\nvar checkPeriodCodeFlag = true;\n\n// 校验调整日期所在期间是否打开\nvar periodCode = app.ADJ_DATE.getRawValue().substring(0, 7);\n// 提交ajax请求\nExt.Msg.wait('{#checkPeriodCode#}');\nExt.Ajax.request({\n  url: 'm?xwl=xc/fa/daily-business/fa-adj/data/checkPeriodCode',\n  method: 'POST',\n  async: false,\n  timeout: 300000,\n  params: {ledgerId: app.LEDGER.getValue(), periodCode: periodCode},\n  success: function(res, opts) {\n    Ext.Msg.hide();\n\n    var temp = res.responseText;\n    var resp = Ext.JSON.decode(temp);\n\n    if(resp.flag == 0){\n      Wb.toast('{#periodNotOpened#}');\n      checkPeriodCodeFlag = false;\n    }else if(resp.flag == 2){\n      Wb.toast('{#periodIsClosed#}');\n      checkPeriodCodeFlag = false;\n    }\n  },\n  failure: function(res, opts) {\n    Ext.Msg.hide();\n    Wb.error('{#checkPeriodFailureMsg#}');\n    checkPeriodCodeFlag = false;\n  }\n});\n\nif(checkPeriodCodeFlag == false){\n  return;\n}\n\nvar saveJson = {};\n\nvar faAdjH = {};\nfaAdjH.adjHid = app.ADJ_H_ID.getValue();\nfaAdjH.ledgerId = app.LEDGER.getValue();\nfaAdjH.adjDate = app.ADJ_DATE.getValue();\nfaAdjH.periodCode = periodCode;\nfaAdjH.bzsm = app.BZSM.getValue();\nsaveJson.faAdjH = faAdjH;\n\nvar faAdjLs = new Array();\nfor(var i=0; i<app.subGrid.getStore().getCount(); i++){\n  var record = app.subGrid.getStore().getAt(i);\n  var faAdjL = {};\n  faAdjL.adjHid = record.get('ADJ_H_ID');\n  faAdjL.assetId = record.get('ASSET_ID');\n  faAdjL.assetCode = record.get('ZCBM');\n  faAdjL.adjType = record.get('ADJ_TYPE');\n  faAdjL.adjViewType = record.get('ADJ_TYPE_VIEW');\n  faAdjL.oldVal = record.get('OLD_VAL');\n  faAdjL.oldViewVal = record.get('OLD_VAL_VIEW');\n  faAdjL.newVal = record.get('NEW_VAL');\n  faAdjL.newViewVal = record.get('NEW_VAL_VIEW');\n  faAdjL.dfkm = record.get('DFKM');\n  faAdjL.vouCherFlag = record.get('VOUCHER_FLAG');\n  faAdjLs.push(faAdjL);\n}\nsaveJson.faAdjLs = faAdjLs;\n\nvar jsonData = Ext.JSON.encode(saveJson);\n\n// 提交ajax请求\nExt.Msg.wait('{#saveWaitMsg#}');\nExt.Ajax.request({\n  url: '{#contextPath#}' + '/faAdjAction.do?method=saveFaAdj&saveType=batch',\n  method: 'POST',\n  sync: false,\n  timeout: 300000,\n  headers: {\n    'Content-Type': 'application/json'\n  },\n  jsonData: jsonData,\n  success: function(res, opts) {\n    Ext.Msg.hide();\n\n    var temp = res.responseText;\n    var resp = Ext.JSON.decode(temp);\n\n    if(resp.flag == 0){\n      Wb.toast('{#saveSuccessMsg#}');\n    }else{\n      Wb.error(resp.msg);\n    }\n  },\n  failure: function(res, opts) {\n    Ext.Msg.hide();\n    Wb.error('{#saveFailureMsg#}');\n  }\n});\n"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"form"},{"configs":{"region":"center","multiSelect":"false","itemId":"subGrid","simpleSelect":"false","editable":"true"},"events":{"tagEvents":"beforeedit: function(editor,e,eOpts ){\n  if(app.OP_TYPE.getValue()=='_modified'){\n    return false;\n  }\n  if(e.colIdx == 8){\n    var selRecord = app.subGrid.getStore().getAt(e.rowIdx);\n    var adjType = selRecord.get('ADJ_TYPE');\n    if(Ext.isEmpty(adjType)){\n      Wb.toast('{#selectAdjTypeFirst#}');\n      return false;\n    }\n    \n    var temp = null;\n    if(adjType=='CAT_CODE'){\n      temp = {\n        xtype:\"combo\",\n        displayField:\"CAT_NAME\",\n        valueField:\"CAT_CODE\",\n        store:{url:\"m?xwl=xc/fa/daily-business/fa-adj/data/getCatType\"},\n        listeners:{\n          select:function(combo, records, options){\n            app.subGrid.plugins[0].completeEdit();\n            selRecord.set('NEW_VAL', combo.getValue());\n            selRecord.set('NEW_VAL_VIEW', combo.getRawValue());\n          }\n        }\n      };\n    }else if(adjType=='ZJFF'){\n      temp = {\n        xtype:\"combo\",\n        displayField:\"METHOD_NAME\",\n        valueField:\"METHOD_CODE\",\n        store:{url:\"m?xwl=xc/fa/daily-business/fa-adj/data/getZjff\"},\n        listeners:{\n          select:function(combo, records, options){\n            app.subGrid.plugins[0].completeEdit();\n            selRecord.set('NEW_VAL', combo.getValue());\n            selRecord.set('NEW_VAL_VIEW', combo.getRawValue());\n          }\n        }\n      };\n    }else if(adjType=='CZL' || adjType=='JZZB' || adjType=='LJZJ_LJTX' || adjType=='SYNX' || adjType=='YZ'){\n      temp = {\n        xtype:\"numberfield\",\n        minValue:'0',\n        listeners:{\n          blur:function(comp, e, options){\n            selRecord.set('NEW_VAL', this.getValue());\n          }\n        }\n      };\n    }else if(adjType=='ZCYT'){\n      temp = {\n        xtype:\"combo\",\n        displayField:\"USE_NAME\",\n        valueField:\"USE_CODE\",\n        store:{url:\"m?xwl=xc/fa/daily-business/fa-adj/data/getZcyt\"},\n        listeners:{\n          select:function(combo, records, options){\n            app.subGrid.plugins[0].completeEdit();\n            selRecord.set('NEW_VAL', combo.getValue());\n            selRecord.set('NEW_VAL_VIEW', combo.getRawValue());\n          }\n        }\n      };\n    }else if(adjType=='SFZJ'){\n      temp = {\n        xtype:\"combo\",\n          store:[['Y','是'],['N','否']],\n        listeners:{\n          select:function(combo, records, options){\n            app.subGrid.plugins[0].completeEdit();\n            selRecord.set('NEW_VAL', combo.getValue());\n            selRecord.set('NEW_VAL_VIEW', combo.getRawValue());\n          }\n        }\n      };\n    }else if(adjType=='JZZBKM' || adjType=='LJZJTXKM' || adjType=='ZCKM'){\n      temp = {\n        xtype:\"controlpicker\",\n        triggerCls:\"x-form-search-trigger\",\n        listeners:{\n          expand:function(picker,options){\n            Ext.getCmp('kmSeekBtn').fireEvent('click');\n          }\n        },\n        pickComp:{\n          id:'kmPickComp',\n          xtype:\"grid\",\n          height:240,\n          barExportButtons:false,\n          barExportAllButtons:false,\n          forceFit:true,\n          minWidth:420,listeners:{\n            itemclick:function(view, record, item, index, e, options){\n              var accCode = record.get('ACC_CODE');\n              var accName = record.get('ACC_NAME');\n\n              app.subGrid.plugins[0].completeEdit();\n\n              selRecord.set('NEW_VAL', accCode);\n              selRecord.set('NEW_VAL_VIEW', accName);\n\n              //var picker = this.ownerCmp;\n              //picker.collapse();\n            }\n          },\n          store:{\n            url:\"m?xwl=xc/com-lov/ACC_ID_PICK/DB/XC_BG_LD_ACCOUNTS_SELECT_LD\",\n            listeners:{\n              beforeload:function(store,operation,options){\n                store.proxy.extraParams.QUERY_LEDGER_ID = app.LEDGER.getValue();\n                store.proxy.extraParams.QUERY_CODE_NAME = Ext.getCmp('kmSeekCondition').getValue() ;\n              }\n            }\n          },\n          columns:[\n            {hidden:true, width:50, dataIndex:\"ACC_ID\"},\n            {text:\"\", width:100, dataIndex:\"ACC_CODE\", titleAlign:\"center\"},\n            {text:\"\", width:200, dataIndex:\"ACC_NAME\", titleAlign:\"center\"}\n          ],\n          tbar:{\n            xtype:\"toolbar\",\n            items:[\n              {\n                id:'kmSeekCondition',\n                xtype:\"textfield\",\n                emptyText:\"{#kmSeekCondition#}\", listeners:{\n                  specialkey:function(text, e, options){\n                    if(Ext.EventObject.getKey() == 13){\n                      Ext.getCmp('kmSeekBtn').fireEvent('click') ;\n                    }\n                  }\n                }\n              },{\n                id:'kmSeekBtn',\n                xtype:\"button\", \n                iconCls:\"seek_icon\",\n                listeners:{\n                  click:function(button,e,options){\n                    Ext.getCmp('kmPickComp').getStore().load() ;\n                  }\n                }\n              },{\n                xtype:\"button\",\n                iconCls:\"cancel_icon\",\n                listeners:{\n                  click:function(button,e,options){\n                    record.set('NEW_VAL', '');\n                    record.set('NEW_VAL_VIEW', '');\n\n                    Ext.getCmp('kmSeekCondition').setValue('');\n                    Ext.getCmp('kmSeekBtn').fireEvent('click') ;\n                  }\n                }\n              }\n            ]\n          }\n        }\n      };\n    }\n    \n    e.column.setEditor(temp);\n  }else if(e.colIdx == 9){\n    var selRecord = app.subGrid.getStore().getAt(e.rowIdx);\n    var temp = {\n      xtype:\"controlpicker\",\n      triggerCls:\"x-form-search-trigger\",\n      listeners:{\n        expand:function(picker,options){\n          Ext.getCmp('dfkmSeekBtn').fireEvent('click');\n        }\n      },\n      pickComp:{\n        id:'dfkmPickComp',\n        xtype:\"grid\",\n        height:240,\n        barExportButtons:false,\n        barExportAllButtons:false,\n        forceFit:true,\n        minWidth:420,listeners:{\n          itemclick:function(view, record, item, index, e, options){\n            var accCode = record.get('ACC_CODE');\n            var accName = record.get('ACC_NAME');\n\n            app.subGrid.plugins[0].completeEdit();\n\n            selRecord.set('DFKM', accCode);\n            selRecord.set('DFKM_VIEW', accName);\n\n            //var picker = this.ownerCmp;\n            //picker.collapse();\n          }\n        },\n        store:{\n          url:\"m?xwl=xc/com-lov/ACC_ID_PICK/DB/XC_BG_LD_ACCOUNTS_SELECT_LD\",\n          listeners:{\n            beforeload:function(store,operation,options){\n              store.proxy.extraParams.QUERY_LEDGER_ID = app.LEDGER.getValue();\n              store.proxy.extraParams.QUERY_CODE_NAME = Ext.getCmp('dfkmSeekCondition').getValue() ;\n            }\n          }\n        },\n        columns:[\n          {hidden:true, width:50, dataIndex:\"ACC_ID\"},\n          {text:\"\", width:100, dataIndex:\"ACC_CODE\", titleAlign:\"center\"},\n          {text:\"\", width:200, dataIndex:\"ACC_NAME\", titleAlign:\"center\"}\n        ],\n        tbar:{\n          xtype:\"toolbar\",\n          items:[\n            {\n              id:'dfkmSeekCondition',\n              xtype:\"textfield\",\n              emptyText:\"{#kmSeekCondition#}\", listeners:{\n                specialkey:function(text, e, options){\n                  if(Ext.EventObject.getKey() == 13){\n                    Ext.getCmp('dfkmSeekBtn').fireEvent('click') ;\n                  }\n                }\n              }\n            },{\n              id:'dfkmSeekBtn',\n              xtype:\"button\", \n              iconCls:\"seek_icon\",\n              listeners:{\n                click:function(button,e,options){\n                  Ext.getCmp('dfkmPickComp').getStore().load() ;\n                }\n              }\n            },{\n              xtype:\"button\",\n              iconCls:\"cancel_icon\",\n              listeners:{\n                click:function(button,e,options){\n                  selRecord.set('DFKM', '');\n                  selRecord.set('DFKM_VIEW', '');\n\n                  Ext.getCmp('dfkmSeekCondition').setValue('');\n                  Ext.getCmp('dfkmSeekBtn').fireEvent('click') ;\n                }\n              }\n            }\n          ]\n        }\n      }\n    };\n    e.column.setEditor(temp);\n  }else{\n    return true;\n  }\n}"},"children":[{"configs":{"itemId":"columns"},"children":[{"configs":{"width":"40","align":"center","xtype":"rownumberer","titleAlign":"center","itemId":"rowCol"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#zcbmCol#}","width":"180","dataIndex":"ZCBM","itemId":"zcbmCol"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#zcmcCol#}","width":"180","dataIndex":"ZCMC","itemId":"zcmcCol"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#adjTypeCol#}","hidden":"true","width":"180","dataIndex":"ADJ_TYPE","itemId":"adjTypeCol"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#adjTypeCol#}","width":"180","dataIndex":"ADJ_TYPE_VIEW","itemId":"adjTypeViewCol"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#oldValueCol#}","hidden":"true","width":"180","dataIndex":"OLD_VAL","itemId":"oldValueCol"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#oldValueCol#}","width":"180","dataIndex":"OLD_VAL_VIEW","itemId":"oldValueViewCol"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#newValueCol#}","hidden":"true","width":"180","dataIndex":"NEW_VAL","itemId":"newValueCol"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#newValueCol#}","width":"180","dataIndex":"NEW_VAL_VIEW","itemId":"newValueViewCol"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#dfkmCol#}","dataIndex":"DFKM_VIEW","itemId":"dfkmViewCol","flex":"1"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#dfkmCol#}","hidden":"true","width":"180","dataIndex":"DFKM","itemId":"dfkmCol"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"ADJ_D_ID","hidden":"true","dataIndex":"ADJ_D_ID","itemId":"adjDidCol"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"ADJ_H_ID","hidden":"true","dataIndex":"ADJ_H_ID","itemId":"adjHidCol"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"ASSET_ID","hidden":"true","dataIndex":"ASSET_ID","itemId":"assetId"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"VOUCHER_FLAG","hidden":"true","dataIndex":"VOUCHER_FLAG","itemId":"VOUCHER_FLAG"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"store","url":"m?xwl=xc/fa/daily-business/fa-adj/fa-adj-batch/data/getAdjLByCatCode"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}