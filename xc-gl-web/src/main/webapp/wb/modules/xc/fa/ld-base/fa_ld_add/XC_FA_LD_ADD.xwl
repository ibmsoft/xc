{"inframe":false,"title":"资产增加科目设置","hidden":false,"roles":{"default":1},"children":[{"configs":{"loginRequired":"false","serverScript":"request.setAttribute('contextPath',request.getContextPath());\n//---------------------获取当前模块语言对应的.json文件，放到request中----------------\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xc/fa/ld-base/fa_ld_add/XC_FA_LD_ADD\");","itemId":"module"},"children":[{"configs":{"itemId":"windows"},"children":[{"configs":{"height":"500","layout":"border","width":"700","resizable":"true","closeAction":"hide","buttonAlign":"center","dialog":"true","itemId":"win2"},"events":{"ok":"var rec = app.gridsync.getSelection();\nvar ledgerId = app.ledgerIdText.getValue();\nif(rec.length===0){\n  Wb.toast('{#selRecord#}');\n  return;\n}\n\nvar ids = [];\nfor(var i=0;i<rec.length;i++){\n  /*if(rec[i].data.DFKM== '' || rec[i].data.DFKM == null){\n   Wb.toast('{#dfkmnotnull#}');\n    return ;\n  }*/\n  var id = {code:rec[i].data.ADDING_CODE,dfkm:rec[i].data.DFKM,desc:rec[i].data.ADDING_DESC};\n\n  ids.push(id);\n\n}\n\nWb.request({\n\turl:'m?xwl=xc/fa/ld-base/fa_ld_add/data/INSERT_XC_FA_LD_ADD',\n    params:{'LEDGER_ID':ledgerId,'ids':ids},\n    success:function(resp){\n\t\tWb.toast('{#sync#}'+ids.length+'{#record#}');\n        Wb.remove(app.gridsync);\n        win.hide();\n        Wb.reload(app.grid1);\n\t}\n});"},"children":[{"configs":{"labelWidth":"80","hidden":"true","labelAlign":"right","itemId":"ledgerIdText"},"children":[],"expanded":false,"type":"text"},{"configs":{"region":"center","multiSelect":"true","selType":"checkboxmodel","submitSelect":"true","itemId":"gridsync","editable":"true"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/fa/ld-base/fa_ld_add/data/SELECT_XC_FA_LD_ADD"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"序号","align":"center","width":"50","xtype":"rownumberer","titleAlign":"center","itemId":"ROW_NUM_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"ld_adding_id","hidden":"true","dataIndex":"LD_ADDING_ID","titleAlign":"center","itemId":"LD_ADDING_ID_COL1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"ledger_id","hidden":"true","dataIndex":"LEDGER_ID","titleAlign":"center","itemId":"LEDGER_ID_COL1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#Code#}","hidden":"true","width":"200","dataIndex":"ADDING_CODE","titleAlign":"center","itemId":"ADDING_CODE_COL1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#name#}","width":"200","dataIndex":"ADDING_NAME","titleAlign":"center","itemId":"ADDING_NAME_COL1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"dfkmcode","hidden":"true","dataIndex":"DFKM","titleAlign":"center","itemId":"DFKMSAVE_COL1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#DFKM#}","width":"150","dataIndex":"DFKM_NAME","titleAlign":"center","itemId":"DFKM_COL1"},"children":[{"configs":{"normalName":"DFKM_PICK","itemId":"editor"},"events":{"expand":"picker.getPicker().getStore().load({params:{\n\t\tQUERY_LEDGER_ID:app.fa_dl.getValue()\n\t}});"},"children":[{"configs":{"tagConfigs":"minWidth:400","height":"300","barPageButton":"false","barExportButtons":"false","barExportAllButtons":"false","barRefreshButton":"false","itemId":"pickComp"},"events":{"itemdblclick":"var r=app.gridsync.getSelectionModel().getSelection()[0];\nr.set('DFKM',record.data.ACC_CODE);\n\nr.dirty = true;\napp.DFKM_PICK.setValue(record.data.ACC_NAME);\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/com-lov/ACC_ID_PICK/DB/XC_BG_LD_ACCOUNTS_SELECT_LD"},"events":{"beforeload":"// operation.params.QUERY_LEDGER_ID =app.fa_dl.getValue();\nstore.getProxy().extraParams.QUERY_LEDGER_ID = app.ledgerIdText.getValue();\nstore.getProxy().extraParams.QUERY_CODE_NAME  = app.QUERY_CODE_NAME1.getValue();"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","dataIndex":"ACC_ID","itemId":"ACC_ID_COL1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#accountCode#}","dataIndex":"ACC_CODE","itemId":"ACC_CODE_COL1","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#accountName#}","dataIndex":"ACC_NAME","itemId":"ACC_NAME_COL1","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"150","labelAlign":"right","itemId":"QUERY_CODE_NAME1","fieldLabel":"{#accountCodeName#}"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.pickComp.getStore().load();\n}"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"cancelBtn","iconCls":"delete_icon"},"events":{"click":"var rec = app.gridsync.getSelection()[0];\n\nrec.set('DFKM',null);\nrec.set('DFKM_NAME',null);\napp.DFKM_PICK.setValue('');\napp.QUERY_CODE_NAME1.reset();\n\n\n"},"children":[],"expanded":false,"type":"item"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":true,"type":"column"},{"configs":{"text":"{#Desc#}","width":"200","dataIndex":"ADDING_DESC","titleAlign":"center","itemId":"ADDING_DESC_COL1"},"children":[],"expanded":false,"type":"column"}],"expanded":false,"type":"array"}],"expanded":false,"type":"grid"}],"expanded":true,"type":"window"},{"configs":{"height":"150","width":"500","closeAction":"destroy","buttonAlign":"center","dialog":"true","itemId":"win"},"events":{"beforeshow":"\n","show":"//上级\n// app.BG_ITEM_UP_ID.getStore().load({\n//   params:{BG_HRCY_ID:app.bg_hrcy_id.getValue()}\n// });\nif(opType == 'create'){\n  app.ADDING_CODE.setReadOnly(false);\n}else{\n  app.ADDING_CODE.setReadOnly(true);\n}\n"},"children":[{"configs":{"tagConfigs":"{\nbaseCls: 'my-panel-no-border'\n}","layout":"column","margin":"10 0 0 0","itemId":"p1"},"children":[{"configs":{"tagConfigs":"{\n  columnWidth:0.49\n}","labelWidth":"90","allowBlank":"false","labelAlign":"right","itemId":"ADDING_CODE","fieldLabel":"<font color='red'>*<\/font>{#Code#}"},"children":[],"expanded":false,"type":"text"},{"configs":{"tagConfigs":"{\n  columnWidth:0.49\n}","labelWidth":"90","allowBlank":"false","labelAlign":"right","itemId":"DFKM","fieldLabel":"<font color='red'>*<\/font>{#DFKM#}"},"children":[],"expanded":false,"type":"text"}],"expanded":false,"type":"panel"},{"configs":{"tagConfigs":"{\nbaseCls: 'my-panel-no-border'\n}","layout":"column","margin":"10 0 0 0","itemId":"p2"},"children":[{"configs":{"tagConfigs":"{\n  columnWidth:0.98\n}","labelWidth":"90","labelAlign":"right","itemId":"ADDING_DESC","fieldLabel":"{#Desc#}"},"children":[],"expanded":false,"type":"text"}],"expanded":false,"type":"panel"},{"configs":{"tagConfigs":"{\nbaseCls: 'my-panel-no-border'\n}","layout":"column","margin":"10 0 10 0","itemId":"p3"},"children":[{"configs":{"itemId":"LD_ADDING_ID"},"children":[],"expanded":false,"type":"hidden"},{"configs":{"itemId":"LEDGER_ID"},"children":[],"expanded":false,"type":"hidden"}],"expanded":false,"type":"panel"}],"expanded":false,"type":"window"}],"expanded":false,"type":"folder"},{"configs":{"layout":"border","itemId":"viewport1"},"events":{"afterrender":"app.fa_dl.getStore().load(function(){\n  if(app.fa_dl.getStore().getCount()>0){\n    app.fa_dl.setValue(app.fa_dl.getStore().getAt(0).get('ID'));\n    app.queryBtn.fireEvent('click');\n  }\n});"},"children":[{"configs":{"region":"north","itemId":"form1"},"children":[{"configs":{"layout":"column","itemId":"panel1"},"children":[{"configs":{"labelWidth":"120","displayField":"NAME","valueField":"ID","emptyText":"{#please#}","labelAlign":"right","padding":"10 10 10 0","itemId":"fa_dl","fieldLabel":"{#dl#}","editable":"false"},"events":{"select":"\n\napp.queryBtn.fireEvent('click');\n"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/com-qry/gl-ledgers/select-sec-ledger"},"children":[],"expanded":false,"type":"store"}],"expanded":false,"type":"combo"},{"configs":{"text":"{#query#}","hidden":"true","margin":"10 10 10 0","itemId":"queryBtn","iconCls":"seek_icon"},"events":{"click":"app.grid1.store.load({params:{LEDGER_ID:app.fa_dl.getValue()}});\n"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"form"},{"configs":{"region":"center","multiSelect":"true","selType":"checkboxmodel","itemId":"grid1","editable":"true"},"events":{"itemdblclick":"//app.editBtn.fireEvent('click');"},"children":[{"configs":{"autoLoad":"false","itemId":"store","url":"m?xwl=xc/fa/ld-base/fa_ld_add/data/SELECT_XC_FA_LD_ADD_IN"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"{#sync#}","itemId":"syncbtn","iconCls":"file_add_icon"},"events":{"click":"if(app.fa_dl.getValue()===null){\n  Wb.toast('{#selectLedger#}');\n  return false;\n}\n\nvar win = new Ext.window.Window(app._win2); //app._win指向配置对象而非实例\nwin.show();\nwin.setIconCls('record_add_icon');\nWb.setTitle(win, '{#sync#}');\napp.gridsync.store.load({\n  params:{queryBy:app.fa_dl.getValue()}\n});\napp.ledgerIdText.setValue(app.fa_dl.getValue());//ledgerIdText赋值"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#save#}","itemId":"savebtn","iconCls":"save_icon"},"events":{"click":"if (!Wb.verifyGrid(app.grid1)) //验证数据是否合法\n  return;\nWb.sync({\n  grid: app.grid1,\n  url: 'm?xwl=xc/fa/ld-base/fa_ld_add/data/UPDATE_XC_FA_LD_ADD',\n  message: '正在保存中...',\n  success: function(resp) {\n    Wb.reload(app.grid1);\n    Wb.toast('保存成功');\n  }\n});\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#delete#}","itemId":"delBtn","iconCls":"file_delete_icon"},"events":{"click":"\n//使用下面方法用于演示完整的步骤\nvar recs = app.grid1.getSelection();\nif (!recs.length) {\n  Wb.toast('{#selRecord#}');\n  return;\n}\n\n\nWb.confirm('{#confirm#}', function() {\n  Wb.request({\n    url: 'm?xwl=xc/fa/ld-base/fa_ld_add/data/DELETE_XC_FA_LD_ADD',\n    params: {\n      data: Wb.getData(recs)\n    },\n    success: function(resp) {\n      app.queryBtn.fireEvent('click');\n    }\n  });\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#edit#}","hidden":"true","itemId":"editBtn","iconCls":"file_edit_icon"},"events":{"click":"var rec = app.grid1.getSelection()[0];\nif (!rec) {\n  Wb.toast('{#selRecord#}');\n  return;\n}\nopType = 'update';\n\nvar win = new Ext.window.Window(app._win); //app._win指向配置对象而非实例\nwin.show();\nwin.setIconCls('record_edit_icon');\nWb.setTitle(win, '{#edit#}');\nWb.setValue(win, rec.data); //把记录数据应用到窗口\n//窗口每次动态生成,方法在窗口销毁时自动销毁\nwin.mon(win, 'ok', function() {\n  var LD_ADDING_ID = rec.data.LD_ADDING_ID;\n  var LEDGER_ID = app.LEDGER_ID.getValue();\n  var ADDING_CODE = app.ADDING_CODE.getValue();\n  var DFKM = app.DFKM.getValue();\n  var ADDING_DESC= app.ADDING_DESC.getValue();\n\n  var params = {\n                LD_ADDING_ID : LD_ADDING_ID,\n               LEDGER_ID:LEDGER_ID,\n                ADDING_CODE:ADDING_CODE,\n                DFKM:DFKM,\n                ADDING_DESC:ADDING_DESC\n               };\n  \n  Wb.request({\n    url: 'm?xwl=xc/fa/ld-base/fa_ld_add/data/UPDATE_XC_FA_LD_ADD',\n    params: params,\n    success: function(resp) {\n      app.queryBtn.fireEvent('click');\n      win.close(); \n    }\n  });\n});\n"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"序号","align":"center","width":"50","xtype":"rownumberer","titleAlign":"center","itemId":"ROW_NUM_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"ld_adding_id","hidden":"true","dataIndex":"LD_ADDING_ID","titleAlign":"center","itemId":"LD_ADDING_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"ledger_id","hidden":"true","dataIndex":"LEDGER_ID","titleAlign":"center","itemId":"LEDGER_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"code","hidden":"true","width":"150","dataIndex":"ADDING_CODE","titleAlign":"center","itemId":"ADDING_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#name#}","width":"200","dataIndex":"ADDING_NAME","titleAlign":"center","itemId":"ADDING_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","width":"150","dataIndex":"DFKM","titleAlign":"center","itemId":"DFKM_SAVE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#DFKM#}","width":"150","dataIndex":"DFKM_NAME","titleAlign":"center","itemId":"DFKM_NAME_COL"},"children":[{"configs":{"normalName":"DFKM_NAME_PICK","itemId":"editor"},"events":{"expand":"picker.getPicker().getStore().load({params:{\n\t\tQUERY_LEDGER_ID:app.fa_dl.getValue()\n\t}});\n// app.pickComp.getStore().reload({params:{\n// \t\tQUERY_LEDGER_ID:app.fa_dl.getValue()\n// \t}});"},"children":[{"configs":{"tagConfigs":"{\n  minWidth:500\n}","height":"300","barPageButton":"false","barExportAllButtons":"false","barExportButtons":"false","barRefreshButton":"false","itemId":"pickComp"},"events":{"itemdblclick":"var r=app.grid1.getSelectionModel().getSelection()[0];\nr.set('DFKM',record.data.ACC_CODE);\n\nr.dirty = true;\napp.DFKM_NAME_PICK.setValue(record.data.ACC_NAME);\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/com-lov/ACC_ID_PICK/DB/XC_BG_LD_ACCOUNTS_SELECT_LD"},"events":{"beforeload":" //operation.params.QUERY_LEDGER_ID =app.fa_dl.getValue();\n\nstore.getProxy().extraParams.QUERY_LEDGER_ID = app.fa_dl.getValue();\nstore.getProxy().extraParams.QUERY_CODE_NAME  = app.QUERY_CODE_NAME.getValue();"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","dataIndex":"ACC_ID","itemId":"ACC_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#accountCode#}","dataIndex":"ACC_CODE","itemId":"ACC_CODE_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#accountName#}","dataIndex":"ACC_NAME","itemId":"ACC_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"150","labelAlign":"right","itemId":"QUERY_CODE_NAME","fieldLabel":"{#accountCodeName#}"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.pickComp.getStore().load();\n}"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"cancelBtn","iconCls":"delete_icon"},"events":{"click":"var rec = app.grid1.getSelection()[0];\n\nrec.set('DFKM',null);\nrec.set('DFKM_NAME',null);\napp.DFKM_NAME_PICK.setValue('');\napp.QUERY_CODE_NAME.reset();\n\napp.pickComp.getStore().load();"},"children":[],"expanded":false,"type":"item"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":true,"type":"column"},{"configs":{"text":"{#Desc#}","width":"300","dataIndex":"ADDING_DESC","titleAlign":"center","itemId":"ADDING_DESC_COL"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}