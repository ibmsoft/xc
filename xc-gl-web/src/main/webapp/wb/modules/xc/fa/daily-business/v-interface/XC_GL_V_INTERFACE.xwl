{"inframe":false,"title":"会计平台","hidden":false,"roles":{"default":1},"children":[{"configs":{"serverScript":"//---------------------获取当前模块语言对应的.json文件，放到request中----------------\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xc/fa/daily-business/v-interface/XC_GL_V_INTERFACE\");\n\nvar userObj = request.getSession().getAttribute(\"XzSessionVars\");\nif(userObj !== null){\n  var userId = request.getSession().getAttribute(\"XzSessionVars\").get('userId');\n  request.setAttribute(\"userId\",userId);\n}\n\nrequest.setAttribute(\"contextPath\", request.getContextPath());","itemId":"module"},"events":{"initialize":"function getLastDay(year,month) {        \n  var new_year = year;    //取当前的年份         \n  var new_month = month++;//取下一个月的第一天，方便计算（最后一天不固定）         \n  if(month>12) {        \n    new_month -=12;        //月份减         \n    new_year++;            //年份增         \n  }        \n  var new_date = new Date(new_year,new_month,1);                //取当年当月中的第一天         \n  return (new Date(new_date.getTime()-1000*60*60*24)).getDate();//获取当月最后一天日期         \n}  "},"children":[{"configs":{"title":"{#generateWin#}","height":"300","width":"500","layout":"border","closeAction":"hide","buttonAlign":"center","itemId":"generateWin","modal":"true"},"events":{"show":"app.combCr.setValue(false);\napp.combDr.setValue(false);\napp.combSummary.setValue('');\napp.generateDate.setValue(new Date());","close":"app.queryWrzBtn.fireEvent('click');"},"children":[{"configs":{"itemId":"buttons"},"children":[{"configs":{"text":"{#ensureBtn#}","itemId":"ensureBtn","iconCls":"ok_icon"},"events":{"click":"var selRecords = app.wrzGrid.getSelection();\nvar saveJson = {};\n\nif(Ext.isEmpty(app.combSummary.getValue())){\n  Wb.toast('{#combSummary#}'+'{#notNull#}');\n  return;\n}\n\n// 查询凭证分类编码\nExt.Ajax.request({\n  url: 'm?xwl=xc/fa/daily-business/v-interface/data/getCategoryCode',\n  method: 'POST',\n  params:{},\n  async:false,\n  success: function(response,options){\n    var temp = response.responseText;\n    var resp = Ext.JSON.decode(temp);\n    \n    saveJson.categoryCode = resp.V_CATEGORY_CODE;\n  },\n  failure: function(response,options){\n    Ext.Msg.hide();\n    Wb.error('{#syncFailureMsg#}');\n  }\n});\n\nvar glInterfaceIds = '';\nvar drAmt = 0;\nvar crAmt = 0;\nvar glInterfaceIdArray = new Array();\n\nsaveJson.ledgerCode = selRecords[0].get('LEDGER_CODE');\nsaveJson.periodCode = selRecords[0].get('PERIOD_CODE');\nsaveJson.srcCode = 'XC_FA';\nif('{#MODULE#}' == 'ST')\n    saveJson.srcCode = 'XC_ST';\nsaveJson.summary = app.combSummary.getValue();\nsaveJson.templateType = '1';\nsaveJson.vStatus = '1';\nsaveJson.createdBy = '{#userId#}';\n\n//如果当前时间没有在所在期间下，则取期间的最后一天，否则取当前日期\nvar periodCode = selRecords[0].get('PERIOD_CODE');\nif(periodCode==app.generateDate.getRawValue().substring(0,7)){\n  saveJson.creationDate = app.generateDate.getRawValue();\n}else{\n  saveJson.creationDate = periodCode + '-' +getLastDay(Number(periodCode.substring(0, 4)), Number(periodCode.substring(5, 7)));\n}\n\nvar orderNum = 0;\nvar lines = [];\n\n// 借方行记\nif(app.combDr.getValue()===true){\n  var hasOperateRecord = [];\n  for(var i=0; i<selRecords.length; i++){\n    var iRecord = selRecords[i];\n    if(!Ext.Array.contains(hasOperateRecord, iRecord)){\n      var drJson = {};\n      drJson.summary = app.combSummary.getValue();\n      drJson.ccid = iRecord.get('DR_CCID');\n      drJson.accCode = iRecord.get('DR_ACCT');\n      if(!Ext.isEmpty(selRecords[i].get('DEPT_CODE'))){\n        drJson.deptCode = selRecords[i].get('DEPT_CODE');\n      }\n      if(!Ext.isEmpty(selRecords[i].get('PROJECT_CODE'))){\n        drJson.prjCode = selRecords[i].get('PROJECT_CODE');\n      }\n      drJson.enterDR = Ext.isEmpty(iRecord.get('AMT'))?0:Number(iRecord.get('AMT'));\n      drJson.accountDR = drJson.enterDR;\n      drJson.orderBy = ++orderNum;\n      if(!Ext.Array.contains(glInterfaceIdArray, iRecord.get('V_INTERFACE_ID'))){\n        glInterfaceIdArray.push(iRecord.get('V_INTERFACE_ID'));\n      }\n      \n      var drJsonAmt = Ext.isEmpty(iRecord.get('AMT'))?0:Number(iRecord.get('AMT'));\n\n      for(var j=0; j<selRecords.length; j++){\n        var jRecord = selRecords[j];\n\n        if(!Ext.Array.contains(hasOperateRecord, jRecord) && iRecord!=jRecord){\n          if(iRecord.get('DR_CCID') == jRecord.get('DR_CCID')){\n            //drJson.enterDR = drJson.enterDR + Ext.isEmpty(jRecord.get('AMT'))?0:Number(jRecord.get('AMT'));\n            //drJson.accountDR = drJson.enterDR;\n            var _drJsonAmt = Ext.isEmpty(jRecord.get('AMT'))?0:Number(jRecord.get('AMT'));\n            drJsonAmt = drJsonAmt + _drJsonAmt;\n            if(!Ext.Array.contains(glInterfaceIdArray, jRecord.get('V_INTERFACE_ID'))){\n              glInterfaceIdArray.push(jRecord.get('V_INTERFACE_ID'));\n            }\n\n            hasOperateRecord.push(jRecord);\n          }\n        }\n      }\n      hasOperateRecord.push(iRecord);\n      drJson.enterDR = drJsonAmt;\n      drJson.accountDR = drJsonAmt;\n      \n      if(drJson.enterDR!=0){\n        lines.push(drJson);\n      }\n      \n      if(!Ext.isEmpty(drJson.enterDR)){\n        drAmt = drAmt + Number(drJson.enterDR);\n      }\n    }\n  }\n}else{\n  for(var i=0; i<selRecords.length; i++){\n    if(Ext.isEmpty(selRecords[i].get('DR_CCID')) && Ext.isEmpty(selRecords[i].get('DR_ACCT'))){\n      continue;\n    }\n    var drJson = {};\n    drJson.summary = selRecords[i].get('SUMMARY');\n    drJson.ccid = selRecords[i].get('DR_CCID');\n    drJson.accCode = selRecords[i].get('DR_ACCT');\n    if(!Ext.isEmpty(selRecords[i].get('DEPT_CODE'))){\n      drJson.deptCode = selRecords[i].get('DEPT_CODE');\n    }\n    if(!Ext.isEmpty(selRecords[i].get('PROJECT_CODE'))){\n      drJson.prjCode = selRecords[i].get('PROJECT_CODE');\n    }\n    drJson.enterDR = selRecords[i].get('AMT');\n    drJson.accountDR = selRecords[i].get('AMT');\n    drJson.orderBy = ++orderNum;\n\n    lines.push(drJson);\n    if(!Ext.isEmpty(selRecords[i].get('AMT'))){\n      drAmt = drAmt + Number(selRecords[i].get('AMT'));\n    }\n    if(!Ext.Array.contains(glInterfaceIdArray, selRecords[i].get('V_INTERFACE_ID'))){\n      glInterfaceIdArray.push(selRecords[i].get('V_INTERFACE_ID'));\n    }\n  }\n}\n\n// 贷方行\nif(app.combCr.getValue()===true){\n  var hasOperateRecord = [];\n  for(var i=0; i<selRecords.length; i++){\n    var iRecord = selRecords[i];\n    if(!Ext.Array.contains(hasOperateRecord, iRecord)){\n      var crJson = {};\n      //存在科目组合id时科目、成本中心、项目不用传，当科目组合不存在时传科目、成本中心、项目\n      crJson.summary = app.combSummary.getValue();\n      crJson.ccid = iRecord.get('CR_CCID');\n      crJson.accCode = selRecords[i].get('CR_ACCT');\n      if(!Ext.isEmpty(selRecords[i].get('DEPT_CODE'))){\n        crJson.deptCode = selRecords[i].get('DEPT_CODE');\n      }\n      if(!Ext.isEmpty(selRecords[i].get('PROJECT_CODE'))){\n        crJson.prjCode = selRecords[i].get('PROJECT_CODE');\n      }\n      crJson.enterCR = Ext.isEmpty(iRecord.get('AMT'))?0:Number(iRecord.get('AMT'));\n      crJson.accountCR = crJson.enterCR;\n      crJson.orderBy = ++orderNum;\n      if(!Ext.Array.contains(glInterfaceIdArray, iRecord.get('V_INTERFACE_ID'))){\n        glInterfaceIdArray.push(iRecord.get('V_INTERFACE_ID'));\n      }\n      \n      var crJsonAmt = Ext.isEmpty(iRecord.get('AMT'))?0:Number(iRecord.get('AMT'));\n\n      for(var j=0; j<selRecords.length; j++){\n        var jRecord = selRecords[j];\n\n        if(!Ext.Array.contains(hasOperateRecord, jRecord) && iRecord!=jRecord){\n          if(iRecord.get('CR_CCID') == jRecord.get('CR_CCID')){\n            //crJson.enterCR = crJson.enterCR + Ext.isEmpty(jRecord.get('AMT'))?0:Number(jRecord.get('AMT'));\n            //crJson.accountCR = crJson.enterCR;\n            var _crJsonAmt = Ext.isEmpty(jRecord.get('AMT'))?0:Number(jRecord.get('AMT'));\n            crJsonAmt = crJsonAmt + _crJsonAmt;\n            if(!Ext.Array.contains(glInterfaceIdArray, jRecord.get('V_INTERFACE_ID'))){\n              glInterfaceIdArray.push(jRecord.get('V_INTERFACE_ID'));\n            }\n\n            hasOperateRecord.push(jRecord);\n          }\n        }\n      }\n      hasOperateRecord.push(iRecord);\n      crJson.enterCR = crJsonAmt;\n      crJson.accountCR = crJsonAmt;\n      \n      if(crJson.enterCR!=0){\n        lines.push(crJson);\n      }\n      \n      if(!Ext.isEmpty(crJson.enterCR)){\n        crAmt = crAmt + Number(crJson.enterCR);\n      }\n    }\n  }\n}else{\n  for(var i=0; i<selRecords.length; i++){\n    if(Ext.isEmpty(selRecords[i].get('CR_CCID')) && Ext.isEmpty(selRecords[i].get('CR_ACCT'))){\n      continue;\n    }\n    var crJson = {};\n    crJson.summary = selRecords[i].get('SUMMARY');\n    crJson.ccid = selRecords[i].get('CR_CCID');\n    crJson.accCode = selRecords[i].get('CR_ACCT');\n    if(!Ext.isEmpty(selRecords[i].get('DEPT_CODE'))){\n      crJson.deptCode = selRecords[i].get('DEPT_CODE');\n    }\n    if(!Ext.isEmpty(selRecords[i].get('PROJECT_CODE'))){\n      crJson.prjCode = selRecords[i].get('PROJECT_CODE');\n    }\n    crJson.enterCR = selRecords[i].get('AMT');\n    crJson.accountCR = selRecords[i].get('AMT');\n    crJson.orderBy = ++orderNum;\n    \n    if(!Ext.isEmpty(selRecords[i].get('AMT'))){\n      crAmt = crAmt + Number(selRecords[i].get('AMT'));\n    }\n    if(!Ext.Array.contains(glInterfaceIdArray, selRecords[i].get('V_INTERFACE_ID'))){\n      glInterfaceIdArray.push(selRecords[i].get('V_INTERFACE_ID'));\n    }\n    lines.push(crJson);\n  }\n}\nsaveJson.lines = lines;\n\nvar glInterfaceHead = {};\nglInterfaceHead.I_HEAD_ID = '';\nglInterfaceHead.LEDGER_ID = selRecords[0].get('LEDGER_ID');\nglInterfaceHead.PERIOD_CODE = selRecords[0].get('PERIOD_CODE');\nglInterfaceHead.DR_AMT = drAmt;\nglInterfaceHead.CR_AMT = crAmt;\nglInterfaceHead.SUMMARY = app.combSummary.getValue();\n\nfor(var i=0; i<glInterfaceIdArray.length; i++){\n  glInterfaceIds = glInterfaceIds + \"'\" + glInterfaceIdArray[i] + \"',\";\n}\nif(Ext.isEmpty(glInterfaceIds)){\n  glInterfaceIds = \"''\";\n}else{\n  glInterfaceIds = glInterfaceIds.substring(0, glInterfaceIds.length-1);\n}\n\n// 提交ajax请求\nExt.Msg.wait('{#saveWaitMsg#}');\n\nExt.Ajax.request({\n  url: '{#contextPath#}' + '/glInterfaceAction.do?method=saveGlInterface',\n  method: 'POST',\n  timeout: 300000,\n  params:{\n    glInterface: Ext.JSON.encode(saveJson),\n    glInterfaceIds: glInterfaceIds,\n    glInterfaceHead: Ext.JSON.encode(glInterfaceHead)\n  },\n  success: function(res, opts) {\n    Ext.Msg.hide();\n\n    var temp = res.responseText;\n    var resp = Ext.JSON.decode(temp);\n\n    if(resp.flag == 0){\n      Wb.toast('{#saveSuccessMsg#}');\n      app.wrzGrid.getStore().load();\n      app.rzGrid.getStore().load();\n      app.generateWin.close();\n    }else{\n      Wb.error(resp.msg);\n    }\n  },\n  failure: function(res, opts) {\n    Ext.Msg.hide();\n    Wb.error('{#saveFailureMsg#}');\n  }\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#cancelBtn#}","itemId":"cancelBtn","iconCls":"cancel_icon"},"events":{"click":"app.generateWin.close();"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"array"},{"configs":{"region":"center","bodyPadding":"4 0 0 0","itemId":"generatePanel"},"children":[{"configs":{"height":"40","style":"border-width:0px;","layout":"column","bodyPadding":"0 0 0 88","border":"false","itemId":"t1"},"children":[{"configs":{"style":"border-width:0px;","layout":"form","columnWidth":".5","border":"false","itemId":"d1"},"children":[{"configs":{"itemId":"combDr","boxLabel":"{#combDr#}"},"children":[],"expanded":false,"type":"check"}],"expanded":true,"type":"panel"},{"configs":{"style":"border-width:0px;","layout":"form","columnWidth":".5","border":"false","itemId":"d2"},"children":[{"configs":{"itemId":"combCr","boxLabel":"{#combCr#}"},"children":[],"expanded":false,"type":"check"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"height":"180","style":"border-width:0px;","layout":"fit","bodyPadding":"0 10 0 0","border":"false","itemId":"t2"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"combSummary","fieldLabel":"{#combSummary#}<font color=\"red\">*<\/font>"},"children":[],"expanded":false,"type":"textarea"},{"configs":{"style":"border-width:0px;","layout":"form","columnWidth":".8","border":"false","itemId":"d1"},"children":[{"configs":{"hidden":"true","itemId":"generateDate"},"children":[],"expanded":false,"type":"date"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"window"},{"configs":{"height":"300","width":"800","layout":"border","closeAction":"hide","buttonAlign":"center","itemId":"rzSubWin","modal":"true"},"events":{"show":"app.combCr.setValue(false);\napp.combDr.setValue(false);\napp.combSummary.setValue('');\napp.generateDate.setValue(new Date());"},"children":[{"configs":{"itemId":"buttons"},"children":[{"configs":{"text":"{#cancelBtn#}","itemId":"cancelBtn","iconCls":"cancel_icon"},"events":{"click":"app.rzSubWin.close();"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"array"},{"configs":{"region":"center","selType":"checkboxmodel","itemId":"rzSubGrid","enableColumnMove":"false","editable":"true"},"events":{"tagEvents":"/*cellclick: function(tab, td, cellIndex, record, tr, rowIndex, e, OeOpts){\n  var canEditCols = record.get('CAN_EDIT_COLS');\n\n  if(!Ext.isEmpty(canEditCols)){\n    if(cellIndex==8){\n      if(canEditCols.indexOf('DEPT_ID')!=-1){\n        return true;\n      }\n    }else if(cellIndex==10){\n      if(canEditCols.indexOf('PROJECT_ID')!=-1){\n        return true;\n      }\n    }else if(cellIndex==14){\n      if(canEditCols.indexOf('DR_CCID')!=-1){\n        return true;\n      }\n    }else if(cellIndex==18){\n      if(canEditCols.indexOf('CR_CCID')!=-1){\n        return true;\n      }\n    }else if(cellIndex==20){\n      if(canEditCols.indexOf('SUMMARY')!=-1){\n        return true;\n      }\n    }\n    return false;\n  }\n  return false;\n}*/"},"children":[{"configs":{"pageSize":"-1","autoLoad":"false","itemId":"store","url":"m?xwl=xc/fa/daily-business/v-interface/data/getRzSub"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"width":"40","align":"center","xtype":"rownumberer","titleAlign":"center","itemId":"rowCol"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#ledgerNameCol#}","hidden":"true","width":"180","dataIndex":"LEDGER_ID","itemId":"ledgerIdCol"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#ledgerNameCol#}","width":"180","dataIndex":"LEDGER_NAME","itemId":"ledgerNameCol"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#periodCodeCol#}","width":"80","dataIndex":"PERIOD_CODE","itemId":"periodCodeCol"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#transNamecCol#}","hidden":"true","dataIndex":"TRANS_CODE","itemId":"transCodecCol"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#transNamecCol#}","dataIndex":"TRANS_NAME","itemId":"transNamecCol"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#deptNameCol#}","hidden":"true","dataIndex":"DEPT_ID","itemId":"deptIdCol"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#deptNameCol#}","width":"150","dataIndex":"DEPT_NAME","itemId":"deptNameCol"},"children":[{"configs":{"labelWidth":"120","triggerCls":"x-form-search-trigger","labelAlign":"right","itemId":"editor","fieldLabel":"{#cbzx#}","editable":"false"},"events":{"expand":"app.findLdDepts.fireEvent('click') ;"},"children":[{"configs":{"tagConfigs":"minWidth:420","height":"240","barExportAllButtons":"false","barExportButtons":"false","itemId":"pickComp","forceFit":"true"},"events":{"itemclick":"// 选择成本中心\nvar deptId = record.get('DEPT_ID');\nvar deptName = record.get('DEPT_NAME');\n\nvar selRecord = app.wrzGrid.getSelection()[0];\n\nselRecord.set('DEPT_ID', deptId);\nselRecord.set('DEPT_NAME', deptName);\n\nselRecord.set('PROJECT_ID', '');\nselRecord.set('PROJECT_NAME', '');\n\n// app.pickComp.hide() ;\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/fa/common/FA_INFO_PANEL/data/getDepts"},"events":{"beforeload":"store.proxy.extraParams.textStr = app.deptCodeOrName.getValue() ;"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","width":"50","dataIndex":"DEPT_ID","titleAlign":"center","itemId":"DEPT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#DEPT_CODE#}","width":"100","dataIndex":"DEPT_CODE","titleAlign":"center","itemId":"DEPT_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#DEPT_NAME#}","width":"200","dataIndex":"DEPT_NAME","titleAlign":"center","itemId":"DEPT_NAME_COL"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"emptyText":"按编码或名称进行查询","itemId":"deptCodeOrName"},"events":{"specialkey":"if(Ext.EventObject.getKey() == 13){\n  app.findLdDepts.fireEvent('click') ;\n}"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"findLdDepts","iconCls":"seek_icon"},"events":{"click":"// TODO: 加载成本中心\napp.pickComp.getStore().load() ;"},"children":[],"expanded":false,"type":"button"},{"configs":{"itemId":"clearLdDepts","iconCls":"cancel_icon","tooltip":"清空已选择的数据"},"events":{"click":"app.CBZX.setValue();\napp.CBZX_NAME.setValue() ;\napp.deptCodeOrName.setValue() ;\napp.findLdDepts.fireEvent('click') ;"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":false,"type":"picker"}],"expanded":false,"type":"column"},{"configs":{"text":"{#projectNameCol#}","hidden":"true","dataIndex":"PROJECT_ID","itemId":"projectIdCol"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#projectNameCol#}","width":"180","dataIndex":"PROJECT_NAME","itemId":"projectNameCol"},"children":[{"configs":{"labelWidth":"120","triggerCls":"x-form-search-trigger","labelAlign":"right","itemId":"editor"},"events":{"expand":"app.findLdExItems.fireEvent('click') ;"},"children":[{"configs":{"tagConfigs":"minWidth:420","height":"240","barExportAllButtons":"false","barExportButtons":"false","itemId":"pickComp","forceFit":"true"},"events":{"itemclick":"var projectId = record.get('PROJECT_ID') ;\nvar projectName = record.get('PROJECT_NAME') ;\n\nvar selRecord = app.wrzGrid.getSelection()[0];\n\nselRecord.set('PROJECT_ID', '');\nselRecord.set('PROJECT_NAME', '');\n\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/fa/common/FA_INFO_PANEL/data/getProject"},"events":{"beforeload":"store.proxy.extraParams.LEDGER_ID = app.rzGrid.getSelection()[0].get('PROJECT_ID');\nstore.proxy.extraParams.textStr = app.exItemCodeOrName.getValue() ;"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","width":"50","dataIndex":"PROJECT_ID","itemId":"PROJECT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#PROJECT_CODE#}","width":"100","dataIndex":"PROJECT_CODE","titleAlign":"center","itemId":"PROJECT_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#PROJECT_NAME#}","width":"200","dataIndex":"PROJECT_NAME","titleAlign":"center","itemId":"PROJECT_NAME_COL"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"emptyText":"按编码或名称进行查询","itemId":"exItemCodeOrName"},"events":{"specialkey":"if(Ext.EventObject.getKey() == 13){\n  app.findLdExItems.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"findLdExItems","iconCls":"seek_icon"},"events":{"click":"app.pickComp.getStore().load() ;"},"children":[],"expanded":false,"type":"button"},{"configs":{"itemId":"clearLdExItems","iconCls":"cancel_icon","tooltip":"清空已选择的数据"},"events":{"click":"// TODO: 清空费用项目\napp.PROJECT_ID.setValue() ;\napp.PROJECT_NAME.setValue() ;\napp.exItemCodeOrName.setValue('');\napp.findLdExItems.fireEvent('click') ;"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":false,"type":"column"},{"configs":{"text":"{#drAcctNameCol#}","hidden":"true","dataIndex":"DR_ACCT","itemId":"drAcctCol"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#drAcctNameCol#}","width":"180","dataIndex":"DR_ACCT_NAME","itemId":"drAcctNameCol"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#drCcidNameCol#}","hidden":"true","dataIndex":"DR_CCID","itemId":"drCcidCol"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#drCcidNameCol#}","width":"180","dataIndex":"DR_CCID_NAME","itemId":"drCcidNameCol"},"children":[{"configs":{"displayField":"ACC_NAME","triggerCls":"x-form-search-trigger","valueField":"ACC_ID","itemId":"editor","onTriggerClick":"var selRecord = app.rzGrid.getSelection()[0];\n\n// 账簿\nvar ledgerId = selRecord.get('LEDGER_ID');\nif(ledgerId === \"\" ||ledgerId === null || ledgerId === undefined){\n  Wb.info('{#selectLedgerFirst#}') ;\n  return false ;\n}\n\n// 期间\nvar period = selRecord.get('PERIOD_CODE');\nif(period === \"\" || period === null || period === undefined){\n  Wb.info('{#selectPeriodFirst#}') ;\n  return false ;\n}\n\nvar accName = Ext.isEmpty(selRecord.get('DR_CCID_NAME')) ? (Ext.isEmpty(selRecord.get('DR_ACCT_NAME')) ? '' : selRecord.get('DR_ACCT_NAME')) : selRecord.get('DR_CCID_NAME');\nvar ccid = Ext.isEmpty(selRecord.get('DR_CCID')) ? '' : selRecord.get('DR_CCID');\n\nWb.run({\n  url:'m?xwl=xc/gl/journal/v-windows/handler-ccid-win',\n  params : {\n    'ledgerId'   : ledgerId,\n    'periodCode' : period,\n    'vtype'      : 'normal'\n  },          \n  success:function(appObj){\n    appObj.initWindow({\n      accName : accName,\n      ledgerId : ledgerId,\n      periodCode : period ,\n      caId : '',\t// 现金流量项信息\n      ccid : ccid,\n      bgInfo : {} , // 预算信息\n      groupId : 'ALL',\n      handlerCCID : function(returnObj){\n        // TODO: 处理CCID信息\n        var rObj = Wb.decode(returnObj) ;\n        selRecord.set('DR_CCID', rObj.acc_ccid) ;    \n        selRecord.set('DR_CCID_NAME', rObj.acc_ccid_name);\n      }\n    });\n  }  \n}) ;   "},"events":{"beforequery":"var combo = e.combo;\nif(!e.forceAll){\n  var value = e.query;\n  combo.store.filterBy(function(record,id){\n    var text = record.get(combo.displayField);\n    return (text.indexOf(value)!=-1);\n  });\n  combo.expand();\n  return false;\n}","specialkey":"var selRecord = app.rzGrid.getSelection()[0];\n\n// 账簿\nvar ledgerId = selRecord.get('LEDGER_ID');\nif(ledgerId === \"\" ||ledgerId === null || ledgerId === undefined){\n  Wb.info('{#selectLedgerFirst#}') ;\n  return false ;\n}\n\n// 期间\nvar period = selRecord.get('PERIOD_CODE');\nif(period === \"\" || period === null || period === undefined){\n  Wb.info('{#selectPeriodFirst#}') ;\n  return false ;\n}\n\nvar accName = Ext.isEmpty(selRecord.get('DR_CCID_NAME')) ? (Ext.isEmpty(selRecord.get('DR_ACCT_NAME')) ? '' : selRecord.get('DR_ACCT_NAME')) : selRecord.get('DR_CCID_NAME');\nvar ccid = Ext.isEmpty(selRecord.get('DR_CCID')) ? '' : selRecord.get('DR_CCID');\n\nWb.run({\n  url:'m?xwl=xc/gl/journal/v-windows/handler-ccid-win',\n  params : {\n    'ledgerId'   : ledgerId,\n    'periodCode' : period,\n    'vtype'      : 'normal'\n  },          \n  success:function(appObj){\n    appObj.initWindow({\n      accName : accName,\n      ledgerId : ledgerId,\n      periodCode : period ,\n      caId : '',\t// 现金流量项信息\n      ccid : ccid,\n      bgInfo : {} , // 预算信息\n      groupId : 'ALL',\n      handlerCCID : function(returnObj){\n        // TODO: 处理CCID信息\n        var rObj = Wb.decode(returnObj) ;\n        selRecord.set('DR_CCID', rObj.acc_ccid) ;    \n        selRecord.set('DR_CCID_NAME', rObj.acc_ccid_name);\n      }\n    });\n  }  \n}) ;   "},"children":[],"expanded":true,"type":"combo"}],"expanded":false,"type":"column"},{"configs":{"text":"{#crAcctNameCol#}","hidden":"true","dataIndex":"CR_ACCT","itemId":"crAcctCol"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#crAcctNameCol#}","width":"180","dataIndex":"CR_ACCT_NAME","itemId":"crAcctNameCol"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#crCcidNameCol#}","hidden":"true","dataIndex":"CR_CCID","itemId":"crCcidCol"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#crCcidNameCol#}","width":"180","dataIndex":"CR_CCID_NAME","itemId":"crCcidNameCol"},"children":[{"configs":{"displayField":"ACC_NAME","triggerCls":"x-form-search-trigger","valueField":"ACC_ID","itemId":"editor","onTriggerClick":"var selRecord = app.rzGrid.getSelection()[0];\n\n// 账簿\nvar ledgerId = selRecord.get('LEDGER_ID');\nif(ledgerId === \"\" ||ledgerId === null || ledgerId === undefined){\n  Wb.info('{#selectLedgerFirst#}') ;\n  return false ;\n}\n\n// 期间\nvar period = selRecord.get('PERIOD_CODE');\nif(period === \"\" || period === null || period === undefined){\n  Wb.info('{#selectPeriodFirst#}') ;\n  return false ;\n}\n\nvar accName = Ext.isEmpty(selRecord.get('CR_CCID_NAME')) ? (Ext.isEmpty(selRecord.get('CR_ACCT_NAME')) ? '' : selRecord.get('CR_ACCT_NAME')) : selRecord.get('CR_CCID_NAME');\nvar ccid = Ext.isEmpty(selRecord.get('CR_CCID')) ? '' : selRecord.get('CR_CCID');\n\nWb.run({\n  url:'m?xwl=xc/gl/journal/v-windows/handler-ccid-win',\n  params : {\n    'ledgerId'   : ledgerId,\n    'periodCode' : period,\n    'vtype'      : 'normal'\n  },          \n  success:function(appObj){\n    appObj.initWindow({\n      accName : accName,\n      ledgerId : ledgerId,\n      periodCode : period ,\n      caId : '',\t// 现金流量项信息\n      ccid : ccid,\n      bgInfo : {} , // 预算信息\n      groupId : 'ALL',\n      handlerCCID : function(returnObj){\n        // TODO: 处理CCID信息\n        var rObj = Wb.decode(returnObj) ;\n        selRecord.set('CR_CCID', rObj.acc_ccid) ;    \n        selRecord.set('CR_CCID_NAME', rObj.acc_ccid_name);\n      }\n    });\n  }  \n});"},"events":{"beforequery":"var combo = e.combo;\nif(!e.forceAll){\n  var value = e.query;\n  combo.store.filterBy(function(record,id){\n    var text = record.get(combo.displayField);\n    return (text.indexOf(value)!=-1);\n  });\n  combo.expand();\n  return false;\n}","specialkey":"var selRecord = app.rzGrid.getSelection()[0];\n\n// 账簿\nvar ledgerId = selRecord.get('LEDGER_ID');\nif(ledgerId === \"\" ||ledgerId === null || ledgerId === undefined){\n  Wb.info('{#selectLedgerFirst#}') ;\n  return false ;\n}\n\n// 期间\nvar period = selRecord.get('PERIOD_CODE');\nif(period === \"\" || period === null || period === undefined){\n  Wb.info('{#selectPeriodFirst#}') ;\n  return false ;\n}\n\nvar accName = Ext.isEmpty(selRecord.get('CR_CCID_NAME')) ? (Ext.isEmpty(selRecord.get('CR_ACCT_NAME')) ? '' : selRecord.get('CR_ACCT_NAME')) : selRecord.get('CR_CCID_NAME');\nvar ccid = Ext.isEmpty(selRecord.get('CR_CCID')) ? '' : selRecord.get('CR_CCID');\n\nWb.run({\n  url:'m?xwl=xc/gl/journal/v-windows/handler-ccid-win',\n  params : {\n    'ledgerId'   : ledgerId,\n    'periodCode' : period,\n    'vtype'      : 'normal'\n  },          \n  success:function(appObj){\n    appObj.initWindow({\n      accName : accName,\n      ledgerId : ledgerId,\n      periodCode : period ,\n      caId : '',\t// 现金流量项信息\n      ccid : ccid,\n      bgInfo : {} , // 预算信息\n      groupId : 'ALL',\n      handlerCCID : function(returnObj){\n        // TODO: 处理CCID信息\n        var rObj = Wb.decode(returnObj) ;\n        selRecord.set('CR_CCID', rObj.acc_ccid) ;    \n        selRecord.set('CR_CCID_NAME', rObj.acc_ccid_name);\n      }\n    });\n  }  \n}) ;"},"children":[],"expanded":true,"type":"combo"}],"expanded":false,"type":"column"},{"configs":{"text":"{#amtCol#}","width":"150","align":"right","dataIndex":"AMT","format":"00,000.00","titleAlign":"left","itemId":"amtCol"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#summaryCol#}","width":"200","dataIndex":"SUMMARY","itemId":"summaryCol"},"children":[{"configs":{"itemId":"editor"},"children":[],"expanded":false,"type":"text"}],"expanded":false,"type":"column"},{"configs":{"text":"{#busNoCol#}","width":"150","dataIndex":"BUS_NO","itemId":"busNoCol"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"V_INTERFACE_ID","hidden":"true","dataIndex":"V_INTERFACE_ID","itemId":"interfaceIdCol"},"children":[],"expanded":false,"type":"column"}],"expanded":false,"type":"array"},{"configs":{"hidden":"true","itemId":"tbar"},"children":[{"configs":{"text":"{#viewSubBtn#}","itemId":"viewSubBtn"},"events":{"click":"var selRecords = app.rzGrid.getSelection();\n\nif(selRecords.length==0 || selRecords.length>1){\n  Wb.toast('{#viewSubSelCheck#}');\n  return;\n}\n\nvar iHeadId = selRecords[0].get('I_HEAD_ID');"},"children":[],"expanded":false,"type":"item"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":false,"type":"window"},{"configs":{"layout":"fit","itemId":"viewport"},"events":{"afterrender":"app.queryWrzLedger.getStore().load(function(){\n  if(app.queryWrzLedger.getStore().getCount()>0){\n    app.queryWrzLedger.setValue(app.queryWrzLedger.getStore().getAt(0).get('ID'));\n    app.queryWrzBtn.fireEvent('click');\n  }\n});\n\napp.queryRzLedger.getStore().load(function(){\n  if(app.queryRzLedger.getStore().getCount()>0){\n    app.queryRzLedger.setValue(app.queryRzLedger.getStore().getAt(0).get('ID'));\n    app.queryRzLedger.fireEvent('click');\n  }\n});"},"children":[{"configs":{"itemId":"tabPanel"},"events":{"tabchange":"if(app.tabPanel.getActiveTab()==app.wrzPanel){\n  app.queryWrzBtn.fireEvent('click');\n}"},"children":[{"configs":{"title":"{#wrzPanel#}","layout":"border","itemId":"wrzPanel"},"children":[{"configs":{"region":"north","height":"45","layout":"column","bodyPadding":"10 0 0 20","itemId":"queryWrzPanel"},"children":[{"configs":{"labelWidth":"60","displayField":"NAME","width":"180","valueField":"ID","labelAlign":"right","itemId":"queryWrzLedger","fieldLabel":"{#queryWrzLedger#}"},"events":{"select":"app.queryWrzBtn.fireEvent('click');"},"children":[{"configs":{"pageSize":"-1","autoLoad":"false","itemId":"store","url":"m?xwl=xc/com-qry/gl-ledgers/select-sec-ledger"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"},{"configs":{"labelWidth":"80","displayField":"TRANS_DESC","width":"200","valueField":"TRANS_CODE","labelAlign":"right","itemId":"queryWrzTransType","fieldLabel":"{#queryWrzTransType#}"},"events":{"select":"app.queryWrzBtn.fireEvent('click');"},"children":[{"configs":{"pageSize":"-1","autoLoad":"false","itemId":"store","url":"m?xwl=xc/fa/daily-business/v-interface/data/getTransType"},"events":{"beforeload":"store.proxy.extraParams.MODULE = '{#MODULE#}';"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"},{"configs":{"labelWidth":"80","width":"200","labelAlign":"right","itemId":"queryWrzSummary","fieldLabel":"{#queryWrzSummary#}"},"events":{"specialkey":"if(e.getKey() == 13){\n  app.queryWrzBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"},{"configs":{"text":"{#queryWrzBtn#}","width":"60","itemId":"queryWrzBtn","iconCls":"seek_icon","x":"20"},"events":{"click":"app.wrzGrid.getStore().load();"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#resetWrzBtn#}","width":"60","itemId":"resetWrzBtn","iconCls":"refresh_icon","x":"40"},"events":{"click":"Wb.reset(app.queryWrzPanel);\n\napp.queryWrzBtn.fireEvent('click');"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"panel"},{"configs":{"region":"center","selType":"checkboxmodel","itemId":"wrzGrid","simpleSelect":"false","enableColumnMove":"false","editable":"true"},"events":{"tagEvents":"cellclick: function(tab, td, cellIndex, record, tr, rowIndex, e, OeOpts){\n  var canEditCols = record.get('CAN_EDIT_COLS');\n\n  if(!Ext.isEmpty(canEditCols)){\n    if(cellIndex==8){\n      if(canEditCols.indexOf('DEPT_ID')!=-1){\n        return true;\n      }else{\n        return false;\n      }\n    }else if(cellIndex==10){\n      if(canEditCols.indexOf('PROJECT_ID')!=-1){\n        return true;\n      }else{\n        return false;\n      }\n    }else if(cellIndex==12){\n      if(canEditCols.indexOf('DR_ACCT')!=-1){\n        return true;\n      }else{\n        return false;\n      }\n    }else if(cellIndex==14){\n      if(canEditCols.indexOf('DR_CCID')!=-1){\n        return true;\n      }else{\n        return false;\n      }\n    }else if(cellIndex==16){\n      if(canEditCols.indexOf('CR_ACCT')!=-1){\n        return true;\n      }else{\n        return false;\n      }\n    }else if(cellIndex==18){\n      if(canEditCols.indexOf('CR_CCID')!=-1){\n        return true;\n      }else{\n        return false;\n      }\n    }else if(cellIndex==20){\n      if(canEditCols.indexOf('SUMMARY')!=-1){\n        return true;\n      }else{\n        return false;\n      }\n    }\n    return true;\n  }\n  return true;\n}"},"children":[{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"{#saveBtn#}","itemId":"saveBtn","iconCls":"save_icon"},"events":{"click":"if (!Wb.verifyGrid(app.wrzGrid)){return;} //验证数据是否合法\n  \n//判断编码是否存在\nvar modifiedRecords = app.wrzGrid.getStore().getModifiedRecords();\nfor(var i=0; i<modifiedRecords.length; i++){\n  var record = modifiedRecords[i];\n  \n  if(Ext.isEmpty(record.get('LEDGER_ID')) || Ext.isEmpty(record.get('PERIOD_CODE')) || Ext.isEmpty(record.get('SUMMARY'))){\n    Wb.toast('{#saveCheck#}');\n    return;\n  }\n}\n\nWb.sync({\n  grid: app.wrzGrid,\n  url: 'm?xwl=xc/fa/daily-business/v-interface/data/save',\n  message: '{#saveWaitMsg#}',\n  success: function(resp) {\n    Wb.info('{#successMsg#}');\n    //ID_FIELD值在后台生成，把返回的ID_FIELD值列表同步到表格中\n    //Wb.syncCreate(app.grid, Wb.decode(resp.responseText));\n    app.queryWrzBtn.fireEvent('click');\n    \n  }\n});"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"-","itemId":"sp1"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#generateBtn#}","itemId":"generateBtn","iconCls":"ok_icon"},"events":{"click":"// 是否存在修改的记录\nvar modifiedRecords = app.wrzGrid.getStore().getModifiedRecords();\n\nif(modifiedRecords.length > 0){\n  Wb.toast('{#generateSaveCheck#}');\n  return;\n}\n\n// 是否有选中的记录\nvar selRecords = app.wrzGrid.getSelection();\nif(selRecords.length == 0){\n  Wb.toast('{#generateSelCheck#}');\n  return;\n}\n\n// 相同事务类型的才能合并生成凭证, 借方、贷方科目组合id不能为空\nvar tranTypeArray = new Array();\n\nfor(var i=0; i<selRecords.length; i++){\n  var tranTypeI = selRecords[i].get('TRANS_CODE');\n  \n  if(Ext.isEmpty(selRecords[i].get('DR_CCID')) || Ext.isEmpty(selRecords[i].get('CR_CCID'))){\n    Wb.toast('{#drccidAndCrccidNotNull#}');\n    return;\n  }\n\n  for(var j=0; j<selRecords.length; j++){\n    var tranTypeJ = selRecords[j].get('TRANS_CODE');\n\n    if(tranTypeI!=tranTypeJ){\n      Wb.toast('{#notSameGl#}');\n      return;\n    }\n  }\n}\n\napp.generateWin.show();"},"children":[],"expanded":false,"type":"item"}],"expanded":true,"type":"toolbar"},{"configs":{"pageSize":"-1","itemId":"store","url":"m?xwl=xc/fa/daily-business/v-interface/data/getInterface"},"events":{"beforeload":"var whereSql = \" NOT EXISTS (select 1 from xc_gl_v_interface_heads s where s.I_HEAD_ID = i.I_HEAD_ID) \";\n\n//if(!Ext.isEmpty(app.queryWrzLedger.getValue())){\n  whereSql = whereSql + \" and i.LEDGER_ID = '\" + app.queryWrzLedger.getValue() + \"' \";\n//}\n\nif(Ext.isEmpty(app.queryWrzTransType.getValue())){\n    Wb.request({\n        url : 'm?xwl=xc/fa/daily-business/v-interface/data/getTransType',\n        params : {MODULE : '{#MODULE#}'},\n        async : false,\n        success : function(resp){\n          var r = Wb.decode(resp.responseText);\n          var TRANS_CODE = \"''\";\n          for(var i = 0;i < r.total;i++){\n              TRANS_CODE += \",'\"+r.rows[i].TRANS_CODE+\"'\";\n          }\n          TRANS_CODE = \"IN (\"+TRANS_CODE+\")\";\n          whereSql = whereSql + \" and i.TRANS_CODE \" + TRANS_CODE + \"\";\n        }\n    });\n}\nelse{\n  whereSql = whereSql + \" and i.TRANS_CODE = '\" + app.queryWrzTransType.getValue() + \"' \";\n}\nif(!Ext.isEmpty(app.queryWrzSummary.getValue())){\n  whereSql = whereSql + \" and i.SUMMARY like '%\" + app.queryWrzSummary.getValue() + \"%' \";\n}\nstore.getProxy().extraParams.whereSql = whereSql;"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"width":"40","align":"center","xtype":"rownumberer","titleAlign":"center","itemId":"rowCol"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#ledgerNameCol#}","hidden":"true","width":"180","dataIndex":"LEDGER_ID","itemId":"ledgerIdCol"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#ledgerNameCol#}","width":"180","dataIndex":"LEDGER_NAME","itemId":"ledgerNameCol"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#periodCodeCol#}","align":"center","width":"60","dataIndex":"PERIOD_CODE","titleAlign":"center","itemId":"periodCodeCol"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#transNamecCol#}","hidden":"true","dataIndex":"TRANS_CODE","itemId":"transCodecCol"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#transNamecCol#}","dataIndex":"TRANS_NAME","itemId":"transNamecCol"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#deptNameCol#}","hidden":"true","dataIndex":"DEPT_ID","itemId":"deptIdCol"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#deptNameCol#}","width":"150","dataIndex":"DEPT_NAME","itemId":"deptNameCol"},"children":[{"configs":{"labelWidth":"120","triggerCls":"x-form-search-trigger","labelAlign":"right","itemId":"editor","fieldLabel":"{#cbzx#}","editable":"false"},"events":{"expand":"app.findLdDepts.fireEvent('click') ;"},"children":[{"configs":{"tagConfigs":"minWidth:420","height":"240","barExportAllButtons":"false","barExportButtons":"false","itemId":"pickComp","forceFit":"true"},"events":{"itemclick":"// 选择成本中心\nvar deptId = record.get('DEPT_ID');\nvar deptCode = record.get('DEPT_CODE');\nvar deptName = record.get('DEPT_NAME');\n\nvar selRecord = app.wrzGrid.getSelection()[0];\n\nselRecord.set('DEPT_ID', deptId);\nselRecord.set('DEPT_CODE', deptCode);\nselRecord.set('DEPT_NAME', deptName);\n\nselRecord.set('PROJECT_ID', '');\nselRecord.set('PROJECT_CODE', '');\nselRecord.set('PROJECT_NAME', '');\n\n// app.pickComp.hide() ;\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/fa/common/FA_INFO_PANEL/data/getDepts"},"events":{"beforeload":"store.proxy.extraParams.textStr = app.deptCodeOrName.getValue() ;"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","width":"50","dataIndex":"DEPT_ID","titleAlign":"center","itemId":"DEPT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#deptCode#}","width":"100","dataIndex":"DEPT_CODE","titleAlign":"center","itemId":"DEPT_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#deptNameCol#}","width":"200","dataIndex":"DEPT_NAME","titleAlign":"center","itemId":"DEPT_NAME_COL"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"emptyText":"按编码或名称进行查询","itemId":"deptCodeOrName"},"events":{"specialkey":"if(Ext.EventObject.getKey() == 13){\n  app.findLdDepts.fireEvent('click') ;\n}"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"findLdDepts","iconCls":"seek_icon"},"events":{"click":"// TODO: 加载成本中心\napp.pickComp.getStore().load() ;"},"children":[],"expanded":false,"type":"button"},{"configs":{"itemId":"clearLdDepts","iconCls":"cancel_icon","tooltip":"清空已选择的数据"},"events":{"click":"app.CBZX.setValue();\napp.CBZX_NAME.setValue() ;\napp.deptCodeOrName.setValue() ;\napp.findLdDepts.fireEvent('click') ;"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":false,"type":"column"},{"configs":{"text":"{#projectNameCol#}","hidden":"true","dataIndex":"PROJECT_ID","itemId":"projectIdCol"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#projectNameCol#}","width":"180","dataIndex":"PROJECT_NAME","itemId":"projectNameCol"},"children":[{"configs":{"labelWidth":"120","triggerCls":"x-form-search-trigger","labelAlign":"right","itemId":"editor"},"events":{"expand":"app.findLdExItems.fireEvent('click') ;"},"children":[{"configs":{"tagConfigs":"minWidth:420","height":"240","barExportAllButtons":"false","barExportButtons":"false","itemId":"pickComp","forceFit":"true"},"events":{"itemclick":"var projectId = record.get('PROJECT_ID');\nvar projectCode = record.get('PROJECT_CODE');\nvar projectName = record.get('PROJECT_NAME');\n\nvar selRecord = app.wrzGrid.getSelection()[0];\n\nselRecord.set('PROJECT_ID', projectId);\nselRecord.set('PROJECT_CODE', projectCode);\nselRecord.set('PROJECT_NAME', projectName);\n\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/fa/common/FA_INFO_PANEL/data/getProject"},"events":{"beforeload":"store.proxy.extraParams.LEDGER_ID = app.wrzGrid.getSelection()[0].get('LEDGER_ID');\nstore.proxy.extraParams.textStr = app.exItemCodeOrName.getValue() ;"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","width":"50","dataIndex":"PROJECT_ID","itemId":"PROJECT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#projectCode#}","width":"100","dataIndex":"PROJECT_CODE","titleAlign":"center","itemId":"PROJECT_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#projectNameCol#}","width":"200","dataIndex":"PROJECT_NAME","titleAlign":"center","itemId":"PROJECT_NAME_COL"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"emptyText":"按编码或名称进行查询","itemId":"exItemCodeOrName"},"events":{"specialkey":"if(Ext.EventObject.getKey() == 13){\n  app.findLdExItems.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"findLdExItems","iconCls":"seek_icon"},"events":{"click":"app.pickComp.getStore().load() ;"},"children":[],"expanded":false,"type":"button"},{"configs":{"itemId":"clearLdExItems","iconCls":"cancel_icon","tooltip":"清空已选择的数据"},"events":{"click":"// TODO: 清空费用项目\napp.PROJECT_ID.setValue() ;\napp.PROJECT_NAME.setValue() ;\napp.exItemCodeOrName.setValue('');\napp.findLdExItems.fireEvent('click') ;"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":false,"type":"column"},{"configs":{"text":"{#drAcctNameCol#}","hidden":"true","dataIndex":"DR_ACCT","itemId":"drAcctCol"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#drAcctNameCol#}","width":"180","dataIndex":"DR_ACCT_NAME","itemId":"drAcctNameCol"},"children":[{"configs":{"normalName":"DFKM_PICK","itemId":"editor"},"events":{"expand":"picker.getPicker().getStore().load({params:{\n  QUERY_LEDGER_ID: app.wrzGrid.getSelection()[0].get('LEDGER_ID')\n}});"},"children":[{"configs":{"tagConfigs":"minWidth:400","height":"300","barPageButton":"false","barExportButtons":"false","barExportAllButtons":"false","barRefreshButton":"false","itemId":"pickComp"},"events":{"itemdblclick":"var _record = app.wrzGrid.getSelection()[0];\n\n_record.set('DR_ACCT', record.get('ACC_CODE'));\n_record.set('DR_ACCT_NAME', record.get('ACC_NAME'));\n\nvar picker = this.ownerCmp;\npicker.collapse();\n\napp.wrzGrid.plugins[0].completeEdit();"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/com-lov/ACC_ID_PICK/DB/XC_BG_LD_ACCOUNTS_SELECT_LD"},"events":{"beforeload":"store.getProxy().extraParams.QUERY_LEDGER_ID = app.wrzGrid.getSelection()[0].get('LEDGER_ID');\nstore.getProxy().extraParams.QUERY_CODE_NAME  = app.QUERY_DR_CODE_NAME.getValue();"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","dataIndex":"ACC_ID","itemId":"ACC_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#accountCode#}","dataIndex":"ACC_CODE","itemId":"ACC_CODE_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#accountName#}","dataIndex":"ACC_NAME","itemId":"ACC_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"150","labelAlign":"right","itemId":"QUERY_DR_CODE_NAME","fieldLabel":"{#accountCodeName#}"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.pickComp.getStore().load();\n}"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"cancelBtn","iconCls":"delete_icon"},"events":{"click":"var _record = app.wrzGrid.getSelection()[0];\n\n_record.set('DR_ACCT', '');\n_record.set('DR_ACCT_NAME', '');\n\napp.wrzGrid.plugins[0].completeEdit();"},"children":[],"expanded":false,"type":"item"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":false,"type":"column"},{"configs":{"text":"{#drCcidNameCol#}","hidden":"true","dataIndex":"DR_CCID","itemId":"drCcidCol"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#drCcidNameCol#}","width":"180","dataIndex":"DR_CCID_NAME","itemId":"drCcidNameCol"},"children":[{"configs":{"displayField":"ACC_NAME","triggerCls":"x-form-search-trigger","valueField":"ACC_ID","itemId":"editor","onTriggerClick":"var selRecord = app.wrzGrid.getSelection()[0];\n\n// 账簿\nvar ledgerId = selRecord.get('LEDGER_ID');\nif(ledgerId === \"\" ||ledgerId === null || ledgerId === undefined){\n  Wb.info('{#selectLedgerFirst#}') ;\n  return false ;\n}\n\n// 期间\nvar period = selRecord.get('PERIOD_CODE');\nif(period === \"\" || period === null || period === undefined){\n  Wb.info('{#selectPeriodFirst#}') ;\n  return false ;\n}\n\nvar accName = Ext.isEmpty(selRecord.get('DR_CCID_NAME')) ? (Ext.isEmpty(selRecord.get('DR_ACCT_NAME')) ? '' : selRecord.get('DR_ACCT_NAME')) : selRecord.get('DR_CCID_NAME');\nvar ccid = Ext.isEmpty(selRecord.get('DR_CCID')) ? '' : selRecord.get('DR_CCID');\n\nWb.run({\n  url:'m?xwl=xc/gl/journal/v-windows/handler-ccid-win',\n  params : {\n    'ledgerId'   : ledgerId,\n    'periodCode' : period,\n    'vtype'      : 'normal'\n  },          \n  success:function(appObj){\n    appObj.initWindow({\n      accName : accName,\n      ledgerId : ledgerId,\n      periodCode : period ,\n      caId : '',\t// 现金流量项信息\n      ccid : ccid,\n      bgInfo : {} , // 预算信息\n      groupId : 'ALL',\n      handlerCCID : function(returnObj){\n        // TODO: 处理CCID信息\n        var rObj = Wb.decode(returnObj) ;\n        selRecord.set('DR_CCID', rObj.acc_ccid) ;    \n        selRecord.set('DR_CCID_NAME', rObj.acc_ccid_name);\n      }\n    });\n  }  \n}) ;   "},"events":{"beforequery":"var combo = e.combo;\nif(!e.forceAll){\n  var value = e.query;\n  combo.store.filterBy(function(record,id){\n    var text = record.get(combo.displayField);\n    return (text.indexOf(value)!=-1);\n  });\n  combo.expand();\n  return false;\n}","specialkey":"var selRecord = app.wrzGrid.getSelection()[0];\n\n// 账簿\nvar ledgerId = selRecord.get('LEDGER_ID');\nif(ledgerId === \"\" ||ledgerId === null || ledgerId === undefined){\n  Wb.info('{#selectLedgerFirst#}') ;\n  return false ;\n}\n\n// 期间\nvar period = selRecord.get('PERIOD_CODE');\nif(period === \"\" || period === null || period === undefined){\n  Wb.info('{#selectPeriodFirst#}') ;\n  return false ;\n}\n\nvar accName = Ext.isEmpty(selRecord.get('DR_CCID_NAME')) ? (Ext.isEmpty(selRecord.get('DR_ACCT_NAME')) ? '' : selRecord.get('DR_ACCT_NAME')) : selRecord.get('DR_CCID_NAME');\nvar ccid = Ext.isEmpty(selRecord.get('DR_CCID')) ? '' : selRecord.get('DR_CCID');\n\nWb.run({\n  url:'m?xwl=xc/gl/journal/v-windows/handler-ccid-win',\n  params : {\n    'ledgerId'   : ledgerId,\n    'periodCode' : period,\n    'vtype'      : 'normal'\n  },          \n  success:function(appObj){\n    appObj.initWindow({\n      accName : accName,\n      ledgerId : ledgerId,\n      periodCode : period ,\n      caId : '',\t// 现金流量项信息\n      ccid : ccid,\n      bgInfo : {} , // 预算信息\n      groupId : 'ALL',\n      handlerCCID : function(returnObj){\n        // TODO: 处理CCID信息\n        var rObj = Wb.decode(returnObj) ;\n        selRecord.set('DR_CCID', rObj.acc_ccid) ;    \n        selRecord.set('DR_CCID_NAME', rObj.acc_ccid_name);\n      }\n    });\n  }  \n}) ;   "},"children":[],"expanded":true,"type":"combo"}],"expanded":false,"type":"column"},{"configs":{"text":"{#crAcctNameCol#}","hidden":"true","dataIndex":"CR_ACCT","itemId":"crAcctCol"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#crAcctNameCol#}","width":"180","dataIndex":"CR_ACCT_NAME","itemId":"crAcctNameCol"},"children":[{"configs":{"normalName":"DFKM_PICK","itemId":"editor"},"events":{"expand":"picker.getPicker().getStore().load({params:{\n  QUERY_LEDGER_ID: app.wrzGrid.getSelection()[0].get('LEDGER_ID')\n}});"},"children":[{"configs":{"tagConfigs":"minWidth:400","height":"300","barPageButton":"false","barExportButtons":"false","barExportAllButtons":"false","barRefreshButton":"false","itemId":"pickComp"},"events":{"itemdblclick":"var _record = app.wrzGrid.getSelection()[0];\n\n_record.set('CR_ACCT', record.get('ACC_CODE'));\n_record.set('CR_ACCT_NAME', record.get('ACC_NAME'));\n\nvar picker = this.ownerCmp;\npicker.collapse();\n\napp.wrzGrid.plugins[0].completeEdit();"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/com-lov/ACC_ID_PICK/DB/XC_BG_LD_ACCOUNTS_SELECT_LD"},"events":{"beforeload":"store.getProxy().extraParams.QUERY_LEDGER_ID = app.wrzGrid.getSelection()[0].get('LEDGER_ID');\nstore.getProxy().extraParams.QUERY_CODE_NAME  = app.QUERY_CR_CODE_NAME.getValue();"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","dataIndex":"ACC_ID","itemId":"ACC_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#accountCode#}","dataIndex":"ACC_CODE","itemId":"ACC_CODE_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#accountName#}","dataIndex":"ACC_NAME","itemId":"ACC_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"150","labelAlign":"right","itemId":"QUERY_CR_CODE_NAME","fieldLabel":"{#accountCodeName#}"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.pickComp.getStore().load();\n}"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"cancelBtn","iconCls":"delete_icon"},"events":{"click":"var _record = app.wrzGrid.getSelection()[0];\n\n_record.set('CR_ACCT', '');\n_record.set('CR_ACCT_NAME', '');\n\napp.wrzGrid.plugins[0].completeEdit();"},"children":[],"expanded":false,"type":"item"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":false,"type":"column"},{"configs":{"text":"{#crCcidNameCol#}","hidden":"true","dataIndex":"CR_CCID","itemId":"crCcidCol"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#crCcidNameCol#}","width":"180","dataIndex":"CR_CCID_NAME","itemId":"crCcidNameCol"},"children":[{"configs":{"displayField":"ACC_NAME","triggerCls":"x-form-search-trigger","valueField":"ACC_ID","itemId":"editor","onTriggerClick":"var selRecord = app.wrzGrid.getSelection()[0];\n\n// 账簿\nvar ledgerId = selRecord.get('LEDGER_ID');\nif(ledgerId === \"\" ||ledgerId === null || ledgerId === undefined){\n  Wb.info('{#selectLedgerFirst#}') ;\n  return false ;\n}\n\n// 期间\nvar period = selRecord.get('PERIOD_CODE');\nif(period === \"\" || period === null || period === undefined){\n  Wb.info('{#selectPeriodFirst#}') ;\n  return false ;\n}\n\nvar accName = Ext.isEmpty(selRecord.get('CR_CCID_NAME')) ? (Ext.isEmpty(selRecord.get('CR_ACCT_NAME')) ? '' : selRecord.get('CR_ACCT_NAME')) : selRecord.get('CR_CCID_NAME');\nvar ccid = Ext.isEmpty(selRecord.get('CR_CCID')) ? '' : selRecord.get('CR_CCID');\n\nWb.run({\n  url:'m?xwl=xc/gl/journal/v-windows/handler-ccid-win',\n  params : {\n    'ledgerId'   : ledgerId,\n    'periodCode' : period,\n    'vtype'      : 'normal'\n  },          \n  success:function(appObj){\n    appObj.initWindow({\n      accName : accName,\n      ledgerId : ledgerId,\n      periodCode : period ,\n      caId : '',\t// 现金流量项信息\n      ccid : ccid,\n      bgInfo : {} , // 预算信息\n      groupId : 'ALL',\n      handlerCCID : function(returnObj){\n        // TODO: 处理CCID信息\n        var rObj = Wb.decode(returnObj) ;\n        selRecord.set('CR_CCID', rObj.acc_ccid) ;    \n        selRecord.set('CR_CCID_NAME', rObj.acc_ccid_name);\n      }\n    });\n  }  \n}) ;   "},"events":{"beforequery":"var combo = e.combo;\nif(!e.forceAll){\n  var value = e.query;\n  combo.store.filterBy(function(record,id){\n    var text = record.get(combo.displayField);\n    return (text.indexOf(value)!=-1);\n  });\n  combo.expand();\n  return false;\n}","specialkey":"// TODO: 按回车键执行借方和贷方金额切换\nif (e.getKey() == e.ENTER) {\n  // 账簿\n  var ledgerId = app.ledger.getValue() ;\n  if(ledgerId === \"\" ||ledgerId === null || ledgerId === undefined){\n    Wb.info('请选择账簿!') ;\n    return false ;\n  }\n  \n  // 会计日期\n  var accDate = app.accountDate.getValue() ;\n  if(accDate === \"\" ||accDate === null || accDate === undefined){\n    Wb.info('请选择会计日期!') ;\n    return false ;\n  }else{\n    // 账簿会计期\n    var accPeriod = app.ldPeriod.getValue() ;\n    if(accPeriod === \"\" ||accPeriod === null || accPeriod === undefined){\n      Wb.info('会计期不能为空!') ;\n      return false ;\n    }\n  }\n  \n  // TODO: 当前选中\n  var r = app.grid1.getSelection()[0] ; \n  // 预算信息\n  var bgJson = {\n    'bgItemId' : r.data.BG_ITEM_ID ,\n    'bgItemName' : r.data.BG_ITEM_NAME ,\n    'projectId' : r.data.PROJECT_ID ,\n    'projects' : r.data.PROJECT_NAME ,\n    'deptId' : r.data.DEPT_ID ,\n    'depts' : r.data.DEPT_NAME \n  } ;\n  \n  // TODO: 显示科目选择窗口\n  Wb.run({\n    url:'m?xwl=xc/gl/journal/v-windows/handler-ccid-win',\n    params : {\n      'ledgerId' : app.ledger.getValue(),\n      'periodCode' : app.ldPeriod.getValue() ,\n      'vtype'    : '{#vtype#}',\n      'srctype'  : '{#srctype#}'\n    },          \n    success:function(appObj){\n      appObj.initWindow({\n        accName : combo.getValue(),\n        ledgerId : app.ledger.getValue(),\n        periodCode : app.ldPeriod.getValue() ,\n        caId : r.data.CA_ID,\t\t// 现金流量项信息\n        ccid : r.data.CCID,\n        bgInfo : Wb.encode(bgJson) , // 预算信息\n        groupId : 'ALL',\n        handlerCCID : function(returnObj){\n          // TODO: 处理CCID信息\n          var rObj = Wb.decode(returnObj) ;\n          r.set('CCID', rObj.acc_ccid) ;    \n          r.set('CCID_FULL_NAME', rObj.acc_ccid_name);\n          r.set('DIM_ID', rObj.dim_id) ;\n          r.set('DIM_NAME', rObj.dim_name) ;\n          r.set('IS_FOREIGN', rObj.f_cny) ;\n          r.set('CURRENCY_CODE',rObj.cny_code) ;\n          r.set('CURRENCY_NAME',rObj.cny_name) ;\n          r.set('CA_ID',rObj.ca_id) ;   \n          r.set('CA_NAME',rObj.ca_name) ;\n          r.set('IS_BC_ACC',rObj.is_sign);\n          r.set('BG_ITEM_ID',rObj.bgItemId);\n          r.set('DEPT_ID',rObj.deptId);\n          r.set('PROJECT_ID',rObj.projectId);\n          \n          // 禁用账簿\n          app.ledger.setReadOnly(true) ;\n        }\n      });\n    }  \n  }) ;   \n}"},"children":[],"expanded":true,"type":"combo"}],"expanded":false,"type":"column"},{"configs":{"text":"{#amtCol#}","align":"right","dataIndex":"AMT","titleAlign":"left","itemId":"amtCol"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#summaryCol#}","width":"400","dataIndex":"SUMMARY","itemId":"summaryCol"},"children":[{"configs":{"itemId":"editor"},"children":[],"expanded":false,"type":"text"}],"expanded":false,"type":"column"},{"configs":{"text":"{#busNoCol#}","hidden":"true","width":"150","dataIndex":"BUS_NO","itemId":"busNoCol"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"V_INTERFACE_ID","hidden":"true","dataIndex":"V_INTERFACE_ID","itemId":"interfaceIdCol"},"children":[],"expanded":false,"type":"column"}],"expanded":false,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"panel"},{"configs":{"title":"{#rzPanel#}","layout":"border","itemId":"rzPanel"},"children":[{"configs":{"region":"north","height":"45","layout":"column","bodyPadding":"10 0 0 20","itemId":"queryRzPanel"},"children":[{"configs":{"labelWidth":"60","displayField":"NAME","width":"180","valueField":"ID","labelAlign":"right","itemId":"queryRzLedger","fieldLabel":"{#queryWrzLedger#}"},"events":{"select":"app.queryRzBtn.fireEvent('click');"},"children":[{"configs":{"pageSize":"-1","autoLoad":"false","itemId":"store","url":"m?xwl=xc/com-qry/gl-ledgers/select-sec-ledger"},"children":[],"expanded":false,"type":"store"}],"expanded":false,"type":"combo"},{"configs":{"labelWidth":"80","displayField":"PERIOD_CODE","width":"200","valueField":"PERIOD_CODE","labelAlign":"right","itemId":"queryRzPeriod","fieldLabel":"{#periodCodeCol#}"},"events":{"select":"app.queryRzBtn.fireEvent('click');"},"children":[{"configs":{"pageSize":"-1","autoLoad":"false","itemId":"store","url":"m?xwl=xc/fa/daily-business/v-interface/data/getPeriods"},"events":{"beforeload":"if(Ext.isEmpty(app.queryRzLedger.getValue())){\n  Wb.toast('{#selectLedgerFirst#}');\n  return false;\n}\nstore.getProxy().extraParams.ledger = app.queryRzLedger.getValue();"},"children":[],"expanded":false,"type":"store"}],"expanded":false,"type":"combo"},{"configs":{"labelWidth":"80","width":"200","pickList":"[['qc','{#vStatusCol4qc#}'],['ysh','{#vStatusCol4ysh#}'],['yjz','{#vStatusCol4yjz#}']]","labelAlign":"right","itemId":"queryRzStatus","fieldLabel":"{#vStatusCol#}"},"events":{"select":"app.queryRzBtn.fireEvent('click');"},"children":[],"expanded":true,"type":"combo"},{"configs":{"text":"{#queryWrzBtn#}","width":"60","itemId":"queryRzBtn","iconCls":"seek_icon","x":"20"},"events":{"click":"app.rzGrid.getStore().load();"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#resetWrzBtn#}","width":"60","itemId":"resetRzBtn","iconCls":"refresh_icon","x":"40"},"events":{"click":"Wb.reset(app.queryRzPanel);\n\napp.queryRzBtn.fireEvent('click');"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"panel"},{"configs":{"region":"center","itemId":"rzGrid","enableColumnMove":"false","editable":"true"},"events":{"itemdblclick":"app.viewSubBtn.fireEvent('click');","tagEvents":"/*cellclick: function(tab, td, cellIndex, record, tr, rowIndex, e, OeOpts){\n  var canEditCols = record.get('CAN_EDIT_COLS');\n\n  if(!Ext.isEmpty(canEditCols)){\n    if(cellIndex==8){\n      if(canEditCols.indexOf('DEPT_ID')!=-1){\n        return true;\n      }\n    }else if(cellIndex==10){\n      if(canEditCols.indexOf('PROJECT_ID')!=-1){\n        return true;\n      }\n    }else if(cellIndex==14){\n      if(canEditCols.indexOf('DR_CCID')!=-1){\n        return true;\n      }\n    }else if(cellIndex==18){\n      if(canEditCols.indexOf('CR_CCID')!=-1){\n        return true;\n      }\n    }else if(cellIndex==20){\n      if(canEditCols.indexOf('SUMMARY')!=-1){\n        return true;\n      }\n    }\n    return false;\n  }\n  return false;\n}*/"},"children":[{"configs":{"pageSize":"-1","itemId":"store","url":"m?xwl=xc/fa/daily-business/v-interface/data/getInterfaceHeads"},"events":{"beforeload":"var TRANS_CODE = \"''\";\nWb.request({\n    url : 'm?xwl=xc/fa/daily-business/v-interface/data/getTransType',\n    params : {MODULE : '{#MODULE#}'},\n    async : false,\n    success : function(resp){\n        var r = Wb.decode(resp.responseText);\n        for(var i = 0;i < r.total;i++){\n          TRANS_CODE += \",'\"+r.rows[i].TRANS_CODE+\"'\";\n        }\n        TRANS_CODE = \"IN (\"+TRANS_CODE+\")\";\n    }\n});\nstore.getProxy().extraParams.ledger = app.queryRzLedger.getValue();\nstore.getProxy().extraParams.period = app.queryRzPeriod.getValue();\nstore.getProxy().extraParams.status = app.queryRzStatus.getValue();\nstore.getProxy().extraParams.TRANS_CODE = TRANS_CODE;"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"width":"40","align":"center","xtype":"rownumberer","titleAlign":"center","itemId":"rowCol"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#ledgerNameCol#}","hidden":"true","width":"180","dataIndex":"LEDGER_ID","itemId":"ledgerIdCol"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"I_HEAD_ID","hidden":"true","dataIndex":"I_HEAD_ID","itemId":"iHeadIdCol"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"V_HEAD_ID","hidden":"true","dataIndex":"V_HEAD_ID","itemId":"vHeadIdCol"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#ledgerNameCol#}","hidden":"true","width":"150","dataIndex":"LEDGER_NAME","itemId":"ledgerNameCol"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#periodCodeCol#}","align":"center","width":"80","dataIndex":"PERIOD_CODE","titleAlign":"center","itemId":"periodCodeCol"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#vSerialNumCol#}","width":"150","dataIndex":"V_SERIAL_NUM","itemId":"vSerialNumCol"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#drAmtCol#}","width":"150","align":"right","dataIndex":"DR_AMT","format":"00,000.00","titleAlign":"left","itemId":"drAmtCol"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#crAmtCol#}","width":"150","align":"right","dataIndex":"CR_AMT","format":"00,000.00","titleAlign":"left","itemId":"crAmtCol"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#summaryCol#}","width":"400","dataIndex":"SUMMARY","itemId":"summaryCol"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#vStatusCol#}","align":"center","width":"80","dataIndex":"V_STATUS","titleAlign":"center","itemId":"vStatusCol","renderer":"if(value=='qc'){\n  return '{#vStatusCol4qc#}';\n}else if(value=='ysh'){\n  return '{#vStatusCol4ysh#}';\n}else if(value=='yrz'){\n  return '{#vStatusCol4yjz#}';\n}"},"children":[],"expanded":true,"type":"column"}],"expanded":false,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"{#submitBtn#}","itemId":"submitBtn","iconCls":"ok_icon"},"events":{"click":"var selRecords = app.rzGrid.getSelection();\n\nif(selRecords.length==0 || selRecords.length>1){\n  Wb.toast('{#viewSubSelCheck#}');\n  return;\n}\n\nif(selRecords[0].get('V_STATUS')!='qc'){\n  Wb.toast('{#onQcCanBeSubmitted#}');\n  return;\n}\n\nExt.Msg.wait('');\nvar _flag = true;\nvar url = 'm?xwl=xc/fa/daily-business/v-interface/data/getCurrentPeriod';\nif('{#MODULE#}' == 'ST')\n    url = 'm?xwl=xc/fa/daily-business/v-interface/data/getStCurrentPeriod';\nExt.Ajax.request({\n  url : url,\n  method: 'POST',\n  async:false,\n  params:{ledger: app.queryRzLedger.getValue()},\n  success: function(response,options){\n    Ext.Msg.hide();\n    var resp = Ext.JSON.decode(response.responseText);\n\n    if(resp.PERIOD_CODE!=selRecords[0].get('PERIOD_CODE')){\n      _flag = false;\n    }\n  },\n  failure: function(response,options){\n    Ext.Msg.hide();\n    Wb.error('{#requestFailure#}');\n  }\n});\n\nif(_flag==false){\n  Wb.toast('{#notInCurrentPeriod#}');\n  return;\n}\n\nvar vHeadId = selRecords[0].get('V_HEAD_ID');\nvar iHeadId = selRecords[0].get('I_HEAD_ID');\n\n// 提交ajax请求\nExt.Msg.wait('{#opWaitMsg#}');\nExt.Ajax.request({\n  url: '{#contextPath#}' + '/glInterfaceAction.do?method=submitGlInterface',\n  method: 'POST',\n  timeout: 300000,\n  params:{\n    vHeadId: vHeadId,\n    iHeadId: iHeadId\n  },\n  success: function(res, opts) {\n    Ext.Msg.hide();\n    var temp = res.responseText;\n    var resp = Ext.JSON.decode(temp);\n\n    if(resp.flag == 0){\n      Wb.toast('{#opSuccessMsg#}');\n      app.queryRzBtn.fireEvent('click');\n    }else{\n      Wb.error(resp.msg);\n    }\n  },\n  failure: function(res, opts) {\n    Ext.Msg.hide();\n    Wb.error('{#opFailureMsg#}');\n  }\n});"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#draftBtn#}","itemId":"draftBtn","iconCls":"left_icon"},"events":{"click":"var selRecords = app.rzGrid.getSelection();\n\nif(selRecords.length==0 || selRecords.length>1){\n  Wb.toast('{#viewSubSelCheck#}');\n  return;\n}\n\nif(selRecords[0].get('V_STATUS')!='ysh'){\n  Wb.toast('{#onYshCanBeRevoke#}');\n  return;\n}\n\nExt.Msg.wait('');\nvar _flag = true;\nvar url = 'm?xwl=xc/fa/daily-business/v-interface/data/getCurrentPeriod';\nif('{#MODULE#}' == 'ST')\n    url = 'm?xwl=xc/fa/daily-business/v-interface/data/getStCurrentPeriod';\nExt.Ajax.request({\n  url : url,\n  method: 'POST',\n  async:false,\n  params:{ledger: app.queryRzLedger.getValue()},\n  success: function(response,options){\n    Ext.Msg.hide();\n    var resp = Ext.JSON.decode(response.responseText);\n\n    if(resp.PERIOD_CODE!=selRecords[0].get('PERIOD_CODE')){\n      _flag = false;\n    }\n  },\n  failure: function(response,options){\n    Ext.Msg.hide();\n    Wb.error('{#requestFailure#}');\n  }\n});\n\nif(_flag==false){\n  Wb.toast('{#notInCurrentPeriod#}');\n  return;\n}\n\nvar vHeadId = selRecords[0].get('V_HEAD_ID');\nvar iHeadId = selRecords[0].get('I_HEAD_ID');\n\n// 提交ajax请求\nExt.Msg.wait('{#opWaitMsg#}');\nExt.Ajax.request({\n  url: '{#contextPath#}' + '/glInterfaceAction.do?method=draftGlInterface',\n  method: 'POST',\n  timeout: 300000,\n  params:{\n    vHeadId: vHeadId,\n    iHeadId: iHeadId\n  },\n  success: function(res, opts) {\n    Ext.Msg.hide();\n    var temp = res.responseText;\n    var resp = Ext.JSON.decode(temp);\n\n    if(resp.flag == 0){\n      Wb.toast('{#opSuccessMsg#}');\n      app.queryRzBtn.fireEvent('click');\n    }else{\n      Wb.error(resp.msg);\n    }\n  },\n  failure: function(res, opts) {\n    Ext.Msg.hide();\n    Wb.error('{#opFailureMsg#}');\n  }\n});"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#deleteBtn#}","itemId":"deleteBtn","iconCls":"cancel_icon"},"events":{"click":"var selRecords = app.rzGrid.getSelection();\n\nif(selRecords.length==0 || selRecords.length>1){\n  Wb.toast('{#viewSubSelCheck#}');\n  return;\n}\n\nif(selRecords[0].get('V_STATUS')!='qc'){\n  Wb.toast('{#onQcCanBeDeleted#}');\n  return;\n}\n\nExt.Msg.wait('');\nvar _flag = true;\nvar url = 'm?xwl=xc/fa/daily-business/v-interface/data/getCurrentPeriod';\nif('{#MODULE#}' == 'ST')\n    url = 'm?xwl=xc/fa/daily-business/v-interface/data/getStCurrentPeriod';\nExt.Ajax.request({\n  url : url,\n  method: 'POST',\n  async:false,\n  params:{ledger: app.queryRzLedger.getValue()},\n  success: function(response,options){\n    Ext.Msg.hide();\n    var resp = Ext.JSON.decode(response.responseText);\n    if(resp.PERIOD_CODE!=selRecords[0].get('PERIOD_CODE')){\n      _flag = false;\n    }\n  },\n  failure: function(response,options){\n    Ext.Msg.hide();\n    Wb.error('{#requestFailure#}');\n  }\n});\n\nif(_flag==false){\n  Wb.toast('{#notInCurrentPeriod#}');\n  return;\n}\n\nvar vHeadId = selRecords[0].get('V_HEAD_ID');\nvar iHeadId = selRecords[0].get('I_HEAD_ID');\n\n// 提交ajax请求\nExt.Msg.wait('{#opWaitMsg#}');\nExt.Ajax.request({\n  url: '{#contextPath#}' + '/glInterfaceAction.do?method=deleteGlInterface',\n  method: 'POST',\n  timeout: 300000,\n  params:{\n    vHeadId: vHeadId,\n    iHeadId: iHeadId\n  },\n  success: function(res, opts) {\n    Ext.Msg.hide();\n    var temp = res.responseText;\n    var resp = Ext.JSON.decode(temp);\n\n    if(resp.flag == 0){\n      Wb.toast('{#opSuccessMsg#}');\n      app.queryRzBtn.fireEvent('click');\n    }else{\n      Wb.error(resp.msg);\n    }\n  },\n  failure: function(res, opts) {\n    Ext.Msg.hide();\n    Wb.error('{#opFailureMsg#}');\n  }\n});"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#viewSubBtn#}","itemId":"viewSubBtn","iconCls":"preview_icon"},"events":{"click":"var selRecords = app.rzGrid.getSelection();\n\nif(selRecords.length==0 || selRecords.length>1){\n  Wb.toast('{#viewSubSelCheck#}');\n  return;\n}\n\nvar iHeadId = selRecords[0].get('I_HEAD_ID');\n\napp.rzSubWin.show();\n\napp.rzSubGrid.getStore().getProxy().extraParams.IHeadId = iHeadId;\napp.rzSubGrid.getStore().load();"},"children":[],"expanded":false,"type":"item"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"tab"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}