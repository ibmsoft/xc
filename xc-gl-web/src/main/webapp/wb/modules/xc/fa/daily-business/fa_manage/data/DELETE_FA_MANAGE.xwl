{"inframe":false,"title":"删除","hidden":false,"roles":{"default":1},"children":[{"configs":{"loginRequired":"false","serverScript":"com.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xc/fa/ld-base/fa_ld_init/FA_LD_INIT\");\n\n/**\n 只能删除当前会计期的资产\n 生成凭证不能删除\n 拆分过不能删除\n 调整过不能删除\n**/\nvar deleteRecs = Wb.decode(request.getParameter('data'));\nWb.each(deleteRecs,function(rec){\n  app.run(\"select 1 from xc_fa_additions s where s.ASSET_ID = '\"+rec.ASSET_ID+\"' and s.PERIOD_CODE <> (select p.PERIOD_CODE from xc_fa_ld_periods p where p.LEDGER_ID = s.LEDGER_ID and p.STATUS = '1') \",\n        {errorText:request.getAttribute('checkInPeriod')}\n       );\n  app.run(\"select 1 from xc_gl_v_interface_heads h where h.V_HEAD_ID is not null and h.V_HEAD_ID <> '' and h.I_HEAD_ID = (select i.I_HEAD_ID from xc_gl_v_interface i where i.SRC_H_ID ='\"+rec.ASSET_ID+\"') \",\n        {errorText:request.getAttribute('hasPz')}\n       );\n  app.run('select 1 from xc_fa_division where ASSET_ID = \\''+rec.ASSET_ID+'\\'',\n        {errorText:request.getAttribute('hasSplit')}\n       );\n  app.run('select 1 from xc_fa_division_dtl where ASSET_ID = \\''+rec.ASSET_ID+'\\'',\n        {errorText:request.getAttribute('splitAsset')}\n       );\n  app.run('select 1 from xc_fa_adj_l where ASSET_ID = \\''+rec.ASSET_ID+'\\'',\n        {errorText:request.getAttribute('hasAdj')}\n       );\n});","itemId":"module"},"children":[{"configs":{"sql":"DELETE d.*\nFROM\n\txc_fa_depr d\nWHERE\n\td.ASSET_ID = {?ASSET_ID?}","transaction":"start","itemId":"deleteDepr","arrayName":"data"},"children":[],"expanded":false,"type":"query"},{"configs":{"sql":"DELETE T.*\nFROM\n\txc_fa_trans T\nWHERE\n\tT.ASSET_ID = {?ASSET_ID?}","itemId":"deleteTrans","arrayName":"data"},"children":[],"expanded":false,"type":"query"},{"configs":{"sql":"DELETE T.*\nFROM\n\txc_gl_v_interface T\nWHERE\n\tT.SRC_H_ID = {?ASSET_ID?}","itemId":"deleteInterface","arrayName":"data"},"children":[],"expanded":false,"type":"query"},{"configs":{"sql":"DELETE T.*\nFROM\n\txc_fa_additions T\nWHERE\n\tT.ASSET_ID = {?ASSET_ID?}","arrayName":"data","itemId":"deleteAsset"},"children":[],"expanded":false,"type":"query"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}