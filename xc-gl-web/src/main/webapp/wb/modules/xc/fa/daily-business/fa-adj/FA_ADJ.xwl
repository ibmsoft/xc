{"inframe":false,"title":"资产调整","hidden":false,"roles":{"default":1},"children":[{"configs":{"initScript":"//---------------------获取当前模块语言对应的.json文件，放到request中----------------\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xc/fa/daily-business/fa-adj/FA_ADJ\");\n\nrequest.setAttribute(\"contextPath\", request.getContextPath());\n\n// 计提前或者计提后 before after\nrequest.setAttribute(\"JT\", request.getParameter(\"JT\"));","itemId":"module"},"events":{"initialize":"//选择调整类型后，控件的显示与隐藏\nfunction hideComps(comp){\n  app.CAT_CODE.hide();\n  app.ZJFF.hide();\n  app.NUM_FIELD.hide();\n  app.ZCYT.hide();\n  app.SFZJ.hide();\n  app.KM_XWL.ACC_NAME.hide();\n  app.CBZX_NAME.hide();\n  \n  app.CAT_CODE.clearValue();\n  app.ZJFF.clearValue();\n  app.NUM_FIELD.setValue('');\n  app.ZCYT.clearValue();\n  app.SFZJ.clearValue();\n  app.KM_XWL.ACC_CODE.setValue('');\n  app.KM_XWL.ACC_NAME.setValue('');\n  app.CBZX.setValue('');\n  app.CBZX_NAME.setValue('');\n  \n  comp.show();\n}"},"children":[{"configs":{"itemId":"periodStore","url":"m?xwl=xc/fa/common/FA_INFO_PANEL/data/getPeriods"},"events":{"beforeload":"store.getProxy().extraParams.ledger = app.queryLedger.getValue();\n"},"children":[],"expanded":false,"type":"store"},{"configs":{"maximized":"true","height":"350","width":"600","layout":"border","closeAction":"hide","buttonAlign":"center","itemId":"faAdjWin","modal":"true","maximizable":"true"},"events":{"show":"app.JT.setValue('{#JT#}');","close":"app.grid.getStore().load();"},"children":[{"configs":{"region":"north","height":"105","bodyPadding":"10 20 0 10","itemId":"mainForm"},"children":[{"configs":{"hidden":"true","itemId":"hiddenPanel"},"children":[{"configs":{"itemId":"ADJ_H_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"OP_TYPE"},"children":[],"expanded":false,"type":"text"},{"configs":{"value":"{#JT#}","itemId":"JT","fieldLabel":"计提前后"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"AUDIT_STATUS"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"style":"border-width:0px;","layout":"column","border":"false","itemId":"t1"},"children":[{"configs":{"style":"border-width:0px;","layout":"form","columnWidth":".5","border":"false","itemId":"d1"},"children":[{"configs":{"labelWidth":"100","readOnly":"true","allowBlank":"false","displayField":"LEDGER_NAME","valueField":"LEDGER_ID","labelAlign":"right","itemId":"LEDGER","fieldLabel":"{#LEDGER#}<font color='red'>*<\/font>"},"events":{"select":"app.queryBtn.fireEvent('click');"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/com-qry/gl-ledgers/select-sec-fd-ledgers"},"children":[],"expanded":false,"type":"store"}],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"style":"border-width:0px;","layout":"form","columnWidth":".5","border":"false","itemId":"d2"},"children":[{"configs":{"labelWidth":"120","readOnly":"true","allowBlank":"false","labelAlign":"right","itemId":"ADJ_DATE","fieldLabel":"{#ADJ_DATE#}"},"children":[],"expanded":false,"type":"date"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"style":"border-width:0px;","layout":"column","border":"false","itemId":"t2"},"children":[{"configs":{"style":"border-width:0px;","layout":"form","columnWidth":"1","border":"false","itemId":"d1"},"children":[{"configs":{"labelWidth":"100","allowBlank":"false","labelAlign":"right","itemId":"BZSM","fieldLabel":"{#BZSM#}<font color='red'>*<\/font>"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"style":"border-width:0px;","layout":"column","border":"false","itemId":"t3"},"children":[{"configs":{"style":"border-width:0px;","layout":"form","columnWidth":".5","border":"false","itemId":"d1"},"children":[{"configs":{"labelWidth":"100","readOnly":"true","labelAlign":"right","itemId":"CREATED_BY","fieldLabel":"{#CREATED_BY#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"style":"border-width:0px;","layout":"form","columnWidth":".5","border":"false","itemId":"d2"},"children":[{"configs":{"labelWidth":"120","readOnly":"true","labelAlign":"right","itemId":"DOC_NUM","fieldLabel":"{#DOC_NUM#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":false,"type":"panel"}],"expanded":true,"type":"form"},{"configs":{"region":"center","multiSelect":"false","itemId":"subGrid","simpleSelect":"false","editable":"true"},"events":{"tagEvents":"beforeedit: function(editor,e,eOpts ){\n  if(app.OP_TYPE.getValue()=='_modified' && app.AUDIT_STATUS.getValue()=='S'){\n    return false;\n  }\n  if(e.colIdx == 8){\n    var selRecord = app.subGrid.getStore().getAt(e.rowIdx);\n    var adjType = selRecord.get('ADJ_TYPE');\n    if(Ext.isEmpty(adjType)){\n      Wb.toast('{#selectAdjTypeFirst#}');\n      return false;\n    }\n    \n    var temp = null;\n    if(adjType=='CAT_CODE'){\n      temp = {\n        xtype:\"combo\",\n        displayField:\"CAT_NAME\",\n        valueField:\"CAT_CODE\",\n        store:{\n          url:\"m?xwl=xc/fa/daily-business/fa-adj/data/getCatTypeByAsset\",\n          listeners:{\n            beforeload:function(store, operation, eOpts){\n              store.getProxy().extraParams.ledgerId = app.LEDGER.getValue();\n              store.getProxy().extraParams.assetId = selRecord.get('ASSET_ID');\n            }\n          }\n        },\n        listeners:{\n          select:function(combo, records, options){\n            app.subGrid.plugins[0].completeEdit();\n            selRecord.set('NEW_VAL', combo.getValue());\n            selRecord.set('NEW_VAL_VIEW', combo.getRawValue());\n          }\n        }\n      };\n    }else if(adjType=='ZJFF'){\n      temp = {\n        xtype:\"combo\",\n        displayField:\"METHOD_NAME\",\n        valueField:\"METHOD_CODE\",\n        store:{url:\"m?xwl=xc/fa/daily-business/fa-adj/data/getZjff\"},\n        listeners:{\n          select:function(combo, records, options){\n            app.subGrid.plugins[0].completeEdit();\n            selRecord.set('NEW_VAL', combo.getValue());\n            selRecord.set('NEW_VAL_VIEW', combo.getRawValue());\n          }\n        }\n      };\n    }else if(adjType=='CZL' || adjType=='JZZB' || adjType=='LJZJ_LJTX' || adjType=='SYNX' || adjType=='YZ'){\n      temp = {\n        xtype:\"numberfield\",\n        minValue:'0',\n        listeners:{\n          blur:function(comp, e, options){\n            selRecord.set('NEW_VAL', this.getValue());\n          }\n        }\n      };\n    }else if(adjType=='ZCYT'){\n      temp = {\n        xtype:\"combo\",\n        displayField:\"USE_NAME\",\n        valueField:\"USE_CODE\",\n        store:{\n          url:\"m?xwl=xc/fa/daily-business/fa-adj/data/getZcytByAsset\",\n          listeners:{\n            beforeload:function(store, operation, eOpts){\n              store.getProxy().extraParams.assetId = selRecord.get('ASSET_ID');\n            }\n          }\n        },\n        listeners:{\n          select:function(combo, records, options){\n            app.subGrid.plugins[0].completeEdit();\n            selRecord.set('NEW_VAL', combo.getValue());\n            selRecord.set('NEW_VAL_VIEW', combo.getRawValue());\n          }\n        }\n      };\n    }else if(adjType=='SFZJ'){\n      temp = {\n        xtype:\"combo\",\n        store:[['Y','是'],['N','否']],\n        listeners:{\n          select:function(combo, records, options){\n            app.subGrid.plugins[0].completeEdit();\n            selRecord.set('NEW_VAL', combo.getValue());\n            selRecord.set('NEW_VAL_VIEW', combo.getRawValue());\n          }\n        }\n      };\n    }else if(adjType=='JZZBKM' || adjType=='LJZJTXKM' || adjType=='ZCKM'){\n      temp = {\n        xtype:\"controlpicker\",\n        id:'col8Picker',\n        triggerCls:\"x-form-search-trigger\",\n        listeners:{\n          expand:function(picker,options){\n            Ext.getCmp('kmSeekBtn').fireEvent('click');\n          }\n        },\n        pickComp:{\n          id:'kmPickComp',\n          xtype:\"grid\",\n          height:240,\n          barExportButtons:false,\n          barExportAllButtons:false,\n          forceFit:true,\n          minWidth:420,listeners:{\n            itemclick:function(view, record, item, index, e, options){\n              var accCode = record.get('ACC_CODE');\n              var accName = record.get('ACC_NAME');\n\n              app.subGrid.plugins[0].completeEdit();\n\n              selRecord.set('NEW_VAL', accCode);\n              selRecord.set('NEW_VAL_VIEW', accName);\n\n              //var picker = this.ownerCmp;\n              //picker.collapse();\n            }\n          },\n          store:{\n            url:\"m?xwl=xc/com-lov/ACC_ID_PICK/DB/XC_BG_LD_ACCOUNTS_SELECT_LD\",\n            listeners:{\n              beforeload:function(store,operation,options){\n                store.proxy.extraParams.QUERY_LEDGER_ID = app.LEDGER.getValue();\n                store.proxy.extraParams.QUERY_CODE_NAME = Ext.getCmp('kmSeekCondition').getValue() ;\n              }\n            }\n          },\n          columns:[\n            {hidden:true, width:50, dataIndex:\"ACC_ID\"},\n            {text:\"\", width:100, dataIndex:\"ACC_CODE\", titleAlign:\"center\"},\n            {text:\"\", width:200, dataIndex:\"ACC_NAME\", titleAlign:\"center\"}\n          ],\n          tbar:{\n            xtype:\"toolbar\",\n            items:[\n              {\n                id:'kmSeekCondition',\n                xtype:\"textfield\",\n                emptyText:\"{#kmSeekCondition#}\", listeners:{\n                  specialkey:function(text, e, options){\n                    if(Ext.EventObject.getKey() == 13){\n                      Ext.getCmp('kmSeekBtn').fireEvent('click') ;\n                    }\n                  }\n                }\n              },{\n                id:'kmSeekBtn',\n                xtype:\"button\", \n                iconCls:\"seek_icon\",\n                listeners:{\n                  click:function(button,e,options){\n                    Ext.getCmp('kmPickComp').getStore().load() ;\n                  }\n                }\n              },{\n                xtype:\"button\",\n                iconCls:\"cancel_icon\",\n                listeners:{\n                  click:function(button,e,options){\n                    selRecord.set('NEW_VAL', '');\n                    selRecord.set('NEW_VAL_VIEW', '');\n                    \n                    Ext.getCmp('col8Picker').setValue('');\n\n                    Ext.getCmp('kmSeekCondition').setValue('');\n                    Ext.getCmp('kmSeekBtn').fireEvent('click') ;\n                  }\n                }\n              }\n            ]\n          }\n        }\n      };\n    }else if(adjType == 'CBZX'){\n      temp = {\n        id:'cbzxPick4grid',\n        xtype:\"controlpicker\",\n        triggerCls:\"x-form-search-trigger\",\n        labelAlign:\"right\",\n        editable:false,\n        listeners:{\n          expand:function(picker,options){\n            Ext.getCmp('findLdDepts4Grid').fireEvent('click') ;\n          }\n        },\n        pickComp:{\n          xtype:\"grid\",\n          height:240,\n          barExportButtons:false,\n          barExportAllButtons:false,\n          forceFit:true,\n          minWidth:420,\n          id:'cbzxPickComp4Grid',\n          listeners:{\n            itemclick:function(view,record,item,index,e,options){\n              // 选择成本中心\n              var deptId = record.get('DEPT_ID');\n              var deptName = record.get('DEPT_NAME');\n              \n              selRecord.set('NEW_VAL', deptId);\n              selRecord.set('NEW_VAL_VIEW', deptName);\n\n              var picker = this.ownerCmp;\n              picker.collapse();\n            }\n          },\n          store:{\n            url:\"m?xwl=xc/fa/daily-business/fa-adj/data/getDepts\",\n            listeners:{\n              beforeload:function(store,operation,options){\n                store.proxy.extraParams.textStr = Ext.getCmp('deptCodeOrName4Grid').getValue() ;\n                store.proxy.extraParams.ledger = app.LEDGER.getValue() ;\n              }\n            }\n          },\n          columns:[\n            {\n              hidden:true,\n              width:50,\n              dataIndex:\"DEPT_ID\",\n              titleAlign:\"center\"            \n            },{\n              text:\"\",\n              width:100,\n              dataIndex:\"DEPT_CODE\"\n            },{\n              text:\"\",\n              width:200,\n              dataIndex:\"DEPT_NAME\",\n              titleAlign:\"center\"\n            }\n          ],\n          tbar:{\n            xtype:\"toolbar\",\n            items:[{\n              xtype:\"textfield\",\n              id:\"deptCodeOrName4Grid\",\n              listeners:{\n                specialkey:function(text,e,options){\n                  if(Ext.EventObject.getKey() == 13){\n                    Ext.getCmp('findLdDepts4Grid').fireEvent('click') ;\n                  }\n                }\n              }\n            },{\n              xtype:\"button\",\n              id:\"findLdDepts4Grid\",\n              iconCls:\"seek_icon\",\n              listeners:{\n                click:function(button,e,options){\n                  Ext.getCmp('cbzxPickComp4Grid').getStore().load(function(){\n                    Ext.getCmp('deptCodeOrName4Grid').focus();\n                  }) ;\n                }\n              }\n            },{\n              xtype:\"button\",\n              iconCls:\"cancel_icon\",\n              listeners:{\n                click:function(button,e,options){\n                  selRecord.set('NEW_VAL', '');\n                  selRecord.set('NEW_VAL_VIEW', '');\n                  Ext.getCmp('cbzxPick4grid').setValue('');\n                  Ext.getCmp('deptCodeOrName4Grid').setValue() ;\n                  app.findLdDepts.fireEvent('click') ;\n                }\n              }\n            }]\n          }\n        }\n      }\n    }\n    \n    e.column.setEditor(temp);\n  }else if(e.colIdx == 9){\n    var selRecord = app.subGrid.getStore().getAt(e.rowIdx);\n    var temp = {\n      xtype:\"controlpicker\",\n      id:'dfkmPicker',\n      triggerCls:\"x-form-search-trigger\",\n      listeners:{\n        expand:function(picker,options){\n          Ext.getCmp('dfkmSeekBtn').fireEvent('click');\n        }\n      },\n      pickComp:{\n        id:'dfkmPickComp',\n        xtype:\"grid\",\n        height:240,\n        barExportButtons:false,\n        barExportAllButtons:false,\n        forceFit:true,\n        minWidth:420,listeners:{\n          itemclick:function(view, record, item, index, e, options){\n            var accCode = record.get('ACC_CODE');\n            var accName = record.get('ACC_NAME');\n\n            app.subGrid.plugins[0].completeEdit();\n\n            selRecord.set('DFKM', accCode);\n            selRecord.set('DFKM_VIEW', accName);\n\n            //var picker = this.ownerCmp;\n            //picker.collapse();\n          }\n        },\n        store:{\n          url:\"m?xwl=xc/com-lov/ACC_ID_PICK/DB/XC_BG_LD_ACCOUNTS_SELECT_LD\",\n          listeners:{\n            beforeload:function(store,operation,options){\n              store.proxy.extraParams.QUERY_LEDGER_ID = app.LEDGER.getValue();\n              store.proxy.extraParams.QUERY_CODE_NAME = Ext.getCmp('dfkmSeekCondition').getValue() ;\n            }\n          }\n        },\n        columns:[\n          {hidden:true, width:50, dataIndex:\"ACC_ID\"},\n          {text:\"\", width:100, dataIndex:\"ACC_CODE\", titleAlign:\"center\"},\n          {text:\"\", width:200, dataIndex:\"ACC_NAME\", titleAlign:\"center\"}\n        ],\n        tbar:{\n          xtype:\"toolbar\",\n          items:[\n            {\n              id:'dfkmSeekCondition',\n              xtype:\"textfield\",\n              emptyText:\"{#kmSeekCondition#}\", listeners:{\n                specialkey:function(text, e, options){\n                  if(Ext.EventObject.getKey() == 13){\n                    Ext.getCmp('dfkmSeekBtn').fireEvent('click') ;\n                  }\n                }\n              }\n            },{\n              id:'dfkmSeekBtn',\n              xtype:\"button\", \n              iconCls:\"seek_icon\",\n              listeners:{\n                click:function(button,e,options){\n                  Ext.getCmp('dfkmPickComp').getStore().load() ;\n                }\n              }\n            },{\n              xtype:\"button\",\n              iconCls:\"cancel_icon\",\n              listeners:{\n                click:function(button,e,options){\n                  selRecord.set('DFKM', '');\n                  selRecord.set('DFKM_VIEW', '');\n                  Ext.getCmp('dfkmPicker').setValue('');\n\n                  Ext.getCmp('dfkmSeekCondition').setValue('');\n                  Ext.getCmp('dfkmSeekBtn').fireEvent('click') ;\n                }\n              }\n            }\n          ]\n        }\n      }\n    };\n    e.column.setEditor(temp);\n  }else{\n    return true;\n  }\n}"},"children":[{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"{#addSubBtn#}","itemId":"addSubBtn","iconCls":"file_add_icon"},"events":{"click":"if(Ext.isEmpty(app.LEDGER.getValue())){\n  Wb.toast('{#selectLedgerMsgTips#}');\n  return;\n}\napp.queryLedger_addition.setValue(app.LEDGER.getValue());\n\napp.KM_XWL.QUERY_LEDGER_ID.setValue(app.LEDGER.getValue());\napp.DFKM_XWL.QUERY_LEDGER_ID.setValue(app.LEDGER.getValue());\n\napp.faAdditionWin.show();"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"-","itemId":"sp1"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#delSubBtn#}","itemId":"delSubBtn","iconCls":"file_delete_icon"},"events":{"click":"var records = app.subGrid.getSelection();\n//app.subGrid.getStore().remove(record);\n\nif(records.lenght==0){\n  Wb.toast('{#deleteCheckMsg#}');\n  return;\n}\n\nvar delRecords = [];\n\nfor(var i=0; i<records.length; i++){\n  if(!Ext.isEmpty(records[i].get('ADJ_D_ID'))){\n    delRecords.push(records[i]);\n  }\n}\n\nWb.confirm('{#deleteConfirmMsg#}', function() {\n  if(delRecords.length > 0){\n    Wb.request({\n      url: 'm?xwl=xc/fa/daily-business/fa-adj/data/deleteSub',\n      params: {data:Wb.getData(delRecords)},\n      success: function(resp) {\n        app.subGrid.getStore().remove(records);\n      }\n    });\n  }else{\n    app.subGrid.getStore().remove(records);\n  }\n\n});"},"children":[],"expanded":false,"type":"item"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"width":"40","align":"center","xtype":"rownumberer","titleAlign":"center","itemId":"rowCol"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#zcbmCol#}","width":"180","dataIndex":"ZCBM","itemId":"zcbmCol"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#zcmcCol#}","width":"180","dataIndex":"ZCMC","itemId":"zcmcCol"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#adjTypeCol#}","hidden":"true","width":"180","dataIndex":"ADJ_TYPE","itemId":"adjTypeCol"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#adjTypeCol#}","width":"180","dataIndex":"ADJ_TYPE_VIEW","itemId":"adjTypeViewCol"},"children":[{"configs":{"displayField":"TRANS_DESC","valueField":"TRANS_CODE","itemId":"editor"},"events":{"select":"app.subGrid.plugins[0].completeEdit();\n\nvar record = app.subGrid.getSelection()[0];\nrecord.set('ADJ_TYPE', records[0].get('TRANS_CODE'));\nrecord.set('ADJ_TYPE_VIEW', records[0].get('TRANS_DESC'));\nrecord.set('VOUCHER_FLAG', records[0].get('VOUCHER_FLAG'));\n\n//查询调整前值\nExt.Msg.wait('{#loadWaitMsg#}');\nExt.Ajax.request({\n  url : 'm?xwl=xc/fa/daily-business/fa-adj/data/getAdjOldValue',\n  method: 'POST',\n  params:{\"adjType\":records[0].get('TRANS_CODE'), \"asSetId\":record.get('ASSET_ID')},\n  success: function(response,options){\n    Ext.Msg.hide();\n    var temp = response.responseText;\n    var resp = Ext.JSON.decode(temp);\n    \n    record.set('OLD_VAL', resp.OLD_VALUE);\n    record.set('OLD_VAL_VIEW', resp.OLD_VALUE_VIEW);\n    \n    record.set('NEW_VAL', '');\n    record.set('NEW_VAL_VIEW', '');\n  },\n  failure: function(response,options){\n    Ext.Msg.hide();\n    Wb.error('{#syncFailureMsg#}');\n  }\n});"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/fa/daily-business/fa-adj/data/getTranTypes"},"events":{"beforeload":"store.getProxy().extraParams.zjType = '{#JT#}';"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"}],"expanded":false,"type":"column"},{"configs":{"text":"{#oldValueCol#}","hidden":"true","width":"180","dataIndex":"OLD_VAL","itemId":"oldValueCol"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#oldValueCol#}","width":"180","dataIndex":"OLD_VAL_VIEW","itemId":"oldValueViewCol"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#newValueCol#}","hidden":"true","width":"180","dataIndex":"NEW_VAL","itemId":"newValueCol"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#newValueCol#}","width":"180","dataIndex":"NEW_VAL_VIEW","itemId":"newValueViewCol"},"children":[{"configs":{"itemId":"editor"},"children":[],"expanded":false,"type":"text"}],"expanded":false,"type":"column"},{"configs":{"text":"{#dfkmCol#}","width":"180","dataIndex":"DFKM_VIEW","itemId":"dfkmViewCol"},"children":[{"configs":{"itemId":"editor"},"children":[],"expanded":false,"type":"text"}],"expanded":false,"type":"column"},{"configs":{"text":"{#dfkmCol#}","hidden":"true","width":"180","dataIndex":"DFKM","itemId":"dfkmCol"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"ADJ_D_ID","hidden":"true","dataIndex":"ADJ_D_ID","itemId":"adjDidCol"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"ADJ_H_ID","hidden":"true","dataIndex":"ADJ_H_ID","itemId":"adjHidCol"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"ASSET_ID","hidden":"true","dataIndex":"ASSET_ID","itemId":"assetId"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"VOUCHER_FLAG","hidden":"true","dataIndex":"VOUCHER_FLAG","itemId":"VOUCHER_FLAG"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"store","url":"m?xwl=xc/fa/daily-business/fa-adj/data/getAdjLByHid"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"grid"},{"configs":{"itemId":"buttons"},"children":[{"configs":{"text":"{#saveBtn#}","itemId":"saveBtn","iconCls":"save_icon"},"events":{"click":"if(Ext.isEmpty(app.LEDGER.getValue())){\n  Wb.toast('{#selectLedgerMsgTips#}');\n  return;\n}\n\nif(!app.mainForm.getForm().isValid()){\n  Wb.toast('{#checkRequired#}');\n  return;\n}\n\nfor(var i=0; i<app.subGrid.getStore().getCount(); i++){\n  var recordi = app.subGrid.getStore().getAt(i);\n  \n  // 检查信息是否填写完整\n  if(Ext.isEmpty(recordi.get('ADJ_TYPE'))){\n    Wb.toast('{#selectAdjTypeFirst#}');\n    return;\n  }\n  if(Ext.isEmpty(recordi.get('NEW_VAL'))){\n    Wb.toast('{#selectNewValueFirst#}');\n    return;\n  }\n  \n  //减值准备、原值、累计折旧必须录入对方科目\n  if(recordi.get('ADJ_TYPE')=='JZZB' || recordi.get('ADJ_TYPE')=='YZ' || recordi.get('ADJ_TYPE')=='LJZJ_LJTX'){\n    if(Ext.isEmpty(recordi.get('DFKM'))){\n      Wb.toast('{#dfkmIsNotNull#}');\n      return;\n    }\n  }\n  \n  //不能存在相同资产，相同调整类型的记录\n  var sameRecordSize = 0;\n  for(var j=0; j<app.subGrid.getStore().getCount(); j++){\n    if(i==j){\n      continue;\n    }\n    var recordj = app.subGrid.getStore().getAt(j);\n    if(!Ext.isEmpty(recordi.get('ADJ_TYPE')) && !Ext.isEmpty(recordj.get('ADJ_TYPE')) && recordi.get('ADJ_TYPE')==recordj.get('ADJ_TYPE') && recordi.get('ZCBM')==recordj.get('ZCBM')){\n      sameRecordSize++;\n    }\n  }\n  if(sameRecordSize>=1){\n    Wb.toast('{#checkSameRecord#}');\n    return;\n  }\n}\n\nvar checkPeriodCodeFlag = true;\n\n// 校验调整日期所在期间是否打开\nvar periodCode = app.ADJ_DATE.getRawValue().substring(0, 7);\n// 提交ajax请求\nExt.Msg.wait('{#checkPeriodCode#}');\nExt.Ajax.request({\n  url: 'm?xwl=xc/fa/daily-business/fa-adj/data/checkPeriodCode',\n  method: 'POST',\n  async: false,\n  timeout: 300000,\n  params: {ledgerId: app.LEDGER.getValue(), periodCode: periodCode},\n  success: function(res, opts) {\n    Ext.Msg.hide();\n\n    var temp = res.responseText;\n    var resp = Ext.JSON.decode(temp);\n\n    if(resp.flag == 0){\n      Wb.toast('{#periodNotOpened#}');\n      checkPeriodCodeFlag = false;\n    }else if(resp.flag == 2){\n      Wb.toast('{#periodIsClosed#}');\n      checkPeriodCodeFlag = false;\n    }\n  },\n  failure: function(res, opts) {\n    Ext.Msg.hide();\n    Wb.error('{#checkPeriodFailureMsg#}');\n    checkPeriodCodeFlag = false;\n  }\n});\n\nif(checkPeriodCodeFlag == false){\n  return;\n}\n\n//LJZJ_LJTX、CZL、YZ、JZZB 计提期间必须和当前打开期间相同才可以修改\nif(app.OP_TYPE.getValue()=='_modified'){\n  var _modifiedRecords = app.subGrid.getStore().getModifiedRecords();\n  if(_modifiedRecords.length > 0){\n    for(var i=0; i<_modifiedRecords.length; i++){\n      var result = 0;\n\n      var assetId = _modifiedRecords[i].get('ASSET_ID');\n      Ext.Msg.wait('{#checkPeriodCode#}');\n      Ext.Ajax.request({\n        url: 'm?xwl=xc/fa/daily-business/fa-adj/data/checkJtQj',\n        method: 'POST',\n        async: false,\n        timeout: 300000,\n        params: {assetId: assetId},\n        success: function(res, opts) {\n          Ext.Msg.hide();\n          var temp = res.responseText;\n          var resp = Ext.JSON.decode(temp);\n\n          result = resp.CNT;\n        },\n        failure: function(res, opts) {\n          Ext.Msg.hide();\n          Wb.error('{#checkPeriodFailureMsg#}');\n        }\n      });\n\n      if(_modifiedRecords[i].get('ADJ_TYPE')=='LJZJ_LJTX' || \n         _modifiedRecords[i].get('ADJ_TYPE')=='CZL' || \n         _modifiedRecords[i].get('ADJ_TYPE')=='YZ' || \n         _modifiedRecords[i].get('ADJ_TYPE')=='JZZB'){\n        if(result==0){\n          Wb.toast('{#checkCanSave#}');\n          return;\n        }\n      }\n    }\n  }\n\n}\n\nvar saveJson = {};\n\nvar faAdjH = {};\nfaAdjH.adjHid = app.ADJ_H_ID.getValue();\nfaAdjH.ledgerId = app.LEDGER.getValue();\nfaAdjH.adjDate = app.ADJ_DATE.getValue();\nfaAdjH.periodCode = periodCode;\nfaAdjH.bzsm = app.BZSM.getValue();\nfaAdjH.jtzjType = app.JT.getValue();\nsaveJson.faAdjH = faAdjH;\n\nvar faAdjLs = new Array();\nfor(var i=0; i<app.subGrid.getStore().getCount(); i++){\n  var record = app.subGrid.getStore().getAt(i);\n  var faAdjL = {};\n  faAdjL.adjHid = record.get('ADJ_H_ID');\n  faAdjL.adjDid = record.get('ADJ_D_ID');\n  faAdjL.assetId = record.get('ASSET_ID');\n  faAdjL.assetCode = record.get('ZCBM');\n  faAdjL.adjType = record.get('ADJ_TYPE');\n  faAdjL.adjViewType = record.get('ADJ_TYPE_VIEW');\n  faAdjL.oldVal = record.get('OLD_VAL');\n  faAdjL.oldViewVal = record.get('OLD_VAL_VIEW');\n  faAdjL.newVal = record.get('NEW_VAL');\n  faAdjL.newViewVal = record.get('NEW_VAL_VIEW');\n  faAdjL.dfkm = record.get('DFKM');\n  faAdjL.vouCherFlag = record.get('VOUCHER_FLAG');\n  faAdjLs.push(faAdjL);\n}\nsaveJson.faAdjLs = faAdjLs;\nsaveJson.opType = app.OP_TYPE.getValue();\n\nvar jsonData = Ext.JSON.encode(saveJson);\n\n// 提交ajax请求\nExt.Msg.wait('{#saveWaitMsg#}');\nExt.Ajax.request({\n  url: '{#contextPath#}' + '/faAdjAction.do?method=saveFaAdj',\n  method: 'POST',\n  sync: false,\n  timeout: 300000,\n  headers: {\n    'Content-Type': 'application/json'\n  },\n  jsonData: jsonData,\n  success: function(res, opts) {\n    Ext.Msg.hide();\n\n    var temp = res.responseText;\n    var resp = Ext.JSON.decode(temp);\n\n    if(resp.flag == 0){\n      Wb.toast('{#saveSuccessMsg#}');\n      app.faAdjWin.close();\n    }else{\n      Wb.error(resp.msg);\n    }\n  },\n  failure: function(res, opts) {\n    Ext.Msg.hide();\n    Wb.error('{#saveFailureMsg#}');\n  }\n});\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#cancelBtn#}","itemId":"cancelBtn","iconCls":"cancel_icon"},"events":{"click":"app.faAdjWin.close();"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"array"}],"expanded":true,"type":"window"},{"configs":{"height":"350","width":"700","layout":"border","closeAction":"hide","buttonAlign":"center","itemId":"faAdditionWin","modal":"true"},"events":{"beforeshow":"app.grid_addition.store.load();"},"children":[{"configs":{"region":"north","height":"45","layout":"column","border":"false","bodyPadding":"10 0 0 20","itemId":"queryPanel_addition"},"children":[{"configs":{"labelWidth":"60","displayField":"NAME","hidden":"true","width":"200","valueField":"ID","labelAlign":"right","itemId":"queryLedger_addition","fieldLabel":"{#queryLedger#}"},"events":{"select":"app.queryBtn_addition.fireEvent('click');"},"children":[{"configs":{"pageSize":"-1","itemId":"store","url":"m?xwl=xc/com-qry/gl-ledgers/select-sec-ledger"},"children":[],"expanded":false,"type":"store"}],"expanded":false,"type":"combo"},{"configs":{"labelWidth":"120","width":"250","labelAlign":"right","itemId":"queryFaCodeName_addition","fieldLabel":"{#queryFaCodeName#}"},"events":{"specialkey":"if(e.getKey() == 13){\n  app.queryBtn_addition.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"},{"configs":{"text":"{#queryBtn#}","width":"60","itemId":"queryBtn_addition","iconCls":"seek_icon","x":"20"},"events":{"click":"app.grid_addition.store.load();"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#resetBtn#}","width":"60","itemId":"resetBtn_addition","iconCls":"refresh_icon","x":"40"},"events":{"click":"app.queryFaCodeName_addition.setValue('');\napp.queryBtn_addition.fireEvent('click');"},"children":[],"expanded":false,"type":"button"}],"expanded":false,"type":"panel"},{"configs":{"region":"center","layout":"border","itemId":"gridPanel"},"children":[{"configs":{"region":"north","height":"42","bodyPadding":"4 0 0 0","itemId":"adjPanel"},"events":{"afterrender":"app.KM_XWL.ACC_NAME.hide();\napp.KM_XWL.ACC_NAME.fieldLabel = '{#AFTER_ADJ#}';\napp.KM_XWL.ACC_NAME.width = 250;"},"children":[{"configs":{"style":"border-width:0px;","layout":"column","border":"false","itemId":"t1_faw"},"children":[{"configs":{"style":"border-width:0px;","layout":"form","columnWidth":".4","border":"false","itemId":"d1"},"children":[{"configs":{"labelWidth":"120","displayField":"TRANS_DESC","valueField":"TRANS_CODE","labelAlign":"right","itemId":"ADJ_TYPE","fieldLabel":"{#ADJ_TYPE#}"},"events":{"select":"var adjType = combo.getValue();\n\napp.grid_addition.getStore().load();\n\nif(adjType=='CAT_CODE'){\n  hideComps(app.CAT_CODE);\n}else if(adjType=='ZJFF'){\n  hideComps(app.ZJFF);\n}else if(adjType=='CZL' || adjType=='JZZB' || adjType=='LJZJ_LJTX' || adjType=='SYNX' || adjType=='YZ'){\n  hideComps(app.NUM_FIELD);\n}else if(adjType=='ZCYT'){\n  hideComps(app.ZCYT);\n}else if(adjType=='SFZJ'){\n  hideComps(app.SFZJ);\n}else if(adjType=='JZZBKM' || adjType=='LJZJTXKM' || adjType=='ZCKM'){\n  hideComps(app.KM_XWL.ACC_NAME);\n}else if(adjType=='CBZX'){\n  hideComps(app.CBZX_NAME);\n}\n\nif(adjType=='JZZB' || adjType=='LJZJ_LJTX' || adjType=='YZ'){\n  app.t2_faw.show();\n  app.adjPanel.setHeight(72);\n}else{\n  app.adjPanel.setHeight(42);\n  app.t2_faw.hide();\n}\n\nfor(var i=0; i<app.grid_addition.getStore().getCount(); i++){\n  var record = app.grid_addition.getStore().getAt(i);\n  //record.set('ADJ_TYPE', records[0].get('TRANS_CODE'));\n  //record.set('ADJ_TYPE_VIEW', records[0].get('TRANS_DESC'));\n  record.set('VOUCHER_FLAG', records[0].get('VOUCHER_FLAG'));\n}\n"},"children":[{"configs":{"autoLoad":"false","itemId":"store","url":"m?xwl=xc/fa/daily-business/fa-adj/data/getTranTypes"},"events":{"beforeload":"store.getProxy().extraParams.zjType = app.JT.getValue();"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"style":"border-width:0px;","layout":"form","columnWidth":".4","border":"false","itemId":"d2"},"children":[{"configs":{"labelWidth":"120","displayField":"CAT_NAME","hidden":"true","valueField":"CAT_CODE","labelAlign":"right","itemId":"CAT_CODE","fieldLabel":"{#AFTER_ADJ#}"},"events":{"select":"//setSubGridNewVal(combo.getValue(), combo.getRawValue());\napp.grid_addition.getStore().load();"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/fa/daily-business/fa-adj/data/getCatType"},"events":{"beforeload":"store.getProxy().extraParams.ledgerId = app.queryLedger_addition.getValue();"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"},{"configs":{"labelWidth":"120","displayField":"METHOD_NAME","hidden":"true","valueField":"METHOD_CODE","labelAlign":"right","itemId":"ZJFF","fieldLabel":"{#AFTER_ADJ#}"},"events":{"select":"//setSubGridNewVal(combo.getValue(), combo.getRawValue());"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/fa/daily-business/fa-adj/data/getZjff"},"children":[],"expanded":false,"type":"store"}],"expanded":false,"type":"combo"},{"configs":{"labelWidth":"120","hidden":"true","minValue":"0","labelAlign":"right","itemId":"NUM_FIELD","fieldLabel":"{#AFTER_ADJ#}"},"events":{"blur":"//setSubGridNewVal(this.getValue(), this.getValue());"},"children":[],"expanded":false,"type":"number"},{"configs":{"labelWidth":"120","displayField":"USE_NAME","hidden":"true","valueField":"USE_CODE","labelAlign":"right","itemId":"ZCYT","fieldLabel":"{#AFTER_ADJ#}"},"events":{"select":"//setSubGridNewVal(combo.getValue(), combo.getRawValue());\napp.grid_addition.getStore().load();"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/fa/daily-business/fa-adj/data/getZcyt"},"children":[],"expanded":false,"type":"store"}],"expanded":false,"type":"combo"},{"configs":{"labelWidth":"120","hidden":"true","labelAlign":"right","pickList":"[['Y','是'],['N','否']]","itemId":"SFZJ","fieldLabel":"{#AFTER_ADJ#}"},"events":{"select":"//setSubGridNewVal(combo.getValue(), combo.getRawValue());"},"children":[],"expanded":true,"type":"combo"},{"configs":{"file":"m?xwl=xc/fa/common/ACC_PICK/ACC_LD","itemId":"KM_XWL"},"children":[],"expanded":false,"type":"xwl"},{"configs":{"hidden":"true","itemId":"CBZX"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"120","allowBlank":"false","triggerCls":"x-form-search-trigger","labelAlign":"right","itemId":"CBZX_NAME","fieldLabel":"{#AFTER_ADJ#}","editable":"false"},"events":{"expand":"app.findLdDepts.fireEvent('click') ;"},"children":[{"configs":{"tagConfigs":"minWidth:420,\nid:'cbzxPickComp'","height":"240","barExportAllButtons":"false","barExportButtons":"false","itemId":"pickComp","forceFit":"true"},"events":{"itemclick":"// 选择成本中心\nvar deptId = record.get('DEPT_ID');\nvar deptName = record.get('DEPT_NAME');\n\napp.CBZX_NAME.setValue(deptName);\napp.CBZX.setValue(deptId);\n\n// app.pickComp.hide() ;\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/fa/daily-business/fa-adj/data/getDepts"},"events":{"beforeload":"store.proxy.extraParams.textStr = app.deptCodeOrName.getValue() ;\n\nstore.proxy.extraParams.ledger = app.queryLedger_addition.getValue() ;"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","width":"50","dataIndex":"DEPT_ID","titleAlign":"center","itemId":"DEPT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#DEPT_CODE#}","width":"100","dataIndex":"DEPT_CODE","titleAlign":"center","itemId":"DEPT_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#DEPT_NAME#}","width":"200","dataIndex":"DEPT_NAME","titleAlign":"center","itemId":"DEPT_NAME_COL"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"itemId":"deptCodeOrName"},"events":{"specialkey":"if(Ext.EventObject.getKey() == 13){\n  app.findLdDepts.fireEvent('click') ;\n}"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"findLdDepts","iconCls":"seek_icon"},"events":{"click":"Ext.getCmp('cbzxPickComp').getStore().load(function(){\n  app.deptCodeOrName.focus();\n}) ;"},"children":[],"expanded":false,"type":"button"},{"configs":{"itemId":"clearLdDepts","iconCls":"cancel_icon"},"events":{"click":"app.CBZX.setValue();\napp.CBZX_NAME.setValue() ;\napp.deptCodeOrName.setValue() ;\napp.findLdDepts.fireEvent('click') ;"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"}],"expanded":false,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"style":"border-width:0px;","hidden":"true","layout":"column","border":"false","itemId":"t2_faw"},"children":[{"configs":{"style":"border-width:0px;","layout":"form","columnWidth":".8","border":"false","itemId":"d1"},"children":[{"configs":{"file":"m?xwl=xc/fa/common/ACC_PICK/ACC_LD","itemId":"DFKM_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":false,"type":"panel"},{"configs":{"region":"center","multiSelect":"true","selType":"checkboxmodel","itemId":"grid_addition","simpleSelect":"true"},"events":{"itemdblclick":"app.ensureBtn.fireEvent('cilck');"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/fa/daily-business/fa-adj/data/getFaAdditions"},"events":{"beforeload":"var whereSql = \" 1=1 \";\n\nif(!Ext.isEmpty(app.queryLedger_addition.getValue())){\n  whereSql = whereSql + \" and s.LEDGER_ID = '\" + app.queryLedger_addition.getValue() + \"' \";\n}\n\nif(!Ext.isEmpty(app.queryFaCodeName_addition.getValue())){\n  whereSql = whereSql + \" and (s.ZCBM like '%\" + app.queryFaCodeName_addition.getValue() + \"%' or s.ZCMC like '%\" + app.queryFaCodeName_addition.getValue() + \"%') \";\n}\n\nif('{#JT#}'=='A'){\n  //whereSql = whereSql + \" and s.PERIOD_CODE = (select p.PERIOD_CODE from xc_fa_ld_periods p where p.LEDGER_ID = s.LEDGER_ID and p.STATUS=1)\";\n  whereSql = whereSql + \" and ((s.JTQJ is not null and s.JTQJ <> '' and s.JTQJ = (SELECT p.PERIOD_CODE FROM xc_fa_ld_periods p WHERE p.LEDGER_ID = s.LEDGER_ID AND p.STATUS = 1)) or s.SFZJ='N') \";\n}\n\nif(app.ADJ_TYPE.getValue()=='ZCYT'){\n  if(!Ext.isEmpty(app.ZCYT.getValue())){\n    var rec = app.ZCYT.getStore().findRecord('USE_CODE', app.ZCYT.getValue());\n    whereSql = whereSql + \" and s.FA_PROPERTY = '\" + rec.get('FA_PROPERTY') + \"'\";\n  }\n}else if(app.ADJ_TYPE.getValue()=='CAT_CODE'){\n  if(!Ext.isEmpty(app.CAT_CODE.getValue())){\n    var rec = app.CAT_CODE.getStore().findRecord('CAT_CODE', app.CAT_CODE.getValue());\n    whereSql = whereSql + \" and s.FA_PROPERTY = '\" + rec.get('FA_PROPERTY') + \"'\";\n  }\n}\n\nwhereSql = whereSql + \" and (s.QLRQ is null or s.QLRQ = '') and (s.QLQJ is null or s.QLQJ = '') and (s.QLYY is null or s.QLYY = '') \";\n\nstore.getProxy().extraParams.whereSql = whereSql;\n"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"width":"40","align":"center","xtype":"rownumberer","titleAlign":"center","itemId":"rowCol"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#ledgerNameCol#}","hidden":"true","dataIndex":"LEDGER_NAME","itemId":"ledgerNameCol"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#periodsCodeCol#}","hidden":"true","dataIndex":"PERIOD_CODE","itemId":"periodsCodeCol"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#zcbmCol#}","width":"160","dataIndex":"ZCBM","itemId":"zcbmCol"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#zcmcCol#}","width":"160","dataIndex":"ZCMC","itemId":"zcmcCol"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#catCodeCol#}","width":"160","dataIndex":"CAT_NAME","itemId":"catCodeCol"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#faPropertyCol#}","width":"120","dataIndex":"FA_PROPERTY_VIEW","itemId":"faPropertyCol"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"VOUCHER_FLAG","hidden":"true","dataIndex":"VOUCHER_FLAG","itemId":"VOUCHER_FLAG"},"children":[],"expanded":false,"type":"column"}],"expanded":false,"type":"array"}],"expanded":false,"type":"grid"}],"expanded":false,"type":"panel"},{"configs":{"itemId":"buttons"},"children":[{"configs":{"text":"{#ensureBtn#}","itemId":"ensureBtn","iconCls":"ok_icon"},"events":{"click":"var records = app.grid_addition.getSelection();\nif (records.length==0) {\n  Wb.warn('{#ensureCheckMsg#}');\n  return;\n}\n\nvar insertRecords = new Array();\n\nvar adjType = app.ADJ_TYPE.getValue();\nvar adjValue = '';\nvar adjViewValue = '';\n\nif(adjType=='CAT_CODE'){\n  adjValue = app.CAT_CODE.getValue();\n  adjViewValue = app.CAT_CODE.getRawValue();\n}else if(adjType=='ZJFF'){\n  adjValue = app.ZJFF.getValue();\n  adjViewValue = app.ZJFF.getRawValue();\n}else if(adjType=='CZL' || adjType=='JZZB' || adjType=='LJZJ_LJTX' || adjType=='SYNX' || adjType=='YZ'){\n  adjValue = app.NUM_FIELD.getValue();\n  adjViewValue = app.NUM_FIELD.getValue();\n}else if(adjType=='ZCYT'){\n  adjValue = app.ZCYT.getValue();\n  adjViewValue = app.ZCYT.getRawValue();\n}else if(adjType=='SFZJ'){\n  adjValue = app.SFZJ.getValue();\n  adjViewValue = app.SFZJ.getRawValue();\n}else if(adjType=='JZZBKM' || adjType=='LJZJTXKM' || adjType=='ZCKM'){\n  adjValue = app.KM_XWL.ACC_CODE.getValue();\n  adjViewValue = app.KM_XWL.ACC_NAME.getValue();\n}else if(adjType=='CBZX'){\n  adjValue = app.CBZX.getValue();\n  adjViewValue = app.CBZX_NAME.getValue();\n}\n\nvar dfkm = '';\nvar dfViewKm = '';\nif(adjType=='JZZB' || adjType=='LJZJ_LJTX' || adjType=='YZ'){\n  dfkm = app.DFKM_XWL.ACC_CODE.getValue();\n  dfViewKm = app.DFKM_XWL.ACC_NAME.getValue();\n}\n\n\nfor(var i=0; i<records.length; i++){\n  var record = {};\n  Ext.apply(record, records[i].data);\n  record.ADJ_H_ID = app.ADJ_H_ID.getValue();\n  if(!Ext.isEmpty(app.ADJ_TYPE.getValue())){\n    record.ADJ_TYPE = app.ADJ_TYPE.getValue();\n    record.ADJ_TYPE_VIEW = app.ADJ_TYPE.getRawValue();\n  }\n  \n  if(adjType=='CAT_CODE'){\n    record.OLD_VAL = records[i].get('CAT_CODE');\n    record.OLD_VAL_VIEW = records[i].get('CAT_NAME');\n  }else if(adjType=='ZJFF'){\n    record.OLD_VAL = records[i].get('ZJFF');\n    record.OLD_VAL_VIEW = records[i].get('METHOD_NAME');\n  }else if(adjType=='CZL'){\n    record.OLD_VAL = records[i].get('CZL');\n    record.OLD_VAL_VIEW = records[i].get('CZL');\n  }else if(adjType=='JZZB'){\n    record.OLD_VAL = records[i].get('JZZB');\n    record.OLD_VAL_VIEW = records[i].get('JZZB');\n  }else if(adjType=='LJZJ_LJTX'){\n    record.OLD_VAL = records[i].get('LJZJ_LJTX');\n    record.OLD_VAL_VIEW = records[i].get('LJZJ_LJTX');\n  }else if(adjType=='SYNX'){\n    record.OLD_VAL = records[i].get('SYNX');\n    record.OLD_VAL_VIEW = records[i].get('SYNX');\n  }else if(adjType=='YZ'){\n    record.OLD_VAL = records[i].get('YZ');\n    record.OLD_VAL_VIEW = records[i].get('YZ');\n  }else if(adjType=='ZCYT'){\n    record.OLD_VAL = records[i].get('ZCYT');\n    record.OLD_VAL_VIEW = records[i].get('USE_NAME');\n  }else if(adjType=='SFZJ'){\n    record.OLD_VAL = records[i].get('SFZJ');\n    record.OLD_VAL_VIEW = records[i].get('SFZJ_VIEW');\n  }else if(adjType=='JZZBKM'){\n    record.OLD_VAL = records[i].get('JZZBKM');\n    record.OLD_VAL_VIEW = records[i].get('JZZBKM_VIEW');\n  }else if(adjType=='LJZJTXKM'){\n    record.OLD_VAL = records[i].get('LJZJTXKM');\n    record.OLD_VAL_VIEW = records[i].get('LJZJTXKM_VIEW');\n  }else if(adjType=='ZCKM'){\n    record.OLD_VAL = records[i].get('ZCKM');\n    record.OLD_VAL_VIEW = records[i].get('ZCKM_VIEW');\n  }else if(adjType=='CBZX'){\n    record.OLD_VAL = records[i].get('CBZX');\n    record.OLD_VAL_VIEW = records[i].get('CBZX_NAME');\n  }\n  \n  if(!Ext.isEmpty(adjValue)){\n    record.NEW_VAL = adjValue;\n    record.NEW_VAL_VIEW = adjViewValue;\n  }\n  \n  if(!Ext.isEmpty(dfkm)){\n    record.DFKM = dfkm;\n    record.DFKM_VIEW = dfViewKm;\n  }\n  \n  insertRecords.push(record);\n}\n\napp.subGrid.getStore().add(insertRecords);\n\napp.faAdditionWin.close();"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#cancelBtn#}","itemId":"cancelBtn","iconCls":"cancel_icon"},"events":{"click":"app.faAdditionWin.close();"},"children":[],"expanded":false,"type":"button"}],"expanded":false,"type":"array"}],"expanded":false,"type":"window"},{"configs":{"layout":"border","itemId":"viewport"},"events":{"afterrender":"app.queryLedger.getStore().load(function(){\n  if(app.queryLedger.getStore().getCount()>0){\n    app.queryLedger.setValue(app.queryLedger.getStore().getAt(0).get('ID'));\n    app.queryBtn.fireEvent('click');\n  }\n});"},"children":[{"configs":{"region":"north","height":"45","layout":"column","bodyPadding":"10 0 0 20","itemId":"queryPanel"},"children":[{"configs":{"labelWidth":"100","displayField":"NAME","width":"250","valueField":"ID","labelAlign":"right","itemId":"queryLedger","fieldLabel":"{#queryLedger#}"},"events":{"select":"app.queryBtn.fireEvent('click');"},"children":[{"configs":{"pageSize":"-1","itemId":"store","url":"m?xwl=xc/com-qry/gl-ledgers/select-sec-ledger"},"children":[],"expanded":false,"type":"store"}],"expanded":false,"type":"combo"},{"configs":{"labelWidth":"140","width":"260","labelAlign":"right","itemId":"queryDocNum","fieldLabel":"{#queryDocNum#}"},"events":{"specialkey":"if(e.getKey() == 13){\n  app.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"},{"configs":{"text":"{#queryBtn#}","width":"80","itemId":"queryBtn","iconCls":"seek_icon","x":"20"},"events":{"click":"app.grid.store.load();"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#resetBtn#}","width":"80","itemId":"resetBtn","iconCls":"refresh_icon","x":"40"},"events":{"click":"app.queryDocNum.setValue('');\napp.queryBtn.fireEvent('click');"},"children":[],"expanded":false,"type":"button"}],"expanded":false,"type":"panel"},{"configs":{"region":"center","selType":"checkboxmodel","itemId":"grid"},"events":{"itemdblclick":"app.editBtn.fireEvent('click');"},"children":[{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"{#addBtn#}","itemId":"addBtn","iconCls":"file_add_icon"},"events":{"click":"if(Ext.isEmpty(app.queryLedger.getValue())){\n  Wb.toast('{#selectLedgerMsgTips#}');\n  return;\n}\n\napp.faAdjWin.setTitle('{#addBtn#}');\n\nWb.reset(app.mainForm);\napp.subGrid.getStore().getProxy().extraParams.adjHid = '-1';\napp.subGrid.getStore().load();\napp.ADJ_H_ID.setValue(Xip.getId());\napp.AUDIT_STATUS.setValue('');\n//app.ADJ_DATE.setValue(new Date());\n\napp.LEDGER.getStore().load(function(){\n  app.LEDGER.setValue(app.queryLedger.getValue());\n});\n\napp.periodStore.load(function(){\n  if(app.periodStore.getCount()>0){\n    var pRecord = app.periodStore.getAt(0);\n    app.ADJ_DATE.setMinValue(pRecord.get('START_DATE'));\n    app.ADJ_DATE.setMaxValue(pRecord.get('END_DATE'));\n    \n    if('{#JT#}'=='B'){\n      app.ADJ_DATE.setValue(pRecord.get('START_DATE'));\n    }else{\n      app.ADJ_DATE.setValue(pRecord.get('END_DATE'));\n    }\n\n    /**if(pRecord.get('IN_PERIOD')=='1'){\n      app.ADJ_DATE.setValue(new Date());\n    }else{\n      app.ADJ_DATE.setValue(pRecord.get('END_DATE'));\n    }**/\n  }\n});\n\napp.faAdjWin.show();\n\napp.addSubBtn.show();\napp.delSubBtn.show();\napp.saveBtn.show();\napp.OP_TYPE.setValue(\"_added\");\n\n//app.ADJ_DATE.setReadOnly(false);\napp.BZSM.setReadOnly(false);"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"-","itemId":"sp1"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#editBtn#}","itemId":"editBtn","iconCls":"file_edit_icon"},"events":{"click":"var record = app.grid.getSelection()[0];\nif (!record) {\n  Wb.warn('{#editCheckMsg#}');\n  return;\n}\n\nvar statusView = '';\nif(record.get('AUDIT_STATUS')=='C'){\n  statusView = '{#statusC#}';\n}else{\n  statusView = '{#statucS#}';\n}\n\napp.faAdjWin.setTitle('{#editBtn#}'+' -- {#auditStatusCol#}【'+statusView+'】');\n\nWb.reset(app.mainForm);\n\napp.ADJ_DATE.setMinValue();\napp.ADJ_DATE.setMaxValue();\n\n//app.mainForm.getForm().loadRecord(record);\n\napp.ADJ_H_ID.setValue(record.get('ADJ_H_ID'));\napp.LEDGER.getStore().load(function(){\n  app.LEDGER.setValue(record.get('LEDGER_ID'));\n});\n\napp.ADJ_DATE.setValue(record.get('ADJ_DATE'));\napp.BZSM.setValue(record.get('BZSM'));\napp.CREATED_BY.setValue(record.get('CREATED_BY_NAME'));\napp.DOC_NUM.setValue(record.get('DOC_NUM'));\napp.AUDIT_STATUS.setValue(record.get('AUDIT_STATUS'));\n\napp.subGrid.getStore().getProxy().extraParams.adjHid = record.get('ADJ_H_ID');\napp.subGrid.getStore().load();\n\napp.OP_TYPE.setValue(\"_modified\");\napp.faAdjWin.show();\n\n// 已经提交的只能产看不能修改\nif(record.get('AUDIT_STATUS')=='S'){\n  app.addSubBtn.hide();\n  app.delSubBtn.hide();\n  app.saveBtn.hide();\n  app.BZSM.setReadOnly(true);\n  //app.LEDGER.hideTrigger = true;\n}else{\n  app.addSubBtn.show();\n  app.delSubBtn.show();\n  app.saveBtn.show();\n  app.BZSM.setReadOnly(false);\n  //app.LEDGER.hideTrigger = false;\n}\n\napp.ADJ_DATE.setReadOnly(true);\n"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"-","itemId":"sp2"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#submitBtn#}","itemId":"submitBtn","iconCls":"check_icon"},"events":{"click":"var record = app.grid.getSelection()[0];\nif (!record) {\n  Wb.warn('{#submitCheckMsg#}');\n  return;\n}\n\nif(record.get('AUDIT_STATUS')=='S'){\n  Wb.warn('{#hasSubmitMsg#}');\n  return;\n}\n\nvar adjHid = record.get('ADJ_H_ID');\n\n// 提交ajax请求\nExt.Msg.wait('{#submitWaitingMsg#}');\nExt.Ajax.request({\n  url: '{#contextPath#}/faAdjAction.do?method=summitFaAdj',\n  method: 'POST',\n  timeout: 300000,\n  params: {'adjHid': adjHid},\n  success: function(res, opts) {\n    Ext.Msg.hide();\n    var temp = res.responseText;\n    var resp = Ext.JSON.decode(temp);\n\n    if(resp.flag == 0){\n      Wb.toast('{#submitSuccessMsg#}');\n      app.grid.getStore().load();\n    }else{\n      Wb.error(resp.msg);\n    }\n  },\n  failure: function(res, opts) {\n    Ext.Msg.hide();\n    Wb.error('{#submitFailureMsg#}');\n  }\n});"},"children":[],"expanded":true,"type":"item"},{"configs":{"text":"-","itemId":"sp3"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#delBtn#}","itemId":"revokeBtn","iconCls":"first_icon"},"events":{"click":"/**var records = app.grid.getSelection();\n\nif(records.length==0){\n  Wb.toast('{#delCheckMsg#}');\n  return;\n}\n\nvar delIds = \"\";\n\nfor(var i=0; i<records.length; i++){\n  delIds = delIds + \"'\" + records[i].get('ADJ_H_ID') + \"',\";\n}\n\ndelIds = delIds.substring(0, delIds.length-1);\n\n// 提交ajax请求\nExt.Msg.wait('{#saveWaitMsg#}');\nExt.Ajax.request({\n  url: 'm?xwl=xc/fa/daily-business/fa-adj/data/deleteFaAdjs',\n  method: 'POST',\n  sync: false,\n  timeout: 300000,\n  params: {delIds: delIds},\n  success: function(res, opts) {\n    Ext.Msg.hide();\n    Wb.toast('{#delSuccessMsg#}');\n    app.grid.getStore().load();\n  },\n  failure: function(res, opts) {\n    Ext.Msg.hide();\n    Wb.error('{#delFailureMsg#}');\n  }\n});**/\n\nvar record = app.grid.getSelection()[0];\nif (!record) {\n  Wb.warn('{#delCheckMsg#}');\n  return;\n}\n\nif(record.get('AUDIT_STATUS')=='C'){\n  Wb.warn('{#canDelCheckMsg#}');\n  return;\n}\n\n//调整日期没有在当前打开会计期内不允许撤回\n\n\nvar adjHid = record.get('ADJ_H_ID');\n\n// 提交ajax请求\nExt.Msg.wait('{#delWaitingMsg#}');\nExt.Ajax.request({\n  url: '{#contextPath#}/faAdjAction.do?method=revokeFaAdj',\n  method: 'POST',\n  timeout: 300000,\n  params: {'adjHid': adjHid, jtType:'{#JT#}'},\n  success: function(res, opts) {\n    Ext.Msg.hide();\n    var temp = res.responseText;\n    var resp = Ext.JSON.decode(temp);\n\n    if(resp.flag == 0){\n      Wb.toast('{#delSuccessMsg#}');\n      app.grid.getStore().load();\n    }else{\n      Wb.error(resp.msg);\n    }\n  },\n  failure: function(res, opts) {\n    Ext.Msg.hide();\n    Wb.error('{#delFailureMsg#}');\n  }\n});"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"-","itemId":"sp4"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#deleteBtn#}","itemId":"deleteBtn","iconCls":"file_delete_icon"},"events":{"click":"var records = app.grid.getSelection();\n\nif(records.length==0){\n  Wb.toast('{#deleteCheckMsg#}');\n  return;\n}\n\nfor(var i=0; i<records.length; i++){\n  var status = records[i].get('AUDIT_STATUS');\n  \n  if(status=='S'){\n    Wb.toast('【' + records[i].get('DOC_NUM') + '】' + '{#canDeleteMsg#}');\n    return;\n  }\n}\n\nWb.confirm('{#deleteConfirmMsg#}', function() {\n  var delIds = \"\";\n\n  for(var i=0; i<records.length; i++){\n    delIds = delIds + \"'\" + records[i].get('ADJ_H_ID') + \"',\";\n  }\n\n  delIds = delIds.substring(0, delIds.length-1);\n\n  // 提交ajax请求\n  Ext.Msg.wait('{#deleteWaitMsg#}');\n  Ext.Ajax.request({\n    url: 'm?xwl=xc/fa/daily-business/fa-adj/data/deleteFaAdjs',\n    method: 'POST',\n    sync: false,\n    timeout: 300000,\n    params: {delIds: delIds},\n    success: function(res, opts) {\n      Ext.Msg.hide();\n      Wb.toast('{#deleteSuccessMsg#}');\n      app.grid.getStore().load();\n    },\n    failure: function(res, opts) {\n      Ext.Msg.hide();\n      Wb.error('{#deleteFailureMsg#}');\n    }\n  });\n});\n\n"},"children":[],"expanded":false,"type":"item"}],"expanded":true,"type":"toolbar"},{"configs":{"autoLoad":"false","itemId":"store","url":"m?xwl=xc/fa/daily-business/fa-adj/data/getFaAdjs"},"events":{"beforeload":"store.getProxy().extraParams.ledgerId = app.queryLedger.getValue();\nstore.getProxy().extraParams.docNum = app.queryDocNum.getValue();\nstore.getProxy().extraParams.jt = '{#JT#}';"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"width":"40","align":"center","xtype":"rownumberer","titleAlign":"center","itemId":"rowCol"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#adjDateCol#}","width":"180","dataIndex":"ADJ_DATE","itemId":"adjDateCol"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#docNumCol#}","width":"180","dataIndex":"DOC_NUM","itemId":"docNumCol"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#bzsmCol#}","dataIndex":"BZSM","itemId":"bzsmCol","flex":"1"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#auditStatusCol#}","dataIndex":"AUDIT_STATUS","itemId":"auditStatusCol","renderer":"if(value=='C'){\n  return '{#statusC#}';\n}else if(value=='S'){\n  return '{#statucS#}';\n}else{\n  return '';\n}"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#adjHIdCol#}","hidden":"true","dataIndex":"ADJ_H_ID","itemId":"adjHIdCol"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#ledgerIdCol#}","hidden":"true","dataIndex":"LEDGER_ID","itemId":"ledgerIdCol"},"children":[],"expanded":false,"type":"column"}],"expanded":false,"type":"array"}],"expanded":false,"type":"grid"}],"expanded":false,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}