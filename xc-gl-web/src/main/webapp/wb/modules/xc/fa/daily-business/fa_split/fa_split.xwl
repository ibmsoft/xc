{"inframe":false,"title":"资产拆分","hidden":false,"roles":{"default":1},"children":[{"configs":{"initScript":"//---------------------获取当前模块语言对应的.json文件，放到request中----------------\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xc/fa/daily-business/fa_split/fa_split\");\n\nrequest.setAttribute(\"contextPath\", request.getContextPath());","itemId":"module"},"events":{"finalize":"var opType = ''; //操作类型\n//计算后资产信息\nvar nsl = 0;\nvar nyz = 0;\nvar nljzj = 0;\nvar njzzb = 0;\n\n//----资产拆分主表信息\nvar YZ = 0;\nvar SL = 0;\nvar LJZJ_LJTX = 0;\nvar JZZB = 0;\n//保存拆分子表的信息到资产表(没用以移植到后端)\nfunction save2Additions(){\n  //从待拆分资产中取数据\n  var recs=app.grid2.store.getAt(0);\n  var PERIOD_CODE = recs.data.PERIOD_CODE;\n  var ZCMC = recs.data.ZCMC;\n  var GGXH = recs.data.GGXH;\n  var XLH= recs.data.XLH;\n  var ZZS= recs.data.ZZS;\n  var FA_PROPERTY= recs.data.FA_PROPERTY;\n  var CAT_CODE= recs.data.CAT_CODE;\n  var QYRQ = recs.data.QYRQ;\n  var SYNX= recs.data.SYNX;\n  var CBZX = recs.data.CBZX;\n  var BGR= recs.data.BGR;\n  var ZCYT= recs.data.ZCYT;\n  var CGFP= recs.data.CGFP;\n  var ZJFS = recs.data.ZJFS;\n  var LRFS= recs.data.LRFS;\n  var CFDD = recs.data.CFDD;\n  var ZCSM= recs.data.ZCSM;\n  var DW= recs.data.DW;\n  var CZL= recs.data.CZL;\n  var SFZJ = recs.data.SFZJ;\n  var ZJFF= recs.data.ZJFF;\n  var TXGZ = recs.data.TXGZ;\n  var ZCKM= recs.data.ZCKM;\n  var LJZJTXKM= recs.data.LJZJTXKM;\n  var QLKM= recs.data.QLKM;\n  var FYKM = recs.data.FYKM;\n  var JZZBKM= recs.data.JZZBKM;\n  var JZSSKM = recs.data.JZSSKM;\n  var QLRQ= recs.data.QLRQ;\n  var QLQJ= recs.data.QLQJ;\n  var QLYY = recs.data.QLYY;\n  var AP_INV_GL_L_ID = recs.data.AP_INV_GL_L_ID;\n  var CS_LJZJ_LJTX= recs.data.CS_LJZJ_LJTX;\n  var VENDOR_ID = recs.data.VENDOR_ID;\n  var PROJECT_ID= recs.data.PROJECT_ID;\n\n  //从新增拆分资产中循环取数据\n  var insertArray = [];\n  var rec = app.grid1.store.getCount();\n  if (rec === 0) {} else {\n    for (var i = 0; i < rec; i++) {\n      var reco = app.grid1.store.getAt(i);\n      var ASSET_ID = reco.data.ASSET_ID;\n      var ZCBM = reco.data.ZCBM;\n      var YZ = reco.data.YZ;\n      var LJZJ_LJTX = reco.data.LJZJ_LJTX;\n      var JZZB = reco.data.JZZB;\n      var SL = reco.data.SL;\n\n      var json = {\n        ASSET_ID: '',\n        LEDGER_ID:app.LEDGER_ID.getValue(),\n        PERIOD_CODE:PERIOD_CODE,\n        ZCBM: ZCBM,\n        ZCMC: ZCMC,\n        YZ: YZ,\n        LJZJ_LJTX: LJZJ_LJTX,\n        JZZB: JZZB,\n        SL: SL,\n        UP_ASSET_ID: ASSET_ID,\n        GGXH:GGXH,\n        XLH:XLH,\n        ZZS:ZZS,\n        FA_PROPERTY:FA_PROPERTY,\n        CAT_CODE:CAT_CODE,\n        QYRQ:QYRQ,\n        SYNX:SYNX,\n        CBZX:CBZX,\n        BGR:BGR,\n        ZCYT:ZCYT,\n        CGFP:CGFP,\n        ZJFS:ZJFS,\n        LRFS:LRFS,\n        CFDD:CFDD,\n        ZCSM:ZCSM,\n        DW:DW,\n        CZL:CZL,\n        SFZJ:SFZJ,\n        ZJFF:ZJFF,\n        TXGZ:TXGZ,\n        ZCKM:ZCKM,\n        LJZJTXKM:LJZJTXKM,\n        QLKM:QLKM,\n        FYKM:FYKM,\n        JZZBKM:JZZBKM,\n        JZSSKM:JZSSKM,\n        QLRQ:QLRQ,\n        QLQJ:QLQJ,\n        QLYY:QLYY,\n        AP_INV_GL_L_ID:AP_INV_GL_L_ID,\n        CS_LJZJ_LJTX:CS_LJZJ_LJTX,\n        VENDOR_ID:VENDOR_ID,\n        PROJECT_ID:PROJECT_ID\n      };\n      insertArray.push(json);\n    }\n  }\n  //新增拆分资产\n  Wb.request({\n    url: 'm?xwl=xc/fa/daily-business/fa_split/data/INSERT_XC_FA_ADDITIONS',\n    params: Wb.apply({insertArray:Wb.encode(insertArray)}),\n    success: function(response) {\n    }\n  });\n}\n\n//验证保存信息\n/**\n** 拆分后 数量、原值合计需小于拆分前  累计折旧、减值准备可小于等于拆分前\n**/\nfunction verifyFrom() {\n  if(app.PERIOD_CODE.getValue()==\"\"||app.PERIOD_CODE.getValue()==null){\n    Wb.toast('{#notPeriodCode#}');\n    return false;\n  }\n  \n  if(Ext.isEmpty(app.BZSM.getValue())){\n    Wb.toast('{#BZSM#}'+'{#notNull#}');\n    return false;\n  }\n  \n  if(nsl==0){\n    Wb.toast('{#afterSlNotZero#}');\n    return false;\n  }\n  \n  if(Ext.isEmpty(nsl)){\n    Wb.toast('{#afterSlNotNull#}');\n    return false;\n  }\n  \n  var rec = app.grid2.store.getCount();\n  \n  if (rec > 0) {\n    for (i = 0; i < rec; i++) {\n      var recs = app.grid2.store.getAt(0);\n      YZ = recs.data.YZ;\n      SL = recs.data.SL;\n      LJZJ_LJTX = recs.data.LJZJ_LJTX;\n      JZZB = recs.data.JZZB;\n    }\n    \n    //nsl = app.grid2.store.getAt(1).get('YZ');\n  } else {\n    Wb.toast('{notfa}');\n    return false ;\n  }\n  \n  var bSl = 0; // 拆分前\n  var aSl = 0; // 拆分后\n  for(var i=0; i<app.grid2.store.getCount(); i++){\n    var _subRecord = app.grid2.store.getAt(i);\n    if(_subRecord.get('STATUS')=='B'){\n      bSl = _subRecord.get('SL');\n    }else{\n      aSl = _subRecord.get('SL');\n    }\n  }\n  // 拆分后数量不能大于拆分前数量\n  if(aSl > bSl){\n    Wb.toast('{#afterNotMoreBefore#}');\n    return false;\n  }\n  \n  if(app.grid1.store.getCount()==0){\n    Wb.toast('{#noSplitAsset#}');\n    return false;\n  }\n  \n  if (!Wb.verifyGrid(app.grid1)) {\n    return false;\n  } \n  \n  //验证数据是否合法\n  //-----判断子表计数之和小于等于资产数据\n  //var modifiedRecords = app.grid1.store.getModifiedRecords();\n  var csl = 0;\n  var cyz = 0;\n  var cljzj = 0;\n  var czzb = 0;\n  \n  for (var j = 0; j < app.grid1.getStore().getCount(); j++) {\n    var record = app.grid1.store.getAt(j);\n    if(!Ext.isEmpty(record.data.SL) && record.data.SL!=0){\n      csl += record.data.SL;\n    }else if(record.data.SL==0){\n      Wb.toast('{#slNotZero#}');\n      return false;\n    }else{\n      Wb.toast('{#slNotNull#}');\n      return false;\n    }\n    \n    if(!Ext.isEmpty(record.data.YZ) && record.data.YZ!=0){\n      cyz += record.data.YZ;\n    }else if(record.data.YZ==0){\n      Wb.toast('{#yzNotZero#}');\n      return false;\n    }else{\n      Wb.toast('{#yzNotNull#}');\n      return false;\n    }\n    \n    if(!Ext.isEmpty(record.data.LJZJ_LJTX)){\n      cljzj += record.data.LJZJ_LJTX;\n    }\n    \n    if(!Ext.isEmpty(record.data.JZZB)){\n      czzb += record.data.JZZB;\n    }\n  }\n  \n  if(bSl > aSl + csl){\n    Wb.toast('{#aSlAndSplitSlCanNotLessThanbSl#}');\n    return false;\n  }\n  \n  /** 11-29 if (csl >= SL) {\n    Wb.info('{#cantSl#}' + SL + '');\n    return false;\n  }**/\n  if (cyz >= YZ) {\n    Wb.info('{#cantYz#}' + YZ + '');\n    return false ;\n  }\n  if (cljzj > LJZJ_LJTX) {\n    Wb.info('{#cantLjzj#}'+ LJZJ_LJTX + '');\n    return false;\n  }\n  if (czzb > JZZB) {\n    Wb.info('{#cantJzzb#}' + JZZB + '');\n    return false;\n  }\n  return true;\n}\n\nfunction countAfterList(){\n  var rec= app.grid2.store.getCount();\n  var bsl = 0;  var byz = 0; var bljzj = 0;\n  var bjzzb = 0;\n  var sl = 0;\n  var dw = 0;\n  var yz = 0;\n  var ljzj = 0;\n  var jzzb = 0;\n  var czl = 0;\n  var dwname;\n  for(i=0;i<rec;i++){\n    var recs=app.grid2.store.getAt(0);\n    bsl= recs.data.SL;\n    dw= recs.data.DW;\n    dwname= recs.data.DW_NAME;\n    byz= recs.data.YZ;\n    bljzj= recs.data.LJZJ_LJTX;\n    bjzzb= recs.data.JZZB;\n    czl= recs.data.CZL;\n\n  }\n  var modifiedRecords = app.grid1.store.getCount();\n\n  for(var j=0; j<modifiedRecords; j++){\n    var record =app.grid1.store.getAt(j);\n    sl += record.data.SL;\n    yz += record.data.YZ;\n    ljzj += record.data.LJZJ_LJTX;\n    jzzb += record.data.JZZB;\n    \n    if(!Ext.isEmpty(record.get('YZ')) && !Ext.isEmpty(record.get('CZL'))){\n      record.set('CZ', Number(record.get('YZ')) * Number(record.get('CZL')) / 100);\n    }\n  }\n  /** 11-29 nsl = Math.round(parseFloat(Number(bsl) - Number(sl)) * 100) / 100;**/\n  nyz = Math.round(parseFloat(Number(byz) - Number(yz)) * 100) / 100;\n  nljzj = Math.round(parseFloat(Number(bljzj) - Number(ljzj)) * 100) / 100;\n  njzzb = Math.round(parseFloat(Number(bjzzb) - Number(jzzb)) * 100) / 100;\n  //查询拆分后资产\n\n  var p = {\n    STATUS:'A',\n    /** 11-29 SL: nsl,**/\n    SL: nsl,\n    DW: dw,\n    DW_NAME :  dwname,    \n    YZ: nyz,\n    LJZJ_LJTX: nljzj,\n    JZZB: njzzb,\n    CZL: czl,\n    CZ: nyz*czl/100\n  };   \n\n  app.grid2.store.insert(app.grid2.store.getCount(), p);\n}"},"children":[{"configs":{"maximized":"true","layout":"border","closeAction":"hide","buttonAlign":"center","itemId":"window1"},"children":[{"configs":{"region":"north","bodyPadding":"5","border":"false","itemId":"formPanel"},"children":[{"configs":{"height":"30","layout":"column","columnWidth":"1","border":"false","itemId":"td_1"},"children":[{"configs":{"layout":"fit","columnWidth":".33","border":"false","itemId":"tr1_1"},"children":[{"configs":{"itemId":"DIVISION_ID"},"children":[],"expanded":false,"type":"hidden"},{"configs":{"labelWidth":"120","readOnly":"true","displayField":"NAME","valueField":"ID","emptyText":"{#please#}","labelAlign":"right","itemId":"LEDGER_ID","fieldLabel":"{#LEDGER#}<font color=\"red\">*<\/font>"},"events":{"select":"\n//app.queryBtn.fireEvent('click');\n\n"},"children":[{"configs":{"itemId":"store","autoLoad":"true","url":"m?xwl=xc/com-qry/gl-ledgers/select-sec-ledger"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".33","border":"false","itemId":"tr1_2"},"children":[{"configs":{"labelWidth":"120","readOnly":"true","labelAlign":"right","itemId":"DIVISION_DATE","fieldLabel":"{#DIVISION_DATE#}"},"children":[],"expanded":false,"type":"date"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".33","border":"false","itemId":"tr1_3"},"children":[{"configs":{"labelWidth":"120","readOnly":"true","allowBlank":"false","displayField":"PERIOD_CODE","valueField":"PERIOD_CODE","labelAlign":"right","itemId":"PERIOD_CODE","fieldLabel":"{#PERIODS#}<font color=\"red\">*<\/font>"},"children":[{"configs":{"itemId":"store","autoLoad":"true","url":"m?xwl=xc/fa/common/FA_INFO_PANEL/data/getPeriods"},"events":{"beforeload":"//operation.params = Wb.getValue(app.form1);\nstore.getProxy().extraParams.ledger = app.LEDGER_ID.getValue();\n"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"height":"30","layout":"column","columnWidth":"1","border":"false","itemId":"td_2"},"children":[{"configs":{"layout":"fit","columnWidth":".66","border":"false","itemId":"tr2_1"},"children":[{"configs":{"labelWidth":"120","allowBlank":"false","labelAlign":"right","itemId":"BZSM","fieldLabel":"{#BZSM#}<font color=\"red\">*<\/font>"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".33","border":"false","itemId":"tr3_1"},"children":[{"configs":{"labelWidth":"120","readOnly":"true","labelAlign":"right","itemId":"CREATED_BY_VIEW","fieldLabel":"{#CREATED_BY#}"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"120","readOnly":"true","labelAlign":"right","itemId":"CREATED_BY","fieldLabel":"{#CREATED_BY#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":false,"type":"form"},{"configs":{"region":"center","layout":"border","itemId":"panel1"},"children":[{"configs":{"region":"north","width":"200","itemId":"panel1"},"children":[{"configs":{"region":"center","height":"120","barPageButton":"false","barExportButtons":"false","barExportAllButtons":"false","barRefreshButton":"false","barNavigateButtons":"false","itemId":"grid2","barInfoLabel":"false","editable":"true"},"events":{"itemdblclick":"//app.editBtn.fireEvent('click');","tagEvents":"cellclick: function(table, td, cellIndex, record, tr, rowIndex, e, eOpts ){\n  if(record.get('STATUS') == 'A'){\n    return true;\n  }else{\n    return false;\n  }\n}"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/fa/daily-business/fa_split/data/SELECT_FA_ADDITIONS_BYID"},"events":{"beforeload":"if(opType =='update'){\n  store.getProxy().url='m?xwl=xc/fa/daily-business/fa_split/data/SELECT_FA_ADDITIONS_BYID_UPDATE'; \n  store.getProxy().extraParams.DIVISION_ID = app.DIVISION_ID.getValue();\n}else{\n store.getProxy().url='m?xwl=xc/fa/daily-business/fa_split/data/SELECT_FA_ADDITIONS_BYID'; \n}\nstore.getProxy().extraParams.ASSET_ID = app.ASSET_ID.getValue();\n\nstore.getProxy().extraParams.CURRENT_PERIOD_CODE = app.PERIOD_CODE.getValue();"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"itemId":"IS_JT"},"children":[],"expanded":false,"type":"hidden"},{"configs":{"itemId":"ASSET_ID"},"children":[],"expanded":false,"type":"hidden"},{"configs":{"labelWidth":"120","labelAlign":"right","normalName":"ASSET_NAME_PICK","itemId":"ASSET_NAME","fieldLabel":"{#YZCMC#}"},"events":{"expand":"if(app.LEDGER_ID.getValue() == '' || app.LEDGER_ID.getValue() == null){\nWb.toast('{#selectLedgerMsgTips#}');\nreturn false ;\n}\npicker.getPicker().getStore().load({params:{\n\t\tQUERY_LEDGER_ID:app.LEDGER_ID.getValue()\n\t}});\n"},"children":[{"configs":{"tagConfigs":"{\n  minWidth:500\n}","barPageButton":"false","barExportAllButtons":"false","barExportButtons":"false","barRefreshButton":"false","itemId":"pickComp"},"events":{"itemdblclick":"//如果资产存在折旧后的调整这不能拆分，给出提示：已经存在折旧后的调整单，不能拆分\n\nvar openPeriod = '';\nExt.Msg.wait('');\nvar _cnt = 0;\n\nvar _period = app.PERIOD_CODE.getValue();\n\nExt.Ajax.request({\n  url : 'm?xwl=xc/fa/daily-business/fa_split/data/CHECK_FA_ADJ_4_AFTER',\n  method: 'POST',\n  async:false,\n  params:{period: _period, assetId:record.get('ASSET_ID')},\n  success: function(response,options){\n    Ext.Msg.hide();\n    var resp = Ext.JSON.decode(response.responseText);\n    _cnt = resp.CNT;\n  },\n  failure: function(response,options){\n    Ext.Msg.hide();\n    Wb.error('{#requestFailure#}');\n  }\n});\n\nif(_cnt > 0){\n  Wb.toast('{#hasAfterAdj#}');\n  return;\n}\n\nif(!Ext.isEmpty(record.get('JTQJ')) && record.get('JTQJ')==record.get('CURRENT_OPEN_PERIOD')){\n  app.IS_JT.setValue('Y');\n}else{\n  app.IS_JT.setValue('N');\n}\n\napp.grid1.getStore().removeAll();\napp.grid1.getStore().commitChanges();\n\nvar Id = record.get('ASSET_ID') ;\nvar Name = record.get('ZCMC') ;\n\napp.ASSET_ID.setValue(Id) ;\napp.ASSET_NAME_PICK.setValue(Name);\n//加载资产\n app.grid2.store.load({\n   params: {\n     ASSET_ID: Id\n   },\n   callback :function (){\n    countAfterList();\n   }\n });\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"pageSize":"10","autoLoad":"true","itemId":"store","url":"m?xwl=xc/fa/daily-business/fa_split/data/SELECT_FA_SPLIT"},"events":{"beforeload":" //operation.params.QUERY_LEDGER_ID =app.fa_dl.getValue();\n\nstore.getProxy().extraParams.QUERY_LEDGER_ID = app.LEDGER_ID.getValue();\nstore.getProxy().extraParams.QUERY_CODE_NAME  = app.QUERY_CODE_NAME.getValue();"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","dataIndex":"ASSET_ID","itemId":"ASSET_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#ZCBM#}","width":"120","dataIndex":"ZCBM","titleAlign":"center","itemId":"ZCBM_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#ZCMC#}","width":"100","dataIndex":"ZCMC","titleAlign":"center","itemId":"ZCMC_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"120","labelAlign":"right","itemId":"QUERY_CODE_NAME","fieldLabel":"{#QUERY_CODE_NAME#}"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.pickComp.getStore().load();\n}"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"qBtn","iconCls":"seek_icon"},"events":{"click":"app.pickComp.getStore().load();"},"children":[],"expanded":false,"type":"item"},{"configs":{"itemId":"cancelBtn","iconCls":"delete_icon"},"events":{"click":"\napp.QUERY_CODE_NAME.setValue('');\n\napp.pickComp.getStore().load() ;\n\n\n"},"children":[],"expanded":false,"type":"item"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":false,"type":"picker"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#rowNo#}","xtype":"rownumberer","width":"50","align":"center","titleAlign":"center","itemId":"ROW_NUM_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"ASSET_ID","hidden":"true","dataIndex":"ASSET_ID","titleAlign":"center","itemId":"ASSET_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"ledger_id","hidden":"true","dataIndex":"LEDGER_ID","titleAlign":"center","itemId":"LEDGER_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#SL#}","align":"right","dataIndex":"SL","titleAlign":"center","itemId":"SL_COL"},"children":[{"configs":{"minValue":"1","allowDecimals":"false","itemId":"editor"},"events":{"blur":"nsl = number.getValue();"},"children":[],"expanded":false,"type":"number"}],"expanded":false,"type":"column"},{"configs":{"text":"{#DW#}","hidden":"true","dataIndex":"DW","titleAlign":"center","itemId":"DW_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#DW#}","dataIndex":"DW_NAME","titleAlign":"center","itemId":"DW_NAME_COL1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#YZ#}","align":"right","dataIndex":"YZ","titleAlign":"center","itemId":"YZ_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#LJZJ_LJTX#}","align":"right","dataIndex":"LJZJ_LJTX","titleAlign":"center","itemId":"LJZJ_LJTX_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#JZZB#}","align":"right","dataIndex":"JZZB","titleAlign":"center","itemId":"JZZB_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#CZL#}","width":"120","align":"right","dataIndex":"CZL","titleAlign":"center","itemId":"CZL_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#CZ#}","align":"right","dataIndex":"CZ","titleAlign":"center","itemId":"CZ_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#STATUS#}","dataIndex":"STATUS","itemId":"STATUS_COL","renderer":"if(value==='B')\n  return '{#before#}';\nif(value==='A')\n  return '{#after#}';"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#ZCBM#}","hidden":"true","dataIndex":"ZCBM","titleAlign":"center","itemId":"ZCBM_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#ZCMC#}","hidden":"true","dataIndex":"ZCMC","titleAlign":"center","itemId":"ZCMC_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#ZCYT#}","hidden":"true","dataIndex":"ZCYT","titleAlign":"center","itemId":"ZCYT_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#PERIODS#}","hidden":"true","dataIndex":"PERIOD_CODE","titleAlign":"center","itemId":"PERIOD_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#LRRQ#}","hidden":"true","dataIndex":"CREATION_DATE","titleAlign":"center","itemId":"CREATION_DATE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#QYRQ#}","hidden":"true","dataIndex":"QYRQ","titleAlign":"center","itemId":"QYRQ_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#CAT_CODE#}","hidden":"true","dataIndex":"CAT_CODE","titleAlign":"center","itemId":"CAT_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#GGXH#}","hidden":"true","dataIndex":"GGXH","titleAlign":"center","itemId":"GGXH_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#XLH#}","hidden":"true","dataIndex":"XLH","titleAlign":"center","itemId":"XLH_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#ZZS#}","hidden":"true","dataIndex":"ZZS","titleAlign":"center","itemId":"ZZS_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#VENDOR_NAME#}","hidden":"true","dataIndex":"VENDOR_ID","titleAlign":"center","itemId":"VENDOR_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#CGFP#}","hidden":"true","dataIndex":"CGFP","titleAlign":"center","itemId":"CGFP_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#LRFS#}","hidden":"true","dataIndex":"LRFS","titleAlign":"center","itemId":"LRFS_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#SYNX_Y#}","hidden":"true","align":"right","dataIndex":"SYNX","titleAlign":"center","itemId":"SYNX_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#CBZX#}","hidden":"true","dataIndex":"CBZX","titleAlign":"center","itemId":"CBZX_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#PROJECT_NAME#}","hidden":"true","dataIndex":"PROJECT_ID","titleAlign":"center","itemId":"PROJECT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#BGR#}","hidden":"true","dataIndex":"BGR","titleAlign":"center","itemId":"BGR_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#CFDD#}","hidden":"true","dataIndex":"CFDD","titleAlign":"center","itemId":"CFDD_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#TXGZ#}","hidden":"true","width":"120","dataIndex":"TXGZ","titleAlign":"center","itemId":"TXGZ_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#ZJFF#}","hidden":"true","dataIndex":"ZJFF","titleAlign":"center","itemId":"ZJFF_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"资产属性","hidden":"true","dataIndex":"FA_PROPERTY","titleAlign":"center","itemId":"FA_PROPERTY_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"增加方式","hidden":"true","dataIndex":"ZJFS","titleAlign":"center","itemId":"ZJFS_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"存放说明","hidden":"true","dataIndex":"ZCSM","titleAlign":"center","itemId":"ZCSM_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"是否折旧","hidden":"true","dataIndex":"SFZJ","titleAlign":"center","itemId":"SFZJ_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"资产科目","hidden":"true","dataIndex":"ZCKM","titleAlign":"center","itemId":"ZCKM_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"累计折旧","hidden":"true","dataIndex":"LJZJTXKM","titleAlign":"center","itemId":"LJZJTXKM_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"清理科目","hidden":"true","dataIndex":"QLKM","titleAlign":"center","itemId":"QLKM_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"费用科目","hidden":"true","dataIndex":"FYKM","titleAlign":"center","itemId":"FYKM_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"减值准备科目","hidden":"true","dataIndex":"JZZBKM","titleAlign":"center","itemId":"JZZBKM_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"减值损失科目","hidden":"true","dataIndex":"JZSSKM","titleAlign":"center","itemId":"JZSSKM_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"清理日期","hidden":"true","dataIndex":"QLRQ","titleAlign":"center","itemId":"QLRQ_COL"},"children":[],"expanded":false,"type":"column"}],"expanded":false,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"panel"},{"configs":{"region":"center","layout":"border","itemId":"panel11"},"children":[{"configs":{"region":"center","multiSelect":"true","selType":"checkboxmodel","itemId":"grid1","editable":"true"},"events":{"itemdblclick":"//app.editBtn.fireEvent('click');"},"children":[{"configs":{"itemId":"store","autoLoad":"true","url":"m?xwl=xc/fa/daily-business/fa_split/data/SELECT_XC_FA_DIVISION_DTL"},"events":{"load":"app.grid2.store.load({callback: function(){\n countAfterList();\n\n}});\n","beforeload":"store.getProxy().extraParams.DIVISION_ID = app.DIVISION_ID.getValue();"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"{#add#}","itemId":"addDtlbtn","iconCls":"file_add_icon"},"events":{"click":"var fa=app.ASSET_ID.getValue();\nvar recs=app.grid2.store.getAt(0);\nif(fa === null || fa ===undefined){\n\n  Wb.toast('请先选择资产');\n\n\n}else{\n  Wb.addEdit(app.grid1, {DIVISION_ID:app.DIVISION_ID.getValue(),\n                         //ZCBM:recs.data.ZCBM,\n                         ZCMC:recs.data.ZCMC,\n                         DW :recs.data.DW_NAME,\n                         LJZJ_LJTX:0,\n                         JZZB:0,\n                         CZL:recs.data.CZL\n                         //,ASSET_ID:app.ASSET_ID.getValue()\n                        });\n\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#delete#}","itemId":"delBtn","iconCls":"file_delete_icon"},"events":{"click":"Wb.remove(app.grid1);"},"children":[],"expanded":true,"type":"button"},{"configs":{"text":"保存","hidden":"true","itemId":"savebtn","iconCls":"save_icon"},"events":{"click":"var recs=app.grid2.store.getAt(0);\nvar      ZCBM= recs.data.ZCBM;\nvar  ZCMC  = recs.data.ZCMC;\nvar      FA_PROPERTY= recs.data.FA_PROPERTY;\n//             byz= recs.data.YZ;\n//             bljzj= recs.data.LJZJ_LJTX;\n//             bjzzb= recs.data.JZZB;\n//             czl= recs.data.CZL;\n\nalert(ZCBM);\nalert(ZCMC);\n\nalert(FA_PROPERTY);\n\n\n \n\n\n\n"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#rowNo#}","xtype":"rownumberer","width":"50","align":"center","titleAlign":"center","itemId":"ROW_NUM_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"DIV_DTL_ID","hidden":"true","dataIndex":"DIV_DTL_ID","titleAlign":"center","itemId":"DIV_DTL_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"DIVISION_ID","hidden":"true","dataIndex":"DIVISION_ID","titleAlign":"center","itemId":"DIVISION_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"ASSET_ID","hidden":"true","dataIndex":"ASSET_ID","titleAlign":"center","itemId":"ASSET_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#ZCBM#}","width":"160","dataIndex":"ZCBM","titleAlign":"center","itemId":"ZCBM_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#ZCMC#}","width":"160","dataIndex":"ZCMC","titleAlign":"center","itemId":"ZCMC_COL"},"children":[{"configs":{"itemId":"editor"},"children":[],"expanded":false,"type":"text"}],"expanded":false,"type":"column"},{"configs":{"text":"{#SL#}<font color='red'>*<\/font>","align":"right","dataIndex":"SL","titleAlign":"center","itemId":"SL_COL"},"children":[{"configs":{"minValue":"1","allowDecimals":"false","itemId":"editor"},"events":{"blur":"/*app.grid2.store.load({\n  params: {\n    ASSET_ID: app.ASSET_ID.getValue()\n  },\n  callback :function (){\n    countAfterList();\n  }\n});*/"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"column"},{"configs":{"text":"{#DW#}","dataIndex":"DW","titleAlign":"center","itemId":"DW_COL2"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#YZ#}<font color='red'>*<\/font>","align":"right","dataIndex":"YZ","titleAlign":"center","itemId":"YZ_COL"},"children":[{"configs":{"minValue":"0","itemId":"editor"},"events":{"blur":" app.grid2.store.load({\n   params: {\n     ASSET_ID: app.ASSET_ID.getValue()\n   },\n   callback :function (){\n   \n   \n    countAfterList();\n   }\n });"},"children":[],"expanded":false,"type":"number"}],"expanded":false,"type":"column"},{"configs":{"text":"{#LJZJ_LJTX#}","align":"right","dataIndex":"LJZJ_LJTX","titleAlign":"center","itemId":"LJZJ_LJTX_COL"},"children":[{"configs":{"minValue":"0","itemId":"editor"},"events":{"blur":" app.grid2.store.load({\n   params: {\n     ASSET_ID: app.ASSET_ID.getValue()\n   },\n   callback :function (){\n   \n   \n    countAfterList();\n   }\n });"},"children":[],"expanded":false,"type":"number"}],"expanded":false,"type":"column"},{"configs":{"text":"{#JZZB#}","align":"right","dataIndex":"JZZB","titleAlign":"center","itemId":"JZZB_COL"},"children":[{"configs":{"minValue":"0","itemId":"editor"},"events":{"blur":" app.grid2.store.load({\n   params: {\n     ASSET_ID: app.ASSET_ID.getValue()\n   },\n   callback :function (){\n   \n   \n    countAfterList();\n   }\n });"},"children":[],"expanded":false,"type":"number"}],"expanded":false,"type":"column"},{"configs":{"text":"{#CZL#}","width":"120","align":"right","dataIndex":"CZL","titleAlign":"center","itemId":"CZL_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#CZ#}","align":"right","dataIndex":"CZ","titleAlign":"center","itemId":"CZ_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"默认日期","hidden":"true","align":"right","dataIndex":"LAST_UPDATE_DATE","titleAlign":"center","itemId":"LUD_COL"},"children":[],"expanded":true,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"itemId":"buttons"},"children":[{"configs":{"text":"{#save#}","itemId":"saveBtn","iconCls":"save_icon"},"events":{"click":"var isVer= verifyFrom();\nif(isVer==false){\n  return false;\n}\n\ncountAfterList();\n\n//从待拆分资产中取数据\nvar recs=app.grid2.store.getAt(0);\nvar saveJson = {};\n//更新资产信息\nvar faAdditionOne ={};\nfaAdditionOne.yz=nyz;\nfaAdditionOne.ljzjLjtx=nljzj;\nfaAdditionOne.sl=nsl;\nfaAdditionOne.jzzb=njzzb;\nfaAdditionOne.assetId=recs.data.ASSET_ID;\nfaAdditionOne.zcbm=recs.data.ZCBM;\nfaAdditionOne.jz=nyz-nljzj-njzzb-Number(recs.get('CZL'))*nyz/100;\nsaveJson.faAdditionOne = faAdditionOne;\n//保存资产拆分头表\nvar faDivisionH = {};\nfaDivisionH.divisionId = app.DIVISION_ID.getValue();\nfaDivisionH.ledgerId = app.LEDGER_ID.getValue();\nfaDivisionH.divisionDate = app.DIVISION_DATE.getValue();\nfaDivisionH.periodCode = app.PERIOD_CODE.getValue();\nfaDivisionH.bzsm = app.BZSM.getValue();\nfaDivisionH.assetId =app.ASSET_ID.getValue();\nfaDivisionH.yz = YZ;\nfaDivisionH.ljzjljtx = LJZJ_LJTX;\nfaDivisionH.sl = SL ;\nfaDivisionH.jzzb = JZZB ;\nfaDivisionH.createdBy = app.CREATED_BY.getValue(); \nsaveJson.faDivisionH = faDivisionH;\n//保存资产拆分行表\nvar faDivisionLs = new Array();\nvar faAdditions =new Array();\nvar modifiedRecords = app.grid1.store.getModifiedRecords();\nfor(var i=0; i<modifiedRecords.length; i++){\n  var record = modifiedRecords[i];\n  //保存拆分行表信息\n  var faDivisionL = {};\n  faDivisionL.divisionId = record.data.DIVISION_ID;\n  //faDivisionL.assetId = record.data.ASSET_ID;\n  faDivisionL.zcmc = record.data.ZCMC;\n  faDivisionL.yz = record.data.YZ;\n  faDivisionL.ljzjljtx = record.data.LJZJ_LJTX;\n  faDivisionL.sl = record.data.SL;\n  faDivisionL.jzzb = record.data.JZZB;\n  faDivisionLs.push(faDivisionL);\n  //同步保存资产信息\n  var faAddition={};\n  faAddition.ledgerId = app.LEDGER_ID.getValue();\n  faAddition.periodCode = recs.data.PERIOD_CODE;\n  faAddition.yz = record.data.YZ;\n  faAddition.ljzjLjtx = record.data.LJZJ_LJTX;\n  faAddition.jzzb = record.data.JZZB;\n  faAddition.sl = record.data.SL;\n  faAddition.upAssetId = record.data.ASSET_ID;\n  //faAddition.zcmc = recs.data.ZCMC;\n  faAddition.zcmc = record.data.ZCMC;\n  faAddition.ggxh = recs.data.GGXH;\n  faAddition.xlh = recs.data.XLH;\n  faAddition.vendorId = recs.data.VENDOR_ID;\n  faAddition.zzs = recs.data.ZZS;\n  faAddition.faProperty = recs.data.FA_PROPERTY;\n  faAddition.catCode = recs.data.CAT_CODE;\n  faAddition.qyrq =recs.data.QYRQ;\n  faAddition.synx = recs.data.SYNX;\n  faAddition.cbzx = recs.data.CBZX;\n  faAddition.projectId = recs.data.PROJECT_ID;\n  faAddition.zcyt = recs.data.ZCYT;\n  faAddition.cgfp =  recs.data.CGFP;\n  faAddition.zjfs =recs.data.ZJFS;\n  faAddition.lrfs = recs.data.LRFS;\n  faAddition.cfdd =recs.data.CFDD;\n  faAddition.bgr = recs.data.BGR;\n  faAddition.zcsm = recs.data.ZCSM;\n  faAddition.dw = recs.data.DW;\n  faAddition.czl = recs.data.CZL;\n  faAddition.sfzj = recs.data.SFZJ;\n  faAddition.zjff = recs.data.ZJFF;\n  faAddition.txgz =recs.data.TXGZ;\n  faAddition.zckm = recs.data.ZCKM;\n  faAddition.ljzjtxkm =recs.data.LJZJTXKM;\n  faAddition.jzzbkm = recs.data.JZZBKM;\n  faAddition.fykm = recs.data.FYKM;\n  faAdditions.push(faAddition);\n}\n\nsaveJson.countFa =modifiedRecords.length;\nsaveJson.faDivisionLs = faDivisionLs;\nsaveJson.faAdditions=faAdditions;\nvar jsonData = Ext.JSON.encode(saveJson);\n\nif(app.IS_JT.getValue()=='Y'){\n  jsonData.isJt = 'Y';\n  Wb.confirm('{#delZjFirst2Continue#}', function(){\n    // 提交ajax请求\n    Ext.Msg.wait('{#saveWaitMsg#}');\n    Ext.Ajax.request({\n      url: '{#contextPath#}' + '/faDivisionAction.do?method=saveFaDivision',\n      method: 'POST',\n      sync: false,\n      timeout: 300000,\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      jsonData: jsonData,\n      success: function(res, opts) {\n        Ext.Msg.hide();\n\n        var temp = res.responseText;\n        var resp = Ext.JSON.decode(temp);\n\n        if(resp.flag == 0){\n          Wb.toast('{#saveSuccessMsg#}');\n\n          app.window1.close();\n          app.grid_h.store.load({params:{LEDGER_ID:app.fa_ld.getValue()}});\n        }else{\n          Wb.error(resp.msg);\n        }\n      },\n      failure: function(res, opts) {\n        Ext.Msg.hide();\n        Wb.error('{#saveFailureMsg#}');\n      }\n    });\n  });\n}else{\n  jsonData.isJt = 'N';\n  // 提交ajax请求\n  Ext.Msg.wait('{#saveWaitMsg#}');\n  Ext.Ajax.request({\n    url: '{#contextPath#}' + '/faDivisionAction.do?method=saveFaDivision',\n    method: 'POST',\n    sync: false,\n    timeout: 300000,\n    headers: {\n      'Content-Type': 'application/json'\n    },\n    jsonData: jsonData,\n    success: function(res, opts) {\n      Ext.Msg.hide();\n\n      var temp = res.responseText;\n      var resp = Ext.JSON.decode(temp);\n\n      if(resp.flag == 0){\n        Wb.toast('{#saveSuccessMsg#}');\n\n        app.window1.close();\n        app.grid_h.store.load({params:{LEDGER_ID:app.fa_ld.getValue()}});\n      }else{\n        Wb.error(resp.msg);\n      }\n    },\n    failure: function(res, opts) {\n      Ext.Msg.hide();\n      Wb.error('{#saveFailureMsg#}');\n    }\n  });\n}\n\n\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#close#}","itemId":"cancelBtn","iconCls":"cancel_icon"},"events":{"click":"app.window1.close();"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"array"}],"expanded":true,"type":"window"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"保存","itemId":"saveBtn","iconCls":"ok_icon"},"events":{"click":"var fa=app.fa_split.getValue();\n\nif(fa === null || fa ===''){\n  \n  Wb.toast('请先选择资产');\n\nreturn;\n}\n\n  \n\n\nvar d_id=app.DIVISION_ID.getValue();\nif (app.formPanel.isValid()) {\n  \n  if( d_id== '' || d_id== null){\n    //新增\n\n  \n  }else{\n  //更新\n Wb.request({\n                  url: 'm?xwl=xc/fa/ld-base/fa_ld_param/data/UPDATE_XC_FA_LD_PRARM',\n                  params:{\n                    DIVISION_ID:d_id,\n                    LEDGER_ID :app.fa_ld.getValue(),\n                    DIVISION_DATE :app.TZRQ.getValue(),  \n                    PERIOD_CODE:app.PERIOD_CODE.getValue(),\n                    BZSM:app.BZSM.getValue(),\n                    ASSET_ID :fa,\n                    YZ:YZ,\n                    SL:SL,\n                    LJZJ_LJTX:LJZJ_LJTX,\n                    JZZB:JZZB\n                  \n                  },\n                  success: function(resp) {\n                      Wb.toast('保存成功！');\n                  }\n              });\n  \n  }\n\n\n} else {\n    Wb.toast('请将必输项输入完整！');\n}"},"children":[],"expanded":false,"type":"button"}],"expanded":false,"type":"toolbar"},{"configs":{"layout":"border","itemId":"viewport1"},"events":{"afterrender":"app.fa_ld.getStore().load(function(){\n  if(app.fa_ld.getStore().getCount()>0){\n    app.fa_ld.setValue(app.fa_ld.getStore().getAt(0).get('ID'));\n    app.queryBtn.fireEvent('click');\n  }\n});"},"children":[{"configs":{"region":"north","itemId":"form1"},"children":[{"configs":{"layout":"column","itemId":"panel1"},"children":[{"configs":{"labelWidth":"80","displayField":"NAME","valueField":"ID","emptyText":"{#please#}","labelAlign":"right","padding":"10 10 10 0","itemId":"fa_ld","fieldLabel":"{#LEDGER#}","editable":"false"},"events":{"select":"\n\napp.queryBtn.fireEvent('click');\n"},"children":[{"configs":{"autoLoad":"false","itemId":"store","url":"m?xwl=xc/com-qry/gl-ledgers/select-sec-ledger"},"children":[],"expanded":false,"type":"store"}],"expanded":false,"type":"combo"},{"configs":{"labelWidth":"100","labelAlign":"right","padding":"10 10 10 0","itemId":"codename","fieldLabel":"{#CodeName#}"},"events":{"specialkey":"if(e.getKey()==13){\n  app.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"},{"configs":{"text":"{#query#}","margin":"10 10 10 0","itemId":"queryBtn","iconCls":"seek_icon"},"events":{"click":"app.grid_h.store.load();\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#reset#}","margin":"10 10 10 0","itemId":"resetBtn","iconCls":"refresh_icon"},"events":{"click":"app.codename.setValue('');\n\napp.queryBtn.fireEvent('click');\n"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"panel"}],"expanded":false,"type":"form"},{"configs":{"region":"center","itemId":"grid_h","editable":"true"},"events":{"itemdblclick":"app.editBtn.fireEvent('click');"},"children":[{"configs":{"autoLoad":"false","itemId":"store","url":"m?xwl=xc/fa/daily-business/fa_split/data/SELECT_XC_FA_DIVISION_LIST"},"events":{"beforeload":"store.getProxy().extraParams.ledger = app.fa_ld.getValue();\n\nstore.getProxy().extraParams.codename = app.codename.getValue();"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"{#add#}","itemId":"addbtn","iconCls":"file_add_icon"},"events":{"click":"if(Ext.isEmpty(app.fa_ld.getValue())){\n  Wb.toast('{#selectLedgerMsgTips#}');\n  return;\n}\n\nExt.Msg.wait('');\nvar _flag = true;\nExt.Ajax.request({\n  url : 'm?xwl=xc/fa/common/FA_INFO_PANEL/data/checkPeriods',\n  method: 'POST',\n  async:false,\n  params:{ledger: app.fa_ld.getValue()},\n  success: function(response,options){\n    Ext.Msg.hide();\n    var resp = Ext.JSON.decode(response.responseText);\n\n    if(resp.CNT==0){\n      _flag = false;\n    }\n  },\n  failure: function(response,options){\n    Ext.Msg.hide();\n    Wb.error('{##}');\n  }\n});\n\nif(_flag==false){\n  Wb.toast('{#noExistOpenPeriod#}');\n  return;\n}\n\napp.LEDGER_ID.getStore().load(function(){\n  app.LEDGER_ID.setValue(app.fa_ld.getValue());\n\n  app.PERIOD_CODE.getStore().load(function(){\n    if(app.PERIOD_CODE.getStore().getCount()>0){\n      var pRecord = app.PERIOD_CODE.getStore().getAt(0);\n      app.PERIOD_CODE.setValue(pRecord.get('PERIOD_CODE'));\n      \n      app.DIVISION_DATE.setMinValue(pRecord.get('START_DATE'));\n      app.DIVISION_DATE.setMaxValue(pRecord.get('END_DATE'));\n      \n      app.DIVISION_DATE.setValue(pRecord.get('START_DATE'));\n      \n      /*if(pRecord.get('IN_PERIOD')=='1'){\n        app.DIVISION_DATE.setValue(new Date());\n      }else{\n        app.DIVISION_DATE.setValue(pRecord.get('END_DATE'));\n      }*/\n    }\n  });\n});\n\nopType = 'create';//操作类型\n\napp.window1.setTitle('{#add#}');\nWb.reset(app.formPanel);\n//app.DIVISION_DATE.setValue(new Date());\napp.DIVISION_ID.setValue(Xip.getId());\napp.ASSET_ID.setValue();\napp.ASSET_NAME_PICK.setValue();\napp.grid1.getStore().getProxy().extraParams.DIVISION_ID = '-1';\napp.grid1.getStore().load();\napp.grid2.getStore().getProxy().extraParams.ASSET_ID = '-1';\napp.grid2.getStore().load();\napp.ASSET_NAME_PICK.setReadOnly(false);\napp.addDtlbtn.show();\napp.delBtn.show();\napp.saveBtn.show();\napp.LEDGER_ID.hideTrigger = false;\napp.window1.show();\n\n//app.DIVISION_DATE.setReadOnly(false);\napp.BZSM.setReadOnly(false);\n\napp.CREATED_BY.setValue('{#XIP.userId#}');\napp.CREATED_BY_VIEW.setValue('{#XIP.empName#}');\n\n\n// var win = new Ext.window.Window(app._window1); //app._win指向配置对象而非实例\n// win.show();\n// win.setIconCls('record_add_icon');\n// app.LEDGER_ID.setValue(app.fa_ld.getValue());\n// app.DIVISION_ID.setValue(Xip.getId());\n// Wb.setTitle(win, '{#add#}');\n// 窗口每次动态生成,方法在窗口销毁时自动销毁\n// win.mon(win, 'ok', function() {\n//   //验证信息方法\n \n//  var isVer= verifyFrom();\n//   if(isVer==false){\n//  return false;\n//   }\n\n//    Wb.request({\n//                   url: 'm?xwl=xc/fa/daily-business/fa_split/data/INSERT_XC_FA_DIVISION',\n//                   params:{\n//                     DIVISION_ID :app.DIVISION_ID.getValue(),\n//                     LEDGER_ID :app.LEDGER_ID.getValue(),\n//                     DIVISION_DATE :app.DIVISION_DATE.getValue(),  \n//                     PERIOD_CODE:app.PERIOD_CODE.getValue(),\n//                     BZSM:app.BZSM.getValue(),\n//                     ASSET_ID :app.ASSET_ID.getValue(),\n//                     YZ:YZ,\n//                     SL:SL,\n//                     LJZJ_LJTX:LJZJ_LJTX,\n//                     JZZB:JZZB\n//                   },\n//                   success: function(resp) {\n//                     //保存子表数据\n//                     Wb.sync({\n//                       grid: app.grid1,\n//                       url: 'm?xwl=xc/fa/daily-business/fa_split/data/save',\n//                       message: '{#saveWaitMsg#}',\n//                       success: function(resp) {\n//                       //  Wb.info('{#successMsg#}');\n//                         //ID_FIELD值在后台生成，把返回的ID_FIELD值列表同步到表格中\n//                          app.grid1.store.load({params:{DIVISION_ID:app.DIVISION_ID.getValue()},\n//                                                callback :function(){\n//                                                  countAfterList();\n//                                                  //更新到资产\n//                                                updateAdditions();\n//                                                  syncDivision2Additions(opType);\n//                                                }\n//                                               });\n//                         Wb.syncCreate(app.grid1, Wb.decode(resp.responseText));\n                        \n//                         Wb.info('保存成功');\n//                       }\n//                     });\n//                   }\n//               });\n \n\n// });\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#edit#}","itemId":"editBtn","iconCls":"file_edit_icon"},"events":{"click":"var record = app.grid_h.getSelection()[0];\nif (!record) {\n  Wb.toast('{#selRecord#}');\n  return;\n}\n\napp.window1.setTitle('{#edit#}');\n\napp.DIVISION_DATE.setMinValue();\napp.DIVISION_DATE.setMaxValue();\n\nWb.reset(app.formPanel);\nopType = 'update';\napp.DIVISION_ID.setValue(record.get('DIVISION_ID'));\napp.LEDGER_ID.getStore().load(function(){\n  app.LEDGER_ID.setValue(record.get('LEDGER_ID'));\n});\napp.DIVISION_DATE.setValue(record.get('DIVISION_DATE'));\napp.BZSM.setValue(record.get('BZSM'));\napp.PERIOD_CODE.setValue(record.get('PERIOD_CODE'));\n\napp.CREATED_BY.setValue(record.get('CREATED_BY'));\napp.CREATED_BY_VIEW.setValue(record.get('CREATED_BY_VIEW'));\napp.ASSET_ID.setValue(record.get('ASSET_ID'));\napp.ASSET_NAME_PICK.setValue(record.get('ZCMC'));\napp.grid2.getStore().load();\napp.grid1.getStore().load();\napp.ASSET_NAME_PICK.setReadOnly(true);\napp.addDtlbtn.hide();\napp.delBtn.hide();\napp.saveBtn.hide();\napp.LEDGER_ID.hideTrigger = true;\napp.window1.show();\n\napp.DIVISION_DATE.setReadOnly(true);\napp.BZSM.setReadOnly(true);\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#delete#}","itemId":"delBtn4List","iconCls":"file_delete_icon"},"events":{"click":"var record = app.grid_h.getSelection()[0];\nif (!record) {\n  Wb.toast('{#selRecord#}');\n  return;\n}\n\nExt.Msg.wait('');\nvar _flag = true;\nExt.Ajax.request({\n  url : 'm?xwl=xc/fa/daily-business/fa_split/data/CHECK_SUB_SPLIT',\n  method: 'POST',\n  async:false,\n  params:{divisionId: record.get('DIVISION_ID')},\n  success: function(response,options){\n    Ext.Msg.hide();\n    var resp = Ext.JSON.decode(response.responseText);\n\n    if(resp.CNT>0){\n      _flag = false;\n    }\n  },\n  failure: function(response,options){\n    Ext.Msg.hide();\n    Wb.error('{#requestFailure#}');\n  }\n});\n\nif(_flag==false){\n  Wb.toast('{#subAssetHasSplit#}');\n  return;\n}\n\nWb.confirm('{#deleteConfirmMsg#}', function() {\n  var saveJson = {};\n  var faDivisionH = {};\n  faDivisionH.divisionId = record.data.DIVISION_ID;\n  faDivisionH.ledgerId = record.data.LEDGER_ID;\n  faDivisionH.divisionDate =record.data.DIVISION_DATE;\n  faDivisionH.periodCode =  record.data.PERIOD_CODE;\n  faDivisionH.bzsm =  record.data.BZSM;\n  faDivisionH.assetId =  record.data.ASSET_ID;\n  faDivisionH.yz = record.data.YZ;\n  faDivisionH.ljzjljtx = record.data.LJZJ_LJTX;\n  faDivisionH.sl = record.data.SL ;\n  faDivisionH.jzzb = record.data.JZZB ;\n  saveJson.faDivisionH = faDivisionH;\n  var jsonData = Ext.JSON.encode(saveJson);\n\n  // 提交ajax请求\n  Ext.Msg.wait('{#saveWaitMsg#}');\n  Ext.Ajax.request({\n    url: '{#contextPath#}' + '/faDivisionAction.do?method=deleteFaDivision',\n    method: 'POST',\n    sync: false,\n    timeout: 300000,\n    headers: {\n      'Content-Type': 'application/json'\n    },\n    jsonData: jsonData,\n    success: function(res, opts) {\n      Ext.Msg.hide();\n\n      var temp = res.responseText;\n      var resp = Ext.JSON.decode(temp);\n\n      if(resp.flag == 0){\n        Wb.toast('{#deleteSuccessMsg#}');\n\n\n        app.grid_h.store.load({params:{LEDGER_ID:app.fa_ld.getValue()}});\n      }else{\n        Wb.error(resp.msg);\n      }\n    },\n    failure: function(res, opts) {\n      Ext.Msg.hide();\n      Wb.error('{#deleteFailureMsg#}');\n    }\n  });\n});\n"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#rowNo#}","align":"center","width":"50","xtype":"rownumberer","titleAlign":"center","itemId":"ROW_NUM_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"DIVISION_ID","hidden":"true","dataIndex":"DIVISION_ID","titleAlign":"center","itemId":"DIVISION_ID_COL1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"ASSET_ID","hidden":"true","dataIndex":"ASSET_ID","titleAlign":"center","itemId":"ASSET_ID_COL1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"LEDGER_ID","hidden":"true","dataIndex":"LEDGER_ID","titleAlign":"center","itemId":"LEDGER_ID_COL1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#ZCBM#}","width":"160","dataIndex":"ZCBM","titleAlign":"center","itemId":"ZCBM_COL1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#ZCMC#}","width":"160","dataIndex":"ZCMC","titleAlign":"center","itemId":"ZCMC_COL1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#DIVISION_DATE#}","align":"center","dataIndex":"DIVISION_DATE","titleAlign":"center","itemId":"DIVISION_DATE_COL1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#BZSM#}","width":"180","dataIndex":"BZSM","titleAlign":"center","itemId":"BZSM_COL1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#SL#}","width":"120","align":"right","dataIndex":"SL","titleAlign":"center","itemId":"SL_COL1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#YZ#}","width":"120","align":"right","dataIndex":"YZ","format":"00,000.00","titleAlign":"center","itemId":"YZ_COL1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#LJZJ_LJTX#}","width":"120","align":"right","dataIndex":"LJZJ_LJTX","format":"00,000.00","titleAlign":"center","itemId":"LJZJ_LJTX_COL1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#JZZB#}","width":"120","align":"right","dataIndex":"JZZB","format":"00,000.00","titleAlign":"center","itemId":"JZZB_COL1"},"children":[],"expanded":true,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":false,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}