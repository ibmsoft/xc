{"inframe":false,"title":"账簿参数设置","hidden":false,"roles":{"default":1},"children":[{"configs":{"loginRequired":"false","serverScript":"request.setAttribute('contextPath',request.getContextPath());\n//---------------------获取当前模块语言对应的.json文件，放到request中----------------\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xc/fa/ld-base/fa_ld_param/XC_FA_LD_PRARM\");","itemId":"module"},"events":{"finalize":"function returnRowFn(id){\n  var P_LEDGER_ID = id;\n Wb.request({\n          url: 'm?xwl=xc/fa/ld-base/fa_ld_param/data/SELECT_XC_FA_ADDITIONS',\n          params: {LEDGER_ID:P_LEDGER_ID},\n          success: function(resp) {\n            var r = Wb.decode(resp.responseText);\n            if(r.INIT_COUNT>0){\n               app.PERIOD_CODE.setReadOnly(true);\n              \n            }else{\n               app.PERIOD_CODE.setReadOnly(false);\n              \n               \n            }\n          }\n        });\n \n}\nfunction clearOtherFn(type){\n  if(type=='xc_gl_ledgers'){\n  \n    app.PERIOD_CODE.setValue('');\n  }\n  \n  //清空账薄时清空面板中所有信息\n  if(type=='cancelLedger'){\n    app.form1.getForm().reset();\n   \n    app.PERIOD_CODE.setValue('');\n  }\n  \n}\n//根据账簿id查询数据，回显json\nfunction queryLdParamId(id){\n  app.ldInitStore.load({params:{LEDGER_ID: id},callback:function(){\n    var count=app.ldInitStore.getCount();\n    \n    if(count =='0'){\n\n      app.LD_PARAM_ID.setValue();\n         app.PERIOD_CODE.setValue();\n      app.zcRule.setValue();\n       app.tzRule.setValue();\n    }else {\n      var lid=app.ldInitStore.getAt(0).get('LD_PARAM_ID');\n      var str =app.ldInitStore.getAt(0).get('PARAMS');\n      app.LD_PARAM_ID.setValue(lid);\n       var json=eval('(' + str + ')'); \n      app.PERIOD_CODE.setValue(json.statDate);\n      app.zcRule.setValue(json.zc);\n       app.tzRule.setValue(json.tz);\n\n    }\n\n              }}\n                          \n                          \n                          );\n}"},"children":[{"configs":{"itemId":"request"},"children":[{"configs":{"itemId":"ldInitStore","url":"m?xwl=xc/fa/ld-base/fa_ld_param/data/SELECT_XC_FA_LD_PARAM"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"folder"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"{#save#}","itemId":"saveBtn","iconCls":"ok_icon"},"events":{"click":"var p_id=app.LD_PARAM_ID.getValue();\nvar json ={\n  statDate: app.PERIOD_CODE.getValue(),\n  zc: app.zcRule.getValue(),\n  tz: app.tzRule.getValue()\n};\nvar str=JSON.stringify(json);\nif (app.form1.isValid()) {\n\n  if( p_id== '' || p_id== null){\n    //新增\n    Wb.request({\n      url: 'm?xwl=xc/fa/ld-base/fa_ld_param/data/INSERT_XC_FA_LD_PRARM',\n      params:{\n        LEDGER_ID :app.FA_LD.getValue(),\n        PARAMS:str,\n        PERIOD_CODE:app.PERIOD_CODE.getValue()\n      },\n      success: function(resp) {\n        Wb.toast('保存成功！');\n      }\n    });\n\n  }else{\n    //更新\n    Wb.request({\n      url: 'm?xwl=xc/fa/ld-base/fa_ld_param/data/UPDATE_XC_FA_LD_PRARM',\n      params:{\n        LD_PARAM_ID :p_id,\n        LEDGER_ID :app.FA_LD.getValue(),\n        PARAMS:str\n      },\n      success: function(resp) {\n        Wb.toast('保存成功！');\n      }\n    });\n\n  }\n} else {\n  Wb.toast('请将必输项输入完整！');\n}"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"layout":"border","itemId":"viewport1"},"children":[{"configs":{"tbar":"app.tbar","region":"center","bodyPadding":"padding:1% 20% 1% 20%;","border":"false","itemId":"form1"},"children":[{"configs":{"title":"{#query#}","itemId":"fieldset1"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","height":"35","layout":"column","border":"false","itemId":"tr1"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".25","border":"false","itemId":"td_1_1"},"children":[{"configs":{"tagConfigs":"columnWidth:0.43","labelWidth":"120","allowBlank":"false","queryMode":"remote","displayField":"NAME","valueField":"ID","typeAhead":"false","labelAlign":"right","itemId":"FA_LD","fieldLabel":"<font color='red'>*<\/font> {#dl#}","editable":"false"},"events":{"select":"returnRowFn(app.FA_LD.getValue());\nqueryLdParamId(app.FA_LD.getValue());\n  clearOtherFn('xc_gl_ledgers');"},"children":[{"configs":{"itemId":"store","autoLoad":"true","url":"m?xwl=xc/com-qry/gl-ledgers/select-sec-ledger"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"fieldset"},{"configs":{"title":"{#dlparam#}","itemId":"fieldset2"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"column","border":"false","itemId":"tr2"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".5","border":"false","itemId":"td_2_1"},"children":[{"configs":{"itemId":"LD_PARAM_ID"},"children":[],"expanded":false,"type":"hidden"},{"configs":{"labelWidth":"120","allowBlank":"false","displayField":"PERIOD_CODE","valueField":"PERIOD_CODE","labelAlign":"right","itemId":"PERIOD_CODE","fieldLabel":"<span style=\"color: rgb(255, 0, 0); \">*<\/span>{#open#}"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/fa/ld-base/fa_ld_param/data/getPeriods"},"events":{"beforeload":"//operation.params = Wb.getValue(app.form1);\nstore.getProxy().extraParams.ledger = app.FA_LD.getValue();\n"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"column","border":"false","itemId":"tr21"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".5","border":"false","itemId":"td_2_2"},"children":[{"configs":{"tagConfigs":"columnWidth:0.43","labelWidth":"120","allowBlank":"false","queryMode":"local","displayField":"RULE_DESC","valueField":"RULE_CODE","typeAhead":"false","labelAlign":"right","itemId":"zcRule","fieldLabel":"<font color='red'>*<\/font> {#anrule#}","editable":"false"},"children":[{"configs":{"itemId":"store","autoLoad":"true","url":"m?xwl=xc/fa/ld-base/fa_ld_param/data/SELECT_FA_AS_RULE"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"column","border":"false","itemId":"tr22"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".5","border":"false","itemId":"td_2_3"},"children":[{"configs":{"tagConfigs":"columnWidth:0.43","labelWidth":"120","allowBlank":"false","queryMode":"local","displayField":"RULE_DESC","valueField":"RULE_CODE","typeAhead":"false","labelAlign":"right","itemId":"tzRule","fieldLabel":"<font color='red'>*<\/font> {#adrule#}","editable":"false"},"children":[{"configs":{"itemId":"store","autoLoad":"true","url":"m?xwl=xc/fa/ld-base/fa_ld_param/data/SELECT_FA_ADJ_RULE"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"fieldset"}],"expanded":true,"type":"form"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}