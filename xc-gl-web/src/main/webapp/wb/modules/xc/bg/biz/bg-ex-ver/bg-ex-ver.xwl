{"inframe":false,"title":"费用预算版本管理","hidden":false,"roles":{"default":1},"children":[{"configs":{"initScript":"//---------------------获取当前模块语言对应的.json文件，放到request中----------------\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xc/bg/biz/bg-ex-ver/json/bg-ex-ver\");\nvar years = '[';\nfor(var i = 1970;i <= 2100;i++){\n    years += (i+',');\n}\nyears += ']';\nrequest.setAttribute('contentPath',request.getContextPath());\nrequest.setAttribute('YEARS',years);","loginRequired":"false","itemId":"module"},"events":{"finalize":"var buttonChange = '';"},"children":[{"configs":{"itemId":"tool"},"children":[{"configs":{"pageSize":"-1","itemId":"ledger_store","url":"m?xwl=xc/com-qry/gl-ledgers/select-sec-fd-ledgers"},"children":[],"expanded":false,"type":"store"},{"configs":{"pageSize":"-1","autoLoad":"true","itemId":"period_store","url":"m?xwl=xc/bg/biz/bg-ex-ver/bg-ex-verDB/yearSelect"},"events":{"beforeload":"store.proxy.extraParams.LEDGER_ID = app.LEDGER_ID.getValue();"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"buttonArray"},"children":[{"configs":{"text":"{#saveBtn#}","itemId":"okButton","iconCls":"ok_icon"},"events":{"click":"if(app.LEDGER_ID.getValue() === null){\n    Wb.toast('{#saveInfo1#}');//账簿不能为空！请重新输入\n    return;\n}\nif(app.BG_VER_PERIOD.getValue() === null){\n    Wb.toast('{#saveInfo2#}');//会计年度不能为空！请重新输入\n    return;\n}\nif(app.BG_VER_CODE.getValue() === ''){\n    Wb.toast('{#saveInfo3#}');//编码不能为空！请重新输入\n    return;\n}\nif(app.BG_VER_NAME.getValue() === ''){\n    Wb.toast('{#saveInfo4#}');//名称不能为空！请重新输入\n    return;\n}\nif(app.START_DATE.getValue() > app.END_DATE.getValue()){\n    Wb.toast('{#saveInfo5#}');//结束日期不能小于开始日期，请重新输入！\n    return;\n}\nif(buttonChange === 'insertButton'){\n    saveInsert();\n}\nif(buttonChange === 'editButton'){\n    saveEdit();\n}\nfunction saveInsert(){\n    Wb.request({\n        url: 'm?xwl=xc/bg/biz/bg-ex-ver/bg-ex-verDB/bg-ex-verInsert',\n        out : app.bg_ver_window,\n        success: function(resp) {\n            Wb.toast('{#saveInfo6#}');//数据新增成功\n            app.searchButton.fireEvent('click');\n            app.bg_ver_window.hide();\n        }\n    });\n}\nfunction saveEdit(){\n    Wb.request({\n        url: 'm?xwl=xc/bg/biz/bg-ex-ver/bg-ex-verDB/bg-ex-verEdit',\n        out : app.bg_ver_window,\n        success: function(resp) {\n            Wb.toast('{#saveInfo7#}');//数据修改成功\n            app.searchButton.fireEvent('click');\n            app.bg_ver_window.hide();\n        }\n    });\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#cancelBtn#}","itemId":"cancelButton","iconCls":"cancel_icon"},"events":{"click":"app.bg_ver_window.hide();"},"children":[],"expanded":true,"type":"button"}],"expanded":false,"type":"array"}],"expanded":true,"type":"folder"},{"configs":{"height":"228","width":"820","closeAction":"hide","resizable":"false","buttonAlign":"center","buttons":"app.buttonArray","defaultFocus":"LEDGER_ID","itemId":"bg_ver_window","modal":"true"},"children":[{"configs":{"tagConfigs":"baseCls:'my-panel-no-border'","itemId":"bg_ver_form"},"children":[{"configs":{"tagConfigs":"baseCls:'my-panel-no-border'","layout":"column","margin":"10 0 0 0","border":"false","itemId":"row1"},"children":[{"configs":{"tagConfigs":"columnWidth : 0.35","labelWidth":"80","allQuery":"false","store":"app.ledger_store","displayField":"LEDGER_NAME","valueField":"LEDGER_ID","labelAlign":"right","itemId":"LEDGER_ID","fieldLabel":"<font color='red'>*<\/font>{#LEDGER_NAME#}","editable":"false"},"events":{"change":"var ledger_id = app.LEDGER_ID.getValue();\nWb.request({\n    url : 'm?xwl=xc/bg/biz/bg-ex-ver/bg-ex-verDB/orgsSelect',//判断是否有会计科目数据\n    params : {LEDGER_ID : ledger_id},//传参\n    success: function(resp){\n        var temp = Wb.decode(resp.responseText);\n        if(temp.total > 0){\n            app.ORG_ID.setValue(temp.rows[0].ORG_NAME);\n\t\t}\n        else{\n            app.ORG_ID.setValue('');\n        }\n    }\n});\napp.BG_VER_PERIOD.reset();"},"children":[],"expanded":true,"type":"combo"},{"configs":{"tagConfigs":"columnWidth : 0.42","labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"ORG_ID","fieldLabel":"{#org_com#}"},"children":[],"expanded":false,"type":"text"},{"configs":{"tagConfigs":"columnWidth : 0.2","labelWidth":"80","allowBlank":"false","store":"app.period_store","displayField":"YEAR","valueField":"YEAR","labelAlign":"right","itemId":"BG_VER_PERIOD","fieldLabel":"<font color='red'>*<\/font>{#bg_ver_period_com#}","editable":"false"},"children":[],"expanded":true,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls:'my-panel-no-border'","layout":"column","margin":"10 0 0 0","border":"false","itemId":"row2"},"children":[{"configs":{"tagConfigs":"columnWidth : 0.35","labelWidth":"80","allowBlank":"false","labelAlign":"right","itemId":"BG_VER_CODE","fieldLabel":"<font color='red'>*<\/font>{#BG_VER_CODE#}"},"children":[],"expanded":false,"type":"text"},{"configs":{"tagConfigs":"columnWidth : 0.35","labelWidth":"80","hidden":"true","labelAlign":"right","itemId":"BG_VER_ID","fieldLabel":"版本ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"tagConfigs":"columnWidth : 0.62","labelWidth":"80","allowBlank":"false","labelAlign":"right","itemId":"BG_VER_NAME","fieldLabel":"<font color='red'>*<\/font>{#BG_VER_NAME#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls:'my-panel-no-border'","layout":"column","margin":"10 0 0 0","border":"false","itemId":"row3"},"children":[{"configs":{"tagConfigs":"columnWidth : 0.97","labelWidth":"80","height":"45","labelAlign":"right","itemId":"BG_VER_DESC","fieldLabel":"{#BG_VER_DESC#}"},"children":[],"expanded":false,"type":"textarea"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls:'my-panel-no-border'","layout":"column","margin":"10 0 0 0","border":"false","itemId":"row4"},"children":[{"configs":{"tagConfigs":"columnWidth : 0.35","labelWidth":"80","allowBlank":"false","labelAlign":"right","itemId":"START_DATE","fieldLabel":"<font color='red'>*<\/font>{#START_DATE#}"},"children":[],"expanded":false,"type":"date"},{"configs":{"tagConfigs":"columnWidth : 0.35","labelWidth":"80","allowBlank":"false","labelAlign":"right","itemId":"END_DATE","fieldLabel":"<font color='red'>*<\/font>{#END_DATE#}"},"children":[],"expanded":false,"type":"date"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"form"}],"expanded":true,"type":"window"},{"configs":{"layout":"border","itemId":"viewport1"},"children":[{"configs":{"region":"north","itemId":"search_form"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"column","margin":"10 0 10 0","border":"false","itemId":"row1"},"children":[{"configs":{"tagConfigs":"columnWidth : 0.25","labelWidth":"80","store":"app.ledger_store","displayField":"LEDGER_NAME","valueField":"LEDGER_ID","emptyText":"{#LEDGER_NAME_EMPYT#}","labelAlign":"right","itemId":"ledgers_com","fieldLabel":"{#LEDGER_NAME#}","editable":"false"},"events":{"select":"app.searchButton.fireEvent('click');\nvar ledger_id = app.ledgers_com.getValue();\nWb.request({\n    url : 'm?xwl=xc/bg/biz/bg-ex-ver/bg-ex-verDB/orgsSelect',\n    params : {LEDGER_ID : ledger_id},//传参\n    success: function(resp){\n        var temp = Wb.decode(resp.responseText);\n        if(temp.total > 0){\n            app.org_com.setValue(temp.rows[0].ORG_NAME);\n\t\t}\n        else{\n            app.org_com.setValue('');\n        }\n    }\n});","specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.searchButton.fireEvent('click');\n}"},"children":[],"expanded":true,"type":"combo"},{"configs":{"tagConfigs":"columnWidth : 0.32","labelWidth":"80","readOnly":"true","store":"app.ledger_store","labelAlign":"right","itemId":"org_com","fieldLabel":"{#org_com#}"},"children":[],"expanded":true,"type":"combo"},{"configs":{"tagConfigs":"columnWidth : 0.15","labelWidth":"80","labelAlign":"right","itemId":"bg_ver_period_com","fieldLabel":"{#bg_ver_period_com#}"},"events":{"change":"if(text.getValue() === ''){\n    app.searchButton.fireEvent('click');\n}","specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.searchButton.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"},{"configs":{"tagConfigs":"columnWidth : 0.08","text":"{#selBtn#}","margin":"0 0 0 20","itemId":"searchButton","iconCls":"seek_icon"},"events":{"click":"var params = {\n    LEDGER_ID : app.ledgers_com.getValue(),\n\tBG_VER_PERIOD : Ext.String.escape(app.bg_ver_period_com.getValue())\n};\napp.bg_ver_grid.store.load({params : params});//查询（重新加载数据）"},"children":[],"expanded":false,"type":"button"},{"configs":{"tagConfigs":"columnWidth : 0.08","text":"{#resetBtn#}","margin":"0 0 0 20","itemId":"resetButton","iconCls":"refresh_icon"},"events":{"click":"app.search_form.getForm().reset();\napp.searchButton.fireEvent('click');"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"form"},{"configs":{"region":"center","itemId":"bg_ver_grid"},"events":{"itemdblclick":"app.editButton.fireEvent('click');"},"children":[{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"{#addBtn#}","itemId":"addButton","iconCls":"file_add_icon"},"events":{"click":"Wb.request({//得到UUID\n    url : 'm?xwl=xc/bg/biz/bg-ex-ver/bg-ex-verDB/getUUID',\n    success : function(res){\n        var temp = Ext.decode(res.responseText);\n        var win = new Ext.window.Window(app._bg_ver_window); //app._strategy_window指向配置对象而非实例\n        win.show();//显示窗口\n        win.setIconCls('file_add_icon');//图标\n        Wb.setTitle(win,'{#addRec1#}');//标题--增加费用预算版本\n        buttonChange = 'insertButton';\n        app.LEDGER_ID.setValue(app.ledgers_com.getValue());\n        app.START_DATE.setValue(Ext.Date.parse(Ext.util.Format.date(new Date(),'Y-m-d'),'Y-m-d'));\n        app.END_DATE.setValue(Ext.Date.parse('9999-12-31','Y-m-d'));\n        app.BG_VER_ID.setValue(temp.uuid);\n\t}\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#editBtn#}","itemId":"editButton","iconCls":"file_edit_icon"},"events":{"click":"var rec = app.bg_ver_grid.getSelection();\nif(app.ledgers_com.getValue() === '' || app.ledgers_com.getValue() === null){\n\tWb.toast('{#editRec1#}');//请选择账簿进行查询\n    return;\n}\nif (rec.length > 1 || rec.length === 0) {//大于一条或没选择会警告\n    Wb.toast('{#editRec2#}');//请选择一条需要修改的记录。\n    return;\n}\nbuttonChange = 'editButton';\nvar win = new Ext.window.Window(app._bg_ver_window); //app._strategy_window指向配置对象而非实例\nwin.show();//显示窗口\nwin.setIconCls('file_edit_icon');//图标\nWb.setTitle(win,'{#editRec3#}\"'+rec[0].data.BG_VER_NAME+'\"');//标题--修改费用预算版本\nWb.setValue(win,rec[0].data);//把记录数据应用到窗口\napp.LEDGER_ID.setReadOnly(true);\napp.BG_VER_PERIOD.setReadOnly(true);\napp.BG_VER_CODE.setReadOnly(true);\napp.END_DATE.setReadOnly(true);"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#delBtn#}","itemId":"deleteButton","iconCls":"file_delete_icon"},"events":{"click":"var recs = app.bg_ver_grid.getSelection();//获得选中数据\nif(app.ledgers_com.getValue() === '' || app.ledgers_com.getValue() === null){\n\tWb.toast('{#editRec1#}');//请选择账簿进行查询\n    return;\n}\nif (recs.length > 1 || recs.length === 0) {//大于一条或没选择会警告\n    Wb.toast('{#deleteRec1#}');\n    return;\n}\nWb.confirm('{#deleteRec2#}\"' + recs[0].data.BG_VER_NAME + '\"{#deleteRec3#}',function() {\n// Wb.confirm('确定要删除选择的\"' + recs[0].data.BG_VER_NAME + '\"吗？',function() {\n    Wb.request({\n        url : 'm?xwl=xc/bg/biz/bg-ex-ver/bg-ex-verDB/bg-ex-verDelete',\n        params : {'deleteArray' : Wb.encode(Wb.getData(recs))},//传参\n        success: function(resp){\n            Wb.toast('{#deleteRec4#}\"'+recs[0].data.BG_VER_NAME+'\"{#deleteRec5#}');//费用预算版本\"'+recs[0].data.BG_VER_NAME+'\"删除成功\n            Wb.remove(app.bg_ver_grid);//直接从表格中删除\n            app.searchButton.fireEvent('click');\n        }\n    });\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#effectButton#}","itemId":"effectButton","iconCls":"check_icon"},"events":{"click":"var rec = app.bg_ver_grid.getSelection();//获得选中数据\nvar is_count = 0;\nif(app.ledgers_com.getValue() === '' || app.ledgers_com.getValue() === null){\n\tWb.toast('{#editRec1#}');//请选择账簿进行查询\n    return;\n}\nif (rec.length > 1 || rec.length === 0) {//大于一条或没选择会警告\n    Wb.toast('{#effectRec1#}');//请选择一条需要生效的记录\n    return;\n}\nif(rec[0].data.IS_VALID == 'N'){\n    Wb.request({\n        url: '{#contentPath#}/bgValidationAction.do?method=changeFeeBudgetVersion',\n        params : { bgVersionId : rec[0].data.BG_VER_ID,\n                   ledgerId : rec[0].data.LEDGER_ID\n                 },\n        success: function(response) {\n            var returnObj = Wb.decode(response.responseText);\n            if(returnObj.flag === '0'){\n               Wb.info(returnObj.msg);\n               app.searchButton.fireEvent('click');\n            }else{\n               Wb.info(returnObj.msg);\n            }\n        }\n    });\n}\nelse {\n    Wb.toast('{#effectRec2#}\"'+rec[0].data.BG_VER_NAME+'\"{#effectRec3#}');\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#budgetButton#}","itemId":"budgetButton","iconCls":"zoom_icon"},"events":{"click":"var rec = app.bg_ver_grid.getSelection();\nif(app.ledgers_com.getValue() === '' || app.ledgers_com.getValue() === null){\n\tWb.toast('{#editRec1#}');//请选择账簿进行查询\n    return;\n}\nif (rec.length > 1 || rec.length === 0) {//大于一条或没选择会警告\n    Wb.toast('{#seekRec1#}');\n    return;\n}\nWb.run({\n    url : 'm?xwl=xc/bg/biz/bg-ex-ver/bg-cost-bal',\n    success : function(appObj){\n        appObj.initWindow({\n            BG_VER_ID : rec[0].data.BG_VER_ID,\n            LEDGER_ID : app.ledgers_com.getValue(),\n            title : '{#seekRec2#}'//窗口名称\n        });\n    }\n});"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"store","url":"m?xwl=xc/bg/biz/bg-ex-ver/bg-ex-verDB/bg-ex-verSelect"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#number#}","width":"50","xtype":"rownumberer","align":"center","titleAlign":"center","itemId":"ORDERBY"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"版本ID","hidden":"true","dataIndex":"BG_VER_ID","titleAlign":"center","itemId":"BG_VER_ID_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"账簿ID","hidden":"true","dataIndex":"LEDGER_ID","titleAlign":"center","itemId":"LEDGER_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#BG_VER_CODE#}","width":"100","dataIndex":"BG_VER_CODE","titleAlign":"center","itemId":"BG_VER_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#BG_VER_NAME#}","width":"200","dataIndex":"BG_VER_NAME","titleAlign":"center","itemId":"BG_VER_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#BG_VER_DESC#}","width":"200","dataIndex":"BG_VER_DESC","titleAlign":"center","itemId":"BG_VER_DESC_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#bg_ver_period_com#}","width":"80","dataIndex":"BG_VER_PERIOD","titleAlign":"center","itemId":"BG_VER_PERIOD_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#START_DATE#}","width":"100","dataIndex":"START_DATE","titleAlign":"center","itemId":"START_DATE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#END_DATE#}","width":"100","dataIndex":"END_DATE","titleAlign":"center","itemId":"END_DATE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#IS_VALID#}","width":"80","dataIndex":"IS_VALID","titleAlign":"center","itemId":"IS_VALID_COL","renderer":"if(value == 'N'){\n    return '<font color=red>否<\/font>';\n}\nif(value == 'Y'){\n\treturn '<font color=blue>是<\/font>';\n}"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":"grid_icon"}