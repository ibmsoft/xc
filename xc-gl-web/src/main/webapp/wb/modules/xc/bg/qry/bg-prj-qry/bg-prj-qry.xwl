{"inframe":false,"title":"项目预算执行查询查询","hidden":false,"roles":{"default":1},"children":[{"configs":{"loginRequired":"false","serverScript":"//三方语言，引入对应的json文件\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,'xc/bg/qry/bg-prj-qry/json/bg-prj-qry');\nrequest.setAttribute('contextPath',request.getContextPath());\n\n// TODO: 如果budgetType值为1,则查询个人项目预算执行情况； 否则查询全局项目预算执行情况。\nvar _budgetType = request.getParameter('budgetType');\nif(_budgetType === null) _budgetType = '';\nrequest.setAttribute('budgetType',_budgetType);","itemId":"module"},"children":[{"configs":{"layout":"border","itemId":"viewport1"},"children":[{"configs":{"region":"north","itemId":"search_form"},"children":[{"configs":{"layout":"column","margin":"10 0 10 0","border":"false","itemId":"panel1"},"children":[{"configs":{"tagConfigs":"columnWidth : 0.25","labelWidth":"80","displayField":"LEDGER_NAME","valueField":"LEDGER_ID","emptyText":"{#emptyText1#}","labelAlign":"right","itemId":"ledgers_com","fieldLabel":"{#ledger#}","editable":"false"},"events":{"select":"app.searchButton.fireEvent('click');","specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.searchButton.fireEvent('click');\n}"},"children":[{"configs":{"autoSync":"true","itemId":"store","url":"m?xwl=xc/com-qry/gl-ledgers/select-sec-fd-ledgers"},"children":[],"expanded":false,"type":"store"}],"expanded":false,"type":"combo"},{"configs":{"tagConfigs":"columnWidth : 0.25","labelWidth":"80","labelAlign":"right","itemId":"project_com","fieldLabel":"{#pro#}"},"events":{"change":"if(newValue === ''){\n    app.searchButton.fireEvent('click');\n}","specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.searchButton.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"},{"configs":{"tagConfigs":"columnWidth : 0.08","text":"{#query#}","margin":"0 0 0 20","itemId":"searchButton","iconCls":"seek_icon"},"events":{"click":"// 加载数据\napp.bg_dept_grid.store.load();"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"form"},{"configs":{"region":"center","itemId":"bg_dept_grid"},"events":{"tagEvents":"'cellclick':function(view,td,cellIndex,record,tr,rowIndex,e,eOpts){\n   if(cellIndex == 5 || cellIndex == 7){\n       var _queryLedgerId = record.data.LEDGER_ID;\n       var _queryProjectId = record.data.PROJECT_ID;\n       var _queryFactType = '1';\n       if(cellIndex == 5){\n         _queryFactType = '2';\n       if(record.data.FACT_AMOUNT == 0)\n           return ;\n       }else{\n         if(record.data.OCCUPY_AMOUNT == 0)\n           return ;\n       }\n       Wb.request({\n         url:'{#contextPath#}/bgValidationAction.do?method=queryBudgetDetailBills',\n         params:{'budgetType':'BG02','ledgerId':_queryLedgerId,'projectId':_queryProjectId,'factType':_queryFactType},\n         success:function(response){\n            var returnObj = Wb.decode(response.responseText);\n            if(returnObj.flag === '0'){\n               Wb.run({\n                 url:'m?xwl=xc/bg/qry/common-win/bg-common-win',\n                 params:{'dataSql':returnObj.msg}\n        });\n            }else{\n                 Wb.info(returnObj.msg);\n            }\n         }\n       });\n   }\n}"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/bg/qry/bg-prj-qry/bg-prj-qryDB/select-global-prj-bg-impl"},"events":{"beforeload":"// 加载参数\nstore.proxy.extraParams.LEDGER_ID =  app.ledgers_com.getValue() ;\nstore.proxy.extraParams.PROJECT_NAME =  Ext.String.escape(app.project_com.getValue()) ;\n\n// 如果budgetType值为1,则查询个人项目预算执行情况； 否则查询全局项目预算执行情况\nvar bgType = '{#budgetType#}' ;\nif(bgType === \"1\"){\n  // 查询个人项目预算执行情况\n  store.proxy.url = 'm?xwl=xc/bg/qry/bg-prj-qry/bg-prj-qryDB/select-person-prj-bg-impl' ;\n  store.proxy.extraParams.USER_ID = '{#XIP.userId#}' ;\n}\n"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#orderBy#}","align":"center","xtype":"rownumberer","width":"50","titleAlign":"center","itemId":"ORDERBY"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#ledgerId#}","hidden":"true","width":"150","dataIndex":"LEDGER_ID","titleAlign":"center","itemId":"LEDGER_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#proId#}","hidden":"true","width":"150","dataIndex":"PROJECT_ID","titleAlign":"center","itemId":"PROJECT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#pro#}","width":"150","dataIndex":"PROJECT_NAME","titleAlign":"center","itemId":"PROJECT_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#bgAmt#}","xtype":"numbercolumn","align":"right","width":"100","dataIndex":"BG_AMT","titleAlign":"center","itemId":"BG_AMT_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#factAmt#}","xtype":"numbercolumn","align":"right","width":"100","dataIndex":"FACT_AMOUNT","titleAlign":"center","itemId":"FACT_AMOUNT_COL","renderer":"if(value === 0){\n  return Ext.util.Format.number(value,'0,000.00') ;\n}else{\n  return '<a href=#>'+Ext.util.Format.number(value,'0,000.00')+'<\/a>';\n}"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#factRate#}","align":"right","width":"100","dataIndex":"FACT_RATE","titleAlign":"center","itemId":"FACT_RATE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#occupyAmt#}","xtype":"numbercolumn","align":"right","width":"100","dataIndex":"OCCUPY_AMOUNT","titleAlign":"center","itemId":"OCCUPY_AMOUNT_COL","renderer":"if(value === 0){\n  return Ext.util.Format.number(value,'0,000.00') ;\n}else{\n  return '<a href=#>'+Ext.util.Format.number(value,'0,000.00')+'<\/a>';\n}"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#occupyRate#}","align":"right","width":"100","dataIndex":"OCCUPY_RATE","titleAlign":"center","itemId":"OCCUPY_RATE_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#remainAmt#}","xtype":"numbercolumn","align":"right","width":"100","dataIndex":"REMAIN_AMOUNT","titleAlign":"center","itemId":"REMAIN_AMOUNT_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#remainRate#}","align":"right","width":"100","dataIndex":"REMAIN_RATE","titleAlign":"center","itemId":"REMAIN_RATE_COL"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":null}