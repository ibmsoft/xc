{"inframe":false,"title":" 查询个人项目预算执行情况","hidden":false,"roles":{"default":1},"children":[{"configs":{"itemId":"module"},"children":[{"configs":{"oracle":"SELECT ba.LEDGER_ID,\n       ba.PROJECT_ID,\n       ba.PROJECT_NAME,\n       ba.BG_AMT,\n       nvl(tmp.OCCUPY_AMOUNT,0) OCCUPY_AMOUNT,\n       ROUND(nvl(tmp.OCCUPY_AMOUNT,0) / ba.BG_AMT * 100, 2) || '%' AS OCCUPY_RATE,\n       nvl(tmp.FACT_AMOUNT,0) FACT_AMOUNT,\n       ROUND(nvl(tmp.FACT_AMOUNT,0) / ba.BG_AMT * 100, 2) || '%' AS FACT_RATE,\n       (ba.BG_AMT - nvl(tmp.FACT_AMOUNT,0) - nvl(tmp.OCCUPY_AMOUNT,0)) AS REMAIN_AMOUNT,\n       (ROUND((ba.BG_AMT - nvl(tmp.FACT_AMOUNT,0) - nvl(tmp.OCCUPY_AMOUNT,0)) / ba.BG_AMT * 100,\n              2) || '%') AS REMAIN_RATE\n              \n  FROM (select doc.LEDGER_ID, doc.PROJECT_ID, xpp.PROJECT_NAME,\n              (select SUM(t.AMOUNT) from xc_bg_doc_dtl t where doc.bg_doc_id = t.bg_doc_id) as BG_AMT\n        from xc_bg_docs doc, xc_pm_projects xpp\n       where doc.project_id = xpp.project_id\n         and doc.bg_cat_code = 'BG02'\n         and doc.audit_status = 'E'\n         and doc.ledger_id = {?LEDGER_ID?}\n         and doc.created_by = {?USER_ID?}\n         and xpp.PROJECT_NAME LIKE '%{#PROJECT_NAME#}%') ba\n         \n    LEFT JOIN (SELECT p.LEDGER_ID,\n               p.PROJECT_ID,\n               p.PROJECT_NAME,\n               SUM(p.OCCUPY_AMOUNT) AS OCCUPY_AMOUNT,\n               SUM(p.FACT_AMOUNT) AS FACT_AMOUNT\n          FROM (SELECT t.LEDGER_ID,\n                       t.PROJECT_ID,\n                       pj.PROJECT_NAME,\n                       CASE t.FACT_TYPE\n                         WHEN '1' THEN\n                          t.AMOUNT\n                         ELSE\n                          0.00\n                       END AS OCCUPY_AMOUNT,\n                       CASE t.FACT_TYPE\n                         WHEN '2' THEN\n                          t.AMOUNT\n                         ELSE\n                          0.00\n                       END AS FACT_AMOUNT\n                  FROM xc_bg_fact t, xc_pm_projects pj\n                 WHERE t.PROJECT_ID = pj.PROJECT_ID\n                   AND t.LEDGER_ID = {?LEDGER_ID?}\n                   AND nvl(t.PROJECT_ID, '') <> '' ) p\n         GROUP BY p.LEDGER_ID, p.PROJECT_ID, p.PROJECT_NAME) tmp\n         \n   ON tmp.LEDGER_ID = ba.LEDGER_ID\n   AND tmp.PROJECT_ID = ba.PROJECT_ID\n","itemId":"sqlswitcher1","mysql":"SELECT ba.LEDGER_ID,\n       ba.PROJECT_ID,\n       ba.PROJECT_NAME,\n       ba.BG_AMT,\n       IFNULL(tmp.OCCUPY_AMOUNT,0) OCCUPY_AMOUNT,\n       CONCAT(ROUND(IFNULL(tmp.OCCUPY_AMOUNT,0) / ba.BG_AMT * 100, 2), '%') AS OCCUPY_RATE,\n       IFNULL(tmp.FACT_AMOUNT,0) FACT_AMOUNT,\n       CONCAT(ROUND(IFNULL(tmp.FACT_AMOUNT,0) / ba.BG_AMT * 100, 2), '%') AS FACT_RATE,\n       (ba.BG_AMT - IFNULL(tmp.OCCUPY_AMOUNT,0) - IFNULL(tmp.FACT_AMOUNT,0)) AS REMAIN_AMOUNT,\n       CONCAT(ROUND((ba.BG_AMT - IFNULL(tmp.OCCUPY_AMOUNT,0) - IFNULL(tmp.FACT_AMOUNT,0)) / ba.BG_AMT * 100,2),'%') AS REMAIN_RATE\n       \n  FROM (select doc.LEDGER_ID, doc.PROJECT_ID, xpp.PROJECT_NAME,\n              (select SUM(t.AMOUNT) from xc_bg_doc_dtl t where doc.bg_doc_id = t.bg_doc_id) as BG_AMT\n        from xc_bg_docs doc, xc_pm_projects xpp\n       where doc.project_id = xpp.project_id\n         and doc.bg_cat_code = 'BG02'\n         and doc.audit_status = 'E'\n         and doc.ledger_id = {?LEDGER_ID?}\n         and doc.created_by = {?USER_ID?}\n         and xpp.PROJECT_NAME LIKE '%{#PROJECT_NAME#}%') ba\n         \n     LEFT JOIN (SELECT p.LEDGER_ID,\n               p.PROJECT_ID,\n               p.PROJECT_NAME,\n               SUM(p.OCCUPY_AMOUNT) AS OCCUPY_AMOUNT,\n               SUM(p.FACT_AMOUNT) AS FACT_AMOUNT\n          FROM (SELECT t.LEDGER_ID,\n                       t.PROJECT_ID,\n                       pj.PROJECT_NAME,\n                       CASE t.FACT_TYPE\n                         WHEN '1' THEN\n                          t.AMOUNT\n                         ELSE\n                          0.00\n                       END AS OCCUPY_AMOUNT,\n                       CASE t.FACT_TYPE\n                         WHEN '2' THEN\n                          t.AMOUNT\n                         ELSE\n                          0.00\n                       END AS FACT_AMOUNT\n                  FROM xc_bg_fact t, xc_pm_projects pj\n                 WHERE t.PROJECT_ID = pj.PROJECT_ID\n                   AND t.LEDGER_ID = {?LEDGER_ID?}\n                   AND IFNULL(t.PROJECT_ID, '') <> '' ) p\n         GROUP BY p.LEDGER_ID, p.PROJECT_ID, p.PROJECT_NAME) tmp\n         \n   ON tmp.LEDGER_ID = ba.LEDGER_ID\n   AND tmp.PROJECT_ID = ba.PROJECT_ID\n"},"children":[],"expanded":false,"type":"sqlswitcher"},{"configs":{"sql":"{#sqlswitcher1#}","itemId":"dataprovider1"},"children":[],"expanded":false,"type":"dataprovider"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":"seek_icon"}