{"inframe":false,"title":"","hidden":false,"roles":{"default":1},"children":[{"configs":{"title":"预算项目设置","initScript":"//---------------------获取当前模块语言对应的.json文件，放到request中----------------\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xc/bg/base/bg-ld-items/json/bd-ld-items\");","loginRequired":"false","jsLinks":"[\"platform/util/platformUtil.js\"]","serverScript":"request.setAttribute('contextPath',request.getContextPath());","itemId":"module"},"children":[{"configs":{"itemId":"windows"},"children":[{"configs":{"height":"550","layout":"form","width":"800","closeAction":"hide","resizable":"false","buttonAlign":"center","border":"false","itemId":"editWindow","dialog":"false","modal":"true","draggable":"false"},"events":{"tagEvents":"collapse:function(){\n\tapp.editWindow.setSize(600,300);\n}"},"children":[{"configs":{"border":"false","itemId":"form1"},"children":[{"configs":{"title":"{#fieldset1Title#}","layout":"form","margin":"0 10 0 10","itemId":"fieldset1"},"children":[{"configs":{"tagConfigs":"baseCls:'my-panel-no-border'","layout":"column","margin":"10 0 0 0","itemId":"panel1"},"children":[{"configs":{"tagConfigs":"columnWidth:0.45","labelWidth":"120","readOnly":"true","labelAlign":"right","itemId":"BG_ITEM_CODE","fieldLabel":"{#BG_ITEM_CODE_COL#}"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"120","hidden":"true","labelAlign":"right","itemId":"LEDGER_ID","fieldLabel":"账簿ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"tagConfigs":"columnWidth:0.45","labelWidth":"120","readOnly":"true","labelAlign":"right","itemId":"BG_ITEM_NAME","fieldLabel":"{#BG_ITEM_NAME_COL#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls:'my-panel-no-border'","layout":"column","margin":"10 0 10 0","border":"false","itemId":"panel2"},"children":[{"configs":{"tagConfigs":"columnWidth:0.9","labelWidth":"120","readOnly":"true","labelAlign":"right","itemId":"BG_ITEM_DESC","fieldLabel":"{#BG_ITEM_DESC_COL#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":false,"type":"fieldset"}],"expanded":true,"type":"form"},{"configs":{"border":"false","itemId":"form2"},"children":[{"configs":{"title":"{#fieldset2Title#}","layout":"form","margin":"0 10 0 10","itemId":"fieldset1"},"children":[{"configs":{"tagConfigs":"baseCls:'my-panel-no-border'","layout":"column","margin":"10 0 0 0","border":"false","itemId":"panel1"},"children":[{"configs":{"tagConfigs":"columnWidth:0.9","labelWidth":"120","queryMode":"local","displayField":"VAL_NAME","valueField":"VAL_CODE","labelAlign":"right","itemId":"BG_CTRL_DIM","fieldLabel":"<font color='red'>*<\/font>{#BG_CTRL_DIM_COL#}","editable":"false"},"children":[{"configs":{"pageSize":"-1","itemId":"store","autoLoad":"true","url":"m?xwl=xc/bg/base/bg-ld-items/bg-ld-itemsDB/selectCtrl_DIM"},"children":[],"expanded":false,"type":"store"}],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls:'my-panel-no-border'","layout":"column","margin":"10 0 0 0","border":"false","itemId":"panel11"},"children":[{"configs":{"tagConfigs":"columnWidth:0.9","labelWidth":"120","queryMode":"local","displayField":"VAL_NAME","valueField":"VAL_CODE","labelAlign":"right","itemId":"BG_CTRL_MODE","fieldLabel":"<font color='red'>*<\/font>{#BG_CTRL_MODE_COL#}","editable":"false"},"children":[{"configs":{"pageSize":"-1","itemId":"store","autoLoad":"true","url":"m?xwl=xc/bg/base/bg-ld-items/bg-ld-itemsDB/selectCTRL_MODE"},"children":[],"expanded":false,"type":"store"}],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"layout":"column","margin":"10 0 10 0","border":"false","itemId":"panel2"},"children":[{"configs":{"tagConfigs":"columnWidth:0.4","border":"false","itemId":"panel1"},"children":[],"expanded":false,"type":"panel"},{"configs":{"tagConfigs":"columnWidth:0.6","border":"false","itemId":"panel11"},"children":[{"configs":{"text":"{#saveBtn#}","width":"75","itemId":"saveBtn","iconCls":"save_icon"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#cancelBtn#}","width":"75","margin":"0 0 0 10","itemId":"cancelBtn","iconCls":"cancel_icon"},"events":{"click":"app.editWindow.hide();"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":false,"type":"fieldset"}],"expanded":true,"type":"form"},{"configs":{"border":"false","itemId":"form3"},"children":[{"configs":{"title":"{#fieldset3Title#}","height":"220","collapsible":"true","layout":"border","margin":"0 10 0 10","itemId":"fieldset1"},"children":[{"configs":{"region":"west","pagingBar":"false","barExportButtons":"false","barExportAllButtons":"false","width":"350","itemId":"grid_EX_ITEM"},"children":[{"configs":{"pageSize":"5","itemId":"store","url":"m?xwl=xc/bg/base/bg-ld-items/bg-ld-itemsDB/selectEX_ITEM"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#EX_ITEM_NAME_COL#}","width":"220","dataIndex":"EX_ITEM_NAME","titleAlign":"center","itemId":"EX_ITEM_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#EX_ITEM_CODE_COL#}","hidden":"true","dataIndex":"EX_ITEM_CODE","titleAlign":"center","itemId":"EX_ITEM_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"费用项目ID","hidden":"true","dataIndex":"EX_ITEM_ID","titleAlign":"center","itemId":"EX_ITEM_ID_COL"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"},{"configs":{"region":"east","pagingBar":"false","barExportButtons":"false","barExportAllButtons":"false","width":"430","itemId":"grid_ACC"},"children":[{"configs":{"pageSize":"5","itemId":"store","url":"m?xwl=xc/bg/base/bg-ld-items/bg-ld-itemsDB/selectACC"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#ACC_CODE_COL#}","width":"130","dataIndex":"ACC_CODE","titleAlign":"center","itemId":"ACC_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#ACC_NAME_COL#}","width":"230","dataIndex":"ACC_NAME","titleAlign":"center","itemId":"ACC_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"会计科目ID","hidden":"true","dataIndex":"ACC_ID","titleAlign":"center","itemId":"ACC_ID_COL"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":false,"type":"fieldset"}],"expanded":true,"type":"form"}],"expanded":true,"type":"window"},{"configs":{"height":"300","autoScroll":"false","layout":"fit","width":"800","closeAction":"hide","resizable":"false","buttonAlign":"center","border":"false","itemId":"syncWindow","dialog":"false","draggable":"false"},"events":{"show":"var v_ledger_id=app.ledgerCombo.value;\napp.grid2.store.load({params:{'LEDGER_ID':v_ledger_id}});","close":"app.grid1.getSelectionModel().deselectAll();"},"children":[{"configs":{"cls":"my_custom_grid","selType":"checkboxmodel","barPageButton":"false","barExportButtons":"false","barExportAllButtons":"false","itemId":"grid2"},"children":[{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#number#}","width":"50","xtype":"rownumberer","align":"center","titleAlign":"center","itemId":"number"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#LEDGER_NAME#}","width":"200","dataIndex":"LEDGER_NAME","titleAlign":"center","itemId":"LEDGER_NAME_COL","renderer":"metaData.style = 'overflow:auto;text-overflow: ellipsis;white-space: nowrap;white-space:normal;line-height:20px;';   \nreturn value;"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"账簿ID","hidden":"true","dataIndex":"LEDGER_ID","titleAlign":"center","itemId":"LEDGER_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#ACC_HRCY_NAME_COL#}","width":"200","dataIndex":"ACC_HRCY_NAME","titleAlign":"center","itemId":"ACC_HRCY_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#BG_HRCY_NAME_COL#}","width":"200","dataIndex":"BG_HRCY_NAME","titleAlign":"center","itemId":"BG_HRCY_NAME_COL"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"store","url":"m?xwl=xc/bg/base/bg-ld-items/bg-ld-itemsDB/selectLedgerSync"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"grid"},{"configs":{"itemId":"buttons"},"children":[{"configs":{"text":"{#okBtn#}","itemId":"okBtn","iconCls":"ok_icon"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#cancelBtn#}","itemId":"cancelBtn","iconCls":"cancel_icon"},"events":{"click":"app.syncWindow.hide();"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"array"}],"expanded":false,"type":"window"},{"configs":{"height":"400","layout":"border","width":"700","closeAction":"hide","resizable":"false","buttonAlign":"center","itemId":"addBgWindow","dialog":"true","draggable":"false"},"children":[{"configs":{"region":"center","multiSelect":"true","selType":"checkboxmodel","cls":"my_custom_grid","barPageButton":"false","barExportButtons":"false","barExportAllButtons":"false","itemId":"grid3"},"children":[{"configs":{"pageSize":"-1","itemId":"store","url":"m?xwl=xc/bg/base/bg-ld-items/bg-ld-itemsDB/selectBgItemAdd"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"序号","xtype":"rownumberer","width":"50","align":"center","titleAlign":"center","itemId":"number"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"预算项目ID","hidden":"true","dataIndex":"BG_ITEM_ID","titleAlign":"center","itemId":"BG_ITEM_ID_COL","renderer":"metaData.style = 'overflow:auto;text-overflow: ellipsis;white-space: nowrap;white-space:normal;line-height:20px;';   \nreturn value;"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#BG_ITEM_CODE_COL#}","width":"180","dataIndex":"BG_ITEM_CODE","titleAlign":"center","itemId":"BG_ITEM_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#BG_ITEM_NAME_COL#}","width":"260","dataIndex":"BG_ITEM_NAME","titleAlign":"center","itemId":"BG_ITEM_NAME_COL"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"emptyText":"{#BG_ITEM_NAME_EMPTY1#}","itemId":"selectText"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){//响应回车事件\n  app.selBtn1.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"},{"configs":{"text":"{#selBtn#}","itemId":"selBtn1","iconCls":"seek_icon"},"events":{"click":"var ledger = app.ledgerCombo.getValue();//账簿ID\nvar selText = app.selectText.getValue();//查询条件\napp.grid3.getStore().load({params:{'selText':selText}});//重新加载grid3的store\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#cancelsBtn#}","itemId":"cancelBtn","iconCls":"cancel_icon"},"events":{"click":"app.selectText.reset();"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"window"},{"configs":{"maximized":"true","title":"{#importDataWinTitle#}","height":"400","minimizable":"true","width":"750","layout":"border","dialog":"false","border":"false","itemId":"importDataWin","modal":"true","maximizable":"true","createInstance":"false"},"events":{"close":"app.selBtn.fireEvent('click');"},"children":[{"configs":{"region":"center","frame":"true","style":"border-width:0px","layout":"column","padding":"15 0 0 5","border":"false","itemId":"importForm"},"children":[{"configs":{"labelWidth":"80","allowBlank":"false","emptyText":"{#selectFileRec1#}","labelAlign":"left","itemId":"selectFile","fieldLabel":"<font color='red'>*<\/font>{#selectFileRec2#}"},"children":[],"expanded":false,"type":"file"},{"configs":{"text":"{#importFileButton#}","itemId":"importFile","iconCls":"ok_icon","x":"2"},"events":{"click":"if(!app.importForm.getForm().isValid()){\n  Wb.toast('{#importFileRec1#}');//请选择要上传的文件\n  return false;\n}\nvar fileType = app.selectFile.getValue();\nif(!Ext.String.endsWith(fileType,'.xls')){\n  Wb.toast('{#importFileRec2#}',function(){//请选择以xls结尾的Office Excel文档!\n    app.importForm.getForm().reset();\n  });\n}else{\n  //导入前，先清除错误数据\n  app.importLogGrid.getStore().removeAll();\n  var msgProcessBar = Ext.Msg.show({\n     title:'{#importFileRec3#}',//提示\n     msg  :'{#importFileRec4#}',//导入中，请稍后.....\n     wait :true,\n     width:200\n  });\n  //将Office Excel数据导入到余额临时表中\n  app.importForm.getForm().submit({\n    url:'{#contextPath#}/bgItemsBatchModifyAction.do?method=importModifiedBgItems&importType=BG02&ledgerId='+app.ledgerCombo.getValue(),\n    timeout:3600*1000,\n    success:function(form,action){\n      msgProcessBar.hide();\n      Wb.toast(action.result.msg,function(){\n        app.importDataWin.close();\n      });\n    },\n    failure:function(form,action){\n      msgProcessBar.hide();\n      var _flag = action.result.flag;\n      //flag =0,导入时发生异常，输出异常信息\n      if(_flag == '0'){\n        Wb.toast(action.result.msg);\n      }else if(_flag == '2'){\n       //flag =2,数据导入临时表成功，数据校验发生异常\n        var _sessionId = action.result.msg;\n        Wb.toast('{#importFileRec5#}');//导入数据不合法\n        app.importLogGrid.getStore().load({params:{'sessionId':_sessionId}});\n      }\n    }   \n  });\n}"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"form"},{"configs":{"region":"south","height":"'88%'","itemId":"southTab"},"children":[{"configs":{"title":"{#importLogGridTitle#}","selType":"checkboxmodel","itemId":"importLogGrid"},"children":[{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#ROW_NUM#}","width":"70","dataIndex":"ROW_NUM","itemId":"ROW_NUM","renderer":"return '<font color=\"red\">'+value+'<\/font>';"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#BG_ITEM_NAME_COL#}","width":"200","dataIndex":"BG_ITEM_NAME","itemId":"BG_ITEM_NAME_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#BG_CTRL_DIM_COL#}","width":"200","dataIndex":"BG_CTRL_DIM","itemId":"BG_CTRL_DIM","renderer":"if(value === '1'){\n  return '预算项目';\n}else if(value === '2'){\n   return '预算项目+成本中心';\n}else{\n  return '';\n}"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#BG_CTRL_MODE_COL#}","width":"200","dataIndex":"BG_CTRL_MODE","itemId":"BG_CTRL_MODE","renderer":"if(value === '1'){\n  return '不控制';\n}else if(value === '2'){\n   return '预警控制';\n}else if(value === '3'){\n  return '绝对控制';\n}else{\n  return '';\n}"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#IS_ENABLED_COL#}","width":"100","dataIndex":"IS_ENABLED","itemId":"IS_ENABLED","renderer":"if(value === 'N'){\n  return '否';\n}else{\n   return '是';\n}"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#E_MSG#}","width":"300","dataIndex":"ERROR_MSG","itemId":"E_MSG","renderer":"metaData.style = 'overflow:auto;padding: 3px 6px;text-overflow: ellipsis;white-space: nowrap;white-space:normal;line-height:15px;';   \nreturn '<font color=\"red\">'+value+'<\/font>';","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"pageSize":"-1","autoLoad":"true","itemId":"store","url":"m?xwl=xc/bg/base/bg-ld-items/bg-ld-itemsDB/selectInvalidImportData"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"tab"}],"expanded":true,"type":"window"},{"configs":{"height":"225","width":"500","layout":"fit","closeAction":"hide","buttonAlign":"center","border":"false","dialog":"true","itemId":"batchEditWindow"},"events":{"ok":"/*批量修改\n *1、若无启用段，则不修改\n *2、所有启用段的值不能为空\n */\nvar _modifyRows = app.grid1.getSelection();\nvar _modifyArray = [];\nvar _modifyDim = '00';\nvar _modifyWay = '00';\nvar _modifyEnable = '00';\nif(app.controlDimLock.getValue()) {\n  _modifyDim = app.controlDim.getValue();\n  if(Ext.isEmpty(_modifyDim))\n    _modifyDim = '';\n}\nif(app.controlWayLock.getValue()){\n  _modifyWay = app.controlWay.getValue();\n  if(Ext.isEmpty(_modifyWay))\n    _modifyWay = '';\n}\nif(app.controlEnableLock.getValue())\n  _modifyEnable = app.controlEnable.getValue();\nif(_modifyDim !== '00' || _modifyWay !== '00' || _modifyEnable !== '00'){\n  Ext.each(_modifyRows,function(item){\n  var unitJson = {\n      'BG_LD_ITEM_ID':'',\n      'BG_CTRL_DIM'  :'00',\n      'BG_CTRL_MODE' :'00',\n      'IS_ENABLED'   :'00'\n  };\n  unitJson.BG_LD_ITEM_ID = item.data.BG_LD_ITEM_ID;\n  unitJson.BG_CTRL_DIM = _modifyDim;\n  unitJson.BG_CTRL_MODE = _modifyWay;\n  unitJson.IS_ENABLED = _modifyEnable;\n  _modifyArray.push(unitJson);\n});\n}\nif(_modifyArray.length === 0){\n  Wb.toast('请选择要改的内容！');\n}else{\n  //修改预算项目的设置的内容\n  Wb.request({\n    url:'m?xwl=xc/bg/base/bg-ld-items/bg-ld-itemsDB/updateBatchSetter',\n    params:{'paramArray':Wb.encode(_modifyArray)},\n    success:function(response,opts){\n      Wb.toast('保存成功!');\n      app.batchEditWindow.close();\n    },\n    failure:function(response,opts){\n       Wb.toast('保存失败!');\n    }\n  });\n}","close":"app.selBtn.fireEvent('click');"},"children":[{"configs":{"itemId":"batchEditForm","y":"0","x":"0"},"children":[{"configs":{"tagConfigs":"baseCls:'my-panel-no-border'","layout":"column","margin":"10 0 0 0","itemId":"tr1","border":"false"},"children":[{"configs":{"tagConfigs":"columnWidth : 0.02","itemId":"spaceLabel"},"children":[],"expanded":false,"type":"label"},{"configs":{"tagConfigs":"columnWidth : 0.45","text":"{#updateEnableLock#}","height":"22","itemId":"updateEnableLock"},"children":[],"expanded":false,"type":"label"},{"configs":{"tagConfigs":"columnWidth : 0.5","text":"{#updateContent#}","width":"80","itemId":"updateContent","y":"0"},"children":[],"expanded":false,"type":"label"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls:'my-panel-no-border'","layout":"column","margin":"10 0 0 0","itemId":"tr2","border":"false"},"children":[{"configs":{"tagConfigs":"columnWidth : 0.1","labelWidth":"80","labelAlign":"right","padding":"0 10 0 20","itemId":"controlDimLock"},"events":{"change":"if(newValue){\n  app.controlDim.setReadOnly(false);\n  app.controlDim.setFieldLabel('<font color=\\'#FF0000\\'>*<\/font>控制维度');\n}else{\n  app.controlDim.setReadOnly(true);\n  app.controlDim.clearValue();\n  app.controlDim.setFieldLabel('控制维度');\n}"},"children":[],"expanded":false,"type":"check"},{"configs":{"tagConfigs":"columnWidth : 0.85","labelWidth":"80","height":"22","readOnly":"true","pickList":"[['1','预算项目'],['2','预算项目+成本中心']]","labelAlign":"right","itemId":"controlDim","fieldLabel":"{#BG_CTRL_DIM_COL#}","editable":"false"},"children":[],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls:'my-panel-no-border'","layout":"column","margin":"10 0 0 0","itemId":"tr3","border":"false"},"children":[{"configs":{"tagConfigs":"columnWidth : 0.1","labelWidth":"80","labelAlign":"right","padding":"0 10 0 20","itemId":"controlWayLock"},"events":{"change":"if(newValue){\n  app.controlWay.setReadOnly(false);\n  app.controlWay.setFieldLabel('<font color=\\'#FF0000\\'>*<\/font>控制方式');\n}else{\n  app.controlWay.setReadOnly(true);\n  app.controlWay.setFieldLabel('控制方式');\n  app.controlWay.clearValue();\n}"},"children":[],"expanded":false,"type":"check"},{"configs":{"tagConfigs":"columnWidth : 0.85","labelWidth":"80","height":"22","readOnly":"true","pickList":"[['1','不控制'],['2','预警控制'],['3','绝对控制']]","labelAlign":"right","itemId":"controlWay","fieldLabel":"{#BG_CTRL_MODE_COL#}","editable":"false"},"children":[],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls:'my-panel-no-border'","layout":"column","margin":"10 0 0 0","itemId":"tr4","border":"false"},"children":[{"configs":{"tagConfigs":"columnWidth : 0.1","labelWidth":"80","labelAlign":"right","padding":"0 10 0 20","itemId":"controlEnableLock"},"events":{"change":"if(newValue){\n  app.controlEnable.setReadOnly(false);\n  app.controlEnable.setValue('Y');  \n  app.controlEnable.setFieldLabel('<font color=\\'#FF0000\\'>*<\/font>是否启用');\n}else{\n  app.controlEnable.setReadOnly(true);\n  app.controlEnable.clearValue();\n   app.controlEnable.setFieldLabel('是否启用');\n}"},"children":[],"expanded":false,"type":"check"},{"configs":{"tagConfigs":"columnWidth : 0.85","labelWidth":"80","height":"22","readOnly":"true","pickList":"[['Y','启用'],['N','禁用']]","labelAlign":"right","itemId":"controlEnable","fieldLabel":"{#IS_ENABLED_COL#}","editable":"false"},"children":[],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"form"}],"expanded":true,"type":"window"}],"expanded":true,"type":"folder"},{"configs":{"layout":"border","border":"false","itemId":"viewport1"},"children":[{"configs":{"region":"north","layout":"form","border":"false","itemId":"form1"},"children":[{"configs":{"tagConfigs":"baseCls:'my-panel-no-border'","layout":"column","margin":"10 0 10 15","border":"false","itemId":"panel1"},"children":[{"configs":{"tagConfigs":"columnWidth:0.3","labelWidth":"40","displayField":"LEDGER_NAME","valueField":"LEDGER_ID","labelAlign":"right","itemId":"ledgerCombo","fieldLabel":"{#LEDGER_NAME#}","editable":"false"},"events":{"change":"app.selBtn.fireEvent('click');"},"children":[{"configs":{"pageSize":"-1","itemId":"store","url":"m?xwl=xc/com-qry/gl-ledgers/select-sec-fd-ledgers"},"children":[],"expanded":false,"type":"store"}],"expanded":false,"type":"combo"},{"configs":{"tagConfigs":"columnWidth:0.3","labelWidth":"80","emptyText":"{#BG_ITEM_NAME_EMPTY#}","labelAlign":"right","itemId":"BG_ITEM_NAME","fieldLabel":"{#BG_ITEM_NAME#}"},"events":{"specialkey":"if(e.getKey()==13){\n  app.selBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"},{"configs":{"tagConfigs":"columnWidth:0.075","text":"{#selBtn#}","height":"22","margin":"0 0 0 10","itemId":"selBtn","iconCls":"seek_icon"},"events":{"click":"var v_ledger_id = app.ledgerCombo.value;\nvar v_bg_item_name = app.BG_ITEM_NAME.getValue();\napp.grid1.store.load({params:{'LEDGER_ID':v_ledger_id,'BG_ITEM_NAME':v_bg_item_name,'BG_ITEM_CODE':v_bg_item_name}});"},"children":[],"expanded":false,"type":"button"},{"configs":{"tagConfigs":"columnWidth:0.075","text":"{#resetBtn#}","height":"22","margin":"0 0 0 10","itemId":"resetBtn","iconCls":"refresh_icon"},"events":{"click":"app.form1.getForm().reset();"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"form"},{"configs":{"region":"center","cls":"my_custom_grid","selType":"checkboxmodel","itemId":"grid1","editable":"true"},"events":{"itemdblclick":"app.editBtn.fireEvent('click');"},"children":[{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"{#addBtn#}","itemId":"addBtn","iconCls":"file_add_icon"},"events":{"click":"var v_ledger_id = app.ledgerCombo.value;\nif(!v_ledger_id){\n  Wb.toast('{#addRec1#}');//请选择账簿！\n  return;\n}\nvar win = new Ext.window.Window(app._addBgWindow);\nwin.setTitle('{#addRec2#}');//添加\nwin.setIconCls('file_add_icon');\napp.grid3.store.load({params:{'LEDGER_ID':v_ledger_id}});\nwin.mon(win,'ok',function(){\n\tvar r = app.grid3.getSelection();\n  \tif(r.length===0){\n    \tWb.toast('{#addRec3#}');//请选择需要添加的预算项目\n      return;\n    }\n  Wb.request({\n\turl:'m?xwl=xc/bg/base/bg-ld-items/bg-ld-itemsDB/insert',//添加\n    async:false,\n  \tparams:{'LEDGER_ID':v_ledger_id,'infoArray':Wb.encode(Wb.getData(r))},\n  \tsuccess:function(resp){\n      Wb.toast('{#addRec2#}'+r.length+'{#addRec4#}');//添加了'+r.length+'条预算项目\n      Wb.remove(app.grid3);\n      app.grid1.store.load({params:{'LEDGER_ID':v_ledger_id}});\n    },\n    failure:function(){\n    \tWb.toast('{#addRec5#}');//添加失败\n    }\n});\n});\n\nwin.show();"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#editBtn#}","itemId":"editBtn","iconCls":"file_edit_icon"},"events":{"click":"var rec = app.grid1.getSelection()[0];\nvar v_ledger_id = app.ledgerCombo.value;\nif(!rec){\n  Wb.toast('{#editRec1#}');//请选择一行数据\n  return;\n}\nvar win = new Ext.window.Window(app._editWindow);\nwin.setTitle('{#editRec2#}');//编辑\nwin.setIconCls('file_edit_icon');\nWb.setValue(win,rec.data);\napp.LEDGER_ID.setValue(v_ledger_id);\napp.grid_EX_ITEM.store.load({params:{'LEDGER_ID':v_ledger_id,'BG_ITEM_ID':rec.get('BG_ITEM_ID')}});//加载费用项目store\napp.grid_ACC.store.load({params:{'LEDGER_ID':v_ledger_id,'BG_ITEM_ID':rec.get('BG_ITEM_ID')}});//加载会计项目store\nwin.show();\nwin.mon(app.saveBtn,'click',function(){\n\tvar values = Wb.applyIf(Wb.getValue(win),Wb.getData(rec,true));\n  if(app.BG_CTRL_DIM.getValue()==''||app.BG_CTRL_MODE.getValue()==''){\n    Wb.toast('{#editRec3#}');//控制维度或控制方式不能为空\n    return;\n  }\n  Wb.request({\n  url:'m?xwl=xc/bg/base/bg-ld-items/bg-ld-itemsDB/update',//更新\n  params:values,\n  success:function(resp){\n  \tWb.toast('{#editRec4#}');//保存成功\n    win.hide();\n    app.grid1.store.load({params:{'LEDGER_ID':v_ledger_id}});\n  }\n  });\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#delBtn#}","itemId":"delBtn","iconCls":"file_delete_icon"},"events":{"click":"var r = app.grid1.getSelection();\nvar v_ledger_id = app.ledgerCombo.value;\nif(r.length === 0){\n  Wb.toast('{#deleteRec1#}');//请选择要删除的记录\n  return;\n}\nvar ids = '';\nWb.each(Wb.getData(r),function(rec){\n  ids +='\\''+rec.BG_ITEM_ID+'\\',';\n});\nids = ids.substring(0,ids.length-1);\nWb.confirm('{#deleteRec2#}'+r.length+'{#deleteRec3#}',function(){//确定删除'+r.length+'条记录？\n\tWb.request({\n      url:'{#contextPath#}/bgValidationAction.do?method=checkBgItemBeforeDelete',\n      params:{'bgItemIds':ids,'ledgerId':v_ledger_id},\n      success:function(response){\n        var returnObj = Wb.decode(response.responseText);\n        if(returnObj.flag === '0'){\n          Wb.toast(returnObj.msg);\n          Wb.remove(app.grid1);\n        }else{\n          Wb.toast(returnObj.msg);\n          app.grid1.store.load({params:{'LEDGER_ID':v_ledger_id}});\n        }\n      }\n  });\n});\n\n "},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#blockBtn#}","itemId":"blockBtn","iconCls":"stop_icon"},"events":{"click":"var r= app.grid1.getSelection();\nvar v_ledger_id = app.ledgerCombo.value;\nvar v_status = app.blockBtn.text;\nif(r.length===0){\n  Wb.toast('{#blockRec1#}');//请选择要停用的预算项目\n  return;\n}\nWb.request({\n\turl:'m?xwl=xc/bg/base/bg-ld-items/bg-ld-itemsDB/updateIs_Enable',//更新状态\n  \tparams:{'infoArray':Wb.encode(Wb.getData(r)),'status':v_status,'LEDGER_ID':v_ledger_id},\n  \tsuccess:function(resp){\n      //Wb.toast('停用了'+r.length+'个预算项目');\n      app.grid1.store.load({params:{'LEDGER_ID':v_ledger_id}});\n    },\n  \tfailure:function(){\n      Wb.toast('{#blockRec2#}');//停用失败\n}\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#openBtn#}","itemId":"openBtn","iconCls":"run_icon"},"events":{"click":"var r= app.grid1.getSelection();\nvar v_ledger_id = app.ledgerCombo.value;\nvar v_status = app.openBtn.text;\nif(r.length===0){\n  Wb.toast('{#openRec1#}');//请选择要启用的预算项目\n  return;\n}\nWb.request({\n\turl:'m?xwl=xc/bg/base/bg-ld-items/bg-ld-itemsDB/updateIs_Enable',//更新状态\n  \tparams:{'infoArray':Wb.encode(Wb.getData(r)),'status':v_status,'LEDGER_ID':v_ledger_id},\n  \tsuccess:function(resp){\n      //Wb.toast('启用了'+r.length+'个预算项目');\n      app.grid1.store.load({params:{'LEDGER_ID':v_ledger_id}});\n    },\n  \tfailure:function(){\n      Wb.toast('{#openRec2#}');//启用失败\n}\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#syncBtn#}","itemId":"syncBtn","iconCls":"record_copy_icon"},"events":{"click":"var v_ledger_id = app.ledgerCombo.value;\n\nif(v_ledger_id==null||v_ledger_id==''){\n  Wb.toast('{#addRec1#}');//请选择账簿\n  return;\n}\nWb.request({\nurl:'m?xwl=xc/bg/base/bg-ld-items/bg-ld-itemsDB/selectByLedger_ID',\nparams:{'LEDGER_ID':v_ledger_id},\n  success:function(resp){\n   var record = Wb.decode(resp.responseText);\n   if(record.rows[0].c_no==0){\n     Wb.toast('{#syncRec1#}');//该账簿下没有预算,无法进行同步！\n     return;\n   }else{\napp.grid1.getSelectionModel().selectAll(0);\nvar win = new Ext.window.Window(app.syncWindow);\nwin.setTitle('{#syncRec2#}');//同步\nwin.show();\nvar rec=app.grid1.getSelection();\nwin.mon(app.okBtn,'click',function() {\n            var r = app.grid2.getSelection();\n            if (r.length === 0) {//没选择会警告\n                Wb.toast('{#syncRec3#}');//请选择需要同步的记录\n                return;\n            }\n     Wb.request({\n                url : 'm?xwl=xc/bg/base/bg-ld-items/bg-ld-itemsDB/insertSync', //同步\n                params : {'bgArray':Wb.getData(rec),'infoArray' : Wb.encode(Wb.getData(r))},\n                success: function(resp) {\n                    Wb.toast('{#syncRec4#}：\"'+r.length+'\"{#syncRec5#}');//同步成功：\"'+r.length+'\"个账簿\n                  \tWb.remove(app.grid2);\n                },\n                failure: function(response){\n                \t Wb.toast('{#syncRec6#}');//同步失败\n                }\n            });\n   \n});\n\n   }\n  }\n});\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#importBtn#}","itemId":"importBtn","iconCls":"file_xls_icon"},"events":{"click":"if(Ext.isEmpty(app.ledgerCombo.getValue())){\n  Wb.toast('{#addRec1#}');//请选择账簿！\n  return false;\n}\nvar win = new Ext.window.Window(app._importDataWin);\nwin.show();"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#exportBtn#}","itemId":"exportBtn","iconCls":"file_xls_icon"},"events":{"click":"if(Ext.isEmpty(app.ledgerCombo.getValue())){\n  var params = '&hasDataExport=N&exportModel=BG02';\n  window.location.href = '{#contextPath#}/bgItemsBatchModifyAction.do?method=exportItemsForExcel'+params;\n}else{\n  var _rows = app.grid1.getSelection();\n  if(_rows!== null && _rows.length>0){\n    //导出选中的数据\n    var _selArray = [];\n    Ext.each(_rows,function(item){\n      var _json = {\n       'bgItemId':'',\n       'bgHrcyId':'',\n       'bgItemCode':'',\n       'bgItemName':'',\n       'bgItemDesc':'',\n       'bgItemUpId':'',\n       'bgItemProp':'',\n       'bgItemType':'',\n       'startDate':'',\n       'endDate':'',\n       'bgLdItemId':'',\n       'ledgerId':'',\n       'bgCtrlDim':'',\n       'bgCtrlMode':'',\n       'isEnabled':''\n    };\n      _json.bgItemId = item.data.BG_ITEM_ID;\n      _json.bgItemCode = item.data.BG_ITEM_CODE;\n      _json.bgItemName = item.data.BG_ITEM_NAME;\n      _json.isEnabled = item.data.IS_ENABLED;\n      _json.bgCtrlDim = item.data.BG_CTRL_DIM;\n      _json.bgCtrlMode = item.data.BG_CTRL_MODE;\n      _selArray.push(_json);\n    });\n    //动态创建form并提交\n    var dynamicForm = document.createElement('form');\n    document.body.appendChild(dynamicForm);\n    var dyHashData = document.createElement('input');\n    dyHashData.type = \"text\";  \n    dyHashData.name = \"hasDataExport\";  \n    dyHashData.value = \"Y\";\n    dynamicForm.appendChild(dyHashData);\n    var dyExportModel = document.createElement('input');\n    dyExportModel.type = \"text\";  \n    dyExportModel.name = \"exportModel\";  \n    dyExportModel.value = \"BG02\";\n    dynamicForm.appendChild(dyExportModel);\n    var dyLedgerId = document.createElement('input');\n    dyLedgerId.type = \"text\";  \n    dyLedgerId.name = \"ledgerId\";  \n    dyLedgerId.value = app.ledgerCombo.getValue();\n    dynamicForm.appendChild(dyLedgerId);\n    var dyBgItemName = document.createElement('input');\n    dyBgItemName.type = \"text\";  \n    dyBgItemName.name = \"bgItemName\";  \n    dyBgItemName.value = app.BG_ITEM_NAME.getValue();\n    dynamicForm.appendChild(dyBgItemName);\n    var dyJsonData = document.createElement('input');\n    dyJsonData.type = \"text\";  \n    dyJsonData.name = \"jsonData\";  \n    dyJsonData.value = Wb.encode(_selArray);\n    dynamicForm.appendChild(dyJsonData);\n    dynamicForm.action = '{#contextPath#}/bgItemsBatchModifyAction.do?method=exportItemsForExcel';\n    dynamicForm.method = 'POST';\n    dynamicForm.submit();\n    document.body.removeChild(dynamicForm);  \n//     var params = '&hasDataExport=Y&exportModel=BG02&ledgerId='+app.ledgerCombo.getValue()+'&bgItemName='+app.BG_ITEM_NAME.getValue()+'&jsonData='+Wb.encode(_selArray);\n//     window.location.href = '{#contextPath#}/bgItemsBatchModifyAction.do?method=exportItemsForExcel'+params;\n  }else{\n    var params = '&hasDataExport=P&exportModel=BG02&ledgerId='+app.ledgerCombo.getValue()+'&bgItemName='+app.BG_ITEM_NAME.getValue();\n    window.location.href = '{#contextPath#}/bgItemsBatchModifyAction.do?method=exportItemsForExcel'+params;\n  }\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#batchModify#}","itemId":"batchModify","iconCls":"check_group_icon"},"events":{"click":"var _selectRows = app.grid1.getSelection();\nif (_selectRows.length === 0) {\n    Wb.toast('{#batchModifyRec1#}');//请选择要修改的记录！\n    return;\n}\nvar win = new Ext.window.Window(app._batchEditWindow);\nwin.setIconCls('check_group_icon');\nWb.setTitle(win,'{#batchModifyRec2#}');\nwin.show();\n\n\n"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#number#}","width":"50","align":"center","xtype":"rownumberer","titleAlign":"center","itemId":"number"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#BG_ITEM_CODE_COL#}","width":"180","dataIndex":"BG_ITEM_CODE","titleAlign":"center","itemId":"BG_ITEM_CODE_COL","renderer":"metaData.style = 'overflow:auto;text-overflow: ellipsis;white-space: nowrap;white-space:normal;line-height:20px;';   \nreturn value;"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#BG_ITEM_NAME_COL#}","width":"260","dataIndex":"BG_ITEM_NAME","titleAlign":"center","itemId":"BG_ITEM_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#BG_ITEM_DESC_COL#}","hidden":"true","dataIndex":"BG_ITEM_DESC","titleAlign":"center","itemId":"BG_ITEM_DESC_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#BG_ITEM_UP_NAME_COL#}","hidden":"true","dataIndex":"BG_ITEM_UP_NAME","titleAlign":"center","itemId":"BG_ITEM_UP_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#BG_CTRL_DIM_COL#}","width":"200","dataIndex":"BG_CTRL_DIM","titleAlign":"center","itemId":"BG_CTRL_DIM_COL","renderer":"if(value==1) return '预算项目';\nif(value==2) return '预算项目+成本中心';"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#BG_CTRL_MODE_COL#}","dataIndex":"BG_CTRL_MODE","titleAlign":"center","itemId":"BG_CTRL_MODE_COL","renderer":"if(value==1) return value='不控制';\nif(value==2) return value='预警控制';\nif(value==3) return value='绝对控制';"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#BG_ITEM_ID_COL#}","hidden":"true","dataIndex":"BG_ITEM_ID","itemId":"BG_ITEM_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#BG_LD_ITEM_ID_COL#}","hidden":"true","dataIndex":"BG_LD_ITEM_ID","itemId":"BG_LD_ITEM_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#IS_ENABLED_COL#}","dataIndex":"IS_ENABLED","titleAlign":"center","itemId":"IS_ENABLED_COL","renderer":"if(value=='Y') return '是';\nif(value=='N') return '否';"},"children":[],"expanded":true,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"store","autoLoad":"true","url":"m?xwl=xc/bg/base/bg-ld-items/bg-ld-itemsDB/selectBgLdItem"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}