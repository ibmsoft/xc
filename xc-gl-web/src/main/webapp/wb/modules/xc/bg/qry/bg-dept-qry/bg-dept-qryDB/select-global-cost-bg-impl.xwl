{"inframe":false,"title":"查询全局费用预算执行情况","hidden":false,"roles":{"default":1},"children":[{"configs":{"itemId":"module"},"children":[{"configs":{"oracle":"SELECT ba.LEDGER_ID,\n       ba.BG_ITEM_ID,\n       ba.BG_YEAR,\n       ba.BG_ITEM_NAME,\n       ba.BG_AMT,\n       nvl(tmp.OCCUPY_AMOUNT,0) OCCUPY_AMOUNT,\n       ROUND(nvl(tmp.OCCUPY_AMOUNT,0) / ba.BG_AMT * 100, 2) || '%' AS OCCUPY_RATE,\n       nvl(tmp.FACT_AMOUNT,0) FACT_AMOUNT,\n       ROUND(nvl(tmp.FACT_AMOUNT,0) / ba.BG_AMT * 100, 2) || '%' AS FACT_RATE,\n       (ba.BG_AMT - nvl(tmp.FACT_AMOUNT,0) - nvl(tmp.OCCUPY_AMOUNT,0)) AS REMAIN_AMOUNT,\n       (ROUND((ba.BG_AMT - nvl(tmp.FACT_AMOUNT,0) - nvl(tmp.OCCUPY_AMOUNT,0)) / ba.BG_AMT * 100,\n              2) || '%') AS REMAIN_RATE\n\n  FROM (SELECT al.LEDGER_ID,\n               al.BG_YEAR,\n               al.BG_ITEM_ID,\n               xbi.BG_ITEM_NAME,\n               SUM(al.BG_AMT) AS BG_AMT\n          FROM xc_bg_cost_bal al, xc_bg_items xbi\n         WHERE al.bg_item_id = xbi.bg_item_id\n           and al.LEDGER_ID = {?LEDGER_ID?}\n           AND al.BG_YEAR = {?BG_YEAR?}\n           and xbi.BG_ITEM_NAME LIKE '%{#BG_ITEM_NAME#}%'\n         GROUP BY al.LEDGER_ID, al.BG_YEAR, al.BG_ITEM_ID, xbi.BG_ITEM_NAME) ba\n         \n    LEFT JOIN (SELECT p.LEDGER_ID,\n                     CASE\n                       WHEN p.BG_ITEM_ID IS NULL THEN\n                        'A'\n                       ELSE\n                        p.BG_ITEM_ID\n                     END AS BG_ITEM_ID,\n                     p.BG_ITEM_NAME,\n                     p.BG_YEAR,\n                     SUM(p.OCCUPY_AMOUNT) AS OCCUPY_AMOUNT,\n                     SUM(p.FACT_AMOUNT) AS FACT_AMOUNT\n                FROM (SELECT t.LEDGER_ID,\n                             t.BG_ITEM_ID,\n                             SUBSTR(t.FACT_DATE, 0, 4) AS BG_YEAR,\n                             a.BG_ITEM_NAME,\n                             CASE t.FACT_TYPE\n                               WHEN '1' THEN\n                                t.AMOUNT\n                               ELSE\n                                0.00\n                             END AS OCCUPY_AMOUNT,\n                             CASE t.FACT_TYPE\n                               WHEN '2' THEN\n                                t.AMOUNT\n                               ELSE\n                                0.00\n                             END AS FACT_AMOUNT\n                        FROM xc_bg_fact t\n                        LEFT JOIN xc_bg_items a\n                          ON t.BG_ITEM_ID = a.BG_ITEM_ID\n                        LEFT JOIN xip_pub_depts d\n                          ON t.DEPT_ID = d.DEPT_ID\n                       WHERE t.LEDGER_ID = {?LEDGER_ID?}\n                         AND NVL(t.PROJECT_ID, '') = ''\n                         AND SUBSTR(t.FACT_DATE, 0, 4) = {?BG_YEAR?} ) p\n         GROUP BY p.LEDGER_ID, p.BG_ITEM_ID, p.BG_YEAR, p.BG_ITEM_NAME) tmp \n   ON tmp.LEDGER_ID = ba.LEDGER_ID\n   AND tmp.BG_YEAR = ba.BG_YEAR\n   AND tmp.BG_ITEM_ID = ba.BG_ITEM_ID\n","itemId":"sqlswitcher1","mysql":"SELECT ba.LEDGER_ID,\n       ba.BG_ITEM_ID,\n       ba.BG_YEAR,\n       ba.BG_ITEM_NAME,\n       ba.BG_AMT,\n       IFNULL(tmp.OCCUPY_AMOUNT,0) OCCUPY_AMOUNT,\n       CONCAT(ROUND(IFNULL(tmp.OCCUPY_AMOUNT,0) / ba.BG_AMT * 100, 2), '%') AS OCCUPY_RATE,\n       IFNULL(tmp.FACT_AMOUNT,0) FACT_AMOUNT,\n       CONCAT(ROUND(IFNULL(tmp.FACT_AMOUNT,0) / ba.BG_AMT * 100, 2), '%') AS FACT_RATE,\n       (ba.BG_AMT - IFNULL(tmp.OCCUPY_AMOUNT,0) - IFNULL(tmp.FACT_AMOUNT,0)) AS REMAIN_AMOUNT,\n       CONCAT(ROUND((ba.BG_AMT - IFNULL(tmp.OCCUPY_AMOUNT,0) - IFNULL(tmp.FACT_AMOUNT,0)) /\n                    ba.BG_AMT * 100,2),'%') AS REMAIN_RATE\n\n  FROM (SELECT al.LEDGER_ID,\n               al.BG_YEAR,\n               al.BG_ITEM_ID,\n               xbi.BG_ITEM_NAME, \n               SUM(al.BG_AMT) AS BG_AMT\n          FROM xc_bg_cost_bal al, xc_bg_items xbi\n         WHERE al.bg_item_id = xbi.bg_item_id\n           AND al.LEDGER_ID = {?LEDGER_ID?}\n           AND al.BG_YEAR = {?BG_YEAR?}\n           and xbi.BG_ITEM_NAME LIKE '%{#BG_ITEM_NAME#}%'\n         GROUP BY al.LEDGER_ID, al.BG_YEAR, al.BG_ITEM_ID) ba\n     LEFT JOIN (SELECT p.LEDGER_ID,\n               CASE\n                 WHEN p.BG_ITEM_ID IS NULL THEN\n                  'A'\n                 ELSE\n                  p.BG_ITEM_ID\n               END AS BG_ITEM_ID,\n               p.BG_ITEM_NAME,\n               p.BG_YEAR,\n               SUM(p.OCCUPY_AMOUNT) AS OCCUPY_AMOUNT,\n               SUM(p.FACT_AMOUNT) AS FACT_AMOUNT\n          FROM (SELECT t.LEDGER_ID,\n                       t.BG_ITEM_ID,\n                       SUBSTR(t.FACT_DATE FROM 1 FOR 4) AS BG_YEAR,\n                       a.BG_ITEM_NAME,\n                       CASE t.FACT_TYPE\n                         WHEN '1' THEN\n                          t.AMOUNT\n                         ELSE\n                          0.00\n                       END AS OCCUPY_AMOUNT,\n                       CASE t.FACT_TYPE\n                         WHEN '2' THEN\n                          t.AMOUNT\n                         ELSE\n                          0.00\n                       END AS FACT_AMOUNT\n                  FROM xc_bg_fact t\n                  LEFT JOIN xc_bg_items a\n                    ON t.BG_ITEM_ID = a.BG_ITEM_ID\n                  LEFT JOIN xip_pub_depts d\n                    ON t.DEPT_ID = d.DEPT_ID\n                 WHERE t.LEDGER_ID = {?LEDGER_ID?}\n                   AND SUBSTR(t.FACT_DATE FROM 1 FOR 4) = {?BG_YEAR?}\n                   AND IFNULL(t.PROJECT_ID, '') = '' ) p\n         GROUP BY p.LEDGER_ID, p.BG_ITEM_ID, p.BG_YEAR, p.BG_ITEM_NAME) tmp\n   ON tmp.LEDGER_ID = ba.LEDGER_ID\n   AND tmp.BG_YEAR = ba.BG_YEAR\n   AND tmp.BG_ITEM_ID = ba.BG_ITEM_ID\n"},"children":[],"expanded":false,"type":"sqlswitcher"},{"configs":{"sql":"{#sqlswitcher1#}","itemId":"dataprovider1"},"children":[],"expanded":false,"type":"dataprovider"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":"seek_icon"}