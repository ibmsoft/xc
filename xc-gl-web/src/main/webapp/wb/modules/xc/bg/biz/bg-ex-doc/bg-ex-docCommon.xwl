{"inframe":false,"title":"费用预算单录入","hidden":false,"roles":{"default":1},"children":[{"configs":{"loginRequired":"false","initScript":"var userId = request.getSession().getAttribute(\"XzSessionVars\").get('userId');\n\nvar protocol = request.getProtocol() ;\nvar ipAddr = request.getServerName();\nvar port = request.getServerPort() ;\nvar ctxPath = request.getContextPath() ;\n\nvar pp = protocol.substr(0,5) ;\nprotocol = (pp.indexOf(\"https\") == -1 ? \"http\" : \"https\") ;\nvar url = protocol + \"://\" + ipAddr +\":\" + port + ctxPath ;\n\nrequest.setAttribute('contextPath',ctxPath);\nrequest.setAttribute(\"userId\",userId);\nrequest.setAttribute(\"appIP\",url);\nvar appId = request.getSession().getAttribute(\"XzSessionVars\").get('appId');\nrequest.setAttribute(\"funId\",request.getParameter('funId'));\nrequest.setAttribute(\"appId\",request.getParameter('appId'));","serverScript":"//---------------------获取当前模块语言对应的.json文件，放到request中----------------\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xc/bg/biz/bg-ex-ver/json/bg-ex-doc\");","itemId":"module"},"events":{"initialize":"var buttonChange = '';\nvar bg_doc_id = '';\nvar bg_ver_id = '';\nvar flag = 'false';\n//定义窗口对象\nExt.apply(app,{\n    initWindow:function(params){\n        Ext.apply(app,params);\n        buttonChange = params.buttonChange;//按钮\n        app.bg_doc_window.setTitle(params.title);//窗口标题\n        if(buttonChange === 'insertButton'){\n            Wb.request({//得到UUID\n                url : 'm?xwl=xc/bg/qry/bg-doc-qry/bg-doc-qryDB/getUUID',\n                success : function(res){\n                    var temp = Ext.decode(res.responseText);\n                    bg_doc_id = temp.uuid;\n                    app.BG_DOC_ID.setValue(bg_doc_id);\n                }\n            });\n            app.BG_CAT_CODE.setValue('BG01');\n        }\n        if(buttonChange === 'editButton'){\n            bg_doc_id = params.bgDocId;//预算单类型\n            Wb.request({\n                url : 'm?xwl=xc/bg/biz/bg-ex-doc/bg-ex-docDB/selectBgDocById',\n                params : {BG_DOC_ID : bg_doc_id},\n                success : function(resp){\n                    var data = Wb.decode(resp.responseText).rows[0];\n                    Wb.setValue(app.bg_doc_form,data);\n                    var auditStatus = data.AUDIT_STATUS;\n                    bg_ver_id = data.BG_VER_ID;\n                    if(auditStatus === 'C'|| auditStatus === 'E'){\n                        app.bg_doc_window.setIconCls('seek_icon');//图标\n                        app.saveButton.setDisabled(true);\n                        app.submitButton.setDisabled(true);\n                        app.addButton.setDisabled(true);\n                        app.deleteButton.setDisabled(true);\n                        app.LEDGER_NAME.setReadOnly(true);\n                    }\n                    else{\n                        app.bg_doc_window.setIconCls('file_edit_icon');//图标\n                        app.LEDGER_NAME.setReadOnly(true);\n                    }\n                  }\n            });\n\t\t}\n        app.bg_doc_window.show();\n    }\n});\nfunction numberAdd(arg1,arg2){\n  var r1,r2,m;\n  try{\n    r1 = arg1.toString().split('.')[1].length ;\n  }catch(e){\n    r1 = 0 ;\n  }\n  try{\n    r2 = arg2.toString().split('.')[1].length ;      \n  }catch(e){\n    r2 = 0 ;\n  }\n  m = Math.pow(10,Math.max(r1,r2));\n    return (arg1 * m + arg2 * m) / m;\n}"},"children":[{"configs":{"itemId":"store"},"children":[{"configs":{"pageSize":"-1","itemId":"ledger_store","autoLoad":"true","url":"m?xwl=xc/com-qry/gl-ledgers/select-sec-fd-ledgers"},"events":{"success":"if(store.getCount() > 0 && buttonChange !== 'editButton'){\n    if(flag == 'false'){\n        app.LEDGER_NAME.setValue(store.getAt(0).get('LEDGER_ID'));\n        flag = 'true';\n    }\n}"},"children":[],"expanded":false,"type":"store"},{"configs":{"pageSize":"-1","itemId":"ver_id_store","autoLoad":"true","url":"m?xwl=xc/bg/biz/bg-ex-doc/bg-ex-docDB/bg-ex-verSelect"},"events":{"beforeload":"store.proxy.extraParams.LEDGER_ID = app.LEDGER_ID.getValue();"},"children":[],"expanded":false,"type":"store"},{"configs":{"pageSize":"-1","itemId":"items_store","url":"m?xwl=xc/bg/biz/bg-ex-doc/bg-ex-docDB/bg_itemsSelect"},"children":[],"expanded":false,"type":"store"},{"configs":{"pageSize":"-1","itemId":"dept_store","url":"m?xwl=xc/bg/biz/bg-ex-doc/bg-ex-docDB/feeBgDeptQuery"},"children":[],"expanded":false,"type":"store"},{"configs":{"pageSize":"-1","autoSync":"false","itemId":"period_store","url":"m?xwl=xc/bg/biz/bg-ex-doc/bg-ex-docDB/periodSelect"},"events":{"beforeload":"store.proxy.extraParams.LEDGER_ID = app.LEDGER_ID.getValue();\nstore.proxy.extraParams.PERIOD_CODE = app.BG_VER_PERIOD.getValue();"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"bg_doc_dtl_store","url":"m?xwl=xc/bg/qry/bg-doc-qry/bg-doc-qryDB/bg-doc-dtlSelect"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"folder"},{"configs":{"itemId":"editor"},"children":[{"configs":{"allowBlank":"false","triggerCls":"x-form-search-trigger","itemId":"item_editor"},"events":{"expand":"app.itemSearchButton.fireEvent('click');","blur":"var rec = app.bg_doc_dtl_grid.getSelection()[0];\nWb.request({\n    url : 'm?xwl=xc/bg/biz/bg-ex-doc/bg-ex-docDB/bg-ld-itemsSelect',//判断是否有会计科目数据\n    params : {BG_ITEM_ID : rec.data.BG_ITEM_ID,LEDGER_ID : app.LEDGER_ID.getValue()},//传参\n    success: function(resp){\n        var temp = Wb.decode(resp.responseText);\n        if(temp.total > 0){\n            var bg_ctrl_dim = temp.rows[0].BG_CTRL_DIM;\n            if(bg_ctrl_dim == '1' || bg_ctrl_dim === null || bg_ctrl_dim === ''){\n                rec.set('DEPT_ID','');\n                rec.set('DEPT_NAME','');\n                app.dept_editor.setReadOnly(true);\n                app.dept_editor.allowBlank = true;\n            }\n            if(bg_ctrl_dim == '2'){\n                app.dept_editor.setReadOnly(false);\n                app.dept_editor.allowBlank = false;\n            }\n        }\n    }\n});"},"children":[{"configs":{"tagConfigs":"minWidth : 480","height":"300","store":"app.items_store","barExportButtons":"false","barRefreshButton":"false","forceFit":"true","itemId":"pickComp"},"events":{"itemclick":"var picker = this.ownerCmp;\nvar rec = app.bg_doc_dtl_grid.getSelection()[0];\nrec.set('BG_ITEM_ID',record.data.BG_ITEM_ID);\npicker.setValue(record.data.BG_ITEM_NAME);\npicker.collapse();\napp.item_text.reset();"},"children":[{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"70","emptyText":"{#item_text#}","labelAlign":"right","itemId":"item_text"},"events":{"change":"if(text.getValue() === ''){\n    app.itemSearchButton.fireEvent('click');\n}","specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.itemSearchButton.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"},{"configs":{"width":"25","itemId":"itemSearchButton","iconCls":"seek_icon","tooltip":"{#queryButton#}"},"events":{"click":"app.items_store.load({params : {\n  LEDGER_ID :app.LEDGER_ID.getValue(),\n  NOWDATE : Ext.util.Format.date(new Date(),'Y-m-d'),\n  item_info : app.item_text.getValue()\n    }\n  });"},"children":[],"expanded":false,"type":"button"},{"configs":{"width":"25","itemId":"itemResetButton","iconCls":"cancel_icon","tooltip":"{#resetButton#}"},"events":{"click":"var rec = app.bg_doc_dtl_grid.getSelection()[0];\napp.item_editor.reset();\napp.item_editor.getPicker().hide();\napp.item_text.reset();\nrec.set('BG_ITEM_ID',null);\nrec.set('BG_ITEM_NAME',null);"},"children":[],"expanded":false,"type":"button"}],"expanded":false,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#ORDERBY#}","hidden":"true","align":"center","xtype":"rownumberer","width":"50","titleAlign":"center","itemId":"ORDERBY"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"ID","hidden":"true","dataIndex":"BG_ITEM_ID","itemId":"BG_ITEM_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#BG_ITEM_CODE_COL#}","width":"100","dataIndex":"BG_ITEM_CODE","titleAlign":"center","itemId":"BG_ITEM_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#BG_ITEM_NAME_COL#}","width":"240","dataIndex":"BG_ITEM_NAME","titleAlign":"center","itemId":"BG_ITEM_NAME_COL"},"children":[],"expanded":false,"type":"column"}],"expanded":false,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"},{"configs":{"readOnly":"true","triggerCls":"x-form-search-trigger","itemId":"dept_editor"},"events":{"expand":"app.deptSearchButton.fireEvent('click');","focus":"var rec = app.bg_doc_dtl_grid.getSelection()[0];\nif(rec.data.BG_ITEM_ID === '' || rec.data.BG_ITEM_ID === null){\n\tapp.dept_editor.setReadOnly(true);\n}else{\n    Wb.request({\n        url : 'm?xwl=xc/bg/biz/bg-ex-doc/bg-ex-docDB/bg-ld-itemsSelect',//判断是否有会计科目数据\n        params : {BG_ITEM_ID : rec.data.BG_ITEM_ID,LEDGER_ID : app.LEDGER_ID.getValue()},//传参\n        success: function(resp){\n            var temp = Wb.decode(resp.responseText);\n            if(temp.total > 0){\n                var bg_ctrl_dim = temp.rows[0].BG_CTRL_DIM;\n                if(bg_ctrl_dim == '1' || bg_ctrl_dim === null || bg_ctrl_dim === ''){\n                    app.dept_editor.setReadOnly(true);\n                    app.dept_editor.allowBlank = true;\n                }\n                if(bg_ctrl_dim == '2'){\n                    app.dept_editor.setReadOnly(false);\n                    app.dept_editor.allowBlank = false;\n                }\n            }\n        }\n    });\n}"},"children":[{"configs":{"tagConfigs":"minWidth : 480","height":"300","store":"app.dept_store","barExportButtons":"false","barRefreshButton":"false","forceFit":"true","itemId":"pickComp"},"events":{"itemclick":"var picker = this.ownerCmp;\nvar rec = app.bg_doc_dtl_grid.getSelection()[0];\nrec.set('DEPT_ID',record.data.DEPT_ID);\npicker.setValue(record.data.DEPT_NAME);\npicker.collapse();\napp.dept_text.reset();"},"children":[{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"70","emptyText":"{#item_text#}","labelAlign":"right","itemId":"dept_text"},"events":{"change":"if(text.getValue() === ''){\n    app.deptSearchButton.fireEvent('click');\n}","specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.deptSearchButton.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"},{"configs":{"width":"25","itemId":"deptSearchButton","iconCls":"seek_icon","tooltip":"{#queryButton#}"},"events":{"click":"app.dept_store.load({params : {\n   LEDGER_ID : app.LEDGER_ID.getValue(),\n   dept_info : app.dept_text.getValue()\n  }\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"width":"25","itemId":"deptResetButton","iconCls":"cancel_icon","tooltip":"{#resetButton#}"},"events":{"click":"var rec = app.bg_doc_dtl_grid.getSelection()[0];\napp.dept_editor.reset();\napp.dept_editor.getPicker().hide();\napp.dept_text.reset();\nrec.set('DEPT_ID',null);\nrec.set('DEPT_NAME',null);"},"children":[],"expanded":false,"type":"button"}],"expanded":false,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#ORDERBY#}","hidden":"true","align":"center","xtype":"rownumberer","width":"50","titleAlign":"center","itemId":"ORDERBY"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"ID","hidden":"true","dataIndex":"DEPT_ID","itemId":"DEPT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#DEPT_CODE_COL#}","width":"100","dataIndex":"DEPT_CODE","titleAlign":"center","itemId":"DEPT_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#DEPT_NAME_COL#}","width":"240","dataIndex":"DEPT_NAME","titleAlign":"center","itemId":"DEPT_NAME_COL"},"children":[],"expanded":false,"type":"column"}],"expanded":false,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":true,"type":"folder"},{"configs":{"maximized":"false","height":"500","width":"1000","layout":"border","resizable":"false","closeAction":"hide","itemId":"bg_doc_window","border":"false","defaultFocus":"LEDGER_ID","modal":"true","maximizable":"true"},"events":{"hide":"app.loadGridData();","show":"app.bg_doc_dtl_store.load({params : {BG_DOC_ID : bg_doc_id}});"},"children":[{"configs":{"region":"north","border":"false","itemId":"formPanel"},"children":[{"configs":{"text":"{#titleLabel#}","style":"fontSize:25px","margin":"20 0 10 0","labelAlign":"center","itemId":"titleLabel"},"children":[],"expanded":false,"type":"label"},{"configs":{"region":"center","tagConfigs":"baseCls : 'my-panel-no-border'","border":"false","itemId":"infoPanel"},"children":[{"configs":{"tagConfigs":"baseCls:'my-panel-no-border'","margin":"0 0 5 0","itemId":"buttonPanel","border":"false"},"children":[{"configs":{"height":"28","border":"false","itemId":"tbar"},"children":[{"configs":{"text":"{#saveButton#}","itemId":"saveButton","iconCls":"save_icon"},"events":{"click":"if(app.LEDGER_ID.getValue() === null){\n    Wb.toast('{#saveInfo1#}');\n    return;\n}\nif(!Wb.verify(app.bg_doc_form) || !Wb.verifyGrid(app.bg_doc_dtl_grid)){\n    Wb.toast('{#submitInfo1#}');//请填写所有必填项！\n    return;\n}\nif(buttonChange === 'insertButton'){\n    saveInsert();\n}\nelse if(buttonChange === 'editButton'){\n    saveEdit();\n}\nfunction saveInsert(){\n    Wb.request({\n        url: 'm?xwl=xc/bg/biz/bg-ex-doc/bg-ex-docDB/ruleCodeSelect',\n        params : {LEDGER_ID : app.LEDGER_ID.getValue(),BG_CAT_CODE : app.BG_CAT_CODE.getValue()},\n        success: function(respCode) {\n            var temp = Wb.decode(respCode.responseText);//从后台获取数据\n            if(temp.total > 0){\n                var ruleCode = temp.rows[0].RULE_CODE;\n                if(ruleCode !== null){\n                    Wb.request({\n                        url : '{#contextPath#}' +'/getDocCodeAction.do?method=getDocCode',//后台java代码生成\n                        method : 'POST',\n                        async : false,//异步传参\n                        params : {ledgerId : app.LEDGER_ID.getValue(),\n                                  ruleCode : ruleCode,\n                                  categoryId : '',\n                                  year : app.BG_VER_PERIOD.getValue(),\n                                  month : '',\n                                  userId : '{#XIP.userId#}'\n                                 },\n                        success : function(resp){\n                            var temp = Wb.decode(resp.responseText);//从后台获取数据\n                            if(temp !== null){\n                                app.BG_DOC_CODE.setValue(temp.bgDocCode);\n                                Wb.request({\n                                    url: 'm?xwl=xc/bg/qry/bg-doc-qry/bg-doc-qryDB/bg-docInsert',\n                                    out : app.bg_doc_form,\n                                    success: function(resp) {\n                                        saveDtl();\n                                        buttonChange = 'editButton';\n                                        app.LEDGER_NAME.setReadOnly(true);\n                                    }\n                                });\n                            }\n                        }\n                    });\n                }\n                else{\n                    Wb.toast('{#saveInfo2#}');\n                }\n\t\t\t}\n            else{\n                Wb.toast('{#saveInfo2#}');//该账簿级预算类型没有启用编码规则\n            }\n        }\n\t});\n}\nfunction saveEdit(){\n    Wb.request({\n        url: 'm?xwl=xc/bg/qry/bg-doc-qry/bg-doc-qryDB/bg-docEdit',\n        out : app.bg_doc_form,\n        success: function(resp) {\n            saveDtl();\n        }\n    });\n}\nfunction saveDtl(){\n    if(!Wb.verifyGrid(app.bg_doc_dtl_grid)){\n\t\treturn;\n    }\n    Wb.sync({\n        grid : app.bg_doc_dtl_grid,\n        url : 'm?xwl=xc/bg/qry/bg-doc-qry/bg-doc-qryDB/bg-doc-dtlUpdate',\n        message : '{#saveInfo3#}',//正在保存中...\n        success : function(resp) {\n            Wb.toast('{#saveInfo4#}');//数据保存成功！\n            app.bg_doc_dtl_grid.store.load({params : {BG_DOC_ID : app.BG_DOC_ID.getValue()}});\n        }\n    });\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#submitButton#}","itemId":"submitButton","iconCls":"check_icon"},"events":{"click":"if(!app.bg_doc_form.getForm().isValid()){\n    Wb.toast('{#submitInfo1#}');//请填写所有必填项！\n    return;\n}\nvar modify = app.bg_doc_dtl_grid.store.getModifiedRecords();\nWb.request({\n\turl : 'm?xwl=xc/bg/biz/bg-ex-doc/bg-ex-docDB/selectBgDocById',\n    params : {BG_DOC_ID : app.BG_DOC_ID.getValue()},\n    success : function(resp){\n        var temp = Wb.decode(resp.responseText);\n        if(temp.rows[0].COUNT == '0' || modify.length !== 0){\n            Wb.toast('{#submitInfo2#}');//请先保存数据！再提交\n            return;\n        }\n        else {\n            Wb.request({\n                url : 'm?xwl=xc/bg/qry/bg-doc-qry/bg-doc-qryDB/bg-doc-dtlIsExistSelect',\n                params : {BG_DOC_ID : app.BG_DOC_ID.getValue()},\n                success : function(resp){\n                    if(Wb.decode(resp.responseText).rows[0].COUNT === 0){\n                        Wb.toast('{#submitInfo3#}\"'+app.BG_DOC_CODE.getValue()+'\"{#submitInfo4#}');//预算单\"'+app.BG_DOC_CODE.getValue()+'\"没有预算单明细，不能提交\n                        return;\n                    }\n                    Wb.request({//账簿级流程\n                        url : 'm?xwl=xc/bg/qry/bg-doc-qry/bg-doc-qryDB/bg-ld-catSelectProcess',\n                        params : {LEDGER_ID : app.LEDGER_ID.getValue(),BG_CAT_CODE : app.BG_CAT_CODE.getValue(),BG_DOC_ID : app.BG_DOC_ID.getValue()},\n                        success : function(ldResp){\n                            var ldTemp = Wb.decode(ldResp.responseText);\n                            var processCODE = '';\n                            if(ldTemp.total === 0){\n                                Wb.request({//全局流程\n                                    url : 'm?xwl=xc/bg/qry/bg-doc-qry/bg-doc-qryDB/bg-catSelectProcess',\n                                    params : {BG_CAT_CODE : app.BG_CAT_CODE.getValue()},\n                                    success : function(catResp){\n                                        var catTemp = Wb.decode(catResp.responseText);\n                                        if(catTemp.total === 0){\n                                            Wb.toast('{#submitInfo5#}');//该预算单类型没有启用审批流程\n                                            return;\n                                        }\n                                        else{\n                                            processCODE = catTemp.rows[0].PROCESS_CODE;\n                                            submitProcess(processCODE);\n                                        }\n                                    }\n                                });\n                            }\n                            else{\n                                processCODE = ldTemp.rows[0].PROCESS_CODE;\n                                submitProcess(processCODE);\n                            }\n                        }\n                    });\n                }\n            });\n        }\n    }\n});\nfunction submitProcess(processCODE){//提交流程的方法\n    var auditStatus = app.AUDIT_STATUS.getValue();\n    var Todo_Title = app.BG_VER_PERIOD.getValue() + '年的' + app.BG_CAT_NAME.getValue()+'单';\n      //计算预算单金额\n    var totalMoney = 0.00;\n    var tmpStore = app.bg_doc_dtl_grid.getStore();\n    var ledgerObj = app.LEDGER_NAME.findRecord('LEDGER_ID',app.LEDGER_ID.getValue());\n    tmpStore.each(function(a){\n      totalMoney = numberAdd(totalMoney,a.data.AMOUNT);\n    });\n    Wb.request({//得到流程关联表单URL\n        url : 'm?xwl=xc/bg/qry/bg-doc-qry/bg-doc-qryDB/bgFormURLSelect',\n        params : {BG_CAT_CODE : app.BG_CAT_CODE.getValue()},\n        success : function(resp){\n            var PC_A_FORM = Wb.decode(resp.responseText).rows[0].FORM_URL;//电脑端审批表单\n            if(PC_A_FORM === null || PC_A_FORM === ''){\n                Wb.toast(app.BG_CAT_NAME.getValue()+'{#submitInfo6#}');//没有选择电脑端审批单据！\n                return;\n            }\n            else{\n                var json = {\n                    'APP_IP':'{#appIP#}',\n                    'loginName':'{#XIP.userName#}',\n                    'Todo_Title':Todo_Title,\n                    'PC_A_FORM':PC_A_FORM,\n                    'opType':app.BG_CAT_CODE.getValue(),\n                    'e_business_id':app.BG_DOC_ID.getValue(),\n                    'AMT'  : Ext.Number.toFixed(totalMoney,2),\n                    'ledgerId' : app.LEDGER_ID.getValue(),\n                    'ORG_ID':ledgerObj.data.ORG_ID\n                };\n                if(auditStatus === 'A'){//起草状态\n                    XipWf.startAndSubmitByProcess(processCODE,json,function(e){//提交流程\n                        if(e.flag === 0){\n                            app.INS_CODE.setValue(e.instanceCode);\n                            app.AUDIT_STATUS.setValue('C');\n                            app.submitButton.setDisabled(true);\n                            app.saveButton.setDisabled(true);\n                            app.addButton.setDisabled(true);\n                            app.deleteButton.setDisabled(true);\n                            Wb.toast('{#submitInfo7#}');//流程提交成功！\n                        }\n                        else if(e.flag === 1){\n                            Wb.toast(e.msg) ;\n                        }else{}\n                    });\n                }\n                else if(auditStatus === 'R' || auditStatus === 'D'){//撤回、驳回状态\n                    XipWf.submitInstance(app.INS_CODE.getValue(),json,function(e){//提交流程\n                        if(e.flag === 0){\n                            app.AUDIT_STATUS.setValue('C');\n                            app.submitButton.setDisabled(true);\n                            app.saveButton.setDisabled(true);\n                            app.addButton.setDisabled(true);\n                            app.deleteButton.setDisabled(true);\n                            Wb.toast('{#submitInfo7#}');\n                        }\n                        else if(e.flag === 1){\n                            Wb.toast(e.msg) ;\n                        }else{}\n                    });\n                }\n                else if(auditStatus === 'E' || auditStatus === 'C'){//运行中、结束状态\n                    Wb.toast('{#submitInfo8#}');//流程已提交,请重新选择！\n                    return false;\n                }\n                else{\n                    Wb.toast('{#submitInfo9#}');//流程信息不正确\n                    return false;\n                }\n            }\n        }\n    });\n}"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"}],"expanded":false,"type":"panel"},{"configs":{"region":"center","itemId":"bg_doc_form"},"children":[{"configs":{"tagConfigs":"baseCls:'my-panel-no-border'","itemId":"rowHide","border":"false"},"children":[{"configs":{"tagConfigs":"columnWidth : 0.3","labelWidth":"80","allowBlank":"false","hidden":"true","labelAlign":"right","itemId":"LEDGER_ID","fieldLabel":"<font color='red'>*<\/font>账簿","editable":"false"},"events":{"change":"var ledger_id = app.LEDGER_ID.getValue();\nWb.request({\n    url : 'm?xwl=xc/bg/biz/bg-ex-doc/bg-ex-docDB/orgsSelect',//判断是否有会计科目数据\n    params : {LEDGER_ID : ledger_id},//传参\n    success: function(resp){\n        var temp = Wb.decode(resp.responseText);\n        if(temp.total > 0){\n            app.ORG_ID.setValue(temp.rows[0].ORG_NAME);\n\t\t}\n        else{\n            app.ORG_ID.setValue('');\n        }\n    }\n});\napp.BG_VER_NAME.reset();\napp.BG_VER_PERIOD.reset();\napp.items_store.load({params : {LEDGER_ID :app.LEDGER_ID.getValue(),NOWDATE : Ext.util.Format.date(new Date(),'Y-m-d'),item_info : ''}});\napp.dept_store.load({params : {LEDGER_ID :app.LEDGER_ID.getValue(),dept_info : ''}});"},"children":[],"expanded":true,"type":"combo"},{"configs":{"tagConfigs":"columnWidth : 0.25","labelWidth":"80","allowBlank":"false","hidden":"true","labelAlign":"right","itemId":"BG_VER_ID","fieldLabel":"<font color='red'>*<\/font>预算版本","editable":"false"},"events":{"change":"Wb.request({\n    url : 'm?xwl=xc/bg/biz/bg-ex-doc/bg-ex-docDB/bg-ver-periodSelect',//预算年度查询\n    params : {BG_VER_ID : newValue},//传参\n    success: function(resp){\n        var temp = Wb.decode(resp.responseText);\n        if(temp.total > 0){\n            app.BG_VER_PERIOD.setValue(temp.rows[0].BG_VER_PERIOD);\n\t\t}\n        else{\n            app.BG_VER_PERIOD.setValue('');\n        }\n    }\n});\n"},"children":[],"expanded":true,"type":"combo"},{"configs":{"labelWidth":"80","hidden":"true","labelAlign":"right","itemId":"BG_DOC_NAME","fieldLabel":"预算单名称"},"children":[],"expanded":true,"type":"combo"},{"configs":{"labelWidth":"80","hidden":"true","labelAlign":"right","itemId":"BG_CAT_CODE","fieldLabel":"预算单类型"},"children":[],"expanded":true,"type":"combo"},{"configs":{"labelWidth":"80","hidden":"true","labelAlign":"right","itemId":"BG_CAT_NAME","fieldLabel":"预算单类型名称"},"children":[],"expanded":true,"type":"combo"},{"configs":{"labelWidth":"80","hidden":"true","labelAlign":"right","itemId":"BG_DOC_ID","fieldLabel":"预算单ID"},"children":[],"expanded":true,"type":"combo"},{"configs":{"labelWidth":"80","readOnly":"true","hidden":"true","labelAlign":"right","itemId":"INS_CODE","fieldLabel":"实例编码"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"80","readOnly":"true","hidden":"true","value":"A","labelAlign":"right","itemId":"AUDIT_STATUS","fieldLabel":"流程状态"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls:'my-panel-no-border'","layout":"column","margin":"10 0 0 0","itemId":"row2","border":"false"},"children":[{"configs":{"tagConfigs":"columnWidth : 0.3","labelWidth":"80","store":"app.ledger_store","allowBlank":"false","displayField":"LEDGER_NAME","valueField":"LEDGER_ID","labelAlign":"right","itemId":"LEDGER_NAME","fieldLabel":"<font color='red'>*<\/font>{#LEDGER_NAME#}","editable":"false"},"events":{"select":"app.bg_doc_dtl_grid.store.load({params : {BG_DOC_ID : app.BG_DOC_ID.getValue()}});","change":"if(combo.getDisplayValue() !== newValue){\n    app.LEDGER_ID.setValue(newValue);\n}"},"children":[],"expanded":true,"type":"combo"},{"configs":{"tagConfigs":"columnWidth : 0.4","labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"ORG_ID","fieldLabel":"{#ORG_ID#}","editable":"false"},"children":[],"expanded":true,"type":"combo"},{"configs":{"tagConfigs":"columnWidth : 0.25","labelWidth":"80","allowBlank":"false","store":"app.ver_id_store","displayField":"BG_VER_NAME","valueField":"BG_VER_ID","labelAlign":"right","itemId":"BG_VER_NAME","fieldLabel":"<font color='red'>*<\/font>{#BG_VER_NAME#}","editable":"false"},"events":{"change":"if(combo.getDisplayValue() !== newValue){\n    app.BG_VER_ID.setValue(newValue);\n}"},"children":[],"expanded":true,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls:'my-panel-no-border'","layout":"column","margin":"10 0 0 0","itemId":"row3","border":"false"},"children":[{"configs":{"tagConfigs":"columnWidth : 0.3","labelWidth":"80","readOnly":"true","height":"22","width":"220","emptyText":"{#Automatically#}","labelAlign":"right","itemId":"BG_DOC_CODE","fieldLabel":"{#BG_DOC_CODE#}"},"children":[],"expanded":false,"type":"text"},{"configs":{"tagConfigs":"columnWidth : 0.20","labelWidth":"80","height":"22","readOnly":"true","width":"200","labelAlign":"right","itemId":"BG_VER_PERIOD","fieldLabel":"{#BG_VER_PERIOD#}"},"events":{"change":"app.period_store.load({params : {LEDGER_ID :app.LEDGER_ID.getValue(),PERIOD_CODE :newValue}});"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls:'my-panel-no-border'","layout":"column","margin":"10 0 10 0","itemId":"row4","border":"false"},"children":[{"configs":{"tagConfigs":"columnWidth : 0.95","labelWidth":"80","height":"47","width":"656","labelAlign":"right","itemId":"BG_DOC_DESC","fieldLabel":"{#BG_DOC_DESC#}"},"children":[],"expanded":false,"type":"textarea"}],"expanded":true,"type":"panel"}],"expanded":false,"type":"form"}],"expanded":true,"type":"panel"}],"expanded":false,"type":"form"},{"configs":{"region":"center","selType":"checkboxmodel","store":"app.bg_doc_dtl_store","itemId":"bg_doc_dtl_grid","editable":"true"},"children":[{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"{#addButton#}","itemId":"addButton","iconCls":"file_add_icon"},"events":{"click":"if(!app.bg_doc_form.getForm().isValid()){\n    Wb.toast('{#submitInfo1#}');\n    return;\n}\nWb.addEdit(app.bg_doc_dtl_grid,[{BG_DOC_ID:app.BG_DOC_ID.getValue()}]);"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#deleteButton#}","itemId":"deleteButton","iconCls":"file_delete_icon"},"events":{"click":"var recs = app.bg_doc_dtl_grid.getSelection();//获得选中数据\nif (!recs.length) {//选中的数据条数\n\tWb.toast('{#deleteInfo1#}');//请选择需要删除的记录。\n\treturn;\n}\nWb.confirm('{#deleteInfo2#}' + recs.length + '{#deleteInfo3#}',function() {\n    Wb.request({\n        url : 'm?xwl=xc/bg/qry/bg-doc-qry/bg-doc-qryDB/bg-doc-dtlDelete',//判断是否有会计科目数据\n        params : {'deleteArray' : Wb.encode(Wb.getData(recs))},//传参\n        success: function(resp){\n            Wb.toast(recs.length+'{#deleteInfo4#}');\n            Wb.remove(app.bg_doc_dtl_grid);\n        }\n    });\n});"},"children":[],"expanded":false,"type":"button"}],"expanded":false,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#ORDERBY#}","width":"50","xtype":"rownumberer","align":"center","titleAlign":"center","itemId":"ORDERBY"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"预算单明细ID","hidden":"true","dataIndex":"BG_DTL_ID","titleAlign":"center","itemId":"BG_DTL_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"预算单ID","hidden":"true","dataIndex":"BG_DOC_ID","titleAlign":"center","itemId":"BG_DOC_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"预算项目ID","hidden":"true","width":"160","dataIndex":"BG_ITEM_ID","titleAlign":"center","itemId":"BG_ITEM_ID_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"editor":"app.item_editor","text":"{#BG_ITEM_NAME#}","width":"160","dataIndex":"BG_ITEM_NAME","titleAlign":"center","itemId":"BG_ITEM_NAME_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"项目ID","hidden":"true","width":"150","dataIndex":"PROJECT_ID","titleAlign":"center","itemId":"PROJECT_ID_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"成本中心","hidden":"true","width":"160","dataIndex":"DEPT_ID","titleAlign":"center","itemId":"DEPT_ID_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"editor":"app.dept_editor","text":"{#DEPT_NAME#}","width":"160","dataIndex":"DEPT_NAME","titleAlign":"center","itemId":"DEPT_NAME_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#PERIOD_CODE#}","width":"100","dataIndex":"PERIOD_CODE","titleAlign":"center","itemId":"PERIOD_CODE_COL"},"children":[{"configs":{"allowBlank":"false","store":"app.period_store","displayField":"PERIOD_CODE","valueField":"PERIOD_CODE","itemId":"editor","editable":"false"},"children":[],"expanded":false,"type":"combo"}],"expanded":false,"type":"column"},{"configs":{"text":"{#AMOUNT#}","align":"right","width":"100","dataIndex":"AMOUNT","format":"0,000.00","titleAlign":"center","itemId":"AMOUNT_COL"},"children":[{"configs":{"allowBlank":"false","itemId":"editor"},"children":[],"expanded":false,"type":"number"}],"expanded":false,"type":"column"},{"configs":{"text":"{#BG_DTL_DESC#}","width":"200","dataIndex":"BG_DTL_DESC","titleAlign":"center","itemId":"BG_DTL_DESC_COL"},"children":[{"configs":{"itemId":"editor"},"children":[],"expanded":false,"type":"text"}],"expanded":false,"type":"column"},{"configs":{"text":"创建日期","hidden":"true","dataIndex":"CREATION_DATE","titleAlign":"center","itemId":"CREATION_DATE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"创建人","hidden":"true","dataIndex":"CREATED_BY","titleAlign":"center","itemId":"CREATED_BY_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"最后更新日期","hidden":"true","dataIndex":"LAST_UPDATE_DATE","titleAlign":"center","itemId":"LAST_UPDATE_DATE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"最后更新人","hidden":"true","dataIndex":"LAST_UPDATED_BY","titleAlign":"center","itemId":"LAST_UPDATED_BY_COL"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"window"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":"window_icon"}