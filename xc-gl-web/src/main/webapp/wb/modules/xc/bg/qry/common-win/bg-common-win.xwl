{"inframe":false,"title":"","hidden":false,"roles":{"default":1},"children":[{"configs":{"loginRequired":"false","serverScript":"var globalDataSql = request.getParameter('dataSql');\nrequest.setAttribute('globalDataSql',globalDataSql);","itemId":"module"},"events":{"initialize":"function sumMoney(arg1,arg2){\n  var r1,r2,m;\n  try{\n    r1 = arg1.toString().split('.')[1].length ;\n  }catch(e){\n    r1 = 0 ;\n  }\n  try{\n    r2 = arg2.toString().split('.')[1].length ;      \n  }catch(e){\n    r2 = 0 ;\n  }\n  m = Math.pow(10,Math.max(r1,r2));\n    return (arg1 * m + arg2 * m) / m;\n}"},"children":[{"configs":{"maximized":"true","title":"预算占用单据信息","autoShow":"true","layout":"border","border":"false","itemId":"bgDetailWin","modal":"true"},"children":[{"configs":{"region":"center","tagConfigs":"features: [{\n  ftype: 'grouping',\n  groupHeaderTpl: [\n     '{name}<span style=\"float:right\"><font color=\"red\">小计：{children:this.sumData}<\/font><\/span>',\n  {\n  sumData:function(values){\n   var _sumAmount = 0;\n   //SUM_DIRECTION\n   for(var i=0;i<values.length;i++){\n     _sumAmount = sumMoney(_sumAmount,values[i].data.BILL_AMOUNT);\n   }\n   return Ext.util.Format.number(Ext.Number.toFixed(_sumAmount,2),'0,000.00');\n}\n}\n  ] \n}]\n","selType":"checkboxmodel","height":"'100%'","itemId":"budgetBillGrid","editable":"true"},"events":{"itemdblclick":"app.billDetail.fireEvent('click');"},"children":[{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"序号","align":"center","xtype":"rownumberer","width":"50","itemId":"rowNumber"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"主键","hidden":"true","dataIndex":"BILL_ID","itemId":"BILL_ID"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"BILL_CATEGORY","itemId":"BILL_CATEGORY"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"单据编码","dataIndex":"BILL_CODE","itemId":"BILL_CODE","renderer":"metaData.tdAttr = 'data-qtip=\"' + value + '\"';\nreturn value;","flex":"4"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"单据名称","dataIndex":"BILL_NAME","itemId":"BILL_NAME","renderer":"metaData.tdAttr = 'data-qtip=\"' + value + '\"';\nreturn value;","flex":"4"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"单据类型","dataIndex":"BILL_TYPE","itemId":"BILL_TYPE","flex":"3"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"单据金额","align":"left","xtype":"numbercolumn","dataIndex":"BILL_AMOUNT","titleAlign":"left","itemId":"BILL_AMOUNT","flex":"3"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"业务日期","dataIndex":"BILL_DATE","itemId":"BILL_DATE","flex":"3"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"成本中心","dataIndex":"DEPT_NAME","itemId":"BILL_DEPT","renderer":"if(Ext.isEmpty(value))\n  return '';\nelse\n  return value;","flex":"3"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"创建人","dataIndex":"BILL_CREATOR","itemId":"BILL_CREATOR","flex":"3"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"状态","dataIndex":"BILL_STATUS","itemId":"BILL_STATUS","renderer":"if(value == '3')\n    return '审核通过';\nelse if(value == '1')\n    return '草稿';\nelse\n    return value;","flex":"3"},"children":[],"expanded":true,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"groupField":"BILL_CATEGORY","pageSize":"-1","autoLoad":"true","itemId":"store","url":"m?xwl=xc/bg/qry/common-win/data/getCommonData"},"events":{"load":"var _totalAmount = 0.00;\nExt.each(records,function(item){\n  _totalAmount = sumMoney(_totalAmount,item.data.BILL_AMOUNT);\n});\n\napp.totalAmount.setText('<font style=\"color:red;font-weight:bold\">合计：'+Ext.util.Format.number(Ext.Number.toFixed(_totalAmount,2),'0,000.00')+'<\/font>',false);","beforeload":"store.getProxy().extraParams.WHERESQL = '{#globalDataSql#}';"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"-","itemId":"item1"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"单据明细查看","itemId":"billDetail","iconCls":"viewport_icon","tooltip":"双击查看单据明细信息"},"events":{"click":"// var billMap = new Ext.util.HashMap();\n// billMap.add('GL', 'm?xwl=xc/gl/journal/v-windows/view-voucher-win');\n// billMap.add('EX01', 'm?xwl=xc/ex/qry/ex-my-doc-qry/doc-wins/apply-doc-win/view-apply-doc');\n// billMap.add('EX03', 'm?xwl=xc/ex/qry/ex-my-doc-qry/doc-wins/tra-doc-win/view-tra-doc');\n// billMap.add('EX04', 'm?xwl=xc/ex/qry/ex-my-doc-qry/doc-wins/acc-doc-win/view-acc-doc');\n// billMap.add('CGJS', 'm?xwl=xc/ap/req/XC_AP_PAY_REQ_H_VIEW');\n// billMap.add('FKD_CGJS', '');\n// billMap.add('YUFK', 'm?xwl=xc/ap/req/XC_AP_PAY_REQ_H_VIEW');\n// billMap.add('CGFP', 'm?xwl=xc/ap/inv/XC_AP_INVOICE_H_VIEW');\n// billMap.add('CGFP-H', 'm?xwl=xc/ap/inv/XC_AP_INVOICE_H_VIEW');\nvar rows = app.budgetBillGrid.getSelectionModel().getSelection();\nif(rows === null || rows.length !== 1){\n  Wb.info('请选择一条单据记录！');\n}else{\n  var row = rows[0];\n  var _srcBillId = row.data.BILL_ID;\n  var _srcBillType = row.data.BILL_TYPE_CODE;\n  if('GL' === _srcBillType){\n    var _voucherType = row.data.TEMPLATE_TYPE;\n    //总账凭证\n      Wb.run({\n        url:'m?xwl=xc/gl/journal/v-windows/view-voucher-win',\n        newTab:true,\n        params:{'headId':_srcBillId,'optype':'view','vt':_voucherType}\n  });\n  }else if('EX01' === _srcBillType){\n    //费用申请单\n     Wb.open({\n       url:'m?xwl=xc/ex/qry/ex-my-doc-qry/doc-wins/apply-doc-win/view-apply-doc',\n       newTab:true,\n       params:{'exDocId':_srcBillId}\n  });\n  }else if('EX03' === _srcBillType){\n    //差旅报销单\n     Wb.open({\n       url:'m?xwl=xc/ex/qry/ex-my-doc-qry/doc-wins/apply-doc-win/view-apply-doc',\n       title:'查看差旅报销单',\n       newTab:true,\n       params:{'exDocId':_srcBillId}\n  });\n  }else if('EX04' === _srcBillType){\n    //费用报销单\n     Wb.open({\n       url:'m?xwl=xc/ex/qry/ex-my-doc-qry/doc-wins/acc-doc-win/view-acc-doc',\n       newTab:true,\n       params:{'exDocId':_srcBillId}\n  });\n  }else if('CGFP' === _srcBillType || 'CGFP-H' === _srcBillType){\n    //采购发票\n     Wb.open({\n       url:'m?xwl=xc/ap/inv/XC_AP_INVOICE_H_VIEW',\n       newTab:true,\n       params:{'businessId':_srcBillId}\n  });\n  }else if('YFD' === _srcBillType || _srcBillType === 'YFD-H'){\n      //应付单\n      Wb.run({\n        url: 'm?xwl=xc/ap/gl/XC_AP_INV_GL_H_NO_C', \n        success: function(app) {\n          app.initWin({\n              AP_INV_GL_H_ID:_srcBillId,\n              IS_INSERT:'S',\n              AP_DOC_CAT_CODE:_srcBillType\n          });\n        }\n      });\n  }else if('FKD_QTFK' === _srcBillType || _srcBillType === 'FKD_QTFK-H'){\n      //付款单\n      Wb.run({\n          url: 'm?xwl=xc/ap/pay/XC_AP_PAY_H_NO_C', \n          success: function(app) {\n            app.initWin({\n                AP_PAY_H_ID:_srcBillId,\n                IS_INSERT:'S',\n                AP_DOC_CAT_CODE:_srcBillType\n            });\n          }\n        });\n  }\n}\n\n\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item2"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"->","itemId":"item3"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"-","itemId":"item5"},"children":[],"expanded":false,"type":"item"},{"configs":{"itemId":"totalAmount"},"children":[],"expanded":true,"type":"label"},{"configs":{"text":"-","itemId":"item4"},"children":[],"expanded":false,"type":"item"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"window"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}