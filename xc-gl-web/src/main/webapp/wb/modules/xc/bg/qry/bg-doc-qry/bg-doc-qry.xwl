{"inframe":false,"title":"预算单查询","hidden":false,"roles":{"default":1},"children":[{"configs":{"initScript":"var userId = request.getSession().getAttribute(\"XzSessionVars\").get('userId');\n\nvar protocol = request.getProtocol() ;\nvar ipAddr = request.getServerName();\nvar port = request.getServerPort() ;\nvar ctxPath = request.getContextPath() ;\n\nvar pp = protocol.substr(0,5) ;\nprotocol = (pp.indexOf(\"https\") == -1 ? \"http\" : \"https\") ;\nvar url = protocol + \"://\" + ipAddr +\":\" + port + ctxPath ;\n\nrequest.setAttribute('contextPath',ctxPath);\nrequest.setAttribute(\"userId\",userId);\nrequest.setAttribute(\"appIP\",url);\nvar appId = request.getSession().getAttribute(\"XzSessionVars\").get('appId');\nrequest.setAttribute(\"funId\",request.getParameter('funId'));\nrequest.setAttribute(\"appId\",request.getParameter('appId'));","loginRequired":"false","jsLinks":"[\"xip/js/xipWf-debug.js\"]","serverScript":"com.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,'xc/bg/qry/bg-doc-qry/json/bg-doc-qry');\nvar budegetType = request.getParameter('budegetType');\nrequest.setAttribute('budegetType',budegetType);","itemId":"module"},"events":{"finalize":"var buttonChange = '';"},"children":[{"configs":{"itemId":"windows"},"children":[{"configs":{"title":"{#la_backWinTitle#}","height":"200","layout":"fit","width":"450","closeAction":"hide","dialog":"true","itemId":"cancelWin","modal":"true"},"events":{"show":"app.cancel_reason.reset();"},"children":[{"configs":{"layout":"fit","border":"false","itemId":"form1"},"children":[{"configs":{"itemId":"cancel_reason"},"children":[],"expanded":false,"type":"textarea"}],"expanded":true,"type":"form"},{"configs":{"itemId":"buttons"},"children":[{"configs":{"text":"{#la_backBtn#}","itemId":"confirmBackBtn","iconCls":"ok_icon"},"events":{"click":"var cr = app.cancel_reason.getValue() ;\nif(Wb.isEmpty(cr)){\n  return false ;\n}\n// 单据ID\nvar rec = app.bg_qry_grid.getSelection() ;\n// 提交请求\nWb.request({\n  url: '{#contextPath#}/bgValidationAction.do?method=cancelBudgetBal',\n  timeout : 3600000,\n  message : '{#la_backProcess#}',\n  params: {\n    'bgDocId'   : rec[0].data.BG_DOC_ID,\n    'cancelReason' : app.cancel_reason.getValue()\n  },\n  success: function(resp) {\n    app.cancelWin.hide() ;\n    var response = Wb.decode(resp.responseText) ;\n    if(response.flag === \"0\"){\n      app.searchButton.fireEvent('click') ;\n    }\n    Wb.toast(response.msg) ;\n  }\n});"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"array"}],"expanded":true,"type":"window"}],"expanded":true,"type":"folder"},{"configs":{"layout":"border","itemId":"viewport1"},"children":[{"configs":{"region":"north","itemId":"search_form"},"children":[{"configs":{"layout":"column","border":"false","itemId":"tr1"},"children":[{"configs":{"layout":"form","columnWidth":".25","border":"false","itemId":"td1"},"children":[{"configs":{"labelWidth":"80","displayField":"LEDGER_NAME","valueField":"LEDGER_ID","emptyText":"{#emptyText1#}","labelAlign":"right","itemId":"ledgers_com","fieldLabel":"{#ledger#}","editable":"false"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.searchButton.fireEvent('click');\n}"},"children":[{"configs":{"pageSize":"-1","itemId":"store","url":"m?xwl=xc/com-qry/gl-ledgers/select-sec-fd-ledgers"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"}],"expanded":false,"type":"panel"},{"configs":{"layout":"form","columnWidth":".25","border":"false","itemId":"td2"},"children":[{"configs":{"tagConfigs":"columnWidth : 0.2","labelWidth":"80","value":"FEE","labelAlign":"right","pickList":"[['FEE','{#fee#}'],['PROJECT','{#project#}']]","itemId":"bg_cat_com","fieldLabel":"{#bgCatType#}"},"events":{"select":"app.bg_cat_version.clearValue();\napp.bg_cat_project.clearValue();\nif(combo.getValue() === 'FEE'){\n  app.bg_cat_version.setReadOnly(false);\n  app.bg_cat_project.setReadOnly(true);\n}else{\n  app.bg_cat_version.setReadOnly(true);\n  app.bg_cat_project.setReadOnly(false);\n}"},"children":[],"expanded":false,"type":"combo"}],"expanded":false,"type":"panel"},{"configs":{"layout":"form","columnWidth":".25","border":"false","itemId":"td3"},"children":[{"configs":{"labelWidth":"80","displayField":"BUDGET_NAME","valueField":"BUDGET_ID","labelAlign":"right","itemId":"bg_cat_version","fieldLabel":"{#bgVersion#}","editable":"false"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.searchButton.fireEvent('click');\n}"},"children":[{"configs":{"pageSize":"-1","itemId":"store","url":"m?xwl=xc/bg/qry/bg-doc-qry/bg-doc-qryDB/bgVersionQuery"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"}],"expanded":false,"type":"panel"},{"configs":{"layout":"form","columnWidth":".10","border":"false","itemId":"td4"},"children":[{"configs":{"text":"{#query#}","width":"70","margin":"0 0 0 20","itemId":"searchButton","iconCls":"seek_icon"},"events":{"click":"if(Ext.isEmpty(app.ledgers_com.getValue())){\n  Wb.info('{#queryMsg1#}');\n}else{\n  var _bgCode = app.bg_cat_code.getValue();\n  if(Ext.isEmpty(_bgCode))\n    _bgCode = '';\n  var _bgDesc = app.bg_cat_desc.getValue();\n  if(Ext.isEmpty(_bgDesc))\n    _bgDesc = '';\n  var _bgType = app.bg_cat_com.getValue();\n  var _whereSql = ' 1=1 ';\n  var _budgetType = '{#budegetType#}';\n  if('FEE' === _bgType){\n      if(!Ext.isEmpty(app.bg_cat_version.getValue())){\n        _whereSql = ' bd.BG_VER_ID = \\''+app.bg_cat_version.getValue()+'\\'';\n      }\n      if(!Ext.isEmpty(_budgetType))\n        _whereSql = _whereSql +' AND bd.CREATED_BY = \\'{#XIP.userId#}\\'';\n      var params = {\n          LEDGER_ID : app.ledgers_com.getValue(),\n          BG_DOC_CODE : _bgCode,\n          BG_DOC_DESC : _bgDesc,\n          WHERESQL : _whereSql\n      };\n    app.bg_qry_grid.getStore().getProxy().url = 'm?xwl=xc/bg/qry/bg-doc-qry/bg-doc-qryDB/bgFeeQuery';\n    app.bg_qry_grid.down('#BG_VER_NAME_COL').show();\n    app.bg_qry_grid.down('#PROJECT_NAME_COL').hide();\n  }else{\n      if(!Ext.isEmpty(app.bg_cat_project.getValue())){\n        _whereSql = ' bd.PROJECT_ID = \\''+app.bg_cat_project.getValue()+'\\'';\n      }\n      if(!Ext.isEmpty(_budgetType))\n        _whereSql = _whereSql +' AND bd.CREATED_BY = \\'{#XIP.userId#}\\'';\n      var params = {\n          LEDGER_ID : app.ledgers_com.getValue(),\n          BG_DOC_CODE : _bgCode,\n          BG_DOC_DESC : _bgDesc,\n          WHERESQL : _whereSql\n      };\n    app.bg_qry_grid.getStore().getProxy().url = 'm?xwl=xc/bg/qry/bg-doc-qry/bg-doc-qryDB/bgProjectQuery';\n    app.bg_qry_grid.down('#BG_VER_NAME_COL').hide();\n    app.bg_qry_grid.down('#PROJECT_NAME_COL').show();\n  }\napp.bg_qry_grid.store.load({params : params});\n}"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"layout":"column","border":"false","itemId":"tr2"},"children":[{"configs":{"layout":"form","columnWidth":".25","border":"false","itemId":"td1"},"children":[{"configs":{"tagConfigs":"columnWidth : 0.2","labelWidth":"80","labelAlign":"right","itemId":"bg_cat_code","fieldLabel":"{#bgCode#}"},"events":{"change":"if(newValue === ''){\n    app.searchButton.fireEvent('click');\n}","specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.searchButton.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".25","border":"false","itemId":"td2"},"children":[{"configs":{"tagConfigs":"columnWidth : 0.2","labelWidth":"80","labelAlign":"right","itemId":"bg_cat_desc","fieldLabel":"{#bgDesc#}"},"events":{"change":"if(newValue === ''){\n    app.searchButton.fireEvent('click');\n}","specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.searchButton.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".25","border":"false","itemId":"td3"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","displayField":"PROJECT_NAME","valueField":"PROJECT_ID","labelAlign":"right","itemId":"bg_cat_project","fieldLabel":"{#pro#}","editable":"false"},"children":[{"configs":{"pageSize":"-1","itemId":"store","url":"m?xwl=xc/bg/qry/bg-doc-qry/bg-doc-qryDB/budgetProjectQuery"},"events":{"beforeload":"store.getProxy().extraParams.ledgerId = app.ledgers_com.getValue();"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".10","border":"false","itemId":"td4"},"children":[{"configs":{"text":"{#reset#}","width":"70","margin":"0 0 0 20","itemId":"resetButton","iconCls":"refresh_icon"},"events":{"click":"app.bg_cat_code.setValue('');\napp.bg_cat_desc.setValue('');\napp.bg_cat_version.clearValue();\napp.bg_cat_project.clearValue();\napp.bg_cat_com.setValue('FEE');\napp.searchButton.fireEvent('click');"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"form"},{"configs":{"region":"center","itemId":"bg_qry_grid"},"events":{"itemdblclick":"app.editButton.fireEvent('click');"},"children":[{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"{#add#}","itemId":"addButton","iconCls":"file_add_icon"},"events":{"click":"//调用公共窗口打开预算单录入界面\nvar ba_cat = app.bg_cat_com.getValue();\nvar ledger_id = app.ledgers_com.getValue();\n// var title = '';\n// if(ba_cat == 'BG01'){\n// \ttitle = '成本费用预算';\n// }\n// else if(ba_cat == 'BG02'){\n// \ttitle = '项目预算';\n// }\n// else if(ba_cat == 'BG03'){\n// \ttitle = '专项预算';\n// }\n// else if(ba_cat == 'BG04'){\n// \ttitle = '资金预算';\n// }\n// if(ledger_id === null){\n// \tWb.warn('请选择账簿！');\n//     return;\n// }\n// if(ba_cat === null){\n// \tWb.warn('请选择预算单类型！');\n//     return;\n// }\n// Wb.request({//得到UUID\n//     url : 'm?xwl=xc/bg/qry/bg-doc-qry/bg-doc-qryDB/getUUID',\n//     success : function(res){\n//         var temp = Ext.decode(res.responseText);\n//         var gb_doc_id = temp.uuid;//预算单ID\n//         Wb.run({\n//             url : 'm?xwl=xc/bg/biz/bg-ex-doc/bg-ex-docCommon',\n//             success : function(appObj){\n//                 appObj.initWindow({\n//                     loadGridData : function(){\n//                         app.searchButton.fireEvent('click') ;\n//                     },\n//                     title : '-新增'+app.bg_cat_com.getDisplayValue(),//窗口名称\n//                     labelTitle : app.bg_cat_com.getDisplayValue() + '单',//标题\n//                     ledgerId : ledger_id,\n//                     bgDocId : gb_doc_id,//预算单ID\n//                     bgCatCode : ba_cat,//预算单类型\n//                     auditStatus : 'A',//审批状态\n//                     buttonChange : 'insertButton'\n// \t\t\t\t});\n//             }\n//         });\n//     }\n// });"},"children":[{"configs":{"text":"{#addBg01#}","itemId":"addBG01Button","iconCls":"file_add_icon"},"events":{"click":"Wb.run({\n    url : 'm?xwl=xc/bg/biz/bg-ex-doc/bg-ex-docCommon',\n    success : function(appObj){\n        appObj.initWindow({\n            loadGridData : function(){\n                if(!Ext.isEmpty(app.ledgers_com.getValue())){\n                   app.searchButton.fireEvent('click') ;\n                }\n            },\n            submitProcess : function(){\n                app.submitButton.fireEvent('click') ;\n            },\n            title : '{#addBg01Msg1#}',//窗口名称\n            labelTitle : '{#addBg01#}',//标题\n            bgCatCode : 'BG01',//预算单类型\n            buttonChange : 'insertButton'\n        });\n    }\n});"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#addBg02#}","itemId":"addBG02Button","iconCls":"file_add_icon"},"events":{"click":"Wb.run({\n    url : 'm?xwl=xc/bg/biz/bg-prj-doc/bg-prj-docCommon',\n    success : function(appObj){\n        appObj.initWindow({\n            loadGridData : function(){\n               if(!Ext.isEmpty(app.ledgers_com.getValue())){\n                   app.searchButton.fireEvent('click') ;\n                }\n            },\n            title : '{#addBg02Msg1#}',//窗口名称\n            labelTitle : '{#addBg02#}',//标题\n            bgCatCode : 'BG02',//预算单类型\n            buttonChange : 'insertButton'\n        });\n    }\n});"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#addBg03#}","hidden":"true","itemId":"addBG03Button","iconCls":"file_add_icon"},"events":{"click":"Wb.run({\n    url : 'm?xwl=xc/bg/biz/bg-prj-doc/bg-spe-doc',\n    success : function(appObj){\n        appObj.initWindow({\n            loadGridData : function(){\n                app.searchButton.fireEvent('click') ;\n            },\n            title : '{#addBg03Msg1#}',//窗口名称\n            labelTitle : '{#addBg03#}',//标题\n            bgCatCode : 'BG03',//预算单类型\n            buttonChange : 'insertButton'\n        });\n    }\n});"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#addBg04#}","hidden":"true","itemId":"addBG04Button","iconCls":"file_add_icon"},"events":{"click":"Wb.run({\n    url : 'm?xwl=xc/bg/biz/bg-ex-doc/bg-ex-docCommon',\n    success : function(appObj){\n        appObj.initWindow({\n            loadGridData : function(){\n                app.searchButton.fireEvent('click') ;\n            },\n            title : '{#addBg04Msg1#}',//窗口名称\n            labelTitle : '{#addBg04#}',//标题\n            bgCatCode : 'BG04',//预算单类型\n            buttonChange : 'insertButton'\n        });\n    }\n});"},"children":[],"expanded":false,"type":"item"}],"expanded":true,"type":"button"},{"configs":{"text":"{#edit#}","itemId":"editButton","iconCls":"file_edit_icon"},"events":{"click":"var rec = app.bg_qry_grid.getSelection();//选择记录\n//调用公共窗口打开预算单录入界面\nvar ledger_id = app.ledgers_com.getValue();\nvar url = '';\nif(ledger_id === null){\n\tWb.toast('{#editMsg1#}');\n    return;\n}\nif (rec.length > 1 || rec.length === 0) {//大于一条或没选择会警告\n    Wb.toast('{#editMsg2#}');\n    return;\n}\nelse{\n    var r = rec[0].data;\n    var auditStatus = r.AUDIT_STATUS;//审批状态\n    var ba_cat = r.BG_CAT_CODE;\n    if(ba_cat == 'BG01'){\n        url = 'm?xwl=xc/bg/biz/bg-ex-doc/bg-ex-docCommon';\n    }\n    else if(ba_cat == 'BG02'){\n        url = 'm?xwl=xc/bg/biz/bg-prj-doc/bg-prj-docCommon';\n    }\n    else if(ba_cat == 'BG03'){\n        url = 'm?xwl=xc/bg/biz/bg-ex-doc/bg-ex-docCommon';\n    }\n    else if(ba_cat == 'BG04'){\n        url = 'm?xwl=xc/bg/biz/bg-ex-doc/bg-ex-docCommon';\n    }\n    if(ledger_id === null){\n        Wb.warn('{#queryMsg1#}');\n        return;\n    }\n    if(ba_cat === null){\n        Wb.warn('{#editMsg3#}');\n        return;\n    }\n    Wb.run({\n        url : url,\n        success : function(appObj){\n            appObj.initWindow({\n                loadGridData : function(){\n                    app.searchButton.fireEvent('click') ;\n                },\n                submitProcess : function(){\n                    app.submitButton.fireEvent('click') ;\n                },\n                title : (auditStatus == 'C' || auditStatus == 'E') ? ('{#seek#}'+r.BG_CAT_NAME) : ('{#modify#}'+r.BG_CAT_NAME),//窗口名称\n                bgDocId : r.BG_DOC_ID,//预算单ID\n                buttonChange : 'editButton'\n            });\n        }\n    });\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#delete#}","itemId":"deleteButton","iconCls":"file_delete_icon"},"events":{"click":"var recs = app.bg_qry_grid.getSelection();//获得选中数据\nvar ledger_id = app.ledgers_com.getValue();\nif(ledger_id === null){\n\tWb.toast('{#editMsg1#}');\n    return;\n}\nif (!recs.length) {//选中的数据条数\n\tWb.toast('{#deleteMsg1#}');\n\treturn;\n}\nWb.confirm('{#deleteMsg2#}\"' + recs[0].data.BG_DOC_CODE + '\"{#deleteMsg3#}',function() {\n    if(recs[0].data.AUDIT_STATUS === 'C'){\n\t\tWb.toast('{#deleteMsg4#}');\n        return;\n    }\n    if(recs[0].data.AUDIT_STATUS === 'E'){\n\t\tWb.toast('{#deleteMsg5#}');\n        return;\n    }\n    Wb.request({\n        url : 'm?xwl=xc/bg/qry/bg-doc-qry/bg-doc-qryDB/bg-docDelete',//判断是否有会计科目数据\n        params : {BG_DOC_ID : recs[0].data.BG_DOC_ID},//传参\n        success: function(resp){\n            Wb.toast('{#deleteMsg6#}\"'+recs[0].data.BG_DOC_CODE+'\"{#deleteMsg7#}');\n            Wb.remove(app.bg_qry_grid);//直接从表格中删除\n            app.searchButton.fireEvent('click');\n        }\n    });\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#submit#}","itemId":"submitButton","iconCls":"check_icon"},"events":{"click":"var rows = app.bg_qry_grid.getSelection();//获得选中数据\nvar ledger_id = app.ledgers_com.getValue();\nif(ledger_id === null){\n\tWb.toast('{#editMsg1#}');\n    return;\n}\nelse if (!rows.length) {//选中的数据条数\n\tWb.toast('{#submitMsg1#}');\n\treturn;\n}\nelse {\n    Wb.request({\n\t\turl : 'm?xwl=xc/bg/qry/bg-doc-qry/bg-doc-qryDB/bg-doc-dtlIsExistSelect',\n        params : {BG_DOC_ID : rows[0].data.BG_DOC_ID},\n        success : function(resp){\n\t\t\tif(Wb.decode(resp.responseText).rows[0].COUNT === 0){\n\t\t\t\tWb.toast('{#deleteMsg6#}\"'+rows[0].data.BG_DOC_CODE+'\"{#submitMsg2#}');\n                return;\n            }\n            Wb.request({//账簿级流程\n                url : 'm?xwl=xc/bg/qry/bg-doc-qry/bg-doc-qryDB/bg-ld-catSelectProcess',\n                params : {LEDGER_ID : rows[0].data.LEDGER_ID,BG_CAT_CODE : rows[0].data.BG_CAT_CODE},\n                success : function(ldResp){\n                    var ldTemp = Wb.decode(ldResp.responseText);\n                    var processCODE = '';\n                    if(ldTemp.total === 0){\n                        Wb.request({//全局流程\n                            url : 'm?xwl=xc/bg/qry/bg-doc-qry/bg-doc-qryDB/bg-catSelectProcess',\n                            params : {BG_CAT_CODE : rows[0].data.BG_CAT_CODE},\n                            success : function(catResp){\n                                var catTemp = Wb.decode(catResp.responseText);\n                                if(catTemp.total === 0){\n                                    Wb.toast('{#submitMsg3#}');\n                                    return;\n                                }\n                                else{\n                                    processCODE = catTemp.rows[0].PROCESS_CODE;\n                                    submitProcess(processCODE);\n                                }\n                            }\n                        });\n                    }\n                    else{\n                        processCODE = ldTemp.rows[0].PROCESS_CODE;\n                        submitProcess(processCODE);\n                    }\n\t\t\t\t}\n            });\n        }\n    });\n}\nfunction submitProcess(processCODE){//提交流程的方法\n    var auditStatus = rows[0].data.AUDIT_STATUS;\n    var opType = '';//余额汇总类型\n    var Todo_Title = '';\n    var ledgerObj = app.ledgers_com.findRecord('LEDGER_ID',app.ledgers_com.getValue());\n    var orgId = ledgerObj.data.ORG_ID;\n    var projectName = '';\n    if(rows[0].data.BG_CAT_CODE === 'BG01'){\n        opType = 'BG01';\n        Todo_Title = rows[0].data.BG_VER_PERIOD + '{#submitMsg4#}' + rows[0].data.BG_CAT_NAME+'{#submitMsg5#}';\n    }\n    if(rows[0].data.BG_CAT_CODE === 'BG02'){\n        opType = 'BG02';\n        Todo_Title = rows[0].data.PROJECT_NAME + '{#submitMsg6#}' + rows[0].data.BG_CAT_NAME+'{#submitMsg5#}';\n        projectName = rows[0].data.PROJECT_NAME;\n    }\n    Wb.request({//得到流程关联表单URL\n        url : 'm?xwl=xc/bg/qry/bg-doc-qry/bg-doc-qryDB/bgFormURLSelect',\n        params : {BG_CAT_CODE : opType},\n        success : function(resp){\n            var PC_A_FORM = Wb.decode(resp.responseText).rows[0].FORM_URL;\n            if(PC_A_FORM === null || PC_A_FORM === ''){\n                Wb.toast(rows[0].data.BG_CAT_NAME+'{#submitMsg7#}');\n                return;\n            }\n            else{\n              //AMT 在预算流程中并没有其他作用，这里传递一个0只是为了给这个参数填值而已\n                var json = {\n                    'APP_IP'        :'{#appIP#}',\n                    'loginName'\t\t:'{#XIP.userName#}',\n                    'Todo_Title'\t:Todo_Title,\n                    'PC_A_FORM'\t\t:PC_A_FORM,\n                    'opType'\t\t:opType,\n                    'e_business_id' :rows[0].data.BG_DOC_ID,\n                    'ORG_ID'\t\t:orgId,\n                    'PROJECT_NAME'\t:projectName,\n                    'AMT'           :rows[0].data.AMT,\n                    'ledgerId'      :app.ledgers_com.getValue()\n                };\n                if(auditStatus === 'A'){//起草状态\n                    XipWf.startAndSubmitByProcess(processCODE,json,function(e){//提交流程\n                        if(e.flag === 0){\n                            app.searchButton.fireEvent('click');\n                            Wb.toast('{#submitMsg8#}');\n                        }\n                        else if(e.flag === 1){\n                            Wb.toast(e.msg) ;\n                        }else{}\n                    });\n                }\n                else if(auditStatus === 'R' || auditStatus === 'D'){//撤回、驳回状态\n                    XipWf.submitInstance(rows[0].data.INS_CODE,json,function(e){//提交流程\n                        if(e.flag === 0){\n                            app.searchButton.fireEvent('click');\n                            Wb.toast('{#submitMsg8#}');\n                        }\n                        else if(e.flag === 1){\n                            Wb.toast(e.msg) ;\n                        }else{}\n                    });\n                }\n                else if(auditStatus === 'E' || auditStatus === 'C'){//运行中、结束状态\n                    Wb.toast('{#submitMsg9#}');\n                    return false;\n                }\n                else{\n                    Wb.toast('{#submitMsg10#}');\n                    return false;\n                }\n            }\n        }\n    });\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#revoke#}","itemId":"revokeButton","iconCls":"cancel_icon"},"events":{"click":"var rows = app.bg_qry_grid.getSelection();\nvar ledger_id = app.ledgers_com.getValue();\nif(ledger_id === null){\n\tWb.toast('{#editMsg1#}');\n    return;\n}\nif (!rows.length) {//选中的数据条数\n\tWb.toast('{{#revokeMsg1#}');\n\treturn;\n}\nelse if(rows[0].data.INS_CODE === null || rows[0].data.INS_CODE === '') {\n\tWb.toast('{#revokeMsg2#}');\n\treturn;\n}\nelse if(rows[0].data.AUDIT_STATUS === 'E') {\n\tWb.toast('{#revokeMsg3#}');\n\treturn;\n}\nelse if(rows[0].data.AUDIT_STATUS === 'R'){\n    Wb.toast('{#revokeMsg4#}');\n    return false;\n}\nelse {\n\t//撤回流程\n\tXipWf.revokeByInstance(rows[0].data.INS_CODE,function(e){\n\t\tWb.toast(e.msg);\n        app.searchButton.fireEvent('click');\n\t});\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#monitor#}","itemId":"monitorButton","iconCls":"viewport_icon"},"events":{"click":"var rows = app.bg_qry_grid.getSelection();\nvar ledger_id = app.ledgers_com.getValue();\nif(ledger_id === null){\n\tWb.toast('{#editMsg1#}');\n    return;\n}\nif(rows.length != 1){\n\tWb.toast('{#monitorMsg1#}');\n}\nelse{\n    if(rows[0].data.INS_CODE === null || rows[0].data.INS_CODE === ''){\n      Wb.toast('{#monitorMsg2#}');\n\t}\n    else{\n        XipWf.showMonitorPage(rows[0].data.INS_CODE);\n    }   \n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#annex#}","itemId":"annexButton","iconCls":"attach_icon"},"events":{"click":"var rows = app.bg_qry_grid.getSelection();//获得选中数据\nvar ledger_id = app.ledgers_com.getValue();\nif(ledger_id === null){\n\tWb.toast('{#editMsg1#}');\n    return;\n}\nif (!rows.length) {//选中的数据条数\n\tWb.toast('{#annexMsg1#}');\n\treturn;\n}\nif(rows[0].data.AUDIT_STATUS === 'E' || rows[0].data.AUDIT_STATUS === 'C'){\n    Wb.toast('{#annexMsg2#}');\n    return;\n}\nelse\n{\n\tXip.showAttachmentManager('{#XIP.userId#}',rows[0].data.BG_DOC_ID,'','BG_DOC_QRY',rows[0].data.BG_DOC_CODE,'Y','Y','Y',function(){},2);  \n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#cancelDoc#}","itemId":"cancelDoc","iconCls":"first_icon"},"events":{"click":"/*预算单回退\n *1、预算单回退时，必须判断当前预算单的每一项预算明细的申请额是否已经超出预算余额值剩余值\n *2、只有所有的预算明细的申请额在不超出预算总额剩余值的前提下才能够进行回退操作\n *3、预算单回退后，原始预算单回到起草状态\n */\nvar rows = app.bg_qry_grid.getSelection() ;\n\nif(rows.length !== 1){\n  Wb.toast('{#backMsg#}') ;\n  return false ;\n}else{\n    if(rows[0].data.AUDIT_STATUS !== 'E'){\n    Wb.toast('{#la_backErrMsg#}') ;\n    return false ;\n  }\n  app.cancelWin.show() ;\n  app.cancelWin.center() ;\n}\n\n"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"store","url":"m?xwl=xc/bg/qry/bg-doc-qry/bg-doc-qryDB/bgFeeQuery"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#orderby#}","align":"center","xtype":"rownumberer","width":"50","titleAlign":"center","itemId":"ORDERBY"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#bgid#}","hidden":"true","dataIndex":"BG_DOC_ID","titleAlign":"center","itemId":"BG_DOC_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#bgname#}","hidden":"true","dataIndex":"BG_DOC_NAME","titleAlign":"center","itemId":"BG_DOC_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#ledgerid#}","hidden":"true","dataIndex":"LEDGER_ID","titleAlign":"center","itemId":"LEDGER_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#inscode#}","hidden":"true","width":"80","dataIndex":"INS_CODE","titleAlign":"center","itemId":"INS_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#bgCode#}","width":"150","dataIndex":"BG_DOC_CODE","titleAlign":"center","itemId":"BG_DOC_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#bgCatCode#}","hidden":"true","width":"200","dataIndex":"BG_CAT_CODE","titleAlign":"center","itemId":"BG_CAT_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#bgCatType#}","width":"200","dataIndex":"BG_CAT_NAME","titleAlign":"center","itemId":"BG_CAT_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#bgVersion#}","hidden":"true","width":"180","dataIndex":"BG_VER_ID","titleAlign":"center","itemId":"BG_VER_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#bgVersion#}","width":"180","dataIndex":"BG_VER_NAME","titleAlign":"center","itemId":"BG_VER_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#bgYear#}","hidden":"true","width":"180","dataIndex":"BG_VER_PERIOD","titleAlign":"center","itemId":"BG_VER_PERIOD_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#pro#}","hidden":"true","width":"180","dataIndex":"PROJECT_ID","titleAlign":"center","itemId":"PROJECT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#pro#}","width":"180","dataIndex":"PROJECT_NAME","titleAlign":"center","itemId":"PROJECT_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#bgDesc#}","width":"200","dataIndex":"BG_DOC_DESC","titleAlign":"center","itemId":"BG_DOC_DESC_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#auditDate#}","hidden":"true","xtype":"datecolumn","width":"100","dataIndex":"AUDIT_DATE","titleAlign":"center","itemId":"AUDIT_DATE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#createDate#}","xtype":"datecolumn","width":"100","dataIndex":"CREATION_DATE","titleAlign":"center","itemId":"CREATION_DATE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#auditUser#}","hidden":"true","width":"80","dataIndex":"ADUIT_USERS","titleAlign":"center","itemId":"ADUIT_USERS_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#createBy#}","hidden":"true","width":"120","dataIndex":"CREATED_BY","titleAlign":"center","itemId":"CREATED_BY_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#createBy#}","hidden":"true","width":"80","dataIndex":"USER_ID","titleAlign":"center","itemId":"CREATED_BY_COL1"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#createBy#}","width":"80","dataIndex":"EMP_NAME","titleAlign":"center","itemId":"EMP_NAME_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#auditStatus#}","hidden":"true","width":"100","dataIndex":"AUDIT_STATUS","titleAlign":"center","itemId":"AUDIT_STATUS_COL","renderer":"if(value == 'A'){\n\treturn '{#A#}';\n}\nelse if(value == 'C'){\n\treturn '{#C#}';\n}\nelse if(value == 'R'){\n\treturn '{#R#}';\n}\nelse if(value == 'E'){\n\treturn '{#E#}';\n}\nelse if(value == 'D'){\n\treturn '{#D#}';\n}\nelse{\n\treturn value ;\n}"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#auditStatus#}","width":"100","dataIndex":"AUDIT_STATUS_DESC","titleAlign":"center","itemId":"AUDIT_STATUS_DESC_COL"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":null}