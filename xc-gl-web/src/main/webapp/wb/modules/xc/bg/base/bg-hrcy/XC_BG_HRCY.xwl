{"inframe":false,"title":"预算项目体系","hidden":false,"roles":{"default":1},"children":[{"configs":{"serverScript":"//引入对应的json文件\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,'xc/bg/base/bg-hrcy/XC_BG_HRCY');","itemId":"module"},"events":{"finalize":"var opType = '';"},"children":[{"configs":{"height":"205","layout":"auto","width":"650","buttonAlign":"center","dialog":"true","itemId":"win"},"events":{"show":"if(opType == 'create'){\n  app.BG_HRCY_CODE.setReadOnly(false);\n}else{\n  app.BG_HRCY_CODE.setReadOnly(true);\n}"},"children":[{"configs":{"tagConfigs":"{\n  baseCls: 'my-panel-no-border'\n}","layout":"column","margin":"10 0 0 10","itemId":"winpanel1"},"children":[{"configs":{"tagConfigs":"{\n  columnWidth:0.25\n}","labelWidth":"60","allowBlank":"false","labelAlign":"right","itemId":"BG_HRCY_CODE","fieldLabel":"<font color='red'>*<\/font>{#BG_HRCY_CODE#}"},"children":[],"expanded":true,"type":"text"},{"configs":{"tagConfigs":"{\n  columnWidth:0.45\n}","labelWidth":"60","allowBlank":"false","labelAlign":"right","itemId":"BG_HRCY_NAME","fieldLabel":"<font color='red'>*<\/font>{#BG_HRCY_NAME#}"},"children":[],"expanded":false,"type":"text"},{"configs":{"tagConfigs":"{\n  columnWidth:0.25\n}","labelWidth":"70","allowBlank":"false","value":"Y","pickList":"[['Y','是'],['N','否']]","labelAlign":"right","itemId":"IS_ENABLED","fieldLabel":"{#IS_ENABLED#}"},"children":[],"expanded":false,"type":"combo"}],"expanded":false,"type":"panel"},{"configs":{"tagConfigs":"{\n  baseCls: 'my-panel-no-border'\n}","layout":"column","margin":"10 0 0 10","itemId":"winpanel2"},"children":[{"configs":{"tagConfigs":"{\n  columnWidth:0.95\n}","labelWidth":"60","labelAlign":"right","itemId":"BG_HRCY_DESC","fieldLabel":"{#BG_HRCY_DESC#}"},"children":[],"expanded":false,"type":"textarea"}],"expanded":false,"type":"panel"}],"expanded":true,"type":"window"},{"configs":{"frame":"true","height":"250","width":"600","buttonAlign":"center","dialog":"true","itemId":"win1"},"events":{"show":"app.sourceCombo.getStore().load();\nvar rec = app.grid1.getSelection()[0];\nif(rec){\n  var id = rec.data.BG_HRCY_ID;\n  var code = rec.data.BG_HRCY_CODE+'-copy';\n  var name = rec.data.BG_HRCY_NAME+'-copy';\n  var desc = rec.data.BG_HRCY_DESC;\n  app.sourceCombo.setValue(id);\n  app.code.setValue(code);\n  app.name.setValue(name);\n  app.desc.setValue(desc);\n}\n\n"},"children":[{"configs":{"region":"north","tagConfigs":"{\nbaseCls: 'my-panel-no-border'\n}\n","layout":"column","itemId":"win1panel1"},"children":[{"configs":{"tagConfigs":"{\n  columnWidth:0.49\n}","labelWidth":"50","allowBlank":"false","queryMode":"local","displayField":"BG_HRCY_NAME","valueField":"BG_HRCY_ID","labelAlign":"right","padding":"10 0 10 0","itemId":"sourceCombo","fieldLabel":"{#sourceCombo#}"},"events":{"select":"var code = records[0].data.BG_HRCY_CODE+'-copy';\nvar name = records[0].data.BG_HRCY_NAME+'-copy';\nvar desc = records[0].data.BG_HRCY_DESC;\napp.code.setValue(code);\napp.name.setValue(name);\napp.desc.setValue(desc);"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/bg/base/bg-hrcy/DB/SELECT_XC_BG_HRCY"},"children":[],"expanded":false,"type":"store"}],"expanded":false,"type":"combo"}],"expanded":false,"type":"panel"},{"configs":{"height":"1","itemId":"line"},"children":[],"expanded":true,"type":"panel"},{"configs":{"region":"center","tagConfigs":"{\nbaseCls: 'my-panel-no-border'\n}\n","layout":"column","itemId":"win1panel2"},"children":[{"configs":{"tagConfigs":"{\n  columnWidth:0.49\n}","labelWidth":"50","allowBlank":"false","labelAlign":"right","padding":"10 0 0 0","itemId":"code","fieldLabel":"{#code#}"},"children":[],"expanded":false,"type":"text"},{"configs":{"tagConfigs":"{\n  columnWidth:0.49\n}","labelWidth":"50","allowBlank":"false","labelAlign":"right","padding":"10 0 0 0","itemId":"name","fieldLabel":"{#name#}"},"children":[],"expanded":false,"type":"text"}],"expanded":false,"type":"panel"},{"configs":{"tagConfigs":"{\nbaseCls: 'my-panel-no-border'\n}\n","layout":"column","itemId":"win1panel3"},"children":[{"configs":{"tagConfigs":"{\n  columnWidth:0.98\n}","labelWidth":"50","labelAlign":"right","padding":"10 0 10 0","itemId":"desc","fieldLabel":"{#desc#}"},"children":[],"expanded":false,"type":"textarea"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"window"},{"configs":{"layout":"fit","itemId":"viewport1"},"children":[{"configs":{"multiSelect":"true","selType":"checkboxmodel","itemId":"grid1"},"events":{"itemdblclick":"app.editBtn.fireEvent('click');"},"children":[{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"{#addBtn#}","itemId":"addBtn","iconCls":"file_add_icon"},"events":{"click":"opType = 'create';//操作类型\n\nvar win = new Ext.window.Window(app._win); //app._win指向配置对象而非实例\nwin.show();\nwin.setIconCls('record_add_icon');\nWb.setTitle(win, '{#xz#}');//新增\n\n\n\nwin.mon(win, 'ok', function() {\n\n  var BG_HRCY_CODE = app.BG_HRCY_CODE.getValue();\n  var BG_HRCY_NAME = app.BG_HRCY_NAME.getValue();\n  var BG_HRCY_DESC = app.BG_HRCY_DESC.getValue();\n  var IS_ENABLED = app.IS_ENABLED.getValue();\n  var params = {BG_HRCY_CODE:BG_HRCY_CODE,\n                BG_HRCY_NAME:BG_HRCY_NAME,\n                BG_HRCY_DESC:BG_HRCY_DESC,\n                IS_ENABLED:IS_ENABLED\n               };\n  Wb.request({\n    url: 'm?xwl=xc/bg/base/bg-hrcy/DB/INSERT_XC_BG_HRCY',\n    params: params,\n    success: function(resp) {\n      app.queryBtn.fireEvent('click');\n      win.close(); //根据closeAction属性，默认为销毁\n    }\n  });\n});\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#editBtn#}","itemId":"editBtn","iconCls":"file_edit_icon"},"events":{"click":"var rec = app.grid1.getSelection()[0];\nif (!rec) {\n  Wb.toast('{#qxzytxuxgdsj#}');//请选择 1 条需要修改的数据！\n  return;\n}\n\nopType = 'update';//操作类型\n\nvar win = new Ext.window.Window(app._win); //app._win指向配置对象而非实例\nwin.show();\nwin.setIconCls('record_edit_icon');\nWb.setTitle(win, '{#bj#}');//编辑\nWb.setValue(win, rec.data); //把记录数据应用到窗口\n\n\n\n//窗口每次动态生成,方法在窗口销毁时自动销毁\nwin.mon(win, 'ok', function() {\n  var BG_HRCY_ID = rec.data.BG_HRCY_ID;\n  var BG_HRCY_CODE = app.BG_HRCY_CODE.getValue();\n  var BG_HRCY_NAME = app.BG_HRCY_NAME.getValue();\n  var BG_HRCY_DESC = app.BG_HRCY_DESC.getValue();\n  var IS_ENABLED = app.IS_ENABLED.getValue();\n  var params = {BG_HRCY_ID:BG_HRCY_ID,\n                BG_HRCY_CODE:BG_HRCY_CODE,\n                BG_HRCY_NAME:BG_HRCY_NAME,\n                BG_HRCY_DESC:BG_HRCY_DESC,\n                IS_ENABLED:IS_ENABLED\n               };\n  Wb.request({\n    url: 'm?xwl=xc/bg/base/bg-hrcy/DB/UPDATE_XC_BG_HRCY',\n    params: params,\n    success: function(resp) {\n      app.queryBtn.fireEvent('click');\n      win.close(); //根据closeAction属性，默认为销毁\n    }\n  });\n});\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#delBtn#}","itemId":"delBtn","iconCls":"file_delete_icon"},"events":{"click":"//体系被引用或体系下有费用项目时都不可以被停用，也不可以被删除\nvar recs = app.grid1.getSelection();\nif (!recs.length) {\n  Wb.toast('{#qxzxyscdsj#}');//请选择需要删除的数据！\n  return false;\n}\nWb.confirm('{#qdyscxzd#}' + recs.length + ' {#tsjm#}',function(){//确定要删除选择的  条数据吗？\n  Wb.request({\n    url: 'm?xwl=xc/bg/base/bg-hrcy/DB/DELETE_XC_BG_HRCY',\n    params: {deleteRecs:Wb.getData(recs)},\n    success: function(resp) {\n      Wb.toast('{#sccg#}');//删除成功！\n      app.queryBtn.fireEvent('click');\n    }\n  });\n});\n\n\n// Wb.confirm('确定要删除选择的 ' + recs.length + ' 条数据吗？', function() {\n//   var ids = '(';\n//   for(var i=0;i<recs.length;i++){\n//     if(i===0){\n//       ids = ids+\"'\"+recs[i].data.BG_HRCY_ID+\"'\";\n//     }else{\n//       ids = ids+','+\"'\"+recs[i].data.BG_HRCY_ID+\"'\";\n//     }\n//   }\n//   ids = ids+')';\n//   //判断预算项目体系下是否有项目详情\n//   Wb.request({\n//     url: 'm?xwl=xc/bg/base/bg-hrcy/DB/SELECT_XC_BG_ITEMS_COUNT',\n//     params: {ids:ids},\n//     success: function(resp){\n//       var count = Wb.decode(resp.responseText).total;\n//       if(count===0){\n//         //删除\n//         Wb.request({\n//           url: 'm?xwl=xc/bg/base/bg-hrcy/DB/DELETE_XC_BG_HRCY',\n//           params: {data:Wb.getData(recs)},\n//           success: function(resp) {\n//             Wb.toast('删除成功');\n//             app.queryBtn.fireEvent('click');\n//           }\n//         });\n//       }else{\n//         Wb.toast('体系下有数据，不可以删除');\n//       }\n//     }\n//   });\n// });"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#copyBtn#}","itemId":"copyBtn","iconCls":"copy_icon"},"events":{"click":"var recs = app.grid1.getSelection();\nif(recs.length!==1){\n  Wb.toast('{#qxzytxyfzdsj#}');//请选择 1 条需要复制的数据\n  return false;\n}\nvar rec = recs[0];\n\nvar win1 = new Ext.window.Window(app._win1); //app._win指向配置对象而非实例\nwin1.show();\nwin1.setIconCls('record_add_icon');\nWb.setTitle(win1, '{#fz#}');//复制\n//复制\nwin1.mon(win1, 'ok', function() {\n  var BG_HRCY_CODE = app.code.getValue();\n  var BG_HRCY_NAME = app.name.getValue();\n  var BG_HRCY_DESC = app.desc.getValue();\n  var IS_ENABLED = rec.data.IS_ENABLED;\n  //获取预算项目详情\n  var BG_HRCY_ID = app.sourceCombo.getValue();//项目体系ID\n  var bg_items;//预算项目详情数据\n  Wb.request({\n    async: false,\n    url: 'm?xwl=xc/bg/base/bg-items/DB/SELECT_XC_BG_ITEMS',\n    params: {BG_HRCY_ID:BG_HRCY_ID},\n    success: function(resp) {\n      var obj = Wb.decode(resp.responseText);\n      if(obj.total>0){\n        bg_items = obj.rows;\n      }else{\n        bg_items = [];\n      }\n    }\n  });\n\n  Wb.request({\n    url:'m?xwl=xc/bg/base/bg-hrcy/DB/copy',\n    params:{BG_HRCY_ID:'',BG_HRCY_CODE:BG_HRCY_CODE,BG_HRCY_NAME:BG_HRCY_NAME,BG_HRCY_DESC:BG_HRCY_DESC,IS_ENABLED:IS_ENABLED,bg_items:bg_items},\n    success:function(resp){\n      win1.close();\n      app.queryBtn.fireEvent('click');\n      Wb.toast('{#fzcg#}');//复制成功!\n      \n    }\n  });\n\n});\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#stopBtn#}","itemId":"stopBtn","iconCls":"stop_icon"},"events":{"click":"//体系被引用或体系下有费用项目时都不可以被停用，也不可以被删除\n//使用下面方法用于演示完整的步骤\nvar recs = app.grid1.getSelection();\nif (recs.length===0) {\n  Wb.toast('{#qxzxytzdsj#}');//请选择需要停止的数据！\n  return false;\n}\nWb.confirm('{#qdytyxzd#} ' + recs.length + ' {#tsjm#}', function() {//确定要停用选择的 条记录吗？\n  Wb.request({\n    url: 'm?xwl=xc/bg/base/bg-hrcy/DB/STOP_XC_BG_HRCY',\n    params: {stopRecs:Wb.getData(recs)},\n    success: function(resp) {\n      app.queryBtn.fireEvent('click');\n    }\n  });\n});\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#queryBtn#}","hidden":"true","itemId":"queryBtn"},"events":{"click":"app.grid1.store.load();"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#ROW_NUM_COL#}","align":"center","width":"50","xtype":"rownumberer","titleAlign":"center","itemId":"ROW_NUM_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#BG_HRCY_ID_COL#}","hidden":"true","dataIndex":"BG_HRCY_ID","titleAlign":"center","itemId":"BG_HRCY_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#BG_HRCY_CODE_COL#}","width":"150","dataIndex":"BG_HRCY_CODE","titleAlign":"center","itemId":"BG_HRCY_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#BG_HRCY_NAME_COL#}","width":"300","dataIndex":"BG_HRCY_NAME","titleAlign":"center","itemId":"BG_HRCY_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#BG_HRCY_DESC_COL#}","width":"300","dataIndex":"BG_HRCY_DESC","titleAlign":"center","itemId":"BG_HRCY_DESC_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#IS_ENABLED_COL#}","width":"100","dataIndex":"IS_ENABLED","titleAlign":"center","itemId":"IS_ENABLED_COL","renderer":"if(value=='Y')\n  return '是';\nif(value=='N')\n  return '否';"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/bg/base/bg-hrcy/DB/SELECT_XC_BG_HRCY"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}