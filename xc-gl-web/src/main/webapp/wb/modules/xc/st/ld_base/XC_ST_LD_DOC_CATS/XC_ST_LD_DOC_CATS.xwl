{"inframe":false,"title":"账簿级库存单据类型","hidden":false,"roles":{"default":1},"children":[{"configs":{"loginRequired":"false","serverScript":"//---------------------获取当前模块语言对应的.json文件，放到request中----------------\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xc/st/base/XC_ST_DOC_CATS/json/XC_ST_DOC_CATS\");","itemId":"module"},"events":{"finalize":"var docClass = null;","initialize":"function returnRowFn(r,type){\n    if(type==='xip_pub_orgs'){\n        app.LEDGER_ID.setValue(r.data.LEDGER_ID);\n        app.ORG_ID.setValue(r.data.ORG_ID);\n        app.bottonGrid.store.load({params:{LEDGER_ID : app.LEDGER_ID.getValue(),DOC_CLASS:'NO'}});\n        insertLdDocCats();\n    }\n}\nfunction clearOtherFn(type){\n    if(type=='xip_pub_orgs'){\n    }\n}\nfunction insertLdDocCats(){\n\t//获得全局单据类型所有的信息\n    Wb.request({\n        url : 'm?xwl=xc/st/common/data/stDocCatsSelect',\n        params : {},\n        async : false,\n        success : function(resp){\n            var rec = Wb.decode(resp.responseText);\n            for(var i = 0;i < rec.total;i++){\n                //判断账簿单据类型里面是否存在该单据类型\n                Wb.request({\n                    url : 'm?xwl=xc/st/ld_base/XC_ST_LD_DOC_CATS/data/stLdDocCatsSelect',\n                    params : {\"LEDGER_ID\" : app.LEDGER_ID.getValue(),ST_CAT_CODE : rec.rows[i].ST_CAT_CODE},\n                    async : false,\n                    success : function(resp01){\n                        var rec01 = Wb.decode(resp01.responseText);\n                        if(rec01.total === 0){\n                            Wb.request({\n                                url : 'm?xwl=xc/st/ld_base/XC_ST_LD_DOC_CATS/data/stLdDocCatsInsert',\n                                params : {\"LEDGER_ID\" : app.LEDGER_ID.getValue(),\"ORG_ID\" : app.ORG_ID.getValue(),ST_CAT_CODE : rec.rows[i].ST_CAT_CODE},\n                                async : false,\n                                success : function(){}\n                            });\n                        }\n                    }\n                });\n            }\n        }\n    });\n}"},"children":[{"configs":{"itemId":"tools"},"children":[{"configs":{"autoLoad":"true","itemId":"orgInitStore","url":"m?xwl=xc/com-lov/ORG_PICK/DB/ORG_SELECT_BY_LEDGER"},"events":{"load":"if(store.getCount() > 0){\n    app.LEDGER_ID.setValue(store.getAt(0).get('LEDGER_ID'));\n    app.ORG_ID.setValue(store.getAt(0).get('ORG_ID'));\n    app.ORG_XWL.ORG_ID.setValue(store.getAt(0).get('ORG_ID'));\n    app.ORG_XWL.ORG_NAME.setValue(store.getAt(0).get('ORG_NAME'));\n    insertLdDocCats();\n}"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"folder"},{"configs":{"layout":"border","itemId":"viewport1"},"children":[{"configs":{"region":"north","itemId":"search_form"},"children":[{"configs":{"layout":"column","margin":"5 0 5 0","itemId":"row1","border":"false"},"children":[{"configs":{"layout":"form","columnWidth":".249","itemId":"row1_1","border":"false"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/ORG_PICK/ORG_ALL_PICK","itemId":"ORG_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":false,"type":"panel"},{"configs":{"hidden":"true","layout":"form","columnWidth":".249","itemId":"row1_2","border":"false"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","hidden":"true","labelAlign":"right","itemId":"LEDGER_ID","fieldLabel":"账簿ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"80","readOnly":"true","hidden":"true","labelAlign":"right","itemId":"ORG_ID","fieldLabel":"组织ID"},"children":[],"expanded":false,"type":"text"}],"expanded":false,"type":"panel"}],"expanded":false,"type":"panel"}],"expanded":true,"type":"form"},{"configs":{"region":"north","multiSelect":"false","title":"{#XC_ST_DOC_CATS_topGridTitle#}","pagingBar":"false","selType":"rowmodel","height":"220","barExportAllButtons":"false","barExportButtons":"false","itemId":"topGrid","simpleSelect":"false"},"events":{"itemclick":"docClass = record.data.VAL_CODE;//票据大类\napp.bottonGrid.store.load({params:{LEDGER_ID : app.LEDGER_ID.getValue(),DOC_CLASS:docClass}});\nif(record.get('VAL_CODE') != 'LLSQD' ){\n    app.PROCESS_NAME_COL.hide();\n}\nelse{\n    app.PROCESS_NAME_COL.show();\n}"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/st/base/XC_ST_DOC_CATS/data/stDocClassSelect"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#XC_ST_DOC_CATS_NUMBER_COL#}","xtype":"rownumberer","width":"50","align":"center","titleAlign":"center","itemId":"Row_num"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#XC_ST_DOC_CATS_VAL_CODE#}","width":"120","dataIndex":"VAL_CODE","titleAlign":"center","itemId":"VAL_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#XC_ST_DOC_CATS_VAL_NAME#}","width":"150","dataIndex":"VAL_NAME","titleAlign":"center","itemId":"VAL_NAME_COL"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"},{"configs":{"region":"center","barExportButtons":"false","barExportAllButtons":"false","itemId":"bottonGrid","editable":"true"},"events":{"itemdblclick":"app.editButton.fireEvent('click');"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/st/ld_base/XC_ST_LD_DOC_CATS/data/stLdDocCatsSelect"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"{#XC_ST_DOC_CATS_saveButton#}","itemId":"saveButton","iconCls":"save_icon"},"events":{"click":"var rec = app.bottonGrid.getSelection();//选择一行信息\nvar modify = app.bottonGrid.store.getModifiedRecords();\nif(modify === '' || modify.length === 0){\n    Wb.toast('{#XC_ST_DOC_CATS_mysjxybc#}');\n\treturn;\n}\nif(!Wb.verifyGrid(app.bottonGrid))//验证数据是否合法\n\treturn;\nWb.sync({\n    grid : app.bottonGrid,\n    url : 'm?xwl=xc/st/ld_base/XC_ST_LD_DOC_CATS/data/stLdDocCatsUpdate',\n    success : function(resp) {\n        Wb.toast('{#XC_ST_DOC_CATS_sjbccg#}');\n        app.bottonGrid.store.load({params:{LEDGER_ID : app.LEDGER_ID.getValue(),DOC_CLASS:docClass}});\n    }\n});"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#XC_ST_DOC_CATS_NUMBER_COL#}","xtype":"rownumberer","width":"50","align":"center","titleAlign":"center","itemId":"NUMBER_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#XC_ST_DOC_CATS_VAL_CODE#}","hidden":"true","width":"150","dataIndex":"ST_DOC_CLASS","titleAlign":"center","itemId":"ST_DOC_CLASS_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#XC_ST_DOC_CATS_ST_CAT_CODE#}","width":"150","dataIndex":"ST_CAT_CODE","titleAlign":"center","itemId":"ST_CAT_CODE_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#XC_ST_DOC_CATS_ST_CAT_NAME#}","width":"150","dataIndex":"ST_CAT_NAME","titleAlign":"center","itemId":"ST_CAT_NAME_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#XC_ST_DOC_CATS_PROCESS_NAME#}","width":"150","dataIndex":"PROCESS_NAME","titleAlign":"center","itemId":"PROCESS_NAME_COL"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","normalName":"PROCESS_NAME_PICK","itemId":"editor"},"events":{"expand":"app.PROCESS_NAME_PICK.getPicker().getStore().reload();","collapse":"app.QUERY_CODE_NAME.reset();"},"children":[{"configs":{"tagConfigs":"minWidth:400","height":"300","barExportAllButtons":"false","barExportButtons":"false","itemId":"pickComp"},"events":{"itemdblclick":"var r = app.bottonGrid.getSelectionModel().getSelection()[0];\nr.set('PROCESS_ID',record.data.PROCESS_ID);\nr.set('PROCESS_NAME',record.data.PROCESS_NAME);\nr.dirty = true;\napp.PROCESS_NAME_PICK.setValue(record.data.PROCESS_NAME);\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/com-lov/PROCESS_ID_PICK/DB/XIP_WF_PROCESSES_SELECT"},"events":{"beforeload":"operation.params = Wb.getValue(app.tbar);"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"ID","hidden":"true","dataIndex":"PROCESS_ID","itemId":"PROCESS_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#XC_ST_DOC_CATS_PROCESS_CODE#}","dataIndex":"PROCESS_CODE","itemId":"PROCESS_CODE_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#XC_ST_DOC_CATS_PROCESS_NAMES#}","dataIndex":"PROCESS_NAME","itemId":"PROCESS_NAME_COLS","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"QUERY_CODE_NAME","fieldLabel":"{#XC_ST_DOC_CATS_QUERY_CODE_NAME#}"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.PROCESS_NAME_PICK.getPicker().getStore().reload();\n}"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"100","hidden":"true","value":"XC_PRESET_ST","labelAlign":"right","itemId":"QUERY_CODE"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"cancelBtn","iconCls":"delete_icon"},"events":{"click":"var r = app.bottonGrid.getSelectionModel().getSelection()[0];\nr.set('PROCESS_ID','');\nr.set('PROCESS_NAME','');\nr.dirty = true;\napp.PROCESS_NAME_PICK.setValue('');\napp.pickComp.hide();"},"children":[],"expanded":false,"type":"item"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":true,"type":"column"},{"configs":{"text":"{#XC_ST_DOC_CATS_DESCRIPTION#}","width":"150","dataIndex":"DESCRIPTION","titleAlign":"center","itemId":"DESCRIPTION_COL"},"children":[],"expanded":true,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}