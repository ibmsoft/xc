{"inframe":false,"title":"","hidden":false,"roles":{"default":1},"children":[{"configs":{"loginRequired":"false","serverScript":"//---------------------获取当前模块语言对应的.json文件，放到request中----------------\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xc/st/st_business/XC_ST_WH_ENTRY/json/XC_ST_WH_ENTRY\");\nvar ctxPath = request.getContextPath() ;\nrequest.setAttribute('contextPath',ctxPath);","itemId":"module"},"events":{"finalize":"function returnRowFn(r,type){\n    if(type==='xip_pub_orgs'){\n        app.LEDGER_ID.setValue(r.data.LEDGER_ID);\n        app.ORG_ID.setValue(r.data.ORG_ID);\n        app.WAREHOUSE_XWL.WAREHOUSE_ID.setValue(null);\n        app.WAREHOUSE_XWL.WAREHOUSE_NAME.setValue(null);\n        app.WAREHOUSE_XWL.QUERY_ORG_ID.setValue(r.data.ORG_ID);\n        app.WAREHOUSE_XWL.LEDGER_ID.setValue(r.data.LEDGER_ID);\n        app.searchButton.fireEvent('click');\n    }\n    if(type==='xc_st_warehouse'){\n        app.searchButton.fireEvent('click');\n        if(r.data.IS_INIT == 'N' && r.data.STATUS == 'Y'){//初始化未成功，能进行修改、新增、记账、删除等\n            setButtonStatus(false);\n        }\n        else{\n            setButtonStatus(true);\n        }\n    }\n}\nfunction clearOtherFn(type){\n    if(type=='xip_pub_orgs'){\n    }\n    if(type=='xc_st_warehouse'){\n        app.searchButton.fireEvent('click');\n    }\n}\nfunction setButtonStatus(flag){\n    app.addBtn.setDisabled(flag);\n    app.editBtn.setDisabled(flag);\n    app.signBtn.setDisabled(flag);\n    app.deleteBtn.setDisabled(flag);\n    app.cancelSignBtn.setDisabled(flag);\n}"},"children":[{"configs":{"itemId":"tools"},"children":[{"configs":{"itemId":"orgInitStore","autoLoad":"true","url":"m?xwl=xc/com-lov/ORG_PICK/DB/ORG_SELECT_BY_LEDGER"},"events":{"load":"if(store.getCount() > 0){\n    app.LEDGER_ID.setValue(store.getAt(0).get('LEDGER_ID'));\n    app.ORG_ID.setValue(store.getAt(0).get('ORG_ID'));\n    app.ORG_XWL.ORG_ID.setValue(store.getAt(0).get('ORG_ID'));\n    app.ORG_XWL.LEDGER_ID.setValue(store.getAt(0).get('LEDGER_ID'));\n    app.ORG_XWL.ORG_NAME.setValue(store.getAt(0).get('ORG_NAME'));\n    app.WAREHOUSE_XWL.QUERY_ORG_ID.setValue(store.getAt(0).get('ORG_ID'));\n    app.WAREHOUSE_XWL.LEDGER_ID.setValue(store.getAt(0).get('LEDGER_ID'));\n    app.searchButton.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"folder"},{"configs":{"layout":"border","itemId":"viewport1"},"children":[{"configs":{"region":"north","itemId":"search_form"},"children":[{"configs":{"layout":"column","margin":"5 0 5 0","itemId":"row1","border":"false"},"children":[{"configs":{"layout":"form","columnWidth":".249","itemId":"row1_1","border":"false"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/ORG_PICK/ORG_ALL_PICK","itemId":"ORG_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".249","itemId":"row1_2","border":"false"},"children":[{"configs":{"file":"m?xwl=xc/st/common/st_com_lov/XC_ST_WAREHOUSE_LOV/XC_ST_WAREHOUSE_LOV","itemId":"WAREHOUSE_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".249","itemId":"row1_3","border":"false"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"MATERIAL","fieldLabel":"{#XC_ST_WH_ENTRY_MATERIAL#}"},"events":{"specialkey":"if(e.getKey()===13) {\n  app.searchButton.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".249","border":"false","itemId":"row1_4"},"children":[{"configs":{"layout":"column","border":"false","itemId":"row1_4_1"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","hidden":"true","labelAlign":"right","itemId":"LEDGER_ID","fieldLabel":"账簿ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"80","readOnly":"true","hidden":"true","labelAlign":"right","itemId":"ORG_ID","fieldLabel":"组织ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","value":"0","itemId":"INIT"},"children":[],"expanded":false,"type":"text"},{"configs":{"text":"{#XC_ST_WH_ENTRY_searchButton#}","itemId":"searchButton","iconCls":"seek_icon"},"events":{"click":"app.grid.store.load({params : Wb.getValue(app.search_form)});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#XC_ST_WH_ENTRY_resetButton#}","itemId":"resetButton","iconCls":"refresh_icon"},"events":{"click":"app.search_form.getForm().reset();\napp.searchButton.fireEvent('click');"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"form"},{"configs":{"region":"center","selType":"checkboxmodel","barExportButtons":"false","barExportAllButtons":"false","itemId":"grid","editable":"true"},"events":{"itemdblclick":"if(app.editBtn.disabled === true)\n    app.seekBtn.fireEvent('click');\nelse\n    app.editBtn.fireEvent('click');"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/st/st_business/XC_ST_WH_INIT/data/stWhEntryHInitSelect"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"{#XC_ST_WH_ENTRY_addBtn#}","itemId":"addBtn","iconCls":"file_add_icon"},"events":{"click":"if(Wb.isEmpty(app.WAREHOUSE_XWL.WAREHOUSE_ID.getValue())){\n    Wb.toast('{#XC_ST_WH_ENTRY_qxxzck#}');\n    return;\n}\nWb.run({\n    url: 'm?xwl=xc/st/st_business/XC_ST_WH_INIT/XC_ST_WH_INIT_WIN', \n    success: function(apps) {\n        apps.initWin({\n            IS_INSERT : 'Add',\n            ENTRY_H_ID : Xip.getId(),\n            stDocCatCode : 'QTRK',\n            LEDGER_ID : app.LEDGER_ID.getValue(),\n            ORG_ID : app.ORG_XWL.ORG_ID.getValue(),\n            ORG_NAME : app.ORG_XWL.ORG_NAME.getValue(),\n            WAREHOUSE_ID : app.WAREHOUSE_XWL.WAREHOUSE_ID.getValue(),\n            WAREHOUSE_NAME : app.WAREHOUSE_XWL.WAREHOUSE_NAME.getValue(),\n            hideFun:function(){\n                app.searchButton.fireEvent('click');\n            }\n        });\n    }\n});"},"children":[],"expanded":true,"type":"button"},{"configs":{"text":"{#XC_ST_WH_ENTRY_editBtn#}","itemId":"editBtn","iconCls":"file_edit_icon"},"events":{"click":"var recs = app.grid.getSelection();//获得选中数据\nif(recs.length != 1){//选中的数据条数\n\tWb.toast('{#XC_ST_WH_ENTRY_qxzytxyxgdjl#}');//请选择一条需要修改的记录！\n\treturn;\n}\nWb.run({\n    url: 'm?xwl=xc/st/st_business/XC_ST_WH_INIT/XC_ST_WH_INIT_WIN', \n    success: function(apps) {\n        apps.initWin({\n            IS_INSERT : 'Update',\n            stDocCatCode : recs[0].data.DOC_CAT_CODE,\n            ENTRY_H_ID : recs[0].data.ENTRY_H_ID,\n            hideFun:function(){\n                app.searchButton.fireEvent('click');\n            }\n        });\n    }\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#XC_ST_WH_ENTRY_deleteBtn#}","itemId":"deleteBtn","iconCls":"file_delete_icon"},"events":{"click":"var recs = app.grid.getSelection();//获得选中数据\nif (!recs.length) {//选中的数据条数\n\tWb.toast('{#XC_ST_WH_ENTRY_qxzxyscdjl#}');//请选择需要删除的记录！\n\treturn;\n}\nvar deleteArray = [] ;\nfor(var i = 0;i < recs.length;i++){\n    if(recs[i].data.STATUS == '1'){\n        var deleteData =  {stDocId : recs[i].data.ENTRY_H_ID};\n        deleteArray.push(deleteData);\n    }\n}\nif(deleteArray.length === 0){\n    Wb.toast('{#XC_ST_WH_ENTRY_sxdjfcgztbnsc#}');//所选单据非草稿状态，不能删除！\n    return;\n}\nWb.confirm('{#XC_ST_WH_ENTRY_qdyscxzd#} ' + recs.length + ' {#XC_ST_WH_ENTRY_tjlm#}',function() {//'确定要删除选择的' + recs.length + '条记录吗？'\n    Wb.request({\n        url : '{#contextPath#}' + '/xcStDocsAction.do?method=deleteXcStDocs',\n        params: Wb.apply({hIds : deleteArray,docClassCode : 'RKD'}),\n        success: function(resp){\n            var record = Wb.decode(resp.responseText);\n            if(record.flag == '0')\n                Wb.toast('{#XC_ST_WH_ENTRY_sccg#}');//删除成功！\n            else\n                Wb.toast(record.msg);\n            app.searchButton.fireEvent('click');\n        }\n    });\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#XC_ST_WH_ENTRY_signBtn#}","itemId":"signBtn","iconCls":"write_icon"},"events":{"click":"var recs = app.grid.getSelection();//获得选中数据\nif(recs.length != 1){//选中的数据条数\n\tWb.toast('{#XC_ST_WH_ENTRY_qxzxyjzdjl#}');//请选择需要记账的记录！\n\treturn;\n}\nelse{\n    if(recs[0].data.INIT != '0'){\n        Wb.toast('{#XC_ST_WH_ENTRY_sxdjyjjzcg#}');//所选单据已经记账成功！\n        return;\n    }\n    Wb.request({\n        url : '{#contextPath#}' + '/xcStDocsAction.do?method=accountOrCancelAccount',\n        params: Wb.apply({stDocId : recs[0].data.ENTRY_H_ID,opType : '1'}),\n        success: function(resp){\n            var record = Wb.decode(resp.responseText);\n            if(record.flag == '0')\n                Wb.toast('{#XC_ST_WH_ENTRY_jzcg#}');//记账成功！\n            else\n                Wb.toast(record.msg);\n            app.searchButton.fireEvent('click');\n        }\n    });\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#XC_ST_WH_ENTRY_cancelSignBtn#}","itemId":"cancelSignBtn","iconCls":"cancel_icon"},"events":{"click":"var recs = app.grid.getSelection();//获得选中数据\nif(recs.length != 1){//选中的数据条数\n\tWb.toast('{#XC_ST_WH_ENTRY_qxzxyjzdjl#}');//请选择需要记账的记录！\n\treturn;\n}\nelse{\n    if(recs[0].data.INIT != '1'){\n        Wb.toast('{#XC_ST_WH_ENTRY_sxdjyjqxjzcg#}');//所选单据已经取消记账成功！\n        return;\n    }\n    Wb.request({\n        url : '{#contextPath#}' + '/xcStDocsAction.do?method=accountOrCancelAccount',\n        params: Wb.apply({stDocId : recs[0].data.ENTRY_H_ID,opType : '0'}),\n        success: function(resp){\n            var record = Wb.decode(resp.responseText);\n            if(record.flag == '0')\n                Wb.toast('{#XC_ST_WH_ENTRY_qxjzcg#}');//取消记账成功！\n            else\n                Wb.toast(record.msg);\n            app.searchButton.fireEvent('click');\n        }\n    });\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#XC_ST_WH_ENTRY_seekBtn#}","itemId":"seekBtn","iconCls":"seek_icon"},"events":{"click":"var recs = app.grid.getSelection();//获得选中数据\nif(recs.length != 1){//选中的数据条数\n\tWb.toast('{#XC_ST_WH_ENTRY_qxzytxyckdjl#}');//请选择一条需要查看的记录！\n\treturn;\n}\nWb.run({\n    url: 'm?xwl=xc/st/st_business/XC_ST_WH_INIT/XC_ST_WH_INIT_WIN', \n    success: function(apps) {\n        apps.initWin({\n            IS_INSERT : 'Seek',\n            stDocCatCode : recs[0].data.DOC_CAT_CODE,\n            ENTRY_H_ID : recs[0].data.ENTRY_H_ID,\n            hideFun:function(){\n                app.searchButton.fireEvent('click');\n            }\n        });\n    }\n});"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#XC_ST_WH_ENTRY_NUMBER_COL#}","xtype":"rownumberer","width":"50","align":"center","titleAlign":"center","itemId":"NUMBER_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#XC_ST_WH_ENTRY_ENTRY_H_CODE#}","width":"150","dataIndex":"ENTRY_H_CODE","titleAlign":"center","itemId":"ENTRY_H_CODE_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#XC_ST_WH_ENTRY_BIZ_DATE#}","xtype":"datecolumn","width":"100","dataIndex":"BIZ_DATE","titleAlign":"center","itemId":"BIZ_DATE_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#XC_ST_WH_ENTRY_ST_CAT_NAME#}","width":"120","dataIndex":"ST_CAT_NAME","titleAlign":"center","itemId":"ST_CAT_NAME_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#XC_ST_WH_ENTRY_BUSINESS_TYPE_NAME#}","width":"140","dataIndex":"BUSINESS_TYPE_NAME","titleAlign":"center","itemId":"BUSINESS_TYPE_NAME_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#XC_ST_WH_ENTRY_YWBM#}","width":"150","dataIndex":"DEPT_NAME","titleAlign":"center","itemId":"DEPT_NAME_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#XC_ST_WH_ENTRY_PROJECT_NAME#}","width":"150","dataIndex":"PROJECT_NAME","titleAlign":"center","itemId":"PROJECT_NAME_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#XC_ST_WH_ENTRY_WAREHOUSE#}","width":"150","dataIndex":"WAREHOUSE_NAME","titleAlign":"center","itemId":"WAREHOUSE_NAME_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#XC_ST_WH_ENTRY_EMP_NAME#}","width":"100","dataIndex":"EMP_NAME","titleAlign":"center","itemId":"EMP_NAME_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#XC_ST_WH_ENTRY_ENTRY_H_NAME#}","width":"150","dataIndex":"ENTRY_H_NAME","titleAlign":"center","itemId":"ENTRY_H_NAME_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#XC_ST_WH_ENTRY_STATUS#}","width":"100","dataIndex":"STATUS","titleAlign":"center","itemId":"STATUS_COL","renderer":"if(value == '1')\n    return '{#XC_ST_WH_ENTRY_STATUS_1#}';\nif(value == '2')\n    return '{#XC_ST_WH_ENTRY_STATUS_2#}';\nif(value == '3')\n    return '{#XC_ST_WH_ENTRY_STATUS_3#}';"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#XC_ST_WH_ENTRY_MATERIAL_CODE#}","width":"120","dataIndex":"MATERIAL_CODE","titleAlign":"center","itemId":"MATERIAL_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#XC_ST_WH_ENTRY_MATERIAL_NAME#}","width":"120","dataIndex":"MATERIAL_NAME","titleAlign":"center","itemId":"MATERIAL_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#XC_ST_WH_ENTRY_SPECIFICATION#}","width":"100","dataIndex":"SPECIFICATION","titleAlign":"center","itemId":"SPECIFICATION_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#XC_ST_WH_ENTRY_QTY#}","align":"right","width":"100","dataIndex":"QTY","titleAlign":"center","itemId":"QTY_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#XC_ST_WH_ENTRY_DIM_NAME#}","width":"80","dataIndex":"DIM_NAME","titleAlign":"center","itemId":"DIM_NAME_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#XC_ST_WH_ENTRY_PRICE#}","width":"100","align":"right","dataIndex":"PRICE","format":"0,000.0000","titleAlign":"center","itemId":"PRICE_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#XC_ST_WH_ENTRY_AMOUNT#}","width":"100","align":"right","dataIndex":"AMOUNT","format":"0,000.0000","titleAlign":"center","itemId":"AMOUNT_COL"},"children":[],"expanded":true,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}