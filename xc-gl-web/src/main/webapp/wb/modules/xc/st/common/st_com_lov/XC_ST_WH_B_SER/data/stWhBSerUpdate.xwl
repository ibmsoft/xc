{"inframe":false,"title":"","hidden":false,"roles":{"default":1},"children":[{"configs":{"initScript":"//---------------------获取当前模块语言对应的.json文件，放到request中----------------\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xc/st/common/json/XC_ST_COMMON\");","loginRequired":"false","serverScript":"var id,ids = [],\nrecsCreate = Wb.decode(request.getParameter('create'));\nWb.each(recsCreate,function(rec){\n    //同一个物料批次允许重复、序列号不允许重复\n    if(rec.SERIAL_BATCH == 'XLH'){\n        app.run(\"select 1 from xc_st_wh_b_ser where SERIAL_BATCH_NUM='\" + rec.SERIAL_BATCH_NUM + \"' and MATERIAL_ID = '\" + rec.MATERIAL_ID + \"'\",{\n            errorText: '{#XC_ST_COMMON_gaiwlx#}{#XC_ST_COMMON_XLH#} \"' + rec.SERIAL_BATCH_NUM + '\" {#XC_ST_COMMON_yjcz#}'\n        });\n    }\n    rec.CREATED_BY = '{#XIP.userId#}';\n    insertSql = \"INSERT INTO xc_st_wh_b_ser VALUES ('\"+rec.B_SERIAL_ID+\"','\"+rec.ORG_ID+\"','\"+rec.LEDGER_ID+\"','\"+rec.MATERIAL_ID+\"','\"+rec.SERIAL_BATCH+\"','\"+rec.SERIAL_BATCH_NUM+\"','\"+(Wb.isEmpty(rec.QTY) ? 0 : rec.QTY)+\"','\"+(Wb.isEmpty(rec.DELEVERED_QTY) ? 0 : rec.DELEVERED_QTY)+\"','\"+(Wb.isEmpty(rec.QTY) ? 0 : rec.QTY)+\"','\"+rec.BUSINESS_TYPE_ID+\"','\"+rec.BUSINESS_H_ID+\"','\"+rec.BUSINESS_L_ID+\"','\"+rec.B_LOCATION_ID+\"','\"+rec.LOCATION_ID+\"','\"+rec.PREFIX+\"','\"+rec.SUFFIX+\"',{?timestamp.sys.date?},'\"+rec.CREATED_BY+\"',{?timestamp.sys.date?},'\"+rec.CREATED_BY+\"')\";\n    app.run(insertSql,{});\n});\nrecsUpdate = Wb.decode(request.getParameter('update'));\nWb.each(recsUpdate,function(rec){\n    //同一个物料批次允许重复、序列号不允许重复\n    if(rec.SERIAL_BATCH == 'XLH'){\n        app.run(\"select 1 from xc_st_wh_b_ser where SERIAL_BATCH_NUM='\" + rec.SERIAL_BATCH_NUM + \"' and MATERIAL_ID = '\" + rec.MATERIAL_ID  + \"' and B_SERIAL_ID <> '\" + rec.B_SERIAL_ID + \"'\",{\n            errorText: '{#XC_ST_COMMON_gaiwlx#}{#XC_ST_COMMON_XLH#} \"' + rec.SERIAL_BATCH_NUM + '\" {#XC_ST_COMMON_yjcz#}'\n        });\n    }\n    rec.LAST_UPDATED_BY = '{#XIP.userId#}';\n    updateSql = \"UPDATE xc_st_wh_b_ser SET SERIAL_BATCH_NUM = '\"+rec.SERIAL_BATCH_NUM+\"',QTY = '\"+(Wb.isEmpty(rec.QTY) ? 0 : rec.QTY)+\"',DELEVERED_QTY = '\"+(Wb.isEmpty(rec.DELEVERED_QTY) ? 0 : rec.DELEVERED_QTY)+\"',SURPLUS_QTY = '\"+(Wb.isEmpty(rec.SURPLUS_QTY) ? 0 : rec.SURPLUS_QTY)+\"',LAST_UPDATE_DATE = {?timestamp.sys.date?},LAST_UPDATED_BY = '\"+rec.LAST_UPDATED_BY+\"' WHERE B_SERIAL_ID = '\"+rec.B_SERIAL_ID+\"'\";\n    app.run(updateSql,{});\n});","itemId":"module"},"children":[],"expanded":false,"type":"module"}],"pageLink":"","iconCls":""}