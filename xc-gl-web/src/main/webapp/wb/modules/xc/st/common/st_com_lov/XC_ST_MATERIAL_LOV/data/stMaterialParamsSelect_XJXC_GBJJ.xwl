{"inframe":false,"title":"选择物料信息查询（先进先出、个别计价）","hidden":false,"roles":{"default":1},"children":[{"configs":{"initScript":"var lang = request.getSession().getAttribute(\"XzSessionVars\").get('language');\nrequest.setAttribute(\"language\",lang);","loginRequired":"false","serverScript":"var sql,data = app.get();\nsql = ' WHERE 1 = 1';\nsql+=' AND swi.LEDGER_ID = {?LEDGER_ID?}';\nif (!Wb.isEmpty(data.MATERIAL_CODE_NAME)) {\n    sql+=' AND (sm.MATERIAL_CODE LIKE \"%'+data.MATERIAL_CODE_NAME+'%\" OR sm.MATERIAL_NAME LIKE \"%'+data.MATERIAL_CODE_NAME+'%\")';\n}\nif (!Wb.isEmpty(data.MATERIAL_TYPE_NAME)) {\n    sql+=' AND smt.MATERIAL_TYPE_NAME LIKE \"%'+data.MATERIAL_TYPE_NAME+'%\"';\n}\nif (!Wb.isEmpty(data.MATERIAL_PRO)) {\n    sql+=' AND sm.MATERIAL_PRO = {?MATERIAL_PRO?}';\n}\nif (!Wb.isEmpty(data.PURCHASE_SALE)) {\n    if(data.PURCHASE_SALE == 'PURCHASE')\n\t\tsql+=' AND smp.IS_PURCHASE = \"Y\"';\n    if(data.PURCHASE_SALE == 'SALE')\n\t\tsql+=' AND smp.IS_SALE = \"Y\"';\n}\nif (!Wb.isEmpty(data.WAREHOUSE_ID)) {\n    sql+=' AND swi.WAREHOUSE_ID = {?WAREHOUSE_ID?}';\n}\nif (!Wb.isEmpty(data.SERIAL_BATCH_NUM)) {\n    sql+=' AND swbs.SERIAL_BATCH_NUM LIKE \"%'+data.SERIAL_BATCH_NUM+'%\"';\n}\nif (!Wb.isEmpty(data.ENTRY_H_ID)) {\n    sql+=' AND swel.ENTRY_H_ID = {?ENTRY_H_ID?}';\n}\nrequest.setAttribute('sql', sql);","itemId":"module"},"children":[{"configs":{"oracle":"SELECT\n\tsm.MATERIAL_ID,\n\tsm.MATERIAL_CODE,\n\tsm.MATERIAL_NAME,\n\tsm.SPECIFICATION,\n\tgl.DIM_ID,\n\tgl.DIM_NAME,\n\tsmt.MATERIAL_TYPE_NAME,\n\tCONCAT(sm.MATERIAL_CODE,'/',sm.MATERIAL_NAME) MATERIAL_CODE_NAME,\n\t(SELECT\n       CASE WHEN l.VAL_NAME IS NULL OR l.VAL_NAME = '' THEN d.VAL_NAME ELSE l.VAL_NAME END DESCRIPTION\n     FROM\n       xip_pub_val_set_dtl d\n     LEFT JOIN XIP_PUB_VAL_SET_DTL_LANG l ON d.VAL_SET_CODE = l.VAL_SET_CODE\n     AND d.VAL_CODE = l.VAL_CODE\n     AND l.VAL_SET_LANG = '{#language#}'\n     WHERE\n       d.VAL_SET_CODE = 'XC_ST_MATERIAL_PROPERTY'\n     AND d.ENABLE_FLAG = 'Y'\n     AND d.VAL_CODE = sm.MATERIAL_PRO) AS MATERIAL_PRO_NAME,\n\tswbs.SERIAL_BATCH_NUM,\n\tswbs.B_SERIAL_ID,\n\tDECODE(swbs.SERIAL_BATCH_NUM,IS NULL,swi.QTY,(NVL(swbs.QTY,0) - NVL(swbs.DELEVERED_QTY,0))) \"XCSL\",\n    DECODE(swbs.SERIAL_BATCH_NUM,IS NULL,swi.QTY,(NVL(swbs.QTY,0) - NVL(swbs.DELEVERED_QTY,0))) / swi.QTY * swi.AMOUNT \"JCCB\",\n\tsweh.ENTRY_H_CODE,\n\tsweh.BIZ_DATE,\n\tswel.ENTRY_L_CODE,\n\tswi.ENTRY_H_ID,\n\tswi.ENTRY_L_ID\nFROM\n\txc_st_wh_inventory swi\nLEFT JOIN xc_st_material sm ON swi.MATERIAL_ID = sm.MATERIAL_ID\nLEFT JOIN xc_st_material_parms smp ON (smp.MATERIAL_ID = sm.MATERIAL_ID AND swi.LEDGER_ID = smp.LEDGER_ID)\nLEFT JOIN xc_st_material_type smt ON sm.MATERIAL_TYPE_ID = smt.MATERIAL_TYPE_ID\nLEFT JOIN xc_gl_dimensions gl ON sm.DIM_ID = gl.DIM_ID\nLEFT JOIN xc_st_wh_entry_h sweh ON swi.ENTRY_H_ID = sweh.ENTRY_H_ID\nLEFT JOIN xc_st_wh_entry_l swel ON swi.ENTRY_L_ID = swel.ENTRY_L_ID\nLEFT JOIN xc_st_wh_b_ser swbs ON (swi.ENTRY_H_ID = swbs.BUSINESS_H_ID AND swi.ENTRY_L_ID = swbs.BUSINESS_L_ID AND swi.MATERIAL_ID = swbs.MATERIAL_ID)\n{#sql#}\nAND DECODE(swbs.SERIAL_BATCH_NUM,IS NULL,swi.QTY,(NVL(swbs.QTY,0) - NVL(swbs.DELEVERED_QTY,0))) > 0 \nORDER BY swi.CREATION_DATE,swbs.CREATION_DATE,sm.MATERIAL_CODE,swbs.SERIAL_BATCH_NUM,swel.ENTRY_L_CODE","itemId":"sqlswitcher1","mysql":"SELECT\n\tsm.MATERIAL_ID,\n\tsm.MATERIAL_CODE,\n\tsm.MATERIAL_NAME,\n\tsm.SPECIFICATION,\n\tgl.DIM_ID,\n\tgl.DIM_NAME,\n\tsmt.MATERIAL_TYPE_NAME,\n\tCONCAT(sm.MATERIAL_CODE,'/',sm.MATERIAL_NAME) MATERIAL_CODE_NAME,\n\t(SELECT\n       CASE WHEN l.VAL_NAME IS NULL OR l.VAL_NAME = '' THEN d.VAL_NAME ELSE l.VAL_NAME END DESCRIPTION\n     FROM\n       xip_pub_val_set_dtl d\n     LEFT JOIN XIP_PUB_VAL_SET_DTL_LANG l ON d.VAL_SET_CODE = l.VAL_SET_CODE\n     AND d.VAL_CODE = l.VAL_CODE\n     AND l.VAL_SET_LANG = '{#language#}'\n     WHERE\n       d.VAL_SET_CODE = 'XC_ST_MATERIAL_PROPERTY'\n     AND d.ENABLE_FLAG = 'Y'\n     AND d.VAL_CODE = sm.MATERIAL_PRO) AS MATERIAL_PRO_NAME,\n\tswbs.SERIAL_BATCH_NUM,\n\tswbs.B_SERIAL_ID,\n\tIF(swbs.SERIAL_BATCH_NUM IS NULL,swi.QTY,(IFNULL(swbs.QTY,0) - IFNULL(swbs.DELEVERED_QTY,0))) \"XCSL\",\n    IF(swbs.SERIAL_BATCH_NUM IS NULL,swi.QTY,(IFNULL(swbs.QTY,0) - IFNULL(swbs.DELEVERED_QTY,0))) / swi.QTY * swi.AMOUNT \"JCCB\",\n\tsweh.ENTRY_H_CODE,\n\tsweh.BIZ_DATE,\n\tswel.ENTRY_L_CODE,\n\tswi.ENTRY_H_ID,\n\tswi.ENTRY_L_ID,\n\tswel.ORDER_L_ID,\n\tswel.NOTICE_L_ID\nFROM\n\txc_st_wh_inventory swi\nLEFT JOIN xc_st_material sm ON swi.MATERIAL_ID = sm.MATERIAL_ID\nLEFT JOIN xc_st_material_parms smp ON (smp.MATERIAL_ID = sm.MATERIAL_ID AND swi.LEDGER_ID = smp.LEDGER_ID)\nLEFT JOIN xc_st_material_type smt ON sm.MATERIAL_TYPE_ID = smt.MATERIAL_TYPE_ID\nLEFT JOIN xc_gl_dimensions gl ON sm.DIM_ID = gl.DIM_ID\nLEFT JOIN xc_st_wh_entry_h sweh ON swi.ENTRY_H_ID = sweh.ENTRY_H_ID\nLEFT JOIN xc_st_wh_entry_l swel ON swi.ENTRY_L_ID = swel.ENTRY_L_ID\nLEFT JOIN xc_st_wh_b_ser swbs ON (swi.MATERIAL_ID = swbs.MATERIAL_ID AND swi.ENTRY_H_ID = swbs.BUSINESS_H_ID AND swi.ENTRY_L_ID = swbs.BUSINESS_L_ID)\n{#sql#}\nAND IF(swbs.SERIAL_BATCH_NUM IS NULL,swi.QTY,(IFNULL(swbs.QTY,0) - IFNULL(swbs.DELEVERED_QTY,0))) > 0 \nORDER BY swi.CREATION_DATE,swbs.CREATION_DATE,sm.MATERIAL_CODE,swbs.SERIAL_BATCH_NUM,swel.ENTRY_L_CODE"},"children":[],"expanded":false,"type":"sqlswitcher"},{"configs":{"sql":"{#sqlswitcher1#}","itemId":"dataprovider1"},"children":[],"expanded":false,"type":"dataprovider"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}