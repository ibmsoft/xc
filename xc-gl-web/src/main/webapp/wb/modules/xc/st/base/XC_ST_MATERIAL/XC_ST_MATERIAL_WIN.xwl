{"inframe":false,"title":"物料编码维护窗口","hidden":false,"roles":{"default":1},"children":[{"configs":{"loginRequired":"false","serverScript":"//---------------------获取当前模块语言对应的.json文件，放到request中----------------\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xc/st/base/XC_ST_MATERIAL/json/XC_ST_MATERIAL\");\nvar contextPath = request.getContextPath();\nrequest.setAttribute(\"contextPath\",contextPath);","itemId":"module"},"events":{"initialize":"Wb.isInsert = 'Add';\nvar MATERIAL_ID = null;\nExt.apply(app, {\n    initWin: function(params) {\n        Ext.apply(app, params);\n        app.editWinN = new Ext.window.Window(app.editWinN);\n        app.editWinN.show();\n        Wb.isInsert = params.IS_INSERT;\n        MATERIAL_ID = params.MATERIAL_ID;\n        if (Wb.isInsert == 'Add') {//新增操作\n            app.MATERIAL_ID.setValue(Xip.getId());\n            app.MATERIAL_TYPE_ID.setValue(params.MATERIAL_TYPE_ID);\n            app.MATERIAL_TYPE_NAME.setValue(params.MATERIAL_TYPE_NAME);\n            app.MAT_TYPE_SET_ID.setValue(params.MAT_TYPE_SET_ID);\n            app.MAT_TYPE_SET_NAME.setValue(params.MAT_TYPE_SET_NAME);\n            app.editWinN.setTitle('{#XC_ST_MATERIAL_bottomAddBtn#}{#XC_ST_MATERIAL_MATERIAL#}');\n            app.editWinN.setIconCls('file_add_icon');\n        }\n        if (Wb.isInsert == 'Update') {//修改操作\n            Wb.request({\n                url : 'm?xwl=xc/st/common/data/stMaterialSelect',\n                params : {MATERIAL_ID : MATERIAL_ID},\n                async : false,\n                success : function(resp){\n                    Wb.request({\n                        url : 'm?xwl=xc/st/base/XC_ST_MATERIAL/data/stMaterialParamsSelectByMaterialId',\n                        params : {MATERIAL_ID : MATERIAL_ID},\n                        async : false,\n                        success : function(r){\n                            var rs = Wb.decode(r.responseText);\n                            if(rs.total > 0){\n                                app.MATERIAL_PRO_NAME.setReadOnly(true);\n                                app.DIM_NAME.setReadOnly(true);\n                                app.MATERIAL_TYPE_NAME.setReadOnly(true);\n                            }\n                        }\n                    });\n                    var rec = Wb.decode(resp.responseText).rows[0];\n                    setRadioValue(rec);\n                    app.IMAGE.setSrc(rec.IMAGES);\n                    Wb.setValue(app.editWinN,rec);\n                    setSomeReadOnly(true);\n                }\n            });\n            app.editWinN.setTitle('{#XC_ST_MATERIAL_bottomEditBtn#}{#XC_ST_MATERIAL_MATERIAL#}');\n            app.editWinN.setIconCls('file_edit_icon');\n        }\n        if (Wb.isInsert == 'Seek') {//查看操作\n        }\n    }\n});\n//给每个单选按钮对应的赋值\nfunction setComponentValue(){\n    //是否启用批次管理：\n\tif(app.IS_BATCH_CHCEK.getValue() === true)\n        app.IS_BATCH.setValue('Y');\n\tif(app.IS_BATCH_CHCEK.getValue() === false)\n        app.IS_BATCH.setValue('N');\n    //是否启用序列号管理：\n    if(app.IS_SERIAL_CHCEK.getValue() === true)\n        app.IS_SERIAL.setValue('Y');\n    if(app.IS_SERIAL_CHCEK.getValue() === false)\n        app.IS_SERIAL.setValue('N');\n    //是否可采购：\n    if(app.IS_PURCHASE_CHCEK.getValue() === true)\n        app.IS_PURCHASE.setValue('Y');\n    if(app.IS_PURCHASE_CHCEK.getValue() === false)\n        app.IS_PURCHASE.setValue('N');\n    //是否允许超量接收：\n    if(app.IS_PURCHASE_EXCESS_CHCEK.getValue() === true)\n        app.IS_PURCHASE_EXCESS.setValue('Y');\n    if(app.IS_PURCHASE_EXCESS_CHCEK.getValue() === false)\n        app.IS_PURCHASE_EXCESS.setValue('N');\n    //是否可销售：\n    if(app.IS_SALE_CHCEK.getValue() === true)\n        app.IS_SALE.setValue('Y');\n    if(app.IS_SALE_CHCEK.getValue() === false)\n        app.IS_SALE.setValue('N');\n    //是否允许超量发货：\n    if(app.IS_SALE_EXCESS_CHCEK.getValue() === true)\n        app.IS_SALE_EXCESS.setValue('Y');\n    if(app.IS_SALE_EXCESS_CHCEK.getValue() === false)\n        app.IS_SALE_EXCESS.setValue('N');\n}\n//给单选按钮赋值\nfunction setRadioValue(rec){\n    if(rec.IS_BATCH == 'Y')\n        app.IS_BATCH_CHCEK.setValue(true);\n    else\n        app.IS_BATCH_CHCEK.setValue(false);\n    if(rec.IS_SERIAL == 'Y')\n        app.IS_SERIAL_CHCEK.setValue(true);\n    else\n        app.IS_SERIAL_CHCEK.setValue(false);\n    if(rec.IS_PURCHASE == 'Y')\n        app.IS_PURCHASE_CHCEK.setValue(true);\n    else\n        app.IS_PURCHASE_CHCEK.setValue(false);\n    if(rec.IS_PURCHASE_EXCESS == 'Y')\n        app.IS_PURCHASE_EXCESS_CHCEK.setValue(true);\n    else\n        app.IS_PURCHASE_EXCESS_CHCEK.setValue(false);\n    if(rec.IS_SALE == 'Y')\n        app.IS_SALE_CHCEK.setValue(true);\n    else\n        app.IS_SALE_CHCEK.setValue(false);\n    if(rec.IS_SALE_EXCESS == 'Y')\n        app.IS_SALE_EXCESS_CHCEK.setValue(true);\n    else\n        app.IS_SALE_EXCESS_CHCEK.setValue(false);\n}\nfunction setSomeReadOnly(flag){\n    app.MATERIAL_CODE.setReadOnly(flag);\n}"},"children":[{"configs":{"height":"400","width":"900","layout":"absolute","resizable":"false","closeAction":"hide","buttonAlign":"center","border":"false","itemId":"editWinN","modal":"true"},"events":{"hide":"app.hideFun();"},"children":[{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"{#XC_ST_MATERIAL_saveButton#}","itemId":"okButton","iconCls":"save_icon"},"events":{"click":"/*--------------  验证数据是否合法  ---------------*/\nsetComponentValue();\nif (Wb.verify(app.editWinN)) {\n    Wb.request({\n        url : '{#contextPath#}'+'/xcStMaterialAction.do?method=saveOrUpdateStMaterial',\n        params : {'stMaterialInfo' : Wb.encode(Wb.getValue(app.editWinN)),opType : Wb.isInsert},\n        success : function(resp){\n            var record = Wb.decode(resp.responseText);\n            var msg = record.msg;\n            if(record.flag === '0'){\n                Wb.isInsert = 'Update';\n                Wb.toast('{#XC_ST_MATERIAL_wlxxbccg#}');\n                setSomeReadOnly(true);\n            }\n            else{\n                Wb.toast(msg);\n            }\n        }\n    });\n} else {\n    Wb.toast('{#XC_ST_MATERIAL_qsrsybsx#}');\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#XC_ST_MATERIAL_cancelBtn#}","itemId":"cancelButton","iconCls":"cancel_icon"},"events":{"click":"app.editWinN.hide();"},"children":[],"expanded":true,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"title":"{#XC_ST_MATERIAL_set_1Title#}","height":"180","frame":"true","autoScroll":"true","layout":"form","width":"530","margin":"10","border":"true","itemId":"set_1","y":"30","x":"10"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"column","margin":"5 0 0 0","itemId":"row1","border":"false"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","columnWidth":".5","itemId":"row1_1","border":"false"},"children":[{"configs":{"labelWidth":"100","allowBlank":"false","columnWidth":".5","labelAlign":"right","itemId":"MATERIAL_CODE","fieldLabel":"<font color='red'>*<\/font>{#XC_ST_MATERIAL_MATERIAL_CODE#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","columnWidth":".5","itemId":"row1_2","border":"false"},"children":[{"configs":{"labelWidth":"100","allowBlank":"false","columnWidth":".5","labelAlign":"right","itemId":"MATERIAL_NAME","fieldLabel":"<font color='red'>*<\/font>{#XC_ST_MATERIAL_MATERIAL_NAME#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"column","itemId":"row2","border":"false"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","columnWidth":".5","itemId":"row2_1","border":"false"},"children":[{"configs":{"labelWidth":"100","readOnly":"true","labelAlign":"right","itemId":"MAT_TYPE_SET_NAME","fieldLabel":"<font color='red'>*<\/font>{#XC_ST_MATERIAL_MAT_TYPE_SET_NAME#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".5","itemId":"row2_2","border":"false"},"children":[{"configs":{"labelWidth":"100","allowBlank":"false","displayField":"MATERIAL_TYPE_NAME","valueField":"MATERIAL_TYPE_NAME","labelAlign":"right","itemId":"MATERIAL_TYPE_NAME","fieldLabel":"<font color='red'>*<\/font>{#XC_ST_MATERIAL_bottomPanelTitle#}","editable":"false"},"events":{"select":"app.MATERIAL_TYPE_ID.setValue(records[0].data.MATERIAL_TYPE_ID);"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/st/base/XC_ST_MATERIAL_TYPE/data/stMaterialTypeSelect"},"events":{"beforeload":"store.proxy.extraParams.MAT_TYPE_SET_ID = app.MAT_TYPE_SET_ID.getValue();\nstore.proxy.extraParams.FINAL = \"FINAL\";"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"column","itemId":"row3","border":"false"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".5","itemId":"row3_1","border":"false"},"children":[{"configs":{"labelWidth":"100","allowBlank":"false","displayField":"VAL_NAME","valueField":"VAL_CODE","labelAlign":"right","itemId":"MATERIAL_PRO_NAME","fieldLabel":"<font color='red'>*<\/font>{#XC_ST_MATERIAL_MATERIAL_PRO#}","editable":"false"},"events":{"select":"app.MATERIAL_PRO.setValue(records[0].data.VAL_CODE);"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/st/base/XC_ST_MATERIAL/data/stMaterialPropertySelect"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".5","itemId":"row3_2","border":"false"},"children":[{"configs":{"labelWidth":"100","allowBlank":"false","displayField":"AP_PUR_TYPE_NAME","valueField":"AP_PUR_TYPE_NAME","labelAlign":"right","itemId":"AP_PUR_TYPE_NAME","fieldLabel":"<font color='red'>*<\/font>{#XC_ST_MATERIAL_AP_PUR_TYPE_NAME#}","editable":"false"},"events":{"select":"app.FINACE_TYPE_ID.setValue(records[0].data.AP_PUR_TYPE_ID);"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/st/common/data/apPurTypeSelect"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"column","itemId":"row4","border":"false"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".5","itemId":"row4_1","border":"false"},"children":[{"configs":{"labelWidth":"100","labelAlign":"right","itemId":"SPECIFICATION","fieldLabel":"{#XC_ST_MATERIAL_SPECIFICATION#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".5","itemId":"row4_2","border":"false"},"children":[{"configs":{"labelWidth":"100","allowBlank":"false","displayField":"DIM_NAME","valueField":"DIM_NAME","labelAlign":"right","itemId":"DIM_NAME","fieldLabel":"<font color='red'>*<\/font>{#XC_ST_MATERIAL_DIM_NAME#}","editable":"false"},"events":{"select":"app.DIM_ID.setValue(records[0].data.DIM_ID);"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/st/common/data/dimensionSelect"},"children":[],"expanded":false,"type":"store"}],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"fieldset"},{"configs":{"title":"{#XC_ST_MATERIAL_set_2Title#}","height":"100","frame":"true","layout":"form","width":"530","margin":"10","border":"true","itemId":"set_2","y":"225","x":"10"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"column","itemId":"row5","border":"false"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","columnWidth":".5","itemId":"row5_1","border":"false"},"children":[{"configs":{"labelWidth":"120","labelAlign":"right","itemId":"IS_BATCH_CHCEK","fieldLabel":"{#XC_ST_MATERIAL_IS_BATCH#}"},"events":{"change":"if(newValue === true){\n    app.IS_SERIAL_CHCEK.reset();\n    app.IS_SERIAL.reset();\n}"},"children":[],"expanded":false,"type":"check"}],"expanded":false,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","columnWidth":".5","itemId":"row5_2","border":"false"},"children":[{"configs":{"labelWidth":"120","labelAlign":"right","itemId":"IS_SERIAL_CHCEK","fieldLabel":"{#XC_ST_MATERIAL_IS_SERIAL#}"},"events":{"change":"if(newValue === true){\n    app.IS_BATCH_CHCEK.reset();\n    app.IS_BATCH.reset();\n}"},"children":[],"expanded":false,"type":"check"}],"expanded":false,"type":"panel"}],"expanded":false,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"column","itemId":"row6","border":"false"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","columnWidth":".5","itemId":"row6_1","border":"false"},"children":[{"configs":{"labelWidth":"120","labelAlign":"right","itemId":"IS_PURCHASE_CHCEK","fieldLabel":"{#XC_ST_MATERIAL_IS_PURCHASE#}"},"children":[],"expanded":false,"type":"check"}],"expanded":false,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","columnWidth":".5","itemId":"row6_2","border":"false"},"children":[{"configs":{"labelWidth":"120","labelAlign":"right","itemId":"IS_SALE_CHCEK","fieldLabel":"{#XC_ST_MATERIAL_IS_SALE#}"},"children":[],"expanded":false,"type":"check"}],"expanded":false,"type":"panel"}],"expanded":false,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","hidden":"true","layout":"column","itemId":"row7","border":"false"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","columnWidth":".5","itemId":"row7_1","border":"false"},"children":[{"configs":{"labelWidth":"120","labelAlign":"right","itemId":"IS_PURCHASE_EXCESS_CHCEK","fieldLabel":"{#XC_ST_MATERIAL_IS_PURCHASE_EXCESS#}"},"children":[],"expanded":false,"type":"check"}],"expanded":false,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","columnWidth":".5","itemId":"row7_2","border":"false"},"children":[{"configs":{"labelWidth":"120","labelAlign":"right","itemId":"IS_SALE_EXCESS_CHCEK","fieldLabel":"{#XC_ST_MATERIAL_IS_SALE_EXCESS#}"},"children":[],"expanded":false,"type":"check"}],"expanded":false,"type":"panel"}],"expanded":false,"type":"panel"}],"expanded":true,"type":"fieldset"},{"configs":{"title":"{#XC_ST_MATERIAL_picturePanel#}","height":"310","width":"322","layout":"absolute","border":"false","itemId":"picturePanel","y":"35","x":"560"},"children":[{"configs":{"title":"{#XC_ST_MATERIAL_picturePanel#}","height":"250","width":"304","itemId":"IMAGE","x":"8"},"children":[],"expanded":false,"type":"image"},{"configs":{"height":"22","width":"240","itemId":"selectFile","y":"260","x":"0"},"events":{"change":"var input = file.fileInputEl.dom,reader;\nif(input.files && input.files[0]) {\n    reader = app.IMAGE.imgReader||new FileReader();\n    if(!app.IMAGE.imgReader){\n        app.IMAGE.imgReader = reader;\n        reader.onload = function (e) {\n            app.IMAGE.setSrc(e.target.result);\n            app.IMAGES.setValue(e.target.result);\n        };\n    }\n    reader.readAsDataURL(input.files[0]);\n}"},"children":[],"expanded":false,"type":"file"}],"expanded":false,"type":"panel"},{"configs":{"height":"0","frame":"false","hidden":"true","width":"0","layout":"column","border":"false","itemId":"hidePanel","y":"0","x":"0"},"children":[{"configs":{"hidden":"true","itemId":"MATERIAL_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"IS_SALE_EXCESS"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"IS_SALE"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"IS_PURCHASE_EXCESS"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"IS_PURCHASE"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"IS_SERIAL"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"IS_BATCH"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"MATERIAL_SET_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"MATERIAL_TYPE_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"MAT_TYPE_SET_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"FINACE_TYPE_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"DIM_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"SALE_TYPE_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"MATERIAL_PRO"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"IMAGES"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"100","readOnly":"true","height":"24","width":"240","labelAlign":"right","itemId":"PURCHASE_PRICE","fieldLabel":"预计采购价格","y":"40","x":"-10"},"children":[],"expanded":false,"type":"number"},{"configs":{"labelWidth":"100","readOnly":"true","height":"24","width":"240","labelAlign":"right","itemId":"SALE_PRICE","fieldLabel":"预计销售价格","y":"40","x":"-10"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"window"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}