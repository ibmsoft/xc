{"inframe":false,"title":"出库入库主表查询","hidden":false,"roles":{"default":1},"children":[{"configs":{"loginRequired":"false","serverScript":"var sql,data = app.get();\nsql = ' WHERE 1 = 1';\nsql+=' AND T.LEDGER_ID = {?LEDGER_ID?}';\nsql+=' AND T.WAREHOUSE_NAME = {?WAREHOUSE_NAME?}';\n\nif (!Wb.isEmpty(data.ST_CAT_NAME)) {\n    sql+=' AND T.ST_CAT_NAME LIKE \"%'+data.ST_CAT_NAME+'%\"';\n}\nif (!Wb.isEmpty(data.DOC_CODE)) {\n    sql+=' AND (T.DOC_CODE LIKE \"%'+data.DOC_CODE+'%\" OR T.DOC_NAME LIKE \"%'+data.DOC_CODE+'%\")';\n}\nif (!Wb.isEmpty(data.BUSINESS_TYPE_NAME)) {\n    sql+=' AND T.BUSINESS_TYPE_NAME LIKE \"%'+data.BUSINESS_TYPE_NAME+'%\"';\n}\nif (!Wb.isEmpty(data.BIZ_DATE_START)) {\n    if (!Wb.isEmpty(data.BIZ_DATE_END)) \n        sql+=' and T.BIZ_DATE BETWEEN {?BIZ_DATE_START?} and {?BIZ_DATE_END?} ';\n    else\n        sql+=' and T.BIZ_DATE >= {?BIZ_DATE_START?}';\n}\nelse{\n    if (!Wb.isEmpty(data.BIZ_DATE_END))\n        sql+=' and T.BIZ_DATE <= {?BIZ_DATE_END?}';\n}\nif (!Wb.isEmpty(data.STATUS)) {\n    if(data.STATUS != 'ALL')\n        sql+=' and T.STATUS={?STATUS?}';\n}\nif (!Wb.isEmpty(data.WAREHOUSE_KEPPER)) {\n    sql+=' AND T.EMP_NAME LIKE \"%'+data.WAREHOUSE_KEPPER+'%\"';\n}\nif (!Wb.isEmpty(data.DEPT_NAME)) {\n    sql+=' AND T.DEPT_NAME LIKE \"%'+data.DEPT_NAME+'%\"';\n}\nif (!Wb.isEmpty(data.PROJECT_NAME)) {\n    sql+=' AND T.PROJECT_NAME LIKE \"%'+data.PROJECT_NAME+'%\"';\n}\nif (!Wb.isEmpty(data.MATERIAL)) {\n    sql+=' AND T.MATERIAL_NAME LIKE \"%'+data.MATERIAL+'%\"';\n}\nrequest.setAttribute('sql', sql);","itemId":"module"},"children":[{"configs":{"sql":"SELECT * FROM (\n    SELECT\n        sweh.LEDGER_ID \"LEDGER_ID\",\n        sweh.ENTRY_H_ID \"DOC_ID\",\n        sweh.ENTRY_H_CODE \"DOC_CODE\",\n        sweh.ENTRY_H_NAME \"DOC_NAME\",\n        sweh.BIZ_DATE \"BIZ_DATE\",\n        sweh.STATUS \"STATUS\",\n        sbt.BUSINESS_TYPE_NAME,\n        sdc.ST_CAT_CODE,\n        sdc.ST_CAT_NAME,\n        sw.WAREHOUSE_NAME,\n        (SELECT pe.EMP_NAME FROM xip_pub_emps pe,xip_pub_users pu WHERE pe.EMP_ID = pu.EMP_ID AND pu.USER_ID = sweh.CREATED_BY) AS \"EMP_NAME\",\n        (SELECT pe.EMP_NAME FROM xip_pub_emps pe,xip_pub_users pu WHERE pe.EMP_ID = pu.EMP_ID AND pu.USER_ID = sweh.BUYER_ID) AS \"SALESMAN\",\n        pd.DEPT_NAME,\n        pp.PROJECT_NAME,\n        SUM(swdl.QTY) AS \"CKSL\",\n        SUM(swel.QTY) AS \"RKSL\",\n        GROUP_CONCAT(sm.MATERIAL_NAME ORDER BY sm.MATERIAL_CODE) AS \"MATERIAL_NAME\"\n    FROM\n        xc_st_wh_entry_h sweh\n    LEFT JOIN xc_st_business_type sbt ON sweh.BUSINESS_TYPE_ID = sbt.BUSINESS_TYPE_ID\n    LEFT JOIN xc_st_doc_cats sdc ON sweh.DOC_CAT_CODE = sdc.ST_CAT_CODE\n    LEFT JOIN xc_st_warehouse sw ON sweh.WAREHOUSE_ID = sw.WAREHOUSE_ID\n    LEFT JOIN xip_pub_depts pd ON sweh.DEPT_ID = pd.DEPT_ID\n    LEFT JOIN xc_pm_projects pp ON sweh.PROJECT_ID = pp.PROJECT_ID\n    LEFT JOIN xc_st_wh_entry_l swel ON sweh.ENTRY_H_ID = swel.ENTRY_H_ID\n    LEFT JOIN xc_st_material sm ON swel.MATERIAL_ID = sm.MATERIAL_ID\n    LEFT JOIN xc_st_wh_delevered_l swdl ON (swel.ENTRY_L_ID = swdl.ENTRY_L_ID AND swdl.MATERIAL_ID = swel.MATERIAL_ID = sm.MATERIAL_ID)\n    GROUP BY sweh.ENTRY_H_ID\n\n    UNION\n\n    SELECT\n        swdh.LEDGER_ID \"LEDGER_ID\",\n        swdh.DELEVERED_H_ID \"DOC_ID\",\n        swdh.DELEVERED_H_CODE \"DOC_CODE\",\n        swdh.DELEVERED_H_NAME \"DOC_NAME\",\n        swdh.BIZ_DATE \"BIZ_DATE\",\n        swdh.STATUS \"STATUS\",\n        sbt.BUSINESS_TYPE_NAME,\n        sdc.ST_CAT_CODE,\n        sdc.ST_CAT_NAME,\n        sw.WAREHOUSE_NAME,\n        (SELECT pe.EMP_NAME FROM xip_pub_emps pe,xip_pub_users pu WHERE pe.EMP_ID = pu.EMP_ID AND pu.USER_ID = swdh.CREATED_BY) AS \"EMP_NAME\",\n        (SELECT pe.EMP_NAME FROM xip_pub_emps pe,xip_pub_users pu WHERE pe.EMP_ID = pu.EMP_ID AND pu.USER_ID = swdh.BUYER_ID) AS \"SALESMAN\",\n        pd.DEPT_NAME,\n        pp.PROJECT_NAME,\n        SUM(swdl.QTY) AS \"CKSL\",\n        SUM(swel.QTY) AS \"RKSL\",\n        GROUP_CONCAT(sm.MATERIAL_NAME ORDER BY sm.MATERIAL_CODE) AS \"MATERIAL_NAME\"\n    FROM\n        xc_st_wh_delevered_h swdh\n    LEFT JOIN xc_st_business_type sbt ON swdh.BUSINESS_TYPE_ID = sbt.BUSINESS_TYPE_ID\n    LEFT JOIN xc_st_doc_cats sdc ON swdh.DOC_CAT_CODE = sdc.ST_CAT_CODE\n    LEFT JOIN xc_st_warehouse sw ON swdh.WAREHOUSE_ID = sw.WAREHOUSE_ID\n    LEFT JOIN xip_pub_depts pd ON swdh.DEPT_ID = pd.DEPT_ID\n    LEFT JOIN xc_pm_projects pp ON swdh.PROJECT_ID = pp.PROJECT_ID\n    LEFT JOIN xc_st_wh_delevered_l swdl ON swdh.DELEVERED_H_ID = swdl.DELEVERED_H_ID\n    LEFT JOIN xc_st_material sm ON swdl.MATERIAL_ID = sm.MATERIAL_ID\n    LEFT JOIN xc_st_wh_entry_l swel ON (swdl.ENTRY_L_ID = swel.ENTRY_L_ID AND swel.MATERIAL_ID = swdl.MATERIAL_ID = sm.MATERIAL_ID)\n    GROUP BY swdh.DELEVERED_H_ID\n) T\n{#sql#}\nORDER BY T.DOC_CODE DESC","itemId":"dataprovider1"},"children":[],"expanded":false,"type":"dataprovider"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}