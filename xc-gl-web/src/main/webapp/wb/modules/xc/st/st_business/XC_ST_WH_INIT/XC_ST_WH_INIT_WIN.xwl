{"inframe":false,"title":"","hidden":false,"roles":{"default":1},"children":[{"configs":{"loginRequired":"false","serverScript":"//---------------------获取当前模块语言对应的.json文件，放到request中----------------\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xc/st/st_business/XC_ST_WH_ENTRY/json/XC_ST_WH_ENTRY\");\nvar ctxPath = request.getContextPath() ;\nrequest.setAttribute('contextPath',ctxPath);","itemId":"module"},"events":{"finalize":"var tableValue = '';//窗口中的所有信息\nvar isEditCol = 'N';//判断是否更新过行信息","initialize":"Wb.isInsert = null;\nvar ENTRY_H_ID = null;\nvar stDocCatCode = null;\nvar VALUATION_MODEL = null;\nExt.apply(app, {\n    initWin: function(params) {\n        Ext.apply(app, params);\n        app.editWinN = new Ext.window.Window(app.editWinN);\n        app.editWinN.show();\n        Wb.isInsert = params.IS_INSERT;\n        ENTRY_H_ID = params.ENTRY_H_ID;\n        stDocCatCode = params.stDocCatCode;\n        app.DEPT_ID_XWL.DEPT_NAME.setFieldLabel('<font color=\"red\">*<\/font>{#XC_ST_WH_ENTRY_YWBM#}');\n        app.grid1.store.load({params : {ENTRY_H_ID : ENTRY_H_ID}});\n        if(stDocCatCode == 'QTRK'){\n            app.title.setText('{#XC_ST_WH_ENTRY_qtrkd#}',false);\n        }\n        if (Wb.isInsert == 'Add') {//新增操作\n            app.ENTRY_H_ID.setValue(ENTRY_H_ID);\n            app.LEDGER_ID.setValue(params.LEDGER_ID);\n            app.ORG_ID.setValue(params.ORG_ID);\n            app.ORG_NAME.setValue(params.ORG_NAME);\n            app.WAREHOUSE_ID.setValue(params.WAREHOUSE_ID);\n            app.WAREHOUSE_NAME.setValue(params.WAREHOUSE_NAME);\n            setQtyOrAmtStyle(params.WAREHOUSE_ID);\n          \n            app.STATUS.setValue('1');\n            app.DOC_CAT_CODE.setValue(stDocCatCode);\n            app.IS_CREATE.setValue('Y');\n            app.EMP_NAME.setValue('{#XIP.empName#}');\n            app.WH_KEEPER_ID.setValue('{#XIP.userId#}');\n          \n            setMinDate(app.LEDGER_ID.getValue());\n            setOrg(app.ORG_ID.getValue(),app.LEDGER_ID.getValue());\n            setDeptInfo(app.ORG_ID.getValue());\n            app.BUSINESS_TYPE_NAME.getStore().load();\n        }\n        if (Wb.isInsert == 'Update') {//修改操作\n            app.IS_CREATE.setValue('N');\n            Wb.request({\n                url : 'm?xwl=xc/st/st_business/XC_ST_WH_ENTRY/data/stWhEntryHSelectById',\n                params : {ENTRY_H_ID : ENTRY_H_ID},\n                async : false,\n                success : function(resp){\n                    var rec = Wb.decode(resp.responseText).rows[0];\n                    setQtyOrAmtStyle(rec.WAREHOUSE_ID);\n                    if(rec.STATUS !== '1')\n                        setAllReadOnly(true);\n                    else{\n                        setOrg(rec.ORG_ID,rec.LEDGER_ID);\n                        returnRowFn(rec,'xip_pub_depts');\n                    }\n                    rec.BIZ_DATE = Wb.strToDate(rec.BIZ_DATE);\n                    Wb.setValue(app.editWinN,rec);\n                    tableValue = Wb.encode(Wb.getValue(app.form1));\n                }\n            });\n        }\n        if (Wb.isInsert == 'Seek') {//查看操作\n            Wb.request({\n                url : 'm?xwl=xc/st/st_business/XC_ST_WH_ENTRY/data/stWhEntryHSelectById',\n                params : {ENTRY_H_ID : ENTRY_H_ID},\n                async : false,\n                success : function(resp){\n                    var rec = Wb.decode(resp.responseText).rows[0];\n                    rec.BIZ_DATE = Wb.strToDate(rec.BIZ_DATE);\n                    setQtyOrAmtStyle(rec.WAREHOUSE_ID);\n                    setAllReadOnly(true);\n                    Wb.setValue(app.editWinN,rec);\n                }\n            });\n            setButtonHide();\n        }\n    }\n});\nfunction returnRowFn(r,type){\n    //选择项目带回成本中心\n    if(type == 'xc_pm_projects') {\n        app.DEPT_ID_XWL.DEPT_ID.setValue(r.data.DEPT_ID);\n        app.DEPT_ID_XWL.DEPT_NAME.setValue(r.data.DEPT_NAME);\n    }\n    //选择成本中心为项目查询的成本中心赋值\n    if(type == 'xip_pub_depts') {\n        if(r.data === undefined)\n            app.PROJECT_ID_XWL.QUERY_DEPT_ID.setValue(r.DEPT_ID);\n        else\n            app.PROJECT_ID_XWL.QUERY_DEPT_ID.setValue(r.data.DEPT_ID);\n    }\n}\nfunction clearOtherFn(type){\n    //清空成本中心同时清空项目查询条件里的成本中心\n    if(type == 'xip_pub_depts') {\n        app.PROJECT_ID_XWL.QUERY_DEPT_ID.setValue('');\n    }\n}\nfunction setAllReadOnly(flag){\n    app.ENTRY_H_NAME.setReadOnly(flag);\n    app.DEPT_ID_XWL.DEPT_NAME.setReadOnly(flag);\n    app.BUSINESS_TYPE_NAME.setReadOnly(true);\n    app.PROJECT_ID_XWL.PROJECT_NAME.setReadOnly(flag);\n    app.BIZ_DATE.setReadOnly(flag);\n    app.QTY_COL.getEditor().setReadOnly(flag);\n    app.PRICE_COL.getEditor().setReadOnly(flag);\n    app.AMOUNT_COL.getEditor().setReadOnly(flag);\n    app.LOCATION_NAME_COL.getEditor().setReadOnly(flag);\n    app.saveBtn.setDisabled(flag);\n    app.signBtn.setDisabled(flag);\n    app.addBtn.setDisabled(flag);\n    app.delBtns.setDisabled(flag);\n}\nfunction setButtonHide(){\n    app.saveBtn.hide();\n    app.signBtn.hide();\n    app.cancelSignBtn.hide();\n    app.enclosureBtn.hide();\n    app.grid1Tbar.hide();\n}\nfunction setOrg(orgId,ledgerId) {\n    app.DEPT_ID_XWL.QUERY_LEDGER_ID.setValue(ledgerId);\n    app.PROJECT_ID_XWL.QUERY_LEDGER_ID.setValue(ledgerId);\n}\nfunction clearAll(){\n\tapp.DEPT_ID_XWL.DEPT_NAME.reset();\n\tapp.DEPT_ID_XWL.DEPT_ID.reset();\n    app.PROJECT_ID_XWL.PROJECT_ID.reset();\n    app.PROJECT_ID_XWL.PROJECT_NAME.reset();\n    app.PROJECT_ID_XWL.QUERY_DEPT_ID.reset();\n    clearCommon();\n}\nfunction clearCommon(){\n    app.grid1.store.removeAll();\n}\nfunction setMinDate(ledgerId){\n    Wb.request({//账簿会计期查询\n        url : 'm?xwl=xc/st/common/data/ledgerDateSelect',\n        params : {LEDGER_ID : ledgerId},\n        success : function(resp){\n            var temp = Wb.decode(resp.responseText);\n            if(temp.rows[0].LAST_END_DATE !== null && temp.rows[0].LAST_END_DATE !== \"\"){\n                app.BIZ_DATE.setValue(Wb.strToDate(temp.rows[0].LAST_END_DATE));\n            }\n            else {\n                if(app.LEDGER_ID.getValue() !== null && app.LEDGER_ID.getValue() !== \"\"){\n                    Wb.toast('{#XC_ST_WH_ENTRY_gzbmyqykjqqcxxz#}');//该账簿没有启用会计期，请重新选择！\n                    app.BIZ_DATE.reset();\n                    app.BIZ_DATE.setReadOnly(true);\n                }\n            }\n        }\n    });\n}\nfunction setDeptInfo(orgId){\n    Wb.request({\n        url : 'm?xwl=xc/ar/ct/data/selectDeptInfoByUserId',\n        params : {USER_ID : '{#XIP.userId#}',ORG_ID : orgId},\n        success : function(resp){\n            var temp = Wb.decode(resp.responseText);\n            app.DEPT_ID_XWL.DEPT_ID.setValue(temp.DEPT_ID);\n            app.DEPT_ID_XWL.DEPT_NAME.setValue(temp.DEPT_NAME);\n            app.PROJECT_ID_XWL.QUERY_DEPT_ID.setValue(temp.DEPT_ID);\n        }\n    });\n}\n//通过改变仓库来控制单价和金额是否可录入\nfunction setQtyOrAmtStyle(WAREHOUSE_ID){\n    Wb.request({\n        url : 'm?xwl=xc/st/ld_base/XC_ST_WAREHOUSE/data/stWarehouseSelect',\n        params : {WAREHOUSE_IDS : WAREHOUSE_ID,ALL : 'ALL'},\n        async : false,\n        success : function(resp){\n            var res = Wb.decode(resp.responseText);\n            if(res.total > 0){\n                VALUATION_MODEL = res.rows[0].VALUATION_MODEL;\n                if(VALUATION_MODEL == 'FJZK'){//非价值库不用录入单价和金额\n                    for(var i = 0;i < app.grid1.store.getCount();i++){\n                        var data = app.grid1.store.getAt(i);\n                        data.set('PRICE',null);\n                        data.set('AMOUNT',null);\n                    }\n                    app.PRICE_COL.getEditor().setReadOnly(true);\n                    app.AMOUNT_COL.getEditor().setReadOnly(true);\n                    app.PRICE_COL.setText('{#XC_ST_WH_ENTRY_PRICE#}');\n                    app.AMOUNT_COL.setText('{#XC_ST_WH_ENTRY_AMOUNT#}');\n                    app.PRICE_COL.getEditor().allowBlank = true;\n                    app.AMOUNT_COL.getEditor().allowBlank = true;\n                }\n                else{\n                    app.PRICE_COL.getEditor().setReadOnly(false);\n                    app.AMOUNT_COL.getEditor().setReadOnly(false);\n                    app.PRICE_COL.setText('<font color=\"red\">*<\/font>{#XC_ST_WH_ENTRY_PRICE#}');\n                    app.AMOUNT_COL.setText('<font color=\"red\">*<\/font>{#XC_ST_WH_ENTRY_AMOUNT#}');\n                    app.PRICE_COL.getEditor().allowBlank = false;\n                    app.AMOUNT_COL.getEditor().allowBlank = false;\n                }\n                //通过仓库是否启用货位，来控制行信息的货位是否为必填\n                if(res.rows[0].IS_LOCATION == 'Y'){//启用货位管理\n                    app.LOCATION_NAME_COL.getEditor().setReadOnly(false);\n                    app.LOCATION_NAME_COL.getEditor().allowBlank = false;\n                    app.LOCATION_NAME_COL.setText('<font color=\"red\">*<\/font>{#XC_ST_WH_ENTRY_LOCATION#}');\n                }\n                else{\n                    app.LOCATION_NAME_COL.getEditor().setReadOnly(true);\n                    app.LOCATION_NAME_COL.getEditor().allowBlank = true;\n                    app.LOCATION_NAME_COL.setText('{#XC_ST_WH_ENTRY_LOCATION#}');\n                }\n            }\n        }\n    });\n}"},"children":[{"configs":{"itemId":"tools"},"children":[{"configs":{"itemId":"orgInitStore","url":"m?xwl=xc/com-lov/ORG_PICK/DB/ORG_SELECT_BY_LEDGER"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"folder"},{"configs":{"maximized":"true","height":"530","layout":"border","width":"900","closeAction":"hide","itemId":"editWinN","border":"false","modal":"true","maximizable":"true"},"events":{"hide":"app.hideFun();"},"children":[{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"{#XC_ST_WH_ENTRY_saveBtn#}","itemId":"saveBtn","iconCls":"save_icon"},"events":{"click":"/*--------------  验证数据是否合法  ---------------*/\nif (Wb.verify(app.editWinN) && Wb.verifyGrid(app.grid1)) {\n    //判断是否有明细\n    var store = app.grid1.store;\n    if(store.getCount() === 0){\n        Wb.toast('{#XC_ST_WH_ENTRY_qtjmxsj#}');//请添加明细数据！\n        return;\n    }\n    //通过明细算出主表中的金额值\n    var AMOUNT = 0;\n    for (var i = 0; i < app.grid1.getStore().getCount(); i++) {\n        var r = app.grid1.getStore().getAt(i);\n        AMOUNT = AMOUNT + r.get('AMOUNT');\n    }\n    app.AMOUNT.setValue(AMOUNT);\n    Wb.sync({\n        url : '{#contextPath#}'+'/xcStDocsAction.do?method=saveOrUpdateXcStDocs',\n        grid : app.grid1,\n        params  : Wb.getValue(app.form1),\n        success : function(resp){\n            var record = Wb.decode(resp.responseText);\n            var msg = record.msg;\n            if(record.flag === '0'){\n                Wb.isInsert = 'Update';\n                Wb.toast('{#XC_ST_WH_ENTRY_bccg#}');//保存成功！\n                app.ENTRY_H_CODE.setValue(record.docCode);\n                app.grid1.store.load({params : {ENTRY_H_ID : ENTRY_H_ID}});\n                app.IS_CREATE.setValue('N');\n                tableValue = Wb.encode(Wb.getValue(app.form1));\n                isEditCol = 'N';\n            }\n            else{\n                Wb.toast(msg);//保存失败！\n            }\n        }\n    });\n} else {\n    Wb.verifyGrid(app.grid1);\n    Wb.toast('{#XC_ST_WH_ENTRY_qsrsybsx#}');//请输入所有必输项！\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#XC_ST_WH_ENTRY_signBtn#}","itemId":"signBtn","iconCls":"write_icon"},"events":{"click":"if(Wb.isInsert=='Add' || tableValue !== Wb.encode(Wb.getValue(app.form1)) || isEditCol == 'Y'){\n    Wb.toast('{#XC_ST_WH_ENTRY_qxbczjz#}');//请先保存，再记账！\n    return false;\n}\nif(app.INIT.getValue() != '0'){\n    Wb.toast('{#XC_ST_WH_ENTRY_sxdjyjjzcg#}');//所选单据已经记账成功！\n    return;\n}\nWb.request({\n    url : '{#contextPath#}' + '/xcStDocsAction.do?method=accountOrCancelAccount',\n    params: Wb.apply({stDocId : app.ENTRY_H_ID.getValue(),opType : '1'}),\n    success: function(resp) {\n        var record = Wb.decode(resp.responseText);\n        if(record.flag == '0'){\n            Wb.toast('{#XC_ST_WH_ENTRY_jzcg#}');//记账成功！\n            setAllReadOnly(true);\n            app.STATUS.setValue('3');\n            app.INIT.setValue('1');\n            tableValue = Wb.encode(Wb.getValue(app.form1));\n        }\n        else\n            Wb.toast(record.msg);\n    }\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#XC_ST_WH_ENTRY_cancelSignBtn#}","itemId":"cancelSignBtn","iconCls":"cancel_icon"},"events":{"click":"if(app.INIT.getValue() != '1'){\n    Wb.toast('{#XC_ST_WH_ENTRY_qxjzqqxjz#}');//请先记账，再取消记账！\n    return false;\n}\nWb.request({\n    url : '{#contextPath#}' + '/xcStDocsAction.do?method=accountOrCancelAccount',\n    params: Wb.apply({stDocId : app.ENTRY_H_ID.getValue(),opType : '0'}),\n    success: function(resp) {\n        var record = Wb.decode(resp.responseText);\n        if(record.flag == '0'){\n            Wb.toast('{#XC_ST_WH_ENTRY_qxjzcg#}');//记账成功！\n            setAllReadOnly(false);\n            app.STATUS.setValue('1');\n            app.INIT.setValue('0');\n            tableValue = Wb.encode(Wb.getValue(app.form1));\n        }\n        else\n            Wb.toast(record.msg);\n    }\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#XC_ST_WH_ENTRY_enclosureBtn#}","itemId":"enclosureBtn","iconCls":"attach_icon"},"events":{"click":"if(Wb.isInsert == 'Add'){\n    Wb.toast('{#XC_ST_WH_ENTRY_qxbcztjfj#}');//请先保存，再添加附件！\n    return false;\n}\nvar temp_id = app.ENTRY_H_ID.getValue();\nvar temp_code = app.ENTRY_H_CODE.getValue();\nWb.request({\n    url : '{#contextPath#}' + '/xcStCommonAction.do?method=getXcStAttCatCode',\n    params : {LEDGER_ID : app.LEDGER_ID.getValue(),DOC_CAT_CODE : app.DOC_CAT_CODE.getValue()},\n    success : function(resp){\n        var temp = Wb.decode(resp.responseText);\n        if(temp.flag == '0'){\n            var attCatCode = temp.attCatCode;\n            Xip.showAttachmentManager('{#XIP.userId#}',temp_id,'',attCatCode,temp_code,'Y','Y','Y',function(){},10); \n        }\n        else{\n            Wb.toast(temp.msg);\n        }\n    }\n});"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"array"},{"configs":{"region":"north","frame":"false","itemId":"form1","bodyPadding":"0 0 0 0","border":"false"},"children":[{"configs":{"style":"fontSize:20px","html":"<font style=\"\">采购入库<\/font>","margin":"10 0 20 0","labelAlign":"center","itemId":"title"},"children":[],"expanded":false,"type":"label"},{"configs":{"frame":"false","layout":"column","margin":"5 0 0 0","itemId":"tr_1","border":"false"},"children":[{"configs":{"frame":"false","style":"border-width:0px","layout":"form","columnWidth":".249","itemId":"td_1_1","border":"false"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"ORG_NAME","fieldLabel":"组织"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"frame":"false","style":"border-width:0px","layout":"form","columnWidth":".249","itemId":"td_1_2","border":"false"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"WAREHOUSE_NAME","fieldLabel":"{#XC_ST_WH_ENTRY_WAREHOUSE#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"frame":"false","style":"border-width:0px","layout":"form","columnWidth":".249","itemId":"td_1_3","border":"false"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"ENTRY_H_CODE","fieldLabel":"{#XC_ST_WH_ENTRY_ENTRY_H_CODE#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"frame":"false","style":"border-width:0px","layout":"form","columnWidth":".249","itemId":"td_1_4","border":"false"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","allowBlank":"false","labelAlign":"right","itemId":"BIZ_DATE","fieldLabel":"<font color='red'>*<\/font>{#XC_ST_WH_ENTRY_BIZ_DATE#}"},"children":[],"expanded":false,"type":"date"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"frame":"false","layout":"column","margin":"5 0 0 0","itemId":"tr_2","border":"false"},"children":[{"configs":{"frame":"false","style":"border-width:0px","layout":"form","columnWidth":".249","itemId":"td_2_2","border":"false"},"children":[{"configs":{"labelWidth":"80","allowBlank":"false","displayField":"BUSINESS_TYPE_NAME","valueField":"BUSINESS_TYPE_NAME","labelAlign":"right","itemId":"BUSINESS_TYPE_NAME","fieldLabel":"<font color='red'>*<\/font>{#XC_ST_WH_ENTRY_BUSINESS_TYPE_NAME#}","editable":"false"},"events":{"select":"app.BUSINESS_TYPE_ID.setValue(records[0].data.BUSINESS_TYPE_ID);"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/st/ld_base/XC_ST_LD_BUSINESS_TYPE/data/stLdBusinessTypeSelect"},"events":{"load":"if(store.getCount() > 0){\n    app.BUSINESS_TYPE_NAME.setValue(store.getAt(0).get('BUSINESS_TYPE_NAME'));\n    app.BUSINESS_TYPE_ID.setValue(store.getAt(0).get('BUSINESS_TYPE_ID'));\n}","beforeload":"store.proxy.extraParams.LEDGER_ID = app.LEDGER_ID.getValue();\nstore.proxy.extraParams.DOC_CAT_CODE = app.DOC_CAT_CODE.getValue();"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"frame":"false","style":"border-width:0px","layout":"form","columnWidth":".249","itemId":"td_2_3","border":"false"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/DEPT_ID_PICK/DEPT_ID_LD","itemId":"DEPT_ID_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"frame":"false","style":"border-width:0px","layout":"form","columnWidth":".249","itemId":"td_2_4","border":"false"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/PROJECT_ID_PICK/PROJECT_ID_LD","itemId":"PROJECT_ID_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"frame":"false","layout":"column","margin":"5 0 5 0","itemId":"tr_3","border":"false"},"children":[{"configs":{"frame":"false","style":"border-width:0px","layout":"form","columnWidth":".498","itemId":"td_3_1","border":"false"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"ENTRY_H_NAME","fieldLabel":"{#XC_ST_WH_ENTRY_ENTRY_H_NAME#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"frame":"false","style":"border-width:0px","layout":"form","columnWidth":".249","itemId":"td_3_2","border":"false"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"EMP_NAME","fieldLabel":"{#XC_ST_WH_ENTRY_EMP_NAME#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"frame":"false","style":"border-width:0px","layout":"form","columnWidth":".249","itemId":"td_3_3","border":"false"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","pickList":"[['1','{#XC_ST_WH_ENTRY_STATUS_1#}'],['2','{#XC_ST_WH_ENTRY_STATUS_2#}'],['3','{#XC_ST_WH_ENTRY_STATUS_3#}']]","labelAlign":"right","itemId":"STATUS","fieldLabel":"{#XC_ST_WH_ENTRY_STATUS#}"},"children":[],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"frame":"false","hidden":"true","layout":"column","itemId":"hidePanel","border":"false"},"children":[{"configs":{"itemId":"ORG_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"LEDGER_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"ENTRY_H_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"BUSINESS_TYPE_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"DOC_CAT_CODE"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"AMOUNT"},"children":[],"expanded":false,"type":"number"},{"configs":{"hidden":"true","itemId":"NOTICE_H_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"ORDER_H_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"AP_CONTRACT_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"VENDOR_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"WH_KEEPER_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"WAREHOUSE_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"RE_WH_ENTRY_H_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"BUYER_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","value":"0","itemId":"INIT"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"IS_CREATE"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","value":"RKD","itemId":"docClassCode"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"form"},{"configs":{"region":"center","multiSelect":"true","selType":"checkboxmodel","itemId":"grid1","editable":"true"},"events":{"tagEvents":"'cellclick' : function(grid1,td,cellIndex,record,tr,rowIndex,e,eOpts){\n    //序列号窗口\n    if(cellIndex == 11){\n        if(!Wb.isEmpty(grid1.store.getModifiedRecords())){\n        \tWb.toast('{#XC_ST_WH_ENTRY_qxbcdjhxx#}');//请先保存单据行信息，在添加序列号/批次！\n            return;\n        }\n        Wb.run({\n            url: 'm?xwl=xc/st/common/st_com_lov/XC_ST_WH_B_SER/XC_ST_WH_B_SER', \n            success: function(apps) {\n                apps.initWin({\n                    BUSINESS_L_ID : record.data.ENTRY_L_ID,\n                    BUSINESS_H_ID : app.ENTRY_H_ID.getValue(),\n                    ORG_ID : app.ORG_ID.getValue(),\n                    LEDGER_ID : app.LEDGER_ID.getValue(),\n                    MATERIAL_ID : record.data.MATERIAL_ID,\n                    LOCATION_ID : record.data.LOCATION_ID,\n                    LOCATION_NAME : record.data.LOCATION_NAME,\n                    QTY : record.data.QTY,\n                    STATUS : app.STATUS.getValue(),\n                    DOC_CAT_CODE : app.DOC_CAT_CODE.getValue(),\n                    BUSINESS_TYPE_ID : app.BUSINESS_TYPE_ID.getValue(),\n                    opType : Wb.isInsert,\n                    hideFun : function(rs){\n                    }\n                });\n            }\n        });\n    }\n}"},"children":[{"configs":{"normalName":"grid1Tbar","itemId":"tbar"},"children":[{"configs":{"text":"{#XC_ST_WH_ENTRY_addLBtn#}","itemId":"addBtn","iconCls":"file_add_icon"},"events":{"click":"Wb.run({\n    url: 'm?xwl=xc/st/common/st_com_lov/XC_ST_MATERIAL_LOV/XC_ST_MATERIAL_LOV', \n    success: function(apps) {\n        apps.initWin({\n            LEDGER_ID : app.LEDGER_ID.getValue(),\n            ORG_ID : app.ORG_ID.getValue(),\n            Different : \"QCWL\",\n            hideFun : function(rs){\n                Wb.each(rs, function(r) {\n                    app.grid1.getStore().removeAll();\n                    r.set('ENTRY_L_ID',Xip.getId());\n                    r.set('ENTRY_H_ID',app.ENTRY_H_ID.getValue());\n                    Wb.add(app.grid1, {\n                        ENTRY_L_ID : r.get('ENTRY_L_ID'),\n                        ENTRY_H_ID : r.get('ENTRY_H_ID'),\n                        MATERIAL_ID : r.get('MATERIAL_ID'),\n                        QTY : 1,\n                        SPECIFICATION : r.get('SPECIFICATION'),\n                        MATERIAL_CODE : r.get('MATERIAL_CODE'),\n                        MATERIAL_NAME : r.get('MATERIAL_NAME'),\n                        ENTRY_L_CODE : app.grid1.store.getCount()+1,\n                        DIM_ID : r.get('DIM_ID'),\n                        DIM_NAME : r.get('DIM_NAME'),\n                        ORG_ID : app.ORG_ID.getValue(),\n                        LEDGER_ID : app.LEDGER_ID.getValue(),\n                        BUSINESS_TYPE_ID : app.BUSINESS_TYPE_ID.getValue(),\n                        DOC_CAT_CODE : app.DOC_CAT_CODE.getValue(),\n                        COEFFICIENT : 1\n                      },'after', 1, false);\n                });\n            }\n        });\n    }\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#XC_ST_WH_ENTRY_delLBtn#}","itemId":"delBtns","iconCls":"file_delete_icon"},"events":{"click":"//删除原则，先将选中记录在表格中移除，点击主单保存时，才真正从数据库删除。\nvar recs = app.grid1.getSelection();\nif (!recs.length) {\n    Wb.toast('{#XC_ST_WH_ENTRY_qxzxyscdjl#}');//请选择需要删除的记录！\n    return;\n}\nWb.confirm('{#XC_ST_WH_ENTRY_qdyscxzd#} ' + recs.length + ' {#XC_ST_WH_ENTRY_tjlm#}',function() {//'确定要删除选择的' + recs.length + '条记录吗？'\n\tWb.remove(app.grid1,recs);\n});"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"store","url":"m?xwl=xc/st/st_business/XC_ST_WH_ENTRY/data/stWhEntryLSelect"},"events":{"update":"isEditCol = 'Y';","remove":"isEditCol = 'Y';","add":"isEditCol = 'Y';"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"ENTRY_L_ID","hidden":"true","dataIndex":"ENTRY_L_ID","titleAlign":"center","itemId":"ENTRY_L_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"ENTRY_H_ID","hidden":"true","dataIndex":"ENTRY_H_ID","titleAlign":"center","itemId":"ENTRY_H_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"<font color='red'>*<\/font>{#XC_ST_WH_ENTRY_MATERIAL_CODE#}","width":"120","dataIndex":"MATERIAL_CODE","titleAlign":"center","itemId":"MATERIAL_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"<font color='red'>*<\/font>{#XC_ST_WH_ENTRY_MATERIAL_NAME#}","width":"120","dataIndex":"MATERIAL_NAME","titleAlign":"center","itemId":"MATERIAL_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#XC_ST_WH_ENTRY_SPECIFICATION#}","width":"100","dataIndex":"SPECIFICATION","titleAlign":"center","itemId":"SPECIFICATION_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"<font color='red'>*<\/font>{#XC_ST_WH_ENTRY_QTY#}","align":"right","width":"100","dataIndex":"QTY","titleAlign":"center","itemId":"QTY_COL"},"children":[{"configs":{"decimalPrecision":"6","allowBlank":"false","itemId":"editor"},"events":{"change":"var r = app.grid1.getSelection()[0];\nif(VALUATION_MODEL != 'FJZK')\n    r.set('AMOUNT',r.data.PRICE * newValue);\nif(!Wb.isEmpty(r.data.RE_ENTRY_L_ID)){\n\tWb.request({\n    url : 'm?xwl=xc/st/st_business/XC_ST_WH_ENTRY/data/stWhEntryLSelect',\n        params : {ENTRY_L_ID : r.data.RE_ENTRY_L_ID},\n        success : function(resp){\n        var rec = Wb.decode(resp.responseText);\n            if(newValue < rec.rows[0].QTY * -1){\n                number.setValue(rec.rows[0].QTY * -1);\n            }\n        }\n    });\n}"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"column"},{"configs":{"text":"<font color='red'>*<\/font>{#XC_ST_WH_ENTRY_DIM_NAME#}","width":"80","dataIndex":"DIM_NAME","titleAlign":"center","itemId":"DIM_NAME_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"<font color='red'>*<\/font>{#XC_ST_WH_ENTRY_PRICE#}","width":"100","align":"right","dataIndex":"PRICE","format":"0,000.0000","titleAlign":"center","itemId":"PRICE_COL"},"children":[{"configs":{"decimalPrecision":"4","allowBlank":"false","minValue":"0","itemId":"editor"},"events":{"change":"var r = app.grid1.getSelection()[0];\nr.set('AMOUNT',r.data.QTY * newValue);"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"column"},{"configs":{"text":"<font color='red'>*<\/font>{#XC_ST_WH_ENTRY_AMOUNT#}","width":"100","align":"right","dataIndex":"AMOUNT","format":"0,000.0000","titleAlign":"center","itemId":"AMOUNT_COL"},"children":[{"configs":{"decimalPrecision":"4","allowBlank":"false","itemId":"editor"},"events":{"change":"var r = app.grid1.getSelection()[0];\nr.set('PRICE',newValue / r.data.QTY);\nif(!Wb.isEmpty(r.data.RE_ENTRY_L_ID)){\n\tWb.request({\n    url : 'm?xwl=xc/st/st_business/XC_ST_WH_ENTRY/data/stWhEntryLSelect',\n        params : {ENTRY_L_ID : r.data.RE_ENTRY_L_ID},\n        success : function(resp){\n        var rec = Wb.decode(resp.responseText);\n            if(newValue < rec.rows[0].AMOUNT * -1){\n                number.setValue(rec.rows[0].AMOUNT * -1);\n            }\n        }\n    });\n}"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"column"},{"configs":{"text":"{#XC_ST_WH_ENTRY_LOCATION#}","width":"100","dataIndex":"LOCATION_NAME","titleAlign":"center","itemId":"LOCATION_NAME_COL"},"children":[{"configs":{"displayField":"LOCATION_NAME","valueField":"LOCATION_NAME","itemId":"editor","editable":"false"},"events":{"change":"if(Wb.isEmpty(newValue)){\n    var rec = app.grid1.getSelection()[0];\n    rec.set(\"LOCATION_ID\",null);\n    rec.set(\"LOCATION_NAME\",null);\n}","select":"var rec = app.grid1.getSelection()[0];\nrec.set(\"LOCATION_ID\",records[0].data.LOCATION_ID);\nrec.set(\"LOCATION_NAME\",records[0].data.LOCATION_NAME);"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/st/common/data/stLocationSelect"},"events":{"beforeload":"store.proxy.extraParams.IS_LAST = 'IS_LAST';\nstore.proxy.extraParams.LEDGER_ID = app.LEDGER_ID.getValue();\nstore.proxy.extraParams.WAREHOUSE_ID = app.WAREHOUSE_ID.getValue();"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"}],"expanded":true,"type":"column"},{"configs":{"text":"{#XC_ST_WH_ENTRY_PCXLH#}","align":"center","width":"100","dataIndex":"record","titleAlign":"center","itemId":"B_SERIAL_ID_COL","renderer":"var str = \"<a href=\\\"javascript:void(0);\\\">{#XC_ST_WH_ENTRY_record#}<\/a>\";\nreturn str;"},"children":[],"expanded":true,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"window"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}