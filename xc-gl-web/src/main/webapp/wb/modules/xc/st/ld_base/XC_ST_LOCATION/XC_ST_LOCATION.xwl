{"inframe":false,"title":"货位管理","hidden":false,"roles":{"default":1},"children":[{"configs":{"loginRequired":"false","serverScript":"//---------------------获取当前模块语言对应的.json文件，放到request中----------------\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xc/st/ld_base/XC_ST_LOCATION/json/XC_ST_LOCATION\");","itemId":"module"},"events":{"finalize":"var LOCATION_ID = null;\nvar WAREHOUSE_ID = null;\nvar WAREHOUSE_NAME = null;\nvar UPPER_ID = null;\nvar LEVEL = null;\nvar upIdStr = '';","initialize":"function returnRowFn(r,type){\n    if(type==='xip_pub_orgs'){\n        app.WAREHOUSE_XWL.WAREHOUSE_ID.setValue(null);\n        app.WAREHOUSE_XWL.WAREHOUSE_NAME.setValue(null);\n        app.WAREHOUSE_XWL.QUERY_ORG_ID.setValue(r.data.ORG_ID);\n        app.WAREHOUSE_XWL.LEDGER_ID.setValue(r.data.LEDGER_ID);\n        app.WAREHOUSE_XWL.IS_LOCATION.setValue('Y');\n        clearOtherFn('xc_st_warehouse');\n    }\n    if(type==='xc_st_warehouse'){\n        WAREHOUSE_ID = r.data.WAREHOUSE_ID;\n        WAREHOUSE_NAME = r.data.WAREHOUSE_NAME;\n        UPPER_ID = 1;\n        upIdStr = '';\n        app.treeQueryBtn.fireEvent('click');\n        app.bottomQueryBtn.fireEvent('click');\n        app.tree.expandAll(function(){});\n    }\n}\nfunction clearOtherFn(type){\n    if(type=='xip_pub_orgs'){\n    }\n    if(type=='xc_st_warehouse'){\n        WAREHOUSE_ID = 1;\n        UPPER_ID = 1;\n        upIdStr = '';\n        app.treeQueryBtn.fireEvent('click');\n        app.bottomQueryBtn.fireEvent('click');\n    }\n}"},"children":[{"configs":{"itemId":"tools"},"children":[{"configs":{"itemId":"orgInitStore","autoLoad":"true","url":"m?xwl=xc/com-lov/ORG_PICK/DB/ORG_SELECT_BY_LEDGER"},"events":{"load":"if(store.getCount() > 0){\n    app.ORG_XWL.LEDGER_ID.setValue(store.getAt(0).get('LEDGER_ID'));\n    app.ORG_XWL.LEDGER_NAME.setValue(store.getAt(0).get('LEDGER_NAME'));\n    app.ORG_XWL.ORG_ID.setValue(store.getAt(0).get('ORG_ID'));\n    app.ORG_XWL.ORG_NAME.setValue(store.getAt(0).get('ORG_NAME'));\n    app.WAREHOUSE_XWL.QUERY_ORG_ID.setValue(store.getAt(0).get('ORG_ID'));\n    app.WAREHOUSE_XWL.LEDGER_ID.setValue(store.getAt(0).get('LEDGER_ID'));\n    app.WAREHOUSE_XWL.IS_LOCATION.setValue('Y');\n}"},"children":[],"expanded":false,"type":"store"},{"configs":{"height":"250","width":"300","layout":"column","closeAction":"hide","buttonAlign":"center","border":"false","itemId":"editWindow","modal":"true"},"children":[{"configs":{"itemId":"buttons"},"children":[{"configs":{"text":"{#XC_ST_LOCATION_saveBtn#}","itemId":"saveBtn","iconCls":"save_icon"},"events":{"click":"if(!Wb.verify(app.editWindow)){\n    Wb.toast('{#XC_ST_LOCATION_qsrsybsx#}');\n\treturn;\n}\nvar url = null;\nif(opType == 'Add'){\n    url = 'm?xwl=xc/st/ld_base/XC_ST_LOCATION/data/stLocationInsert';\n}\nif(opType == 'Update'){\n    url = 'm?xwl=xc/st/ld_base/XC_ST_LOCATION/data/stLocationUpdate';\n}\nWb.request({\n    url : url,\n    out : app.editWindow,\n    success : function(resp) {\n        Wb.toast('{#XC_ST_LOCATION_sjbccg#}');\n        app.editWindow.hide();\n\t\tapp.bottomQueryBtn.fireEvent('click');\n        app.treeQueryBtn.fireEvent('click');\n        app.tree.expandAll(function(){});\n    }\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#XC_ST_LOCATION_cancelBtn#}","itemId":"cancelBtn","iconCls":"cancel_icon"},"events":{"click":"app.editWindow.hide();"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"array"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","margin":"25 0 0 0","border":"false","itemId":"tr1"},"children":[{"configs":{"labelWidth":"100","hidden":"true","labelAlign":"right","itemId":"WAREHOUSE_ID","fieldLabel":"仓库ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"100","hidden":"true","labelAlign":"right","itemId":"LOCATION_ID","fieldLabel":"货位主键"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"100","hidden":"true","labelAlign":"right","itemId":"UPPER_ID","fieldLabel":"上级ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"100","allowBlank":"false","labelAlign":"right","itemId":"LOCATION_CODE","fieldLabel":"<font color='red'>*<\/font>{#XC_ST_LOCATION_LOCATION_CODE#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","margin":"5 0 0 0","border":"false","itemId":"tr2"},"children":[{"configs":{"labelWidth":"100","allowBlank":"false","labelAlign":"right","itemId":"LOCATION_NAME","fieldLabel":"<font color='red'>*<\/font>{#XC_ST_LOCATION_LOCATION_NAME#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","margin":"5 0 0 0","border":"false","itemId":"tr3"},"children":[{"configs":{"labelWidth":"100","readOnly":"true","labelAlign":"right","itemId":"UP_TYPE","fieldLabel":"{#XC_ST_LOCATION_UP_CODE#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","margin":"5 0 5 0","border":"false","itemId":"tr4"},"children":[{"configs":{"labelWidth":"100","allowBlank":"false","labelAlign":"right","pickList":"[['Y','{#XC_ST_LOCATION_Y#}'],['N','{#XC_ST_LOCATION_N#}']]","itemId":"STATUS","fieldLabel":"{#XC_ST_LOCATION_STATUS#}"},"children":[],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"}],"expanded":false,"type":"window"}],"expanded":true,"type":"folder"},{"configs":{"layout":"border","itemId":"viewport1"},"children":[{"configs":{"region":"north","layout":"form","itemId":"search_form"},"children":[{"configs":{"layout":"column","margin":"5 0 5 0","itemId":"row1","border":"false"},"children":[{"configs":{"layout":"form","columnWidth":".33","border":"false","itemId":"row1_1"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/ORG_PICK/ORG_ALL_PICK","itemId":"ORG_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".33","border":"false","itemId":"row1_2"},"children":[{"configs":{"file":"m?xwl=xc/st/common/st_com_lov/XC_ST_WAREHOUSE_LOV/XC_ST_WAREHOUSE_LOV","itemId":"WAREHOUSE_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"form"},{"configs":{"region":"center","title":"{#XC_ST_LOCATION_LOCATION#}","layout":"border","itemId":"bottomPanel","border":"false"},"children":[{"configs":{"region":"west","layout":"form","width":"280","itemId":"treePanel","border":"false"},"children":[{"configs":{"rootVisible":"false","root":"{id:'root',text:'root',expanded:true}","itemId":"tree","border":"false"},"events":{"itemclick":"LEVEL = record.data.LEVEL;\nUPPER_ID = record.data.id;\nupIdStr = '';\nif(record.data.parent_id != '1parent_id'){\n    var flag = true;\n    //cascadeby 遍历该节点下的所有节点（包括自己）\n    record.cascadeBy(function(node){\n        if(node.isLeaf()){\n            if(flag){\n                upIdStr += \"'\"+node.data.id+\"'\";\n                flag = false;\n            }\n            else{\n                upIdStr += \",'\"+node.data.id+\"'\";\n            }\n        }\n        else{\n            upIdStr += \"'\"+node.data.id+\"',\";\n        }\n    });\n    if(!Wb.isEmpty(upIdStr)){\n        upIdStr = \"IN (\"+upIdStr+\")\";\n    }\n}\napp.bottomQueryBtn.fireEvent('click');","tagEvents":"itemcontextmenu: function(view, record, item, index, event, options) {\n    event.preventDefault();\n    event.stopEvent();\n    var LOCATION_ID = record.get('id');\n    var UPPER_ID = record.get('parent_id');\n    var WAREHOUSE_ID = record.get('warehouse_id');\n    var LOCATION_CODE = record.get('code');\n    var LOCATION_NAME = record.get('text');\n    var UP_TYPE = record.get('UP_TYPE');\n    var leaf = record.get(\"leaf\");\n    var STATUS = record.get(\"STATUS\");\n    var nodemenu;\n    if(LOCATION_ID == '1') {\n        nodemenu = new Ext.menu.Menu({\n            items: [{\n                text: '{#XC_ST_LOCATION_add#}{#XC_ST_LOCATION_xjhw#}',//新增下级货位\n                iconCls: 'file_add_icon',\n                handler: function() {\n                    var win = new Ext.window.Window(app._editWindow);\n                    app.LOCATION_ID.setValue(Xip.getId());\n                    app.UPPER_ID.setValue(LOCATION_ID);\n                    app.WAREHOUSE_ID.setValue(WAREHOUSE_ID);\n                    app.UP_TYPE.setValue(LOCATION_NAME);\n                    app.STATUS.setValue('Y');\n                    opType = 'Add';\n                    win.setTitle('{#XC_ST_LOCATION_add#}[' + record.get('text') + ']{#XC_ST_LOCATION_xjhw#}');//新增下级货位\n                    win.show();\n                    win.setIconCls('file_add_icon');\n                }\n            }]\n        });\n        nodemenu.showAt(event.getPoint());\n    }\n    else{\n        //判断货位是否被引用\n        Wb.request({\n            url : 'm?xwl=xc/st/ld_base/XC_ST_LOCATION/data/stLocationIsUse',\n            params : {'LOCATION_ID': LOCATION_ID},\n            success : function(resp){\n                var temp = Wb.decode(resp.responseText);\n                if(temp.total > 0 && !Wb.isEmpty(temp.rows[0].LOCATION_ID)){\n                    nodemenu = new Ext.menu.Menu({\n                        items: [{\n                            text: '{#XC_ST_LOCATION_add#}{#XC_ST_LOCATION_tjhw#}',//新增同级货位\n                            iconCls: 'file_add_icon',\n                            handler: function() {\n                                var win = new Ext.window.Window(app._editWindow);\n                                app.LOCATION_ID.setValue(Xip.getId());\n                                app.UPPER_ID.setValue(UPPER_ID);\n                                app.WAREHOUSE_ID.setValue(WAREHOUSE_ID);\n                                app.UP_TYPE.setValue(UP_TYPE);\n                                app.UP_TYPE.setValue(Wb.isEmpty(UP_TYPE) ? WAREHOUSE_NAME : UP_TYPE);\n                                app.STATUS.setValue('Y');\n                                opType = 'Add';\n                                win.setTitle('{#XC_ST_LOCATION_add#}[' + record.get('text') + ']{#XC_ST_LOCATION_tjhw#}');\n                                win.show();\n                                win.setIconCls('file_add_icon');\n                            }\n                        },{\n                            text: '{#XC_ST_LOCATION_editLocation#}',\n                            iconCls: 'file_edit_icon',\n                            handler: function() {\n                                var win = new Ext.window.Window(app._editWindow); //app._win指向配置对象而非实例\n                                app.LOCATION_ID.setValue(LOCATION_ID);\n                                app.LOCATION_CODE.setValue(LOCATION_CODE);\n                                app.LOCATION_NAME.setValue(LOCATION_NAME);\n                                app.WAREHOUSE_ID.setValue(WAREHOUSE_ID);\n                                app.UP_TYPE.setValue(Wb.isEmpty(UP_TYPE) ? WAREHOUSE_NAME : UP_TYPE);\n                                app.UPPER_ID.setValue(UPPER_ID);\n                                app.STATUS.setValue(STATUS);\n                                opType = 'Update';\n                                Wb.setTitle(win, '{#XC_ST_LOCATION_editLocation#}[' + record.get('text') + ']');\n                                win.show();\n                                app.LOCATION_CODE.setReadOnly(true);\n                                win.setIconCls('file_edit_icon');\n                            }\n                        }]\n                    });\n                    nodemenu.showAt(event.getPoint());\n                }\n                else{\n                    nodemenu = new Ext.menu.Menu({\n                        items: [{\n                            text: '{#XC_ST_LOCATION_add#}{#XC_ST_LOCATION_tjhw#}',//新增同级货位\n                            iconCls: 'file_add_icon',\n                            handler: function() {\n                                var win = new Ext.window.Window(app._editWindow);\n                                app.LOCATION_ID.setValue(Xip.getId());\n                                app.UPPER_ID.setValue(UPPER_ID);\n                                app.WAREHOUSE_ID.setValue(WAREHOUSE_ID);\n                                app.UP_TYPE.setValue(Wb.isEmpty(UP_TYPE) ? WAREHOUSE_NAME : UP_TYPE);\n                                app.STATUS.setValue('Y');\n                                opType = 'Add';\n                                win.setTitle('{#XC_ST_LOCATION_add#}[' + record.get('text') + ']{#XC_ST_LOCATION_tjhw#}');\n                                win.show();\n                                win.setIconCls('file_add_icon');\n                            }\n                        },{\n                            text: '{#XC_ST_LOCATION_add#}{#XC_ST_LOCATION_xjhw#}',//新增下级货位\n                            iconCls: 'file_add_icon',\n                            handler: function() {\n                                var win = new Ext.window.Window(app._editWindow);\n                                app.LOCATION_ID.setValue(Xip.getId());\n                                app.UPPER_ID.setValue(LOCATION_ID);\n                                app.WAREHOUSE_ID.setValue(WAREHOUSE_ID);\n                                app.UP_TYPE.setValue(LOCATION_NAME);\n                                app.STATUS.setValue('Y');\n                                opType = 'Add';\n                                win.setTitle('{#XC_ST_LOCATION_add#}[' + record.get('text') + ']{#XC_ST_LOCATION_xjhw#}');//新增下级货位\n                                win.show();\n                                win.setIconCls('file_add_icon');\n                            }\n                        },{\n                            text: '{#XC_ST_LOCATION_editLocation#}',\n                            iconCls: 'file_edit_icon',\n                            handler: function() {\n                                var win = new Ext.window.Window(app._editWindow); //app._win指向配置对象而非实例\n                                app.LOCATION_ID.setValue(LOCATION_ID);\n                                app.LOCATION_CODE.setValue(LOCATION_CODE);\n                                app.LOCATION_NAME.setValue(LOCATION_NAME);\n                                app.WAREHOUSE_ID.setValue(WAREHOUSE_ID);\n                                app.UP_TYPE.setValue(Wb.isEmpty(UP_TYPE) ? WAREHOUSE_NAME : UP_TYPE);\n                                app.UPPER_ID.setValue(UPPER_ID);\n                                app.STATUS.setValue(STATUS);\n                                opType = 'Update';\n                                Wb.setTitle(win, '{#XC_ST_LOCATION_editLocation#}[' + record.get('text') + ']');\n                                win.show();\n                                app.LOCATION_CODE.setReadOnly(true);\n                                win.setIconCls('file_edit_icon');\n                            }\n                        },{\n                            text: '{#XC_ST_LOCATION_delete#}',\n                            iconCls: 'file_delete_icon',\n                            handler: function() {\n                                if (leaf === false) {\n                                    Wb.toast('{#XC_ST_LOCATION_LOCATION#} \"' + LOCATION_NAME + '\" {#XC_ST_LOCATION_czxjbnsc#}');\n                                    return false;\n                                }\n                                Wb.request({\n                                    url : 'm?xwl=xc/st/ld_base/XC_ST_LOCATION/data/stLocationIsUse',\n                                    params : {'LOCATION_ID': LOCATION_ID},\n                                    success : function(resp){\n\t\t\t\t\t\t\t\t\t\tvar temp = Wb.decode(resp.responseText);\n                                        if(temp.total > 0 && !Wb.isEmpty(temp.rows[0].LOCATION_ID)){\n                                            Wb.toast('{#XC_ST_LOCATION_LOCATION#} \"' + LOCATION_NAME + '\" {#XC_ST_LOCATION_yjbyybnsc#}');\n                                            return;\n                                        }\n                                        else{\n                                            Wb.confirm('{#XC_ST_LOCATION_qdyscxzd#} \"' + LOCATION_NAME + '\" {#XC_ST_LOCATION_tjlm#}',function() {\n                                                Wb.request({\n                                                    url: 'm?xwl=xc/st/ld_base/XC_ST_LOCATION/data/stLocationDelete',\n                                                    params: {'LOCATION_ID': LOCATION_ID,UPPER_ID : UPPER_ID},\n                                                    success: function() {\n                                                        Wb.toast('{#XC_ST_LOCATION_hwsccg#}');\n                                                        app.bottomQueryBtn.fireEvent('click');\n                                                        app.treeQueryBtn.fireEvent('click');\n                                                        app.tree.expandAll(function(){});\n                                                    }\n                                                });\n                                            });\n                                        }\n                                    }\n                                });\n                            }\n                        }]\n                    });\n                    nodemenu.showAt(event.getPoint());\n                }\n            }\n        });\n    }\n}"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/st/ld_base/XC_ST_LOCATION/data/stLocationTreeSelect"},"events":{"beforeload":"var node = operation.node;\noperation.params.parent_id = operation.node.get('id');\noperation.params.WAREHOUSE_ID = WAREHOUSE_ID;\nvar whereSql= ' AND 1 = 1';\nif(!Wb.isEmpty(WAREHOUSE_ID)){\n    if(node.isRoot()){\n        whereSql = \"UNION SELECT '1' AS 'id','' AS 'code',sw.WAREHOUSE_NAME 'text',sw.WAREHOUSE_ID AS 'warehouse_id','1' 'parent_id','' AS 'STATUS','false' AS 'leaf','' AS 'UP_TYPE' FROM xc_st_warehouse sw WHERE sw.WAREHOUSE_ID = '\"+WAREHOUSE_ID+\"'\";\n    }\n}\nstore.getProxy().extraParams.whereSql = whereSql;"},"children":[],"expanded":false,"type":"treestore"}],"expanded":true,"type":"tree"},{"configs":{"hidden":"true","itemId":"treeQueryBtn","iconCls":"seek_icon"},"events":{"click":"app.tree.store.load({parmas : {WAREHOUSE_ID : WAREHOUSE_ID}});"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"panel"},{"configs":{"region":"center","layout":"border","itemId":"bottomGridPanel","border":"false"},"children":[{"configs":{"region":"center","barExportAllButtons":"false","barExportButtons":"false","itemId":"bottomGrid"},"events":{"itemdblclick":"var win = new Ext.window.Window(app._editWindow); //app._win指向配置对象而非实例\napp.LOCATION_ID.setValue(record.data.LOCATION_ID);\napp.LOCATION_CODE.setValue(record.data.LOCATION_CODE);\napp.LOCATION_NAME.setValue(record.data.LOCATION_NAME);\napp.WAREHOUSE_ID.setValue(record.data.WAREHOUSE_ID);\napp.UP_TYPE.setValue(Wb.isEmpty(record.data.UP_CODE) ? WAREHOUSE_NAME : record.data.UP_CODE);\napp.UPPER_ID.setValue(record.data.UPPER_ID);\napp.STATUS.setValue(record.data.STATUS);\nopType = 'Update';\nWb.setTitle(win, '{#XC_ST_LOCATION_editLocation#}[' + record.get('LOCATION_NAME') + ']');\nwin.show();\napp.LOCATION_CODE.setReadOnly(true);\nwin.setIconCls('file_edit_icon');"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/st/common/data/stLocationSelect"},"events":{"load":"Wb.each(records, function(rec){\n    if(Wb.isEmpty(rec.data.UP_CODE))\n        rec.set('UP_CODE',WAREHOUSE_NAME);\n});\nstore.commitChanges();"},"children":[],"expanded":false,"type":"store"},{"configs":{"hidden":"true","itemId":"tbar"},"children":[{"configs":{"hidden":"true","itemId":"bottomQueryBtn","iconCls":"seek_icon"},"events":{"click":"app.bottomGrid.store.load({params : {upIdStr : upIdStr,WAREHOUSE_ID : WAREHOUSE_ID}});"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#XC_ST_LOCATION_NUMBER_COL#}","align":"center","width":"50","xtype":"rownumberer","titleAlign":"center","itemId":"NUMBER_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"ID","hidden":"true","dataIndex":"LOCATION_ID","titleAlign":"center","itemId":"LOCATION_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#XC_ST_LOCATION_LOCATION_CODE#}","width":"120","dataIndex":"LOCATION_CODE","titleAlign":"center","itemId":"LOCATION_CODE_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#XC_ST_LOCATION_LOCATION_NAME#}","width":"150","dataIndex":"LOCATION_NAME","titleAlign":"center","itemId":"LOCATION_NAME_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#XC_ST_LOCATION_LEVEL#}","hidden":"true","width":"80","dataIndex":"IS_LAST","titleAlign":"center","itemId":"LEVEL_COL","renderer":"if(value == 'Y')\n  return '{#XC_ST_LOCATION_YES#}';\nif(value == 'N')\n  return '{#XC_ST_LOCATION_NO#}';"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#XC_ST_LOCATION_STATUS#}","width":"80","dataIndex":"STATUS","titleAlign":"center","itemId":"STATUS_COL","renderer":"if(value == 'Y')\n  return '{#XC_ST_LOCATION_Y#}';\nif(value == 'N')\n  return '{#XC_ST_LOCATION_N#}';"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#XC_ST_LOCATION_UP_CODE#}","width":"100","dataIndex":"UP_CODE","titleAlign":"center","itemId":"UP_CODE_COL"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}