{"inframe":false,"title":"出库及退库管理窗口","hidden":false,"roles":{"default":1},"children":[{"configs":{"loginRequired":"false","serverScript":"//---------------------获取当前模块语言对应的.json文件，放到request中----------------\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xc/st/st_business/XC_ST_WH_DELEVERED/json/XC_ST_WH_DELEVERED\");\nvar ctxPath = request.getContextPath() ;\nrequest.setAttribute('contextPath',ctxPath);","itemId":"module"},"events":{"finalize":"var tableValue = '';//窗口中的所有信息\nvar isEditCol = 'N';//判断是否更新过行信息","initialize":"Wb.isInsert = null;\nvar DELEVERED_H_ID = null;\nvar LEDGER_ID = null,\nORG_ID = null,\nORG_NAME = null;\nvar stDocCatCode = null;\nvar VALUATION_MODEL = null;\nvar IS_LOCATION = null;\nvar gridCommon = null;\nvar PRICE_COL_COMMON = null,AMOUNT_COL_COMMON = null;\nExt.apply(app, {\n    initWin: function(params) {\n        Ext.apply(app, params);\n        app.win = new Ext.window.Window(app.editWinN);\n        app.win.show();\n        Wb.isInsert = params.IS_INSERT;\n        DELEVERED_H_ID = params.DELEVERED_H_ID;\n        stDocCatCode = params.stDocCatCode;\n        LEDGER_ID = params.LEDGER_ID;\n        ORG_ID = params.ORG_ID;\n        ORG_NAME = params.ORG_NAME;\n        RE_DELEVERED_H_ID = params.RE_DELEVERED_H_ID;\n        app.DEPT_ID_XWL.DEPT_NAME.setFieldLabel('<font color=\"red\">*<\/font>{#XC_ST_WH_DELEVERED_YWBM#}');\n        if(stDocCatCode == 'LYCK'){\n            app.title.setText('{#XC_ST_WH_DELEVERED_lyckd#}',false);\n            app.td_3_1.hide();\n            app.DELEVERED_H_XWL.RE_DELEVERED_H_CODE.allowBlank = true;\n            gridCommon = app.grid1;\n            PRICE_COL_COMMON = app.PRICE_COL;\n            AMOUNT_COL_COMMON = app.AMOUNT_COL;\n        }\n        if(stDocCatCode == 'LYTK'){\n            app.title.setText('<font style=\"color:red;\">{#XC_ST_WH_DELEVERED_lytkd#}<\/font>',false);\n            app.td_3_1.show();\n            app.addBtn.hide();\n            app.AMOUNT_COL_1.getEditor().setMaxValue(0);\n            app.USE_APPLY_XWL.USE_APPLY_H_CODE.setReadOnly(true);\n            gridCommon = app.grid2;\n            PRICE_COL_COMMON = app.PRICE_COL_1;\n            AMOUNT_COL_COMMON = app.AMOUNT_COL_1;\n            app.grid1.hide();\n            app.grid2.show();\n        }\n        gridCommon.store.load({params : {DELEVERED_H_ID : DELEVERED_H_ID}});\n        if (Wb.isInsert == 'Add') {//新增操作\n            app.DELEVERED_H_ID.setValue(DELEVERED_H_ID);\n            app.STATUS.setValue('1');\n            app.DOC_CAT_CODE.setValue(stDocCatCode);\n            app.BIZ_DATE.setValue(new Date());\n            app.IS_CREATE.setValue('Y');\n            app.EMP_NAME.setValue('{#XIP.empName#}');\n            app.WH_KEEPER_ID.setValue('{#XIP.userId#}');\n            app.WAREHOUSE_XWL.WAREHOUSE_ID.setValue(params.WAREHOUSE_ID);\n            app.WAREHOUSE_XWL.WAREHOUSE_NAME.setValue(params.WAREHOUSE_NAME);\n            app.orgInitStore.load();\n            if(!Wb.isEmpty(RE_DELEVERED_H_ID)){//回冲操作\n                setSomeReadOnly(true);\n                Wb.request({\n                    url : 'm?xwl=xc/st/st_business/XC_ST_WH_DELEVERED/data/stWhDeleveredHSelectById',\n                    params : {DELEVERED_H_ID : RE_DELEVERED_H_ID},\n                    async : false,\n                    success : function(resp){\n                        var rec = Wb.decode(resp.responseText).rows[0];\n                        app.DELEVERED_H_CODE.reset();\n                        app.DELEVERED_H_XWL.RE_DELEVERED_H_ID.setValue(rec.DELEVERED_H_ID);\n                        app.DELEVERED_H_XWL.RE_DELEVERED_H_CODE.setValue(rec.DELEVERED_H_CODE);\n                        setQtyOrAmtStyle(rec.WAREHOUSE_ID);\n                        setComponentValue(rec);\n                    }\n                });\n            }\n            else\n                setQtyOrAmtStyle(params.WAREHOUSE_ID);\n        }\n        if (Wb.isInsert == 'Update') {//修改操作\n            app.IS_CREATE.setValue('N');\n            Wb.request({\n                url : 'm?xwl=xc/st/st_business/XC_ST_WH_DELEVERED/data/stWhDeleveredHSelectById',\n                params : {DELEVERED_H_ID : DELEVERED_H_ID},\n                async : false,\n                success : function(resp){\n                    var rec = Wb.decode(resp.responseText).rows[0];\n                    setQtyOrAmtStyle(rec.WAREHOUSE_ID);\n                    if(rec.STATUS !== '1')\n                        setAllReadOnly(true);\n                    else{\n                        setSomeReadOnly(true);\n                        setOrg(rec.ORG_ID,rec.LEDGER_ID);\n                        setMinDate(rec.LEDGER_ID);\n                        returnRowFn(rec,'xip_pub_depts');\n                    }\n                    rec.BIZ_DATE = Wb.strToDate(rec.BIZ_DATE);\n                    Wb.setValue(app.editWinN,rec);\n                    tableValue = Wb.encode(Wb.getValue(app.form1));\n                }\n            });\n        }\n        if (Wb.isInsert == 'Seek') {//查看操作\n            Wb.request({\n                url : 'm?xwl=xc/st/st_business/XC_ST_WH_DELEVERED/data/stWhDeleveredHSelectById',\n                params : {DELEVERED_H_ID : DELEVERED_H_ID},\n                async : false,\n                success : function(resp){\n                    var rec = Wb.decode(resp.responseText).rows[0];\n                    setQtyOrAmtStyle(rec.WAREHOUSE_ID);\n                    setAllReadOnly(true);\n                    rec.BIZ_DATE = Wb.strToDate(rec.BIZ_DATE);\n                    Wb.setValue(app.editWinN,rec);\n                }\n            });\n            setButtonHide();\n        }\n    }\n});\nfunction returnRowFn(r,type){\n    if(type==='xip_pub_orgs'){\n        app.LEDGER_ID.setValue(r.data.LEDGER_ID);\n        app.ORG_ID.setValue(r.data.ORG_ID);\n        setMinDate(r.data.LEDGER_ID);\n        setOrg(r.data.ORG_ID,r.data.LEDGER_ID);\n        clearAll();\n    }\n    //选择项目带回成本中心\n    if(type == 'xc_pm_projects') {\n        app.DEPT_ID_XWL.DEPT_ID.setValue(r.data.DEPT_ID);\n        app.DEPT_ID_XWL.DEPT_NAME.setValue(r.data.DEPT_NAME);\n    }\n    //选择成本中心为项目查询的成本中心赋值\n    if(type == 'xip_pub_depts') {\n        if(r.data === undefined)\n            app.PROJECT_ID_XWL.QUERY_DEPT_ID.setValue(r.DEPT_ID);\n        else\n            app.PROJECT_ID_XWL.QUERY_DEPT_ID.setValue(r.data.DEPT_ID);\n    }\n    //仓库改变，清空该仓库下面入库单带出来的信息\n    if(type=='xc_st_warehouse'){\n        setQtyOrAmtStyle(r.data.WAREHOUSE_ID);\n        clearCommon();\n    }\n    //选择领用申请\n    if (type == 'xc_st_use_apply_h') {\n        setCommonValue(r.data);\n        setQtyOrAmtStyle(r.data.WAREHOUSE_ID);\n        app.DELEVERED_H_NAME.setValue(r.get('USE_APPLY_H_NAME'));\n        app.BUSINESS_TYPE_ID.setValue(r.get('BUSINESS_TYPE_ID'));\n        app.BUSINESS_TYPE_NAME.setValue(r.get('BUSINESS_TYPE_NAME'));\n    }\n    //选择领用出库\n    if (type == 'xc_st_wh_delevered_h') {\n        setComponentValue(r.data);\n    }\n    //加上仓库筛选条件\n    if (type == 'xc_st_use_apply_h_before' || type == 'xc_st_wh_delevered_h_before') {\n        app.DELEVERED_H_XWL.QUERY_WAREHOUSE_ID.setValue(app.WAREHOUSE_XWL.WAREHOUSE_ID.getValue());\n        app.USE_APPLY_XWL.QUERY_WAREHOUSE_ID.setValue(app.WAREHOUSE_XWL.WAREHOUSE_ID.getValue());\n    }\n}\nfunction clearOtherFn(type){\n    if(type=='xip_pub_orgs'){\n        app.LEDGER_ID.setValue(null);\n        app.ORG_ID.setValue(null);\n    }\n    //情况成本中心同时清空项目查询条件里的成本中心\n    if(type == 'xip_pub_depts') {\n        app.PROJECT_ID_XWL.QUERY_DEPT_ID.setValue('');\n    }\n    if(type=='xc_st_wh_delevered_h' || type=='xc_st_use_apply_h'){\n        gridCommon.store.removeAll();\n    }\n    //仓库改变，清空该仓库下面入库单带出来的信息\n    if(type=='xc_st_warehouse'){\n        clearCommon();\n    }\n}\nfunction setSomeReadOnly(flag){\n\tapp.ORG_XWL.ORG_NAME.setReadOnly(flag);\n    app.DELEVERED_H_XWL.RE_DELEVERED_H_CODE.setReadOnly(flag);\n    app.USE_APPLY_XWL.USE_APPLY_H_CODE.setReadOnly(flag);\n    app.WAREHOUSE_XWL.WAREHOUSE_NAME.setReadOnly(flag);\n}\nfunction setAllReadOnly(flag){\n\tsetSomeReadOnly(flag);\n    app.DELEVERED_H_NAME.setReadOnly(flag);\n    app.DEPT_ID_XWL.DEPT_NAME.setReadOnly(flag);\n    app.PROJECT_ID_XWL.PROJECT_NAME.setReadOnly(flag);\n    app.BIZ_DATE.setReadOnly(flag);\n    app.BUSINESS_TYPE_NAME.setReadOnly(flag);\n    PRICE_COL_COMMON.getEditor().setReadOnly(flag);\n    AMOUNT_COL_COMMON.getEditor().setReadOnly(flag);\n    app.RECEIVER_ID_XWL.RECEIVER.setReadOnly(flag);\n    app.saveBtn.setDisabled(flag);\n    app.submitBtn.setDisabled(flag);\n    app.addBtn.setDisabled(flag);\n    app.delBtns.setDisabled(flag);\n    app.addBtn1.setDisabled(flag);\n    app.delBtns1.setDisabled(flag);\n}\nfunction setButtonHide(){\n    app.saveBtn.hide();\n    app.submitBtn.hide();\n    app.enclosureBtn.hide();\n    app.grid1Tbar.hide();\n    app.grid2Tbar.hide();\n}\nfunction setOrg(orgId,ledgerId) {\n    app.DEPT_ID_XWL.QUERY_LEDGER_ID.setValue(ledgerId);\n    app.PROJECT_ID_XWL.QUERY_LEDGER_ID.setValue(ledgerId);\n    app.USE_APPLY_XWL.QUERY_ORG_ID.setValue(orgId);\n    app.USE_APPLY_XWL.QUERY_LEDGER_ID.setValue(ledgerId);\n    app.DELEVERED_H_XWL.QUERY_ORG_ID.setValue(orgId);\n    app.DELEVERED_H_XWL.QUERY_LEDGER_ID.setValue(ledgerId);\n    app.DELEVERED_H_XWL.DOC_CAT_CODE_L.setValue('LYCK');\n    app.WAREHOUSE_XWL.QUERY_ORG_ID.setValue(orgId);\n    app.WAREHOUSE_XWL.LEDGER_ID.setValue(ledgerId);\n    app.RECEIVER_ID_XWL.QUERY_LEDGER_ID.setValue(ledgerId);\n    app.WAREHOUSE_XWL.IS_INIT.setValue('Y');\n}\nfunction clearAll(){\n    app.WAREHOUSE_XWL.WAREHOUSE_ID.reset();\n    app.WAREHOUSE_XWL.WAREHOUSE_NAME.reset();\n    app.BUSINESS_TYPE_ID.reset();\n    app.BUSINESS_TYPE_NAME.reset();\n}\nfunction clearCommon(){\n    app.DEPT_ID_XWL.DEPT_NAME.reset();\n\tapp.DEPT_ID_XWL.DEPT_ID.reset();\n    app.PROJECT_ID_XWL.PROJECT_ID.reset();\n    app.PROJECT_ID_XWL.PROJECT_NAME.reset();\n    app.PROJECT_ID_XWL.QUERY_DEPT_ID.reset();\n    app.DELEVERED_H_XWL.RE_DELEVERED_H_ID.reset();\n    app.DELEVERED_H_XWL.RE_DELEVERED_H_CODE.reset();\n\tapp.USE_APPLY_XWL.USE_APPLY_H_CODE.reset();\n\tapp.USE_APPLY_XWL.NOTICE_H_ID.reset();\n    app.RECEIVER_ID_XWL.RECEIVER_ID.reset();\n    app.RECEIVER_ID_XWL.RECEIVER.reset();\n    gridCommon.getStore().removeAll();\n}\nfunction setCommonValue(rec){\n\tapp.DEPT_ID_XWL.DEPT_ID.setValue(rec.DEPT_ID);\n    app.DEPT_ID_XWL.DEPT_NAME.setValue(rec.DEPT_NAME);\n    app.PROJECT_ID_XWL.PROJECT_ID.setValue(rec.PROJECT_ID);\n    app.PROJECT_ID_XWL.PROJECT_NAME.setValue(rec.PROJECT_NAME);\n    app.PROJECT_ID_XWL.QUERY_DEPT_ID.setValue(rec.DEPT_ID);\n    app.WAREHOUSE_XWL.WAREHOUSE_ID.setValue(rec.WAREHOUSE_ID);\n    app.WAREHOUSE_XWL.WAREHOUSE_NAME.setValue(rec.WAREHOUSE_NAME);\n    gridCommon.getStore().removeAll();\n}\nfunction setComponentValue(rec){\n    setCommonValue(rec);\n    app.RECEIVER_ID_XWL.RECEIVER_ID.setValue(rec.RECEIVER_ID);\n    app.RECEIVER_ID_XWL.RECEIVER.setValue(rec.RECEIVER);\n\tapp.USE_APPLY_XWL.USE_APPLY_H_CODE.setValue(rec.USE_APPLY_H_CODE);\n\tapp.USE_APPLY_XWL.NOTICE_H_ID.setValue(rec.NOTICE_H_ID);\n}\nfunction setMinDate(ledgerId){\n    Wb.request({//账簿会计期查询\n        url : 'm?xwl=xc/st/common/data/ledgerDateSelect',\n        params : {LEDGER_ID : ledgerId},\n        success : function(resp){\n            var temp = Wb.decode(resp.responseText);\n            if(temp.rows[0].START_DATE !== null && temp.rows[0].START_DATE !== \"\"){\n                app.BIZ_DATE.setMinValue(Wb.strToDate(temp.rows[0].START_DATE));\n                app.BIZ_DATE.setReadOnly(false);\n            }\n            else {\n                if(app.LEDGER_ID.getValue() !== null && app.LEDGER_ID.getValue() !== \"\"){\n                    Wb.toast('{#XC_ST_WH_DELEVERED_gzbmyqykjqqcxxz#}');//该账簿没有启用会计期，请重新选择！\n                    app.BIZ_DATE.reset();\n                    app.BIZ_DATE.setReadOnly(true);\n                }\n            }\n        }\n    });\n}\nfunction setDeptInfo(orgId){\n    Wb.request({\n        url : 'm?xwl=xc/ar/ct/data/selectDeptInfoByUserId',\n        params : {USER_ID : '{#XIP.userId#}',ORG_ID : orgId},\n        async : false,\n        success : function(resp){\n            var temp = Wb.decode(resp.responseText);\n            app.DEPT_ID_XWL.DEPT_ID.setValue(temp.DEPT_ID);\n            app.DEPT_ID_XWL.DEPT_NAME.setValue(temp.DEPT_NAME);\n            app.PROJECT_ID_XWL.QUERY_DEPT_ID.setValue(temp.DEPT_ID);\n        }\n    });\n}\n//通过改变仓库来控制单价和金额是否可录入\nfunction setQtyOrAmtStyle(WAREHOUSE_ID){\n    Wb.request({\n        url : 'm?xwl=xc/st/ld_base/XC_ST_WAREHOUSE/data/stWarehouseSelect',\n        params : {WAREHOUSE_IDS : WAREHOUSE_ID,ALL : 'ALL'},\n        async : false,\n        success : function(resp){\n            var res = Wb.decode(resp.responseText);\n            if(res.total > 0){\n                VALUATION_MODEL = res.rows[0].VALUATION_MODEL;\n                IS_LOCATION = res.rows[0].IS_LOCATION;\n                if(VALUATION_MODEL == 'FJZK'){//非价值库不用录入单价和金额\n                    for(var i = 0;i < gridCommon.store.getCount();i++){\n                        var data = gridCommon.store.getAt(i);\n                        data.set('PRICE',null);\n                        data.set('AMOUNT',null);\n                    }\n                    PRICE_COL_COMMON.getEditor().setReadOnly(true);\n                    AMOUNT_COL_COMMON.getEditor().setReadOnly(true);\n                    PRICE_COL_COMMON.setText('{#XC_ST_WH_DELEVERED_PRICE#}');\n                    AMOUNT_COL_COMMON.setText('{#XC_ST_WH_DELEVERED_AMOUNT#}');\n                    PRICE_COL_COMMON.getEditor().allowBlank = true;\n                    AMOUNT_COL_COMMON.getEditor().allowBlank = true;\n                }\n                else{\n                    PRICE_COL_COMMON.getEditor().setReadOnly(false);\n                    AMOUNT_COL_COMMON.getEditor().setReadOnly(false);\n                    PRICE_COL_COMMON.setText('<font color=\"red\">*<\/font>{#XC_ST_WH_DELEVERED_PRICE#}');\n                    AMOUNT_COL_COMMON.setText('<font color=\"red\">*<\/font>{#XC_ST_WH_DELEVERED_AMOUNT#}');\n                    PRICE_COL_COMMON.getEditor().allowBlank = false;\n                    AMOUNT_COL_COMMON.getEditor().allowBlank = false;\n                }\n                //通过仓库是否启用货位，来控制行信息的货位是否为必填\n                if(res.rows[0].IS_LOCATION == 'Y'){//启用货位管理\n                    app.LOCATION_NAME_COL_1.getEditor().allowBlank = false;\n                    app.LOCATION_NAME_COL_1.getEditor().setReadOnly(false);\n                    app.LOCATION_NAME_COL.setText('<font color=\"red\">*<\/font>{#XC_ST_WH_DELEVERED_LOCATION#}');\n                    app.LOCATION_NAME_COL_1.setText('<font color=\"red\">*<\/font>{#XC_ST_WH_DELEVERED_LOCATION#}');\n                }\n                else{\n                    app.LOCATION_NAME_COL_1.getEditor().allowBlank = true;\n                    app.LOCATION_NAME_COL_1.getEditor().setReadOnly(true);\n                    app.LOCATION_NAME_COL.setText('{#XC_ST_WH_DELEVERED_LOCATION#}');\n                    app.LOCATION_NAME_COL_1.setText('{#XC_ST_WH_DELEVERED_LOCATION#}');\n                }\n            }\n        }\n    });\n}"},"children":[{"configs":{"itemId":"tools"},"children":[{"configs":{"itemId":"orgInitStore","url":"m?xwl=xc/com-lov/ORG_PICK/DB/ORG_SELECT_BY_LEDGER"},"events":{"load":"if(!Wb.isEmpty(ORG_NAME) && Wb.isInsert == 'Add'){\n    app.ORG_ID.setValue(ORG_ID);\n    app.LEDGER_ID.setValue(LEDGER_ID);\n    app.ORG_XWL.ORG_ID.setValue(ORG_ID);\n    app.ORG_XWL.ORG_NAME.setValue(ORG_NAME);\n    app.ORG_XWL.LEDGER_ID.setValue(LEDGER_ID);\n}\nif(Wb.isEmpty(ORG_NAME)){\n    if(store.getCount() > 0){\n        app.ORG_ID.setValue(store.getAt(0).get('ORG_ID'));\n        app.LEDGER_ID.setValue(store.getAt(0).get('LEDGER_ID'));\n        app.ORG_XWL.ORG_ID.setValue(store.getAt(0).get('ORG_ID'));\n        app.ORG_XWL.ORG_NAME.setValue(store.getAt(0).get('ORG_NAME'));\n        app.ORG_XWL.LEDGER_ID.setValue(store.getAt(0).get('LEDGER_ID'));\n    }\n}\nsetOrg(app.ORG_ID.getValue(),app.LEDGER_ID.getValue());\nsetMinDate(app.LEDGER_ID.getValue());\nsetDeptInfo(app.ORG_ID.getValue());\napp.BUSINESS_TYPE_NAME.getStore().load();"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"folder"},{"configs":{"maximized":"true","height":"530","layout":"border","width":"900","closeAction":"hide","itemId":"editWinN","border":"false","modal":"true","maximizable":"true"},"events":{"hide":"app.hideFun();"},"children":[{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"{#XC_ST_WH_DELEVERED_saveBtn#}","itemId":"saveBtn","iconCls":"save_icon"},"events":{"click":"/*--------------  验证数据是否合法  ---------------*/\nif (Wb.verify(app.editWinN) && Wb.verifyGrid(gridCommon)) {\n    //判断是否有明细\n    var store = gridCommon.store;\n    if(store.getCount() === 0){\n        Wb.toast('{#XC_ST_WH_DELEVERED_qtjmxsj#}');//请添加明细数据！\n        return;\n    }\n    //通过明细算出主表中的金额值\n    var AMOUNT = 0;\n    for (var i = 0; i < gridCommon.getStore().getCount(); i++) {\n        var r = gridCommon.getStore().getAt(i);\n        AMOUNT = AMOUNT + r.get('QTY');\n    }\n    app.AMOUNT.setValue(AMOUNT);\n    Wb.sync({\n        url : '{#contextPath#}'+'/xcStDocsAction.do?method=saveOrUpdateXcStDocs',\n        grid : gridCommon,\n        params  : Wb.getValue(app.form1),\n        success : function(resp){\n            var record = Wb.decode(resp.responseText);\n            var msg = record.msg;\n            if(record.flag === '0'){\n                Wb.isInsert = 'Update';\n                Wb.toast('{#XC_ST_WH_DELEVERED_bccg#}');//保存成功！\n                app.DELEVERED_H_CODE.setValue(record.docCode);\n                setSomeReadOnly(true);\n                gridCommon.store.load({params : {DELEVERED_H_ID : DELEVERED_H_ID}});\n                app.IS_CREATE.setValue('N');\n                tableValue = Wb.encode(Wb.getValue(app.form1));\n                isEditCol = 'N';\n            }\n            else{\n                Wb.toast(msg);\n            }\n        }\n    });\n} else {\n    Wb.verifyGrid(gridCommon);\n    Wb.toast('{#XC_ST_WH_DELEVERED_qsrsybsx#}');\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#XC_ST_WH_DELEVERED_submitBtn#}","itemId":"submitBtn","iconCls":"check_icon"},"events":{"click":"if(Wb.isInsert=='Add' || tableValue !== Wb.encode(Wb.getValue(app.form1)) || isEditCol == 'Y'){\n    Wb.toast('{#XC_ST_WH_DELEVERED_qxbcztj#}');//请先保存，再提交！\n    return false;\n}\nif(app.STATUS.getValue() != '1'){\n    Wb.toast('{#XC_ST_WH_DELEVERED_sxdjfcgztbntj#}');//所选记录非草稿状态，不能提交！\n    return;\n}\nWb.request({\n    url: '{#contextPath#}'+'/xcStCommonAction.do?method=updateXcStDocStatus',\n    params: Wb.apply({stDocId : app.DELEVERED_H_ID.getValue(),docClassCode : 'CKD'}),\n    success: function(resp) {\n        var record = Wb.decode(resp.responseText);\n        if(record.flag == '0'){\n            Wb.toast('{#XC_ST_WH_DELEVERED_tjcg#}');\n            setAllReadOnly(true);\n            app.STATUS.setValue('3');\n            tableValue = Wb.encode(Wb.getValue(app.form1));\n        }\n        else\n            Wb.toast(record.msg);\n    }\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#XC_ST_WH_DELEVERED_enclosureBtn#}","itemId":"enclosureBtn","iconCls":"attach_icon"},"events":{"click":"if(Wb.isInsert == 'Add'){\n    Wb.toast('{#XC_ST_WH_DELEVERED_qxbcztjfj#}');//请先保存，再添加附件！\n    return false;\n}\nvar temp_id = app.DELEVERED_H_ID.getValue();\nvar temp_code = app.DELEVERED_H_CODE.getValue();\nWb.request({\n    url : '{#contextPath#}' + '/xcStCommonAction.do?method=getXcStAttCatCode',\n    params : {LEDGER_ID : app.LEDGER_ID.getValue(),DOC_CAT_CODE : app.DOC_CAT_CODE.getValue()},\n    success : function(resp){\n        var temp = Wb.decode(resp.responseText);\n        if(temp.flag == '0'){\n            var attCatCode = temp.attCatCode;\n            Xip.showAttachmentManager('{#XIP.userId#}',temp_id,'',attCatCode,temp_code,'Y','Y','Y',function(){},10); \n        }\n        else{\n            Wb.toast(temp.msg);\n        }\n    }\n});"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"array"},{"configs":{"region":"north","frame":"false","itemId":"form1","bodyPadding":"0 0 0 0","border":"false"},"children":[{"configs":{"style":"fontSize:20px","html":"<font style=\"\">采购入库<\/font>","margin":"10 0 20 0","labelAlign":"center","itemId":"title"},"children":[],"expanded":false,"type":"label"},{"configs":{"frame":"false","layout":"column","margin":"5 0 0 0","itemId":"tr_1","border":"false"},"children":[{"configs":{"frame":"false","style":"border-width:0px","layout":"form","columnWidth":".249","itemId":"td_1_1","border":"false"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/ORG_PICK/ORG_ALL_PICK","itemId":"ORG_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"frame":"false","style":"border-width:0px","layout":"form","columnWidth":".249","itemId":"td_1_2","border":"false"},"children":[{"configs":{"file":"m?xwl=xc/st/common/st_com_lov/XC_ST_WAREHOUSE_LOV/XC_ST_WAREHOUSE_LOV","itemId":"WAREHOUSE_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"frame":"false","style":"border-width:0px","layout":"form","columnWidth":".249","itemId":"td_1_3","border":"false"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"DELEVERED_H_CODE","fieldLabel":"{#XC_ST_WH_DELEVERED_DELEVERED_H_CODE#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"frame":"false","style":"border-width:0px","layout":"form","columnWidth":".249","itemId":"td_1_4","border":"false"},"children":[{"configs":{"labelWidth":"80","allowBlank":"false","labelAlign":"right","itemId":"BIZ_DATE","fieldLabel":"<font color='red'>*<\/font>{#XC_ST_WH_DELEVERED_BIZ_DATE#}"},"children":[],"expanded":false,"type":"date"}],"expanded":true,"type":"panel"}],"expanded":false,"type":"panel"},{"configs":{"frame":"false","layout":"column","margin":"5 0 0 0","itemId":"tr_2","border":"false"},"children":[{"configs":{"frame":"false","style":"border-width:0px","layout":"form","columnWidth":".249","itemId":"td_2_1","border":"false"},"children":[{"configs":{"file":"m?xwl=xc/st/common/st_com_lov/XIP_PUB_EMPS_LOV/XC_ST_RECEIVER_LOV","itemId":"RECEIVER_ID_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"frame":"false","style":"border-width:0px","layout":"form","columnWidth":".249","itemId":"td_2_2","border":"false"},"children":[{"configs":{"file":"m?xwl=xc/st/common/st_com_lov/XC_ST_USE_APPLY_LOV/XC_ST_USE_APPLY_H","itemId":"USE_APPLY_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"frame":"false","style":"border-width:0px","layout":"form","columnWidth":".249","itemId":"td_2_3","border":"false"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/DEPT_ID_PICK/DEPT_ID_LD","itemId":"DEPT_ID_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"frame":"false","style":"border-width:0px","layout":"form","columnWidth":".249","itemId":"td_2_4","border":"false"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/PROJECT_ID_PICK/PROJECT_ID_LD","itemId":"PROJECT_ID_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"frame":"false","layout":"column","margin":"5 0 0 0","itemId":"tr_3","border":"false"},"children":[{"configs":{"frame":"false","style":"border-width:0px","layout":"form","columnWidth":".249","itemId":"td_3_1","border":"false"},"children":[{"configs":{"file":"m?xwl=xc/st/common/st_com_lov/XC_ST_WH_DELEVERED_LOV/XC_ST_WH_DELEVERED_H_LOV","itemId":"DELEVERED_H_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"frame":"false","style":"border-width:0px","layout":"form","columnWidth":".249","itemId":"td_3_2","border":"false"},"children":[{"configs":{"labelWidth":"80","allowBlank":"false","displayField":"BUSINESS_TYPE_NAME","valueField":"BUSINESS_TYPE_NAME","labelAlign":"right","itemId":"BUSINESS_TYPE_NAME","fieldLabel":"<font color='red'>*<\/font>{#XC_ST_WH_DELEVERED_BUSINESS_TYPE_NAME#}","editable":"false"},"events":{"select":"app.BUSINESS_TYPE_ID.setValue(records[0].data.BUSINESS_TYPE_ID);"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/st/ld_base/XC_ST_LD_BUSINESS_TYPE/data/stLdBusinessTypeSelect"},"events":{"load":"if(store.getCount() > 0){\n    app.BUSINESS_TYPE_NAME.setValue(store.getAt(0).get('BUSINESS_TYPE_NAME'));\n    app.BUSINESS_TYPE_ID.setValue(store.getAt(0).get('BUSINESS_TYPE_ID'));\n}","beforeload":"store.proxy.extraParams.LEDGER_ID = app.LEDGER_ID.getValue();\nstore.proxy.extraParams.DOC_CAT_CODE = app.DOC_CAT_CODE.getValue();"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"frame":"false","layout":"column","margin":"5 0 5 0","itemId":"tr_4","border":"false"},"children":[{"configs":{"frame":"false","style":"border-width:0px","layout":"form","columnWidth":".498","itemId":"td_4_1","border":"false"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"DELEVERED_H_NAME","fieldLabel":"{#XC_ST_WH_DELEVERED_DELEVERED_H_NAME#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"frame":"false","style":"border-width:0px","layout":"form","columnWidth":".249","itemId":"td_4_2","border":"false"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"EMP_NAME","fieldLabel":"制单人"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"frame":"false","style":"border-width:0px","layout":"form","columnWidth":".249","itemId":"td_4_3","border":"false"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","pickList":"[['1','{#XC_ST_WH_DELEVERED_STATUS_1#}'],['2','{#XC_ST_WH_DELEVERED_STATUS_2#}'],['3','{#XC_ST_WH_DELEVERED_STATUS_3#}']]","labelAlign":"right","itemId":"STATUS","fieldLabel":"{#XC_ST_WH_DELEVERED_STATUS#}"},"children":[],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"}],"expanded":false,"type":"panel"},{"configs":{"frame":"false","hidden":"true","layout":"column","itemId":"hidePanel","border":"false"},"children":[{"configs":{"itemId":"ORG_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"LEDGER_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"DELEVERED_H_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"BUSINESS_TYPE_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"DOC_CAT_CODE"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"SALE_ORDER_H_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"AMOUNT"},"children":[],"expanded":false,"type":"number"},{"configs":{"hidden":"true","itemId":"AR_CONTRACT_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"CUSTOMER_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"WH_KEEPER_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"IS_CREATE"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","value":"CKD","itemId":"docClassCode"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"BUYER_ID","fieldLabel":"{#XC_ST_WH_DELEVERED_BUYER_ID#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":false,"type":"form"},{"configs":{"region":"center","selType":"checkboxmodel","itemId":"grid1","editable":"true"},"events":{"tagEvents":"'cellclick' : function(grid1,td,cellIndex,record,tr,rowIndex,e,eOpts){\n    //序列号窗口\n    if(cellIndex == 11){\n        if(IS_LOCATION == 'N'){\n            Wb.toast(\"{#XC_ST_WH_DELEVERED_ckwqyhwgl#}\");//仓库未启用货位管理，不能添加货位信息！\n            return;\n        }\n        if(!Wb.isEmpty(grid1.store.getModifiedRecords())){\n        \tWb.toast('{#XC_ST_WH_DELEVERED_qxbcdjhxx#}');//请先保存单据行信息，在添加序列号/批次！\n            return;\n        }\n        Wb.run({\n            url: 'm?xwl=xc/st/common/st_com_lov/XC_ST_WH_B_LOCATION/XC_ST_WH_B_LOCATION', \n            success: function(apps) {\n                apps.initWin({\n                    BUSINESS_L_ID : record.data.DELEVERED_L_ID,\n                    BUSINESS_H_ID : record.data.DELEVERED_H_ID,\n                    WAREHOUSE_ID : app.WAREHOUSE_XWL.WAREHOUSE_ID.getValue(),\n                    SERIAL_BATCH_NUM : record.data.SERIAL_BATCH_NUM,\n                    MATERIAL_ID : record.data.MATERIAL_ID,\n                    MATERIAL_NAME : record.data.MATERIAL_NAME,\n                    LOCATION_ID : record.data.LOCATION_ID,\n                    LOCATION_NAME : record.data.LOCATION_NAME,\n                    QTY : record.data.QTY,\n                    STATUS : app.STATUS.getValue(),\n                    DOC_CAT_CODE : app.DOC_CAT_CODE.getValue(),\n                    DOC_CAT_CODE_01 : '(\"QTRK\",\"CGRK\",\"QTCK-H\",\"XSTK\",\"LYTK\")',\n                    BUSINESS_TYPE_ID : app.BUSINESS_TYPE_ID.getValue(),\n                    opType : Wb.isInsert,\n                    VALUATION_MODEL : VALUATION_MODEL,\n                    hideFun : function(rs){\n                    }\n                });\n            }\n        });\n    }\n}"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/st/st_business/XC_ST_WH_DELEVERED/data/stWhDeleveredLSelect"},"events":{"update":"isEditCol = 'Y';","remove":"isEditCol = 'Y';","add":"isEditCol = 'Y';"},"children":[],"expanded":false,"type":"store"},{"configs":{"normalName":"grid1Tbar","itemId":"tbar"},"children":[{"configs":{"text":"{#XC_ST_WH_DELEVERED_addLBtn#}","itemId":"addBtn","iconCls":"file_add_icon"},"events":{"click":"if(Wb.isEmpty(app.WAREHOUSE_XWL.WAREHOUSE_ID.getValue())){\n    Wb.toast('{#XC_ST_WH_DELEVERED_qxxzck#}');\n    return;\n}\nvar url = null;\nif(!Wb.isEmpty(app.USE_APPLY_XWL.NOTICE_H_ID.getValue()))//领用申请行\n    url = 'm?xwl=xc/st/common/st_com_lov/XC_ST_USE_APPLY_LOV/XC_ST_USE_APPLY_L';\nelse{\n    if(VALUATION_MODEL == 'YDJQPJF')//移动加权平局法\n        url = 'm?xwl=xc/st/common/st_com_lov/XC_ST_MATERIAL_LOV/XC_ST_MATERIAL_LOV_YDJQPJF';\n    if(VALUATION_MODEL == 'FJZK')//非价值库\n        url = 'm?xwl=xc/st/common/st_com_lov/XC_ST_MATERIAL_LOV/XC_ST_MATERIAL_LOV_FJZK';\n    if(VALUATION_MODEL == 'GBJJF')//个别计价法\n        url = 'm?xwl=xc/st/common/st_com_lov/XC_ST_MATERIAL_LOV/XC_ST_MATERIAL_LOV_GBJJ';\n    if(VALUATION_MODEL == 'XJXCF')//先进先出法\n        url = 'm?xwl=xc/st/common/st_com_lov/XC_ST_MATERIAL_LOV/XC_ST_MATERIAL_LOV_XJXC';\n}\nWb.run({\n    url: url, \n    success: function(apps) {\n        apps.initWin({\n            LEDGER_ID : app.LEDGER_ID.getValue(),\n            ORG_ID : app.ORG_ID.getValue(),\n            DELEVERED_H_ID : app.DELEVERED_H_XWL.RE_DELEVERED_H_ID.getValue(),\n            USE_APPLY_H_ID : app.USE_APPLY_XWL.NOTICE_H_ID.getValue(),\n            WAREHOUSE_ID : app.WAREHOUSE_XWL.WAREHOUSE_ID.getValue(),\n            VALUATION_MODEL : VALUATION_MODEL,\n            hideFun : function(rs){\n                Wb.each(rs, function(r) {\n                    var grid1Store = gridCommon.getStore();\n                    addStoreNormal(r);\n                });\n            }\n        });\n    }\n});\nfunction addStoreNormal(r){\n\tWb.add(gridCommon, {\n        NOTICE_L_ID : r.get('USE_APPLY_L_ID'),\n        DELEVERED_L_ID : Xip.getId(),\n        DELEVERED_H_ID : app.DELEVERED_H_ID.getValue(),\n        MATERIAL_ID : r.get('MATERIAL_ID'),\n        ENTRY_H_ID : r.get('ENTRY_H_ID'),\n        ENTRY_L_ID : r.get('ENTRY_L_ID'),\n        QTY : r.get('CKSL'),\n        AMOUNT : (VALUATION_MODEL != 'FJZK') ? r.get('CKCB') : null,\n        PRICE : (VALUATION_MODEL != 'FJZK') ? r.get('CKCB')/ r.get('CKSL') : null,\n        SPECIFICATION : r.get('SPECIFICATION'),\n        MATERIAL_CODE : r.get('MATERIAL_CODE'),\n        MATERIAL_NAME : r.get('MATERIAL_NAME'),\n        SERIAL_BATCH_NUM : r.get('SERIAL_BATCH_NUM'),\n        B_SERIAL_ID : r.get('B_SERIAL_ID'),\n        DELEVERED_L_CODE : gridCommon.store.getCount()+1,\n        DIM_ID : r.get('DIM_ID'),\n        DIM_NAME : r.get('DIM_NAME'),\n        ORG_ID : app.ORG_ID.getValue(),\n        LEDGER_ID : app.LEDGER_ID.getValue(),\n        BUSINESS_TYPE_ID : app.BUSINESS_TYPE_ID.getValue(),\n        DOC_CAT_CODE : app.DOC_CAT_CODE.getValue(),\n        COEFFICIENT : -1\n    },'after', 1, false);\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#XC_ST_WH_DELEVERED_delLBtn#}","itemId":"delBtns","iconCls":"file_delete_icon"},"events":{"click":"//删除原则，先将选中记录在表格中移除，点击主单保存时，才真正从数据库删除。\nvar recs = gridCommon.getSelection();\nif (!recs.length) {\n    Wb.toast('{#XC_ST_WH_DELEVERED_qxzxyscdjl#}');\n    return;\n}\nWb.confirm('{#XC_ST_WH_DELEVERED_qdyscxzd#} ' + recs.length + ' {#XC_ST_WH_DELEVERED_tjlm#}', function() {\n\tWb.remove(gridCommon,recs);\n});"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"DELEVERED_L_ID","hidden":"true","dataIndex":"DELEVERED_L_ID","titleAlign":"center","itemId":"DELEVERED_L_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"DELEVERED_H_ID","hidden":"true","dataIndex":"DELEVERED_H_ID","titleAlign":"center","itemId":"DELEVERED_H_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"<font color='red'>*<\/font>{#XC_ST_WH_DELEVERED_MATERIAL_CODE#}","width":"120","dataIndex":"MATERIAL_CODE","titleAlign":"center","itemId":"MATERIAL_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"<font color='red'>*<\/font>{#XC_ST_WH_DELEVERED_MATERIAL_NAME#}","width":"120","dataIndex":"MATERIAL_NAME","titleAlign":"center","itemId":"MATERIAL_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#XC_ST_WH_DELEVERED_SPECIFICATION#}","width":"100","dataIndex":"SPECIFICATION","titleAlign":"center","itemId":"SPECIFICATION_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"<font color='red'>*<\/font>{#XC_ST_WH_DELEVERED_QTY#}","align":"right","width":"100","dataIndex":"QTY","titleAlign":"center","itemId":"QTY_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"<font color='red'>*<\/font>{#XC_ST_WH_DELEVERED_DIM_NAME#}","width":"80","dataIndex":"DIM_NAME","titleAlign":"center","itemId":"DIM_NAME_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#XC_ST_WH_DELEVERED_PRICE#}","width":"100","align":"right","dataIndex":"PRICE","format":"0,000.0000","titleAlign":"center","itemId":"PRICE_COL"},"children":[{"configs":{"decimalPrecision":"4","minValue":"0","itemId":"editor"},"events":{"change":"var r = gridCommon.getSelection()[0];\nr.set('AMOUNT',r.data.QTY * newValue);\nif(!Wb.isEmpty(r.data.RE_DELEVERED_L_ID)){\n\tWb.request({\n    url : 'm?xwl=xc/st/st_business/XC_ST_WH_DELEVERED/data/stWhDeleveredLSelect',\n        params : {DELEVERED_L_ID : r.data.RE_DELEVERED_L_ID},\n        success : function(resp){\n            var rec = Wb.decode(resp.responseText);\n            if(newValue > rec.rows[0].PRICE){\n                number.setValue(rec.rows[0].PRICE);\n            }\n        }\n    });\n}"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"column"},{"configs":{"text":"{#XC_ST_WH_DELEVERED_AMOUNT#}","width":"100","align":"right","dataIndex":"AMOUNT","format":"0,000.00","titleAlign":"center","itemId":"AMOUNT_COL"},"children":[{"configs":{"decimalPrecision":"2","itemId":"editor"},"events":{"change":"var r = gridCommon.getSelection()[0];\nr.set('PRICE',newValue / r.data.QTY);\nif(!Wb.isEmpty(r.data.RE_DELEVERED_L_ID)){\n\tWb.request({\n    url : 'm?xwl=xc/st/st_business/XC_ST_WH_DELEVERED/data/stWhDeleveredLSelect',\n        params : {DELEVERED_L_ID : r.data.RE_DELEVERED_L_ID},\n        success : function(resp){\n            var rec = Wb.decode(resp.responseText);\n            if(newValue < rec.rows[0].AMOUNT * -1){\n                number.setValue(rec.rows[0].AMOUNT * -1);\n            }\n        }\n    });\n}"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"column"},{"configs":{"text":"{#XC_ST_WH_DELEVERED_PCXLH#}","width":"100","dataIndex":"SERIAL_BATCH_NUM","titleAlign":"center","itemId":"SERIAL_BATCH_NUM_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#XC_ST_WH_DELEVERED_LOCATION#}","align":"center","width":"100","dataIndex":"record","titleAlign":"center","itemId":"LOCATION_NAME_COL","renderer":"var str = \"<a href=\\\"javascript:void(0);\\\">{#XC_ST_WH_DELEVERED_record#}{#XC_ST_WH_DELEVERED_LOCATION#}<\/a>\";\nreturn str;"},"children":[],"expanded":true,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"},{"configs":{"region":"center","selType":"checkboxmodel","hidden":"true","itemId":"grid2","editable":"true"},"events":{"tagEvents":"'cellclick' : function(grid1,td,cellIndex,record,tr,rowIndex,e,eOpts){\n    if (Wb.isInsert != 'Add') {//新增操作\n        if(cellIndex == 10){\n            if(record.get('OP_TYPE')=='Add')\n                app.LOCATION_NAME_COL_1.getEditor().setReadOnly(false);\n            else\n                app.LOCATION_NAME_COL_1.getEditor().setReadOnly(true);\n        }\n    }\n}"},"children":[{"configs":{"normalName":"grid2Tbar","itemId":"tbar"},"children":[{"configs":{"text":"{#XC_ST_WH_DELEVERED_addLBtn#}","itemId":"addBtn1","iconCls":"file_add_icon"},"events":{"click":"if(Wb.isEmpty(app.WAREHOUSE_XWL.WAREHOUSE_ID.getValue())){\n    Wb.toast('{#XC_ST_WH_DELEVERED_qxxzck#}');\n    return;\n}\nvar url = null;\n\nif(!Wb.isEmpty(app.DELEVERED_H_XWL.RE_DELEVERED_H_ID.getValue()))\n    url = 'm?xwl=xc/st/common/st_com_lov/XC_ST_WH_DELEVERED_LOV/XC_ST_WH_DELEVERED_L_LOV';\nelse{\n    Wb.toast('{#XC_ST_WH_DELEVERED_qxxzckd#}');\n    return;\t\n}\nif(!Wb.isEmpty(url)){\n    Wb.run({\n        url: url, \n        async : false,\n        success: function(apps) {\n            apps.initWin({\n                LEDGER_ID : app.LEDGER_ID.getValue(),\n                ORG_ID : app.ORG_ID.getValue(),\n                DELEVERED_H_ID : app.DELEVERED_H_XWL.RE_DELEVERED_H_ID.getValue(),\n                WAREHOUSE_ID : app.WAREHOUSE_XWL.WAREHOUSE_ID.getValue(),\n                hideFun : function(rs){\n                    Wb.each(rs, function(r) {\n                        var grid1Store = gridCommon.getStore();\n                        addStoreL(r);\n                    });\n                }\n            });\n        }\n    });\n}\nfunction addStoreL(r){\n\tWb.add(gridCommon, {\n        DELEVERED_L_ID : Xip.getId(),\n        DELEVERED_H_ID : app.DELEVERED_H_ID.getValue(),\n        RE_DELEVERED_H_ID : r.get('DELEVERED_H_ID'),\n        RE_DELEVERED_L_ID : r.get('DELEVERED_L_ID'),\n        MATERIAL_ID : r.get('MATERIAL_ID'),\n        ENTRY_H_ID : r.get('ENTRY_H_ID'),\n        ENTRY_L_ID : r.get('ENTRY_L_ID'),\n        QTY : r.get('CKSL') * -1,\n        AMOUNT : (VALUATION_MODEL != 'FJZK') ? r.get('CKCB') * -1 : null,\n        PRICE : (VALUATION_MODEL != 'FJZK') ? r.get('CKCB') / r.get('CKSL') : null,\n        SPECIFICATION : r.get('SPECIFICATION'),\n        MATERIAL_CODE : r.get('MATERIAL_CODE'),\n        MATERIAL_NAME : r.get('MATERIAL_NAME'),\n        SERIAL_BATCH_NUM : r.get('SERIAL_BATCH_NUM'),\n        B_SERIAL_ID : r.get('B_SERIAL_ID'),\n        DELEVERED_L_CODE : gridCommon.store.getCount()+1,\n        DIM_ID : r.get('DIM_ID'),\n        DIM_NAME : r.get('DIM_NAME'),\n        LOCATION_NAME : r.get('LOCATION_NAME'),\n        LOCATION_ID : r.get('LOCATION_IDS'),\n        ORG_ID : app.ORG_ID.getValue(),\n        LEDGER_ID : app.LEDGER_ID.getValue(),\n        BUSINESS_TYPE_ID : app.BUSINESS_TYPE_ID.getValue(),\n        DOC_CAT_CODE : app.DOC_CAT_CODE.getValue(),\n        COEFFICIENT : 1,\n        OP_TYPE : 'Add'\n    },'after', 1, false);\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#XC_ST_WH_DELEVERED_delLBtn#}","itemId":"delBtns1","iconCls":"file_delete_icon"},"events":{"click":"//删除原则，先将选中记录在表格中移除，点击主单保存时，才真正从数据库删除。\nvar recs = gridCommon.getSelection();\nif (!recs.length) {\n    Wb.toast('{#XC_ST_WH_DELEVERED_qxzxyscdjl#}');\n    return;\n}\nWb.confirm('{#XC_ST_WH_DELEVERED_qdyscxzd#} ' + recs.length + ' {#XC_ST_WH_DELEVERED_tjlm#}', function() {\n\tWb.remove(gridCommon,recs);\n});"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"store","url":"m?xwl=xc/st/st_business/XC_ST_WH_DELEVERED/data/stWhDeleveredLSelect"},"events":{"update":"isEditCol = 'Y';","remove":"isEditCol = 'Y';","add":"isEditCol = 'Y';"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"DELEVERED_L_ID","hidden":"true","dataIndex":"DELEVERED_L_ID","titleAlign":"center","itemId":"DELEVERED_L_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"DELEVERED_H_ID","hidden":"true","dataIndex":"DELEVERED_H_ID","titleAlign":"center","itemId":"DELEVERED_H_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"<font color='red'>*<\/font>{#XC_ST_WH_DELEVERED_MATERIAL_CODE#}","width":"120","dataIndex":"MATERIAL_CODE","titleAlign":"center","itemId":"MATERIAL_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"<font color='red'>*<\/font>{#XC_ST_WH_DELEVERED_MATERIAL_NAME#}","width":"120","dataIndex":"MATERIAL_NAME","titleAlign":"center","itemId":"MATERIAL_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#XC_ST_WH_DELEVERED_SPECIFICATION#}","width":"100","dataIndex":"SPECIFICATION","titleAlign":"center","itemId":"SPECIFICATION_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"<font color='red'>*<\/font>{#XC_ST_WH_DELEVERED_QTY#}","align":"right","width":"100","dataIndex":"QTY","titleAlign":"center","itemId":"QTY_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"<font color='red'>*<\/font>{#XC_ST_WH_DELEVERED_DIM_NAME#}","width":"80","dataIndex":"DIM_NAME","titleAlign":"center","itemId":"DIM_NAME_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#XC_ST_WH_DELEVERED_PRICE#}","width":"100","align":"right","dataIndex":"PRICE","format":"0,000.0000","titleAlign":"center","itemId":"PRICE_COL_1"},"children":[{"configs":{"decimalPrecision":"4","minValue":"0","itemId":"editor"},"events":{"change":"var r = gridCommon.getSelection()[0];\nr.set('AMOUNT',r.data.QTY * newValue);\nif(!Wb.isEmpty(r.data.RE_DELEVERED_L_ID)){\n\tWb.request({\n    url : 'm?xwl=xc/st/st_business/XC_ST_WH_DELEVERED/data/stWhDeleveredLSelect',\n        params : {DELEVERED_L_ID : r.data.RE_DELEVERED_L_ID},\n        success : function(resp){\n            var rec = Wb.decode(resp.responseText);\n            if(newValue > rec.rows[0].PRICE){\n                number.setValue(rec.rows[0].PRICE);\n            }\n        }\n    });\n}"},"children":[],"expanded":false,"type":"number"}],"expanded":false,"type":"column"},{"configs":{"text":"{#XC_ST_WH_DELEVERED_AMOUNT#}","width":"100","align":"right","dataIndex":"AMOUNT","format":"0,000.00","titleAlign":"center","itemId":"AMOUNT_COL_1"},"children":[{"configs":{"decimalPrecision":"2","itemId":"editor"},"events":{"change":"var r = gridCommon.getSelection()[0];\nr.set('PRICE',newValue / r.data.QTY);\nif(!Wb.isEmpty(r.data.RE_DELEVERED_L_ID)){\n\tWb.request({\n    url : 'm?xwl=xc/st/st_business/XC_ST_WH_DELEVERED/data/stWhDeleveredLSelect',\n        params : {DELEVERED_L_ID : r.data.RE_DELEVERED_L_ID},\n        success : function(resp){\n            var rec = Wb.decode(resp.responseText);\n            if(newValue < rec.rows[0].AMOUNT * -1){\n                number.setValue(rec.rows[0].AMOUNT * -1);\n            }\n        }\n    });\n}"},"children":[],"expanded":false,"type":"number"}],"expanded":false,"type":"column"},{"configs":{"text":"{#XC_ST_WH_DELEVERED_LOCATION#}","width":"100","dataIndex":"LOCATION_NAME","titleAlign":"center","itemId":"LOCATION_NAME_COL_1"},"children":[{"configs":{"displayField":"LOCATION_NAME","valueField":"LOCATION_NAME","itemId":"editor","editable":"false"},"events":{"change":"if(Wb.isEmpty(newValue)){\n    var rec = gridCommon.getSelection()[0];\n    rec.set(\"LOCATION_ID\",null);\n    rec.set(\"LOCATION_NAME\",null);\n}","select":"var rec = gridCommon.getSelection()[0];\nrec.set(\"LOCATION_ID\",records[0].data.LOCATION_ID);\nrec.set(\"LOCATION_NAME\",records[0].data.LOCATION_NAME);"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/st/common/data/stLocationSelect"},"events":{"beforeload":"store.proxy.extraParams.IS_LAST = 'IS_LAST';\nstore.proxy.extraParams.LEDGER_ID = app.LEDGER_ID.getValue();\nstore.proxy.extraParams.WAREHOUSE_ID = app.WAREHOUSE_XWL.WAREHOUSE_ID.getValue();"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"}],"expanded":false,"type":"column"},{"configs":{"text":"{#XC_ST_WH_DELEVERED_PCXLH#}","align":"center","width":"100","dataIndex":"SERIAL_BATCH_NUM","titleAlign":"center","itemId":"SERIAL_BATCH_NUM_COL"},"children":[],"expanded":true,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"window"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}