{"inframe":false,"title":"","hidden":false,"roles":{"default":1},"children":[{"configs":{"loginRequired":"false","serverScript":"//---------------------获取当前模块语言对应的.json文件，放到request中----------------\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xc/st/st_business/XC_ST_TRANSSHIPMENT/json/XC_ST_TRANSSHIPMENT\");\nvar ctxPath = request.getContextPath() ;\nrequest.setAttribute('contextPath',ctxPath);","itemId":"module"},"events":{"finalize":"var tableValue = '';//窗口中的所有信息\nvar isEditCol = 'N';//判断是否更新过行信息","initialize":"Wb.isInsert = null;\nvar TR_H_ID = null;\nvar LEDGER_ID = null,\nORG_ID = null,\nORG_NAME = null;\nvar VALUATION_MODEL = null;\nExt.apply(app, {\n    initWin: function(params) {\n        Ext.apply(app, params);\n        app.win = new Ext.window.Window(app.editWinN);\n        app.win.show();\n        Wb.isInsert = params.IS_INSERT;\n        TR_H_ID = params.TR_H_ID;\n        LEDGER_ID = params.LEDGER_ID;\n        ORG_ID = params.ORG_ID;\n        ORG_NAME = params.ORG_NAME;\n        app.DEPT_ID_XWL.DEPT_NAME.setFieldLabel('<font color=\"red\">*<\/font>{#XC_ST_TRANSSHIPMENT_YWBM#}');\n        app.stDocCatCode.setValue(params.stDocCatCode);\n        app.grid1.store.load({params : {TR_H_ID : TR_H_ID}});\n        if (Wb.isInsert == 'Add') {//新增操作\n            app.TR_H_ID.setValue(TR_H_ID);\n            app.STATUS.setValue('1');\n            app.BIZ_DATE.setValue(new Date());\n            app.IS_CREATE.setValue('Y');\n            app.IN_WAREHOUSE_XWL.IN_WH_ID.setValue(params.IN_WH_ID);\n            app.IN_WAREHOUSE_XWL.IN_WAREHOUSE_NAME.setValue(params.IN_WAREHOUSE_NAME);\n            app.OUT_WAREHOUSE_XWL.OUT_WH_ID.setValue(params.OUT_WH_ID);\n            app.OUT_WAREHOUSE_XWL.OUT_WAREHOUSE_NAME.setValue(params.OUT_WAREHOUSE_NAME);\n            setQtyOrAmtStyle(params.IN_WH_ID,\"IN\");\n            setQtyOrAmtStyle(params.OUT_WH_ID,\"OUT\");\n            app.orgInitStore.load();\n        }\n        if (Wb.isInsert == 'Update') {//修改操作\n            app.IS_CREATE.setValue('N');\n            Wb.request({\n                url : 'm?xwl=xc/st/st_business/XC_ST_TRANSSHIPMENT/data/stTransshipmentHSelectById',\n                params : {TR_H_ID : TR_H_ID},\n                success : function(resp){\n                    var rec = Wb.decode(resp.responseText).rows[0];\n                    setQtyOrAmtStyle(rec.IN_WH_ID,\"IN\");\n                    setQtyOrAmtStyle(rec.OUT_WH_ID,\"OUT\");\n                    if(rec.STATUS !== '1')\n                        setAllReadOnly(true);\n                    else{\n                        setSomeReadOnly(true);\n                        setOrg(rec.ORG_ID,rec.LEDGER_ID);\n                        setMinDate(rec.LEDGER_ID);\n                    }\n                    rec.BIZ_DATE = Wb.strToDate(rec.BIZ_DATE);\n                    Wb.setValue(app.editWinN,rec);\n                    tableValue = Wb.encode(Wb.getValue(app.form1));\n                }\n            });\n        }\n        if (Wb.isInsert == 'Seek') {//查看操作\n            Wb.request({\n                url : 'm?xwl=xc/st/st_business/XC_ST_TRANSSHIPMENT/data/stTransshipmentHSelectById',\n                params : {TR_H_ID : TR_H_ID},\n                success : function(resp){\n                    var rec = Wb.decode(resp.responseText).rows[0];\n                    setQtyOrAmtStyle(rec.IN_WH_ID,\"IN\");\n                    setQtyOrAmtStyle(rec.OUT_WH_ID,\"OUT\");\n                    setAllReadOnly(true);\n                    rec.BIZ_DATE = Wb.strToDate(rec.BIZ_DATE);\n                    Wb.setValue(app.editWinN,rec);\n                }\n            });\n            setButtonHide();\n        }\n        if (Wb.isInsert == 'In') {//调入操作\n            app.IS_CREATE.setValue('N');\n            Wb.request({\n                url : 'm?xwl=xc/st/st_business/XC_ST_TRANSSHIPMENT/data/stTransshipmentHSelectById',\n                params : {TR_H_ID : TR_H_ID},\n                success : function(resp){\n                    var rec = Wb.decode(resp.responseText).rows[0];\n                    setSomeReadOnly(true);\n                    app.addBtn.setDisabled(true);\n                    app.delBtns.setDisabled(true);\n                    setOrg(rec.ORG_ID,rec.LEDGER_ID);\n                    setMinDate(rec.LEDGER_ID);\n                    app.OUT_WAREHOUSE_XWL.OUT_WAREHOUSE_NAME.setReadOnly(true);\n                    app.OUT_WAREHOUSE_KEEPER_XWL.OUT_EMP_NAME.setReadOnly(true);\n                    rec.BIZ_DATE = Wb.strToDate(rec.BIZ_DATE);\n                    Wb.setValue(app.editWinN,rec);\n                    app.store1.load({params: {TR_H_ID: app.TR_H_ID.getValue()},\n                        callback: function() {\n                            app.grid1.getStore().removeAll();\n                            for (var i = 0; i < app.store1.getCount(); i++) {\n                                var r = app.store1.getAt(i);\n                                app.grid1.getStore().add(r.getData());\n                            }\n                        }\n                    });\n                    tableValue = Wb.encode(Wb.getValue(app.form1));\n                }\n            });\n        }\n    }\n});\nfunction returnRowFn(r,type){\n    if(type==='xip_pub_orgs'){\n        app.LEDGER_ID.setValue(r.data.LEDGER_ID);\n        app.ORG_ID.setValue(r.data.ORG_ID);\n        setOrg(r.data.ORG_ID,r.data.LEDGER_ID);\n        setMinDate(r.data.LEDGER_ID);\n        clearAll();\n    }\n    //调出仓库\n    if(type==='xc_st_warehouse_out'){\n        setQtyOrAmtStyle(r.data.WAREHOUSE_ID,\"OUT\");\n        app.OUT_WAREHOUSE_KEEPER_XWL.OUT_WH_KEEPER_ID.reset();\n        app.OUT_WAREHOUSE_KEEPER_XWL.OUT_EMP_NAME.reset();\n        app.OUT_WAREHOUSE_KEEPER_XWL.WAREHOUSE_ID.setValue(r.data.WAREHOUSE_ID);\n//         app.IN_WAREHOUSE_XWL.VALUATION_MODEL.setValue(r.data.VALUATION_MODEL);\n        app.grid1.store.removeAll();\n    }\n    //调入仓库\n    if(type==='xc_st_warehouse_in'){\n        setQtyOrAmtStyle(r.data.WAREHOUSE_ID,\"IN\");\n        app.IN_WAREHOUSE_KEEPER_XWL.IN_WH_KEEPER_ID.reset();\n        app.IN_WAREHOUSE_KEEPER_XWL.IN_EMP_NAME.reset();\n        app.IN_WAREHOUSE_KEEPER_XWL.WAREHOUSE_ID.setValue(r.data.WAREHOUSE_ID);\n//         app.OUT_WAREHOUSE_XWL.VALUATION_MODEL.setValue(r.data.VALUATION_MODEL);\n        app.grid1.store.removeAll();\n    }\n    //调出仓库---为库管员加载之前加上仓库过滤条件\n    if(type == 'xc_st_warehouse_keeper_before_out'){\n        app.OUT_WAREHOUSE_KEEPER_XWL.WAREHOUSE_ID.setValue(app.OUT_WAREHOUSE_XWL.OUT_WH_ID.getValue());\n    }\n    //调入仓库---为库管员加载之前加上仓库过滤条件\n    if(type == 'xc_st_warehouse_keeper_before_in'){\n        app.IN_WAREHOUSE_KEEPER_XWL.WAREHOUSE_ID.setValue(app.IN_WAREHOUSE_XWL.IN_WH_ID.getValue());\n    }\n}\nfunction clearOtherFn(type){\n    if(type=='xip_pub_orgs'){\n        app.LEDGER_ID.setValue(null);\n        app.ORG_ID.setValue(null);\n    }\n    //调出仓库\n    if(type==='xc_st_warehouse_out'){\n        app.OUT_WAREHOUSE_KEEPER_XWL.OUT_WH_KEEPER_ID.reset();\n        app.OUT_WAREHOUSE_KEEPER_XWL.OUT_EMP_NAME.reset();\n        app.OUT_WAREHOUSE_KEEPER_XWL.WAREHOUSE_ID.reset();\n//         app.IN_WAREHOUSE_XWL.VALUATION_MODEL.setValue(null);\n        app.grid1.store.removeAll();\n    }\n    //调入仓库\n    if(type==='xc_st_warehouse_in'){\n        app.IN_WAREHOUSE_KEEPER_XWL.IN_WH_KEEPER_ID.reset();\n        app.IN_WAREHOUSE_KEEPER_XWL.IN_EMP_NAME.reset();\n        app.IN_WAREHOUSE_KEEPER_XWL.WAREHOUSE_ID.reset();\n//         app.OUT_WAREHOUSE_XWL.VALUATION_MODEL.setValue(null);\n        app.grid1.store.removeAll();\n    }\n}\nfunction setSomeReadOnly(flag){\n\tapp.ORG_XWL.ORG_NAME.setReadOnly(flag);\n    app.OUT_WAREHOUSE_XWL.OUT_WAREHOUSE_NAME.setReadOnly(flag);\n    app.IN_WAREHOUSE_XWL.IN_WAREHOUSE_NAME.setReadOnly(flag);\n}\nfunction setAllReadOnly(flag){\n\tsetSomeReadOnly(flag);\n    app.TR_H_NAME.setReadOnly(flag);\n    app.DEPT_ID_XWL.DEPT_NAME.setReadOnly(flag);\n    app.OUT_WAREHOUSE_KEEPER_XWL.OUT_EMP_NAME.setReadOnly(flag);\n    app.IN_WAREHOUSE_KEEPER_XWL.IN_EMP_NAME.setReadOnly(flag);\n    app.BIZ_DATE.setReadOnly(flag);\n    app.BUSINESS_TYPE_NAME.setReadOnly(flag);\n    app.PRICE_COL.getEditor().setReadOnly(flag);\n    app.AMOUNT_COL.getEditor().setReadOnly(flag);\n    app.IN_LOCATION_NAME_COL.getEditor().setReadOnly(flag);\n    app.OUT_LOCATION_NAME_COL.getEditor().setReadOnly(flag);\n    app.saveBtn.setDisabled(flag);\n    app.submitBtn.setDisabled(flag);\n    app.addBtn.setDisabled(flag);\n    app.delBtns.setDisabled(flag);\n}\nfunction setButtonHide(){\n    app.saveBtn.hide();\n    app.submitBtn.hide();\n    app.enclosureBtn.hide();\n    app.grid1Tbar.hide();\n}\nfunction setOrg(orgId,ledgerId) {\n    app.DEPT_ID_XWL.QUERY_LEDGER_ID.setValue(ledgerId);\n    app.OUT_WAREHOUSE_XWL.QUERY_ORG_ID.setValue(orgId);\n    app.OUT_WAREHOUSE_XWL.LEDGER_ID.setValue(ledgerId);\n    app.IN_WAREHOUSE_XWL.QUERY_ORG_ID.setValue(orgId);\n    app.IN_WAREHOUSE_XWL.LEDGER_ID.setValue(ledgerId);\n    app.OUT_WAREHOUSE_XWL.IS_INIT.setValue('Y');\n    app.IN_WAREHOUSE_XWL.IS_INIT.setValue('Y');\n}\nfunction clearAll(){\n    app.OUT_WAREHOUSE_XWL.OUT_WH_ID.reset();\n    app.OUT_WAREHOUSE_XWL.OUT_WAREHOUSE_NAME.reset();\n    app.IN_WAREHOUSE_XWL.IN_WH_ID.reset();\n    app.IN_WAREHOUSE_XWL.IN_WAREHOUSE_NAME.reset();\n    app.OUT_WAREHOUSE_KEEPER_XWL.OUT_WH_KEEPER_ID.reset();\n    app.OUT_WAREHOUSE_KEEPER_XWL.OUT_EMP_NAME.reset();\n    app.IN_WAREHOUSE_KEEPER_XWL.IN_WH_KEEPER_ID.reset();\n    app.IN_WAREHOUSE_KEEPER_XWL.IN_EMP_NAME.reset();\n    app.BUSINESS_TYPE_ID.reset();\n    app.BUSINESS_TYPE_NAME.reset();\n\tapp.DEPT_ID_XWL.DEPT_NAME.reset();\n\tapp.DEPT_ID_XWL.DEPT_ID.reset();\n    app.grid1.store.removeAll();\n}\nfunction setMinDate(ledgerId){\n    Wb.request({//账簿会计期查询\n        url : 'm?xwl=xc/st/common/data/ledgerDateSelect',\n        params : {LEDGER_ID : ledgerId},\n        success : function(resp){\n            var temp = Wb.decode(resp.responseText);\n            if(temp.rows[0].START_DATE !== null && temp.rows[0].START_DATE !== \"\"){\n                app.BIZ_DATE.setMinValue(Wb.strToDate(temp.rows[0].START_DATE));\n                app.BIZ_DATE.setReadOnly(false);\n            }\n            else {\n                if(app.LEDGER_ID.getValue() !== null && app.LEDGER_ID.getValue() !== \"\"){\n                    Wb.toast('{#XC_ST_TRANSSHIPMENT_gzbmyqykjqqcxxz#}');//该账簿没有启用会计期，请重新选择！\n                    app.BIZ_DATE.reset();\n                    app.BIZ_DATE.setReadOnly(true);\n                }\n            }\n        }\n    });\n}\nfunction setDeptInfo(orgId){\n    Wb.request({\n        url : 'm?xwl=xc/ar/ct/data/selectDeptInfoByUserId',\n        params : {USER_ID : '{#XIP.userId#}',ORG_ID : orgId},\n        async : false,\n        success : function(resp){\n            var temp = Wb.decode(resp.responseText);\n            app.DEPT_ID_XWL.DEPT_ID.setValue(temp.DEPT_ID);\n            app.DEPT_ID_XWL.DEPT_NAME.setValue(temp.DEPT_NAME);\n        }\n    });\n}\n//通过改变仓库来控制单价和金额是否可录入\nfunction setQtyOrAmtStyle(WAREHOUSE_ID,flag){\n    if(!Wb.isEmpty(WAREHOUSE_ID)){\n        Wb.request({\n            url : 'm?xwl=xc/st/ld_base/XC_ST_WAREHOUSE/data/stWarehouseSelect',\n            params : {WAREHOUSE_IDS : WAREHOUSE_ID,ALL : 'ALL'},\n            async : false,\n            success : function(resp){\n                var res = Wb.decode(resp.responseText);\n                if(res.total > 0){\n                    VALUATION_MODEL = res.rows[0].VALUATION_MODEL;\n                    if(VALUATION_MODEL == 'FJZK'){//非价值库不用录入单价和金额\n                        for(var i = 0;i < app.grid1.store.getCount();i++){\n                            var data = app.grid1.store.getAt(i);\n                            data.set('PRICE',null);\n                            data.set('AMOUNT',null);\n                        }\n                        app.PRICE_COL.getEditor().setReadOnly(true);\n                        app.AMOUNT_COL.getEditor().setReadOnly(true);\n                        app.PRICE_COL.setText('{#XC_ST_TRANSSHIPMENT_PRICE#}');\n                        app.AMOUNT_COL.setText('{#XC_ST_TRANSSHIPMENT_AMOUNT#}');\n                        app.PRICE_COL.getEditor().allowBlank = true;\n                        app.AMOUNT_COL.getEditor().allowBlank = true;\n                    }\n                    else{\n                        app.PRICE_COL.getEditor().setReadOnly(false);\n                        app.AMOUNT_COL.getEditor().setReadOnly(false);\n                        app.PRICE_COL.setText('<font color=\"red\">*<\/font>{#XC_ST_TRANSSHIPMENT_PRICE#}');\n                        app.AMOUNT_COL.setText('<font color=\"red\">*<\/font>{#XC_ST_TRANSSHIPMENT_AMOUNT#}');\n                        app.PRICE_COL.getEditor().allowBlank = false;\n                        app.AMOUNT_COL.getEditor().allowBlank = false;\n                    }\n                    if(flag == 'IN'){//调入仓库\n//                         app.OUT_WAREHOUSE_XWL.VALUATION_MODEL.setValue(VALUATION_MODEL);\n                        //通过仓库是否启用货位，来控制行信息的货位是否为必填\n                        if(res.rows[0].IS_LOCATION == 'Y'){//启用货位管理\n                            app.IN_LOCATION_NAME_COL.getEditor().setReadOnly(false);\n                            app.IN_LOCATION_NAME_COL.getEditor().allowBlank = false;\n                            app.IN_LOCATION_NAME_COL.setText('<font color=\"red\">*<\/font>{#XC_ST_TRANSSHIPMENT_IN_LOCATION_NAME#}');\n                        }\n                        else{\n                            app.IN_LOCATION_NAME_COL.getEditor().setReadOnly(true);\n                            app.IN_LOCATION_NAME_COL.getEditor().allowBlank = true;\n                            app.IN_LOCATION_NAME_COL.setText('{#XC_ST_TRANSSHIPMENT_IN_LOCATION_NAME#}');\n                        }\n                    }\n                    if(flag == 'OUT'){//调出仓库\n//                         app.IN_WAREHOUSE_XWL.VALUATION_MODEL.setValue(VALUATION_MODEL);\n                        //通过仓库是否启用货位，来控制行信息的货位是否为必填\n                        if(res.rows[0].IS_LOCATION == 'Y'){//启用货位管理\n                            app.OUT_LOCATION_NAME_COL.getEditor().setReadOnly(false);\n                            app.OUT_LOCATION_NAME_COL.getEditor().allowBlank = false;\n                            app.OUT_LOCATION_NAME_COL.setText('<font color=\"red\">*<\/font>{#XC_ST_TRANSSHIPMENT_OUT_LOCATION_NAME#}');\n                        }\n                        else{\n                            app.OUT_LOCATION_NAME_COL.getEditor().setReadOnly(true);\n                            app.OUT_LOCATION_NAME_COL.getEditor().allowBlank = true;\n                            app.OUT_LOCATION_NAME_COL.setText('{#XC_ST_TRANSSHIPMENT_OUT_LOCATION_NAME#}');\n                        }\n                    }\n                }\n            }\n        });\n    }\n}"},"children":[{"configs":{"itemId":"tools"},"children":[{"configs":{"itemId":"orgInitStore","url":"m?xwl=xc/com-lov/ORG_PICK/DB/ORG_SELECT_BY_LEDGER"},"events":{"load":"if(!Wb.isEmpty(ORG_NAME) && Wb.isInsert == 'Add'){\n    app.ORG_ID.setValue(ORG_ID);\n    app.LEDGER_ID.setValue(LEDGER_ID);\n    app.ORG_XWL.ORG_ID.setValue(ORG_ID);\n    app.ORG_XWL.ORG_NAME.setValue(ORG_NAME);\n    app.ORG_XWL.LEDGER_ID.setValue(LEDGER_ID);\n}\nif(Wb.isEmpty(ORG_NAME)){\n    if(store.getCount() > 0){\n        app.ORG_ID.setValue(store.getAt(0).get('ORG_ID'));\n        app.LEDGER_ID.setValue(store.getAt(0).get('LEDGER_ID'));\n        app.ORG_XWL.ORG_ID.setValue(store.getAt(0).get('ORG_ID'));\n        app.ORG_XWL.ORG_NAME.setValue(store.getAt(0).get('ORG_NAME'));\n        app.ORG_XWL.LEDGER_ID.setValue(store.getAt(0).get('LEDGER_ID'));\n    }\n}\nsetOrg(app.ORG_ID.getValue(),app.LEDGER_ID.getValue());\nsetMinDate(app.LEDGER_ID.getValue());\nsetDeptInfo(app.ORG_ID.getValue());\napp.BUSINESS_TYPE_NAME.getStore().load();"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"store1","url":"m?xwl=xc/st/st_business/XC_ST_TRANSSHIPMENT/data/stTransshipmentLSelect"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"folder"},{"configs":{"maximized":"true","height":"530","width":"900","layout":"border","closeAction":"hide","border":"false","itemId":"editWinN","modal":"true","maximizable":"true"},"events":{"hide":"app.hideFun();"},"children":[{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"{#XC_ST_TRANSSHIPMENT_saveBtn#}","itemId":"saveBtn","iconCls":"save_icon"},"events":{"click":"/*--------------  验证数据是否合法  ---------------*/\nif (Wb.verify(app.editWinN) && Wb.verifyGrid(app.grid1)) {\n    //判断是否有明细\n    var store = app.grid1.store;\n    if(store.getCount() === 0){\n        Wb.toast('{#XC_ST_TRANSSHIPMENT_qtjmxsj#}');//请添加明细数据！\n        return;\n    }\n    //通过明细算出主表中的金额值\n    var AMOUNT = 0;\n    for (var i = 0; i < app.grid1.getStore().getCount(); i++) {\n        var r = app.grid1.getStore().getAt(i);\n        AMOUNT = AMOUNT + r.get('AMOUNT');\n    }\n    app.AMOUNT.setValue(AMOUNT);\n    Wb.sync({\n        url : '{#contextPath#}'+'/xcStDocsAction.do?method=saveOrUpdateXcStDocs',\n        grid : app.grid1,\n        params  : Wb.getValue(app.form1),\n        success : function(resp){\n            var record = Wb.decode(resp.responseText);\n            var msg = record.msg;\n            if(record.flag === '0'){\n                Wb.isInsert = 'Update';\n                Wb.toast('{#XC_ST_TRANSSHIPMENT_bccg#}');\n                app.TR_H_CODE.setValue(record.docCode);\n                setSomeReadOnly(true);\n                app.grid1.store.load({params : {TR_H_ID : TR_H_ID}});\n                app.IS_CREATE.setValue('N');\n                tableValue = Wb.encode(Wb.getValue(app.form1));\n                isEditCol = 'N';\n            }\n            else{\n                Wb.toast(msg);//保存失败！\n            }\n        }\n    });\n} else {\n    Wb.verifyGrid(app.grid1);\n    Wb.toast('{#XC_ST_TRANSSHIPMENT_qsrsybsx#}');\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#XC_ST_TRANSSHIPMENT_submitBtn#}","itemId":"submitBtn","iconCls":"check_icon"},"events":{"click":"if(Wb.isInsert=='Add' || tableValue !== Wb.encode(Wb.getValue(app.form1)) || isEditCol == 'Y'){\n    Wb.toast('{#XC_ST_TRANSSHIPMENT_qxbcztj#}');//\n    return false;\n}\nif(app.STATUS.getValue() != '1'){\n    Wb.toast('{#XC_ST_TRANSSHIPMENT_sxdjfcgztbntj#}');//所选记录非草稿状态，不能提交！\n    return;\n}\nWb.request({\n    url: '{#contextPath#}'+'/xcStCommonAction.do?method=updateXcStDocStatus',\n    params: Wb.apply({stDocId : app.TR_H_ID.getValue(),docClassCode : 'WZDBD'}),\n    success: function(resp) {\n        var record = Wb.decode(resp.responseText);\n        if(record.flag == '0'){\n            Wb.toast('{#XC_ST_TRANSSHIPMENT_tjcg#}');\n            setAllReadOnly(true);\n            app.STATUS.setValue('3');\n            tableValue = Wb.encode(Wb.getValue(app.form1));\n        }\n        else\n            Wb.toast(record.msg);\n    }\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#XC_ST_TRANSSHIPMENT_enclosureBtn#}","itemId":"enclosureBtn","iconCls":"attach_icon"},"events":{"click":"if(Wb.isInsert == 'Add'){\n    Wb.toast('{#XC_ST_TRANSSHIPMENT_qxbcztjfj#}');\n    return false;\n}\nvar temp_id = app.TR_H_ID.getValue();\nvar temp_code = app.TR_H_CODE.getValue();\nWb.request({\n    url : '{#contextPath#}' + '/xcStCommonAction.do?method=getXcStAttCatCode',\n    params : {LEDGER_ID : app.LEDGER_ID.getValue(),DOC_CAT_CODE : app.DOC_CAT_CODE.getValue()},\n    success : function(resp){\n        var temp = Wb.decode(resp.responseText);\n        if(temp.flag == '0'){\n            var attCatCode = temp.attCatCode;\n            Xip.showAttachmentManager('{#XIP.userId#}',temp_id,'',attCatCode,temp_code,'Y','Y','Y',function(){},10); \n        }\n        else{\n            Wb.toast(temp.msg);\n        }\n    }\n});"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"array"},{"configs":{"region":"north","frame":"false","border":"false","bodyPadding":"0 0 0 0","itemId":"form1"},"children":[{"configs":{"style":"fontSize:20px","html":"<font style=\"\">{#XC_ST_TRANSSHIPMENT_dbd#}<\/font>","margin":"10 0 20 0","labelAlign":"center","itemId":"title"},"children":[],"expanded":false,"type":"label"},{"configs":{"frame":"false","layout":"column","margin":"5 0 0 0","border":"false","itemId":"tr_1"},"children":[{"configs":{"frame":"false","style":"border-width:0px","layout":"form","columnWidth":".249","border":"false","itemId":"td_1_1"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/ORG_PICK/ORG_ALL_PICK","itemId":"ORG_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"frame":"false","style":"border-width:0px","layout":"form","columnWidth":".249","border":"false","itemId":"td_1_2"},"children":[{"configs":{"labelWidth":"80","allowBlank":"false","displayField":"BUSINESS_TYPE_NAME","valueField":"BUSINESS_TYPE_NAME","labelAlign":"right","itemId":"BUSINESS_TYPE_NAME","fieldLabel":"<font color='red'>*<\/font>{#XC_ST_TRANSSHIPMENT_BUSINESS_TYPE_NAME#}","editable":"false"},"events":{"select":"app.BUSINESS_TYPE_ID.setValue(records[0].data.BUSINESS_TYPE_ID);"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/st/ld_base/XC_ST_LD_BUSINESS_TYPE/data/stLdBusinessTypeSelect"},"events":{"load":"if(store.getCount() > 0){\n    app.BUSINESS_TYPE_NAME.setValue(store.getAt(0).get('BUSINESS_TYPE_NAME'));\n    app.BUSINESS_TYPE_ID.setValue(store.getAt(0).get('BUSINESS_TYPE_ID'));\n}","beforeload":"store.proxy.extraParams.LEDGER_ID = app.LEDGER_ID.getValue();\nstore.proxy.extraParams.DOC_CAT_CODE = app.DOC_CAT_CODE.getValue();"},"children":[],"expanded":false,"type":"store"}],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"frame":"false","style":"border-width:0px","layout":"form","columnWidth":".249","border":"false","itemId":"td_1_3"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"TR_H_CODE","fieldLabel":"{#XC_ST_TRANSSHIPMENT_TR_H_CODE#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"frame":"false","style":"border-width:0px","layout":"form","columnWidth":".249","border":"false","itemId":"td_1_4"},"children":[{"configs":{"labelWidth":"80","allowBlank":"false","labelAlign":"right","itemId":"BIZ_DATE","fieldLabel":"<font color='red'>*<\/font>{#XC_ST_TRANSSHIPMENT_BIZ_DATE#}"},"children":[],"expanded":false,"type":"date"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"frame":"false","layout":"column","margin":"5 0 0 0","border":"false","itemId":"tr_2"},"children":[{"configs":{"frame":"false","style":"border-width:0px","layout":"form","columnWidth":".249","border":"false","itemId":"td_2_1"},"children":[{"configs":{"file":"m?xwl=xc/st/common/st_com_lov/XC_ST_WAREHOUSE_LOV/XC_ST_WAREHOUSE_LOV_OUT","itemId":"OUT_WAREHOUSE_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"frame":"false","style":"border-width:0px","layout":"form","columnWidth":".249","border":"false","itemId":"td_2_2"},"children":[{"configs":{"file":"m?xwl=xc/st/common/st_com_lov/XC_ST_WAREHOUSE_LOV/XC_ST_WAREHOUSE_LOV_IN","itemId":"IN_WAREHOUSE_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"frame":"false","style":"border-width:0px","layout":"form","columnWidth":".249","border":"false","itemId":"td_2_3"},"children":[{"configs":{"file":"m?xwl=xc/st/common/st_com_lov/XC_ST_WAREHOUSE_KEEPER_LOV/XC_ST_WAREHOUSE_KEEPER_LOV_OUT","itemId":"OUT_WAREHOUSE_KEEPER_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"frame":"false","style":"border-width:0px","layout":"form","columnWidth":".249","border":"false","itemId":"td_2_4"},"children":[{"configs":{"file":"m?xwl=xc/st/common/st_com_lov/XC_ST_WAREHOUSE_KEEPER_LOV/XC_ST_WAREHOUSE_KEEPER_LOV_IN","itemId":"IN_WAREHOUSE_KEEPER_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"frame":"false","layout":"column","margin":"5 0 5 0","border":"false","itemId":"tr_3"},"children":[{"configs":{"frame":"false","style":"border-width:0px","layout":"form","columnWidth":".249","itemId":"td_3_1","border":"false"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/DEPT_ID_PICK/DEPT_ID_LD","itemId":"DEPT_ID_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"frame":"false","style":"border-width:0px","layout":"form","columnWidth":".498","border":"false","itemId":"td_3_2"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"TR_H_NAME","fieldLabel":"{#XC_ST_TRANSSHIPMENT_TR_H_NAME#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"frame":"false","style":"border-width:0px","layout":"form","columnWidth":".249","border":"false","itemId":"td_3_3"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","pickList":"[\n  ['1','{#XC_ST_TRANSSHIPMENT_STATUS_1#}'],\n  ['2','{#XC_ST_TRANSSHIPMENT_STATUS_2#}'],\n  ['3','{#XC_ST_TRANSSHIPMENT_STATUS_3#}'],\n  ['4','{#XC_ST_TRANSSHIPMENT_STATUS_4#}']\n]","labelAlign":"right","itemId":"STATUS","fieldLabel":"{#XC_ST_TRANSSHIPMENT_STATUS#}"},"children":[],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"frame":"false","hidden":"true","layout":"column","border":"false","itemId":"hidePanel"},"children":[{"configs":{"itemId":"ORG_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"LEDGER_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"TR_H_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"AMOUNT"},"children":[],"expanded":false,"type":"number"},{"configs":{"hidden":"true","itemId":"BUSINESS_TYPE_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","value":"DBD","itemId":"DOC_CAT_CODE"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"IS_CREATE"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","value":"WZDBD","itemId":"docClassCode"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"stDocCatCode"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"form"},{"configs":{"region":"center","selType":"checkboxmodel","itemId":"grid1","editable":"true"},"events":{"tagEvents":"'cellclick' : function(grid1,td,cellIndex,record,tr,rowIndex,e,eOpts){\n    //序列号窗口\n    if(cellIndex == 12){\n        if(!Wb.isEmpty(grid1.store.getModifiedRecords())){\n        \tWb.toast('{#XC_ST_TRANSSHIPMEN_qxbcdjhxx#}');//请先保存单据行信息，在添加序列号/批次！\n            return;\n        }\n        Wb.run({\n            url: 'm?xwl=xc/st/common/st_com_lov/XC_ST_WH_B_SER/XC_ST_WH_B_SER', \n            success: function(apps) {\n                apps.initWin({\n                    BUSINESS_L_ID : record.data.ENTRY_L_ID,\n                    BUSINESS_H_ID : record.data.ENTRY_H_ID,\n                    ORG_ID : app.ORG_ID.getValue(),\n                    LEDGER_ID : app.LEDGER_ID.getValue(),\n                    MATERIAL_ID : record.data.MATERIAL_ID,\n                    LOCATION_ID : record.data.OUT_LOCATION_ID,\n                    LOCATION_NAME : record.data.OUT_LOCATION_NAME,\n                    QTY : record.data.QTY,\n                    STATUS : app.STATUS.getValue(),\n                    DOC_CAT_CODE : app.DOC_CAT_CODE.getValue(),\n                    BUSINESS_TYPE_ID : app.BUSINESS_TYPE_ID.getValue(),\n                    opType : Wb.isInsert,\n                    hideFun : function(rs){\n                    }\n                });\n            }\n        });\n    }\n}"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/st/st_business/XC_ST_TRANSSHIPMENT/data/stTransshipmentLSelect"},"events":{"update":"isEditCol = 'Y';","remove":"isEditCol = 'Y';","add":"isEditCol = 'Y';"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"tbar","normalName":"grid1Tbar"},"children":[{"configs":{"text":"{#XC_ST_TRANSSHIPMENT_addLBtn#}","itemId":"addBtn","iconCls":"file_add_icon"},"events":{"click":"if(Wb.isEmpty(app.OUT_WAREHOUSE_XWL.OUT_WAREHOUSE_NAME.getValue()) || Wb.isEmpty(app.IN_WAREHOUSE_XWL.IN_WAREHOUSE_NAME.getValue())){\n\tWb.toast('{#XC_ST_TRANSSHIPMENT_qxxzck#}');\n    return;\n}\nif(VALUATION_MODEL == 'YDJQPJF')//移动加权平局法\n    url = 'm?xwl=xc/st/common/st_com_lov/XC_ST_MATERIAL_LOV/XC_ST_MATERIAL_LOV_YDJQPJF';\nif(VALUATION_MODEL == 'FJZK')//非价值库\n    url = 'm?xwl=xc/st/common/st_com_lov/XC_ST_MATERIAL_LOV/XC_ST_MATERIAL_LOV_FJZK';\nif(VALUATION_MODEL == 'GBJJF')//个别计价法\n    url = 'm?xwl=xc/st/common/st_com_lov/XC_ST_MATERIAL_LOV/XC_ST_MATERIAL_LOV_GBJJ';\nif(VALUATION_MODEL == 'XJXCF')//先进先出法\n    url = 'm?xwl=xc/st/common/st_com_lov/XC_ST_MATERIAL_LOV/XC_ST_MATERIAL_LOV_XJXC';\nWb.run({\n    url: url, \n    success: function(apps) {\n        apps.initWin({\n            LEDGER_ID : app.LEDGER_ID.getValue(),\n            ORG_ID : app.ORG_ID.getValue(),\n            WAREHOUSE_ID : app.OUT_WAREHOUSE_XWL.OUT_WH_ID.getValue(),\n            hideFun : function(rs){\n                Wb.each(rs, function(r) {\n                    var grid1Store = app.grid1.getStore();\n                    Wb.add(app.grid1, {\n                        TR_L_ID : Xip.getId(),\n                        TR_H_ID : app.TR_H_ID.getValue(),\n                        MATERIAL_ID : r.get('MATERIAL_ID'),\n                        ENTRY_H_ID : r.get('ENTRY_H_ID'),\n                        ENTRY_L_ID : r.get('ENTRY_L_ID'),\n                        ENTRY_H_CODE : r.get('ENTRY_H_CODE'),\n                        ENTRY_L_CODE : r.get('ENTRY_L_CODE'),\n                        QTY : r.get('CKSL'),\n                        AMOUNT : (VALUATION_MODEL != 'FJZK') ? r.get('CKCB') : null,\n                        PRICE : (VALUATION_MODEL != 'FJZK') ? r.get('CKCB') / r.get('CKSL') : null,\n                        SPECIFICATION : r.get('SPECIFICATION'),\n                        MATERIAL_CODE : r.get('MATERIAL_CODE'),\n                        MATERIAL_NAME : r.get('MATERIAL_NAME'),\n                        SERIAL_BATCH_NUM : r.get('SERIAL_BATCH_NUM'),\n                        B_SERIAL_ID : r.get('B_SERIAL_ID'),\n                        DIM_ID : r.get('DIM_ID'),\n                        DIM_NAME : r.get('DIM_NAME'),\n                        ORG_ID : app.ORG_ID.getValue(),\n                        LEDGER_ID : app.LEDGER_ID.getValue()\n                    },'after', 1, false);\n                });\n            }\n        });\n    }\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#XC_ST_TRANSSHIPMENT_delLBtn#}","itemId":"delBtns","iconCls":"file_delete_icon"},"events":{"click":"//删除原则，先将选中记录在表格中移除，点击主单保存时，才真正从数据库删除。\nvar recs = app.grid1.getSelection();\nif (!recs.length) {\n    Wb.toast('{#XC_ST_TRANSSHIPMENT_qxzxyscdjl#}');//请选择需要删除的记录！\n    return;\n}\nWb.confirm('{#XC_ST_TRANSSHIPMENT_qdyscxzd#} ' + recs.length + ' {#XC_ST_TRANSSHIPMENT_tjlm#}',function() {\n\tWb.remove(app.grid1,recs);\n});"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"TR_L_ID","hidden":"true","dataIndex":"TR_L_ID","titleAlign":"center","itemId":"TR_L_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"TR_H_ID","hidden":"true","dataIndex":"TR_H_ID","titleAlign":"center","itemId":"TR_H_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"<font color='red'>*<\/font>{#XC_ST_TRANSSHIPMENT_MATERIAL_CODE#}","width":"120","dataIndex":"MATERIAL_CODE","titleAlign":"center","itemId":"MATERIAL_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"<font color='red'>*<\/font>{#XC_ST_TRANSSHIPMENT_MATERIAL_NAME#}","width":"120","dataIndex":"MATERIAL_NAME","titleAlign":"center","itemId":"MATERIAL_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#XC_ST_TRANSSHIPMENT_SPECIFICATION#}","width":"100","dataIndex":"SPECIFICATION","titleAlign":"center","itemId":"SPECIFICATION_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"<font color='red'>*<\/font>{#XC_ST_TRANSSHIPMENT_QTY#}","align":"right","width":"100","dataIndex":"QTY","titleAlign":"center","itemId":"QTY_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"<font color='red'>*<\/font>{#XC_ST_TRANSSHIPMENT_DIM_NAME#}","width":"80","dataIndex":"DIM_NAME","titleAlign":"center","itemId":"DIM_NAME_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"<font color='red'>*<\/font>{#XC_ST_TRANSSHIPMENT_PRICE#}","width":"100","align":"right","dataIndex":"PRICE","format":"0,000.00","titleAlign":"center","itemId":"PRICE_COL"},"children":[{"configs":{"decimalPrecision":"6","allowBlank":"false","minValue":"0","itemId":"editor"},"events":{"change":"var r = app.grid1.getSelection()[0];\nr.set('AMOUNT',r.data.QTY * newValue);"},"children":[],"expanded":false,"type":"number"}],"expanded":false,"type":"column"},{"configs":{"text":"<font color='red'>*<\/font>{#XC_ST_TRANSSHIPMENT_AMOUNT#}","width":"100","align":"right","dataIndex":"AMOUNT","format":"0,000.00","titleAlign":"center","itemId":"AMOUNT_COL"},"children":[{"configs":{"decimalPrecision":"6","allowBlank":"false","itemId":"editor"},"events":{"change":"var r = app.grid1.getSelection()[0];\nr.set('PRICE',newValue / r.data.QTY);"},"children":[],"expanded":false,"type":"number"}],"expanded":false,"type":"column"},{"configs":{"text":"{#XC_ST_TRANSSHIPMENT_PCXLH#}","width":"100","dataIndex":"SERIAL_BATCH_NUM","titleAlign":"center","itemId":"SERIAL_BATCH_NUM_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#XC_ST_TRANSSHIPMENT_OUT_LOCATION_NAME#}","width":"100","dataIndex":"OUT_LOCATION_NAME","titleAlign":"center","itemId":"OUT_LOCATION_NAME_COL"},"children":[{"configs":{"displayField":"LOCATION_NAME","valueField":"LOCATION_NAME","itemId":"editor"},"events":{"change":"if(Wb.isEmpty(newValue)){\n    var rec = app.grid1.getSelection()[0];\n    rec.set(\"OUT_LOCATION_ID\",null);\n    rec.set(\"OUT_LOCATION_NAME\",null);\n}","select":"var rec = app.grid1.getSelection()[0];\nrec.set(\"OUT_LOCATION_ID\",records[0].data.LOCATION_ID);\nrec.set(\"OUT_LOCATION_NAME\",records[0].data.LOCATION_NAME);"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/st/common/data/stLocationSelect"},"events":{"beforeload":"store.proxy.extraParams.IS_LAST = 'IS_LAST';\nstore.proxy.extraParams.LEDGER_ID = app.LEDGER_ID.getValue();\nstore.proxy.extraParams.WAREHOUSE_ID = app.OUT_WAREHOUSE_XWL.OUT_WH_ID.getValue();"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"}],"expanded":false,"type":"column"},{"configs":{"text":"{#XC_ST_TRANSSHIPMENT_IN_LOCATION_NAME#}","width":"100","dataIndex":"IN_LOCATION_NAME","titleAlign":"center","itemId":"IN_LOCATION_NAME_COL"},"children":[{"configs":{"displayField":"LOCATION_NAME","valueField":"LOCATION_NAME","itemId":"editor"},"events":{"change":"if(Wb.isEmpty(newValue)){\n    var rec = app.grid1.getSelection()[0];\n    rec.set(\"IN_LOCATION_ID\",null);\n    rec.set(\"IN_LOCATION_NAME\",null);\n}","select":"var rec = app.grid1.getSelection()[0];\nrec.set(\"IN_LOCATION_ID\",records[0].data.LOCATION_ID);\nrec.set(\"IN_LOCATION_NAME\",records[0].data.LOCATION_NAME);"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/st/common/data/stLocationSelect"},"events":{"beforeload":"store.proxy.extraParams.IS_LAST = 'IS_LAST';\nstore.proxy.extraParams.LEDGER_ID = app.LEDGER_ID.getValue();\nstore.proxy.extraParams.WAREHOUSE_ID = app.IN_WAREHOUSE_XWL.IN_WH_ID.getValue();"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"}],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"window"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}