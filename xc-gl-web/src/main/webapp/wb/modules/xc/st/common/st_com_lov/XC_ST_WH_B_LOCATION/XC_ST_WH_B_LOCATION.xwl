{"inframe":false,"title":"入库及退货货位表","hidden":false,"roles":{"default":1},"children":[{"configs":{"serverScript":"//---------------------获取当前模块语言对应的.json文件，放到request中----------------\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xc/st/common/json/XC_ST_COMMON\");","itemId":"module"},"events":{"initialize":"var opType = \"Add\";\nvar LOCATION_NAME = null;\nvar WAREHOUSE_ID,MATERIAL_ID,SERIAL_BATCH_NUM,BUSINESS_H_ID,BUSINESS_L_ID,DOC_CAT_CODE_01;\nExt.apply(app,{\n\tinitWin:function(params){\n        Ext.apply(app,params);\n        app.window = new Ext.window.Window(app.window);\n        LOCATION_NAME = params.LOCATION_NAME;\n        WAREHOUSE_ID = params.WAREHOUSE_ID;\n        MATERIAL_ID = params.MATERIAL_ID;\n        SERIAL_BATCH_NUM = params.SERIAL_BATCH_NUM;\n        BUSINESS_H_ID = params.BUSINESS_H_ID;\n        BUSINESS_L_ID = params.BUSINESS_L_ID;\n        DOC_CAT_CODE_01 = params.DOC_CAT_CODE_01;\n        app.MATERIAL_NAME.setValue(params.MATERIAL_NAME);\n        app.CKSL.setValue(Math.abs(params.QTY));\n        app.window.setTitle('{#XC_ST_COMMON_record#}'+'{#XC_ST_COMMON_LOCATION_NAME#}');\n        //根据业务类型主ID和行ID，查找货位表信息\n        Wb.request({\n            url : 'm?xwl=xc/st/common/st_com_lov/XC_ST_WH_B_LOCATION/data/stWhBLocationSelect',\n            params : {BUSINESS_H_ID : BUSINESS_H_ID,BUSINESS_L_ID : BUSINESS_L_ID},\n            async : false,\n            success : function(resp){\n                var rec = Wb.decode(resp.responseText);\n                if(rec.total > 0){//已经录入过货位信息\n                    app.HWXCL_COL.hide();\n                    app.grid.store.load({params : {BUSINESS_H_ID : BUSINESS_H_ID,BUSINESS_L_ID : BUSINESS_L_ID,MATERIAL_ID : MATERIAL_ID,SERIAL_BATCH_NUM : SERIAL_BATCH_NUM}});\n                    app.window.show();\n                }\n                else{//未录入过货位信息\n                    app.grid.store.load({params : {WAREHOUSE_ID : WAREHOUSE_ID,MATERIAL_ID : MATERIAL_ID,SERIAL_BATCH_NUM : SERIAL_BATCH_NUM,DOC_CAT_CODE_01 : DOC_CAT_CODE_01},async : false,callback : function(){\n                        app.locationStore.load({params : {WAREHOUSE_ID : WAREHOUSE_ID,MATERIAL_ID : MATERIAL_ID,SERIAL_BATCH_NUM : SERIAL_BATCH_NUM,DOC_CAT_CODE_01 : DOC_CAT_CODE_01},async : false,callback : function(){\n                            app.grid.store.removeAll();\n                            for(var i = 0;i < app.locationStore.getCount();i++){\n                                var data = app.locationStore.getAt(i);\n                                data.set('RE_B_LOCATION_ID',data.get('B_LOCATION_ID'));\n                                data.set('B_LOCATION_ID',Xip.getId());\n                                data.set('DOC_CAT_CODE',params.DOC_CAT_CODE);\n                                data.set('BUSINESS_TYPE_ID',params.BUSINESS_TYPE_ID);\n                                data.set('BUSINESS_H_ID',BUSINESS_H_ID);\n                                data.set('BUSINESS_L_ID',BUSINESS_L_ID);\n                                data.set('QTY',null);\n                                data.set('DELEVERED_QTY',null);\n                                app.grid.getStore().add(data.data);\n                            }\n                            app.window.show();\n                        }});\n                    }});\n                }\n                if(params.STATUS != '1' && !Wb.isEmpty(params.STATUS) || params.opType == 'Seek'){//提交之后不能修改\n                    app.tbar.hide();\n                    app.CKSL_COL.getEditor().setReadOnly(true);\n                }\n            }\n        });\n    }\n});"},"children":[{"configs":{"itemId":"tools"},"children":[{"configs":{"itemId":"locationStore","url":"m?xwl=xc/st/common/st_com_lov/XC_ST_WH_B_LOCATION/data/stWhBLocationSelect"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"folder"},{"configs":{"height":"400","width":"650","layout":"border","closeAction":"hide","border":"false","itemId":"window","modal":"true"},"events":{"hide":"app.hideFun();"},"children":[{"configs":{"region":"north","itemId":"form"},"children":[{"configs":{"layout":"column","margin":"5 0 5 0","border":"false","itemId":"row1"},"children":[{"configs":{"layout":"form","columnWidth":".33","border":"false","itemId":"row1_1"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"MATERIAL_NAME","fieldLabel":"{#XC_ST_COMMON_MATERIAL#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".33","border":"false","itemId":"row1_2"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"CKSL","fieldLabel":"{#XC_ST_COMMON_cksl#}"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".33","border":"false","itemId":"row1_3"},"children":[{"configs":{"labelWidth":"80","hidden":"true","labelAlign":"right","itemId":"LOCATION_NAME","fieldLabel":"{#XC_ST_COMMON_LOCATION_NAME#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"form"},{"configs":{"region":"center","pagingBar":"false","selType":"checkboxmodel","itemId":"grid","editable":"true"},"events":{"tagEvents":"cellclick:function(view, td, cellIndex, record, tr, rowIndex, event, options){\n    if(cellIndex == 6){\n        app.CKSL_COL.getEditor().setMaxValue(record.get('PCXCL'));\n    }\n}"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/st/common/st_com_lov/XC_ST_WH_B_LOCATION/data/stWhBLocationSelect"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"{#XC_ST_COMMON_saveBtn#}","itemId":"saveBtn","iconCls":"save_icon"},"events":{"click":"var rec = app.grid.getSelection();//选择一行信息\nvar modify = app.grid.store.getModifiedRecords();\nif(modify === '' || modify.length === 0){\n    Wb.toast('{#XC_ST_COMMON_mysjxybc#}');//没有数据需要保存！\n\treturn;\n}\n//通过明细算出主表中的金额值\nvar totalQty = 0;\nfor (var i = 0; i < app.grid.getStore().getCount(); i++) {\n    var r = app.grid.getStore().getAt(i);\n    totalQty = totalQty + parseFloat((Wb.isEmpty(r.get('QTY')) ? 0 : r.get('QTY')));\n}\nif(totalQty != app.CKSL.getValue()){\n    Wb.toast('{#XC_ST_COMMON_ckslhebxdy#}');//入库数量必须等于货位入库数量，请重新录入！\n    if(!Wb.verifyGrid(app.grid))//验证数据是否合法\n        return;\n\treturn;\n}\nWb.sync({\n    grid : app.grid,\n    url : 'm?xwl=xc/st/common/st_com_lov/XC_ST_WH_B_LOCATION/data/stWhBLocationUpdate',\n    success : function(resp) {\n        Wb.toast('{#XC_ST_COMMON_sjbccg#}');//数据保存成功！\n        app.grid.store.load({params : {BUSINESS_H_ID : BUSINESS_H_ID,BUSINESS_L_ID : BUSINESS_L_ID,MATERIAL_ID : MATERIAL_ID,SERIAL_BATCH_NUM : SERIAL_BATCH_NUM}});\n        opType = \"Update\";\n    }\n});"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#XC_ST_COMMON_NUMBER_COL#}","xtype":"rownumberer","width":"50","align":"center","titleAlign":"center","itemId":"NUMBER_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#XC_ST_COMMON_LOCATION_NAME#}","width":"150","dataIndex":"LOCATION_NAME","titleAlign":"center","itemId":"LOCATION_NAME_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"货位现存量","width":"100","align":"right","dataIndex":"HWXCL","titleAlign":"center","itemId":"HWXCL_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"<font color='red'>*<\/font>{#XC_ST_COMMON_cksl#}","width":"100","align":"right","dataIndex":"QTY","titleAlign":"center","itemId":"CKSL_COL"},"children":[{"configs":{"decimalPrecision":"6","allowBlank":"false","minValue":"0","itemId":"editor"},"events":{"change":"var rec = app.grid.getSelection()[0];\nnumber.setMaxValue(rec.data.HWXCL);"},"children":[],"expanded":false,"type":"number"}],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"window"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}