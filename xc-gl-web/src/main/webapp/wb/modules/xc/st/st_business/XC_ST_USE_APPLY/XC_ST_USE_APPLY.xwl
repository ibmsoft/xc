{"inframe":false,"title":"领用申请单","hidden":false,"roles":{"default":1},"children":[{"configs":{"loginRequired":"false","serverScript":"//---------------------获取当前模块语言对应的.json文件，放到request中----------------\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xc/st/st_business/XC_ST_USE_APPLY/json/XC_ST_USE_APPLY\");\nvar userId = request.getSession().getAttribute(\"XzSessionVars\").get('userId');\n\nvar protocol = request.getProtocol() ;\nvar ipAddr = request.getServerName();\nvar port = request.getServerPort() ;\nvar ctxPath = request.getContextPath() ;\n\nvar pp = protocol.substr(0,5) ;\nprotocol = (pp.indexOf(\"https\") == -1 ? \"http\" : \"https\") ;\nvar url = protocol + \"://\" + ipAddr +\":\" + port + ctxPath ;\n\nrequest.setAttribute('contextPath',ctxPath);\nrequest.setAttribute(\"userId\",userId);\nrequest.setAttribute(\"appIP\",url);\nvar appId = request.getSession().getAttribute(\"XzSessionVars\").get('appId');\nrequest.setAttribute(\"funId\",request.getParameter('funId'));\nrequest.setAttribute(\"appId\",request.getParameter('appId'));","itemId":"module"},"events":{"finalize":"function returnRowFn(r,type){\n    if(type==='xip_pub_orgs'){\n        app.LEDGER_ID.setValue(r.data.LEDGER_ID);\n        app.ORG_ID.setValue(r.data.ORG_ID);\n        app.WAREHOUSE_XWL.WAREHOUSE_ID.setValue(null);\n        app.WAREHOUSE_XWL.WAREHOUSE_NAME.setValue(null);\n        app.WAREHOUSE_XWL.QUERY_ORG_ID.setValue(r.data.ORG_ID);\n        app.WAREHOUSE_XWL.LEDGER_ID.setValue(r.data.LEDGER_ID);\n        app.searchButton.fireEvent('click');\n        setButtonStatus(false);\n    }\n    if(type==='xc_st_warehouse'){\n        app.searchButton.fireEvent('click');\n        if(r.data.IS_INIT == 'Y' && r.data.STATUS == 'Y'){\n            setButtonStatus(false);\n        }\n        else{\n            setButtonStatus(true);\n        }\n    }\n}\nfunction clearOtherFn(type){\n    if(type=='xip_pub_orgs'){\n    }\n    if(type=='xc_st_warehouse'){\n        app.searchButton.fireEvent('click');\n        setButtonStatus(false);\n    }\n}\nfunction setButtonStatus(flag){\n    app.addBtn.setDisabled(flag);\n    app.editBtn.setDisabled(flag);\n    app.deleteBtn.setDisabled(flag);\n    app.submitBtn.setDisabled(flag);\n    app.withdrawBtn.setDisabled(flag);\n    app.closeBtn.setDisabled(flag);\n}"},"children":[{"configs":{"itemId":"tools"},"children":[{"configs":{"itemId":"orgInitStore","autoLoad":"true","url":"m?xwl=xc/com-lov/ORG_PICK/DB/ORG_SELECT_BY_LEDGER"},"events":{"load":"if(store.getCount() > 0){\n    app.LEDGER_ID.setValue(store.getAt(0).get('LEDGER_ID'));\n    app.ORG_ID.setValue(store.getAt(0).get('ORG_ID'));\n    app.ORG_XWL.LEDGER_ID.setValue(store.getAt(0).get('LEDGER_ID'));\n    app.ORG_XWL.ORG_ID.setValue(store.getAt(0).get('ORG_ID'));\n    app.ORG_XWL.ORG_NAME.setValue(store.getAt(0).get('ORG_NAME'));\n    app.WAREHOUSE_XWL.QUERY_ORG_ID.setValue(store.getAt(0).get('ORG_ID'));\n    app.WAREHOUSE_XWL.LEDGER_ID.setValue(store.getAt(0).get('LEDGER_ID'));\n    app.searchButton.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"folder"},{"configs":{"layout":"border","itemId":"viewport1"},"children":[{"configs":{"region":"north","itemId":"search_form"},"children":[{"configs":{"layout":"column","margin":"5 0 5 0","border":"false","itemId":"row1"},"children":[{"configs":{"layout":"form","columnWidth":".249","border":"false","itemId":"row1_1"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/ORG_PICK/ORG_ALL_PICK","itemId":"ORG_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".249","border":"false","itemId":"row1_2"},"children":[{"configs":{"file":"m?xwl=xc/st/common/st_com_lov/XC_ST_WAREHOUSE_LOV/XC_ST_WAREHOUSE_LOV","itemId":"WAREHOUSE_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".249","border":"false","itemId":"row1_3"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"USE_APPLY_H_CODE","fieldLabel":"{#XC_ST_USE_APPLY_USE_APPLY_H_CODE#}"},"events":{"specialkey":"if(e.getKey()===13) {\n  app.searchButton.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".249","border":"false","itemId":"row1_4"},"children":[{"configs":{"labelWidth":"80","displayField":"NAME","value":"ALL","valueField":"CODE","labelAlign":"right","itemId":"SYS_AUDIT_STATUS","fieldLabel":"{#XC_ST_USE_APPLY_SYS_AUDIT_STATUS#}"},"events":{"select":"app.searchButton.fireEvent('click');","specialkey":"if(e.getKey()===13) {\n  app.searchButton.fireEvent('click');\n}"},"children":[{"configs":{"data":"[\n  {'CODE':'ALL','NAME':'{#XC_ST_USE_APPLY_All#}'},\n  {'CODE':'A','NAME':'{#XC_ST_USE_APPLY_SYS_A#}'},\n  {'CODE':'C','NAME':'{#XC_ST_USE_APPLY_SYS_C#}'},\n  {'CODE':'E','NAME':'{#XC_ST_USE_APPLY_SYS_E#}'},\n  {'CODE':'G','NAME':'{#XC_ST_USE_APPLY_closeBtn#}'}\n]","itemId":"store","fields":"[{name:'CODE'},{name:'NAME'}]"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"layout":"column","margin":"0 0 5 0","border":"false","itemId":"row2"},"children":[{"configs":{"layout":"form","columnWidth":".249","border":"false","itemId":"row2_1"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"DEPT_NAME","fieldLabel":"{#XC_ST_USE_APPLY_YWBM#}"},"events":{"specialkey":"if(e.getKey()===13) {\n  app.searchButton.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".249","border":"false","itemId":"row2_2"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"PROJECT_NAME","fieldLabel":"{#XC_ST_USE_APPLY_PROJECT_NAME#}"},"events":{"specialkey":"if(e.getKey()===13) {\n  app.searchButton.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".249","border":"false","itemId":"row2_3"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"BIZ_DATE_START","fieldLabel":"{#XC_ST_USE_APPLY_BIZ_DATE#}"},"events":{"select":"app.searchButton.fireEvent('click');","specialkey":"if(e.getKey()===13) {\n  app.searchButton.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"date"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".249","border":"false","itemId":"row2_4"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"BIZ_DATE_END","fieldLabel":"{#XC_ST_USE_APPLY_TO#}"},"events":{"select":"app.searchButton.fireEvent('click');","specialkey":"if(e.getKey()===13) {\n  app.searchButton.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"date"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"layout":"column","margin":"0 0 5 0","border":"false","itemId":"row3"},"children":[{"configs":{"layout":"form","columnWidth":".249","border":"false","itemId":"td_3_1"},"children":[{"configs":{"labelWidth":"80","value":"ALL","pickList":"[\n  ['ALL','{#XC_ST_USE_APPLY_All#}'],\n  ['A','{#XC_ST_USE_APPLY_A_STATUS#}'],\n  ['C','{#XC_ST_USE_APPLY_C_STATUS#}'],\n  ['D','{#XC_ST_USE_APPLY_D_STATUS#}'],\n  ['E','{#XC_ST_USE_APPLY_E_STATUS#}'],\n  ['R','{#XC_ST_USE_APPLY_R_STATUS#}']\n]","labelAlign":"right","itemId":"AUDIT_STATUS","fieldLabel":"{#XC_ST_USE_APPLY_AUDIT_STATUS#}"},"events":{"select":"app.searchButton.fireEvent('click');","specialkey":"if(e.getKey()===13) {\n  app.searchButton.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"hidden":"true","layout":"form","columnWidth":".249","border":"false","itemId":"td_3_2"},"children":[{"configs":{"labelWidth":"80","value":"ALL","pickList":"[\n  ['ALL','{#XC_ST_USE_APPLY_All#}'],\n  ['N','{#XC_ST_USE_APPLY_STATUS_N#}'],\n  ['Y','{#XC_ST_USE_APPLY_STATUS_Y#}']\n]","labelAlign":"right","itemId":"IS_CLOSE","fieldLabel":"{#XC_ST_USE_APPLY_STATUS#}"},"events":{"select":"app.searchButton.fireEvent('click');","specialkey":"if(Ext.EventObject.getKey()==13){\n  app.searchButton.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".249","border":"false","itemId":"row3_4"},"children":[{"configs":{"layout":"column","border":"false","itemId":"row3_4_1"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","hidden":"true","labelAlign":"right","itemId":"LEDGER_ID","fieldLabel":"账簿ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"80","readOnly":"true","hidden":"true","labelAlign":"right","itemId":"ORG_ID","fieldLabel":"组织ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"text":"{#XC_ST_USE_APPLY_searchButton#}","itemId":"searchButton","iconCls":"seek_icon"},"events":{"click":"app.grid.store.load({params : Wb.getValue(app.search_form)});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#XC_ST_USE_APPLY_resetButton#}","itemId":"resetButton","iconCls":"refresh_icon"},"events":{"click":"app.search_form.getForm().reset();\napp.searchButton.fireEvent('click');"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"form"},{"configs":{"region":"center","selType":"checkboxmodel","barExportButtons":"false","barExportAllButtons":"false","itemId":"grid","editable":"true"},"events":{"itemdblclick":"if(app.editBtn.disabled === true)\n    app.seekBtn.fireEvent('click');\nelse\n    app.editBtn.fireEvent('click');"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/st/st_business/XC_ST_USE_APPLY/data/stUseApplyHSelect"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"{#XC_ST_USE_APPLY_addBtn#}","itemId":"addBtn","iconCls":"file_add_icon"},"events":{"click":"if(Wb.isEmpty(app.WAREHOUSE_XWL.WAREHOUSE_ID.getValue())){\n    Wb.toast('{#XC_ST_USE_APPLY_qxxzck#}');\n    return;\n}\nWb.run({\n  url: 'm?xwl=xc/st/st_business/XC_ST_USE_APPLY/XC_ST_USE_APPLY_WIN', \n  success: function(apps) {\n      apps.initWin({\n          IS_INSERT : 'Add',\n          USE_APPLY_H_ID : Xip.getId(),\n          LEDGER_ID : app.LEDGER_ID.getValue(),\n          ORG_ID : app.ORG_XWL.ORG_ID.getValue(),\n          ORG_NAME : app.ORG_XWL.ORG_NAME.getValue(),\n          WAREHOUSE_ID : app.WAREHOUSE_XWL.WAREHOUSE_ID.getValue(),\n          WAREHOUSE_NAME : app.WAREHOUSE_XWL.WAREHOUSE_NAME.getValue(),\n          hideFun:function(){\n              app.searchButton.fireEvent('click');\n          }\n      });\n    }\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#XC_ST_USE_APPLY_editBtn#}","itemId":"editBtn","iconCls":"file_edit_icon"},"events":{"click":"var recs = app.grid.getSelection();//获得选中数据\nif(recs.length != 1){//选中的数据条数\n\tWb.toast('{#XC_ST_USE_APPLY_qxzytxyxgdjl#}');//请选择一条需要修改的记录！\n\treturn;\n}\nWb.run({\n  url: 'm?xwl=xc/st/st_business/XC_ST_USE_APPLY/XC_ST_USE_APPLY_WIN', \n  success: function(apps) {\n      apps.initWin({\n          IS_INSERT : 'Update',\n          USE_APPLY_H_ID : recs[0].data.USE_APPLY_H_ID,\n          hideFun:function(){\n              app.searchButton.fireEvent('click');\n          }\n      });\n    }\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#XC_ST_USE_APPLY_deleteBtn#}","itemId":"deleteBtn","iconCls":"file_delete_icon"},"events":{"click":"var recs = app.grid.getSelection();//获得选中数据\nif (!recs.length) {//选中的数据条数\n\tWb.toast('{#XC_ST_USE_APPLY_qxzxyscdjl#}');//请选择需要删除的记录！\n\treturn;\n}\nvar deleteArray = [] ;\nfor(var i = 0;i < recs.length;i++){\n    if(recs[i].data.SYS_AUDIT_STATUS == 'A'){\n        var deleteData =  {stDocId : recs[i].data.USE_APPLY_H_ID};\n        deleteArray.push(deleteData);\n    }\n}\nif(deleteArray.length === 0){\n    Wb.toast('{#XC_ST_USE_APPLY_sxdjfcgztbnsc#}');//所选单据非草稿状态，不能删除！\n    return;\n}\nWb.confirm('{#XC_ST_USE_APPLY_qdyscxzd#} ' + recs.length + ' {#XC_ST_USE_APPLY_tjlm#}',function() {\n    Wb.request({\n        url : '{#contextPath#}' + '/xcStDocsAction.do?method=deleteXcStDocs',\n        params: Wb.apply({hIds : deleteArray,docClassCode : 'SQD'}),\n        success: function(resp){\n            Wb.toast('{#XC_ST_USE_APPLY_sccg#}');\n            app.searchButton.fireEvent('click');\n        }\n    });\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#XC_ST_USE_APPLY_seekBtn#}","itemId":"seekBtn","iconCls":"seek_icon"},"events":{"click":"var recs = app.grid.getSelection();//获得选中数据\nif(recs.length != 1){//选中的数据条数\n\tWb.toast('{#XC_ST_USE_APPLY_qxzytxyckdjl#}');//请选择一条需要查看的记录！\n\treturn;\n}\nWb.run({\n  url: 'm?xwl=xc/st/st_business/XC_ST_USE_APPLY/XC_ST_USE_APPLY_WIN', \n  success: function(apps) {\n      apps.initWin({\n          IS_INSERT : 'Seek',\n          USE_APPLY_H_ID : recs[0].data.USE_APPLY_H_ID,\n          hideFun:function(){\n              app.searchButton.fireEvent('click');\n          }\n      });\n    }\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#XC_ST_USE_APPLY_submitBtn#}","itemId":"submitBtn","iconCls":"check_icon"},"events":{"click":"var rows = app.grid.getSelection();//获得选中数据\nif (rows.length > 1 || rows.length === 0) {//大于一条或没选择会警告\n    Wb.toast('{#XC_ST_USE_APPLY_qxzytxytjdjl#}');//请选择一条需要提交的记录！\n\treturn;\n}\nelse {\n    var auditStatus = rows[0].data.AUDIT_STATUS;\n    if(auditStatus === 'E' || auditStatus === 'C'){//运行中、结束状态\n        Wb.toast('{#XC_ST_USE_APPLY_lcytjqcxxz#}');//流程已提交,请重新选择！\n        return false;\n    }\n    else{\n        Wb.request({\n            url : '{#contextPath#}' + '/xcStCommonAction.do?method=getXcStProcAndForms',\n            params : {LEDGER_ID : rows[0].data.LEDGER_ID,DOC_CAT_CODE : rows[0].data.DOC_CAT_CODE},\n            success : function(resp){\n                var temp = Wb.decode(resp.responseText);\n                if(temp.flag === '0'){\n                    //取得流程编码、电脑端审批表单和移动端审批表单\n                    var processCODE = temp.PROCESS_CODE;\n                    var pcApproveForm = temp.PC_A_FORM_URL;\n                    var mobileApproveForm = temp.M_A_FORM_URL;\n                    var orgId = temp.ORG_ID;\n                    if(pcApproveForm === \"\" || pcApproveForm === null || pcApproveForm === undefined){\n                        Wb.toast('{#XC_ST_USE_APPLY_wzddndspbd#}');//领用申请单未指定电脑端审批表单, 请在单据类型设置功能处设置！\n                        return;\n                    }\n                    //电脑端和移动端审批表单为变量需要设置为全路径\n                    pcApproveForm = '{#appIP#}' + pcApproveForm;\n                    mobileApproveForm = '{#appIP#}' +  mobileApproveForm;\n                    //如果流程编码存在, 则提交流程审批处理\n                    if(processCODE !== \"\" && processCODE !== null && processCODE !== undefined){\n                        //如果项目未指定，则设置默认值为 \"-1\"\n                        var prjId = rows[0].data.PROJECT_ID;\n                        if(prjId === null || prjId === \"\" || prjId === undefined){\n                            prjId = \"-1\" ;\n                        }\n                        var json = {\n                            'APP_IP'\t\t\t: '{#appIP#}',\n                            'EMP_ID'\t\t\t: '{#XIP.empId#}',\n                            'loginName'\t\t\t: '{#XIP.userName#}',\n                            'M_A_FORM'\t\t\t: mobileApproveForm,\n                            'PC_A_FORM'\t\t\t: pcApproveForm,\n                            'arCatCode'\t\t\t: 'LYSQD',\n                            'billType'\t\t\t: 'LYSQD',\n                            'DEPT_ID'\t\t\t: rows[0].data.DEPT_ID,\n                            'DEPT_NAME'\t\t\t: rows[0].data.DEPT_NAME,\n                            'PROJECT_ID'\t\t: prjId,\n                            'ORG_ID'\t\t\t: orgId,\n                            'ledgerId'\t\t\t: rows[0].data.LEDGER_ID,\n                            'AMT'\t\t\t\t: rows[0].data.AMOUNT,\n                            'ABSAMT'\t\t\t: Math.abs(rows[0].data.AMOUNT),//金额绝对值\n                            'e_business_id'\t\t: rows[0].data.USE_APPLY_H_ID\n                        };\n                        if(auditStatus === 'A'){//起草状态\n                            XipWf.startAndSubmitByProcess(processCODE,json,function(e){//提交流程\n                                if(e.flag === 0){\n                                    app.searchButton.fireEvent('click');\n                                    Wb.toast('{#XC_ST_USE_APPLY_lctjcg#}');//流程提交成功！\n                                }\n                                else if(e.flag === 1){\n                                    Wb.toast(e.msg) ;\n                                }\n                            });\n                        }\n                        else if(auditStatus === 'D'){//驳回状态\n                            XipWf.submitInstance(rows[0].data.INS_CODE,json,function(e){//提交流程\n                                if(e.flag === 0){\n                                    app.searchButton.fireEvent('click');\n                                    Wb.toast('{#XC_ST_USE_APPLY_lctjcg#}');//流程提交成功！\n                                }\n                                else if(e.flag === 1){\n                                    Wb.toast(e.msg) ;\n                                }\n                            });\n                        }\n                        else if(auditStatus === 'R'){//撤回状态\n                            XipWf.restartAndSubmitByProcess(rows[0].data.INS_CODE,processCODE,json,function(e){//提交流程\n                                if(e.flag === 0){\n                                    app.searchButton.fireEvent('click');\n                                    Wb.toast('{#XC_ST_USE_APPLY_lctjcg#}');//流程提交成功！\n                                }\n                                else if(e.flag === 1){\n                                    Wb.toast(e.msg) ;\n                                }\n                            });\n                        }\n                    }\n                    else{\n                        Wb.toast(temp.msg);\n                    }\n                }\n            }\n        });\n    }\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#XC_ST_USE_APPLY_monitorBtn#}","itemId":"monitorBtn","iconCls":"viewport_icon"},"events":{"click":"var rows = app.grid.getSelection();\nif (rows.length > 1 || rows.length === 0) {\n    Wb.toast('{#XC_ST_USE_APPLY_qxzytxyjkdjl#}');//请选择一条需要监控的记录！\n    return;\n}\nif(rows[0].data.INS_CODE === null || rows[0].data.INS_CODE === ''){\n    Wb.toast('{#XC_ST_USE_APPLY_qxzytyjcjdlcsldsj#}');\n    return;\n}\nelse{\n    XipWf.showMonitorPage(rows[0].data.INS_CODE);\n}   "},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#XC_ST_USE_APPLY_withdrawBtn#}","itemId":"withdrawBtn","iconCls":"cancel_icon"},"events":{"click":"var rows = app.grid.getSelection();\nif(rows.length != 1){\n    Wb.toast('{#XC_ST_USE_APPLY_qxzytxychdjl#}');//请选择一条需要撤回的记录！\n\treturn;\n}\nif(rows[0].data.INS_CODE === null || rows[0].data.INS_CODE === '') {\n    Wb.toast('{#XC_ST_USE_APPLY_lcmytjbnch#}');//流程没有提交，不能撤回！\n\treturn;\n}\nelse if(rows[0].data.AUDIT_STATUS === 'E') {\n    Wb.toast('{#XC_ST_USE_APPLY_lcsptgbnch#}');//流程审批通过，不能撤回！\n\treturn;\n}\nelse if(rows[0].data.AUDIT_STATUS === 'R'){\n    Wb.toast('{#XC_ST_USE_APPLY_lcyjchcg#}');//流程已经撤回成功\n    return false;\n}\nelse if(rows[0].data.AUDIT_STATUS === 'D'){\n\tWb.toast('{#XC_ST_USE_APPLY_lcyjbh#}');//流程已经驳回！\n    return false;\n}\nelse {\n    Wb.confirm('{#XC_ST_USE_APPLY_qdychxzd#} ' + rows.length + ' {#XC_ST_USE_APPLY_tjlm#}', function() {\n        //撤回流程\n        XipWf.revokeByInstance(rows[0].data.INS_CODE,function(e){\n            Wb.toast(e.msg);\n            app.searchButton.fireEvent('click');\n        });\n    });\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#XC_ST_USE_APPLY_closeBtn#}","itemId":"closeBtn","iconCls":"close_icon"},"events":{"click":"var recs = app.grid.getSelection();//获得选中数据\nif (!recs.length) {//选中的数据条数\n\tWb.toast('{#XC_ST_USE_APPLY_qxzxygbdsqd#}');//请选择需要关闭的领用申请单！\n\treturn;\n}\nvar closeArray = [] ;\nvar j = 0;\nfor(var i = 0;i < recs.length;i++){\n    if(recs[i].data.SYS_AUDIT_STATUS == 'E'){\n        var closeData =  {stDocId : recs[i].data.USE_APPLY_H_ID};\n        closeArray.push(closeData);\n    }\n    if(recs[i].data.SYS_AUDIT_STATUS == 'G'){\n        j++;\n    }\n}\nif(j > 0){\n\tWb.toast('{#XC_ST_USE_APPLY_sxdjyjgb#}');//所选单据已经关闭，不能再次关闭！\n    return;\n}\nif(closeArray.length === 0){\n    Wb.toast('{#XC_ST_USE_APPLY_sxdjspwtgbngb#}');//所选单据审批为通过，不能关闭！\n    return;\n}\nWb.confirm('{#XC_ST_USE_APPLY_qdygbxzd#} ' + recs.length + ' {#XC_ST_USE_APPLY_tjlm#}',function() {\n    Wb.request({\n        url : '{#contextPath#}' + '/xcStDocsAction.do?method=closeXcStUseApply',\n        params: Wb.apply({hIds : closeArray}),\n        success: function(resp){\n            Wb.toast('{#XC_ST_USE_APPLY_gbcg#}');\n            app.searchButton.fireEvent('click');\n        }\n    });\n});"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#XC_ST_USE_APPLY_NUMBER_COL#}","xtype":"rownumberer","width":"50","align":"center","titleAlign":"center","itemId":"NUMBER_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#XC_ST_USE_APPLY_USE_APPLY_H_CODE#}","width":"150","dataIndex":"USE_APPLY_H_CODE","titleAlign":"center","itemId":"USE_APPLY_H_CODE_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#XC_ST_USE_APPLY_BIZ_DATE#}","xtype":"datecolumn","width":"100","dataIndex":"BIZ_DATE","titleAlign":"center","itemId":"BIZ_DATE_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#XC_ST_USE_APPLY_USE_APPLY_H_NAME#}","width":"150","dataIndex":"USE_APPLY_H_NAME","titleAlign":"center","itemId":"USE_APPLY_H_NAME_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#XC_ST_USE_APPLY_BUSINESS_TYPE_NAME#}","width":"140","dataIndex":"BUSINESS_TYPE_NAME","titleAlign":"center","itemId":"BUSINESS_TYPE_NAME_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#XC_ST_USE_APPLY_YWBM#}","width":"120","dataIndex":"DEPT_NAME","titleAlign":"center","itemId":"DEPT_NAME_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#XC_ST_USE_APPLY_PROJECT_NAME#}","width":"120","dataIndex":"PROJECT_NAME","titleAlign":"center","itemId":"PROJECT_NAME_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#XC_ST_USE_APPLY_APPLY_PERSON#}","width":"100","dataIndex":"APPLY_PERSON","titleAlign":"center","itemId":"APPLY_PERSON_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#XC_ST_USE_APPLY_WAREHOUSE#}","width":"150","dataIndex":"WAREHOUSE_NAME","titleAlign":"center","itemId":"WAREHOUSE_NAME_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#XC_ST_USE_APPLY_SYS_AUDIT_STATUS#}","width":"100","dataIndex":"SYS_AUDIT_STATUS_DESC","titleAlign":"center","itemId":"SYS_AUDIT_STATUS_DESC_COL"},"children":[],"expanded":true,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}