{"inframe":false,"title":"领用出库及退库管理","hidden":false,"roles":{"default":1},"children":[{"configs":{"loginRequired":"false","serverScript":"//---------------------获取当前模块语言对应的.json文件，放到request中----------------\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xc/st/st_business/XC_ST_WH_DELEVERED/json/XC_ST_WH_DELEVERED\");\nvar ctxPath = request.getContextPath() ;\nrequest.setAttribute('contextPath',ctxPath);","itemId":"module"},"events":{"finalize":"var stDocCatCode = '{#stDocCatCode#}';\n\nfunction returnRowFn(r,type){\n    if(type==='xip_pub_orgs'){\n        app.LEDGER_ID.setValue(r.data.LEDGER_ID);\n        app.ORG_ID.setValue(r.data.ORG_ID);\n        app.WAREHOUSE_XWL.WAREHOUSE_ID.setValue(null);\n        app.WAREHOUSE_XWL.WAREHOUSE_NAME.setValue(null);\n        app.WAREHOUSE_XWL.QUERY_ORG_ID.setValue(r.data.ORG_ID);\n        app.WAREHOUSE_XWL.LEDGER_ID.setValue(r.data.LEDGER_ID);\n        app.searchButton.fireEvent('click');\n        setButtonStatus(false);\n    }\n    if(type==='xc_st_warehouse'){\n        app.searchButton.fireEvent('click');\n        if(r.data.IS_INIT == 'Y' && r.data.STATUS == 'Y'){\n            setButtonStatus(false);\n        }\n        else{\n            setButtonStatus(true);\n        }\n    }\n}\nfunction clearOtherFn(type){\n    if(type=='xip_pub_orgs'){\n    }\n    if(type=='xc_st_warehouse'){\n        app.searchButton.fireEvent('click');\n        setButtonStatus(false);\n    }\n}\nfunction setButtonStatus(flag){\n    app.addBtn.setDisabled(flag);\n    app.editBtn.setDisabled(flag);\n    app.deleteBtn.setDisabled(flag);\n    app.submitBtn.setDisabled(flag);\n    app.returnButton.setDisabled(flag);\n}"},"children":[{"configs":{"itemId":"tools"},"children":[{"configs":{"autoLoad":"true","itemId":"orgInitStore","url":"m?xwl=xc/com-lov/ORG_PICK/DB/ORG_SELECT_BY_LEDGER"},"events":{"load":"if(store.getCount() > 0){\n    app.LEDGER_ID.setValue(store.getAt(0).get('LEDGER_ID'));\n    app.ORG_ID.setValue(store.getAt(0).get('ORG_ID'));\n    app.ORG_XWL.LEDGER_ID.setValue(store.getAt(0).get('LEDGER_ID'));\n    app.ORG_XWL.ORG_ID.setValue(store.getAt(0).get('ORG_ID'));\n    app.ORG_XWL.ORG_NAME.setValue(store.getAt(0).get('ORG_NAME'));\n    app.WAREHOUSE_XWL.QUERY_ORG_ID.setValue(store.getAt(0).get('ORG_ID'));\n    app.WAREHOUSE_XWL.LEDGER_ID.setValue(store.getAt(0).get('LEDGER_ID'));\n    app.searchButton.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"folder"},{"configs":{"layout":"border","itemId":"viewport1"},"children":[{"configs":{"region":"north","itemId":"search_form"},"children":[{"configs":{"layout":"column","margin":"5 0 5 0","itemId":"row1","border":"false"},"children":[{"configs":{"layout":"form","columnWidth":".249","itemId":"row1_1","border":"false"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/ORG_PICK/ORG_ALL_PICK","itemId":"ORG_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".249","itemId":"row1_2","border":"false"},"children":[{"configs":{"file":"m?xwl=xc/st/common/st_com_lov/XC_ST_WAREHOUSE_LOV/XC_ST_WAREHOUSE_LOV","itemId":"WAREHOUSE_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".249","itemId":"row1_3","border":"false"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"DELEVERED_H_CODE","fieldLabel":"{#XC_ST_WH_DELEVERED_DELEVERED_H_CODE#}"},"events":{"specialkey":"if(e.getKey()===13) {\n  app.searchButton.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".249","itemId":"row1_4","border":"false"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"BUSINESS_TYPE_NAME","fieldLabel":"{#XC_ST_WH_DELEVERED_BUSINESS_TYPE_NAME#}"},"events":{"specialkey":"if(e.getKey()===13) {\n  app.searchButton.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"layout":"column","margin":"0 0 5 0","itemId":"row2","border":"false"},"children":[{"configs":{"layout":"form","columnWidth":".249","itemId":"row2_1","border":"false"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"DEPT_NAME","fieldLabel":"{#XC_ST_WH_DELEVERED_DEPT_NAME#}"},"events":{"specialkey":"if(e.getKey()===13) {\n  app.searchButton.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".249","itemId":"row2_2","border":"false"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"PROJECT_NAME","fieldLabel":"{#XC_ST_WH_DELEVERED_PROJECT_NAME#}"},"events":{"specialkey":"if(e.getKey()===13) {\n  app.searchButton.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".249","itemId":"row2_3","border":"false"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"USE_APPLY_H_CODE","fieldLabel":"{#XC_ST_WH_DELEVERED_USE_APPLY_H_CODE#}"},"events":{"specialkey":"if(e.getKey()===13) {\n  app.searchButton.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"layout":"column","margin":"5 0 5 0","itemId":"row3","border":"false"},"children":[{"configs":{"layout":"form","columnWidth":".249","itemId":"row3_1","border":"false"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"BIZ_DATE_START","fieldLabel":"{#XC_ST_WH_DELEVERED_BIZ_DATE#}"},"events":{"select":"app.searchButton.fireEvent('click');","specialkey":"if(e.getKey()===13) {\n  app.searchButton.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"date"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".249","itemId":"row3_2","border":"false"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"BIZ_DATE_END","fieldLabel":"{#XC_ST_WH_DELEVERED_TO#}"},"events":{"select":"app.searchButton.fireEvent('click');","specialkey":"if(e.getKey()===13) {\n  app.searchButton.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"date"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".249","itemId":"row3_3","border":"false"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","pickList":"[['1','{#XC_ST_WH_DELEVERED_STATUS_1#}'],['2','{#XC_ST_WH_DELEVERED_STATUS_2#}'],['3','{#XC_ST_WH_DELEVERED_STATUS_3#}']]","itemId":"STATUS","fieldLabel":"{#XC_ST_WH_DELEVERED_STATUS#}"},"events":{"select":"app.searchButton.fireEvent('click');","specialkey":"if(e.getKey()===13) {\n  app.searchButton.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".249","border":"false","itemId":"row3_4"},"children":[{"configs":{"layout":"column","border":"false","itemId":"row3_4_1"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","hidden":"true","labelAlign":"right","itemId":"LEDGER_ID","fieldLabel":"账簿ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"80","readOnly":"true","hidden":"true","labelAlign":"right","itemId":"ORG_ID","fieldLabel":"组织ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"80","hidden":"true","value":"LY","labelAlign":"right","itemId":"DOC_CAT_CODE","fieldLabel":"单据类型"},"children":[],"expanded":false,"type":"text"},{"configs":{"text":"{#XC_ST_WH_DELEVERED_searchButton#}","itemId":"searchButton","iconCls":"seek_icon"},"events":{"click":"app.grid.store.load({params : Wb.getValue(app.search_form)});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#XC_ST_WH_DELEVERED_resetButton#}","itemId":"resetButton","iconCls":"refresh_icon"},"events":{"click":"app.search_form.getForm().reset();\napp.searchButton.fireEvent('click');"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"form"},{"configs":{"region":"center","selType":"checkboxmodel","barExportAllButtons":"false","barExportButtons":"false","itemId":"grid","editable":"true"},"events":{"itemdblclick":"if(app.editBtn.disabled === true)\n    app.seekBtn.fireEvent('click');\nelse\n    app.editBtn.fireEvent('click');"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/st/st_business/XC_ST_WH_DELEVERED/data/stWhDeleveredHSelect"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"{#XC_ST_WH_DELEVERED_addBtn#}","itemId":"addBtn","iconCls":"file_add_icon"},"children":[{"configs":{"text":"{#XC_ST_WH_DELEVERED_LYCK#}","itemId":"addLYCKButton","iconCls":"file_add_icon"},"events":{"click":"if(Wb.isEmpty(app.WAREHOUSE_XWL.WAREHOUSE_ID.getValue())){\n    Wb.toast('{#XC_ST_WH_DELEVERED_qxxzck#}');\n    return;\n}\nWb.run({\n    url: 'm?xwl=xc/st/st_business/XC_ST_WH_DELEVERED/XC_ST_WH_DELEVERED_LY_WIN', \n    success: function(apps) {\n        apps.initWin({\n            IS_INSERT : 'Add',\n            DELEVERED_H_ID : Xip.getId(),\n            stDocCatCode : 'LYCK',\n            LEDGER_ID : app.LEDGER_ID.getValue(),\n            ORG_ID : app.ORG_XWL.ORG_ID.getValue(),\n            ORG_NAME : app.ORG_XWL.ORG_NAME.getValue(),\n            WAREHOUSE_ID : app.WAREHOUSE_XWL.WAREHOUSE_ID.getValue(),\n            WAREHOUSE_NAME : app.WAREHOUSE_XWL.WAREHOUSE_NAME.getValue(),\n            hideFun:function(){\n                app.searchButton.fireEvent('click');\n            }\n        });\n    }\n});"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#XC_ST_WH_DELEVERED_LYTK#}","itemId":"addLYTKButton","iconCls":"file_add_icon"},"events":{"click":"if(Wb.isEmpty(app.WAREHOUSE_XWL.WAREHOUSE_ID.getValue())){\n    Wb.toast('{#XC_ST_WH_DELEVERED_qxxzck#}');\n    return;\n}\nWb.run({\n    url: 'm?xwl=xc/st/st_business/XC_ST_WH_DELEVERED/XC_ST_WH_DELEVERED_LY_WIN', \n    success: function(apps) {\n        apps.initWin({\n            IS_INSERT : 'Add',\n            DELEVERED_H_ID : Xip.getId(),\n            stDocCatCode : 'LYTK',\n            LEDGER_ID : app.LEDGER_ID.getValue(),\n            ORG_ID : app.ORG_XWL.ORG_ID.getValue(),\n            ORG_NAME : app.ORG_XWL.ORG_NAME.getValue(),\n            WAREHOUSE_ID : app.WAREHOUSE_XWL.WAREHOUSE_ID.getValue(),\n            WAREHOUSE_NAME : app.WAREHOUSE_XWL.WAREHOUSE_NAME.getValue(),\n            hideFun:function(){\n                app.searchButton.fireEvent('click');\n            }\n        });\n    }\n});"},"children":[],"expanded":false,"type":"item"}],"expanded":true,"type":"button"},{"configs":{"text":"{#XC_ST_WH_DELEVERED_editBtn#}","itemId":"editBtn","iconCls":"file_edit_icon"},"events":{"click":"var recs = app.grid.getSelection();//获得选中数据\nif(recs.length != 1){//选中的数据条数\n\tWb.toast('{#XC_ST_WH_DELEVERED_qxzytxyxgdjl#}');//请选择一条需要修改的记录！\n\treturn;\n}\nWb.run({\n    url: 'm?xwl=xc/st/st_business/XC_ST_WH_DELEVERED/XC_ST_WH_DELEVERED_LY_WIN', \n    success: function(apps) {\n        apps.initWin({\n            IS_INSERT : 'Update',\n            stDocCatCode : recs[0].data.DOC_CAT_CODE,\n            DELEVERED_H_ID : recs[0].data.DELEVERED_H_ID,\n            hideFun:function(){\n                app.searchButton.fireEvent('click');\n            }\n        });\n    }\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#XC_ST_WH_DELEVERED_deleteBtn#}","itemId":"deleteBtn","iconCls":"file_delete_icon"},"events":{"click":"var recs = app.grid.getSelection();//获得选中数据\nif (!recs.length) {//选中的数据条数\n\tWb.toast('{#XC_ST_WH_DELEVERED_qxzxyscdjl#}');//请选择需要删除的记录！\n\treturn;\n}\nvar deleteArray = [] ;\nfor(var i = 0;i < recs.length;i++){\n    if(recs[i].data.STATUS == '1'){\n        var deleteData =  {stDocId : recs[i].data.DELEVERED_H_ID};\n        deleteArray.push(deleteData);\n    }\n}\nif(deleteArray.length === 0){\n    Wb.toast('{#XC_ST_WH_DELEVERED_sxdjfcgztbnsc#}');//所选单据非草稿状态，不能删除！\n    return;\n}\nWb.confirm('{#XC_ST_WH_DELEVERED_qdyscxzd#} ' + recs.length + ' {#XC_ST_WH_DELEVERED_tjlm#}',function() {\n    Wb.request({\n        url : '{#contextPath#}' + '/xcStDocsAction.do?method=deleteXcStDocs',\n        params: Wb.apply({hIds : deleteArray,docClassCode : 'CKD'}),\n        success: function(resp){\n            Wb.toast('{#XC_ST_WH_DELEVERED_sccg#}');\n            app.searchButton.fireEvent('click');\n        }\n    });\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#XC_ST_WH_DELEVERED_submitBtn#}","itemId":"submitBtn","iconCls":"check_icon"},"events":{"click":"var rows = app.grid.getSelection();\nif(rows.length != 1){\n    Wb.toast(\"{#XC_ST_WH_DELEVERED_qxzxytjdjl#}\");//请选择需要提交的记录！\n    return;\n}\nelse{\n    if(rows[0].data.STATUS != '1'){\n        Wb.toast('{#XC_ST_WH_DELEVERED_sxdjfcgztbntj#}');//所选记录非草稿状态，不能提交！\n        return;\n    }\n    Wb.request({\n        url: '{#contextPath#}'+'/xcStCommonAction.do?method=updateXcStDocStatus',\n        params: Wb.apply({stDocId : rows[0].data.DELEVERED_H_ID,docClassCode : 'CKD'}),\n        success: function(resp) {\n            var record = Wb.decode(resp.responseText);\n            if(record.flag == '0')\n                Wb.toast('{#XC_ST_WH_DELEVERED_tjcg#}');\n            else\n                Wb.toast(record.msg);\n            app.searchButton.fireEvent('click');\n        }\n\t});\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#XC_ST_WH_DELEVERED_seekBtn#}","itemId":"seekBtn","iconCls":"seek_icon"},"events":{"click":"var recs = app.grid.getSelection();//获得选中数据\nif(recs.length != 1){//选中的数据条数\n\tWb.toast('{#XC_ST_WH_DELEVERED_qxzytxyckdjl#}');//请选择一条需要查看的记录！\n\treturn;\n}\nWb.run({\n    url: 'm?xwl=xc/st/st_business/XC_ST_WH_DELEVERED/XC_ST_WH_DELEVERED_LY_WIN', \n    success: function(apps) {\n        apps.initWin({\n            IS_INSERT : 'Seek',\n            stDocCatCode : recs[0].data.DOC_CAT_CODE,\n            DELEVERED_H_ID : recs[0].data.DELEVERED_H_ID,\n            hideFun:function(){\n                app.searchButton.fireEvent('click');\n            }\n        });\n    }\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#XC_ST_WH_DELEVERED_returnButton#}","itemId":"returnButton","iconCls":"remove_icon"},"events":{"click":"var rec = app.grid.getSelection();\nif (rec.length > 1 || rec.length === 0) {//大于一条或没选择会警告\n    Wb.toast(\"{#XC_ST_WH_DELEVERED_qxzytxyhcdjl#}\");//请选择一条需要回冲的记录！\n    return;\n}\nif (rec[0].data.DOC_CAT_CODE == 'LYCK') {\n    if(rec[0].data.STATUS == '1' || Wb.isEmpty(rec[0].data.STATUS == '1')){\n        Wb.toast('{#XC_ST_WH_DELEVERED_ckdtjzhcnjxhc#}');//出库单提交之后才能进行回冲！\n        return;\n    }\n    Wb.request({\n        url: 'm?xwl=xc/st/common/data/xcStErrorSql',\n        params: {\n            sql : 'SELECT 1 FROM xc_st_wh_delevered_h WHERE AMOUNT <= 0 and DELEVERED_H_ID = {?DELEVERED_H_ID?}',\n            errorMsg : '{#XC_ST_WH_DELEVERED_rkdyjjqbnjxhc#}',//其他出库单已经结清，不能进行回冲！\n            DELEVERED_H_ID : rec[0].data.DELEVERED_H_ID\n        },\n        success: function(resp) {\n            Wb.run({\n                url: 'm?xwl=xc/st/st_business/XC_ST_WH_DELEVERED/XC_ST_WH_DELEVERED_LY_WIN',\n                success: function(apps) {\n                    apps.initWin({\n                        IS_INSERT : 'Add',\n                        DELEVERED_H_ID : Xip.getId(),\n                        RE_DELEVERED_H_ID : rec[0].data.DELEVERED_H_ID,\n                        stDocCatCode : 'LYTK',\n                        hideFun:function(){\n                            app.searchButton.fireEvent('click');\n                        }\n                    });\n                }\n            });\n        }\n    });\n}\nelse {\n    Wb.toast('{#XC_ST_WH_DELEVERED_zylzrkdckyzhc#}');//只有蓝字其他出库单才可以做回冲！\n}"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#XC_ST_WH_DELEVERED_NUMBER_COL#}","align":"center","width":"50","xtype":"rownumberer","titleAlign":"center","itemId":"NUMBER_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#XC_ST_WH_DELEVERED_DELEVERED_H_CODE#}","width":"150","dataIndex":"DELEVERED_H_CODE","titleAlign":"center","itemId":"DELEVERED_H_CODE_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#XC_ST_WH_DELEVERED_BIZ_DATE#}","width":"100","xtype":"datecolumn","dataIndex":"BIZ_DATE","titleAlign":"center","itemId":"BIZ_DATE_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#XC_ST_WH_DELEVERED_ST_CAT_NAME#}","width":"120","dataIndex":"ST_CAT_NAME","titleAlign":"center","itemId":"ST_CAT_NAME_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#XC_ST_WH_DELEVERED_BUSINESS_TYPE_NAME#}","width":"140","dataIndex":"BUSINESS_TYPE_NAME","titleAlign":"center","itemId":"BUSINESS_TYPE_NAME_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#XC_ST_WH_DELEVERED_USE_APPLY_H_CODE#}","width":"150","dataIndex":"USE_APPLY_H_CODE","titleAlign":"center","itemId":"USE_APPLY_H_CODE_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#XC_ST_WH_DELEVERED_DEPT_NAME#}","width":"150","dataIndex":"DEPT_NAME","titleAlign":"center","itemId":"DEPT_NAME_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#XC_ST_WH_DELEVERED_PROJECT_NAME#}","width":"150","dataIndex":"PROJECT_NAME","titleAlign":"center","itemId":"PROJECT_NAME_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#XC_ST_WH_DELEVERED_WAREHOUSE#}","width":"150","dataIndex":"WAREHOUSE_NAME","titleAlign":"center","itemId":"WAREHOUSE_NAME_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#XC_ST_WH_DELEVERED_EMP_NAME#}","width":"100","dataIndex":"EMP_NAME","titleAlign":"center","itemId":"EMP_NAME_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#XC_ST_WH_DELEVERED_DELEVERED_H_NAME#}","width":"150","dataIndex":"DELEVERED_H_NAME","titleAlign":"center","itemId":"DELEVERED_H_NAME_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#XC_ST_WH_DELEVERED_STATUS#}","width":"100","dataIndex":"STATUS","titleAlign":"center","itemId":"STATUS_COL","renderer":"if(value == '1')\n    return '{#XC_ST_WH_DELEVERED_STATUS_1#}';\nif(value == '2')\n    return '{#XC_ST_WH_DELEVERED_STATUS_2#}';\nif(value == '3')\n    return '{#XC_ST_WH_DELEVERED_STATUS_3#}';"},"children":[],"expanded":true,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}