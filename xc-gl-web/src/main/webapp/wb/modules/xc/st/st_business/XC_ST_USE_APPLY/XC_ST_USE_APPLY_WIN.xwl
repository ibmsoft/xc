{"inframe":false,"title":"","hidden":false,"roles":{"default":1},"children":[{"configs":{"loginRequired":"false","serverScript":"//---------------------获取当前模块语言对应的.json文件，放到request中----------------\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xc/st/st_business/XC_ST_USE_APPLY/json/XC_ST_USE_APPLY\");\nvar userId = request.getSession().getAttribute(\"XzSessionVars\").get('userId');\n\nvar protocol = request.getProtocol() ;\nvar ipAddr = request.getServerName();\nvar port = request.getServerPort() ;\nvar ctxPath = request.getContextPath() ;\n\nvar pp = protocol.substr(0,5) ;\nprotocol = (pp.indexOf(\"https\") == -1 ? \"http\" : \"https\") ;\nvar url = protocol + \"://\" + ipAddr +\":\" + port + ctxPath ;\n\nrequest.setAttribute('contextPath',ctxPath);\nrequest.setAttribute(\"userId\",userId);\nrequest.setAttribute(\"appIP\",url);\nvar appId = request.getSession().getAttribute(\"XzSessionVars\").get('appId');\nrequest.setAttribute(\"funId\",request.getParameter('funId'));\nrequest.setAttribute(\"appId\",request.getParameter('appId'));","itemId":"module"},"events":{"finalize":"var tableValue = '';//窗口中的所有信息\nvar isEditCol = 'N';//判断是否更新过行信息","initialize":"Wb.isInsert = null;\nvar USE_APPLY_H_ID = null;\nvar LEDGER_ID = null,\nORG_ID = null,\nORG_NAME = null;\nExt.apply(app, {\n    initWin: function(params) {\n        Ext.apply(app, params);\n        app.win = new Ext.window.Window(app.editWinN);\n        app.win.show();\n        Wb.isInsert = params.IS_INSERT;\n        USE_APPLY_H_ID = params.USE_APPLY_H_ID;\n        LEDGER_ID = params.LEDGER_ID;\n        ORG_ID = params.ORG_ID;\n        ORG_NAME = params.ORG_NAME;\n        app.DEPT_ID_XWL.DEPT_NAME.setFieldLabel('{#XC_ST_USE_APPLY_lybm#}');//领用部门\n        app.grid1.store.load({params : {USE_APPLY_H_ID : USE_APPLY_H_ID}});\n        if (Wb.isInsert == 'Add') {//新增操作\n            app.USE_APPLY_H_ID.setValue(USE_APPLY_H_ID);\n            app.APPLY_PERSON.setValue('{#XIP.empName#}');\n            app.APPLY_PERSON_ID.setValue('{#XIP.userId#}');\n            app.AUDIT_STATUS.setValue('A');\n            app.SYS_AUDIT_STATUS.setValue('A');\n            app.SYS_AUDIT_STATUS_DESC.setValue('{#XC_ST_USE_APPLY_SYS_A#}');\n            app.BIZ_DATE.setValue(new Date());\n            app.IS_CREATE.setValue('Y');\n            app.WAREHOUSE_XWL.WAREHOUSE_ID.setValue(params.WAREHOUSE_ID);\n            app.WAREHOUSE_XWL.WAREHOUSE_NAME.setValue(params.WAREHOUSE_NAME);\n            app.orgInitStore.load();\n        }\n        if (Wb.isInsert == 'Update') {//修改操作\n            app.IS_CREATE.setValue('N');\n            Wb.request({\n                url : 'm?xwl=xc/st/st_business/XC_ST_USE_APPLY/data/stUseApplyHSelectById',\n                params : {USE_APPLY_H_ID : USE_APPLY_H_ID},\n                success : function(resp){\n                    var rec = Wb.decode(resp.responseText).rows[0];\n                    if(rec.SYS_AUDIT_STATUS !== 'A')\n\t\t\t\t\t\tsetAllReadOnly(true);\n                    else{\n                        setSomeReadOnly(true);\n                        setOrg(rec.ORG_ID,rec.LEDGER_ID);\n                        setMinDate(rec.LEDGER_ID);\n                        returnRowFn(rec,'xip_pub_depts');\n                    }\n                    rec.BIZ_DATE = Wb.strToDate(rec.BIZ_DATE);\n                    Wb.setValue(app.editWinN,rec);\n                    tableValue = Wb.encode(Wb.getValue(app.form1));\n                }\n            });\n        }\n        if (Wb.isInsert == 'Seek') {//查看操作\n            Wb.request({\n                url : 'm?xwl=xc/st/st_business/XC_ST_USE_APPLY/data/stUseApplyHSelectById',\n                params : {USE_APPLY_H_ID : USE_APPLY_H_ID},\n                success : function(resp){\n                    var rec = Wb.decode(resp.responseText).rows[0];\n                    setAllReadOnly(true);\n                    rec.BIZ_DATE = Wb.strToDate(rec.BIZ_DATE);\n                    Wb.setValue(app.editWinN,rec);\n                }\n            });\n            setButtonHide();\n        }\n    }\n});\nfunction returnRowFn(r,type){\n    if(type==='xip_pub_orgs'){\n        app.LEDGER_ID.setValue(r.data.LEDGER_ID);\n        app.ORG_ID.setValue(r.data.ORG_ID);\n        setMinDate(r.data.LEDGER_ID);\n        setOrg(r.data.ORG_ID,r.data.LEDGER_ID);\n        clearAll();\n    }\n    //选择项目带回成本中心\n    if(type == 'xc_pm_projects') {\n        app.DEPT_ID_XWL.DEPT_ID.setValue(r.data.DEPT_ID);\n        app.DEPT_ID_XWL.DEPT_NAME.setValue(r.data.DEPT_NAME);\n    }\n    //选择成本中心为项目查询的成本中心赋值\n    if(type == 'xip_pub_depts') {\n        if(r.data === undefined)\n            app.PROJECT_ID_XWL.QUERY_DEPT_ID.setValue(r.DEPT_ID);\n        else\n            app.PROJECT_ID_XWL.QUERY_DEPT_ID.setValue(r.data.DEPT_ID);\n    }\n    //仓库改变，清空该仓库下面入库单带出来的信息\n    if(type=='xc_st_warehouse'){\n        app.grid1.store.removeAll();\n    }\n}\nfunction clearOtherFn(type){\n    if(type=='xip_pub_orgs'){\n        app.LEDGER_ID.setValue(null);\n        app.ORG_ID.setValue(null);\n    }\n    //清空成本中心同时清空项目查询条件里的成本中心\n    if(type == 'xip_pub_depts') {\n        app.PROJECT_ID_XWL.QUERY_DEPT_ID.setValue('');\n    }\n    //仓库改变，清空该仓库下面入库单带出来的信息\n    if(type=='xc_st_warehouse'){\n        app.grid1.store.removeAll();\n    }\n}\nfunction setSomeReadOnly(flag){\n\tapp.ORG_XWL.ORG_NAME.setReadOnly(flag);\n    app.WAREHOUSE_XWL.WAREHOUSE_NAME.setReadOnly(flag);\n}\nfunction setAllReadOnly(flag){\n\tsetSomeReadOnly(flag);\n    app.USE_APPLY_H_NAME.setReadOnly(flag);\n    app.DEPT_ID_XWL.DEPT_NAME.setReadOnly(flag);\n    app.PROJECT_ID_XWL.PROJECT_NAME.setReadOnly(flag);\n    app.BIZ_DATE.setReadOnly(flag);\n    app.BUSINESS_TYPE_NAME.setReadOnly(flag);\n    app.QTY_COL.getEditor().setReadOnly(flag);\n    app.DESCRIPTION_COL.getEditor().setReadOnly(flag);\n    app.saveBtn.setDisabled(flag);\n    app.submitsButton.setDisabled(flag);\n    app.addBtn.setDisabled(flag);\n    app.delBtns.setDisabled(flag);\n}\nfunction setButtonHide(){\n    app.saveBtn.hide();\n    app.submitsButton.hide();\n    app.monitorBtn.hide();\n    app.withdrawBtn.hide();\n    app.enclosureBtn.hide();\n    app.grid1Tbar.hide();\n    app.closeBtn.hide();\n}\nfunction setOrg(orgId,ledgerId) {\n    app.PROJECT_ID_XWL.QUERY_LEDGER_ID.setValue(ledgerId);\n    app.DEPT_ID_XWL.QUERY_LEDGER_ID.setValue(ledgerId);\n    app.WAREHOUSE_XWL.QUERY_ORG_ID.setValue(orgId);\n    app.WAREHOUSE_XWL.LEDGER_ID.setValue(ledgerId);\n    app.WAREHOUSE_XWL.IS_INIT.setValue('Y');\n}\nfunction clearAll(){\n\tapp.DEPT_ID_XWL.DEPT_NAME.reset();\n\tapp.DEPT_ID_XWL.DEPT_ID.reset();\n    app.PROJECT_ID_XWL.PROJECT_ID.reset();\n    app.PROJECT_ID_XWL.PROJECT_NAME.reset();\n    app.PROJECT_ID_XWL.QUERY_DEPT_ID.reset();\n    app.grid1.store.removeAll();\n}\nfunction setMinDate(ledgerId){\n    Wb.request({//账簿会计期查询\n        url : 'm?xwl=xc/st/common/data/ledgerDateSelect',\n        params : {LEDGER_ID : ledgerId},\n        success : function(resp){\n            var temp = Wb.decode(resp.responseText);\n            if(temp.rows[0].START_DATE !== null && temp.rows[0].START_DATE !== \"\"){\n                app.BIZ_DATE.setMinValue(Wb.strToDate(temp.rows[0].START_DATE));\n                app.BIZ_DATE.setReadOnly(false);\n            }\n            else {\n                if(app.LEDGER_ID.getValue() !== null && app.LEDGER_ID.getValue() !== \"\"){\n                    Wb.toast('{#XC_ST_USE_APPLY_gzbmyqykjqqcxxz#}');//该账簿没有启用会计期，请重新选择！\n                    app.BIZ_DATE.reset();\n                    app.BIZ_DATE.setReadOnly(true);\n                }\n            }\n        }\n    });\n}\nfunction setDeptInfo(orgId){\n    Wb.request({\n        url : 'm?xwl=xc/ar/ct/data/selectDeptInfoByUserId',\n        params : {USER_ID : '{#XIP.userId#}',ORG_ID : orgId},\n        async : false,\n        success : function(resp){\n            var temp = Wb.decode(resp.responseText);\n            app.DEPT_ID_XWL.DEPT_ID.setValue(temp.DEPT_ID);\n            app.DEPT_ID_XWL.DEPT_NAME.setValue(temp.DEPT_NAME);\n            app.PROJECT_ID_XWL.QUERY_DEPT_ID.setValue(temp.DEPT_ID);\n        }\n    });\n}"},"children":[{"configs":{"itemId":"tools"},"children":[{"configs":{"itemId":"orgInitStore","url":"m?xwl=xc/com-lov/ORG_PICK/DB/ORG_SELECT_BY_LEDGER"},"events":{"load":"if(!Wb.isEmpty(ORG_NAME) && Wb.isInsert == 'Add'){\n    app.ORG_ID.setValue(ORG_ID);\n    app.LEDGER_ID.setValue(LEDGER_ID);\n    app.ORG_XWL.ORG_ID.setValue(ORG_ID);\n    app.ORG_XWL.ORG_NAME.setValue(ORG_NAME);\n    app.ORG_XWL.LEDGER_ID.setValue(LEDGER_ID);\n}\nif(Wb.isEmpty(ORG_NAME)){\n    if(store.getCount() > 0){\n        app.ORG_ID.setValue(store.getAt(0).get('ORG_ID'));\n        app.LEDGER_ID.setValue(store.getAt(0).get('LEDGER_ID'));\n        app.ORG_XWL.ORG_ID.setValue(store.getAt(0).get('ORG_ID'));\n        app.ORG_XWL.ORG_NAME.setValue(store.getAt(0).get('ORG_NAME'));\n        app.ORG_XWL.LEDGER_ID.setValue(store.getAt(0).get('LEDGER_ID'));\n    }\n}\nsetOrg(app.ORG_ID.getValue(),app.LEDGER_ID.getValue());\nsetMinDate(app.LEDGER_ID.getValue());\nsetDeptInfo(app.ORG_ID.getValue());\napp.BUSINESS_TYPE_NAME.getStore().load();"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"folder"},{"configs":{"maximized":"true","height":"530","layout":"border","width":"900","closeAction":"hide","itemId":"editWinN","border":"false","modal":"true","maximizable":"true"},"events":{"hide":"app.hideFun();"},"children":[{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"{#XC_ST_USE_APPLY_saveBtn#}","itemId":"saveBtn","iconCls":"save_icon"},"events":{"click":"/*--------------  验证数据是否合法  ---------------*/\nif (Wb.verify(app.editWinN) && Wb.verifyGrid(app.grid1)) {\n    //判断是否有明细\n    var store = app.grid1.store;\n    if(store.getCount() === 0){\n        Wb.toast('{#XC_ST_USE_APPLY_qtjmxsj#}');//请添加明细数据！\n        return;\n    }\n    //通过明细算出主表中的金额值\n    var AMOUNT = 0;\n    for (var i = 0; i < app.grid1.getStore().getCount(); i++) {\n        var r = app.grid1.getStore().getAt(i);\n        AMOUNT = AMOUNT + r.get('QTY');\n        if(Wb.isEmpty(r.get('DESCRIPTION'))){\n\t\t\tr.set('DESCRIPTION',app.USE_APPLY_H_NAME.getValue());\n        }\n    }\n    app.AMOUNT.setValue(AMOUNT);\n    Wb.sync({\n        url : '{#contextPath#}'+'/xcStDocsAction.do?method=saveOrUpdateXcStDocs',\n        grid : app.grid1,\n        params  : Wb.getValue(app.form1),\n        success : function(resp){\n            var record = Wb.decode(resp.responseText);\n            var msg = record.msg;\n            if(record.flag === '0'){\n                Wb.isInsert = 'Update';\n                Wb.toast('{#XC_ST_USE_APPLY_bccg#}');//保存成功！\n                app.USE_APPLY_H_CODE.setValue(record.docCode);\n                setSomeReadOnly(true);\n                app.grid1.store.load({params : {USE_APPLY_H_ID : USE_APPLY_H_ID}});\n                app.IS_CREATE.setValue('N');\n                tableValue = Wb.encode(Wb.getValue(app.form1));\n                isEditCol = 'N';\n            }\n            else{\n                Wb.toast(msg);//保存失败！\n            }\n        }\n    });\n} else {\n    Wb.verifyGrid(app.grid1);\n    Wb.toast('{#XC_ST_USE_APPLY_qsrsybsx#}');//请输入所有必输项！\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#XC_ST_USE_APPLY_submitBtn#}","itemId":"submitsButton","iconCls":"check_icon"},"events":{"click":"if(Wb.isInsert=='Add' || tableValue !== Wb.encode(Wb.getValue(app.form1)) || isEditCol == 'Y'){\n    Wb.toast('{#XC_ST_USE_APPLY_qxbcztj#}');//请先保存，再提交！\n    return false;\n}\nelse {\n    var auditStatus = app.AUDIT_STATUS.getValue();\n    if(auditStatus === 'E' || auditStatus === 'C'){//运行中、结束状态\n        Wb.toast('{#XC_ST_USE_APPLY_lcytjqcxxz#}');//流程已提交,请重新选择！\n        return false;\n    }\n    else{\n        Wb.request({\n            url : '{#contextPath#}' + '/xcStCommonAction.do?method=getXcStProcAndForms',\n            params : {LEDGER_ID : app.LEDGER_ID.getValue(),DOC_CAT_CODE : app.DOC_CAT_CODE.getValue()},\n            success : function(resp){\n                var temp = Wb.decode(resp.responseText);\n                if(temp.flag === '0'){\n                    //取得流程编码、电脑端审批表单和移动端审批表单\n                    var processCODE = temp.PROCESS_CODE;\n                    var pcApproveForm = temp.PC_A_FORM_URL;\n                    var mobileApproveForm = temp.M_A_FORM_URL;\n                    var orgId = temp.ORG_ID;\n                    if(pcApproveForm === \"\" || pcApproveForm === null || pcApproveForm === undefined){\n                        Wb.toast('{#XC_ST_USE_APPLY_wzddndspbd#}');\n                        return;\n                    }\n                    //电脑端和移动端审批表单为变量需要设置为全路径\n                    pcApproveForm = '{#appIP#}' + pcApproveForm;\n                    mobileApproveForm = '{#appIP#}' +  mobileApproveForm;\n                    //如果流程编码存在, 则提交流程审批处理\n                    if(processCODE !== \"\" && processCODE !== null && processCODE !== undefined){\n                        //如果项目未指定，则设置默认值为 \"-1\"\n                        var prjId = app.PROJECT_ID_XWL.PROJECT_ID.getValue();\n                        if(prjId === null || prjId === \"\" || prjId === undefined){\n                            prjId = \"-1\" ;\n                        }\n                        var json = {\n                            'APP_IP'\t\t\t: '{#appIP#}',\n                            'EMP_ID'\t\t\t: '{#XIP.empId#}',\n                            'loginName'\t\t\t: '{#XIP.userName#}',\n                            'M_A_FORM'\t\t\t: mobileApproveForm,\n                            'PC_A_FORM'\t\t\t: pcApproveForm,\n                            'arCatCode'\t\t\t: 'LYSQD',\n                            'billType'\t\t\t: 'LYSQD',\n                            'DEPT_ID'\t\t\t: app.DEPT_ID_XWL.DEPT_ID.getValue(),\n                            'DEPT_NAME'\t\t\t: app.DEPT_ID_XWL.DEPT_NAME.getValue(),\n                            'PROJECT_ID'\t\t: prjId,\n                            'ORG_ID'\t\t\t: orgId,\n                            'ledgerId'\t\t\t: app.LEDGER_ID.getValue(),\n                            'AMT'\t\t\t\t: app.AMOUNT.getValue(),\n                            'ABSAMT'\t\t\t: Math.abs(app.AMOUNT.getValue()),//金额绝对值\n                            'e_business_id'\t\t: app.USE_APPLY_H_ID.getValue()\n                        };\n                        if(auditStatus === 'A'){//起草状态\n                            XipWf.startAndSubmitByProcess(processCODE,json,function(e){//提交流程\n                                if(e.flag === 0){\n                                    app.INS_CODE.setValue(e.instanceCode);\n                                    submitSuccess();\n                                }\n                                else if(e.flag === 1){\n                                    Wb.toast(e.msg) ;\n                                }\n                            });\n                        }\n                        else if(auditStatus === 'D'){//驳回状态\n                            XipWf.submitInstance(app.INS_CODE.getValue(),json,function(e){//提交流程\n                                if(e.flag === 0){\n                                    submitSuccess();\n                                }\n                                else if(e.flag === 1){\n                                    Wb.toast(e.msg) ;\n                                }\n                            });\n                        }\n                        else if(auditStatus === 'R'){//撤回状态\n                            XipWf.restartAndSubmitByProcess(app.INS_CODE.getValue(),processCODE,json,function(e){//提交流程\n                                if(e.flag === 0){\n                                    submitSuccess();\n                                }\n                                else if(e.flag === 1){\n                                    Wb.toast(e.msg) ;\n                                }\n                            });\n                        }\n                    }\n                    else{\n                        Wb.toast(temp.msg);\n                    }\n                }\n            }\n        });\n    }\n}\nfunction submitSuccess(){\n    Wb.request({\n        url : 'm?xwl=xc/st/st_business/XC_ST_USE_APPLY/data/stUseApplyHSelectById',\n        params : {USE_APPLY_H_ID : app.USE_APPLY_H_ID.getValue()},\n        success : function(resp){\n            var r = Wb.decode(resp.responseText);\n            if(r.rows[0].SYS_AUDIT_STATUS == 'E'){\n                app.SYS_AUDIT_STATUS.setValue('E');\n                app.AUDIT_STATUS.setValue('E');\n                app.SYS_AUDIT_STATUS_DESC.setValue('{#XC_ST_USE_APPLY_SYS_E#}');\n            }\n            else{\n                app.SYS_AUDIT_STATUS.setValue('C');\n                app.AUDIT_STATUS.setValue('C');\n                app.SYS_AUDIT_STATUS_DESC.setValue('{#XC_ST_USE_APPLY_SYS_C#}');\n            }\n            tableValue = Wb.encode(Wb.getValue(app.form1));\n        }\n    });\n    setAllReadOnly(true);\n    Wb.toast('{#XC_ST_USE_APPLY_lctjcg#}');\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#XC_ST_USE_APPLY_monitorBtn#}","itemId":"monitorBtn","iconCls":"viewport_icon"},"events":{"click":"if(app.INS_CODE.getValue() === null || app.INS_CODE.getValue() === ''){\n    Wb.toast('{#XC_ST_USE_APPLY_qxzytyjcjdlcsldsj#}');\n    return;\n}\nelse{\n    XipWf.showMonitorPage(app.INS_CODE.getValue());\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#XC_ST_USE_APPLY_withdrawBtn#}","itemId":"withdrawBtn","iconCls":"cancel_icon"},"events":{"click":"if(app.INS_CODE.getValue() === null || app.INS_CODE.getValue() === '') {\n    Wb.toast('{#XC_ST_USE_APPLY_lcmytjbnch#}');//流程没有提交，不能撤回！\n\treturn;\n}\nelse if(app.AUDIT_STATUS.getValue() === 'E') {\n    Wb.toast('{#XC_ST_USE_APPLY_lcsptgbnch#}');//流程审批通过，不能撤回！\n\treturn;\n}\nelse if(app.AUDIT_STATUS.getValue() === 'R'){\n    Wb.toast('{#XC_ST_USE_APPLY_lcyjchcg#}');//流程已经撤回成功\n    return;\n}\nelse if(app.AUDIT_STATUS.getValue() === 'D'){\n\tWb.toast('{#XC_ST_USE_APPLY_lcyjbh#}');//流程已经驳回！\n    return;\n}\nelse {\n\t//撤回流程\n\tXipWf.revokeByInstance(app.INS_CODE.getValue(),function(e){\n        if(e.flag === '0'){\n            app.AUDIT_STATUS.setValue('R');\n            app.SYS_AUDIT_STATUS.setValue('A');\n            app.SYS_AUDIT_STATUS_DESC.setValue('{#XC_ST_USE_APPLY_SYS_A#}');\n            setAllReadOnly(false);\n            setSomeReadOnly(true);\n        }\n        Wb.toast(e.msg);\n        tableValue = Wb.encode(Wb.getValue(app.form1));\n\t});\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#XC_ST_USE_APPLY_closeBtn#}","itemId":"closeBtn","iconCls":"close_icon"},"events":{"click":"if(app.SYS_AUDIT_STATUS.getValue() == 'G'){\n\tWb.toast('{#XC_ST_USE_APPLY_sxdjyjgb#}');//所选单据已经关闭，不能再次关闭！\n    return;\n}\nif(app.SYS_AUDIT_STATUS.getValue() != 'E'){\n    Wb.toast('{#XC_ST_USE_APPLY_sxdjspwtgbngb#}');//所选单据非草稿状态，不能删除！\n    return;\n}\nvar closeArray = [] ;\nvar closeData =  {stDocId : app.USE_APPLY_H_ID.getValue()};\ncloseArray.push(closeData);\nWb.request({\n    url : '{#contextPath#}' + '/xcStDocsAction.do?method=closeXcStUseApply',\n    params: Wb.apply({hIds : closeArray}),\n    success: function(resp){\n        Wb.toast('{#XC_ST_USE_APPLY_gbcg#}');\n        app.SYS_AUDIT_STATUS.setValue('G');\n        app.SYS_AUDIT_STATUS_DESC.setValue('{#XC_ST_USE_APPLY_closeBtn#}');\n    }\n});\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#XC_ST_USE_APPLY_enclosureBtn#}","itemId":"enclosureBtn","iconCls":"attach_icon"},"events":{"click":"if(Wb.isInsert == 'Add'){\n    Wb.toast('{#XC_ST_USE_APPLY_qxbcztjfj#}');\n    return false;\n}\nvar temp_id = app.USE_APPLY_H_ID.getValue();\nvar temp_code = app.USE_APPLY_H_CODE.getValue();\nWb.request({\n    url : '{#contextPath#}' + '/xcStCommonAction.do?method=getXcStAttCatCode',\n    params : {LEDGER_ID : app.LEDGER_ID.getValue(),DOC_CAT_CODE : app.DOC_CAT_CODE.getValue()},\n    success : function(resp){\n        var temp = Wb.decode(resp.responseText);\n        if(temp.flag == '0'){\n            var attCatCode = temp.attCatCode;\n            Xip.showAttachmentManager('{#XIP.userId#}',temp_id,'',attCatCode,temp_code,'Y','Y','Y',function(){},10); \n        }\n        else{\n            Wb.toast(temp.msg);\n        }\n    }\n});"},"children":[],"expanded":true,"type":"button"}],"expanded":true,"type":"array"},{"configs":{"region":"north","frame":"false","itemId":"form1","bodyPadding":"0 0 0 0","border":"false"},"children":[{"configs":{"style":"fontSize:20px","html":"<font style=\"\">{#XC_ST_USE_APPLY_LYSQD#}<\/font>","margin":"10 0 20 0","labelAlign":"center","itemId":"title"},"children":[],"expanded":false,"type":"label"},{"configs":{"frame":"false","layout":"column","margin":"5 0 0 0","itemId":"tr_1","border":"false"},"children":[{"configs":{"frame":"false","style":"border-width:0px","layout":"form","columnWidth":".249","itemId":"td_1_1","border":"false"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/ORG_PICK/ORG_ALL_PICK","itemId":"ORG_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"frame":"false","style":"border-width:0px","layout":"form","columnWidth":".249","itemId":"td_1_2","border":"false"},"children":[{"configs":{"file":"m?xwl=xc/st/common/st_com_lov/XC_ST_WAREHOUSE_LOV/XC_ST_WAREHOUSE_LOV","itemId":"WAREHOUSE_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"frame":"false","style":"border-width:0px","layout":"form","columnWidth":".249","itemId":"td_1_3","border":"false"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"USE_APPLY_H_CODE","fieldLabel":"{#XC_ST_USE_APPLY_USE_APPLY_H_CODE#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".249","border":"false","itemId":"td_1_4"},"children":[{"configs":{"labelWidth":"80","allowBlank":"false","labelAlign":"right","itemId":"BIZ_DATE","fieldLabel":"<font color='red'>*<\/font>{#XC_ST_USE_APPLY_BIZ_DATE#}"},"children":[],"expanded":false,"type":"date"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"frame":"false","layout":"column","margin":"5 0 0 0","itemId":"tr_2","border":"false"},"children":[{"configs":{"frame":"false","style":"border-width:0px","layout":"form","columnWidth":".249","itemId":"td_2_1","border":"false"},"children":[{"configs":{"labelWidth":"80","allowBlank":"false","displayField":"BUSINESS_TYPE_NAME","valueField":"BUSINESS_TYPE_NAME","labelAlign":"right","itemId":"BUSINESS_TYPE_NAME","fieldLabel":"<font color='red'>*<\/font>{#XC_ST_USE_APPLY_BUSINESS_TYPE_NAME#}","editable":"false"},"events":{"select":"app.BUSINESS_TYPE_ID.setValue(records[0].data.BUSINESS_TYPE_ID);"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/st/ld_base/XC_ST_LD_BUSINESS_TYPE/data/stLdBusinessTypeSelect"},"events":{"load":"if(store.getCount() > 0){\n    app.BUSINESS_TYPE_NAME.setValue(store.getAt(0).get('BUSINESS_TYPE_NAME'));\n    app.BUSINESS_TYPE_ID.setValue(store.getAt(0).get('BUSINESS_TYPE_ID'));\n}","beforeload":"store.proxy.extraParams.LEDGER_ID = app.LEDGER_ID.getValue();\nstore.proxy.extraParams.DOC_CAT_CODE = 'LYCK';"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"frame":"false","style":"border-width:0px","layout":"form","columnWidth":".249","itemId":"td_2_2","border":"false"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/DEPT_ID_PICK/DEPT_ID_LD","itemId":"DEPT_ID_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"frame":"false","style":"border-width:0px","layout":"form","columnWidth":".249","itemId":"td_2_3","border":"false"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/PROJECT_ID_PICK/PROJECT_ID_LD","itemId":"PROJECT_ID_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"frame":"false","layout":"column","margin":"5 0 5 0","itemId":"tr_3","border":"false"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".498","border":"false","itemId":"td_3_1"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"USE_APPLY_H_NAME","fieldLabel":"{#XC_ST_USE_APPLY_USE_APPLY_H_NAME#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"frame":"false","style":"border-width:0px","layout":"form","columnWidth":".249","itemId":"td_3_2","border":"false"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"APPLY_PERSON","fieldLabel":"{#XC_ST_USE_APPLY_APPLY_PERSON#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"frame":"false","style":"border-width:0px","layout":"form","columnWidth":".249","itemId":"td_3_3","border":"false"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"SYS_AUDIT_STATUS_DESC","fieldLabel":"{#XC_ST_USE_APPLY_SYS_AUDIT_STATUS#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"frame":"false","hidden":"true","layout":"column","itemId":"hidePanel","border":"false"},"children":[{"configs":{"itemId":"ORG_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"LEDGER_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"USE_APPLY_H_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"BUSINESS_TYPE_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","value":"LYSQD","itemId":"DOC_CAT_CODE"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"APPLY_PERSON_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"INS_CODE","fieldLabel":"实例编码"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"AUDIT_STATUS","fieldLabel":"审批状态"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"SYS_AUDIT_STATUS","fieldLabel":"审批状态"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"AMOUNT"},"children":[],"expanded":false,"type":"number"},{"configs":{"hidden":"true","itemId":"IS_CREATE"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","value":"SQD","itemId":"docClassCode"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"form"},{"configs":{"region":"center","selType":"checkboxmodel","itemId":"grid1","editable":"true"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/st/st_business/XC_ST_USE_APPLY/data/stUseApplyLSelect"},"events":{"update":"isEditCol = 'Y';","remove":"isEditCol = 'Y';","add":"isEditCol = 'Y';"},"children":[],"expanded":false,"type":"store"},{"configs":{"normalName":"grid1Tbar","itemId":"tbar"},"children":[{"configs":{"text":"{#XC_ST_USE_APPLY_addLBtn#}","itemId":"addBtn","iconCls":"file_add_icon"},"events":{"click":"if(Wb.isEmpty(app.WAREHOUSE_XWL.WAREHOUSE_ID.getValue())){\n    Wb.toast('{#XC_ST_USE_APPLY_qxxzck#}');\n    return;\n}\nWb.run({\n    url: 'm?xwl=xc/st/common/st_com_lov/XC_ST_MATERIAL_LOV/XC_ST_MATERIAL_LOV_LY', \n    success: function(apps) {\n        apps.initWin({\n            LEDGER_ID : app.LEDGER_ID.getValue(),\n            ORG_ID : app.ORG_ID.getValue(),\n            WAREHOUSE_ID : app.WAREHOUSE_XWL.WAREHOUSE_ID.getValue(),\n            hideFun : function(rs){\n                Wb.each(rs, function(r) {\n                    var grid1Store = app.grid1.getStore();\n                    for(var i = 0;i < grid1Store.getCount();i++){\n                        var gr = grid1Store.getAt(i);\n                        if(gr.get('MATERIAL_ID') == r.get('MATERIAL_ID')){\n                            app.grid1.getStore().removeAt(i);\n                        }\n                    }\n                    Wb.add(app.grid1, {\n                        USE_APPLY_L_ID : Xip.getId(),\n                        USE_APPLY_H_ID : app.USE_APPLY_H_ID.getValue(),\n                        MATERIAL_ID : r.get('MATERIAL_ID'),\n                        QTY : r.get('CKSL'),\n                        SPECIFICATION : r.get('SPECIFICATION'),\n                        MATERIAL_CODE : r.get('MATERIAL_CODE'),\n                        MATERIAL_NAME : r.get('MATERIAL_NAME'),\n                        USE_APPLY_L_CODE : app.grid1.store.getCount()+1,\n                        DIM_ID : r.get('DIM_ID'),\n                        DIM_NAME : r.get('DIM_NAME'),\n                        ORG_ID : app.ORG_ID.getValue(),\n                        LEDGER_ID : app.LEDGER_ID.getValue()\n                    },'after', 1, false);\n                });\n            }\n        });\n    }\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#XC_ST_USE_APPLY_delLBtns#}","itemId":"delBtns","iconCls":"file_delete_icon"},"events":{"click":"//删除原则，先将选中记录在表格中移除，点击主单保存时，才真正从数据库删除。\nvar recs = app.grid1.getSelection();\nif (!recs.length) {\n    Wb.toast('{#XC_ST_USE_APPLY_qxzxyscdjl#}');\n    return;\n}\nWb.confirm('{#XC_ST_USE_APPLY_qdyscxzd#} ' + recs.length + ' {#XC_ST_USE_APPLY_tjlm#}', function() {\n\tWb.remove(app.grid1,recs);\n});"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"USE_APPLY_L_ID","hidden":"true","dataIndex":"USE_APPLY_L_ID","titleAlign":"center","itemId":"USE_APPLY_L_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"USE_APPLY_H_ID","hidden":"true","dataIndex":"USE_APPLY_H_ID","titleAlign":"center","itemId":"USE_APPLY_H_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"<font color='red'>*<\/font>{#XC_ST_USE_APPLY_MATERIAL_CODE#}","width":"120","dataIndex":"MATERIAL_CODE","titleAlign":"center","itemId":"MATERIAL_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"<font color='red'>*<\/font>{#XC_ST_USE_APPLY_MATERIAL_NAME#}","width":"120","dataIndex":"MATERIAL_NAME","titleAlign":"center","itemId":"MATERIAL_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#XC_ST_USE_APPLY_SPECIFICATION#}","width":"100","dataIndex":"SPECIFICATION","titleAlign":"center","itemId":"SPECIFICATION_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"<font color='red'>*<\/font>{#XC_ST_USE_APPLY_QTY#}","align":"right","width":"100","dataIndex":"QTY","titleAlign":"center","itemId":"QTY_COL"},"children":[{"configs":{"decimalPrecision":"6","allowBlank":"false","itemId":"editor"},"children":[],"expanded":false,"type":"number"}],"expanded":false,"type":"column"},{"configs":{"text":"<font color='red'>*<\/font>{#XC_ST_USE_APPLY_DIM_NAME#}","width":"80","dataIndex":"DIM_NAME","titleAlign":"center","itemId":"DIM_NAME_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#XC_ST_USE_APPLY_DESCRIPTION#}","width":"200","dataIndex":"DESCRIPTION","titleAlign":"center","itemId":"DESCRIPTION_COL"},"children":[{"configs":{"itemId":"editor"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"window"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}