{"inframe":false,"title":"仓库管理","hidden":false,"roles":{"default":1},"children":[{"configs":{"loginRequired":"false","serverScript":"//---------------------获取当前模块语言对应的.json文件，放到request中----------------\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xc/st/ld_base/XC_ST_WAREHOUSE/json/XC_ST_WAREHOUSE\");","itemId":"module"},"events":{"finalize":"var empInfoArray = [];\nfunction returnRowFn(r,type){\n    if(type==='xip_pub_orgs'){\n        app.LEDGER_ID.setValue(r.data.LEDGER_ID);\n        app.LEDGER_NAME.setValue(r.data.LEDGER_NAME);\n        app.ORG_ID.setValue(r.data.ORG_ID);\n        app.queryBtn.fireEvent('click');\n    }\n}\nfunction clearOtherFn(type){\n    if(type=='xip_pub_orgs'){\n        app.queryBtn.fireEvent('click');\n    }\n}"},"children":[{"configs":{"itemId":"tools"},"children":[{"configs":{"itemId":"orgInitStore","autoLoad":"true","url":"m?xwl=xc/com-lov/ORG_PICK/DB/ORG_SELECT_BY_LEDGER"},"events":{"load":"if(store.getCount() > 0){\n    app.LEDGER_ID.setValue(store.getAt(0).get('LEDGER_ID'));\n    app.LEDGER_NAME.setValue(store.getAt(0).get('LEDGER_NAME'));\n    app.ORG_ID.setValue(store.getAt(0).get('ORG_ID'));\n    app.ORG_XWL.ORG_ID.setValue(store.getAt(0).get('ORG_ID'));\n    app.ORG_XWL.ORG_NAME.setValue(store.getAt(0).get('ORG_NAME'));\n    app.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"folder"},{"configs":{"layout":"border","itemId":"viewport1"},"children":[{"configs":{"region":"north","itemId":"search_form"},"children":[{"configs":{"layout":"column","margin":"5 0 5 0","border":"false","itemId":"row1"},"children":[{"configs":{"layout":"form","columnWidth":".249","border":"false","itemId":"row1_1"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/ORG_PICK/ORG_ALL_PICK","itemId":"ORG_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".249","border":"false","itemId":"row1_2"},"children":[{"configs":{"labelWidth":"100","labelAlign":"right","itemId":"WAREHOUSE_CODE_NAME","fieldLabel":"{#XC_ST_WAREHOUSE_WAREHOUSE_CODE_NAME#}"},"events":{"specialkey":"if(e.getKey()===13) {\n  app.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"80","readOnly":"true","hidden":"true","labelAlign":"right","itemId":"LEDGER_NAME","fieldLabel":"账簿ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"80","readOnly":"true","hidden":"true","labelAlign":"right","itemId":"LEDGER_ID","fieldLabel":"账簿ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"80","readOnly":"true","hidden":"true","labelAlign":"right","itemId":"ORG_ID","fieldLabel":"组织ID"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".249","border":"false","itemId":"row1_4"},"children":[{"configs":{"layout":"column","border":"false","itemId":"row1_4_1"},"children":[{"configs":{"text":"{#XC_ST_WAREHOUSE_searchButton#}","itemId":"queryBtn","iconCls":"seek_icon"},"events":{"click":"app.grid.store.load({params : {LEDGER_ID: app.LEDGER_ID.getValue(),\n                              WAREHOUSE_CODE_NAME : app.WAREHOUSE_CODE_NAME.getValue()}});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#XC_ST_WAREHOUSE_resetButton#}","itemId":"clearBtn","iconCls":"refresh_icon"},"events":{"click":"app.search_form.getForm().reset();\napp.queryBtn.fireEvent('click');"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"form"},{"configs":{"region":"center","selType":"checkboxmodel","barExportButtons":"false","barExportAllButtons":"false","itemId":"grid","editable":"true"},"events":{"tagEvents":"cellclick:function(view, td, cellIndex, record, tr, rowIndex, event, options){\n    if(cellIndex == 2){\n        if(record.get('OP_TYPE')=='Add')\n            app.WAREHOUSE_CODE_COL.getEditor().setReadOnly(false);\n        else\n            app.WAREHOUSE_CODE_COL.getEditor().setReadOnly(true);\n    }\n    if(cellIndex == 4){\n        if(Wb.isEmpty(record.get('IS_USE_WAREHOUSE_ID')))\n            app.VALUATION_METHOD_COL.getEditor().setReadOnly(false);\n        else\n            app.VALUATION_METHOD_COL.getEditor().setReadOnly(true);\n    }\n    if(cellIndex == 6){\n        if(Wb.isEmpty(record.get('IS_USE_WAREHOUSE_ID')))\n            app.IS_LOCATION_COL.getEditor().setReadOnly(false);\n        else\n            app.IS_LOCATION_COL.getEditor().setReadOnly(true);\n    }\n    if(cellIndex == 7){\n        var INIT = null;\n        if(record.get('IS_INIT') == 'Y'){//初始化已完成\n            Wb.request({\n                url : 'm?xwl=xc/st/ld_base/XC_ST_WAREHOUSE/data/normalDocumentsStatus',\n                params : {WAREHOUSE_ID : record.get('WAREHOUSE_ID')},//传参\n                async : false,\n                success: function(resp){\n                    var r = Wb.decode(resp.responseText);\n                    if(r.total > 0)//该仓库下初始化单据记账未完成\n                        app.IS_INIT_COL.getEditor().setReadOnly(true);\n                    else\n                        app.IS_INIT_COL.getEditor().setReadOnly(false);\n                }\n            });\n        }\n        else{//未完成\n            Wb.request({\n                url : 'm?xwl=xc/st/ld_base/XC_ST_WAREHOUSE/data/initDocumentsStatus',\n                params : {WAREHOUSE_ID : record.get('WAREHOUSE_ID')},//传参\n                async : false,\n                success: function(resp){\n                    var r = Wb.decode(resp.responseText);\n                    if(r.total > 0)//该仓库下初始化单据记账未完成\n                        app.IS_INIT_COL.getEditor().setReadOnly(true);\n                    else\n                        app.IS_INIT_COL.getEditor().setReadOnly(false);\n                }\n            });\n        }\n    }\n}"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/st/ld_base/XC_ST_WAREHOUSE/data/stWarehouseSelect"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"{#XC_ST_WAREHOUSE_addBtn#}","itemId":"addBtn","iconCls":"file_add_icon"},"events":{"click":"if(Wb.isEmpty(app.ORG_XWL.ORG_NAME.getValue())){\n\tWb.toast('{#XC_ST_WAREHOUSE_qxxzzzzjxxzcz#}');\n    return;\n}\nWb.addEdit(app.grid,[{ORG_ID : app.ORG_ID.getValue(),\n                      LEDGER_ID : app.LEDGER_ID.getValue(),\n                      ORG_NAME : app.ORG_XWL.ORG_NAME.getValue(),\n                      STATUS : 'Y',\n                      IS_LOCATION : 'Y',\n                      IS_INIT : 'N',\n                      WAREHOUSE_ID : Xip.getId(),\n                      OP_TYPE : \"Add\"}]);"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#XC_ST_WAREHOUSE_saveBtn#}","itemId":"saveBtn","iconCls":"save_icon"},"events":{"click":"var rec = app.grid.getSelection();//选择一行信息\nvar modify = app.grid.store.getModifiedRecords();\nif((modify === '' || modify.length === 0)){\n    Wb.toast('{#XC_ST_WAREHOUSE_mysjxybc#}');\n\treturn;\n}\nif(!Wb.verifyGrid(app.grid))//验证数据是否合法\n\treturn;\nWb.sync({\n    grid : app.grid,\n    url : 'm?xwl=xc/st/ld_base/XC_ST_WAREHOUSE/data/stWarehouseUpdate',\n    success : function(resp) {\n        Wb.toast('{#XC_ST_WAREHOUSE_sjbccg#}');\n        if(empInfoArray.length !== 0){\n            Wb.request({\n                url : 'm?xwl=xc/st/ld_base/XC_ST_WAREHOUSE/data/stWarehouseKeeperInsert', \n                params : {'infoArray' : empInfoArray},\n                success : function(){\n                    app.queryBtn.fireEvent('click');\n                    empInfoArray = [];\n                }\n            });\n        }\n        else{\n            app.queryBtn.fireEvent('click');\n        }\n    }\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#XC_ST_WAREHOUSE_deleteBtn#}","itemId":"deleteBtn","iconCls":"file_delete_icon"},"events":{"click":"var recs = app.grid.getSelection();//获得选中数据\nif (!recs.length) {//选中的数据条数\n\tWb.toast('{#XC_ST_WAREHOUSE_qxzxyscdjl#}');\n\treturn;\n}\nWb.confirm('{#XC_ST_WAREHOUSE_qdyscxzd#} ' + recs.length + ' {#XC_ST_WAREHOUSE_tjlm#}',function() {\n    Wb.request({\n        url : 'm?xwl=xc/st/ld_base/XC_ST_WAREHOUSE/data/stWarehouseDelete',\n        params : {'infoArray' : Wb.encode(Wb.getData(recs))},//传参\n        success: function(resp){\n            Wb.toast('{#XC_ST_WAREHOUSE_cksccg#}');\n            Wb.remove(app.grid,recs);\n        }\n    });\n});"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#XC_ST_WAREHOUSE_NUMBER_COL#}","xtype":"rownumberer","width":"50","align":"center","titleAlign":"center","itemId":"NUMBER_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"<font color='red'>*<\/font>{#XC_ST_WAREHOUSE_WAREHOUSE_CODE#}","width":"120","dataIndex":"WAREHOUSE_CODE","titleAlign":"center","itemId":"WAREHOUSE_CODE_COL"},"children":[{"configs":{"allowBlank":"false","itemId":"editor"},"events":{"change":"var rec = app.grid.getSelection();//获得选中数据\nvar row = app.grid.store.indexOf(rec[0]);//获得选中行号\nfor(var i = 0;i < app.grid.store.getCount();i++){\n    var data = app.grid.store.getAt(i);\n    if(newValue == data.get(\"WAREHOUSE_CODE\") && row != i && !Wb.isEmpty(newValue)){\n\t\tWb.toast('{#XC_ST_WAREHOUSE_WAREHOUSE_CODE#} \"' + newValue + '\" {#XC_ST_WAREHOUSE_yjcz#}');\n        text.setValue(null);\n        return;\n    }\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"column"},{"configs":{"text":"<font color='red'>*<\/font>{#XC_ST_WAREHOUSE_WAREHOUSE_NAME#}","width":"150","dataIndex":"WAREHOUSE_NAME","titleAlign":"center","itemId":"WAREHOUSE_NAME_COL"},"children":[{"configs":{"allowBlank":"false","itemId":"editor"},"events":{"change":"var rec = app.grid.getSelection();//获得选中数据\nvar row = app.grid.store.indexOf(rec[0]);//获得选中行号\nfor(var i = 0;i < app.grid.store.getCount();i++){\n    var data = app.grid.store.getAt(i);\n    if(newValue == data.get(\"WAREHOUSE_NAME\") && row != i && !Wb.isEmpty(newValue)){\n\t\tWb.toast('{#XC_ST_WAREHOUSE_WAREHOUSE_NAME#} \"' + newValue + '\" {#XC_ST_WAREHOUSE_yjcz#}');\n        text.setValue(null);\n        return;\n    }\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"column"},{"configs":{"text":"<font color='red'>*<\/font>{#XC_ST_WAREHOUSE_VALUATION_METHOD#}","width":"120","dataIndex":"VALUATION_METHOD","titleAlign":"center","itemId":"VALUATION_METHOD_COL"},"children":[{"configs":{"allowBlank":"false","displayField":"VAL_NAME","valueField":"VAL_NAME","itemId":"editor","editable":"false"},"events":{"select":"var rec = app.grid.getSelection();\nrec[0].set('VALUATION_MODEL',records[0].data.VAL_CODE);","focus":"var rec = app.grid.getSelection()[0];\n"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/st/ld_base/XC_ST_WAREHOUSE/data/stPriceMethodSelect"},"children":[],"expanded":false,"type":"store"}],"expanded":false,"type":"combo"}],"expanded":true,"type":"column"},{"configs":{"text":"{#XC_ST_WAREHOUSE_EMP_NAME#}","width":"200","dataIndex":"EMP_NAME","titleAlign":"center","itemId":"EMP_NAME_COL"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","normalName":"EMP_NAME_PICK","itemId":"editor"},"events":{"expand":"picker.getPicker().getStore().load();","collapse":"app.QUERY_CODE_NAME.reset();"},"children":[{"configs":{"tagConfigs":"minWidth:400","multiSelect":"true","selType":"checkboxmodel","height":"300","barExportButtons":"false","barExportAllButtons":"false","itemId":"pickComp"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/st/common/data/xip_pub_usersSelectByLedgerId"},"events":{"load":"var rec = app.grid.getSelection();\nvar strs = rec[0].data.EMP_NAME.split(',');\nvar userRec,selRecs = [];\nfor(var j = 0;j < strs.length;j++){\n    userRec = Wb.find(app.EMP_NAME_PICK.getPicker().store,'EMP_NAME',strs[j]);\n    if (userRec)\n      selRecs.push(userRec);\n}\napp.EMP_NAME_PICK.getPicker().setSelection(selRecs);","beforeload":"var rec = app.grid.getSelection();\nstore.proxy.extraParams.QUERY_LEDGER_ID = rec[0].data.LEDGER_ID;\nstore.proxy.extraParams.QUERY_CODE_NAME = app.QUERY_CODE_NAME.getValue();"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"ID","hidden":"true","dataIndex":"EMP_ID","itemId":"EMP_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#XC_ST_WAREHOUSE_EMP_CODE#}","dataIndex":"EMP_CODE","titleAlign":"center","itemId":"EMP_CODE_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#XC_ST_WAREHOUSE_EMP_NAMES#}","dataIndex":"EMP_NAME","titleAlign":"center","itemId":"EMP_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"100","labelAlign":"right","itemId":"QUERY_CODE_NAME","fieldLabel":"{#XC_ST_WAREHOUSE_QUERY_CODE_NAME#}"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.searchButton.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"searchButton","iconCls":"seek_icon"},"events":{"click":"app.pickComp.getStore().load();"},"children":[],"expanded":false,"type":"button"},{"configs":{"itemId":"cancelBtn","iconCls":"delete_icon"},"events":{"click":"var rec = app.grid.getSelection();\nrec[0].set('EMP_ID',null);\nrec[0].set('EMP_NAME',null);\napp.QUERY_CODE_NAME.reset(); \napp.EMP_NAME_PICK.getPicker().hide();\nempInfoArray = [];"},"children":[],"expanded":false,"type":"item"},{"configs":{"itemId":"okButton","iconCls":"ok_icon","tooltip":"{#XC_ST_WAREHOUSE_selectBtn#}"},"events":{"click":"var recs = app.grid.getSelection()[0];//仓库列表\nvar rec = app.EMP_NAME_PICK.getPicker().getSelection();//库管员列表\nif(rec.length === 0){\n    recs.set('EMP_ID',null);\n    recs.set('EMP_NAME',null);\n}\n//根据当前选中的员工ID判断当前员工是否是库管员\nfor(var i = 0;i < rec.length;i++){\n    var data = {WAREHOUSE_KEEPER_ID : Xip.getId(),\n                ORG_ID : app.ORG_ID.getValue(),\n                LEDGER_ID : app.LEDGER_ID.getValue(),\n                WAREHOUSE_ID : recs.data.WAREHOUSE_ID,\n                EMP_ID : rec[i].data.USER_ID};\n    empInfoArray.push(data);\n}\nvar empName = '';\nfor(var j = 0;j < rec.length;j++){\n    if(j == rec.length - 1)\n        empName = empName + rec[j].data.EMP_NAME;\n    else\n        empName = empName + rec[j].data.EMP_NAME+',';\n}\napp.EMP_NAME_PICK.setValue(empName);\napp.EMP_NAME_PICK.getPicker().hide();"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":false,"type":"picker"}],"expanded":true,"type":"column"},{"configs":{"text":"{#XC_ST_WAREHOUSE_IS_LOCATION#}","width":"120","dataIndex":"IS_LOCATION","titleAlign":"center","itemId":"IS_LOCATION_COL","renderer":"if(value == 'Y')\n    return '{#XC_ST_WAREHOUSE_YES#}';\nif(value == 'N')\n    return '{#XC_ST_WAREHOUSE_NO#}';"},"children":[{"configs":{"pickList":"[['Y','{#XC_ST_WAREHOUSE_YES#}'],['N','{#XC_ST_WAREHOUSE_NO#}']]","itemId":"editor"},"children":[],"expanded":true,"type":"combo"}],"expanded":true,"type":"column"},{"configs":{"text":"{#XC_ST_WAREHOUSE_IS_INIT#}","width":"120","dataIndex":"IS_INIT","titleAlign":"center","itemId":"IS_INIT_COL","renderer":"if(value == 'Y')\n    return '{#XC_ST_WAREHOUSE_YES#}';\nif(value == 'N')\n    return '{#XC_ST_WAREHOUSE_NO#}';"},"children":[{"configs":{"pickList":"[['Y','{#XC_ST_WAREHOUSE_YES#}'],['N','{#XC_ST_WAREHOUSE_NO#}']]","itemId":"editor"},"children":[],"expanded":true,"type":"combo"}],"expanded":true,"type":"column"},{"configs":{"text":"{#XC_ST_WAREHOUSE_STATUS#}","width":"100","dataIndex":"STATUS","titleAlign":"center","itemId":"STATUS_COL","renderer":"if(value == 'Y')\n    return '{#XC_ST_WAREHOUSE_Y#}';\nif(value == 'N')\n    return '{#XC_ST_WAREHOUSE_N#}';"},"children":[{"configs":{"pickList":"[['Y','{#XC_ST_WAREHOUSE_Y#}'],['N','{#XC_ST_WAREHOUSE_N#}']]","itemId":"editor","editable":"false"},"children":[],"expanded":true,"type":"combo"}],"expanded":true,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}