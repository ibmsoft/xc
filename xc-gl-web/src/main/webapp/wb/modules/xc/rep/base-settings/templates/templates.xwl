{"inframe":false,"title":"报表模板管理","hidden":false,"roles":{"default":1},"children":[{"configs":{"serverScript":"// 获取当前模块语言对应的.json文件，放到request中\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,'xc/rep/base-settings/templates/json/templates');\n\nrequest.setAttribute(\"ctxPath\",request.getContextPath()) ;","itemId":"module"},"children":[{"configs":{"itemId":"wins"},"children":[{"configs":{"title":"{#newTabWin#}","layout":"fit","width":"500","closeAction":"hide","itemId":"newTabWin","modal":"true"},"children":[{"configs":{"height":"90","layout":"form","bodyPadding":"10","itemId":"newTplForm"},"children":[{"configs":{"itemId":"TAB_ID"},"children":[],"expanded":false,"type":"hidden"},{"configs":{"labelWidth":"90","labelAlign":"right","itemId":"tabCode","fieldLabel":"<font color=red>*<\/font>{#tabCode#}"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"90","labelAlign":"right","itemId":"tabName","fieldLabel":"<font color=red>*<\/font>{#tabName#}"},"children":[],"expanded":false,"type":"text"}],"expanded":false,"type":"form"},{"configs":{"itemId":"buttons"},"children":[{"configs":{"text":"{#btnOK#}","itemId":"btnOK","iconCls":"ok_icon"},"events":{"click":"// TODO: 报表模板基础信息\nvar tabCode = app.tabCode.getValue() ;\nvar tabName = app.tabName.getValue() ;\nif(Wb.isEmpty(tabCode)){\n  Wb.toast('请录入模板编码') ;\n  return false ;\n}\nif(Wb.isEmpty(tabName)){\n  Wb.toast('请录入模板名称') ;\n  return false ;\n}\n\n// TODO: 参数信息\nvar paramJson = Wb.getValue(app.newTplForm) ;\nparamJson.accHrcyId = app.cbx_hrcy.getValue() ;\n\nvar msg = Ext.MessageBox.show({\n  title:'请等待',\n  msg:'正在提交请求，请稍后...',\n  width:240,\n  wait:true,\n  progress :true,\n  closable :false\n});\n\n// TODO: 提交请求\nWb.request({\n  url: '{#ctxPath#}'+'/esAction.do?method=createTemplate',\n  params: {\n    'reqParams' : Wb.encode(paramJson)\n  },\n  success: function(resp) {\n    msg.hide() ;\n    var response = Wb.decode(resp.responseText) ;\n    if(response.flag == \"0\"){\n      app.newTabWin.hide() ;\n      app.btnQuery.fireEvent('click') ;\n    }else{\n      Wb.info(response.msg) ;\n    }\n  }\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#btnCancel#}","itemId":"btnCancel","iconCls":"cancel_icon"},"events":{"click":"app.newTabWin.hide();"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"array"}],"expanded":false,"type":"window"},{"configs":{"maximized":"false","title":"{#copTabWin#}","height":"500","width":"700","layout":"border","closeAction":"hide","dialog":"true","itemId":"copTabWin","maximizable":"true"},"events":{"ok":"var records = app.copyGrid.getSelection() ;\nif(records.length === 0){\n  Wb.toast(\"请选择要被复制的模板信息\") ;\n}else{\n  var tabArray = [] ;\n  Wb.each(records, function(r){\n    var tabId = r.get('TAB_ID') ;\n    var tabCode = r.get('TAB_CODE') ;\n    var tabName = r.get('TAB_NAME') ;\n    tabArray.push({'TAB_ID':tabId,'TAB_CODE':tabCode,'TAB_NAME':tabName}) ;\n  }) ;\n  \n  // 请求参数\n  var params = {\n    'srcHrcyId'   : app.cp_hrcy.getValue(),\n    'targetHrcyId': app.cbx_hrcy.getValue(),\n    'tabArray'    : tabArray\n  } ;\n  \n // 进度条\n  var processbar = Ext.Msg.wait(\"正在提交请求...\", \"提示\") ;\n  \n  // 提交请求\n  Wb.request({\n    url: '{#ctxPath#}'+'/esAction.do?method=copyTemplates',\n    timeout : 3600000,\n    params: {\n      'reqParams' : Wb.encode(params) \n    },\n    success: function(resp){\n      processbar.hide() ;\n      var response = Wb.decode(resp.responseText) ;\n      if(response.flag == \"0\"){\n        // 复制成功\n        app.copTabWin.hide() ;\n        app.grid1.getStore().reload() ;\n      }\n      Wb.info(response.msg) ;\n    }\n  });\n}"},"children":[{"configs":{"region":"north","bodyPadding":"5","itemId":"copyForm"},"children":[{"configs":{"labelWidth":"120","displayField":"ACC_HRCY_NAME","width":"400","valueField":"ACC_HRCY_ID","labelAlign":"right","itemId":"cp_hrcy","fieldLabel":"{#cp_hrcy#}"},"events":{"select":"app.copyGrid.getStore().load() ;"},"children":[{"configs":{"pageSize":"-1","itemId":"store","url":"m?xwl=xc/rep/base-settings/templates/data/select-exclude-acc-hrcy"},"events":{"beforeload":"store.proxy.extraParams.accHrcyId = app.cbx_hrcy.getValue() ;"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"}],"expanded":true,"type":"form"},{"configs":{"region":"center","pagingBar":"false","multiSelect":"true","selType":"checkboxmodel","submitSelect":"true","forceFit":"true","itemId":"copyGrid"},"children":[{"configs":{"pageSize":"-1","itemId":"store","url":"m?xwl=xc/rep/base-settings/templates/data/select-src-tabs"},"events":{"beforeload":"store.proxy.extraParams.srcHrcyId = app.cp_hrcy.getValue() ;\nstore.proxy.extraParams.targetHrcyId = app.cbx_hrcy.getValue() ;\n"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#rownum#}","align":"center","width":"50","xtype":"rownumberer","itemId":"rownum"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#TAB_ID#}","hidden":"true","dataIndex":"TAB_ID","itemId":"TAB_ID"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#ACC_HRCY_ID#}","hidden":"true","dataIndex":"ACC_HRCY_ID","itemId":"ACC_HRCY_ID"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#TAB_CODE#}","width":"180","dataIndex":"TAB_CODE","titleAlign":"center","itemId":"TAB_CODE"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#TAB_NAME#}","width":"350","dataIndex":"TAB_NAME","titleAlign":"center","itemId":"TAB_NAME"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#TAB_ORDER#}","hidden":"true","dataIndex":"TAB_ORDER","itemId":"TAB_ORDER"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":false,"type":"window"},{"configs":{"title":"模板导入","width":"500","closeAction":"hide","itemId":"impTabWin","modal":"true"},"children":[{"configs":{"layout":"fit","bodyPadding":"10","itemId":"uploadForm"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"selFile","fieldLabel":"选择文件"},"children":[],"expanded":false,"type":"file"}],"expanded":true,"type":"form"},{"configs":{"itemId":"buttons"},"children":[{"configs":{"text":"{#btnOK#}","itemId":"btnOK","iconCls":"ok_icon"},"events":{"click":"// 所选文件\nvar file = app.selFile.getValue() ;\nif(Wb.isEmpty(file)){\n  Wb.toast('请选择导入文件') ;\n  return false ;\n}\n// 文件类型\nvar fileType = app.selFile.getValue();\nif(!Ext.String.endsWith(fileType,'.json')){\n  Wb.info('请选择JSON格式的文档!',function(){\n    app.uploadForm.getForm().reset();\n  });\n  \n}else{  \n  // 科目体系ID\n  var accHrcyId = app.cbx_hrcy.getValue() ;\n  \n  // 进度条\n  var processMsg = Ext.Msg.show({\n     title : '提示',\n     msg   : '导入中，请稍后.....',\n     wait  : true,\n     width : 200\n  });  \n  // 执行导入\n  app.uploadForm.getForm().submit({\n    url     : '{#ctxPath#}/esAction.do?method=impTemplates&accHrcyId='+accHrcyId,\n    timeout : 3600000,\n    success : function(form,action){\n      processMsg.hide();\n      var flag = action.result.flag ; \n      if(flag == \"0\"){  // 导入成功\n        app.impTabWin.close() ;\n        app.btnQuery.fireEvent('click') ;\n      }\n      Wb.info(action.result.msg,function(){});\n    },\n    failure : function(form,action){\n      processMsg.hide();\n      Wb.info(action.result.msg, function(){}) ;\n    }   \n  }); \n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#btnCancel#}","itemId":"btnCancel","iconCls":"cancel_icon"},"events":{"click":"app.impTabWin.hide() ;"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"array"}],"expanded":true,"type":"window"},{"configs":{"maximized":"true","title":"{#editRepFormatWin#}","height":"500","width":"650","layout":"fit","closeAction":"hide","dialog":"false","itemId":"editRepFormatWin","modal":"true","maximizable":"true"},"children":[{"configs":{"html":"<iframe id=editReportFrame width=100% height=100% frameborder=0 scrolling=yes><\/iframe>","itemId":"panel1"},"children":[],"expanded":false,"type":"panel"}],"expanded":false,"type":"window"}],"expanded":true,"type":"folder"},{"configs":{"layout":"border","itemId":"viewport1"},"children":[{"configs":{"region":"north","tagConfigs":"columnWidth:0.35","layout":"column","bodyPadding":"10","itemId":"form"},"children":[{"configs":{"tagConfigs":"columnWidth:0.35","labelWidth":"80","displayField":"ACC_HRCY_NAME","valueField":"ACC_HRCY_ID","labelAlign":"right","itemId":"cbx_hrcy","fieldLabel":"{#cbx_hrcy#}"},"events":{"select":"app.btnQuery.fireEvent('click') ;"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/rep/base-settings/templates/data/select-acc-hrcy"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"},{"configs":{"tagConfigs":"columnWidth:0.35","labelWidth":"90","labelAlign":"right","itemId":"txt_tpl","fieldLabel":"{#txt_tpl#}"},"events":{"specialkey":"if(e.keyCode == 13){\n  app.btnQuery.fireEvent('click') ;\n}"},"children":[],"expanded":false,"type":"text"},{"configs":{"columnWidth":".1","border":"false","itemId":"buttons"},"children":[{"configs":{"text":"{#btnQuery#}","margin":"0 0 0 10","itemId":"btnQuery","iconCls":"seek_icon"},"events":{"click":"app.grid1.getStore().load() ;"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"form"},{"configs":{"region":"center","multiSelect":"true","selType":"checkboxmodel","itemId":"grid1","simpleSelect":"false"},"events":{"itemdblclick":"app.btnEdit.fireEvent('click') ;"},"children":[{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"{#btnNew#}","itemId":"btnNew","iconCls":"file_add_icon"},"events":{"click":"// TODO: 创建报表模板\nvar accHrcyId = app.cbx_hrcy.getValue() ;\nif(Wb.isEmpty(accHrcyId)){\n  Wb.toast('{#selAccHrcy#}') ;\n  return false ;\n}\n\napp.newTplForm.getForm().reset() ;\napp.newTabWin.show() ;"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#btnEdit#}","itemId":"btnEdit","iconCls":"edit_icon"},"events":{"click":"var records = app.grid1.getSelection() ;\nif(records.length > 1){\n  Wb.toast('请选择 1 条模板记录') ;\n  return false ;\n}\n\nvar r = records[0].data ;\nvar json = {'TAB_ID':r.TAB_ID,'tabCode':r.TAB_CODE,'tabName':r.TAB_NAME} ;\nWb.setValue(app.newTplForm,json) ;\n\napp.newTabWin.show() ;"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#btnDel#}","itemId":"btnDel","iconCls":"file_delete_icon"},"events":{"click":"// 科目体系ID\nvar accHrcyId = app.cbx_hrcy.getValue() ;\nif(Wb.isEmpty(accHrcyId)){\n  Wb.toast('请选择科目体系') ;\n  return false ;\n}\n\nvar records = app.grid1.getSelection() ;\nif(records.length > 1){\n  Wb.toast('请选择 1 条模板记录') ;\n  return false ;\n}\n\n// 进度条\nvar processbar = Ext.Msg.wait(\"正在执行模板删除操作...\", \"提示\") ;\n\n// 提交请求\nWb.request({\n  url: '{#ctxPath#}'+'/esAction.do?method=deleteTabById',\n  params: {\n    'tabId' : records[0].data.TAB_ID\n  },\n  timeout : 3600000,\n  success: function(resp) {\n    processbar.hide() ;\n    var response  = Wb.decode(resp.responseText) ;\n    if(response.flag == \"0\"){\n      app.btnQuery.fireEvent('click') ;\n    }\n    Wb.info(response.msg) ;\n  }\n});\n"},"children":[],"expanded":true,"type":"button"},{"configs":{"text":"{#btnEditFormat#}","itemId":"btnEditFormat","iconCls":"edit_icon"},"events":{"click":"// TODO: 导入模板\nvar accHrcyId = app.cbx_hrcy.getValue() ;\nif(Wb.isEmpty(accHrcyId)){\n  Wb.toast('{#selAccHrcy#}') ;\n  return false ;\n}\n\n// 模板ID\nvar records = app.grid1.getSelection() ;\nif(records.length > 1){\n  Wb.toast('请选择 1 条模板记录') ;\n  return false ;\n}\nvar tabId = records[0].data.TAB_ID ;\n\n// 模板编辑地址\nvar url = '{#ctxPath#}'+\"/XCloud/REP/tabEditor.jsp?accHrcyId=\"+accHrcyId+\"&tabId=\"+tabId ;\n\n// 打开编辑窗口\napp.editRepFormatWin.show(this,function(){\n  document.getElementById('editReportFrame').src =  url ;\n}) ;\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#btnCopy#}","itemId":"btnCopy","iconCls":"copy_icon"},"events":{"click":"// 科目体系ID\nvar accHrcyId = app.cbx_hrcy.getValue() ;\nif(Wb.isEmpty(accHrcyId)){\n  Wb.toast('请选择科目体系') ;\n  return false ;\n}\n\napp.copyForm.getForm().reset() ;\napp.copyGrid.getStore().removeAll() ;\napp.copTabWin.show() ;"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#btnUpload#}","itemId":"btnUpload","iconCls":"up_icon"},"events":{"click":"// TODO: 导入模板\nvar accHrcyId = app.cbx_hrcy.getValue() ;\nif(Wb.isEmpty(accHrcyId)){\n  Wb.toast('{#selAccHrcy#}') ;\n  return false ;\n}\napp.uploadForm.getForm().reset() ;\napp.impTabWin.show();\n\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#btnExp#}","itemId":"btnExp","iconCls":"down_icon"},"events":{"click":"// 模板ID\nvar records = app.grid1.getSelection() ;\nif(records.length === 0){\n  Wb.toast('请选择模板记录') ;\n  return false ;\n}\n\nvar hrcyId = app.cbx_hrcy.getValue() ;\nvar tabArray = [] ;\nWb.each(records, function(r){\n  var tabId = r.get('TAB_ID') ;\n  tabArray.push({'TAB_ID':tabId}) ;\n}) ;\n\n// 导出URL\nvar url = '{#ctxPath#}'+'/esAction.do?method=expTemplates' ;\nurl = url + \"&accHrcyId=\"+hrcyId+\"&tabArray=\"+Wb.encode(tabArray) ;\n\n// 执行导出\nwindow.location.href = url ;\n"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"store","url":"m?xwl=xc/rep/base-settings/templates/data/select-tabs"},"events":{"beforeload":"store.proxy.extraParams.accHrcyId = app.cbx_hrcy.getValue() ;\nstore.proxy.extraParams.textStr = app.txt_tpl.getValue() ;\n"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#rownum#}","xtype":"rownumberer","width":"50","align":"center","itemId":"rownum"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#TAB_ID#}","hidden":"true","dataIndex":"TAB_ID","itemId":"TAB_ID"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#ACC_HRCY_ID#}","hidden":"true","dataIndex":"ACC_HRCY_ID","itemId":"ACC_HRCY_ID"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#TAB_CODE#}","width":"180","dataIndex":"TAB_CODE","titleAlign":"center","itemId":"TAB_CODE"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#TAB_NAME#}","width":"300","dataIndex":"TAB_NAME","titleAlign":"center","itemId":"TAB_NAME"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#TAB_ORDER#}","width":"100","align":"center","dataIndex":"TAB_ORDER","titleAlign":"center","itemId":"TAB_ORDER"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#IS_ACTIVE#}","hidden":"true","width":"100","align":"center","dataIndex":"IS_ACTIVE","titleAlign":"center","itemId":"IS_ACTIVE","renderer":"if(value === 0){\n  return '{#Not_Actived#}' ;\n}else if(value == 1){\n  return '<font color=red>{#Actived#}<\/font>' ;\n}else{\n  return value ;\n}"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#CELL_NUM#}","hidden":"true","dataIndex":"CELL_NUM","itemId":"CELL_NUM"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}