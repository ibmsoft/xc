{"inframe":false,"title":"报表填报","hidden":false,"roles":{"default":1},"children":[{"configs":{"cssLinks":"[\"xip/es/EnterpriseSheet/resources/css/common.css\", \"xip/es/EnterpriseSheet/resources/css/sheet.css\", \"xip/es/EnterpriseSheet/resources/css/toolbar.css\"]","jsLinks":"[\"xip/es/EnterpriseSheet/src/EnterpriseSheet/Config.js\", \"xip/es/EnterpriseSheet/src/language/zh_CN.js\", \"xip/es/EnterpriseSheet/enterprisesheet.js\", \"xip/es/EnterpriseSheet/templates/CenterPanel.js\"]","serverScript":"// 获取当前模块语言对应的.json文件，放到request中\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,'xc/rep/data-manage/create/json/create-reports');\n\nrequest.setAttribute(\"ctxPath\", request.getContextPath()) ;","itemId":"module"},"events":{"finalize":"/**\n * 报表数据查询请求\n * @param {var} type 操作类型 ： qry-查询 , cal-运算\n */\nfunction findReportData(type){\n  // 数据校验\n  var ledgerId = app.cbx_ledger.getValue() ;\n  var orgId = app.cbx_entity.getValue() ;\n  var periodCode = app.cbx_period.getValue() ;\n  var cnyCode = app.cbx_currency.getValue() ;\n  if(Wb.isEmpty(ledgerId)){\n    return false ;\n  }\n  if(Wb.isEmpty(periodCode)){\n    return false ;\n  }\n  if(Wb.isEmpty(orgId)){\n    Wb.info('账簿未关联组织') ;\n    return false ;\n  }\n  if(Wb.isEmpty(cnyCode)){\n    Wb.info('账簿未关联本位币') ;\n    return false ;\n  }\n  // 科目体系ID\n  var rr = app.cbx_ledger.getStore().findRecord('LEDGER_ID',ledgerId) ;\n  var hrcyId = rr.get('ACC_HRCY_ID') ;\n  if(Wb.isEmpty(hrcyId)) {\n    Wb.info('账簿未关联会计科目体系') ;\n    return ;\n  }\n  // 当前活动页签\n  var sheet = SHEET_API_HD.sheet;\t\n  // 参数\n  var params = {\n    'accHrcyId'  : hrcyId,\n    'ledgerId'   : ledgerId,\n    'periodCode' : periodCode,\n    'orgId'      : orgId,\n    'cnyCode'    : cnyCode,\n    'sheetTabId' : sheet.getSheetId() \n  } ;\n  \n  var processbar = Ext.Msg.wait(\"正在提交请求...\", \"提示\") ;\n  // 提交请求执行查询\n  Wb.request({\n    url: '{#ctxPath#}'+'/xcRepDataAction.do?method=queryReports',\n    params: {\n      'reqParams' : Wb.encode(params)\n    },\n    timeout : 3600000,\n    success: function(resp) {\n      processbar.hide() ;\n      var response  = Wb.decode(resp.responseText) ;\n      if(response.flag == \"0\"){ // 加载成功\n        var sheets = response.sheets ;\n\t\t// ES数据\n        var json = {\n          fileName: response.fileName,\n          sheets: sheets,\n          cells: response.cells,\n          floatings : response.floatings\n        };\n        // 加载数据\n        SHEET_API.loadData(SHEET_API_HD, json ,function(){\n          if('cal' == type){\n            app.btnSave.fireEvent('click') ;\n          }\n        },this);\n\n        // 报表状态\n        var appStatus = response.activedSheetStatus ;\n        if(appStatus == \"A\"){\n          appStatus = '<font color=blue>{#draft_status#}<\/font>' ;\n        }else if(appStatus == \"E\"){\n          appStatus = '<font color=red>{#locked_status#}<\/font>' ;\n        }else{\n          appStatus = '{#not_created#}' ;\n        }\n        app.repStatus.setText(\"{#rep_status#}：\"+appStatus, false) ;\n\n      }else{ // 加载失败\n        Wb.info(response.msg) ;\n      }\n    }\n  });  \n}","initialize":"// 创建Enterprise Sheet对象\nSCONFIG.setupDir('');\nSHEET_API = Ext.create('EnterpriseSheet.api.SheetAPI', {\n  openFileByOnlyLoadDataFlag: true\n});\nSHEET_API_HD = SHEET_API.createSheetApp({\n  withoutTitlebar: true,\n  withoutSheetbar: false,\n  withoutToolbar: true,\n  withoutContentbar: false,\n  withoutSidebar: true,\n  style: 'background:white;border-left:1px solid silver;',\n  height: '100%'\n});\n\n// sheet页签\nvar centralPanel = Ext.create('enterpriseSheet.templates.CenterPanel', {\n    border : false \n});\n\nvar sheet = SHEET_API_HD.sheet;\nsheet.on({\n    scope: this,\n    'switchsheet': function(oldSheetId, sheetId) {\n      app.btnQuery.fireEvent('click') ;\n    }\n});\n    "},"children":[{"configs":{"maximized":"false","title":"{#repWin#}","height":"550","width":"700","layout":"fit","closeAction":"hide","buttonAlign":"right","itemId":"repWin","modal":"true","iconCls":"viewport_icon","maximizable":"true"},"events":{"ok":"\n"},"children":[{"configs":{"pagingBar":"false","multiSelect":"true","selType":"checkboxmodel","itemId":"reportsGrid","simpleSelect":"true"},"children":[{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"90","width":"300","labelAlign":"right","itemId":"txtRepName","fieldLabel":"{#txtRepName#}"},"events":{"specialkey":"if(e.keyCode == 13){\n  app.btnQueryReports.fireEvent('click') ;\n}"},"children":[],"expanded":true,"type":"text"},{"configs":{"itemId":"btnQueryReports","iconCls":"seek_icon"},"events":{"click":"app.reportsGrid.getStore().load() ;"},"children":[],"expanded":false,"type":"button"}],"expanded":false,"type":"toolbar"},{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/rep/data-manage/create/data/select-sheets"},"events":{"beforeload":"store.proxy.extraParams.ledgerId = app.cbx_ledger.getValue() ;\nstore.proxy.extraParams.pCode = app.cbx_period.getValue() ;\nstore.proxy.extraParams.textStr = app.txtRepName.getValue() ;"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#rownum#}","align":"center","width":"50","xtype":"rownumberer","itemId":"rownum"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#SHEET_ID#}","hidden":"true","dataIndex":"SHEET_ID","itemId":"SHEET_ID"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#TAB_ID#}","hidden":"true","dataIndex":"TAB_ID","itemId":"TAB_ID"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#TAB_CODE#}","width":"120","dataIndex":"TAB_CODE","titleAlign":"center","itemId":"TAB_CODE"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#TAB_NAME#}","width":"250","dataIndex":"TAB_NAME","titleAlign":"center","itemId":"TAB_NAME"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#APP_STATUS#}","width":"120","dataIndex":"APP_STATUS","titleAlign":"center","itemId":"APP_STATUS","renderer":"if(value == 'A'){\n  return '{#draft_status#}' ;\n}else if(value == 'E'){\n  return '{#locked_status#}' ;\n}else{\n  return value ;\n}"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#TAB_ORDER#}","hidden":"true","dataIndex":"TAB_ORDER","itemId":"TAB_ORDER"},"children":[],"expanded":false,"type":"column"}],"expanded":false,"type":"array"}],"expanded":true,"type":"grid"},{"configs":{"itemId":"buttons"},"children":[{"configs":{"text":"{#btnCleanAll#}","itemId":"btnCleanAll","iconCls":"shopping_cart_delete_icon"},"events":{"click":"// 账簿和期间\nvar ledgerId = app.cbx_ledger.getValue() ;\nvar periodCode = app.cbx_period.getValue() ;\nif(Wb.isEmpty(ledgerId)){\n  Wb.toast('请选择账簿') ;\n  return false ;\n}\nif(Wb.isEmpty(periodCode)){\n  Wb.toast('请选择期间') ;\n  return false ;\n}\n\n// 科目体系ID\nvar r = app.cbx_ledger.getStore().findRecord('LEDGER_ID',ledgerId) ;\nvar hrcyId = r.get('ACC_HRCY_ID') ;\nif(Wb.isEmpty(hrcyId)){\n  Wb.toast('账簿未绑定科目体系') ;\n  return false ;\n}\n\n// 页签ID\nvar sheet = SHEET_API_HD.sheet;\t// 当前活动页签\nvar sheetTabId = sheet.getSheetId() ;\n\n// 所选报表信息\nvar records = app.reportsGrid.getSelection() ;\nif(records.length === 0){\n  Wb.toast('请选择报表信息') ;\n  return false ;\n}\nvar data = [] ;\nWb.each(records, function(r){\n  var sheetId = r.get('SHEET_ID') ;\n  var appStatus = r.get('APP_STATUS') ;\n  if(appStatus == 'A'){\n    data.push({'sheetId':sheetId}) ;\n  }\n}) ;\nif(data.length === 0){\n  Wb.toast('所选报表均已锁定不能执行数据清空处理') ;\n  return false ;\n}\n\n// 组装参数, 格式为：{'ledgerId':'','periodCode':'','accHrcyId':'','tabOrder':0,'opMode':'batch','data':[{'sheetId':''},...]} \nvar params = {\n  'ledgerId'  : ledgerId,\n  'periodCode': periodCode,\n  'accHrcyId' : hrcyId,\n  'tabOrder'  : sheetTabId,\n  'opMode'    : 'batch',\n  'data'      : data\n} ;\n\nvar processbar = Ext.Msg.wait(\"正在执行报表数据清除操作...\", \"提示\") ;\n\n// 提交请求\nWb.request({\n  url: '{#ctxPath#}'+'/xcRepDataAction.do?method=cleanReports',\n  params: {\n    'reqParams' : Wb.encode(params) \n  },\n  timeout : 3600000,\n  success: function(resp) {\n    processbar.hide() ;\n    var response  = Wb.decode(resp.responseText) ;\n    if(response.flag == \"0\"){\n      app.repWin.hide() ;\n      app.btnQuery.fireEvent('click') ;\n    }\n    Wb.info(response.msg) ;\n  }\n});  \n  \n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#btnLockAll#}","itemId":"btnLockAll","iconCls":"lock_icon"},"events":{"click":"// 账簿和期间\nvar ledgerId = app.cbx_ledger.getValue() ;\nvar periodCode = app.cbx_period.getValue() ;\nif(Wb.isEmpty(ledgerId)){\n  Wb.toast('请选择账簿') ;\n  return false ;\n}\nif(Wb.isEmpty(periodCode)){\n  Wb.toast('请选择期间') ;\n  return false ;\n}\n\n// 科目体系ID\nvar r = app.cbx_ledger.getStore().findRecord('LEDGER_ID',ledgerId) ;\nvar hrcyId = r.get('ACC_HRCY_ID') ;\nif(Wb.isEmpty(hrcyId)){\n  Wb.toast('账簿未绑定科目体系') ;\n  return false ;\n}\n\n// 页签ID\nvar sheet = SHEET_API_HD.sheet;\t// 当前活动页签\nvar sheetTabId = sheet.getSheetId() ;\n\n// 所选报表信息\nvar records = app.reportsGrid.getSelection() ;\nif(records.length === 0){\n  Wb.toast('请选择报表信息') ;\n  return false ;\n}\nvar data = [] ;\nvar isContainActived = false ;\nWb.each(records, function(r){\n  var sheetId = r.get('SHEET_ID') ;\n  var tabOrder = r.get('TAB_ORDER') ;\n  if(sheetTabId == tabOrder){\n    isContainActived = true ;\n  }\n  data.push({'sheetId':sheetId}) ;\n}) ;\n\n// 组装参数, 格式为：{'ledgerId':'','periodCode':'','accHrcyId':'','tabOrder':0,'opMode':'batch','opType':'unlock','data':[{'sheetId':''},...]}\nvar params = {\n  'ledgerId'  : ledgerId,\n  'periodCode': periodCode,\n  'accHrcyId' : hrcyId,\n  'tabOrder'  : sheetTabId,\n  'opMode'    : 'batch',\n  'opType'    : 'lock',\n  'data'      : data\n} ;\n\nvar processbar = Ext.Msg.wait(\"正在执行报表批量锁定操作...\", \"提示\") ;\n\n// 提交请求\nWb.request({\n  url: '{#ctxPath#}'+'/xcRepDataAction.do?method=lockOrUnlockReports',\n  params: {\n    'reqParams' : Wb.encode(params) \n  },\n  timeout : 3600000,\n  success: function(resp) {\n    processbar.hide() ;\n    var response  = Wb.decode(resp.responseText) ;\n    if(response.flag == \"0\"){\n      app.repWin.hide() ;\n      if(isContainActived){\n        app.repStatus.setText(\"报表状态：<font color=red>已锁定<\/font>\", false) ;\n      }\n    }\n    Wb.info(response.msg) ;\n  }\n});  \n  \n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#btnUnlockAll#}","itemId":"btnUnlockAll","iconCls":"unlock_icon"},"events":{"click":"// 账簿和期间\nvar ledgerId = app.cbx_ledger.getValue() ;\nvar periodCode = app.cbx_period.getValue() ;\nif(Wb.isEmpty(ledgerId)){\n  Wb.toast('请选择账簿') ;\n  return false ;\n}\nif(Wb.isEmpty(periodCode)){\n  Wb.toast('请选择期间') ;\n  return false ;\n}\n\n// 科目体系ID\nvar r = app.cbx_ledger.getStore().findRecord('LEDGER_ID',ledgerId) ;\nvar hrcyId = r.get('ACC_HRCY_ID') ;\nif(Wb.isEmpty(hrcyId)){\n  Wb.toast('账簿未绑定科目体系') ;\n  return false ;\n}\n\n// 页签ID\nvar sheet = SHEET_API_HD.sheet;\t// 当前活动页签\nvar sheetTabId = sheet.getSheetId() ;\n\n// 所选报表信息\nvar records = app.reportsGrid.getSelection() ;\nif(records.length === 0){\n  Wb.toast('请选择报表信息') ;\n  return false ;\n}\nvar data = [] ;\nvar isContainActived = false ;\nWb.each(records, function(r){\n  var sheetId = r.get('SHEET_ID') ;\n  var tabOrder = r.get('TAB_ORDER') ;\n  if(sheetTabId == tabOrder){\n    isContainActived = true ;\n  }\n  data.push({'sheetId':sheetId}) ;\n}) ;\n\n// 组装参数, 格式为：{'ledgerId':'','periodCode':'','accHrcyId':'','tabOrder':0,'opMode':'batch','opType':'unlock','data':[{'sheetId':''},...]}\nvar params = {\n  'ledgerId'  : ledgerId,\n  'periodCode': periodCode,\n  'accHrcyId' : hrcyId,\n  'tabOrder'  : sheetTabId,\n  'opMode'    : 'batch',\n  'opType'    : 'unlock',\n  'data'      : data\n} ;\n\nvar processbar = Ext.Msg.wait(\"正在执行报表批量解锁操作...\", \"提示\") ;\n\n// 提交请求\nWb.request({\n  url: '{#ctxPath#}'+'/xcRepDataAction.do?method=lockOrUnlockReports',\n  params: {\n    'reqParams' : Wb.encode(params) \n  },\n  timeout : 3600000,\n  success: function(resp) {\n    processbar.hide() ;\n    var response  = Wb.decode(resp.responseText) ;\n    if(response.flag == \"0\"){\n      app.repWin.hide() ;\n      if(isContainActived){\n        app.repStatus.setText(\"报表状态：<font color=blue>草稿<\/font>\", false) ;\n      }\n    }\n    Wb.info(response.msg) ;\n  }\n});  \n  \n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#btnCancel#}","itemId":"btnCancel","iconCls":"cancel_icon"},"events":{"click":"app.repWin.hide() ;"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"array"}],"expanded":true,"type":"window"},{"configs":{"itemId":"form_bbar"},"children":[{"configs":{"text":"{#btnCollect#}","itemId":"btnCollect","iconCls":"execute_icon"},"events":{"click":"// 条件信息\nvar ledgerId = app.cbx_ledger.getValue() ;\nvar periodCode = app.cbx_period.getValue() ;\nvar orgId = app.cbx_entity.getValue() ;\nvar cnyCode = app.cbx_currency.getValue() ;\nif(Wb.isEmpty(ledgerId)){\n  Wb.toast('请选择账簿') ;\n  return false ;\n}\nif(Wb.isEmpty(periodCode)){\n  Wb.toast('请选择期间') ;\n  return false ;\n}\nif(Wb.isEmpty(orgId)){\n  Wb.toast('账簿未绑定组织') ;\n  return false ;\n}\nif(Wb.isEmpty(cnyCode)){\n  Wb.toast('账簿未绑定币种') ;\n  return false ;\n}\n// 科目体系\nvar r = app.cbx_ledger.getStore().findRecord('LEDGER_ID',ledgerId) ;\nvar hrcyId = r.get('ACC_HRCY_ID') ;\nif(Wb.isEmpty(hrcyId)){\n  Wb.toast('账簿未绑定科目体系') ;\n  return false ;\n}\n\n// 页签ID\nvar sheet = SHEET_API_HD.sheet;\t// 当前活动页签\nvar sheetTabId = sheet.getSheetId() ;\n\n// 扩展参数\nvar params = {\n  'ledgerId'   : ledgerId,\n  'periodCode' : periodCode,\n  'orgId'      : orgId,\n  'cnyCode'    : cnyCode,\n  'accHrcyId'  : hrcyId,\n  'tabOrder'   : sheetTabId,\n  'opMode'     : 'single'\n} ;\n\nvar processbar = Ext.Msg.wait(\"正在提交请求...\", \"提示\") ;\n\n// 提交请求\nWb.request({\n  url: '{#ctxPath#}'+'/xcRepDataAction.do?method=gatherRepData',\n  params: {\n    'reqParams' : Wb.encode(params)\n  },\n  timeout : 3600000,\n  success: function(resp) {\n    processbar.hide() ;\n    var response  = Wb.decode(resp.responseText) ;\n    if(response.flag == \"0\"){\n      app.repStatus.setText(\"报表状态：<font color=green>已生成<\/font>\",false) ;\n      // 加载数据并运算表内公式\n      findReportData('cal') ;\n    }else{\n      Wb.info(response.msg) ;\n    }\n  }\n});\n\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#btnSave#}","itemId":"btnSave","iconCls":"save_icon"},"events":{"click":"var ledgerId = app.cbx_ledger.getValue() ;\nvar periodCode = app.cbx_period.getValue() ;\nvar orgId = app.cbx_entity.getValue() ;\nvar cnyCode = app.cbx_currency.getValue() ;\nif(Wb.isEmpty(ledgerId)){\n  Wb.toast('请选择账簿') ;\n  return false ;\n}\nif(Wb.isEmpty(periodCode)){\n  Wb.toast('请选择期间') ;\n  return false ;\n}\nif(Wb.isEmpty(orgId)){\n  Wb.toast('账簿未绑定组织') ;\n  return false ;\n}\nif(Wb.isEmpty(cnyCode)){\n  Wb.toast('账簿未绑定币种') ;\n  return false ;\n}\n\n// 科目体系ID\nvar r = app.cbx_ledger.getStore().findRecord('LEDGER_ID',ledgerId) ;\nvar hrcyId = r.get('ACC_HRCY_ID') ;\nif(Wb.isEmpty(hrcyId)){\n  Wb.toast('账簿未绑定科目体系') ;\n  return false ;\n}\n\n// 所选区域单元格聚焦使录入值生效\nvar selectedRecords = SHEET_API.getSelectedRangeData(SHEET_API_HD) ;\nWb.each(selectedRecords, function(r){\n  SHEET_API.setFocus(SHEET_API_HD, r.row, r.col) ;\n}) ;\n\n// 页签ID\nvar sheet = SHEET_API_HD.sheet;\t// 当前活动页签\nvar sheetTabId = sheet.getSheetId() ;\n\n// 扩展参数\nvar extraParams = {\n  'ledgerId'   : ledgerId,\n  'periodCode' : periodCode,\n  'orgId'      : orgId,\n  'cnyCode'    : cnyCode,\n  'accHrcyId'  : hrcyId,\n  'sheetTabId' : sheetTabId\n} ;\n// 表格数据\nvar dataJson = SHEET_API.getJsonData(SHEET_API_HD,false) ;\n\nvar processbar = Ext.Msg.wait(\"正在提交请求...\", \"提示\") ;\n\n// 提交请求\nWb.request({\n  url: '{#ctxPath#}'+'/xcRepDataAction.do?method=saveOrUpdateReport',\n  params: {\n    'extraParams' : Wb.encode(extraParams),\n    'dataJson'    : Wb.encode(dataJson) \n  },\n  timeout : 3600000,\n  success: function(resp) {\n    processbar.hide() ;\n    var response  = Wb.decode(resp.responseText) ;\n    if(response.flag == \"0\"){\n      app.repStatus.setText(\"报表状态：<font color=blue>草稿<\/font>\", false) ;\n      Wb.info('数据处理成功') ;\n    }else{\n      Wb.info(response.msg) ;\n    }\n  }\n});\n\n"},"children":[],"expanded":true,"type":"button"},{"configs":{"text":"{#btnLock#}","itemId":"btnLock","iconCls":"lock_icon"},"events":{"click":"var ledgerId = app.cbx_ledger.getValue() ;\nvar periodCode = app.cbx_period.getValue() ;\n\nif(Wb.isEmpty(ledgerId)){\n  Wb.toast('请选择账簿') ;\n  return false ;\n}\nif(Wb.isEmpty(periodCode)){\n  Wb.toast('请选择期间') ;\n  return false ;\n}\n\n// 科目体系ID\nvar r = app.cbx_ledger.getStore().findRecord('LEDGER_ID',ledgerId) ;\nvar hrcyId = r.get('ACC_HRCY_ID') ;\nif(Wb.isEmpty(hrcyId)){\n  Wb.toast('账簿未绑定科目体系') ;\n  return false ;\n}\n\n// 页签ID\nvar sheet = SHEET_API_HD.sheet;\t// 当前活动页签\nvar sheetTabId = sheet.getSheetId() ;\n\n// 组装参数, 格式为：{'ledgerId':'','periodCode':'','accHrcyId':'','tabOrder':0,'opMode':'single','opType':'lock'}\nvar params = {\n  'ledgerId'   : ledgerId,\n  'periodCode' : periodCode,\n  'accHrcyId'  : hrcyId,\n  'tabOrder'   : sheetTabId,\n  'opMode'     : 'single',\n  'opType'     : 'lock'\n} ;\n\nvar processbar = Ext.Msg.wait(\"正在执行报表锁定操作...\", \"提示\") ;\n\n// 提交请求\nWb.request({\n  url: '{#ctxPath#}'+'/xcRepDataAction.do?method=lockOrUnlockReports',\n  params: {\n    'reqParams' : Wb.encode(params) \n  },\n  timeout : 3600000,\n  success: function(resp) {\n    processbar.hide() ;\n    var response  = Wb.decode(resp.responseText) ;\n    if(response.flag == \"0\"){\n      app.repStatus.setText(\"报表状态：<font color=red>已锁定<\/font>\", false) ;\n    }\n    Wb.info(response.msg) ;\n  }\n});"},"children":[],"expanded":true,"type":"button"},{"configs":{"text":"{#btnUnLock#}","itemId":"btnUnLock","iconCls":"unlock_icon"},"events":{"click":"var ledgerId = app.cbx_ledger.getValue() ;\nvar periodCode = app.cbx_period.getValue() ;\n\nif(Wb.isEmpty(ledgerId)){\n  Wb.toast('请选择账簿') ;\n  return false ;\n}\nif(Wb.isEmpty(periodCode)){\n  Wb.toast('请选择期间') ;\n  return false ;\n}\n\n// 科目体系ID\nvar r = app.cbx_ledger.getStore().findRecord('LEDGER_ID',ledgerId) ;\nvar hrcyId = r.get('ACC_HRCY_ID') ;\nif(Wb.isEmpty(hrcyId)){\n  Wb.toast('账簿未绑定科目体系') ;\n  return false ;\n}\n\n// 页签ID\nvar sheet = SHEET_API_HD.sheet;\t// 当前活动页签\nvar sheetTabId = sheet.getSheetId() ;\n\n// 组装参数, 格式为：{'ledgerId':'','periodCode':'','accHrcyId':'','tabOrder':0,'opMode':'single','opType':'unlock'}\nvar params = {\n  'ledgerId'   : ledgerId,\n  'periodCode' : periodCode,\n  'accHrcyId'  : hrcyId,\n  'tabOrder'   : sheetTabId,\n  'opMode'     : 'single',\n  'opType'     : 'unlock'\n} ;\n\nvar processbar = Ext.Msg.wait(\"正在执行报表解锁操作...\", \"提示\") ;\n\n// 提交请求\nWb.request({\n  url: '{#ctxPath#}'+'/xcRepDataAction.do?method=lockOrUnlockReports',\n  params: {\n    'reqParams' : Wb.encode(params) \n  },\n  timeout : 3600000,\n  success: function(resp) {\n    processbar.hide() ;\n    var response  = Wb.decode(resp.responseText) ;\n    if(response.flag == \"0\"){\n      app.repStatus.setText(\"报表状态：<font color=blue>草稿<\/font>\", false) ;\n    }\n    Wb.info(response.msg) ;\n  }\n});"},"children":[],"expanded":true,"type":"button"},{"configs":{"text":"{#btnClean#}","itemId":"btnClean","iconCls":"shopping_cart_delete_icon","tooltip":"{#btnCleanTip#}"},"events":{"click":"var ledgerId = app.cbx_ledger.getValue() ;\nvar periodCode = app.cbx_period.getValue() ;\n\nif(Wb.isEmpty(ledgerId)){\n  Wb.toast('请选择账簿') ;\n  return false ;\n}\nif(Wb.isEmpty(periodCode)){\n  Wb.toast('请选择期间') ;\n  return false ;\n}\n\n// 科目体系ID\nvar r = app.cbx_ledger.getStore().findRecord('LEDGER_ID',ledgerId) ;\nvar hrcyId = r.get('ACC_HRCY_ID') ;\nif(Wb.isEmpty(hrcyId)){\n  Wb.toast('账簿未绑定科目体系') ;\n  return false ;\n}\n\n// 页签ID\nvar sheet = SHEET_API_HD.sheet;\t// 当前活动页签\nvar sheetTabId = sheet.getSheetId() ;\n\n// 组装参数, 格式为：{'ledgerId':'','periodCode':'','accHrcyId':'','tabOrder':0,'opMode':'single'} \nvar params = {\n  'ledgerId' :  ledgerId,\n  'periodCode' : periodCode,\n  'accHrcyId' : hrcyId,\n  'tabOrder' : sheetTabId,\n  'opMode' : 'single'\n} ;\n\nvar processbar = Ext.Msg.wait(\"正在执行报表数据清除操作...\", \"提示\") ;\n\n// 提交请求\nWb.request({\n  url: '{#ctxPath#}'+'/xcRepDataAction.do?method=cleanReports',\n  params: {\n    'reqParams' : Wb.encode(params) \n  },\n  timeout : 3600000,\n  success: function(resp) {\n    processbar.hide() ;\n    var response  = Wb.decode(resp.responseText) ;\n    if(response.flag == \"0\"){ // 清空成功\n      app.btnQuery.fireEvent('click') ;\n    }\n    Wb.info(response.msg) ;\n  }\n});"},"children":[],"expanded":true,"type":"button"},{"configs":{"text":"{#btnBatchHandler#}","itemId":"btnBatchHandler","iconCls":"select_all_icon","tooltip":"{#btnBatchHandlerTip#}"},"events":{"click":"var ledgerId = app.cbx_ledger.getValue() ;\nvar periodCode = app.cbx_period.getValue() ;\nif(Wb.isEmpty(ledgerId)){\n  Wb.toast('请选择账簿') ;\n  return false ;\n}\nif(Wb.isEmpty(periodCode)){\n  Wb.toast('请选择期间') ;\n  return false ;\n}\n\n// 科目体系ID\nvar r = app.cbx_ledger.getStore().findRecord('LEDGER_ID',ledgerId) ;\nvar hrcyId = r.get('ACC_HRCY_ID') ;\nif(Wb.isEmpty(hrcyId)){\n  Wb.toast('账簿未绑定科目体系') ;\n  return false ;\n}\n\n// 显示批量处理\napp.txtRepName.setValue() ;\napp.reportsGrid.getStore().reload() ;\napp.repWin.show() ;"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"->","itemId":"sep"},"children":[],"expanded":false,"type":"item"},{"configs":{"margin":"0 20 0 0","itemId":"repStatus"},"children":[],"expanded":false,"type":"label"}],"expanded":true,"type":"toolbar"},{"configs":{"layout":"border","itemId":"viewport1"},"children":[{"configs":{"region":"north","bodyPadding":"10","itemId":"conditions","bbar":"app.form_bbar"},"children":[{"configs":{"height":"30","layout":"column","columnWidth":"1","border":"false","itemId":"tr1"},"children":[{"configs":{"tagConfigs":"columnWidth:0.28","labelWidth":"60","displayField":"LEDGER_NAME","valueField":"LEDGER_ID","labelAlign":"right","itemId":"cbx_ledger","fieldLabel":"{#cbx_ledger#}"},"events":{"select":"// TODO: 条件赋值处理\nvar r = records[0].data ;\n// 组织\nvar orgId = r.ORG_ID ;\nvar orgStore = app.cbx_entity.getStore() ;\nvar orgRec = orgStore.findRecord('ORG_ID',orgId) ;\nif(Wb.isEmpty(orgRec)){\n  Wb.toast('用户和角色对账簿所属组织无操作权限') ;\n  orgId = \"\" ;\n}\n// 币种\nvar cnyCode = r.CURRENCY_CODE ;\n// 设置默认值\nWb.setValue(app.conditions,{'cbx_entity':orgId,'cbx_currency':cnyCode}) ;\n\n\n// TODO: 报表查询处理\napp.btnQuery.fireEvent('click') ;\n"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/com-qry/gl-ledgers/select-sec-fd-ledgers"},"events":{"load":"// TODO: 如果只有一个授权账簿,则设置为默认值\nif(store.getCount() == 1){\n  var r = records[0];\n  Wb.setValue(app.conditions,{'cbx_ledger':r.data.LEDGER_ID,'cbx_entity':r.data.ORG_ID,'cbx_currency':r.data.CURRENCY_CODE}) ;\n  app.btnQuery.fireEvent('click') ;\n} "},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"},{"configs":{"queryCaching":"false","tagConfigs":"columnWidth:0.14","labelWidth":"60","queryMode":"remote","displayField":"NAME","valueField":"CODE","labelAlign":"right","itemId":"cbx_period","fieldLabel":"{#cbx_period#}"},"events":{"afterrender":"// 设置期间默认值\nvar dateStr = Ext.util.Format.date(new Date(),'Y-m') ;\nWb.setValue(app.cbx_period,{'cbx_period':dateStr}) ;\n","select":"app.btnQuery.fireEvent('click') ;\n\n"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/rep/rep-common/select-all-periods"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"},{"configs":{"tagConfigs":"columnWidth:0.28","labelWidth":"60","readOnly":"true","displayField":"ORG_NAME","valueField":"ORG_ID","labelAlign":"right","itemId":"cbx_entity","fieldLabel":"{#cbx_entity#}"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/rep/rep-common/select-org"},"children":[],"expanded":false,"type":"store"}],"expanded":false,"type":"combo"},{"configs":{"tagConfigs":"columnWidth:0.15","labelWidth":"60","readOnly":"true","displayField":"NAME","valueField":"CODE","labelAlign":"right","itemId":"cbx_currency","fieldLabel":"{#cbx_currency#}"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/rep/rep-common/select-all-currencies"},"children":[],"expanded":false,"type":"store"}],"expanded":false,"type":"combo"},{"configs":{"tagConfigs":"columnWidth:0.15","layout":"column","border":"false","itemId":"btnPl"},"children":[{"configs":{"text":"{#btnQuery#}","margin":"0 10 0 25","itemId":"btnQuery","iconCls":"seek_icon"},"events":{"click":"// 执行查询\nfindReportData('qry') ;\n"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"form"},{"configs":{"region":"center","layout":"border","itemId":"sheets"},"events":{"beforerender":"// 将ES组件添加到ExtJS的Panel容器中\npanel.add(centralPanel) ;\n\n"},"children":[],"expanded":true,"type":"panel"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}