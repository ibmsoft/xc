{"inframe":false,"title":"","hidden":false,"roles":{"default":1},"children":[{"configs":{"initScript":"var ctxPath = request.getContextPath();\nrequest.setAttribute('contextPath',ctxPath);","loginRequired":"false","serverScript":"//---------------------获取当前模块语言对应的.json文件，放到request中----------------\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xc/ex/biz/ex-chk-docs/json/ex-chk-docs\");","head":"<style type=\"text/css\">\n  .my_custom_grid .x-grid-row{\n      height:50px;\n  }\n  .my_custom_grid .x-grid-editor .x-form-text{\n      height:49px;\n  }\n  .my_custom_grid .x-grid-cell{\n      font: normal 12px/13px tahoma, arial, verdana, sans-serif;\n  }\n  .my_custom_grid .x-grid-cell{\n      border-color: #d0d0d0;\n  }\n  .my_custom_grid .x-grid-with-col-lines .x-grid-cell {\n    border-right-width: 1px;\n  }\n  .my_custom_grid .x-grid-with-row-lines .x-grid-td {\n    border-bottom-width: 1px;\n}\n<\/style>","itemId":"module"},"children":[{"configs":{"layout":"fit","itemId":"viewport1"},"children":[{"configs":{"border":"false","itemId":"tabPanel"},"children":[{"configs":{"title":"{#NoProcessed#}","layout":"border","border":"false","itemId":"leftPanel"},"children":[{"configs":{"region":"north","style":"border-width:0px","layout":"form","itemId":"selectForm"},"children":[{"configs":{"tagConfigs":"baseCls:'my-panel-no-border'","layout":"column","margin":"10 0 0 0","itemId":"panel2"},"children":[{"configs":{"tagConfigs":"columnWidth:0.3","labelWidth":"100","displayField":"LEDGER_NAME","valueField":"LEDGER_ID","labelAlign":"right","itemId":"LEDGER_ID_1","fieldLabel":"{#LEDGER_NAME#}","editable":"false"},"events":{"change":"app.selBtn_1.fireEvent('click') ;"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/com-qry/gl-ledgers/select-sec-fd-ledgers"},"events":{"load":"// TODO: 如果只有一个账簿权限则设为默认值\nif(store.getCount() == 1){\n  var r = records[0] ;\n  Wb.setValue(app.LEDGER_ID_1,{'LEDGER_ID_1':r.data.LEDGER_ID}) ;\n}"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"},{"configs":{"tagConfigs":"columnWidth:0.3","labelWidth":"100","labelAlign":"right","itemId":"EX_PAY_T_AMT_1","fieldLabel":"{#EX_PAY_T_AMT_1#}"},"events":{"specialkey":"if (e.getKey() == Ext.EventObject.ENTER) {\n  app.selBtn_1.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls:'my-panel-no-border'","layout":"column","margin":"10 0 10 0","itemId":"panel11"},"children":[{"configs":{"tagConfigs":"columnWidth:0.3","labelWidth":"100","labelAlign":"right","itemId":"EX_PAY_CODE_1","fieldLabel":"{#EX_PAY_CODE_1#}"},"events":{"specialkey":"if (e.getKey() == Ext.EventObject.ENTER) {\n  app.selBtn_1.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"},{"configs":{"tagConfigs":"columnWidth:0.3","labelWidth":"100","labelAlign":"right","itemId":"CREATED_BY_1","fieldLabel":"{#EMP_NAME#}"},"events":{"specialkey":"if (e.getKey() == Ext.EventObject.ENTER) {\n  app.selBtn_1.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"},{"configs":{"tagConfigs":"columnWidth:0.08","text":"{#queryBtn#}","margin":"0 0 0 10","itemId":"selBtn_1","iconCls":"seek_icon"},"events":{"click":"app.exPayGrid1.getStore().load();"},"children":[],"expanded":false,"type":"button"},{"configs":{"tagConfigs":"columnWidth:0.08","text":"{#clearBtn#}","margin":"0 0 0 10","itemId":"resetBtn_1","iconCls":"refresh_icon"},"events":{"click":"// TODO: 清空表单数据及表格数据\nWb.reset(app.selectForm);\napp.exPayGrid1.store.removeAll();"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"form"},{"configs":{"region":"center","multiSelect":"false","selType":"rowmodel","itemId":"exPayGrid1","viewConfig":"{\n enableTextSelection:true\n}"},"events":{"itemdblclick":"app.editBtn_1.fireEvent('click');"},"children":[{"configs":{"autoLoad":"false","itemId":"store","url":"m?xwl=xc/ex/biz/ex-pay-docs/ex-pay-docsDB/pay-doc-list-db/select-unhandler-docs"},"events":{"beforeload":"// 处理金额换算\nvar amt = app.EX_PAY_T_AMT_1.getValue() ;\nif(amt === \"\" || amt === null){\n  var str = '1=1' ;\n}else{\n  var str = ('T.EX_PAY_T_AMT ='+ amt) ;\n}\nstore.proxy.extraParams.amount = str ;\n\n// TODO: 注入其他参数\nstore.proxy.extraParams.EX_PAY_CODE = app.EX_PAY_CODE_1.getValue() ;\t// 支付单号或摘要\nstore.proxy.extraParams.CREATED_BY = app.CREATED_BY_1.getValue() ;\t\t// 创建人\nstore.proxy.extraParams.LEDGER_ID = app.LEDGER_ID_1.getValue() ;\t\t// 账簿ID\n\n"},"children":[],"expanded":false,"type":"store"},{"configs":{"border":"false","itemId":"tbar"},"children":[{"configs":{"text":"{#addBtn#}","itemId":"addBtn_1","iconCls":"file_add_icon"},"events":{"click":"// TODO: 打开新建付款单界面\nWb.run({\n\turl:'m?xwl=xc/ex/biz/ex-pay-docs/ex-pay-docs-common',\n    params : {\n      'opType'  : 'add',\n      'payId'   : '',\n      'headId'  : ''\n    },\n    success:function(appObj){\n      appObj.initWindow({\n        loadGridData : function(){\n          // 查询待处理的付款单\n          app.selBtn_1.fireEvent('click') ;\n        },\n        pageMode : 'pay',\n        title    : '{#title1#}',\n        headId   : '',\n        payId    : '',\n        ledgerId : ''\n      });\n    }\n});\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#editBtn#}","itemId":"editBtn_1","iconCls":"file_edit_icon"},"events":{"click":"// TODO: 获取选择行\nvar rec = app.exPayGrid1.getSelection();\n\n// TODO: 参数信息\nvar payId ;\nvar ledgerId ;\nvar headId ;\nif(rec.length === 0){\n  Wb.toast('{#editRec1#}');\n  return false;\n}else if(rec.length > 1){\n  Wb.toast('{#editRec1#}');\n  return false;  \n}else{\n  payId = rec[0].data.EX_PAY_ID ;\n  ledgerId = rec[0].data.LEDGER_ID ;\n  headId = rec[0].data.V_HEAD_ID ;\n}\n\n// TODO: 打开付款单编辑界面\nWb.run({\n\turl:'m?xwl=xc/ex/biz/ex-pay-docs/ex-pay-docs-common',\n    params : {\n      'opType' : 'edit',\n      'payId'  : payId,\n      'headId' : headId\n    },\n    success:function(appObj){\n      appObj.initWindow({\n        loadGridData : function(){\n          app.selBtn_1.fireEvent('click') ;\n        },\n        pageMode : 'pay',\n        title    : '{#editRec3#}',\n        headId   : headId,\n        payId    : payId,\n        ledgerId : ledgerId,\n        caId : rec[0].data.CA_ID ,\n        caName : rec[0].data.CA_NAME \n      });\n    }\n});\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#delBtn#}","itemId":"delBtn","iconCls":"file_delete_icon"},"events":{"click":"// TODO: 获取选中行信息\nvar rows = app.exPayGrid1.getSelection() ;\nif(rows.length === 0){\n  Wb.toast('{#deleteRec1#}');\n  return false ;\n}else{\n  var r = rows[0] ;\n  // 凭证状态\n  var vstatus = r.data.V_STATUS ;\n  // 凭证未提交之前\n  if(vstatus !== '3'){ \n    Wb.confirm('{#deleteRec2#}',function(id){\n      var payId = r.data.EX_PAY_ID ;  // 付款单ID\n      var headId = r.data.V_HEAD_ID ; // 凭证头ID\n      // 提交参数删除请求\n      Wb.request({\n        url: 'm?xwl=xc/ex/biz/ex-pay-docs/ex-pay-docsDB/del-pay-doc-db/del-pay-doc',\n        params: {\n          'payId' : payId,\n          'headId': headId\n        },\n        success: function(resp) {\n          var response = Wb.decode(resp.responseText) ;\n          if(response.flag === \"0\"){\n            app.exPayGrid1.getStore().load() ;\n            Wb.toast('{#deleteRec3#}') ;\n          }else{\n            Wb.toast('{#deleteRec4#}') ;\n          }\n        }\n      });\n    }) ;\n  }else{\n    Wb.toast('{#deleteRec5#}') ;\n    return false ;\n  } \n}"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#ORDERBY#}","xtype":"rownumberer","width":"50","align":"center","titleAlign":"center","itemId":"number"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"付款单ID","hidden":"true","dataIndex":"EX_PAY_ID","itemId":"EX_PAY_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#EX_PAY_CODE#}","width":"120","dataIndex":"EX_PAY_CODE","titleAlign":"center","itemId":"EX_PAY_CODE_COL","renderer":"metaData.style = 'overflow:auto;text-overflow: ellipsis;white-space: nowrap;white-space:normal;line-height:20px;';   \nreturn value;"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"账簿ID","hidden":"true","width":"120","dataIndex":"LEDGER_ID","titleAlign":"center","itemId":"LEDGER_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"开户行ID","hidden":"true","width":"120","dataIndex":"DEPOSIT_BANK_ID","titleAlign":"center","itemId":"DEPOSIT_BANK_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"支付方式","hidden":"true","width":"120","dataIndex":"PAY_TYPE","titleAlign":"center","itemId":"PAY_TYPE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#EX_PAY_DESC#}","width":"120","dataIndex":"EX_PAY_DESC","titleAlign":"center","itemId":"EX_PAY_DESC_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#EMP_NAME#}","width":"120","dataIndex":"EMP_NAME","titleAlign":"center","itemId":"EMP_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"创建人ID","hidden":"true","width":"120","dataIndex":"CREATED_BY","titleAlign":"center","itemId":"CREATED_BY_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#BANK_ACCOUNT#}","width":"120","dataIndex":"BANK_ACCOUNT","titleAlign":"center","itemId":"BANK_ACCOUNT_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#EX_PAY_DATE#}","width":"120","dataIndex":"EX_PAY_DATE","titleAlign":"center","itemId":"EX_PAY_DATE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#EX_PAY_T_AMT#}","width":"120","align":"right","dataIndex":"EX_PAY_T_AMT","format":"0,000.00","titleAlign":"center","itemId":"EX_PAY_T_AMT_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#V_STATUS#}","width":"120","dataIndex":"V_STATUS","titleAlign":"center","itemId":"V_STATUS_COL","renderer":"if(value=='1') return '凭证未生成';\nif(value=='2') return '凭证已生成';\nif(value=='3') return '凭证已复核';\nif(value=='4') return '凭证已取消';"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"凭证头ID","hidden":"true","dataIndex":"V_HEAD_ID","titleAlign":"center","itemId":"V_HEAD_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#PAY_STATUS#}","width":"120","dataIndex":"PAY_STATUS","titleAlign":"center","itemId":"PAY_STATUS_COL","renderer":"if(value=='Y') return '已付款';\nif(value=='N') return '未付款';"},"children":[],"expanded":true,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"panel"},{"configs":{"title":"{#Processed#}","layout":"border","border":"false","itemId":"rightPanel"},"children":[{"configs":{"region":"north","style":"border-width:0px","layout":"form","itemId":"selectForm_1"},"children":[{"configs":{"tagConfigs":"baseCls:'my-panel-no-border'","layout":"column","margin":"10 0 0 0","itemId":"panel2"},"children":[{"configs":{"tagConfigs":"columnWidth:0.3","labelWidth":"100","displayField":"LEDGER_NAME","valueField":"LEDGER_ID","labelAlign":"right","itemId":"LEDGER_ID_2","fieldLabel":"{#LEDGER_NAME#}","editable":"false"},"events":{"change":"app.selBtn_2.fireEvent('click');"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/com-qry/gl-ledgers/select-sec-fd-ledgers"},"events":{"load":"// TODO: 如果只有一个账簿则设为默认值\nif(store.getCount() == 1){\n  var r = records[0] ;\n  Wb.setValue(app.LEDGER_ID_2,{'LEDGER_ID_2':r.data.LEDGER_ID}) ;\n}"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"},{"configs":{"tagConfigs":"columnWidth:0.3","labelWidth":"100","labelAlign":"right","itemId":"EX_PAY_T_AMT_2","fieldLabel":"{#EX_PAY_T_AMT_1#}"},"events":{"specialkey":"// TODO: 加载已处理付款单信息\nif (e.getKey() == Ext.EventObject.ENTER) {\n  app.selBtn_2.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls:'my-panel-no-border'","layout":"column","margin":"10 0 10 0","itemId":"panel21"},"children":[{"configs":{"tagConfigs":"columnWidth:0.3","labelWidth":"100","labelAlign":"right","itemId":"EX_PAY_CODE_2","fieldLabel":"{#EX_PAY_CODE_1#}"},"events":{"specialkey":"// TODO: 加载已处理付款单信息\nif (e.getKey() == Ext.EventObject.ENTER) {\n  app.selBtn_2.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"},{"configs":{"tagConfigs":"columnWidth:0.3","labelWidth":"100","labelAlign":"right","itemId":"CREATED_BY_2","fieldLabel":"{#EMP_NAME#}"},"events":{"specialkey":"// TODO: 加载已处理付款单信息\nif (e.getKey() == Ext.EventObject.ENTER) {\n  app.selBtn_2.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"},{"configs":{"tagConfigs":"columnWidth:0.08","text":"{#queryBtn#}","margin":"0 0 0 10","itemId":"selBtn_2","iconCls":"seek_icon"},"events":{"click":"// TODO: 加载已处理付款单信息\napp.exPayGrid2.store.load();"},"children":[],"expanded":false,"type":"button"},{"configs":{"tagConfigs":"columnWidth:0.08","text":"{#clearBtn#}","margin":"0 0 0 10","itemId":"resetBtn_2","iconCls":"refresh_icon"},"events":{"click":"// TODO: 清空表单查询条件和表格信息\nWb.reset(app.selectForm_1);\napp.exPayGrid2.store.removeAll() ;"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"form"},{"configs":{"region":"center","itemId":"exPayGrid2","viewConfig":"{\n enableTextSelection:true\n}"},"events":{"itemdblclick":"app.seekCreBtn.fireEvent('click');"},"children":[{"configs":{"itemId":"store","autoLoad":"true","url":"m?xwl=xc/ex/biz/ex-pay-docs/ex-pay-docsDB/pay-doc-list-db/select-handler-docs"},"events":{"beforeload":"// 处理金额换算\nvar amt = app.EX_PAY_T_AMT_2.getValue() ;\nif(amt === \"\" || amt === null){\n  var str = '1=1' ;\n}else{\n  var str = ('T.EX_PAY_T_AMT ='+ amt) ;\n}\nstore.proxy.extraParams.amount = str ;\n\n// TODO: 注入其他参数\nstore.proxy.extraParams.EX_PAY_CODE = app.EX_PAY_CODE_2.getValue() ;\t// 支付单号或摘要\nstore.proxy.extraParams.CREATED_BY = app.CREATED_BY_2.getValue() ;\t\t// 创建人\nstore.proxy.extraParams.LEDGER_ID = app.LEDGER_ID_2.getValue() ;\t\t// 账簿ID\n\n"},"children":[],"expanded":false,"type":"store"},{"configs":{"border":"false","itemId":"tbar"},"children":[{"configs":{"text":"{#viewDocButton#}","itemId":"seekCreBtn","iconCls":"seek_icon"},"events":{"click":"// TODO: 查看凭证信息\nvar rec = app.exPayGrid2.getSelection();\n\nif(rec.length === 0){\n  Wb.toast('{#seekRec2#}') ;\n  return false;\n  \n}else{\n  // 凭证头ID\n  var headId = rec[0].data.V_HEAD_ID ;\t\t\n  // 账簿ID\n  var ledgerId = rec[0].data.LEDGER_ID ;\t\n  // 调用总账查看凭证界面\n  Wb.run({\n    url:'m?xwl=xc/gl/journal/v-windows/view-voucher-win',\n    params : {\n      'op'     : 'view',\n      'vt'     : 'normal',\n      'headId' : headId\n    },\n    success:function(appObj){\n      appObj.initWindow({\n        title : '{#title2#}',\n        ledgerId : ledgerId\n      });\n    }\n  });  \n}\n\n\n"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#ORDERBY#}","xtype":"rownumberer","width":"50","align":"center","titleAlign":"center","itemId":"number"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"付款单ID","hidden":"true","dataIndex":"EX_PAY_ID","itemId":"EX_PAY_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#EX_PAY_CODE#}","width":"120","dataIndex":"EX_PAY_CODE","titleAlign":"center","itemId":"EX_PAY_CODE_COL","renderer":"metaData.style = 'overflow:auto;text-overflow: ellipsis;white-space: nowrap;white-space:normal;line-height:20px;';   \nreturn value;"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"账簿ID","hidden":"true","width":"120","dataIndex":"LEDGER_ID","titleAlign":"center","itemId":"LEDGER_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"开户行ID","hidden":"true","width":"120","dataIndex":"DEPOSIT_BANK_ID","titleAlign":"center","itemId":"DEPOSIT_BANK_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"支付方式","hidden":"true","width":"120","dataIndex":"PAY_TYPE","titleAlign":"center","itemId":"PAY_TYPE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#EX_PAY_DESC#}","width":"120","dataIndex":"EX_PAY_DESC","titleAlign":"center","itemId":"EX_PAY_DESC_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#EMP_NAME#}","width":"120","dataIndex":"EMP_NAME","titleAlign":"center","itemId":"EMP_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"创建人ID","hidden":"true","width":"120","dataIndex":"CREATED_BY","titleAlign":"center","itemId":"CREATED_BY_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#BANK_ACCOUNT#}","width":"120","dataIndex":"BANK_ACCOUNT","titleAlign":"center","itemId":"BANK_ACCOUNT_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#EX_PAY_DATE#}","width":"120","dataIndex":"EX_PAY_DATE","titleAlign":"center","itemId":"EX_PAY_DATE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#EX_PAY_T_AMT#}","width":"120","align":"right","dataIndex":"EX_PAY_T_AMT","format":"0,000.00","titleAlign":"center","itemId":"EX_PAY_T_AMT_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#V_STATUS#}","width":"120","dataIndex":"V_STATUS","titleAlign":"center","itemId":"V_STATUS_COL","renderer":"if(value=='1') return '凭证未生成';\nif(value=='2') return '凭证已生成';\nif(value=='3') return '凭证已复核';\nif(value=='4') return '凭证已取消';"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"凭证头ID","hidden":"true","dataIndex":"V_HEAD_ID","titleAlign":"center","itemId":"V_HEAD_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#PAY_STATUS#}","width":"120","dataIndex":"PAY_STATUS","titleAlign":"center","itemId":"PAY_STATUS_COL","renderer":"if(value=='Y') return '已付款';\nif(value=='N') return '未付款';"},"children":[],"expanded":true,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"tab"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}