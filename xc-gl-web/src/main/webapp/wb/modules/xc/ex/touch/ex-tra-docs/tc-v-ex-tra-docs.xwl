{"inframe":true,"title":"差旅报销单移动审批页面","hidden":false,"roles":{"default":1},"children":[{"configs":{"loginRequired":"false","jsLinks":"[\"xip/js/xipWfTouch.js\"]","serverScript":"// TODO: 获取业务单据ID\nvar exDocId = request.getParameter('businessId');\nrequest.setAttribute('bizId',exDocId);\n\n// TODO: 如果单据ID存在, 则更新单据信息 ; 否则为新增单据信息\nif(exDocId !== null && exDocId !== \"\" && exDocId !== undefined){\n  var docJson = com.xzsoft.xc.ex.util.XCEXWebBuilderUtil.getExDocById(exDocId) ;\n  request.setAttribute(\"docJSON\", docJson) ;\n}\n\n// TODO: 系统根路径\nrequest.setAttribute(\"ctxPath\", request.getContextPath());\n","itemId":"module"},"children":[{"configs":{"layout":"fit","itemId":"viewport1"},"children":[{"configs":{"tagConfigs":"{align : 'stretch'}","layout":"vbox","scrollable":"true","itemId":"container1"},"children":[{"configs":{"style":"background-color:0;","layout":"vbox","itemId":"content","flex":"1"},"events":{"initialize":"// TODO: 费用申请单ID\nvar bizId = '{#bizId#}' ;\n\n// TODO: 表单赋值\nif(bizId !== \"\" && bizId !== null && bizId !== undefined){\n  var dataJson = Wb.decode('{#docJSON#}') ;\n  Wb.setValue(app.content, dataJson) ;  \n  \n  // 计算借款余额\n  Wb.request({\n    url   : '{#ctxPath#}/borrowMoneyAction.do?method=getUserImprest',\n    async : false,\n    timeout:3600000,\n    params: {\n      'ledgerId' : dataJson.LEDGER_ID,\n      'userId'   : dataJson.CREATED_BY\n    },\n    success:function(resp){\n      var obj = Wb.decode(resp.responseText);\n      if(!Ext.isEmpty(obj)){\n        Wb.setValue(app.LEND_AMT,{'LEND_AMT':obj.iaBal}) ;\n      }\n    }\n  });\n}"},"children":[{"configs":{"labelWidth":"90","readOnly":"true","label":"账簿","itemId":"LEDGER_NAME","flex":"1"},"children":[],"expanded":true,"type":"ttext"},{"configs":{"labelWidth":"90","readOnly":"true","label":"成本中心","itemId":"DEPT_NAME","flex":"1"},"children":[],"expanded":false,"type":"ttext"},{"configs":{"labelWidth":"90","readOnly":"true","label":"报销说明","itemId":"EX_REASON","border":"true","flex":"1.5"},"children":[],"expanded":false,"type":"ttext"},{"configs":{"labelWidth":"90","readOnly":"true","label":"项目","itemId":"PROJECT_NAME","flex":"1"},"children":[],"expanded":true,"type":"ttext"},{"configs":{"layout":"hbox","itemId":"tr1","border":"1","flex":"1"},"children":[{"configs":{"labelWidth":"90","readOnly":"true","label":"申请人","itemId":"CREATED_BY_NAME","flex":"1"},"children":[],"expanded":true,"type":"ttext"},{"configs":{"labelWidth":"90","readOnly":"true","label":"借款余额","itemId":"LEND_AMT","flex":"1"},"children":[],"expanded":false,"type":"tnumber"}],"expanded":true,"type":"tpanel"},{"configs":{"layout":"hbox","itemId":"tr2","flex":"1"},"children":[{"configs":{"labelWidth":"90","readOnly":"true","minValue":"0","label":"报销金额","itemId":"AMOUNT","flex":"1"},"children":[],"expanded":true,"type":"tnumber"},{"configs":{"labelWidth":"90","readOnly":"true","value":"0","label":"核销金额","itemId":"CANCEL_AMT","flex":"1"},"children":[],"expanded":false,"type":"tnumber"}],"expanded":true,"type":"tpanel"}],"expanded":false,"type":"tfieldset"},{"configs":{"style":"background-color:0;","itemTpl":"<div style=\"width:100%\">\n\t<div style=\"margin:5px 0px;width:100%;height:33%\">\n      <div style=\"float: left;;width:65%;height:33%\">费用项目：{EX_ITEM_NAME}<\/div>\n\t\t <div style=\"float:left;width:35%;height:100%\">金额：{EX_DTL_AMT} <\/div>\n\t<\/div>\n  <div style=\"width:100%;word-wrap:break-word;word-break:break-all\">报销说明：{EX_DTL_DESC}<\/div>\n<\/div>","itemId":"list1","flex":"2"},"children":[{"configs":{"autoSync":"true","itemId":"store","autoLoad":"true","url":"m?xwl=xc/ex/qry/ex-my-doc-qry/data/select-ex-doc-dtls"},"events":{"beforeload":"var proxy = this.getProxy() ;\nproxy._extraParams.exDocId = '{#bizId#}' ;"},"children":[],"expanded":false,"type":"tstore"}],"expanded":false,"type":"tlist"},{"configs":{"itemId":"toolbar1"},"children":[{"configs":{"itemId":"spacer1"},"children":[],"expanded":true,"type":"tspacer"},{"configs":{"text":"附件","itemId":"attchBtn"},"events":{"tap":"// TODO: 附件上传\nvar exDocId = app.EX_DOC_ID.getValue() ;\nif(exDocId === null || exDocId === \"\" || exDocId === undefined){\n  Wb.info('单据尚未保存不能添加附件') ;\n  return false ;\n}\n\n// 获取附件分类\t\nWb.request({\n  url : '{#ctxPath#}'+'/exDocsAction.do?method=getProcAndFormsByCat',\n  timeout : 3600000,\n  params: {\n    'ledgerId' : app.LEDGER_ID.getValue(),\n    'docCat'   : 'EX03'\n  },\n  success: function(resp) {\n    var response = Wb.decode(resp.responseText) ;\n    var attCat = response.ATT_CAT_CODE ;\n    if(response.flag === \"0\"){\n      if(attCat === null || attCat === \"\" || attCat === undefined){\n        Wb.info('差旅报销单未设置附件分类') ;\n      }else{\n        var ex_doc_id = app.EX_DOC_ID.getValue() ;\n        var ex_doc_code = app.EX_DOC_CODE.getValue() ;\n        var orgId = app.ORG_ID.getValue() ;\n        // 挂载附件\n        Xip.showAttachmentManagerTouch(app.xipMainNav,'{#XIP.userId#}',ex_doc_id,orgId,attCat,ex_doc_code ,'N','Y','N',function(){},2) ;\n      }\n    }else{\n      Wb.info(response.msg) ;\n    }\n  }\n});"},"children":[],"expanded":false,"type":"tbutton"},{"configs":{"itemId":"spacer2"},"children":[],"expanded":false,"type":"tspacer"}],"expanded":false,"type":"ttoolbar"}],"expanded":true,"type":"tcontainer"}],"expanded":true,"type":"tviewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}