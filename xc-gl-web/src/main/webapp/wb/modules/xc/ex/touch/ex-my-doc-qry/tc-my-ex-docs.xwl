{"inframe":true,"title":"我的报销单","hidden":false,"roles":{"default":1},"children":[{"configs":{"loginRequired":"false","serverScript":"request.setAttribute(\"ctxPath\", request.getContextPath()) ;","itemId":"module"},"events":{"initialize":"Wb.apply(app,{\n  init:function(x){\n    mainNav=x;\n  },\n  addOrEditDoc : function(docId, title, url, opMode, accessPage, ldId){\n    Wb.run({\n      url : url,\n      params: {\n        'docId'      : docId,\n        'ledgerId'   : ldId,\n        'opMode'     : opMode,\n        'accessPage' : accessPage\n      },\n      success: function(scope) {\n        Wb.each(scope, function(k, v) {\n          if (v && (v.isViewport || v.initialConfig && v.initialConfig.isViewport)) {\n            if(typeof scope.init == 'function'){\n              scope.init(mainNav,{\n                loadDocGrid : function(){\n                  app.list1.getStore().load();\n                }\n              });\n            }\n            var newCard = Ext.create('Ext.Container',{\n              layout: 'fit',\n              title:title\n            });\n            newCard.add(v);\n            newCard._title=title;\n            newCard.__url =url;\n            mainNav.push(newCard);\n            return false;\n          }\n        });\n      }\n    });\n  }\n});\n\n"},"children":[{"configs":{"height":"300","hidden":"true","layout":"fit","width":"250","left":"0","itemId":"menu","modal":"true","hideOnMaskTap":"true","top":"0"},"children":[{"configs":{"layout":"fit","itemId":"container1"},"children":[{"configs":{"style":"background:0","itemTpl":"<div style=\"width:100%\">\n\t<div style=\"width:100%;word-wrap:break-word;word-break:break-all\">{EX_CAT_NAME}<\/div>\n    <div style=\"display:none\">{M_W_FORM_URL}<\/div>\n  \t<div style=\"display:none\">{PROCESS_ID}<\/div>\n    <div style=\"display:none\">{RULE_CODE}<\/div>\n<\/div>","itemId":"btnList"},"events":{"itemtap":"// TODO: 获取单据类型、单据URL地址\nvar catName = record.data.EX_CAT_NAME ;\nvar formUrl = record.data.M_W_FORM_URL ;\nvar _ledgerId = app.ledger.getValue() ;\n\n// 隐藏单据类型列表\napp.menu.hide() ;\n\n// 判断表单是否存在\nif(formUrl === null || formUrl === \"\" || formUrl === undefined){\n  Wb.info(catName+'未设置移动端填报表单无法填报') ;\n  return false ;\n}\n\n// 新增单据\napp.addOrEditDoc('',catName,formUrl, 'add', 'list', _ledgerId);"},"children":[{"configs":{"autoLoad":"false","itemId":"store","url":"m?xwl=xc/ex/common-db/query/select-ld-ex-cats"},"events":{"beforeload":"var proxy = this.getProxy() ;\nproxy._extraParams.ledgerId = app.ledger.getValue() ;"},"children":[],"expanded":false,"type":"tstore"}],"expanded":true,"type":"tlist"}],"expanded":true,"type":"tcontainer"}],"expanded":true,"type":"tpanel"},{"configs":{"appGlyph":"f015","layout":"fit","itemId":"viewport1"},"children":[{"configs":{"title":"我的单据","layout":"fit","itemId":"container"},"children":[{"configs":{"docked":"top","itemId":"toolbar"},"children":[{"configs":{"labelWidth":"50","displayField":"LEDGER_NAME","valueField":"LEDGER_ID","label":"<font color=red>*<\/font>账簿","itemId":"ledger"},"events":{"change":"app.btnList.getStore().load() ;\napp.list1.store.load();","initialize":"app.ledger.setWidth(document.body.clientWidth*0.8) ;"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/com-qry/gl-ledgers/select-sec-fd-ledgers"},"events":{"load":"if(store.getCount()==1){\n  var ldId = records[0].data.LEDGER_ID ;\n  app.ledger.setValue(ldId) ;\n}"},"children":[],"expanded":false,"type":"tstore"}],"expanded":true,"type":"tselect"}],"expanded":true,"type":"ttoolbar"},{"configs":{"layout":"fit","itemId":"container1"},"children":[{"configs":{"docked":"top","style":"background:0;border-bottom:1px #C0C0C0 solid","itemId":"toolbar1"},"children":[{"configs":{"ui":"action","glyph":"f067","margin":"0 -6 0 0","itemId":"createBtn"},"events":{"tap":"app.menu.showBy(button);"},"children":[],"expanded":false,"type":"tbutton"},{"configs":{"placeHolder":"按单据编号或摘要查询","height":"50","width":"265","clearIcon":"true","itemId":"text1","padding":"2 0"},"events":{"clearicontap":"app.list1.store.load();","blur":"app.list1.store.load();"},"children":[],"expanded":false,"type":"ttext"},{"configs":{"ui":"action","glyph":"f002","margin":"0 0 0 -6","itemId":"queryBtn"},"events":{"tap":"app.list1.store.load();"},"children":[],"expanded":false,"type":"tbutton"}],"expanded":true,"type":"ttoolbar"},{"configs":{"style":"background:0","itemTpl":"<div style=\"width:100%\">\n\t<div style=\"margin:5px 0px;width:100%;height:33%\">\n\t\t <div style=\"float: left;;width:65%;height:33%\">编号:{EX_DOC_CODE}<\/div>\n\t\t <div style=\"float:left;width:35%;height:100%\"> 状态:{AUDIT_STATUS_DESC} <\/div>\n\t<\/div>\n\t<div style=\"margin:5px 0px;width:100%;height:33%\">\n\t\t <div style=\"float: left;;width:65%;height:30%\">类型:{EX_CAT_NAME}<\/div>\n\t\t <div style=\"float:left;width:35%;height:100%\"> 金额:{AMOUNT}<\/div>\n\t<\/div>\n\t<div style=\"width:100%;word-wrap:break-word;word-break:break-all\">摘要:{EX_REASON}<\/div>\n  \t<div style=\"display:none\">{EX_DOC_ID}<\/div>\n    <div style=\"display:none\">{INS_CODE}<\/div>\n    <div style=\"display:none\">{AUDIT_STATUS}<\/div>\n    <div style=\"display:none\">{LEDGER_ID}<\/div>\n    \n<\/div>","autoPaging":"true","itemId":"list1"},"events":{"itemtap":"// 参数\nvar catName = record.data.EX_CAT_NAME ;\nvar formUrl = record.data.M_W_FORM_URL ;\nvar _ledgerId = record.data.LEDGER_ID ;\nvar docId = record.data.EX_DOC_ID ;\n\n// 编辑单据\napp.addOrEditDoc(docId, catName,formUrl, 'edit', 'list', _ledgerId);","itemtaphold":"// TODO: 长按执行删除处理\nvar as = record.data.AUDIT_STATUS ;\n\nif(as === 'C'){\n  Wb.info('单据已提交不能删除') ;\n  \n}else if(as === 'E'){\n  Wb.info('单据已审批完成不能删除') ;\n  \n}else{\n  // 封装参数\n  var delRecords = [];\n  var line = {'EX_DOC_ID':record.data.EX_DOC_ID} ;\n  delRecords.push(line);\n  \n  // 执行删除\n  Ext.Msg.confirm('提示','您确定要删除所选单据吗?',function(id){\n    if(id=='yes'){\n      Wb.request({\n        url : '{#ctxPath#}'+'/exDocsAction.do?method=delDoc',\n        timeout : 3600000,\n        params  : {\n          'params' : Wb.encode(delRecords)\n        },\n        success: function(resp) {\n          var response = Wb.decode(resp.responseText) ;\n          if(response.flag == \"0\"){\n            app.list1.getStore().load() ;\n          }\n          Wb.info(response.msg) ;\n        }\n      });\n    }\n  });\n}"},"children":[{"configs":{"itemId":"store","autoLoad":"true","url":"m?xwl=xc/ex/qry/ex-my-doc-qry/data/select-my-docs"},"events":{"beforeload":"// 参数\nvar proxy = this.getProxy() ;\nproxy._extraParams.ledgerId = app.ledger.getValue() ;\nproxy._extraParams.docCat = 'ALL' ;\nproxy._extraParams.textStr = app.text1.getValue() ;"},"children":[],"expanded":false,"type":"tstore"}],"expanded":true,"type":"tlist"}],"expanded":false,"type":"tcontainer"}],"expanded":true,"type":"tcontainer"}],"expanded":true,"type":"tviewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}