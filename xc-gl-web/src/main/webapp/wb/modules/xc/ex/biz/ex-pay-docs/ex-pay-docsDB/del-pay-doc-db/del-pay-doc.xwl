{"inframe":false,"title":"删除付款单信息","hidden":false,"roles":{"default":1},"children":[{"configs":{"loginRequired":"false","serverScript":"// TODO: 获取参数信息\nvar payId = request.getParameter(\"payId\");\nvar headId = request.getParameter(\"headId\");\n\n// TODO: 判断单据是否已经付款\napp.run('select 1 from xc_ex_pay t where t.EX_PAY_ID = {?payId?} and t.V_STATUS = \\'3\\'', {\n  errorText: '单据已付款不能删除'\n});\n\nrequest.setAttribute(\"payId\",payId) ;\nrequest.setAttribute(\"headId\",headId) ;\n\n// 提示信息\napp.send({'flag':'0'}) ;","itemId":"module"},"children":[{"configs":{"sql":"insert into xc_gl_v_junmp_num\n  (ledger_id,\n   period_code,\n   rule_code,\n   v_serial_num,\n   creation_date,\n   created_by,\n   last_update_date,\n   last_updated_by)\nselect t.ledger_id,\n    t.period_code,\n    'ZZ_PZ',\n    t.v_serial_num,\n    {?timestamp.sys.date?},\n    {?XIP.userId?},\n    {?timestamp.sys.date?},\n    {?XIP.userId?}\nfrom xc_gl_v_heads t \nwhere t.v_head_id = '{#headId#}'\n  and (t.v_serial_num is null or t.v_serial_num = '') ","transaction":"start","itemId":"record-v-jump-no"},"children":[],"expanded":false,"type":"query"},{"configs":{"sql":"delete from xc_gl_v_lines where xc_gl_v_lines.V_HEAD_ID = '{#headId#}'","itemId":"del-v-lines"},"children":[],"expanded":false,"type":"query"},{"configs":{"sql":"delete from xc_gl_v_heads where xc_gl_v_heads.V_HEAD_ID = '{#headId#}'","itemId":"del-v-head"},"children":[],"expanded":false,"type":"query"},{"configs":{"sql":"update xc_ex_docs\n   set ex_pay_id         = null,\n       last_update_date  = {?timestamp.sys.date?},\n       last_updated_by   = {?XIP.userId?}\n where ex_pay_id = '{#payId#}'\n","itemId":"upd-ex-docs"},"children":[],"expanded":false,"type":"query"},{"configs":{"sql":"delete from xc_ex_pay_dtl where xc_ex_pay_dtl.ex_pay_id = '{#payId#}'\n","itemId":"del-pay-doc-dtls"},"children":[],"expanded":false,"type":"query"},{"configs":{"sql":"delete from xc_ex_pay where ex_pay_id = '{#payId#}'\n","itemId":"del-pay-doc"},"children":[],"expanded":false,"type":"query"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":"record_delete_icon"}