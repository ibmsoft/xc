{"inframe":false,"title":"单据签收","hidden":false,"roles":{"default":1},"children":[{"configs":{"initScript":"var userId = request.getSession().getAttribute(\"XzSessionVars\").get('userId');\n\nvar protocol = request.getProtocol() ;\nvar ipAddr = request.getServerName();\nvar port = request.getServerPort() ;\nvar ctxPath = request.getContextPath() ;\n\nvar pp = protocol.substr(0,5) ;\nprotocol = (pp.indexOf(\"https\") == -1 ? \"http\" : \"https\") ;\n\nvar url = protocol + \"://\" + ipAddr +\":\" + port + ctxPath ;\n\nrequest.setAttribute('contextPath',ctxPath);\nrequest.setAttribute(\"userId\",userId);\nrequest.setAttribute(\"appIP\",url);\nvar appId = request.getSession().getAttribute(\"XzSessionVars\").get('appId');\nrequest.setAttribute(\"funId\",request.getParameter('funId'));\nrequest.setAttribute(\"appId\",request.getParameter('appId'));","loginRequired":"false","jsLinks":"[\"xip/js/xipWf-debug.js\"]","serverScript":"//---------------------获取当前模块语言对应的.json文件，放到request中----------------\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xc/ex/biz/ex-rec-docs/XC_EX_REC_DOCS\");","head":"<style type=\"text/css\">\n  .my_custom_grid .x-grid-row{\n      height:50px;\n  }\n  .my_custom_grid .x-grid-editor .x-form-text{\n      height:49px;\n  }\n  .my_custom_grid .x-grid-cell{\n      font: normal 12px/13px tahoma, arial, verdana, sans-serif;\n  }\n  .my_custom_grid .x-grid-cell{\n      border-color: #d0d0d0;\n  }\n  .my_custom_grid .x-grid-with-col-lines .x-grid-cell {\n    border-right-width: 1px;\n  }\n  .my_custom_grid .x-grid-with-row-lines .x-grid-td {\n    border-bottom-width: 1px;\n}\n<\/style>","itemId":"module"},"children":[{"configs":{"itemId":"storeFile"},"children":[{"configs":{"pageSize":"-1","autoLoad":"false","itemId":"no_sign_store","url":"m?xwl=xc/ex/biz/ex-rec-docs/ex_rec_docs_db/select_no_sign"},"children":[],"expanded":false,"type":"store"},{"configs":{"pageSize":"-1","autoLoad":"false","itemId":"alread_sign_store","url":"m?xwl=xc/ex/biz/ex-rec-docs/ex_rec_docs_db/select_alread_sign"},"children":[],"expanded":false,"type":"store"},{"configs":{"pageSize":"-1","autoLoad":"true","itemId":"query_ledger_store","url":"m?xwl=xc/com-qry/gl-ledgers/select-sec-fd-ledgers"},"children":[],"expanded":false,"type":"store"},{"configs":{"pageSize":"-1","autoLoad":"false","itemId":"query_no_sign_dept_store","url":"m?xwl=xc/ex/biz/ex-rec-docs/ex_rec_docs_db/select_ld_dept"},"events":{"beforeload":"var temp_ledger = app.query_no_sign_ledger.getValue();\n\nstore.proxy.extraParams.ledger_id = temp_ledger;"},"children":[],"expanded":false,"type":"store"},{"configs":{"pageSize":"-1","autoLoad":"false","itemId":"query_no_sign_project_store","url":"m?xwl=xc/ex/biz/ex-rec-docs/ex_rec_docs_db/select_pm_project"},"events":{"beforeload":"var temp_ledger = app.query_no_sign_ledger.getValue();\n\nstore.proxy.extraParams.ledger_id = temp_ledger;\n"},"children":[],"expanded":false,"type":"store"},{"configs":{"pageSize":"-1","autoLoad":"false","itemId":"query_alread_sign_dept_store","url":"m?xwl=xc/ex/biz/ex-rec-docs/ex_rec_docs_db/select_ld_dept"},"events":{"beforeload":"var temp_ledger = app.query_alread_sign_ledger.getValue();\n\nstore.proxy.extraParams.ledger_id = temp_ledger;"},"children":[],"expanded":false,"type":"store"},{"configs":{"pageSize":"-1","autoLoad":"false","itemId":"query_alread_sign_project_store","url":"m?xwl=xc/ex/biz/ex-rec-docs/ex_rec_docs_db/select_pm_project"},"events":{"beforeload":"var temp_ledger = app.query_alread_sign_ledger.getValue();\n\nstore.proxy.extraParams.ledger_id = temp_ledger;\n"},"children":[],"expanded":false,"type":"store"},{"configs":{"pageSize":"-1","autoLoad":"false","itemId":"query_ex_doc_code_store","url":"m?xwl=xc/ex/biz/ex-rec-docs/ex_rec_docs_db/select_ex_doc_code"},"events":{"beforeload":"var temp_ledger = app.query_no_sign_ledger.getValue();\nstore.proxy.extraParams.ledger_id = temp_ledger;\n"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"folder"},{"configs":{"maximized":"true","title":"单据详情","autoShow":"false","height":"350","width":"900","closeAction":"hide","border":"false","itemId":"see_details_win","modal":"true","draggable":"true","maximizable":"false"},"children":[{"configs":{"layout":"column","border":"false","itemId":"query_details_panel"},"children":[{"configs":{"readOnly":"true","hidden":"true","padding":"10","itemId":"EX_DOC_ID","fieldLabel":"{#EX_DOC_ID#}"},"children":[],"expanded":false,"type":"text"},{"configs":{"tagConfigs":"columnWidth:0.7","store":"app.query_ex_doc_code_store","displayField":"EX_DOC_CODE","valueField":"EX_DOC_ID","padding":"10","itemId":"EX_DOC_CODE","fieldLabel":"{#EX_DOC_CODE#}"},"events":{"select":"// 选中记录\nvar r = records[0].data ;\n\n// 单据类型\nvar catCode = r.EX_DOC_CODE ;\nvar formUrl = r.PC_A_FORM_URL ;\nif(formUrl === null || formUrl === \"\" || formUrl === undefined){\n  var catName = r.EX_CAT_NAME ;\n  Wb.toast(catName + \" 未设置PC端审批表单,请到【单据类型】功能处设置\") ;\n  return false ;\n}\n\n//清空单据信息\napp.enclosure_panel.removeAll();\n// 打开单据\nWb.run({\n  url : formUrl.substring(1),\n  params : {\n    'exDocId' : r.EX_DOC_ID\n  },\n  success:function(appObj){\n    app.enclosure_panel.add(appObj.viewport1); \n    appObj.initViewport({\n\n    });\n  }\n});\n","beforequery":"var combo = plan.combo ;\nif(!plan.forceAll){\n  var flag = false;\n  var value = plan.query;\n  combo.store.filterBy(function(record,id){\n    var text = record.get(combo.displayField);\n    return (text.indexOf(value)!=-1);\n  });\n  combo.expand();\n  return false;\n}"},"children":[],"expanded":false,"type":"combo"},{"configs":{"text":"{#details_enclosure_btn#}","width":"60","itemId":"details_enclosure_btn","y":"10","iconCls":"attach_icon","x":"20"},"events":{"click":"var temp_code = app.EX_DOC_CODE.getValue();\nvar temp_id = app.EX_DOC_ID.getValue();\n\nif(temp_code==='' ||temp_code===null){\n  Wb.toast('请选择一条单据信息!');\n  //Ext.Msg.alert('提示','请选择一条单据信息');\n}else{\n    Xip.showAttachmentManager('{#XIP.userId#}',temp_id,'','EX_REC_DOCS',temp_code,'Y','Y','Y',function(){},2); \n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#details_sign_btn#}","width":"60","itemId":"details_sign_btn","y":"10","iconCls":"check_icon","x":"40"},"events":{"click":"var temp = app.EX_DOC_CODE.getValue();\n\nif(temp==='' || temp===null) {\n  Wb.toast('请先选择一条需要签收的单据');\n  //Ext.MessageBox.alert('提示','请先选择一条需要签收的单据');\n  return;\n}\nif(app.EX_DOC_ID.getValue()==='' || app.EX_DOC_ID.getValue()===null) {\n  Wb.toast('请先选择一条需要签收的单据');  \n  //Ext.MessageBox.alert('提示','请先选择一条需要签收的单据');\n  return;\n}\n\nelse{\n  var temp_doc_id = app.EX_DOC_ID.getValue();\n  Ext.MessageBox.confirm('提示', '是否确定签收单据：'+temp+'?', function(btn){ \n    if (btn == 'yes'){\n      Wb.request({\n         url:'m?xwl=xc/ex/biz/ex-rec-docs/ex_rec_docs_db/update_is_sign',\n         params:{ex_doc_id:temp_doc_id,status:2},//2表示已签收状态\n         success:function(){\n            Wb.toast('签收成功!');\n            //Ext.MessageBox.alert('提示','签收成功!');\n            app.noSignQueryBtn.fireEvent('click');\n            app.alreadSignQueryBtn.fireEvent('click');\n            app.see_details_win.close();\n         },\n         failure:function(){\n            Wb.toast('签收失败!');\n            //Ext.MessageBox.alert('提示','签收失败!');\n            app.see_details_win.close();\n         }\n      });\n    }\n});  \n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#details_refuse_btn#}","width":"60","itemId":"details_refuse_btn","y":"10","iconCls":"cube_icon","x":"60"},"events":{"click":"var temp = app.EX_DOC_CODE.getValue();\n\nif(temp==='' ||temp===null) {\n  Ext.MessageBox.alert('提示','请先选择一条需要拒签的单据');\n  return;\n}\nif(app.EX_DOC_ID.getValue()==='' || app.EX_DOC_ID.getValue()===null) {\n  Ext.MessageBox.alert('提示','请先选择一条需要拒签的单据');\n  return;\n}\n\nelse{\n  \n  //查看单据是否已经拒签，避免重复拒签（如果这个功能需要实现，则在面板中增加隐藏一个签字的状态）\n  \n  \n  var temp_doc_id = app.EX_DOC_ID.getValue();\n  Ext.MessageBox.confirm('提示', '是否确定拒签单据：'+temp+'?', function(btn){ \n    if (btn == 'yes'){\n      Wb.request({\n         url:'m?xwl=xc/ex/biz/ex-rec-docs/ex_rec_docs_db/update_is_sign',\n         params:{ex_doc_id:temp_doc_id,status:3},//2表示已签收状态\n         success:function(){\n            Ext.MessageBox.alert('提示','拒签成功!');\n            app.no_sign_store.reload();\n            app.alread_sign_store.reload();\n            app.see_details_win.close();\n         }\n//         ,\n//          failure:function(){\n//             Ext.MessageBox.alert('提示','拒签失败!');\n//             app.see_details_win.close();\n//          }\n      });\n    }\n});  \n}"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"form"},{"configs":{"tagConfigs":"baseCls:'my-panel-no-border'","height":"2000","frame":"false","layout":"fit","border":"false","itemId":"enclosure_panel"},"children":[],"expanded":false,"type":"panel"}],"expanded":true,"type":"window"},{"configs":{"layout":"fit","itemId":"viewport1"},"children":[{"configs":{"border":"false","itemId":"sign_panel"},"children":[{"configs":{"title":"待签收","layout":"border","border":"false","itemId":"no_sign_panel"},"children":[{"configs":{"region":"north","border":"false","itemId":"no_sign_query"},"children":[{"configs":{"tagConfigs":"baseCls:'my-panel-no-border'","layout":"column","margin":"10 0 0 0","border":"false","itemId":"tr1"},"children":[{"configs":{"tagConfigs":"columnWidth:0.25","labelWidth":"80","store":"app.query_ledger_store","displayField":"LEDGER_NAME","valueField":"LEDGER_ID","emptyText":"{#empty_text_ledger#}","labelAlign":"right","itemId":"query_no_sign_ledger","forceSelection":"true","fieldLabel":"{#query_no_sign_ledger#}","editable":"false"},"events":{"select":"app.query_no_sign_code.reset();\napp.query_no_sign_emp.reset();\napp.query_no_sign_dept.reset();\napp.query_no_sign_project.reset();\n\n\napp.noSignQueryBtn.fireEvent('click');\n\n//为已签收单据进行筛选\napp.query_alread_sign_ledger.setValue(app.query_no_sign_ledger.getValue());\napp.query_alread_sign_code.reset();\napp.query_alread_sign_emp.reset();\napp.query_alread_sign_dept.reset();\napp.query_alread_sign_project.reset();\napp.alreadSignQueryBtn.fireEvent('click');","specialkey":"if(e.getKey()===13) {\n  app.noSignQueryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"combo"},{"configs":{"tagConfigs":"columnWidth:0.25","labelWidth":"120","labelAlign":"right","itemId":"query_no_sign_code","fieldLabel":"{#query_no_sign_code#}"},"events":{"specialkey":"if(e.getKey()===13) {\n  app.noSignQueryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"},{"configs":{"tagConfigs":"columnWidth:0.2","labelWidth":"80","labelAlign":"right","itemId":"query_no_sign_emp","fieldLabel":"{#query_no_sign_emp#}"},"events":{"specialkey":"if(e.getKey()===13) {\n  app.noSignQueryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":false,"type":"panel"},{"configs":{"tagConfigs":"baseCls:'my-panel-no-border'","layout":"column","margin":"10 0 10 0","border":"false","itemId":"tr2"},"children":[{"configs":{"tagConfigs":"columnWidth:0.25","labelWidth":"80","labelAlign":"right","itemId":"query_no_sign_dept","fieldLabel":"{#query_no_sign_dept#}"},"events":{"specialkey":"if(e.getKey()===13)\n  app.noSignQueryBtn.fireEvent('click');"},"children":[],"expanded":false,"type":"text"},{"configs":{"tagConfigs":"columnWidth:0.25","labelWidth":"120","labelAlign":"right","itemId":"query_no_sign_project","fieldLabel":"{#query_no_sign_project#}"},"events":{"specialkey":"if(e.getKey()===13)\n  app.noSignQueryBtn.fireEvent('click');"},"children":[],"expanded":false,"type":"text"},{"configs":{"tagConfigs":"columnWidth:0.08","text":"{#noSignQueryBtn#}","margin":"0 0 0 20","itemId":"noSignQueryBtn","iconCls":"seek_icon","x":"15"},"events":{"click":"var temp_ledger = app.query_no_sign_ledger.getValue();\n\nif(temp_ledger==='' || temp_ledger===null) {\n    Wb.toast('请先选择账薄进行查询!');\n    //Ext.MessageBox.alert('提示','请先选择账薄信息!');\n    return;\n}\n\nvar temp_code = Ext.String.escape(app.query_no_sign_code.getValue());//编号\nvar temp_emp = Ext.String.escape(app.query_no_sign_emp.getValue());//报销人\n\nvar temp_dept = app.query_no_sign_dept.getValue();//成本中心\n// var temp_dept = app.query_no_sign_dept_id.getValue();\n\nvar temp_project = app.query_no_sign_project.getValue();//项目\n// var temp_project = app.query_no_sign_project_id.getValue();\n\napp.no_sign_store.load({\n    params:{\n           ledger_id:temp_ledger,\n           doccode:temp_code,\n           empname:temp_emp,\n           deptId:temp_dept,\n           projectId:temp_project\n    }\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"tagConfigs":"columnWidth:0.08","text":"{#noSignResetBtn#}","margin":"0 0 0 20","itemId":"noSignResetBtn","iconCls":"refresh_icon","x":"18"},"events":{"click":"app.query_no_sign_ledger.reset();\napp.query_no_sign_code.reset();\napp.query_no_sign_emp.reset();\napp.query_no_sign_dept.reset();\napp.query_no_sign_project.reset();\n\n\nvar temp_ledger = app.query_no_sign_ledger.getValue();\nvar temp_code = Ext.String.escape(app.query_no_sign_code.getValue());//编号\nvar temp_emp = Ext.String.escape(app.query_no_sign_emp.getValue());//报销人\n\nvar temp_dept = app.query_no_sign_dept.getValue();//成本中心\nvar temp_project = app.query_no_sign_project.getValue();//项目\n\napp.no_sign_store.load({\n    params:{\n           ledger_id:temp_ledger,\n           doccode:temp_code,\n           empname:temp_emp,\n           deptId:temp_dept,\n           projectId:temp_project\n    }\n});"},"children":[],"expanded":false,"type":"button"}],"expanded":false,"type":"panel"}],"expanded":false,"type":"form"},{"configs":{"region":"center","store":"app.no_sign_store","itemId":"no_sign_grid"},"events":{"itemdblclick":"app.seeBtn.fireEvent('click');"},"children":[{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"{#seeBtn#}","textAlign":"center","itemId":"seeBtn","iconCls":"seek_icon"},"events":{"click":"var noSignLedgerId = app.query_no_sign_ledger.getValue() ;\nif(noSignLedgerId === '' || noSignLedgerId === null) {\n  Wb.toast('请先选择账薄信息!');\n  return;\n}\n\n// 选中记录行\nvar temp = app.no_sign_grid.getSelection();\nif(temp.length===0){\n  Wb.toast('请先选择 1 条单据!');\n  return;\n  \n}else{\n  var rr = temp[0].data ;\n  // 单据类型\n  var catCode = rr.EX_DOC_CODE ;\n  var formUrl = rr.PC_A_FORM_URL ;\n  if(formUrl === null || formUrl === \"\" || formUrl === undefined){\n    var catName = rr.EX_CAT_NAME ;\n    Wb.toast(catName + \" 未设置PC端审批表单,请到【单据类型】功能处设置\") ;\n    return false ;\n  }\n  //清空单据信息\n  app.enclosure_panel.removeAll();  \n  // 打开单据\n  Wb.run({\n    url : formUrl.substring(1),\n    params : {\n      'exDocId'    : rr.EX_DOC_ID\n    },\n    success:function(appObj){\n      app.enclosure_panel.add(appObj.viewport1); \n      appObj.initViewport({\n        \n      });\n    }\n  });\n  \n  app.see_details_win.show();\n  Wb.setValue(app.see_details_win,temp[0].data);\n}\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#signBtn#}","itemId":"signBtn","iconCls":"check_icon"},"events":{"click":"var temp = app.no_sign_grid.getSelection();\n\nif(temp.length===0) {\n  Wb.toast('请先选择一条需要签收的记录');\n  //Ext.MessageBox.alert('提示','请先选择一条需要签收的记录');\n  return;\n}\nelse{\n  var temp_doc_id = temp[0].data.EX_DOC_ID;\n  var temp_doc_id = temp[0].data.EX_DOC_ID;\n  Ext.MessageBox.confirm('提示', '是否确定签收单据：'+temp[0].data.EX_DOC_CODE+'?', function(btn){ \n    if (btn == 'yes'){\n      Wb.request({\n         url:'m?xwl=xc/ex/biz/ex-rec-docs/ex_rec_docs_db/update_is_sign',\n         params:{ex_doc_id:temp_doc_id,status:2},//2表示已签收状态\n         success:function(){\n            Wb.toast('签收成功!');\n            //Ext.MessageBox.alert('提示','签收成功!');\n            app.noSignQueryBtn.fireEvent('click');\n            app.alreadSignQueryBtn.fireEvent('click');\n         },\n         failure:function(){\n            Wb.toast('签收失败!');\n            //Ext.MessageBox.alert('提示','签收失败!');\n         }\n      });\n    }\n});  \n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#refuseBtn#}","itemId":"refuseBtn","iconCls":"cube_icon"},"events":{"click":"var temp = app.no_sign_grid.getSelection();\n\nif(temp.length===0) {\n  Wb.toast('请先选择一条需要拒签的记录');\n  return;\n}\nif(temp[0].data.SIGN_STATUS===3||temp[0].data.SIGN_STATUS==='3' ) {\n   Wb.toast('此单据已拒签！');\n   return;\n}\nelse{\n  var temp_doc_id = temp[0].data.EX_DOC_ID;\n  Ext.MessageBox.confirm('提示', '是否确定拒签单据：'+temp[0].data.EX_DOC_CODE+'?', function(btn){ \n    if (btn == 'yes'){\n      Wb.request({\n         url:'m?xwl=xc/ex/biz/ex-rec-docs/ex_rec_docs_db/update_is_sign',\n         params:{ex_doc_id:temp_doc_id,status:3},//3表示拒签状态\n         success:function(){\n            Wb.toast('拒签成功!');\n            app.no_sign_store.reload();\n            //app.alreadSignQueryBtn.fireEvent('click');\n         },\n         failure:function(){\n            Wb.toast('拒签失败!');\n         }\n      });\n    }\n});  \n}\n\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#enclosureBtn#}","itemId":"enclosureBtn","iconCls":"attach_icon"},"events":{"click":"var rows = app.no_sign_grid.getSelection();\nif(rows.length<1){\n  Wb.toast('请选择一条单据信息');\n  \n}else{\n    // 选中记录\n    var temp_id = rows[0].data.EX_DOC_ID ;\n    var temp_code = rows[0].data.EX_DOC_CODE ;\n    var docCat = rows[0].data.EX_CAT_CODE ;\n    // 账簿ID\n    var ledgerId = app.query_no_sign_ledger.getValue();\n\n    // 获取附件分类\n    Wb.request({\n      url: '{#contextPath#}'+'/exDocsAction.do?method=getAttCatCode',\n      params: {\n        'ledgerId' : ledgerId,\n        'docCat'   : docCat\n      },\n      success: function(resp) {\n        var response = Wb.decode(resp.responseText) ;\n        if(response.flag == \"0\"){\n          // 附件分类码\n          var att_cat_code = response.attCat ;\n          // 上传附件\n          Xip.showAttachmentManager('{#XIP.userId#}',temp_id,'',att_cat_code,temp_code,'Y','Y','Y',function(){},2); \n\n        }else{\n          Wb.info(response.msg) ;\n        }\n      }\n    });    \n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#monitorBtn#}","itemId":"monitorBtn","iconCls":"viewport_icon"},"events":{"click":"// TODO: 选中记录行\nvar rows = app.no_sign_grid.getSelection();\nif(rows.length != 1){\n  Wb.toast('请选择 1 条需要监控流程审批的单据');\n}else{\n  var insCode= rows[0].data.INS_CODE ;\n  if(insCode !== null && insCode !== \"\" && insCode !== undefined){\n    // 打开流程监控图\n    XipWf.showMonitorPage(insCode);\n    \n  }else{\n    Wb.toast('单据尚未提交审批');\n  }\n}"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#no_sign_row_num#}","align":"center","width":"50","xtype":"rownumberer","titleAlign":"center","itemId":"no_sign_row_num"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#ex_doc_code_col#}","width":"100","dataIndex":"EX_DOC_CODE","titleAlign":"center","itemId":"ex_doc_code_col","renderer":"metaData.style = 'overflow:auto;padding: 3px 6px;text-overflow: ellipsis;white-space: nowrap;white-space:normal;line-height:18px;';   \nreturn value;"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#ex_reason_col#}","width":"180","dataIndex":"EX_REASON","titleAlign":"center","itemId":"ex_reason_col","renderer":"metaData.style = 'overflow:auto;padding: 3px 6px;text-overflow: ellipsis;white-space: nowrap;white-space:normal;line-height:18px;';   \nreturn value;"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#amount_col#}","align":"right","width":"80","dataIndex":"AMOUNT","format":"0,000.00","titleAlign":"center","itemId":"amount_col"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#ex_cat_code_col#}","hidden":"true","dataIndex":"EX_CAT_CODE","itemId":"ex_cat_code_col"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#ex_cat_name_col#}","width":"120","dataIndex":"EX_CAT_NAME","titleAlign":"center","itemId":"ex_cat_name_col"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#emp_name_col#}","width":"80","dataIndex":"EMP_NAME","titleAlign":"center","itemId":"emp_name_col"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#dept_name_col#}","width":"120","dataIndex":"DEPT_NAME","titleAlign":"center","itemId":"dept_name_col"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#project_name_col#}","width":"150","dataIndex":"PROJECT_NAME","titleAlign":"center","itemId":"project_name_col","renderer":"metaData.style = 'overflow:auto;padding: 3px 6px;text-overflow: ellipsis;white-space: nowrap;white-space:normal;line-height:18px;';   \nreturn value;"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#sign_status_col#}","width":"80","dataIndex":"SIGN_STATUS","titleAlign":"center","itemId":"sign_status_col","renderer":"if(value===1 || value==='1')\n  return '待签收';\nif(value===2 || value==='2')\n  return '已签收';\nif(value===3 || value==='3')\n  return '拒签';"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#creation_date_col#}","width":"100","dataIndex":"CREATION_DATE","titleAlign":"center","itemId":"creation_date_col"},"children":[],"expanded":false,"type":"column"}],"expanded":false,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"panel"},{"configs":{"title":"已签收","layout":"border","border":"false","itemId":"alread_sign_panel"},"children":[{"configs":{"region":"north","buttonAlign":"center","border":"false","itemId":"alread_sign_query"},"children":[{"configs":{"tagConfigs":"baseCls:'my-panel-no-border'","layout":"column","margin":"10 0 0 0","border":"false","itemId":"tr1"},"children":[{"configs":{"tagConfigs":"columnWidth:0.25","labelWidth":"80","store":"app.query_ledger_store","displayField":"LEDGER_NAME","valueField":"LEDGER_ID","emptyText":"{#empty_text_ledger#}","labelAlign":"right","itemId":"query_alread_sign_ledger","fieldLabel":"{#query_no_sign_ledger#}","editable":"false"},"events":{"select":"app.query_alread_sign_code.reset();\napp.query_alread_sign_emp.reset();\napp.query_alread_sign_dept.reset();\napp.query_alread_sign_project.reset();\n\n\napp.alreadSignQueryBtn.fireEvent('click');\n\n\n\n//为已签收单据进行筛选\napp.query_no_sign_ledger.setValue(app.query_alread_sign_ledger.getValue());\napp.query_no_sign_code.reset();\napp.query_no_sign_emp.reset();\napp.query_no_sign_dept.reset();\napp.query_no_sign_project.reset();\napp.noSignQueryBtn.fireEvent('click');","specialkey":"if(e.getKey()===13) {\n  app.alreadSignQueryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"combo"},{"configs":{"tagConfigs":"columnWidth:0.25","labelWidth":"120","labelAlign":"right","itemId":"query_alread_sign_code","fieldLabel":"{#query_no_sign_code#}"},"events":{"specialkey":"if(e.getKey()===13) {\n  app.alreadSignQueryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"},{"configs":{"tagConfigs":"columnWidth:0.2","labelWidth":"80","labelAlign":"right","itemId":"query_alread_sign_emp","fieldLabel":"{#query_no_sign_emp#}"},"events":{"specialkey":"if(e.getKey()===13) {\n  app.alreadSignQueryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls:'my-panel-no-border'","layout":"column","margin":"10 0 10 0","border":"false","itemId":"tr2"},"children":[{"configs":{"tagConfigs":"columnWidth:0.25","labelWidth":"80","labelAlign":"right","itemId":"query_alread_sign_dept","fieldLabel":"{#query_no_sign_dept#}"},"events":{"specialkey":"if(e.getKey()===13) {\n  app.alreadSignQueryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"},{"configs":{"tagConfigs":"columnWidth:0.25","labelWidth":"120","labelAlign":"right","itemId":"query_alread_sign_project","fieldLabel":"{#query_no_sign_project#}"},"events":{"specialkey":"if(e.getKey()===13) {\n  app.alreadSignQueryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"},{"configs":{"tagConfigs":"columnWidth:0.08","text":"{#noSignQueryBtn#}","margin":"0 0 0 20","itemId":"alreadSignQueryBtn","iconCls":"seek_icon","x":"15"},"events":{"click":"var temp_ledger = app.query_alread_sign_ledger.getValue();\n\nif(temp_ledger==='' || temp_ledger===null) {\n    Wb.toast('请先选择账薄信息进行查询!');\n    //Ext.MessageBox.alert('提示','请先选择账薄信息!');\n    return;\n}\n\nvar temp_code = Ext.String.escape(app.query_alread_sign_code.getValue());//编号\nvar temp_emp = Ext.String.escape(app.query_alread_sign_emp.getValue());//报销人\n\nvar temp_dept = app.query_alread_sign_dept.getValue();//成本中心\nvar temp_project = app.query_alread_sign_project.getValue();//项目\n// var temp_dept = app.query_alread_sign_dept_id.getValue();//成本中心\n// var temp_project = app.query_alread_sign_project_id.getValue();//项目\n\n\n\napp.alread_sign_store.load({\n    params:{\n           ledger_id:temp_ledger,\n           doccode:temp_code,\n           empname:temp_emp,\n           deptId:temp_dept,\n           projectId:temp_project\n    }\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"tagConfigs":"columnWidth:0.08","text":"{#noSignResetBtn#}","margin":"0 0 0 20","itemId":"alreadSignResetBtn","iconCls":"refresh_icon","x":"18"},"events":{"click":"app.query_alread_sign_ledger.reset();\napp.query_alread_sign_code.reset();\napp.query_alread_sign_emp.reset();\napp.query_alread_sign_dept.reset();\napp.query_alread_sign_project.reset();\n\n\n\n//清空显示记录\nvar temp_ledger = app.query_alread_sign_ledger.getValue();\nvar temp_code = Ext.String.escape(app.query_alread_sign_code.getValue());//编号\nvar temp_emp = Ext.String.escape(app.query_alread_sign_emp.getValue());//报销人\n\nvar temp_dept = app.query_alread_sign_dept.getValue();//成本中心\nvar temp_project = app.query_alread_sign_project.getValue();//项目\n\n// var temp_dept = app.query_alread_sign_dept_id.getValue();\n// var temp_project = app.query_alread_sign_project_id.getValue(); \n\n\napp.alread_sign_store.load();"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"form"},{"configs":{"region":"center","store":"app.alread_sign_store","itemId":"alread_sign_grid"},"events":{"itemdblclick":"app.reviewBtn.fireEvent('click');"},"children":[{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#no_sign_row_num#}","align":"center","width":"50","xtype":"rownumberer","titleAlign":"center","itemId":"alread_sign_row_num"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#ex_doc_code_col#}","width":"100","dataIndex":"EX_DOC_CODE","titleAlign":"center","itemId":"ex_doc_code_col","renderer":"metaData.style = 'overflow:auto;padding: 3px 6px;text-overflow: ellipsis;white-space: nowrap;white-space:normal;line-height:18px;';   \nreturn value;"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#ex_reason_col#}","width":"180","dataIndex":"EX_REASON","titleAlign":"center","itemId":"ex_reason_col","renderer":"metaData.style = 'overflow:auto;padding: 3px 6px;text-overflow: ellipsis;white-space: nowrap;white-space:normal;line-height:18px;';   \nreturn value;"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#amount_col#}","align":"right","width":"80","dataIndex":"AMOUNT","format":"0,000.00","titleAlign":"center","itemId":"amount_col"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#ex_cat_name_col#}","width":"120","dataIndex":"EX_CAT_NAME","titleAlign":"center","itemId":"ex_cat_name_col"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#emp_name_col#}","width":"80","dataIndex":"EMP_NAME","titleAlign":"center","itemId":"emp_name_col"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#dept_name_col#}","width":"120","dataIndex":"DEPT_NAME","titleAlign":"center","itemId":"dept_name_col"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#project_name_col#}","width":"150","dataIndex":"PROJECT_NAME","titleAlign":"center","itemId":"project_name_col","renderer":"metaData.style = 'overflow:auto;padding: 3px 6px;text-overflow: ellipsis;white-space: nowrap;white-space:normal;line-height:18px;';   \nreturn value;"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#sign_status_col#}","width":"80","dataIndex":"SIGN_STATUS","titleAlign":"center","itemId":"sign_status_col","renderer":"if(value===1 || value==='1')\n  return '待签收';\nif(value===2 || value==='2')\n  return '已签收';\nif(value===3 || value==='3')\n  return '拒签';"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#creation_date_col#}","width":"100","dataIndex":"CREATION_DATE","titleAlign":"center","itemId":"creation_date_col"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"{#reviewBtn#}","itemId":"reviewBtn","iconCls":"ok_icon"},"events":{"click":"var rec =app.alread_sign_grid.getSelection();//选择记录\nvar ledger_id = app.query_alread_sign_ledger.getValue();\n\n\nif(ledger_id === null || ledger_id === ''){\n    Wb.toast('请先选择账簿信息!');\n\t//Ext.MessageBox.alert('提示','请先选择账簿信息!');\n    return;\n}\nif (rec.length > 1 || rec.length === 0) {\n    Wb.toast('请选择一条需要复核的记录!'); \n    //Ext.MessageBox.alert('提示','请选择一条需要复核的记录!');\n    return;\n}\nif(rec[0].data.EX_CAT_CODE==='EX01') {\n    Wb.toast('费用申请单无法复核!');  \n    //Ext.MessageBox.alert('提示','费用申请单无法复核!');\n    return;\n}\nelse{\n    var r = rec[0].data;\n    Wb.run({\n        url : 'm?xwl=xc/ex/biz/ex-chk-docs/review-window',\n        params :{\n          'headId' : r.V_HEAD_ID\n        },\n        success : function(appObj){\n            appObj.initWindow({\n                loadGridData : function(){\n                    app.alreadSignQueryBtn.fireEvent('click') ;\n                },\n                ledgerId : r.LEDGER_ID,//账簿\n                exDocId : r.EX_DOC_ID,//费用单据ID\n                exDocCode : r.EX_DOC_CODE,//费用单据编码\n                amount : r.AMOUNT,//单据金额\n                cancelAmt : r.CANCEL_AMT,//核销金额\n                exCatCode : r.EX_CAT_CODE,//单据类型\n                payMethod : r.PAY_METHOD,//支付方式\n                payType : r.PAY_TYPE,//支付类型\n                vHeadId : r.V_HEAD_ID,//凭证头ID\n                createdBy : r.CREATED_BY,//申请人\n                docFormUrl : r.PC_A_FORM_URL \n            });\n        }\n    });\n}"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":false,"type":"panel"}],"expanded":true,"type":"tab"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}