{"inframe":false,"title":"单据查询","hidden":false,"roles":{"default":1},"children":[{"configs":{"initScript":"var userId = request.getSession().getAttribute(\"XzSessionVars\").get('userId');\n\nvar protocol = request.getProtocol() ;\nvar ipAddr = request.getServerName();\nvar port = request.getServerPort() ;\nvar ctxPath = request.getContextPath() ;\n\nvar pp = protocol.substr(0,5) ;\nprotocol = (pp.indexOf(\"https\") == -1 ? \"http\" : \"https\") ;\n\nvar url = protocol + \"://\" + ipAddr +\":\" + port + ctxPath ;\n\nrequest.setAttribute('contextPath',ctxPath);\nrequest.setAttribute(\"userId\",userId);\nrequest.setAttribute(\"appIP\",url);\nvar appId = request.getSession().getAttribute(\"XzSessionVars\").get('appId');\nrequest.setAttribute(\"funId\",request.getParameter('funId'));\nrequest.setAttribute(\"appId\",request.getParameter('appId'));","loginRequired":"false","jsLinks":"[\"xip/js/xipWf-debug.js\"]","serverScript":"//---------------------获取当前模块语言对应的.json文件，放到request中----------------\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xc/ex/qry/ex-doc-qry/XC_EX_DOC_QRY\");\n\nvar ctxPath = request.getContextPath() ;\nrequest.setAttribute(\"contextPath\",ctxPath);","head":"<style type=\"text/css\">\n  .my_custom_grid .x-grid-row{\n      height:50px;\n  }\n  .my_custom_grid .x-grid-editor .x-form-text{\n      height:49px;\n  }\n  .my_custom_grid .x-grid-cell{\n      font: normal 12px/13px tahoma, arial, verdana, sans-serif;\n  }\n  .my_custom_grid .x-grid-cell{\n      border-color: #d0d0d0;\n  }\n  .my_custom_grid .x-grid-with-col-lines .x-grid-cell {\n    border-right-width: 1px;\n  }\n  .my_custom_grid .x-grid-with-row-lines .x-grid-td {\n    border-bottom-width: 1px;\n}\n<\/style>","itemId":"module"},"children":[{"configs":{"layout":"fit","closeAction":"hide","itemId":"viewDocWin"},"children":[],"expanded":true,"type":"window"},{"configs":{"maximized":"true","title":"{#ex_doc_print_win#}","height":"450","width":"800","layout":"fit","closeAction":"hide","html":"<iframe id='exDocPrintFormUrl' src='' scrolling=no frameborder=0 width=100% height=100% ><\/iframe>\n","border":"false","itemId":"printDocWin","modal":"true","maximizable":"true"},"children":[],"expanded":false,"type":"window"},{"configs":{"title":"退回原因","height":"200","layout":"fit","width":"450","closeAction":"hide","dialog":"true","itemId":"cancelWin","modal":"true"},"events":{"ok":"// 退回原因\nvar cr = app.cancel_reason.getValue() ;\nif(cr === null || cr === \"\" || cr === undefined){\n  Wb.toast(\"请填写退回原因\") ;\n  return false ;\n}\n\n// 单据ID\nvar rec = app.pay_grid.getSelection() ;\n\n// 进度条\nvar msg = Ext.MessageBox.show({\n  title:'请等待',\n  msg:'正在提交请求，请稍后...',\n  width:240,\n  wait:true,\n  progress :true,\n  closable :false\n});\n\n// 提交请求\nWb.request({\n  url: '{#contextPath#}' +'/exCheckAndPayAction.do?method=cancelDoc',\n  timeout : 3600000,\n  params: {\n    'docId'   : rec[0].data.EX_DOC_ID,\n    'cancelReason' : app.cancel_reason.getValue()\n  },\n  success: function(resp) {\n    msg.hide() ;\n    app.cancelWin.hide() ;\n    var response = Wb.decode(resp.responseText) ;\n    if(response.flag === \"0\"){\n      app.queryBtn.fireEvent('click') ;\n    }\n    Wb.toast(response.msg) ;\n  }\n});"},"children":[{"configs":{"layout":"fit","border":"false","itemId":"form1"},"children":[{"configs":{"itemId":"cancel_reason"},"children":[],"expanded":false,"type":"textarea"}],"expanded":true,"type":"form"}],"expanded":false,"type":"window"},{"configs":{"layout":"border","itemId":"viewport1"},"children":[{"configs":{"region":"north","border":"false","itemId":"query_form"},"children":[{"configs":{"tagConfigs":"baseCls:'my-panel-no-border'","layout":"column","margin":"10 0 0 0","border":"false","itemId":"tr1"},"children":[{"configs":{"tagConfigs":"columnWidth:0.25","labelWidth":"80","displayField":"LEDGER_NAME","valueField":"LEDGER_ID","emptyText":"{#empty_text_ledger#}","labelAlign":"right","itemId":"query_ledger","forceSelection":"true","fieldLabel":"{#query_ledger#}","editable":"false"},"events":{"change":"app.query_code.reset();\napp.query_dept.reset();\napp.query_project.reset();\napp.query_create_by.reset();\n\napp.queryBtn.fireEvent('click');","beforequery":"var combo = plan.combo ;\nif(!plan.forceAll){\n  var flag = false;\n  var value = plan.query;\n  combo.store.filterBy(function(record,id){\n    var text = record.get(combo.displayField);\n    return (text.indexOf(value)!=-1);\n  });\n  combo.expand();\n  return false;\n}"},"children":[{"configs":{"pageSize":"-1","autoLoad":"true","itemId":"store","url":"m?xwl=xc/com-qry/gl-ledgers/select-sec-fd-ledgers"},"events":{"load":"if(store.getCount() === 1){\n  Wb.setValue(app.query_ledger,{'query_ledger':records[0].data.LEDGER_ID}) ;\n  \n}"},"children":[],"expanded":false,"type":"store"}],"expanded":false,"type":"combo"},{"configs":{"tagConfigs":"columnWidth:0.25","labelWidth":"120","labelAlign":"right","itemId":"query_code","fieldLabel":"{#query_code#}"},"events":{"specialkey":"if(e.getKey()===13)\n  app.queryBtn.fireEvent('click');"},"children":[],"expanded":false,"type":"text"},{"configs":{"tagConfigs":"columnWidth:0.2","labelWidth":"80","labelAlign":"right","itemId":"query_create_by","fieldLabel":"{#query_create_by#}"},"events":{"specialkey":"if(e.getKey()===13)\n  app.queryBtn.fireEvent('click');"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls:'my-panel-no-border'","layout":"column","margin":"10 0 10 0","border":"false","itemId":"tr2"},"children":[{"configs":{"tagConfigs":"columnWidth:0.25","labelWidth":"80","labelAlign":"right","itemId":"query_dept","fieldLabel":"{#query_dept#}"},"events":{"specialkey":"if(e.getKey()===13)\n  app.queryBtn.fireEvent('click');"},"children":[],"expanded":false,"type":"text"},{"configs":{"tagConfigs":"columnWidth:0.25","labelWidth":"120","labelAlign":"right","itemId":"query_project","fieldLabel":"{#query_project#}"},"events":{"specialkey":"if(e.getKey()===13)\n  app.queryBtn.fireEvent('click');"},"children":[],"expanded":false,"type":"text"},{"configs":{"tagConfigs":"columnWidth:0.08","text":"{#queryBtn#}","margin":"0 0 0 20","textAlign":"center","itemId":"queryBtn","iconCls":"seek_icon","x":"10"},"events":{"click":"var temp_ledger = app.query_ledger.getValue();\nvar temp_code = app.query_code.getValue();\nvar temp_create = app.query_create_by.getValue();\n\nvar temp_dept = app.query_dept.getValue();\nvar temp_proj = app.query_project.getValue();\n\nif(temp_ledger===null || temp_ledger===''){\n   Wb.toast('请先选择账薄信息!');\n   //Ext.MessageBox.alert('提示','请先选择账薄信息!');\n   return;\n}\n\napp.pay_grid.getStore().load({\n    params:{\n      ledger_id:temp_ledger,\n      doc_code:temp_code,\n      create_name:temp_create,\n      dept_id:temp_dept,\n      project_id:temp_proj\n    }\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"tagConfigs":"columnWidth:0.08","text":"{#resetBtn#}","margin":"0 0 0 20","textAlign":"center","itemId":"resetBtn","iconCls":"refresh_icon","x":"15"},"events":{"click":"app.query_ledger.reset();\napp.query_code.reset();\napp.query_create_by.reset();\napp.query_dept.reset();\napp.query_project.reset();\n\napp.pay_grid.getStore().load();"},"children":[],"expanded":false,"type":"button"}],"expanded":false,"type":"panel"}],"expanded":false,"type":"form"},{"configs":{"region":"center","itemId":"pay_grid"},"events":{"itemdblclick":"app.seekBtn.fireEvent('click');"},"children":[{"configs":{"pageSize":"-1","autoLoad":"false","itemId":"store","url":"m?xwl=xc/ex/qry/ex-doc-qry/ex_doc_qry_db/select_doc"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"修改","itemId":"btnEditDoc","iconCls":"edit_icon"},"events":{"click":"var records = app.pay_grid.getSelection(); \nif(records.length !== 1){\n    Wb.toast('请选择 1 条业务单据');\n    return false ;\n  \n}else{\n  var r = records[0].data ;\n  var docId = r.EX_DOC_ID ;\n  var vHeadId = r.V_HEAD_ID ;\n  var catName = r.EX_CAT_NAME ;\n  var formUrl = r.PC_W_FORM_URL ;\n  // 判断单据是否已经复核了\n  if(vHeadId !== null && vHeadId !== \"\" && vHeadId !== undefined){\n    Wb.toast('单据已复核不能修改!') ;\n    return false ;\n  }\n  \n  // 判断单据类型是否绑定表单\n  if(formUrl === null || formUrl === \"\" || formUrl === undefined){\n    Wb.toast(catName+'未绑定电脑端编辑表单,请确认!') ;\n    return false ;\n  }\n  // 打开编辑界面\n  Wb.run({\n    url : formUrl.substring(1),\n    params : {\n      'exDocId'    : docId,\n      'opMode'     : 'edit',\n      'accessPage' : 'list',\n      'roleMode'   : 'admin'\n    },\n    success:function(appObj){\n      appObj.initWindow({\n        loadDocGrid : function(){\n          // 加载单据列表\n          app.queryBtn.fireEvent('click') ;\n        }\n      });\n    }\n  });\n  \n}\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#enclosureBtn#}","itemId":"enclosureBtn","iconCls":"attach_icon"},"events":{"click":"var rows =app.pay_grid.getSelection();//选择记录\n\nif(rows.length===0) {\n   Wb.toast('请先选择一条需要查看附件的记录!');\n   //Ext.MessageBox.alert('提示','请先选择一条需要查看附件的记录!');\n   return;\n}\n\nvar temp_id = rows[0].data.EX_DOC_ID;\nvar temp_code = rows[0].data.EX_DOC_CODE;\nXip.showAttachmentManager('{#XIP.userId#}',temp_id,'','EX_REC_DOCS',temp_code,'N','N','N',function(){},2); \n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#cancelDoc#}","itemId":"cancelDoc","iconCls":"first_icon","tooltip":"{#cancelDoc_tooltip#}"},"events":{"click":"var rows = app.pay_grid.getSelection() ;\n\nif(rows.length !== 1){\n  Wb.toast(\"请选择 1 条单据\") ;\n  return false ;\n  \n}else{\n  var r = rows[0].data ;\n  var vs = r.V_STATUS ;\n  var as = r.AUDIT_STATUS ;\n  \n  if(vs === '3'){\n    Wb.toast(\"单据已复核不能取消\") ;\n    return false ;\n  }\n  if(as !== 'E'){\n    Wb.toast(\"单据尚未审批完成不能取消\") ;\n    return false ;\n  }\n  \n  app.cancelWin.show() ;\n  app.cancelWin.center() ;\n}\n\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#monitorBtn#}","itemId":"monitorBtn","iconCls":"viewport_icon"},"events":{"click":"// TODO: 选中记录行\nvar rows = app.pay_grid.getSelection();\nif(rows.length != 1){\n  Wb.toast('请选择 1 条需要监控流程审批的单据');\n}else{\n  var insCode= rows[0].data.INS_CODE ;\n  if(insCode !== null && insCode !== \"\" && insCode !== undefined){\n    // 打开流程监控图\n    XipWf.showMonitorPage(insCode);\n    \n  }else{\n    Wb.toast('单据尚未提交审批');\n  }\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#seekBtn#}","itemId":"seekBtn","iconCls":"seek_icon"},"events":{"click":"var records = app.pay_grid.getSelection(); \nif(records.length !== 1){\n    Wb.toast('请选择 1 条业务单据');\n    return false ;\n  \n}else{\n  var r = records[0].data ;\n  var docId = r.EX_DOC_ID ;\n  var catCode = r.EX_CAT_CODE ;\n  var catName = r.EX_DOC_NAME ;\n  var formUrl = r.PC_A_FORM_URL ;\n  // 判断单据类型是否绑定表单\n  if(formUrl === null || formUrl === \"\" || formUrl === undefined){\n    Wb.toast(catName+'未绑定电脑端审批表单,请确认!') ;\n    return false ;\n  }\n  // 打开业务单据\n  Wb.run({\n    url : formUrl.substring(1),\n    params : {\n      'exDocId' : docId,\n      'opMode'  : ''\n    },\n    success:function(appObj){   \n      // 设置弹出窗口属性\n      app.viewDocWin.setTitle('单据详情') ;\n      app.viewDocWin.insert(appObj.viewport1) ;\n      if(catCode == 'EX01' || catCode == 'EX02' || catCode == 'EX05'){\n        // 费用申请单、借款单和还款单\n        app.viewDocWin.setWidth(document.body.clientWidth*(0.7)) ;\n        app.viewDocWin.setHeight(document.body.clientHeight*(0.45)) ;\n        app.viewDocWin.maximizable = false; \n        app.viewDocWin.maximized = false; \n        \n      }else if(catCode == 'EX03' || catCode == 'EX04'){\n        // 差旅报销单和费用报销单\n        app.viewDocWin.maximizable = false; \n        app.viewDocWin.maximized = true; \n      }\n      app.viewDocWin.modal = true; \n      app.viewDocWin.center() ;\n      app.viewDocWin.show();\n\n      appObj.initViewport() ;\n    }\n  }); \n  \n}\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#seekHeadBtn#}","itemId":"seekHeadBtn","iconCls":"grid_icon"},"events":{"click":"//查看凭证\nvar temp = app.pay_grid.getSelection();\n\nif(temp.length===0) {\n   Wb.toast('请选择一条需要查看凭证的记录!');\n   //Ext.MessageBox.alert('提示','请选择一条需要查看凭证的记录!');\n   return;\n}\n\nvar r = temp[0].data ; \n\nif(r.V_STATUS==='' || r.V_STATUS===null || r.V_STATUS===1 || r.V_STATUS==='1') {\n  Wb.toast('凭证信息未生成，无法查看凭证信息!');\n  //Ext.MessageBox.alert('提示','凭证信息未生成，无法查看凭证信息!');\n  return;\n}\n\n\n//查看凭证信息\nvar headId = r.V_HEAD_ID ;\nvar ledgerId = r.LEDGER_ID ;\nWb.run({\n  url:'m?xwl=xc/gl/journal/v-windows/view-voucher-win',\n  params : {\n    'op'     : 'view',\n    'vt'     : 'normal',\n    'headId' : headId\n  },\n  success:function(appObj){\n    appObj.initWindow({\n      title : '凭证查看',\n      ledgerId : ledgerId\n    });\n  }\n});\n\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#printBtn#}","itemId":"printBtn","iconCls":"printer_icon"},"events":{"click":"var records = app.pay_grid.getSelection(); \nif(records.length !== 1){\n    Wb.toast('请选择 1 条业务单据');\n    return false ;\n  \n}else{\n  var r = records[0].data ;\n  \n  var docId = r.EX_DOC_ID ;\n  var catName = r.EX_CAT_NAME ;\n  var formUrl = r.PC_P_FORM_URL ;\n  var taskTab = r.TASK_TAB ;\n  \n  // 判断单据类型是否绑定打印表单\n  if(formUrl === null || formUrl === \"\" || formUrl === undefined || formUrl === \"/\"){\n    Wb.toast(catName+'未绑定电脑端打印表单,请确认!') ;\n    return false ;\n  }else{\n    // 打开打印界面\n    app.printDocWin.show() ;\n    document.getElementById('exDocPrintFormUrl').src = '{#appIP#}'+formUrl+\"&exDocId=\"+docId+\"&tab=\"+taskTab ;\n  }\n}\n"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#row_num_col#}","align":"center","width":"50","xtype":"rownumberer","titleAlign":"center","itemId":"row_num_col"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#ex_doc_code_col#}","width":"100","dataIndex":"EX_DOC_CODE","titleAlign":"center","itemId":"ex_doc_code_col"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#ex_reason_col#}","width":"180","dataIndex":"EX_REASON","titleAlign":"center","itemId":"ex_reason_col","renderer":"metaData.style = 'overflow:auto;padding: 3px 6px;text-overflow: ellipsis;white-space: nowrap;white-space:normal;line-height:18px;';   \nreturn value;"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#amount_col#}","xtype":"numbercolumn","align":"right","width":"80","dataIndex":"AMOUNT","format":"0,000.00","titleAlign":"center","itemId":"amount_col"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#no_account_col#}","xtype":"numbercolumn","align":"right","width":"80","dataIndex":"NO_AMOUNT","titleAlign":"center","itemId":"no_account_col","renderer":"metaData.style = 'overflow:auto;padding: 3px 6px;text-overflow: ellipsis;white-space: nowrap;white-space:normal;line-height:18px;';  \nreturn Wb.format(value,'0,000.00');"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#ex_cat_name_col#}","width":"80","dataIndex":"EX_CAT_NAME","titleAlign":"center","itemId":"ex_cat_name_col"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#created_by_col#}","width":"80","dataIndex":"CREATED_NAME","titleAlign":"center","itemId":"created_by_col"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#dept_name_col#}","width":"150","dataIndex":"DEPT_NAME","titleAlign":"center","itemId":"dept_name_col","renderer":"metaData.style = 'overflow:auto;padding: 3px 6px;text-overflow: ellipsis;white-space: nowrap;white-space:normal;line-height:18px;';   \nreturn value;"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#project_name_col#}","width":"150","dataIndex":"PROJECT_NAME","titleAlign":"center","itemId":"project_name_col","renderer":"metaData.style = 'overflow:auto;padding: 3px 6px;text-overflow: ellipsis;white-space: nowrap;white-space:normal;line-height:18px;';   \nreturn value;"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#creation_date_col#}","width":"90","dataIndex":"CREATION_DATE","titleAlign":"center","itemId":"creation_date_col"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#v_status_name_col#}","width":"100","dataIndex":"V_STATUS_NAME","titleAlign":"center","itemId":"v_status_name_col"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#fin_user_name_col#}","width":"80","dataIndex":"FIN_USER_NAME","titleAlign":"center","itemId":"fin_user_name_col"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#audit_date_col#}","width":"90","dataIndex":"AUDIT_DATE","titleAlign":"center","itemId":"audit_date_col"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#audit_status_desc_col#}","width":"100","dataIndex":"AUDIT_STATUS_DESC","titleAlign":"center","itemId":"audit_status_desc_col"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#verifier_name_col#}","width":"120","dataIndex":"VERIFIER_NAME","titleAlign":"center","itemId":"verifier_name_col"},"children":[],"expanded":false,"type":"column"}],"expanded":false,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}