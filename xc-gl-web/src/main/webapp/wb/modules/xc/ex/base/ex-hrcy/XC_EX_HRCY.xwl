{"inframe":false,"title":"","hidden":false,"roles":{"default":1},"children":[{"configs":{"loginRequired":"false","serverScript":"//引入对应的json\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,'xc/ex/base/ex-hrcy/json/XC_EX_HRCY');","itemId":"module"},"events":{"initialize":"  var hrcy_id;"},"children":[{"configs":{"itemId":"stores"},"children":[{"configs":{"autoLoad":"true","itemId":"storeYN","url":"m?xwl=xc/ex/base/ex-hrcy/XC_EX_HRCYDB/myselectYN"},"children":[],"expanded":false,"type":"store"},{"configs":{"autoLoad":"true","itemId":"storeHrcyIdAndName","url":"m?xwl=xc/ex/base/ex-hrcy/XC_EX_HRCYDB/selectHrcyIdAndName"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"folder"},{"configs":{"height":"260","width":"560","layout":"form","closeAction":"hide","dialog":"true","border":"false","itemId":"window1","modal":"true"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"column","margin":"20 0 0 0 ","border":"false","itemId":"tr1"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","border":"false","itemId":"tr1_1"},"children":[{"configs":{"labelWidth":"50","height":"22","allowBlank":"false","width":"130","margin":"0 0 0 16","labelAlign":"right","itemId":"hrcyCode","fieldLabel":"<font color=\"red\">*<\/font>{#code#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","border":"false","itemId":"tr1_2"},"children":[{"configs":{"labelWidth":"60","height":"22","allowBlank":"false","width":"190","labelAlign":"right","itemId":"hrcyName","fieldLabel":"<font color=\"red\">*<\/font>{#name#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","margin":"0 0 0 10","border":"false","itemId":"tr1_3"},"children":[{"configs":{"labelWidth":"80","height":"22","allowBlank":"false","store":"app.storeYN","displayField":"VAL_NAME","width":"150","value":"Y","valueField":"VAL_CODE","labelAlign":"right","itemId":"hrcyEnable","fieldLabel":"<font color=\"red\">*<\/font>{#enable#}","editable":"false"},"children":[],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","margin":"10 0 0 25","border":"false","itemId":"tr2"},"children":[{"configs":{"labelWidth":"40","height":"100","width":"470","labelAlign":"right","itemId":"hrcyDesc","fieldLabel":"{#description#}"},"children":[],"expanded":false,"type":"textarea"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"window"},{"configs":{"title":"复制体系","height":"260","width":"440","layout":"form","closeAction":"hide","dialog":"true","itemId":"window2","modal":"true"},"events":{"ok":"  if(Ext.isEmpty(app.hrcyNamefrom.getValue())){\n   Wb.toast('请选择一条需要复制的费用项体系！');\n   app.hrcyNamefrom.focus();\n    return false;\n  }\n  if(Ext.isEmpty(app.hrcyCode2.getValue())){\n   Wb.toast('请输入费用项目体系的编码！');\n   app.hrcyCode2.focus();\n    return false;\n  }\n  if(Ext.isEmpty(app.hrcyName2.getValue())){\n   Wb.toast('请输入费用项目体系的名称！');\n   app.hrcyName2.focus();\n    return false;\n  }"},"children":[{"configs":{"tagConfigs":"baseCls:'my-panel-no-border'","margin":"10 0 0 0 ","border":"false","itemId":"tr1"},"children":[{"configs":{"labelWidth":"60","store":"app.storeHrcyIdAndName","displayField":"EX_HRCY_NAME","width":"300","valueField":"EX_HRCY_ID","labelAlign":"right","itemId":"hrcyNamefrom","fieldLabel":"<font color=\"red\">*<\/font>{#source#}","editable":"false"},"children":[],"expanded":true,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls :'my-panel-no-boder'","layout":"column","margin":"10 0 0 0 ","border":"false","itemId":"tr2"},"children":[{"configs":{"tagConfigs":"baseCls:'my-panel-no-border'","width":"140","border":"false","itemId":"tr2_1"},"children":[{"configs":{"labelWidth":"60","width":"160","labelAlign":"right","itemId":"hrcyCode2","fieldLabel":"<font color=\"red\">*<\/font>{#code#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls:'my-panel-no-border'","width":"240","border":"false","itemId":"tr2_2"},"children":[{"configs":{"labelWidth":"70","width":"260","labelAlign":"right","itemId":"hrcyName2","fieldLabel":"<font color=\"red\">*<\/font>{#name#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls:'my-panel-no-border'","width":"340","margin":"10 0 0 0 ","border":"false","itemId":"tr3"},"children":[{"configs":{"labelWidth":"60","height":"80","width":"400","labelAlign":"right","itemId":"hrcyDesc2","fieldLabel":"{#description#}"},"children":[],"expanded":false,"type":"textarea"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"window"},{"configs":{"layout":"border","itemId":"viewport1"},"children":[{"configs":{"region":"center","multiSelect":"true","pagingBar":"true","selType":"checkboxmodel","itemId":"grid1"},"events":{"itemdblclick":"app.editBtn.fireEvent('click');"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/ex/base/ex-hrcy/XC_EX_HRCYDB/select"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"{#add#}","itemId":"addBtn","iconCls":"file_add_icon"},"events":{"click":"var win1=new Ext.window.Window(app._window1);\nwin1.show();\napp.hrcyCode.focus();\nwin1.setIconCls('file_add_icon');\nwin1.setTitle('{#addMsg1#}');\nwin1.mon(win1,'ok',function(){\n  //用户点击确认之后\n  if (!Wb.verifyGrid(app.window1)){ \n  //验证数据是否合法\n  return flase;\n  }\n  Wb.request({\n  url:'m?xwl=xc/ex/base/ex-hrcy/XC_EX_HRCYDB/insertHrcy',\n  params:{'EX_HRCY_CODE':app.hrcyCode.getValue(),'EX_HRCY_NAME':app.hrcyName.getValue(),\n          'IS_ENABLED':app.hrcyEnable.getValue(),'EX_HRCY_DESC':app.hrcyDesc.getValue()\n  },\n    success:function(){\n    win1.close();\n     Wb.toast('{#addMsg2#}');\n    app.grid1.store.load();\n    }\n    \n  });\n});\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#edit#}","itemId":"editBtn","iconCls":"file_edit_icon"},"events":{"click":"var rows=app.grid1.getSelectionModel().getSelection();\n\nif(rows.length===0||rows.length>1){\n  Wb.toast('{#editMsg1#}');\n  return false;\n}\nvar id=rows[0].data.EX_HRCY_ID;\nvar win1=new Ext.window.Window(app._window1);\nwin1.setTitle('{#editMsg2#}');\nwin1.setIconCls('file_edit_icon');\nwin1.show();\napp.hrcyName.focus();\napp.hrcyCode.setReadOnly(true);\napp.hrcyCode.setValue(rows[0].data.EX_HRCY_CODE);\napp.hrcyName.setValue(rows[0].data.EX_HRCY_NAME);\napp.hrcyEnable.setValue(rows[0].data.IS_ENABLED);\napp.hrcyDesc.setValue(rows[0].data.EX_HRCY_DESC);\nwin1.mon(win1,'ok',function(){\n  \n  Wb.request({\n  url:'m?xwl=xc/ex/base/ex-hrcy/XC_EX_HRCYDB/updateHrcy',\n  params:{\n    'EX_HRCY_ID':id,'EX_HRCY_CODE':app.hrcyCode.getValue(),'EX_HRCY_NAME':app.hrcyName.getValue(),\n   'EX_HRCY_DESC':app.hrcyDesc.getValue(),'IS_ENABLED':app.hrcyEnable.getValue()},\n   success:function(){\n    win1.close();\n    Wb.toast('{#editMsg3#}');\n    app.grid1.store.load();\n   }\n  });\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#delete#}","itemId":"delBtn","iconCls":"file_delete_icon"},"events":{"click":"var rows =app.grid1.getSelection();//所有的记录\n if(rows.length===0){\n  Wb.toast('{#editMsg1#}');\n  return false;\n  }\n Ext.Msg.confirm('{#prompt#}','{#deleteMsg1#}',function(a){\n     if(a==='yes')\n     {\n      var lineArray = [];\n    Wb.each(rows,function(r){\n    var json={'hrcy_id':r.data.EX_HRCY_ID};\n    lineArray.push(json);\n   });\n       Wb.request({\n       url:'m?xwl=xc/ex/base/ex-hrcy/XC_EX_HRCYDB/deleteHrcy',\n       params:{'destory':Wb.encode(lineArray)},\n       success:function(resp){\n       var returnobj=Wb.decode(resp.responseText);\n       if(returnobj.flag==='0'){\n         Wb.toast('{#deleteMsg2#}');\n         app.grid1.store.load();\n        return false; \n       }else{\n       Wb.toast('{#deleteMsg3#}');\n         return false;\n       }\n       }\n       });\n     }\n   else{\n     //用户取消删除操作\n    return false;\n       }\n });"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#copy#}","itemId":"copyBtn","iconCls":"copy_icon"},"events":{"click":"var rows=app.grid1.getSelection();\nif(rows.length>1){\nWb.toast('请选择一条体系进行复制！');\n  return false;\n}\nvar win1=new Ext.window.Window(app._window2);\nif(rows.length===1){\n  var a=rows[0].data.EX_HRCY_ID;\n  app.hrcyNamefrom.setValue(a);\n}\nwin1.setTitle(\"复制费用项目体系\");\nwin1.setIconCls('copy_icon');\nwin1.show();\nif(rows.length===1){\napp.hrcyNamefrom.setValue(rows[0].data.EX_HRCY_ID);\n}\nwin1.mon(win1,'ok',function(){\n  var datas;\n  //获取要复制的体系id\n  var hrcyfromid=app.hrcyNamefrom.getValue();\n  //获取复制之后的体系的信息\n  var hrcyCode=app.hrcyCode2.getValue();\n  var hrcyName=app.hrcyName2.getValue();\n  var hrcyDesc=app.hrcyDesc2.getValue();\n  //生成一条新的体系,并且得到复制之后的体系id\n  Wb.request({\n    url:'m?xwl=xc/ex/base/ex-hrcy/XC_EX_HRCYDB/copyHrcy',\n    params:{EX_HRCY_CODE:hrcyCode,EX_HRCY_NAME:hrcyName,EX_HRCY_DESC:hrcyDesc,IS_ENABLED:'Y'\n    },             \n   success:function(resp){\n     var returnobj=Wb.decode(resp.responseText);\n     if(returnobj.flag==='0'){\n       \n      //获取到复制之后的体系id\n      hrcy_id=Wb.decode(resp.responseText).EX_HRCY_ID;\n       //查看该体系下面是否含有费用项\n  Wb.request({\n    url:'m?xwl=xc/ex/base/ex-hrcy/XC_EX_HRCYDB/validateHrcyHaveItem',\n    params:{'EX_HRCY_ID':hrcyfromid},\n    success:function(resp){\n    if(Wb.decode(resp.responseText).total===0){\n      win1.close();\n      Wb.toast('复制完成！');\n      app.grid1.store.load();\n      return false;\n    }\n     else{\n       //要复制的体系下有费用项\n      //获取到要复制的的体系下面的费用项\n   Wb.request({\n   url:'m?xwl=xc/ex/base/ex-hrcy/XC_EX_HRCYDB/selectItemByHrcyId',\n   params:{'EX_HRCY_ID':hrcyfromid},\n   success:function(resp){\n    var returnobj = Wb.decode(resp.responseText);\n        //查询成功\n        datas=returnobj.rows;\n        //进行复制体系下面的费用项\n    Wb.request({\n    url:'m?xwl=xc/ex/base/ex-hrcy/XC_EX_HRCYDB/copyItem',\n    params:{datas:datas,EX_HRCY_ID_NEW:hrcy_id},\n    success:function(resp){\n      var returnobj=Wb.decode(resp.responseText);\n      if(returnobj.flag==='0'){\n        Wb.toast('复制完成！');\n         win1.close();\n        app.grid1.store.load();\n        return false;\n      }\n      else{\n      Wb.toast('复制失败！');\n        return false;\n      }\n    }\n    });\n\n   }\n });\n \n      \n      }\n    }\n  });\n     }else{\n     Wb.toast(\"失败了\");\n       return false;\n     }\n  \n  }   \n  });\n\n\n  \n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#stop#}","itemId":"enableBtn","iconCls":"stop_icon"},"events":{"click":"var rows =app.grid1.getSelection();//所有的记录\n if(rows.length===0){\n  Wb.toast('{#editMsg1#}');\n  return false;\n  }\nif(rows.length===1){\nif(rows[0].data.IS_ENABLED==='N'){\n  Wb.toast('{#enableMsg1#}');\n  return false;\n}\n}\n var lineArray = [];\n    Wb.each(rows,function(r){\n    var json={'hrcy_id':r.data.EX_HRCY_ID};\n    lineArray.push(json);\n   });\n       Wb.request({\n       url:'m?xwl=xc/ex/base/ex-hrcy/XC_EX_HRCYDB/disenabledHrcy',\n       params:{'destory':Wb.encode(lineArray)},\n       success:function(resp){\n       var returnobj=Wb.decode(resp.responseText);\n       if(returnobj.flag==='0'){\n         app.grid1.store.load();\n        return false; \n       }else{\n         return false;\n       }\n       }\n       });\n "},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#rowNum#}","xtype":"rownumberer","width":"50","align":"center","itemId":"rowNumCol"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"id","hidden":"true","align":"center","dataIndex":"EX_HRCY_ID","itemId":"EX_HRCY_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#code#}","width":"100","align":"left","dataIndex":"EX_HRCY_CODE","titleAlign":"center","itemId":"EX_HRCY_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#name#}","width":"200","align":"left","dataIndex":"EX_HRCY_NAME","titleAlign":"center","itemId":"EX_HRCY_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#description#}","width":"300","align":"left","dataIndex":"EX_HRCY_DESC","titleAlign":"center","itemId":"EX_HRCY_DESC_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#enable#}","hidden":"true","width":"100","align":"left","dataIndex":"IS_ENABLED","titleAlign":"center","itemId":"IS_ENABLED_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#enable#}","align":"center","width":"100","dataIndex":"IS_ENABLED_NAME","titleAlign":"center","itemId":"IS_ENABLED_NAME_COL"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}