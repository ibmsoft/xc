{"inframe":false,"title":"查看费用报销单","hidden":false,"roles":{"default":1},"children":[{"configs":{"loginRequired":"false","serverScript":"//---------------------获取当前模块语言对应的.json文件，放到request中----------------\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xc/ex/qry/ex-my-doc-qry/doc-wins/json/ex-doc-win\");\n// TODO: 单据ID\nvar exDocId = request.getParameter(\"exDocId\") ;\n// 获取审批流提供的单据ID\nvar bizId = request.getParameter(\"businessId\") ;\nif(bizId !== null && bizId !== \"\" && bizId !== undefined){\n  exDocId = bizId ;\n}\nrequest.setAttribute(\"exDocId\", exDocId) ;\n\n// TODO: 操作模式：CHECK-单据复核, 其他（审批）\nvar opMode = request.getParameter(\"opMode\");\nrequest.setAttribute(\"opMode\",opMode) ;\n\n// TODO: 如果单据ID存在, 则更新单据信息 ; 否则为新增单据信息\nif(exDocId !== null && exDocId !== \"\" && exDocId !== undefined){\n  // 加载单据信息\n  var docJson = com.xzsoft.xc.ex.util.XCEXWebBuilderUtil.getExDocById(exDocId) ;\n  // 将单据基础信息存入request\n  request.setAttribute(\"docJson\", docJson) ;\n}\n\n// TODO: 系统根路径\nrequest.setAttribute(\"ctxPath\", request.getContextPath()) ;","itemId":"module"},"events":{"initialize":"// TODO: 定义窗口对象\nExt.apply(app,{\n  initViewport:function(params){\n    Ext.apply(app, params);   \n        \n  }\n});\n"},"children":[{"configs":{"layout":"border","itemId":"viewport1"},"events":{"afterrender":"// 此时可包含单据复核查看、单据审批查看、单据签字查看等\nvar opMode = '{#opMode#}' ;\nif(opMode === 'CHECK'){ //  单据复核\n  app.CANCEL_AMT.setReadOnly(false) ;\n  app.btnAddAttch.show() ; // 附件按钮可见\n  app.formPanel.setBorder(true) ;\n  \n}else{\n  app.CANCEL_AMT.setReadOnly(true) ;\n  app.btnAddAttch.hide() ; // 附件按钮不可见\n  app.formPanel.setBorder(false) ;\n}\n\n// TODO: 初始化数据\nvar json = '{#docJson#}' ;\nif(json !== \"\" && json !== null && json !== undefined){\n  var dataJson = Wb.decode(json) ;\n  Wb.setValue(app.form, dataJson) ;\n  // 设置业务日期\n  var bizDate = dataJson.BIZ_DATE ;\n  app.BIZ_DATE.setValue(Wb.strToDate(bizDate));\n  // 计算借款余额\n  Wb.request({\n    url   : '{#ctxPath#}/borrowMoneyAction.do?method=getUserImprest',\n    async : true,\n    params: {\n      'ledgerId' : dataJson.LEDGER_ID,\n      'userId'   : dataJson.CREATED_BY\n    },\n    success:function(resp){\n      var obj = Wb.decode(resp.responseText);\n      if(!Ext.isEmpty(obj)){\n        app.LEND_AMT.setValue(obj.iaBal) ;\n      }\n    }\n  });\n}\n\n// TODO: 加载单据明细数据\napp.grid1.getStore().load() ;"},"children":[{"configs":{"region":"north","border":"false","itemId":"form"},"children":[{"configs":{"border":"false","itemId":"tbar"},"children":[{"configs":{"text":"{#addAttchBtn#}","itemId":"btnAddAttch","iconCls":"attach_icon"},"events":{"click":"// 账簿\nvar _ledgerId = app.LEDGER_ID.getValue() ;\nif(_ledgerId === \"\" || _ledgerId === null || _ledgerId === undefined){\n  Wb.toast(\"{#attchInfo3#}\") ;\n  return false ;\n}\n// 单据ID和编码\nvar ex_doc_id = app.EX_DOC_ID.getValue() ;\nvar ex_doc_code = app.EX_CAT_CODE.getValue();\nif(ex_doc_id === null || ex_doc_id === \"\" || ex_doc_id === undefined){\n  Wb.toast(\"{#saveInfo3#}\") ;\n  return false ;\n}\n\n// 获取附件分类\t\nWb.request({\n  url : '{#ctxPath#}'+'/exDocsAction.do?method=getProcAndFormsByCat',\n  timeout : 3600000,\n  params: {\n    'ledgerId' : _ledgerId,\n    'docCat'   : 'EX04'\n  },\n  success: function(resp) {\n    var response = Wb.decode(resp.responseText) ;\n    var attCat = response.ATT_CAT_CODE ;\n    if(response.flag === \"0\"){\n      if(attCat === null || attCat === \"\" || attCat === undefined){\n        Wb.toast(\"{#attchInfo5#}\") ;\n      }else{\n        // 挂载附件\n        Xip.showAttachmentManager('{#XIP.userId#}',ex_doc_id,'',attCat,ex_doc_code,'Y','Y','Y',function(){},2);\n      }\n    }else{\n      Wb.toast(response.msg) ;\n    }\n  }\n});\n"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"region":"north","layout":"column","border":"true","itemId":"formPanel"},"children":[{"configs":{"height":"40","layout":"fit","columnWidth":"1","border":"false","itemId":"t_panel"},"children":[{"configs":{"style":"fontSize:20px","html":"<b>{#acc-title#}<\/b>","margin":"10 10 10 10","labelAlign":"center","itemId":"title"},"children":[],"expanded":false,"type":"label"}],"expanded":true,"type":"panel"},{"configs":{"height":"30","layout":"column","columnWidth":"1","border":"false","itemId":"tr1"},"children":[{"configs":{"tagConfigs":"columnWidth:0.3","labelWidth":"100","readOnly":"true","allowBlank":"false","displayField":"LEDGER_NAME","valueField":"LEDGER_ID","labelAlign":"right","itemId":"LEDGER_ID","fieldLabel":"{#LEDGER_NAME#}"},"children":[{"configs":{"pageSize":"-1","itemId":"store","autoLoad":"true","url":"m?xwl=xc/com-qry/gl-ledgers/select-sec-fd-ledgers"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"},{"configs":{"tagConfigs":"columnWidth:0.4","labelWidth":"100","readOnly":"true","displayField":"ORG_NAME","valueField":"ORG_ID","labelAlign":"right","itemId":"ORG_ID","fieldLabel":"{#ORG_NAME#}"},"children":[{"configs":{"itemId":"store","autoLoad":"true","url":"m?xwl=xc/ex/common-db/query/select-ld-org"},"events":{"beforeload":"store.proxy.extraParams.ledgerId = app.LEDGER_ID.getValue() ;"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"},{"configs":{"tagConfigs":"columnWidth:0.3","labelWidth":"100","readOnly":"true","margin":"0 10 0 0","labelAlign":"right","itemId":"APPLY_EX_DOC_CODE","fieldLabel":"{#APPLY_EX_DOC_CODE#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"height":"30","layout":"column","columnWidth":"1","border":"false","itemId":"tr2"},"children":[{"configs":{"tagConfigs":"columnWidth:0.3","labelWidth":"100","readOnly":"true","labelAlign":"right","itemId":"EX_DOC_CODE","fieldLabel":"{#EX_DOC_CODE#}"},"children":[],"expanded":false,"type":"text"},{"configs":{"tagConfigs":"columnWidth:0.4","labelWidth":"100","readOnly":"true","labelAlign":"right","itemId":"CREATED_BY_NAME","fieldLabel":"{#CREATED_BY_NAME#}"},"children":[],"expanded":true,"type":"text"},{"configs":{"tagConfigs":"columnWidth:0.3","labelWidth":"100","readOnly":"true","allowBlank":"false","margin":"0 10 0 0","labelAlign":"right","itemId":"BIZ_DATE","fieldLabel":"{#BIZ_DATE#}","editable":"false"},"children":[],"expanded":false,"type":"date"}],"expanded":true,"type":"panel"},{"configs":{"height":"30","layout":"column","columnWidth":"1","border":"false","itemId":"tr3"},"children":[{"configs":{"tagConfigs":"columnWidth:0.3","labelWidth":"100","readOnly":"true","labelAlign":"right","itemId":"DEPT_NAME","fieldLabel":"{#DEPT_NAME#}"},"children":[],"expanded":false,"type":"text"},{"configs":{"tagConfigs":"columnWidth:0.7","labelWidth":"100","readOnly":"true","margin":"0 10 0 0","labelAlign":"right","itemId":"PROJECT_NAME","fieldLabel":"{#PROJECT_NAME#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"height":"30","layout":"column","columnWidth":"1","border":"false","itemId":"tr4"},"children":[{"configs":{"tagConfigs":"columnWidth:1","labelWidth":"100","readOnly":"true","margin":"0 10 0 0","labelAlign":"right","itemId":"EX_REASON","fieldLabel":"{#TRA_EX_REASON#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"height":"30","layout":"column","columnWidth":"1","margin":"0 0 10 0","border":"false","itemId":"tr5"},"children":[{"configs":{"tagConfigs":"columnWidth:0.3,regex:/^\\d*\\.{0,1}\\d{0,2}$/","labelWidth":"100","readOnly":"true","decimalPrecision":"2","minValue":"0","labelAlign":"right","itemId":"AMOUNT","fieldLabel":"{#TRA_AMONNT#}"},"children":[],"expanded":false,"type":"number"},{"configs":{"tagConfigs":"columnWidth:0.4,regex:/^\\d*\\.{0,1}\\d{0,2}$/","labelWidth":"100","readOnly":"true","decimalPrecision":"2","minValue":"0","labelAlign":"right","itemId":"LEND_AMT","fieldLabel":"{#LEND_AMONNT1#}"},"children":[],"expanded":false,"type":"number"},{"configs":{"tagConfigs":"columnWidth:0.3,regex:/^\\d*\\.{0,1}\\d{0,2}$/","labelWidth":"100","readOnly":"true","decimalPrecision":"2","minValue":"0","margin":"0 10 0 0","labelAlign":"right","itemId":"CANCEL_AMT","fieldLabel":"{#CANCEL_AMT#}"},"events":{"blur":"// TODO: 单据复核时将核销金额返回调用界面\nvar opMode = '{#opMode#}' ;\nif(opMode === 'CHECK'){ //  单据复核\n  if(typeof app.getCancelAmt == 'function'){\n    app.getCancelAmt(number.getValue(),app.EX_REASON.getValue()) ;\n  }\n}"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"panel"},{"configs":{"hidden":"true","itemId":"h_panel"},"children":[{"configs":{"readOnly":"true","hidden":"true","itemId":"EX_CAT_CODE","fieldLabel":"单据分类"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"EX_DOC_ID","fieldLabel":"单据ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"INS_CODE","fieldLabel":"流程实例编码"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"APPLY_EX_DOC_ID","fieldLabel":"费用申请单ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"readOnly":"true","hidden":"true","itemId":"CREATED_BY","fieldLabel":"申请人ID"},"children":[],"expanded":true,"type":"text"},{"configs":{"hidden":"true","itemId":"DEPT_ID","fieldLabel":"成本中心ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"PROJECT_ID","fieldLabel":"PA项目ID"},"children":[],"expanded":false,"type":"text"}],"expanded":false,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"form"},{"configs":{"region":"center","columnLines":"true","pagingBar":"false","multiSelect":"false","forceFit":"true","border":"false","itemId":"grid1","simpleSelect":"false","editable":"false"},"children":[{"configs":{"pageSize":"-1","autoLoad":"false","itemId":"store","url":"m?xwl=xc/ex/qry/ex-my-doc-qry/data/select-ex-doc-dtls"},"events":{"beforeload":"store.proxy.extraParams.exDocId = '{#exDocId#}' ;"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#ORDERBY#}","align":"center","width":"50","xtype":"rownumberer","titleAlign":"center","itemId":"rownum"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"明细ID","hidden":"true","dataIndex":"EX_DTL_ID","titleAlign":"center","itemId":"EX_DTL_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"单据ID","hidden":"true","dataIndex":"EX_DOC_ID","titleAlign":"center","itemId":"EX_DOC_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"费用项ID","hidden":"true","dataIndex":"EX_ITEM_ID","titleAlign":"center","itemId":"EX_ITEM_ID_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#EX_ITEM_NAME#}","width":"250","dataIndex":"EX_ITEM_NAME","titleAlign":"center","itemId":"EX_ITEM_NAME_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"预算项ID","hidden":"true","dataIndex":"BG_ITEM_ID","titleAlign":"center","itemId":"BG_ITEM_ID_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#BG_ITEM_NAME#}","width":"200","dataIndex":"BG_ITEM_NAME","titleAlign":"center","itemId":"BG_ITEM_NAME_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#AMOUNT#}","align":"right","width":"120","dataIndex":"EX_DTL_AMT","format":"0,000.00","titleAlign":"center","itemId":"EX_DTL_AMT_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#DOC_NUM_COL#}","width":"80","align":"center","dataIndex":"DOC_NUM","titleAlign":"center","itemId":"DOC_NUM_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#EX_DTL_DESC_COL#}","width":"250","dataIndex":"EX_DTL_DESC","titleAlign":"center","itemId":"EX_DTL_DESC_COL"},"children":[],"expanded":true,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":"preview_icon"}