{"inframe":false,"title":"","hidden":false,"roles":{"default":1},"children":[{"configs":{"serverScript":"var userId = request.getSession().getAttribute(\"XzSessionVars\").get('userId');\n\nvar protocol = request.getProtocol() ;\nvar ipAddr = request.getServerName();\nvar port = request.getServerPort() ;\nvar ctxPath = request.getContextPath() ;\n\nvar pp = protocol.substr(0,5) ;\nprotocol = (pp.indexOf(\"https\") == -1 ? \"http\" : \"https\") ;\n\nvar url = protocol + \"://\" + ipAddr +\":\" + port + ctxPath ;\n\nrequest.setAttribute('contextPath',ctxPath);\nrequest.setAttribute(\"userId\",userId);\nrequest.setAttribute(\"appIP\",url);\nvar appId = request.getSession().getAttribute(\"XzSessionVars\").get('appId');\nrequest.setAttribute(\"funId\",request.getParameter('funId'));\nrequest.setAttribute(\"appId\",request.getParameter('appId'));\n\n//---------------------获取当前模块语言对应的.json文件，放到request中----------------\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xc/po/pur/json/xc_po_pur_ap_h\");\n// var userId = request.getSession().getAttribute(\"XzSessionVars\").get('userId');\n// request.setAttribute('userId',userId);\n// var contextPath = request.getContextPath();\n// request.setAttribute(\"contextPath\",contextPath);","itemId":"module"},"events":{"finalize":"function clearOtherFn(type){\n  if(type=='xip_pub_orgs'){\n    \n  }else if(type==='xc_ap_vendors'){\n   \n  }else if(type==='xip_pub_depts'){\n    app.QUERY_PROJECT_NAME.QUERY_DEPT_ID.setValue('');\n  }\n\n}\n\nfunction returnRowFn(r,type){\n  if(type=='xip_pub_orgs'){\n    app.PROJECT_NAME.QUERY_LEDGER_ID.setValue(r.data.LEDGER_ID);\n    app.DEPT_NAME.QUERY_LEDGER_ID.setValue(r.data.LEDGER_ID);\n  }else if(type==='xc_ap_vendors'){\n\n  }else if(type==='xc_pm_projects'){\n\n  }else if(type==='xip_pub_depts'){\n    app.PROJECT_NAME.QUERY_DEPT_ID.setValue(r.data.DEPT_ID);\n    app.PROJECT_NAME.PROJECT_ID.setValue('');\n    app.PROJECT_NAME.PROJECT_NAME.setValue('');\n  }else if(type=='xc_ap_emp'){\n    \n  }\n}","initialize":"var deleteIds = [];\nExt.apply(app,{\n  initWin:function(params){\n    Ext.apply(app,params);\n    //app.showWin.show();\n    app.win = new Ext.window.Window(app.showWin);\n    app.win.show();\n    var flag = params.flag;\n    if(flag=='insert'){//添加时\n      app.showWin.setTitle('{#po_pur_add#}');\n      app.saveBtn.setDisabled(false);\n      app.submitBtn.setDisabled(true);\n      app.revokeBtn.setDisabled(true);\n      \n      app.purLGrid.store.load();\n      var vstore = app.ORG_NAME.ORG_NAME.getPicker().getStore();\n      vstore.load({\n        callback:function(){\n          app.ORG_NAME.ORG_NAME.setValue(vstore.getAt(0).get('ORG_NAME'));\n          app.ORG_NAME.ORG_ID.setValue(vstore.getAt(0).get('ORG_ID'));\n          app.ORG_NAME.LEDGER_ID.setValue(vstore.getAt(0).get('LEDGER_ID'));\n          app.PROJECT_NAME.QUERY_LEDGER_ID.setValue(vstore.getAt(0).get('LEDGER_ID'));\n          app.DEPT_NAME.QUERY_LEDGER_ID.setValue(vstore.getAt(0).get('LEDGER_ID'));\n          var curDate = new Date();\n          app.DOCUMENT_DATE.setValue(Ext.Date.format(curDate,'Y-m-d'));\n          app.CREATED_BY_NAME.setValue('{#XIP.empName#}');\n          app.AUDIT_STATUS.setValue('A');\n          app.AUDIT_STATUS_DESC.setValue('{#po_pur_write_out#}');\n          app.SYS_AUDIT_STATUS.setValue('A');\n          app.SYS_AUDIT_STATUS_DESC.setValue('{#po_pur_draft#}');\n          app.PUR_AP_H_ID.setValue(Xip.getId());\n          app.IS_CLOSE.setValue('N');\n          app.PO_DOC_CAT_CODE.setValue('CGSQ');\n\n        }\n      });\n    }else if(flag=='edit'){//修改时\n      app.showWin.setTitle('{#po_pur_edit#}');\n      app.saveBtn.setDisabled(false);\n      app.submitBtn.setDisabled(false);\n      app.revokeBtn.setDisabled(false);\n      \n      var PUR_AP_H_ID = params.PUR_AP_H_ID;\n      Wb.request({\n        url:'m?xwl=xc/po/pur/data/getPurHDataById',\n        params:{'PUR_AP_H_ID':PUR_AP_H_ID},\n        success:function(resp){\n          var rec = Wb.decode(resp.responseText);\n          var ledgerId = rec.rows[0].LEDGER_ID;\n          app.ORG_NAME.LEDGER_ID.setValue(ledgerId);\n          app.PROJECT_NAME.QUERY_LEDGER_ID.setValue(ledgerId);\n          app.DEPT_NAME.QUERY_LEDGER_ID.setValue(ledgerId);\n          Wb.setValue(app.contentForm,rec.rows[0]);\n          app.DOCUMENT_DATE.setValue(rec.rows[0].start);\n\n        }\n      });\n\n      app.purLGrid.store.load({params:{'purApHId':PUR_AP_H_ID}});\n    }\n  }\n});"},"children":[{"configs":{"maximized":"true","layout":"border","closeAction":"hide","buttonAlign":"center","border":"false","itemId":"showWin","modal":"true"},"events":{"afterrender":"app.ORG_NAME.ORG_NAME.setLabelWidth(100);\napp.DEPT_NAME.DEPT_NAME.setLabelWidth(100);\n//app.DEPT_NAME.USER_ID.setValue('{#XIP.userId#}');","close":"app.vstore.reload();"},"children":[{"configs":{"region":"north","layout":"auto","border":"false","itemId":"contentForm"},"children":[{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"{#po_pur_save#}","itemId":"saveBtn","iconCls":"save_icon"},"events":{"click":"//验证表单、表格是否合法\nif(!Wb.verify(app.contentForm)){\n  Wb.toast('{#po_pur_illegal_data#}');\n  return;\n}\nif(!Wb.verifyGrid(app.purLGrid)){\n  Wb.toast('{#po_pur_illegal_data#}');\n  return;\n}\n\nvar vgrid = app.purLGrid;\nif(vgrid.getStore().getCount()===0){\n  Wb.toast('{#po_pur_detail_null#}');\n  return;\n}\n\n//计算（合计）行数据金额\nvar amount = 0;\nfor(var i=0;i<vgrid.getStore().getCount();i++){\n  amount += vgrid.getStore().getAt(i).get('AMOUNT');\n}\napp.AMOUNT.setValue(Wb.format(amount,'000.00'));//采购申请金额\n\n\nWb.request({\n  url:'{#contextPath#}'+'/poPurApHAction.do?method=saveInfo',//保存数据\n  params:{'formStr':Wb.getValue(app.contentForm),'gridStr':Wb.getData(vgrid),'deleteIds':deleteIds},\n  success:function(resp){\n    var rec = Wb.decode(resp.responseText);\n    if(rec.flag=='0'){\n      Wb.toast('{#po_pur_save_success#}');\n      app.saveBtn.setDisabled(false);\n      app.submitBtn.setDisabled(false);\n      app.revokeBtn.setDisabled(false);\n      vgrid.store.commitChanges();\n      var a = Ext.getCmp('PUR_AP_H_ID');\n      console.log(a);\n      Wb.request({\n        url:'m?xwl=xc/po/pur/data/getPurHDataById',\n        params:{'PUR_AP_H_ID':app.PUR_AP_H_ID.getValue()},\n        success:function(resp){\n          var rec = Wb.decode(resp.responseText);\n          app.PUR_AP_H_CODE.setValue(rec.rows[0].PUR_AP_H_CODE);\n        }\n      });\n    }else if(rec.flag=='1'){\n      Wb.toast(rec.msg);\n    }\n  }\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#po_pur_submit#}","itemId":"submitBtn","iconCls":"up_icon"},"events":{"click":"if(app.AUDIT_STATUS.getValue()=='C'||app.AUDIT_STATUS.getValue()=='E'){\n  Wb.toast('{#po_pur_can_not_submit#}');\n  return;\n}\nelse {\n\n  var ledgerId = app.ORG_NAME.LEDGER_ID.getValue(); // 账簿\n  var apDocCatCode = 'CGSQ'; // 单据类型\n  var deptId = app.DEPT_NAME.DEPT_ID.getValue();\n  var deptName = app.DEPT_NAME.DEPT_NAME.getValue();\n  var projectId = app.PROJECT_NAME.PROJECT_ID.getValue();\n  var orgId = app.ORG_NAME.ORG_ID.getValue();\n  var auditStatus = app.AUDIT_STATUS.getValue();\n  var amount = app.AMOUNT.getValue();\n  \n  // TODO: 取得流程编码、电脑端审批表单和移动端审批表单\n  Wb.request({\n    url:'{#contextPath#}'+'/apPayReqCommonAction.do?method=getProcAndFormsByCat',\n    params:{'LEDGER_ID':ledgerId,'AP_DOC_CAT_CODE':apDocCatCode},\n    success:function(res){\n      var response = Wb.decode(res.responseText);\n      if(response.flag=='0'){\n        // TODO: 取得流程编码、电脑端审批表单和移动端审批表单\n        var processCode = response.PROCESS_CODE ;\n        var pcApproveForm = response.PC_A_FORM_URL ;\n        var mobileApproveForm = response.M_A_FORM_URL ;\n        // 电脑端和移动端审批表单为变量需要设置为全路径\n        pcApproveForm = '{#appIP#}' +  '/'+pcApproveForm ;\n        mobileApproveForm = '{#appIP#}' +  mobileApproveForm ;\n        // TODO: 如果流程编码存在, 则提交流程审批处理\n        if(processCode !== \"\" && processCode !== null && processCode !== undefined){\n          // 如果项目未指定，则设置默认值为 \"-1\"\n          if (Ext.isEmpty(projectId)) {\n            projectId = '-1';\n          }\n          if(orgId===''){\n            return;\n          }\n          \n          var _empId = '{#XIP.empId#}' ;\n          var json = {\n            'APP_IP':'{#appIP#}',\n            'loginName':'{#XIP.userName#}',\n            'AP_DOC_CAT_NAME':'{#po_pur_cgsq#}',\n            'PC_A_FORM':pcApproveForm,\n            'M_A_FORM'\t:mobileApproveForm,\n            'poCatCode':apDocCatCode,\n            'DEPT_NAME':deptName,\n            'AMT':amount,\n            'e_business_id':app.PUR_AP_H_ID.getValue(),\n            'billType'\t: apDocCatCode,\n            'PROJECT_ID'   : projectId,\n            'EMP_ID'       : _empId,\n            'ledgerId'     : ledgerId,\n            'DEPT_ID'      : deptId,\n            'ORG_ID'\t: orgId\n          };\n          if(auditStatus === 'A'){//起草状态\n            XipWf.startAndSubmitByProcess(processCode,json,function(e){//提交流程\n              if(e.flag === 0 || e.flag == '0'){\n                Wb.toast('{#po_pur_submit_success#}');\n                app.INS_CODE.setValue(e.instanceCode);\n                app.saveBtn.setDisabled(true);\n                app.submitBtn.setDisabled(true);\n                app.revokeBtn.setDisabled(false);\n                \n                Wb.request({\n                  url:'m?xwl=xc/po/pur/data/getPurHDataById',\n                  params:{'PUR_AP_H_ID':app.PUR_AP_H_ID.getValue()},\n                  success:function(resp){\n                    var response = Wb.decode(resp.responseText);\n                    app.SYS_AUDIT_STATUS.setValue(response.rows[0].SYS_AUDIT_STATUS);\n                    app.SYS_AUDIT_STATUS_DESC.setValue(response.rows[0].SYS_AUDIT_STATUS_DESC);\n                    app.AUDIT_STATUS.setValue('C');\n                  }\n                });\n              }\n              else if(e.flag === 1){\n                Wb.toast(e.msg) ;\n              }else{}\n            });\n          }\n          else if(auditStatus === 'D'){//驳回状态\n            XipWf.submitInstance(app.INS_CODE.getValue(),json,function(e){//提交流程\n              if(e.flag === 0 || e.flag == '0'){\n                Wb.toast('{#po_pur_submit_success#}');\n                app.saveBtn.setDisabled(true);\n                app.submitBtn.setDisabled(true);\n                app.revokeBtn.setDisabled(false);\n                \n                app.INS_CODE.setValue(e.instanceCode);\n                app.AUDIT_STATUS.setValue('C');\n              }\n              else if(e.flag === 1){\n                Wb.toast(e.msg) ;\n              }else{}\n            });\n          }else if(auditStatus === 'R'){//撤回状态\n            // 撤回 -> 按流程实例提交流程\n            //XipWf.restartAndSubmitByProcess(rows[0].data.INS_CODE,processCode,json,function(e){\n            XipWf.restartAndSubmitByProcess(app.INS_CODE.getValue(),processCode,json,function(e){\n              if(e.flag === 0 || e.flag == '0'){\n                Wb.toast('{#po_pur_submit_success#}');\n                app.saveBtn.setDisabled(true);\n                app.submitBtn.setDisabled(true);\n                app.revokeBtn.setDisabled(false);\n                \n                app.INS_CODE.setValue(e.instanceCode);\n                app.AUDIT_STATUS.setValue('C');\n              }\n              else if(e.flag === 1){\n                Wb.toast(e.msg) ;\n              }else{}\n            },null);\n          }\n          else if(auditStatus === 'E' || auditStatus === 'C'){//运行中、结束状态\n            Wb.toast('{#po_pur_can_not_submit#}');\n            return false;\n          }\n          else{\n            Wb.toast('{#po_pur_submit_fail#}');\n            return false;\n          }\n        }\n      }else if(response.flag=='1'){\n        Wb.toast(response.msg);\n      }\n\n    }\n  });\n\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#po_pur_revoke#}","itemId":"revokeBtn","iconCls":"cancel_icon"},"events":{"click":"if(app.AUDIT_STATUS.getValue() === 'E') {\n  Wb.toast('{#po_pur_already_audited#}');\n  return;\n}\nelse if(app.AUDIT_STATUS.getValue() === 'R'){\n  Wb.toast('{#po_pur_already_revoke#}');\n  return false;\n}else if(app.AUDIT_STATUS.getValue() === 'A'){\n  Wb.toast('{#po_pur_draft_status#}');\n  return false;\n}else if(app.AUDIT_STATUS.getValue() === 'D'){\n  Wb.toast('{#po_pur_draft_status#}');\n  return false;\n} else if(app.INS_CODE.getValue() === null || app.INS_CODE.getValue() === '') {\n  Wb.toast('{#po_pur_ins_code_null#}');\n  return;\n} else {\n  //撤回流程\n  XipWf.revokeByInstance(app.INS_CODE.getValue(),function(e){\n    app.saveBtn.setDisabled(false);\n    app.submitBtn.setDisabled(false);\n    if (e.flag === 0 || e.flag == '0') {\n      Wb.toast(e.msg);//撤回成功\n      app.saveBtn.setDisabled(false);\n      app.submitBtn.setDisabled(false);\n      app.revokeBtn.setDisabled(true);\n      \n      Wb.request({\n        url:'m?xwl=xc/po/pur/data/getPurHDataById',\n        params:{'PUR_AP_H_ID':app.PUR_AP_H_ID.getValue()},\n        success:function(resp){\n          var rec = Wb.decode(resp.responseText);\n          app.AUDIT_STATUS.setValue(rec.rows[0].AUDIT_STATUS);\n          app.AUDIT_STATUS_DESC.setValue(rec.rows[0].AUDIT_STATUS_DESC);\n          app.SYS_AUDIT_STATUS.setValue(rec.rows[0].SYS_AUDIT_STATUS);\n          app.SYS_AUDIT_STATUS_DESC.setValue(rec.rows[0].SYS_AUDIT_STATUS_DESC);\n        }\n      });\n    } else {\n      Wb.toast(e.msg);//撤回失败\n    }\n\n  });\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#po_pur_monitor#}","itemId":"monitorBtn","iconCls":"viewport_icon"},"events":{"click":"if(app.INS_CODE.getValue() === null || app.INS_CODE.getValue() === ''){\n  Wb.toast('{#po_pur_ins_code_null#}');\n}\nelse{\n  XipWf.showMonitorPage(app.INS_CODE.getValue());\n}   \n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#po_pur_enclosure#}","itemId":"enClosureBtn"},"events":{"click":"var temp_id = app.PUR_AP_H_ID.getValue();//采购申请ID\nvar temp_code = 'CGSQ';\nWb.request({\n\turl:'{#contextPath#}'+'/poCommonAction.do?method=getProcAndFormsByCat',\n  \tparams:{'ledgerId':app.ORG_NAME.LEDGER_ID.getValue(),'docCat':'CGSQ'},\n  \tsuccess:function(resp){\n      var rec = Wb.decode(resp.responseText);\n      if(rec.flag=='0'){\n        var attCatCode = rec.attCatCode;\n        Xip.showAttachmentManager('{#XIP.userId#}',temp_id,'',attCatCode,temp_code,'Y','Y','Y',function(){},10);\n      }else{\n      \tWb.toast('{#po_pur_doc_cat#}'+temp_code+'{#po_pur_enclosure_no_set#}');\n      }\n    }\n});\n"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"layout":"column","margin":"10 10 0 0","border":"false","itemId":"tr1"},"children":[{"configs":{"layout":"fit","columnWidth":".25","border":"false","itemId":"td1_1"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/ORG_PICK/ORG_ALL_PICK","itemId":"ORG_NAME"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".25","border":"false","itemId":"td1_2"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/DEPT_ID_PICK/DEPT_ID_LD","itemId":"DEPT_NAME"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".25","border":"false","itemId":"td1_3"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/PROJECT_ID_PICK/PROJECT_ID_LD","itemId":"PROJECT_NAME"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".25","border":"false","itemId":"td1_4"},"children":[{"configs":{"labelWidth":"100","format":"Y-m-d","labelAlign":"right","itemId":"DOCUMENT_DATE","fieldLabel":"{#po_pur_doc_date#}"},"children":[],"expanded":false,"type":"date"}],"expanded":true,"type":"panel"}],"expanded":false,"type":"panel"},{"configs":{"layout":"column","margin":"10 10 0 0","border":"false","itemId":"tr2"},"children":[{"configs":{"layout":"fit","columnWidth":".25","border":"false","itemId":"td2_1"},"children":[{"configs":{"labelWidth":"100","readOnly":"true","labelAlign":"right","itemId":"PUR_AP_H_CODE","fieldLabel":"{#po_pur_code#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".25","border":"false","itemId":"td3_11"},"children":[{"configs":{"labelWidth":"100","readOnly":"true","labelAlign":"right","itemId":"AMOUNT","fieldLabel":"{#po_pur_amount#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".25","border":"false","itemId":"td2_3"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"CREATED_BY_NAME","fieldLabel":"{#po_pur_creat_by#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".25","border":"false","itemId":"td3_1"},"children":[{"configs":{"labelWidth":"100","readOnly":"true","labelAlign":"right","itemId":"SYS_AUDIT_STATUS_DESC","fieldLabel":"{#po_pur_status#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":false,"type":"panel"},{"configs":{"layout":"column","margin":"10 10 10 0","border":"false","itemId":"tr3"},"children":[{"configs":{"layout":"fit","columnWidth":".5","border":"false","itemId":"td2_2"},"children":[{"configs":{"labelWidth":"100","allowBlank":"false","labelAlign":"right","itemId":"PUR_AP_H_NAME","fieldLabel":"<font color='red'>*<\/font>{#po_pur_h_name#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":false,"type":"panel"},{"configs":{"hidden":"true","itemId":"hiddenPanel"},"children":[{"configs":{"itemId":"CREATED_BY"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"AUDIT_STATUS"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"SYS_AUDIT_STATUS"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"INS_CODE"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"100","readOnly":"true","labelAlign":"right","itemId":"AUDIT_STATUS_DESC","fieldLabel":"{#po_pur_status#}"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"100","readOnly":"true","labelAlign":"right","itemId":"IS_CLOSE","fieldLabel":"IS_CLOSE"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"100","readOnly":"true","labelAlign":"right","itemId":"PO_DOC_CAT_CODE","fieldLabel":"PO_DOC_CAT_CODE"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"100","readOnly":"true","labelAlign":"right","itemId":"PUR_AP_H_ID","fieldLabel":"PUR_AP_H_ID"},"children":[],"expanded":false,"type":"text"}],"expanded":false,"type":"panel"}],"expanded":true,"type":"form"},{"configs":{"region":"center","selType":"checkboxmodel","itemId":"purLGrid","editable":"true"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/po/pur/data/getPurLData"},"events":{"remove":"deleteIds.push({'id':record.data.PUR_AP_L_ID});"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"{#po_pur_add#}","itemId":"addBtn","iconCls":"file_add_icon"},"events":{"click":"var vgrid = app.purLGrid;\nvar ledgerId = app.ORG_NAME.LEDGER_ID.getValue();\nif(Wb.isEmpty(ledgerId)){\n  Wb.toast('{#po_pur_first_select_org#}');\n  return;\n}\nWb.run({\n  url:'m?xwl=xc/po/pur/xc_po_pur_ap_material',\n  success:function(app){\n    app.initWin({\n      ledgerId:ledgerId,\n      hideFun:function(rs){\n        Wb.each(rs,function(r){\n          r.set('PUR_AP_L_ID',Xip.getId());\n          var vstore = vgrid.store;\n          for(var i=0;i<vstore.getCount();i++){\n            var vr = vstore.getAt(i);\n            if(vr.get('MATERIAL_ID')==r.get('MATERIAL_ID')){\n              Wb.toast('{#po_pur_material_is_exist#}');\n              return;\n            }\n          }\n          Wb.add(vgrid,{\n            PUR_AP_L_ID:r.get('PUR_AP_L_ID'),\n            MATERIAL_ID:r.get('MATERIAL_ID'),\n            MATERIAL_NAME:r.get('MATERIAL_NAME'),\n            MATERIAL_CODE:r.get('MATERIAL_CODE'),\n            DIM_NAME:r.get('DIM_NAME'),\n            DIM_ID:r.get('DIM_ID'),\n            PRICE:r.get('PURCHASE_PRICE')\n          },'after',1,false);\n\n        });\n      }\n    });\n  }\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item1"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#po_pur_delete#}","itemId":"delBtn","iconCls":"file_delete_icon"},"events":{"click":"Wb.remove(app.purLGrid);"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#po_pur_rowNum#}","xtype":"rownumberer","width":"50","align":"center","titleAlign":"center","itemId":"rowNum"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#po_pur_l_id#}","hidden":"true","dataIndex":"PUR_AP_L_ID","titleAlign":"center","itemId":"PUR_AP_L_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#po_pur_material_id#}","hidden":"true","dataIndex":"MATERIAL_ID","titleAlign":"center","itemId":"MATERIAL_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#po_pur_material_code#}","dataIndex":"MATERIAL_CODE","titleAlign":"center","itemId":"MATERIAL_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#po_pur_material_name#}","dataIndex":"MATERIAL_NAME","titleAlign":"center","itemId":"MATERIAL_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#po_pur_dim#}","dataIndex":"DIM_NAME","titleAlign":"center","itemId":"DIM_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"DIM_CODE","hidden":"true","dataIndex":"DIM_CODE","titleAlign":"center","itemId":"DIM_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"<font color='red'>*<\/font>{#po_pur_qty#}","align":"right","dataIndex":"QTY","titleAlign":"center","itemId":"QTY_COL"},"children":[{"configs":{"allowBlank":"false","itemId":"editor"},"events":{"change":"var rec = app.purLGrid.getSelection()[0];\nrec.set('AMOUNT',newValue * rec.data.PRICE);"},"children":[],"expanded":false,"type":"number"}],"expanded":false,"type":"column"},{"configs":{"text":"<font color='red'>*<\/font>{#po_pur_price#}","align":"right","dataIndex":"PRICE","titleAlign":"center","itemId":"PRICE_COL","renderer":"return Wb.format(value,'0,000.00');"},"children":[{"configs":{"allowBlank":"false","itemId":"editor"},"events":{"change":"var rec = app.purLGrid.getSelection()[0];\nrec.set('AMOUNT',newValue * rec.data.QTY);"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"column"},{"configs":{"text":"{#po_pur_expect_amount#}","align":"right","dataIndex":"AMOUNT","titleAlign":"center","itemId":"AMOUNT_COL","renderer":"return Wb.format(value,'0,000.00');"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"<font color='red'>*<\/font>{#po_pur_need_time#}","dataIndex":"REQUIRED_DATE","format":"Y-m-d","titleAlign":"center","itemId":"REQUIRED_DATE_COL"},"children":[{"configs":{"allowBlank":"false","value":"new Date()","itemId":"editor"},"children":[],"expanded":false,"type":"date"}],"expanded":false,"type":"column"},{"configs":{"text":"{#po_pur_purchase_reason#}","dataIndex":"PURCHASE_REASON","titleAlign":"center","itemId":"PURCHASE_REASON_COL"},"children":[{"configs":{"height":"50","itemId":"editor"},"children":[],"expanded":false,"type":"textarea"}],"expanded":true,"type":"column"},{"configs":{"text":"是否订货","dataIndex":"IS_ORDERED","titleAlign":"center","itemId":"IS_ORDERED_COL","renderer":"if(value == 1 || value == '1'){\n  return '是';\n} else {\n  return '否';\n}"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":false,"type":"grid"}],"expanded":true,"type":"window"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}