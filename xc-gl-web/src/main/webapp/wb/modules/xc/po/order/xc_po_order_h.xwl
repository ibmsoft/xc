{"inframe":false,"title":"","hidden":false,"roles":{"default":1},"children":[{"configs":{"loginRequired":"false","serverScript":"var userId = request.getSession().getAttribute(\"XzSessionVars\").get('userId');\n\nvar protocol = request.getProtocol() ;\nvar ipAddr = request.getServerName();\nvar port = request.getServerPort() ;\nvar ctxPath = request.getContextPath() ;\n\nvar pp = protocol.substr(0,5) ;\nprotocol = (pp.indexOf(\"https\") == -1 ? \"http\" : \"https\") ;\n\nvar url = protocol + \"://\" + ipAddr +\":\" + port + ctxPath ;\n\nrequest.setAttribute('contextPath',ctxPath);\nrequest.setAttribute(\"userId\",userId);\nrequest.setAttribute(\"appIP\",url);\nvar appId = request.getSession().getAttribute(\"XzSessionVars\").get('appId');\nrequest.setAttribute(\"funId\",request.getParameter('funId'));\nrequest.setAttribute(\"appId\",request.getParameter('appId'));\n//---------------------获取当前模块语言对应的.json文件，放到request中----------------\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xc/po/order/json/xc_po_order_h\");","itemId":"module"},"events":{"finalize":"function clearOtherFn(type){\n  if(type=='xip_pub_orgs'){\n\n  }else if(type==='xc_ap_vendors'){\n\n  }else if(type==='xip_pub_depts'){\n\n  }\n\n}\n\nfunction returnRowFn(r,type){\n  if(type=='xip_pub_orgs'){\n    var ledgerId = r.data.LEDGER_ID;\n    app.QUERY_VENDOR_NAME.QUERY_LEDGER_ID.setValue(ledgerId);\n    app.QUERY_PURCHASE_DEPT_NAME.QUERY_LEDGER_ID.setValue(ledgerId);\n    app.QUERY_DEPT_NAME.QUERY_LEDGER_ID.setValue(ledgerId);\n    app.QUERY_PROJECT_NAME.QUERY_LEDGER_ID.setValue(ledgerId);\n    app.queryBtn.fireEvent('click');\n  }else if(type==='xc_ap_vendors'){\n    app.queryBtn.fireEvent('click');\n  }else if(type==='xc_pm_projects'){\n    app.QUERY_DEPT_NAME.DEPT_ID.setValue(r.data.DEPT_ID);\n    app.QUERY_DEPT_NAME.DEPT_NAME.setValue(r.data.DEPT_NAME);\n    app.queryBtn.fireEvent('click');\n  }else if(type==='xip_pub_depts'){\n    app.QUERY_PROJECT_NAME.QUERY_DEPT_ID.setValue(r.data.DEPT_ID);\n    app.QUERY_PROJECT_NAME.PROJECT_ID.setValue('');\n    app.QUERY_PROJECT_NAME.PROJECT_NAME.setValue('');\n    app.queryBtn.fireEvent('click');\n  }else if(type=='xc_ap_emp'){\n    app.queryBtn.fireEvent('click');\n  }\n}"},"children":[{"configs":{"layout":"border","itemId":"viewport1"},"events":{"afterrender":"app.QUERY_ORG_NAME.ORG_NAME.setLabelWidth(100);//设置组织的labelWidth\n\napp.QUERY_VENDOR_NAME.VENDOR_NAME.setLabelWidth(100);//设置供应商的labelWidth\napp.QUERY_VENDOR_NAME.VENDOR_NAME.setFieldLabel('{#po_order_vendor#}');\napp.QUERY_VENDOR_NAME.VENDOR_NAME.allowBlank = true;\n\napp.QUERY_PURCHASE_DEPT_NAME.DEPT_NAME.setLabelWidth(100);//设置采购部门的labelWidth\napp.QUERY_PURCHASE_DEPT_NAME.DEPT_NAME.setFieldLabel('{#po_order_purchase_name#}');\napp.QUERY_PURCHASE_DEPT_NAME.DEPT_NAME.allowBlank = true;\n\napp.QUERY_DEPT_NAME.DEPT_NAME.setLabelWidth(100);//成本中心labelWidth\napp.QUERY_DEPT_NAME.DEPT_NAME.setFieldLabel('{#po_order_department#}');\napp.QUERY_DEPT_NAME.DEPT_NAME.allowBlank = true;\n\napp.QUERY_PROJECT_NAME.PROJECT_NAME.setLabelWidth(100);//项目labelWidth\n\nvar orgStore = app.QUERY_ORG_NAME.ORG_NAME.getPicker().store;\n// 加载组织\norgStore.load({\n  callback:function(resp){\n    var orgId = orgStore.getAt(0).get('ORG_ID');\n    var orgCode = orgStore.getAt(0).get('ORG_CODE');\n    var orgName = orgStore.getAt(0).get('ORG_NAME');\n    var ledgerId = orgStore.getAt(0).get('LEDGER_ID');\n    var ledgerName = orgStore.getAt(0).get('LEDGER_NAME');\n\n    app.QUERY_ORG_NAME.ORG_ID.setValue(orgId);\n    app.QUERY_ORG_NAME.ORG_CODE.setValue(orgCode);\n    app.QUERY_ORG_NAME.ORG_NAME.setValue(orgName);\n    app.QUERY_ORG_NAME.LEDGER_ID.setValue(ledgerId);\n    app.QUERY_ORG_NAME.LEDGER_NAME.setValue(ledgerName);\n    \n    app.QUERY_ORG_NAME.LEDGER_ID.setValue(ledgerId);\n    app.QUERY_VENDOR_NAME.QUERY_LEDGER_ID.setValue(ledgerId);\n    app.QUERY_PURCHASE_DEPT_NAME.QUERY_LEDGER_ID.setValue(ledgerId);\n    app.QUERY_DEPT_NAME.QUERY_LEDGER_ID.setValue(ledgerId);\n    app.QUERY_PROJECT_NAME.QUERY_LEDGER_ID.setValue(ledgerId);\n    app.queryBtn.fireEvent('click');\n  }\n});"},"children":[{"configs":{"region":"north","layout":"auto","border":"false","itemId":"queryForm"},"children":[{"configs":{"layout":"column","margin":"10 10 0 0","border":"false","itemId":"tr1"},"children":[{"configs":{"layout":"fit","columnWidth":".25","border":"false","itemId":"td1_1"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/ORG_PICK/ORG_ALL_PICK","itemId":"QUERY_ORG_NAME"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".25","border":"false","itemId":"td1_2"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/VENDOR_ID_PICK/VENDOR_ID_LD","itemId":"QUERY_VENDOR_NAME"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".25","border":"false","itemId":"td1_3"},"children":[{"configs":{"labelWidth":"100","labelAlign":"right","itemId":"QUERY_CONTRACT_CODE","fieldLabel":"{#po_order_contract_code_name#}"},"events":{"specialkey":"if (e.getKey() == '13') {\n  app.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".25","border":"false","itemId":"td1_4"},"children":[{"configs":{"labelWidth":"100","labelAlign":"right","itemId":"QUERY_ORDER_H_CODE","fieldLabel":"{#po_order_order_code#}"},"events":{"specialkey":"if (e.getKey() == '13') {\n  app.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":false,"type":"panel"},{"configs":{"layout":"column","margin":"10 10 0 0","border":"false","itemId":"tr2"},"children":[{"configs":{"layout":"fit","columnWidth":".25","border":"false","itemId":"td2_2"},"children":[{"configs":{"labelWidth":"100","pickList":"[\n  ['A','{#po_order_write_out#}'],\n  ['C','{#po_order_operating#}'],\n  ['D','{#po_order_reject#}'],\n  ['R','{#po_order_revoke#}'],\n  ['E','{#po_order_audited#}']\n]\n/*\nA 起草\nC 运行中\nD 驳回\nR 撤回\nE 审批通过\n*/ ","labelAlign":"right","itemId":"QUERY_AUDIT_STATUS","fieldLabel":"{#po_order_audit_status#}"},"events":{"select":"app.queryBtn.fireEvent('click');"},"children":[],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".25","border":"false","itemId":"td2_3"},"children":[{"configs":{"labelWidth":"100","displayField":"VAL_NAME","valueField":"VAL_CODE","labelAlign":"right","itemId":"QUERY_SYS_AUDIT_STATUS","fieldLabel":"{#po_order_status#}"},"events":{"select":"app.queryBtn.fireEvent('click');"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/po/order/data/selectSysAuditStatus"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".25","border":"false","itemId":"td2_4"},"children":[{"configs":{"labelWidth":"100","labelAlign":"right","itemId":"START_DATE","fieldLabel":"{#po_order_start_date#}"},"events":{"specialkey":"if (e.getKey() == '13') {\n  app.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"date"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".25","border":"false","itemId":"td2_5"},"children":[{"configs":{"labelWidth":"100","labelAlign":"right","itemId":"END_DATE","fieldLabel":"{#po_order_end_date#}"},"events":{"specialkey":"if (e.getKey() == '13') {\n  app.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"date"}],"expanded":true,"type":"panel"}],"expanded":false,"type":"panel"},{"configs":{"layout":"column","margin":"10 10 0 0","border":"false","itemId":"tr3"},"children":[{"configs":{"layout":"fit","columnWidth":".25","border":"false","itemId":"td3_111"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/DEPT_ID_PICK/DEPT_ID_LD","itemId":"QUERY_PURCHASE_DEPT_NAME"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".25","border":"false","itemId":"td3_12"},"children":[{"configs":{"labelWidth":"100","displayField":"VAL_NAME","valueField":"VAL_CODE","labelAlign":"right","itemId":"QUERY_ORDER_H_TYPE","fieldLabel":"{#po_order_order_type#}"},"events":{"select":"app.queryBtn.fireEvent('click');"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/po/order/data/getOrderType"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".25","border":"false","itemId":"td2_31"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/DEPT_ID_PICK/DEPT_ID_LD","itemId":"QUERY_DEPT_NAME"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".25","border":"false","itemId":"td2_311"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/PROJECT_ID_PICK/PROJECT_ID_LD","itemId":"QUERY_PROJECT_NAME"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"}],"expanded":false,"type":"panel"},{"configs":{"layout":"column","margin":"10 10 10 0","border":"false","itemId":"tr4"},"children":[{"configs":{"layout":"fit","columnWidth":".25","border":"false","itemId":"td3_121"},"children":[{"configs":{"labelWidth":"100","value":"N","labelAlign":"right","pickList":"[['Y','{#po_order_yes#}'],['N','{#po_order_no#}'],['','{#po_order_all#}']]","itemId":"QUERY_IS_CLOSE","fieldLabel":"{#po_order_if_close#}"},"events":{"select":"app.queryBtn.fireEvent('click');"},"children":[],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"layout":"column","columnWidth":".25","border":"false","itemId":"td3_2"},"children":[{"configs":{"text":"{#po_order_query#}","margin":"0 0 0 105","itemId":"queryBtn","iconCls":"seek_icon"},"events":{"click":"app.orderHGrid.store.load({\n\tparams:{'ORG_ID':app.QUERY_ORG_NAME.ORG_ID.getValue(),'VENDOR_ID':app.QUERY_VENDOR_NAME.VENDOR_ID.getValue(),\n           'CONTRACT_CODE':app.QUERY_CONTRACT_CODE.getValue(),'ORDER_H_CODE':app.QUERY_ORDER_H_CODE.getValue(),\n           'AUDIT_STATUS':app.QUERY_AUDIT_STATUS.getValue(),'SYS_AUDIT_STATUS':app.QUERY_SYS_AUDIT_STATUS.getValue(),\n            'PURCHASE_DEPT_ID':app.QUERY_PURCHASE_DEPT_NAME.DEPT_ID.getValue(),'IS_CLOSE':app.QUERY_IS_CLOSE.getValue(),\n           'ORDER_H_TYPE':app.QUERY_ORDER_H_TYPE.getValue(),'startDate':app.START_DATE.getValue(),\n           'endDate':app.END_DATE.getValue(),'DEPT_ID':app.QUERY_DEPT_NAME.DEPT_ID.getValue(),'PROJECT_ID':app.QUERY_PROJECT_NAME.PROJECT_ID.getValue()}\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#po_order_reset#}","margin":"0 0 0 20","itemId":"resetBtn","iconCls":"cancel_icon"},"events":{"click":"app.queryForm.getForm().reset();"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"panel"}],"expanded":false,"type":"panel"}],"expanded":true,"type":"form"},{"configs":{"region":"center","multiSelect":"true","selType":"checkboxmodel","border":"false","itemId":"orderHGrid"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/po/order/data/selectOrderHData"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"{#po_order_add#}","itemId":"addBtn","iconCls":"file_add_icon"},"events":{"click":"var vstore = app.orderHGrid.store;\nWb.run({\n  url:'m?xwl=xc/po/order/xc_po_order_h_operate',\n  success:function(app){\n    app.initWin({\n      flag:'insert',\n      vstore:vstore\n    });\n  }\n});"},"children":[],"expanded":true,"type":"button"},{"configs":{"text":"-","itemId":"item1"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#po_order_edit#}","itemId":"editBtn","iconCls":"file_edit_icon"},"events":{"click":"var recs =app.orderHGrid.getSelection();//选中的行\nvar vstore = app.orderHGrid.store;\nif(recs.length<1){//没有选中行\n  Wb.toast('{#po_order_select_record_one#}');\n  return;\n}\nif(recs[0].data.AUDIT_STATUS=='C'||recs[0].data.AUDIT_STATUS=='E'){//审批中或审批通过\n  Wb.toast('{#po_order_not_can_edit#}');\n  return;\n}\nvar orderHId =recs[0].data.ORDER_H_ID;//采购订单ID\nWb.run({\n  url:'m?xwl=xc/po/order/xc_po_order_h_operate',//编辑界面\n  success:function(app){\n    app.initWin({\n      orderHId:orderHId,\n      flag:'edit',\n      vstore:vstore\n    });\n  }\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item2"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#po_order_delete#}","itemId":"deleteBtn","iconCls":"file_delete_icon"},"events":{"click":"var recs =app.orderHGrid.getSelection();//选中的行\nif(recs.length<1){//没选中行\n  Wb.toast('{#po_order_select_record_least_one#}');\n  return;\n}\nvar ids = [];//id数组\nvar flag = false;//是否含有非草稿状态单据\nfor(var i=0;i<recs.length;i++){\n  var id = {'ORDER_H_ID':recs[i].data.ORDER_H_ID};\n  var status = recs[i].data.AUDIT_STATUS;\n  if (status == 'R') {\n    ids.push(id);\n  } else {\n    flag = true;\n  }\n}\n\nif (flag) {\n  Wb.toast('{#fcgztdjbksc#}');\n  return false;\n}\n\nExt.Msg.confirm('{#po_order_prompt#}','{#po_order_sure_delete#}',function(btn){\n  if(btn=='yes'){\n    Wb.request({\n      url:'{#contextPath#}'+'/poOrderAction.do?method=deleteOrderHInfo',\n      params:{'ids':ids},\n      success:function(resp){\n        var response = Wb.decode(resp.responseText);\n        if(response.flag=='0'){\n          Wb.toast('{#po_order_delete_success#}');\n          app.queryBtn.fireEvent('click');\n        }else{\n          Wb.toast(response.msg);\n        }\n      }\n    });\n  }\n});\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item3"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#po_order_submit#}","itemId":"submitBtn","iconCls":"up_icon"},"events":{"click":"var rows = app.orderHGrid.getSelection();//获得选中数据\nif (!rows.length) {//选中的数据条数\n  Wb.toast('{#po_order_select_record_least_one#}');\n  return;\n}else if(rows[0].data.AUDIT_STATUS=='C'||rows[0].data.AUDIT_STATUS=='E'){\n  Wb.toast('{#po_order_not_can_submit#}');\n  return;\n}\nelse {\n  // TODO: 取得流程编码、电脑端审批表单和移动端审批表单\n  Wb.request({\n    url:'{#contextPath#}'+'/apPayReqCommonAction.do?method=getProcAndFormsByCat',\n    params:{'LEDGER_ID':rows[0].data.LEDGER_ID,'AP_DOC_CAT_CODE':'CGDD'},\n    success:function(res){\n      var response = Wb.decode(res.responseText);\n      if(response.flag=='0'){\n        // TODO: 取得流程编码、电脑端审批表单和移动端审批表单\n        var processCode = response.PROCESS_CODE ;\n        var pcApproveForm = response.PC_A_FORM_URL ;\n        var mobileApproveForm = response.M_A_FORM_URL ;\n        // 电脑端和移动端审批表单为变量需要设置为全路径\n        pcApproveForm = '{#appIP#}' +  '/'+pcApproveForm ;\n        mobileApproveForm = '{#appIP#}' +  mobileApproveForm ;\n        // TODO: 如果流程编码存在, 则提交流程审批处理\n        if(processCode !== \"\" && processCode !== null && processCode !== undefined){\n          // 如果项目未指定，则设置默认值为 \"-1\"\n          var prjId = rows[0].data.PROJECT_ID ;\n          if(prjId === null || prjId === \"\" || prjId === undefined){\n            prjId = \"-1\" ;\n          }\n          var orgId = rows[0].data.ORG_ID;\n          if(orgId===''){\n            return;\n          }\n          var auditStatus = rows[0].data.AUDIT_STATUS;\n          var _empId = '{#XIP.empId#}' ;\n          var json = {\n            'APP_IP'\t\t\t:'{#appIP#}',\n            'loginName'\t\t\t:'{#XIP.userName#}',\n            'AP_DOC_CAT_NAME'\t:'{#po_order_order_document#}',\n            'PC_A_FORM'\t\t\t:pcApproveForm,\n            'M_A_FORM'\t\t\t:mobileApproveForm,\n            'poCatCode'\t\t\t:'CGDD',\n            'DEPT_NAME'\t\t\t:rows[0].data.PURCHASE_DEPT_NAME,\n            'AMT'\t\t\t\t:rows[0].data.AMOUNT,\n            'e_business_id'\t\t:rows[0].data.ORDER_H_ID,\n            'billType'\t\t\t: 'CGDD',\n            'PROJECT_ID'\t\t: prjId,\n            'EMP_ID'\t\t\t: _empId,\n            'ledgerId'\t\t\t: rows[0].data.LEDGER_ID,\n            'DEPT_ID'\t\t\t: rows[0].data.PURCHASE_DEPT_ID,\n            'ORG_ID'\t\t\t: orgId\n          };\n          if(auditStatus === 'A'){//起草状态\n            XipWf.startAndSubmitByProcess(processCode,json,function(e){//提交流程\n              if(e.flag === 0){\n                app.queryBtn.fireEvent('click');\n                Wb.toast('{#po_order_submit_success#}');\n              }\n              else if(e.flag === 1){\n                Wb.toast(e.msg) ;\n              }else{}\n            });\n          }\n          else if(auditStatus === 'D'){//驳回状态\n            XipWf.submitInstance(rows[0].data.INS_CODE,json,function(e){//提交流程\n              if(e.flag === 0){\n                app.queryBtn.fireEvent('click');\n                Wb.toast('{#po_order_submit_success#}');\n                app.queryBtn.fireEvent('click');\n              }\n              else if(e.flag === 1){\n                Wb.toast(e.msg) ;\n              }else{}\n            });\n          }else if(auditStatus === 'R'){//撤回状态\n            // 撤回 -> 按流程实例提交流程\n            XipWf.restartAndSubmitByProcess(rows[0].data.INS_CODE,processCode,json,function(e){\n              if(e.flag === 0){\n                //app.submitButton.setDisabled(true);\n                Wb.toast('{#po_order_submit_success#}');\n                app.queryBtn.fireEvent('click');\n              }\n              else if(e.flag === 1){\n                Wb.toast(e.msg) ;\n              }else{}\n            },null);\n          }\n          else if(auditStatus === 'E' || auditStatus === 'C'){//运行中、结束状态\n            Wb.toast('{#po_order_not_can_submit#}');\n            return false;\n          }\n          else{\n            Wb.toast('{#po_order_submit_fail#}');\n            return false;\n          }\n        }\n      }else if(response.flag=='1'){\n        Wb.toast(response.msg);\n      }\n\n    }\n  });\n\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item4"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#po_order_revoke#}","itemId":"revokeBtn","iconCls":"cancel_icon"},"events":{"click":"var rows=app.orderHGrid.getSelection();\nif(rows.length != 1){\n  Wb.toast('{#po_order_select_record_one#}');\n  return;\n}\nvar autidStatus = rows[0].data.AUDIT_STATUS;\nvar insCode = rows[0].data.INS_CODE;\n\n/*\nA 起草\nC 运行中 -- 可以撤回\nD 驳回\nR 撤回\nE 审批通过\n*/ \nif (autidStatus == 'A' || Ext.isEmpty(autidStatus)) { \n  Wb.toast('{#po_order_draft_status#}');\n  return false;\n} else if(autidStatus == 'D'){\n  Wb.toast('{#po_order_already_reject#}');\n  return false;\n} else if(autidStatus == 'R'){\n  Wb.toast('{#po_order_already_revoke#}');\n  return false;\n} else if(autidStatus == 'E') {\n  Wb.toast('{#po_order_already_audited#}');\n  return false;\n} else if (Ext.isEmpty(insCode)) {\n  Wb.toast('{#po_order_ins_code#}');\n  return false;\n} else {\n  //撤回流程\n  XipWf.revokeByInstance(rows[0].data.INS_CODE,function(e){\n    Wb.toast(e.msg);\n    app.orderHGrid.store.reload();\n  });\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item5"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#po_order_monitor#}","itemId":"monitorBtn","iconCls":"viewport_icon"},"events":{"click":"var rows = app.orderHGrid.getSelection();\nif(rows.length != 1){\n\tWb.toast('{#po_order_select_record_one#}');\n}\nelse{\n    if(rows[0].data.INS_CODE === null || rows[0].data.INS_CODE === ''){\n        Wb.toast('{#po_order_ins_code#}');\n\t}\n    else{\n        XipWf.showMonitorPage(rows[0].data.INS_CODE);\n    }   \n}"},"children":[],"expanded":true,"type":"button"},{"configs":{"text":"-","itemId":"item6"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#po_order_seek#}","itemId":"seekBtn"},"events":{"click":"var recs =app.orderHGrid.getSelection();//选中的行\nif(recs.length<1){//没有选中行\n  Wb.toast('{#po_order_select_record_one#}');\n  return;\n}\nWb.run({\n  url:'m?xwl=xc/po/order/xc_po_order_h_seek',\n  success:function(app){\n    app.initWin({\n      orderHId:recs[0].data.ORDER_H_ID\n    });\n  }\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item7"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#po_order_change#}","itemId":"changeBtn"},"events":{"click":"var recs =app.orderHGrid.getSelection();//选中的行\nvar vstore = app.orderHGrid.store;\nif(recs.length<1){//没有选中行\n  Wb.toast('{#po_order_select_record_one#}');\n  return;\n}\nif(recs[0].data.AUDIT_STATUS!='E'){\n  Wb.toast('{#po_order_audited_can_change#}');\n  return;\n}\nvar orderHId =recs[0].data.ORDER_H_ID;//采购订单ID\nWb.run({\n  url:'m?xwl=xc/po/order/xc_po_order_h_change',\n  success:function(app){\n    app.initWin({\n      orderHId:orderHId,\n      change : 'true',\n      vstore:vstore\n    });\n  }\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item8"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#po_order_history_version#}","itemId":"historyBtn"},"events":{"click":"var recs =app.orderHGrid.getSelection();//选中的行\nif(recs.length<1){//没有选中行\n  Wb.toast('{#po_order_select_record_one#}');\n  return;\n}\nvar vport = app.viewport1;\nWb.run({\n\turl:'m?xwl=xc/po/order/xc_po_order_h_history_version',\n  \tsuccess:function(app){\n      app.initWin({\n      \t\torderHId:recs[0].data.ORDER_H_ID\n      });\n    }\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item9"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#po_order_enclosure#}","itemId":"enClosureBtn"},"events":{"click":"var rows = app.orderHGrid.getSelection();\nif(rows.length<1){\n  Wb.toast('{#po_order_select_record_least_one#}');\n}else{\n    var temp_id = rows[0].data.ORDER_H_ID;\n    var temp_code = rows[0].data.PO_DOC_CAT_CODE;\n  \tWb.request({\n    \turl : '{#contextPath#}'+'/poCommonAction.do?method=getProcAndFormsByCat',\n        params : {'ledgerId' : rows[0].data.LEDGER_ID,'docCat' : rows[0].data.PO_DOC_CAT_CODE},\n      \tsuccess:function(resp){\n          var rec = Wb.decode(resp.responseText);\n          if(rec.flag=='0'){\n            var attCatCode = rec.ATT_CAT_CODE;\n             Xip.showAttachmentManager('{#XIP.userId#}',temp_id,'',attCatCode,temp_code,'Y','Y','Y',function(){},2); \n          }\n        }\n    });\n   \n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item92"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#po_order_close#}","itemId":"closeBtn"},"events":{"click":"var recs =app.orderHGrid.getSelection();//选中的行\nif(recs.length<1){//没选中行\n  Wb.toast('{#po_order_select_record_least_one#}');\n  return;\n}\nvar ids = [];//id数组\nfor(var i=0;i<recs.length;i++){\n  var id = {'ORDER_H_ID':recs[i].data.ORDER_H_ID};\n  ids.push(id);\n}\nWb.request({\n\turl:'{#contextPath#}'+'/poOrderAction.do?method=updateOrerHStatus',\n  \tparams:{'ids':ids,'operate':'Y'},\n  \tsuccess:function(resp){\n    \tvar response = Wb.decode(resp.responseText);\n      \tif(response.flag=='0'){\n          Wb.toast('{#po_order_close_success#}');\n          app.queryBtn.fireEvent('click');\n        }else{\n        \tWb.toast(response.msg);\n        }\n    }\n});"},"children":[],"expanded":true,"type":"button"},{"configs":{"text":"-","itemId":"item91"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#po_order_open#}","itemId":"openBtn"},"events":{"click":"var recs =app.orderHGrid.getSelection();//选中的行\nif(recs.length<1){//没选中行\n  Wb.toast('{#po_order_select_record_least_one#}');\n  return;\n}\nvar ids = [];//id数组\nfor(var i=0;i<recs.length;i++){\n  var id = {'ORDER_H_ID':recs[i].data.ORDER_H_ID};\n  ids.push(id);\n}\nWb.request({\n  url:'{#contextPath#}'+'/poOrderAction.do?method=updateOrerHStatus',\n  params:{'ids':ids,'operate':'N'},\n  success:function(resp){\n    var response = Wb.decode(resp.responseText);\n    if(response.flag=='0'){\n      Wb.toast('{#po_order_open_success#}');\n      app.queryBtn.fireEvent('click');\n    }else{\n      Wb.toast(response.msg);\n    }\n  }\n});"},"children":[],"expanded":true,"type":"button"}],"expanded":false,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#po_order_rowNum#}","width":"50","xtype":"rownumberer","align":"center","titleAlign":"center","itemId":"rowNum"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#po_order_order_id#}","hidden":"true","dataIndex":"ORDER_H_ID","titleAlign":"center","itemId":"ORDER_H_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#po_order_order_code#}","width":"180","dataIndex":"ORDER_H_CODE","titleAlign":"center","itemId":"ORDER_H_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#po_order_order_name#}","dataIndex":"ORDER_H_NAME","titleAlign":"center","itemId":"ORDER_H_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#po_order_contract_id#}","hidden":"true","dataIndex":"CONTRACT_ID","titleAlign":"center","itemId":"CONTRACT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#po_order_contract_code#}","hidden":"true","dataIndex":"AP_CONTRACT_CODE","titleAlign":"center","itemId":"AP_CONTRACT_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#po_order_contract_name#}","dataIndex":"AP_CONTRACT_NAME","titleAlign":"center","itemId":"AP_CONTRACT_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#po_order_vendor_id#}","hidden":"true","dataIndex":"VENDOR_ID","titleAlign":"center","itemId":"VENDOR_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#po_order_vendor_name#}","dataIndex":"VENDOR_NAME","titleAlign":"center","itemId":"VENDOR_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#po_order_purchase_id#}","hidden":"true","dataIndex":"PURCHASE_DEPT_ID","titleAlign":"center","itemId":"PURCHASE_DEPT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#po_order_purchase_name#}","dataIndex":"PURCHASE_DEPT_NAME","titleAlign":"center","itemId":"PURCHASE_DEPT_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#po_order_purchase_person#}","dataIndex":"PURCHASE_PERSON_NAME","titleAlign":"center","itemId":"EMP_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#po_order_department#}","dataIndex":"DEPT_NAME","titleAlign":"center","itemId":"DEPT_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"DEPT_ID","hidden":"true","dataIndex":"DEPT_ID","titleAlign":"center","itemId":"DEPT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"PROJECT_ID","hidden":"true","dataIndex":"PROJECT_ID","titleAlign":"center","itemId":"PROJECT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#po_order_project_name#}","dataIndex":"PROJECT_NAME","titleAlign":"center","itemId":"PROJECT_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#po_order_amount#}","align":"right","dataIndex":"AMOUNT","titleAlign":"center","itemId":"AMOUNT_COL","renderer":"return Wb.format(value,'0,000.00');"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#po_order_inv_amount#}","align":"right","dataIndex":"INV_AMOUNT","titleAlign":"center","itemId":"INV_AMOUNT_COL","renderer":"return Wb.format(value,'0,000.00');"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#po_order_start_date#}","dataIndex":"DOCUMENT_DATE","format":"Y-m-d","titleAlign":"center","itemId":"DOCUMENT_DATE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#po_order_version#}","dataIndex":"VERSION","titleAlign":"center","itemId":"VERSION_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#po_order_audit_status#}","hidden":"true","dataIndex":"AUDIT_STATUS","titleAlign":"center","itemId":"AUDIT_STATUS_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#po_order_audit_status#}","hidden":"false","dataIndex":"AUDIT_STATUS_DESC","titleAlign":"center","itemId":"AUDIT_STATUS_DESC_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#po_order_status#}","hidden":"true","dataIndex":"SYS_AUDIT_STATUS","titleAlign":"center","itemId":"SYS_AUDIT_STATUS_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"ORDER_H_TYPE","hidden":"true","dataIndex":"ORDER_H_TYPE","titleAlign":"center","itemId":"ORDER_H_TYPE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#po_order_order_type#}","dataIndex":"ORDER_H_TYPE_NAME","titleAlign":"center","itemId":"ORDER_H_TYPE_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#po_order_status#}","dataIndex":"SYS_AUDIT_STATUS_DESC","titleAlign":"center","itemId":"SYS_AUDIT_STATUS_DESC_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#po_order_if_close#}","dataIndex":"IS_CLOSE","titleAlign":"center","itemId":"IS_CLOSE_COL","renderer":"if(value=='Y') return '{#po_order_yes#}';\nif(value=='N') return '{#po_order_no#}';"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#po_order_org_id#}","hidden":"true","dataIndex":"ORG_ID","titleAlign":"center","itemId":"ORG_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#po_order_org#}","hidden":"true","dataIndex":"ORG_NAME","titleAlign":"center","itemId":"ORG_NAME_COL"},"children":[],"expanded":false,"type":"column"}],"expanded":false,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}