{"inframe":false,"title":"","hidden":false,"roles":{"default":1},"children":[{"configs":{"serverScript":"//---------------------获取当前模块语言对应的.json文件，放到request中----------------\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xc/po/order/json/xc_po_order_h\");\nvar userId = request.getSession().getAttribute(\"XzSessionVars\").get('userId');\nrequest.setAttribute('userId',userId);\nvar contextPath = request.getContextPath();\nrequest.setAttribute(\"contextPath\",contextPath);","itemId":"module"},"events":{"finalize":"function clearOtherFn(type){\n  if(type=='xip_pub_orgs'){\n\tapp.CONTRACT_NAME.QUERY_ORG_ID.setValue('');\n  } else if(type==='xc_ap_vendors'){\n\tapp.CONTRACT_NAME.QUERY_VENDOR_ID.setValue('');\n  }  else if(type==='xc_pm_projects'){\n\n  } else if(type==='xip_pub_depts'){\n\tapp.DEPARTMENT_ID.setValue('');\n    app.PROJECT_NAME.QUERY_DEPT_ID.setValue('');\n  } else if(type==='xc_gl_dim'){\n\n  } else if (type=='xip_pub_depts_users') {\n    app.PURCHASE_DEPT_ID.setValue('');\n  } else if(type == 'xc_po_contract'){\n    \n  }\n\n}\n\nfunction returnRowFn(r,type){\n  if(type=='xip_pub_orgs'){\n    var ledgerId = r.data.LEDGER_ID;\n    var orgId = r.data.ORG_ID;\n    app.CONTRACT_NAME.QUERY_ORG_ID.setValue(r.data.ORG_ID);\n    //查询账簿下，采购申请是否必须\n    Wb.request({\n      url : 'm?xwl=xc/po/order/data/selectIsNeedOrder',\n      params : {ledgerId:ledgerId,orgId:orgId},\n      success : function(response,eOpts){\n        var o = Wb.decode(response.responseText);\n        if (o.IS_CGSQ == 'Y') {\n          app.addMatBtn.setDisabled(true);\n          app.addMatBtn.setTooltip('必有采购申请模式不能选物料');\n        } else {\n          app.addMatBtn.setDisabled(false);\n          app.addMatBtn.setTooltip('物料');\n        }\n      }\n    });\n    \n  } else if(type==='xc_ap_vendors'){\n    app.CONTRACT_NAME.QUERY_VENDOR_ID.setValue(r.data.VENDOR_ID);\n\n  } else if(type==='xc_pm_projects'){\n\tapp.DEPT_NAME.DEPT_ID.setValue(r.data.DEPT_ID);\n    app.DEPT_NAME.DEPT_NAME.setValue(r.data.DEPT_NAME);\n  } else if(type==='xip_pub_depts'){\n    app.DEPARTMENT_ID.setValue(r.data.DEPT_ID);\n    app.PROJECT_NAME.QUERY_DEPT_ID.setValue(r.data.DEPT_ID);\n    app.PROJECT_NAME.PROJECT_ID.setValue('');\n    app.PROJECT_NAME.PROJECT_NAME.setValue('');\n  } else if(type=='xc_ap_emp'){\n\n  } else if(type=='xip_pub_depts_users'){\n    app.PURCHASE_DEPT_ID.setValue(r.data.DEPT_ID);\n  } else if(type == 'xc_po_contract'){\n    \n  }\n}","initialize":"var deleteIds = [];\nExt.apply(app,{\n  initWin:function(params){\n    Ext.apply(app,params);\n    app.showWin.show();\n    var flag = params.flag;\n    var change = params.change;\n    \n    app.PO_DOC_CAT_CODE.setValue('CGDD');\n    if(flag=='insert'){//添加时\n      app.showWin.setTitle('{#po_order_add#}');\n      app.saveBtn.setDisabled(false);\n      app.submitBtn.setDisabled(true);\n      app.revokeBtn.setDisabled(true);\n      \n      app.VERSION.setValue('0');\n      app.IS_CLOSE.setValue('N');\n      var vstore = app.ORG_NAME.ORG_NAME.getPicker().getStore();\n      vstore.load({\n        callback:function(){\n          var orgId = vstore.getAt(0).get('ORG_ID');\n          var orgCode = vstore.getAt(0).get('ORG_CODE');\n          var orgName = vstore.getAt(0).get('ORG_NAME');\n          var ledgerId = vstore.getAt(0).get('LEDGER_ID');\n          var ledgerName = vstore.getAt(0).get('LEDGER_NAME');\n          \n          app.ORG_NAME.ORG_ID.setValue(orgId);\n          app.ORG_NAME.ORG_CODE.setValue(orgCode);\n          app.ORG_NAME.ORG_NAME.setValue(orgName);\n          app.ORG_NAME.LEDGER_ID.setValue(ledgerId);\n          app.ORG_NAME.LEDGER_NAME.setValue(ledgerName);\n          app.VENDOR_NAME.QUERY_LEDGER_ID.setValue(ledgerId);\n          app.CONTRACT_NAME.QUERY_ORG_ID.setValue(orgId);\n          app.DEPT_NAME.QUERY_LEDGER_ID.setValue(ledgerId);\n          app.PROJECT_NAME.QUERY_LEDGER_ID.setValue(ledgerId);\n          app.PURCHASE_DEPT_NAME.QUERY_LEDGER_ID.setValue(ledgerId);\n          \n          var curDate = new Date();\n          app.DOCUMENT_DATE.setValue(Ext.Date.format(curDate,'Y-m-d'));\n          app.PURCHASE_PERSON_NAME.setValue('{#XIP.empName#}');\n          app.PURCHASE_PERSON.setValue('{#XIP.userId#}');\n          app.AUDIT_STATUS.setValue('A');\n          app.AUDIT_STATUS_DESC.setValue('{#po_order_write_out#}');\n          app.SYS_AUDIT_STATUS.setValue('A');\n          app.SYS_AUDIT_STATUS_DESC.setValue('{#po_order_material_draft#}');\n          app.ORDER_H_ID.setValue(Xip.getId());\n          //查询账簿下，采购申请是否必须,借此判断新增行信息时是否可以选择物料\n          Wb.request({\n            url : 'm?xwl=xc/po/order/data/selectIsNeedOrder',\n            params : {ledgerId:ledgerId,orgId:orgId},\n            success : function(response,eOpts){\n              var o = Wb.decode(response.responseText);\n              if (o.IS_CGSQ == 'Y') {\n                app.addMatBtn.setDisabled(true);\n                app.addMatBtn.setTooltip('必有采购申请模式不能选物料');\n              }\n            }\n          });\n        }\n      });\n      app.orderLGrid.store.load();\n    }else if(flag=='edit'){//修改时\n      app.showWin.setTitle('{#po_order_edit#}');\n      app.saveBtn.setDisabled(false);\n      app.submitBtn.setDisabled(false);\n      app.revokeBtn.setDisabled(false);\n      \n      var orderHId = params.orderHId;\n      app.ORDER_H_TYPE.store.load();\n      Wb.request({\n        url:'m?xwl=xc/po/order/data/selectOrderHDataById',\n        params:{'orderHId':orderHId},\n        success:function(resp){\n          var rec = Wb.decode(resp.responseText);\n          var orgId = rec.rows[0].ORG_ID;\n          var orgCode = rec.rows[0].ORG_CODE;\n          var orgName = rec.rows[0].ORG_NAME;\n          var ledgerId = rec.rows[0].LEDGER_ID;\n          var ledgerName = rec.rows[0].LEDGER_NAME;\n          \n          app.ORG_NAME.ORG_ID.setValue(orgId);\n          app.ORG_NAME.ORG_CODE.setValue(orgCode);\n          app.ORG_NAME.ORG_NAME.setValue(orgName);\n          app.ORG_NAME.LEDGER_ID.setValue(ledgerId);\n          app.ORG_NAME.LEDGER_NAME.setValue(ledgerName);\n          app.VENDOR_NAME.QUERY_LEDGER_ID.setValue(ledgerId);\n          app.CONTRACT_NAME.QUERY_ORG_ID.setValue(orgId);\n          app.DEPT_NAME.QUERY_LEDGER_ID.setValue(ledgerId);\n          app.PROJECT_NAME.QUERY_LEDGER_ID.setValue(ledgerId);\n          \n          Wb.setValue(app.contentForm,rec.rows[0]);\n          var documentDate = rec.rows[0].documentDate;\n          var purchaseDeptId = rec.rows[0].PURCHASE_DEPT_ID;\n          var purchaseDeptName = rec.rows[0].PURCHASE_DEPT_NAME;\n          var deptId = rec.rows[0].DEPT_ID;\n          var deptName = rec.rows[0].DEPT_NAME;\n          var projectId = rec.rows[0].PROJECT_ID;\n          var projectName = rec.rows[0].PROJECT_NAME;\n          app.DOCUMENT_DATE.setValue(documentDate);\n          app.PURCHASE_DEPT_NAME.DEPT_ID.setValue(purchaseDeptId);\n          app.PURCHASE_DEPT_NAME.DEPT_NAME.setValue(purchaseDeptName);\n          app.DEPT_NAME.DEPT_ID.setValue(deptId);\n          app.DEPT_NAME.DEPT_NAME.setValue(deptName);\n          app.PROJECT_NAME.PROJECT_ID.setValue(projectId);\n          app.PROJECT_NAME.PROJECT_NAME.setValue(projectName);\n          app.DEPARTMENT_ID.setValue(deptId);\n          //查询账簿下，采购申请是否必须\n          Wb.request({\n            url : 'm?xwl=xc/po/order/data/selectIsNeedOrder',\n            params : {ledgerId:ledgerId,orgId:orgId},\n            success : function(response,eOpts){\n              var o = Wb.decode(response.responseText);\n              if (o.IS_CGSQ == 'Y') {\n                app.addMatBtn.setDisabled(true);\n                app.addMatBtn.setTooltip('必有采购申请模式不能选物料');\n              }\n            }\n          });\n\n        }\n      });\n      app.orderLGrid.store.load({params:{'orderHId':orderHId}});\n\n    }\n//     if(change=='true'){//订单变更\n//       Wb.request({\n//         url:'m?xwl=xc/po/order/data/selectOrderHHisDataById',//通过订单ID查询变更订单信息\n//         params:{'orderHId':params.orderHId},\n//         success:function(resp){\n//           var response = Wb.decode(resp.responseText);\n//           if(response.total>0){//存在不是审批通过状态的订单变更\n//             app.ORG_NAME.ORG_ID.setValue(response.rows[0].ORG_ID);\n//             app.VENDOR_NAME.QUERY_LEDGER_ID.setValue(response.rows[0].LEDGER_ID);\n//             app.CONTRACT_NAME.QUERY_ORG_ID.setValue(response.rows[0].ORG_ID);\n//             app.DEPT_NAME.QUERY_LEDGER_ID.setValue(response.rows[0].LEDGER_ID);\n//             app.PROJECT_NAME.QUERY_LEDGER_ID.setValue(response.rows[0].LEDGER_ID);\n//             app.PURCHASE_DEPT_NAME.USER_ID.setValue('{#XIP.userId#}');\n//             for(var i=0;i<response.total;i++){\n//               if(response.rows[i].AUDIT_STATUS=='A'||response.rows[i].AUDIT_STATUS=='C'||response.rows[i].AUDIT_STATUS=='R'||response.rows[i].AUDIT_STATUS=='D'){\n//                 Wb.setValue(app.showWin,response.rows[i]);//主信息赋值\n//                 app.DOCUMENT_DATE.setValue(response.rows[i].documentDate);\n//                 app.DEPARTMENT_ID.setValue(response.rows[i].DEPT_ID);\n//                 app.PURCHASE_DEPT_NAME.DEPT_NAME.setValue(response.rows[i].PURCHASE_DEPT_NAME);\n//                 app.DEPT_NAME.DEPT_NAME.setValue(rec.rows[0].DEPT_NAME);\n//                 app.DEPT_NAME.DEPT_ID.setValue(rec.rows[0].DEPT_ID);\n//                 app.PROJECT_NAME.PROJECT_ID.setValue(rec.rows[0].PROJECT_ID);\n//                 app.PROJECT_NAME.PROJECT_NAME.setValue(rec.rows[0].PROJECT_NAME);\n//                 app.PO_DOC_CAT_CODE.setValue('CGDD_BG');\n//                 app.orderLGrid.store.proxy.url = 'm?xwl=xc/po/order/data/getOrderLHisData';\n//                 app.orderLGrid.store.load({params:{'ORDER_H_HIS_ID':app.ORDER_H_HIS_ID.getValue()}});\n\n//               }\n//             }\n\n//           }else {//不存在不是审批通过状态的订单变更\n//             Wb.request({\n//               url:'m?xwl=xc/po/order/data/selectOrderHDataById',\n//               params:{'orderHId':params.orderHId},\n//               success:function(resp){\n//                 var response = Wb.decode(resp.responseText);\n//                 if(response.total>0){\n//                   app.ORG_NAME.ORG_ID.setValue(response.rows[0].ORG_ID);\n//                   app.VENDOR_NAME.QUERY_LEDGER_ID.setValue(response.rows[0].LEDGER_ID);\n//                   app.CONTRACT_NAME.QUERY_LEDGER_ID.setValue(response.rows[0].LEDGER_ID);\n//                   app.DEPT_NAME.QUERY_LEDGER_ID.setValue(response.rows[0].LEDGER_ID);\n//                   app.PROJECT_NAME.QUERY_LEDGER_ID.setValue(response.rows[0].LEDGER_ID);\n//                   app.PURCHASE_DEPT_NAME.USER_ID.setValue('{#XIP.userId#}');\n//                   Wb.setValue(app.showWin,response.rows[0]);//主信息赋值\n//                   app.ORDER_H_HIS_ID.setValue(Xip.getId());\n//                   app.DOCUMENT_DATE.setValue(response.rows[0].documentDate);\n//                   app.DEPARTMENT_ID.setValue(response.rows[0].DEPT_ID);\n//                   app.PURCHASE_DEPT_NAME.DEPT_NAME.setValue(response.rows[0].PURCHASE_DEPT_NAME);\n//                   app.DEPT_NAME.DEPT_NAME.setValue(rec.rows[0].DEPT_NAME);\n//                   app.DEPT_NAME.DEPT_ID.setValue(rec.rows[0].DEPT_ID);\n//                   app.PROJECT_NAME.PROJECT_ID.setValue(rec.rows[0].PROJECT_ID);\n//                   app.PROJECT_NAME.PROJECT_NAME.setValue(rec.rows[0].PROJECT_NAME);\n//                   app.AUDIT_STATUS.setValue('A');\n//                   app.AUDIT_STATUS_DESC.setValue('{#po_order_write_out#}');\n//                   app.SYS_AUDIT_STATUS.setValue('A');\n//                   app.SYS_AUDIT_STATUS_DESC.setValue('{#po_order_material_draft#}');\n//                   app.VERSION.setValue(response.rows[0].VERSION+1);\n//                   app.PO_DOC_CAT_CODE.setValue('CGDD_BG');\n//                   app.INS_CODE.setValue('');\n//                   app.orderLGrid.store.proxy.url = 'm?xwl=xc/po/order/data/getOrderLData';\n//                   app.orderLGrid.store.load({\n//                     params:{'orderHId':params.orderHId},\n//                     callback:function(){\n//                       var rec = app.orderLGrid.store.getRange(0,app.orderLGrid.store.getCount());\n//                       for(var i=0;i<rec.length;i++){\n//                         rec[i].set('ORDER_L_HIS_ID',Xip.getId());\n//                       }\n//                     }\n//                   });\n//                 }\n//               }\n//             });\n//           }\n\n//         }\n//       });\n//     }\n\n  }\n});\nfunction add(arg1,arg2){\n  var r1,r2,m;\n  try{\n    r1 = arg1.toString().split('.')[1].length ;\n  }catch(e){\n    r1 = 0 ;\n  }\n  try{\n    r2 = arg2.toString().split('.')[1].length ;\n  }catch(e){\n    r2 = 0 ;\n  }\n  m = Math.pow(20,Math.max(r1,r2));\n  return (arg1 * m + arg2 * m) / m;\n}\n//乘法\nfunction mul(a, b) {\n    var c = 0,\n        d = a.toString(),\n        e = b.toString();\n    try {\n        c += d.split(\".\")[1].length;\n    } catch (f) {}\n    try {\n        c += e.split(\".\")[1].length;\n    } catch (f) {}\n    return Number(d.replace(\".\", \"\")) * Number(e.replace(\".\", \"\")) / Math.pow(10, c);\n}\n\n//除法\nfunction div(arg1, arg2) {  \n    var t1 = 0, t2 = 0, r1, r2;  \n    try {  \n        t1 = arg1.toString().split(\".\")[1].length;  \n    } catch (e) { }  \n    try {  \n        t2 = arg2.toString().split(\".\")[1].length;  \n    } catch (e) { }  \n    with (Math) {  \n        r1 = Number(arg1.toString().replace(\".\", \"\"));  \n        r2 = Number(arg2.toString().replace(\".\", \"\"));  \n        return (r1 / r2) * pow(10, t2 - t1);  \n    }  \n}  \nfunction returnFloat(args){\n  var value = Math.round(parseFloat(args)*100)/100;\n  var xsd=value.toString().split(\".\");\n  if(xsd.length==1){\n    value=value.toString()+\".00\";\n    return value;\n  }\n  if(xsd.length>1){\n    if(xsd[1].length<2){\n      value=value.toString()+\"0\";\n    }\n    return value;\n  }\n}"},"children":[{"configs":{"maximized":"true","layout":"border","closeAction":"hide","buttonAlign":"center","itemId":"showWin","border":"false","modal":"true"},"events":{"afterrender":"app.ORG_NAME.ORG_NAME.setLabelWidth(100);\napp.PURCHASE_DEPT_NAME.DEPT_NAME.setFieldLabel('{#po_order_purchase_name#}');\napp.DEPT_NAME.DEPT_NAME.setFieldLabel(\"<font color='red'>*<\/font>{#po_order_department#}\");\napp.VENDOR_NAME.VENDOR_NAME.setLabelWidth(100);\napp.PURCHASE_DEPT_NAME.DEPT_NAME.setLabelWidth(100);\napp.PURCHASE_DEPT_NAME.DEPT_NAME.allowBlank = true;\napp.CONTRACT_NAME.AP_CONTRACT_NAME.setLabelWidth(100);\napp.DEPT_NAME.DEPT_NAME.setLabelWidth(100);\napp.PROJECT_NAME.PROJECT_NAME.setLabelWidth(100);\n","close":"app.vstore.reload();"},"children":[{"configs":{"region":"north","layout":"auto","itemId":"contentForm","border":"false"},"children":[{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"{#po_order_save#}","itemId":"saveBtn","iconCls":"save_icon"},"events":{"click":"//测试form数据的合法性\nif(!Wb.verify(app.contentForm)){\n  Wb.toast('{#po_order_grid_illgal#}');\n  return;\n}\n//测试form数据的合法性\nvar vgrid = app.orderLGrid;\nif(!Wb.verifyGrid(vgrid)){\n  Wb.toast('{#po_order_grid_illgal#}');\n  return;\n}\nif(vgrid.getStore().getCount()===0){//行信息为空\n  Wb.toast('{#po_order_detail_not_null#}');\n  return;\n}\n\n// if(app.change=='true'){//订单变更\n//   var rec = vgrid.store.getRange(0,vgrid.store.getCount());\n//   for(var i=0;i<rec.length;i++){\n//     if(Wb.isEmpty(rec[i].get('ORDER_L_HIS_ID'))){\n//       rec[i].set('ORDER_L_HIS_ID',Xip.getId());\n//     }\n//   }\n// }\n\n// 计算金额\nvar amount = 0;\nvar invAmount = 0;\nfor(var i=0;i<vgrid.getStore().getCount();i++){//不含税金额，含税金额赋值\n  amount += vgrid.getStore().getAt(i).get('AMOUNT');\n  invAmount += vgrid.getStore().getAt(i).get('INV_AMOUNT');\n}\napp.AMOUNT.setValue(Wb.format(amount,'000.00'));\napp.INV_AMOUNT.setValue(Wb.format(invAmount,'000.00'));\n\n\n// var totalRecs = vgrid.getStore().getRange(0,vgrid.getStore().getCount());//表格中所有的数据\n// var lineNums = [];//存取行号的数组\n// for(var j=0;j<vgrid.getStore().getCount();j++){\n//   lineNums.push(vgrid.store.indexOf(totalRecs[j])+1);\n// }\n// 处理行数据\nvar count = app.orderLGrid.store.getCount();\nfor (var i=0; i<count; i++) {\n  var rec = app.orderLGrid.store.getAt(i);\n  rec.set('ORDER_L_NUM',(i+1));\n}\n\nWb.request({\n  url:'{#contextPath#}'+'/poOrderAction.do?method=saveOrder',\n  params:{'formStr':Wb.getValue(app.contentForm),'gridStr':Wb.getData(vgrid),'deleteIds':deleteIds},\n  success:function(resp){\n    var rec = Wb.decode(resp.responseText);\n    if(rec.flag=='0'){\n      Wb.toast('{#po_order_save_success#}');\n      app.saveBtn.setDisabled(false);\n      app.submitBtn.setDisabled(false);\n      app.revokeBtn.setDisabled(true);\n      \n      vgrid.store.commitChanges();\n      Wb.request({\n        url:'m?xwl=xc/po/order/data/selectOrderHDataById',\n        params:{'orderHId':app.ORDER_H_ID.getValue()},\n        success:function(resp){\n          var rec = Wb.decode(resp.responseText);\n          app.ORDER_H_CODE.setValue(rec.rows[0].ORDER_H_CODE);\n        }\n      });\n    }else if(rec.flag=='1'){\n      Wb.toast(rec.msg);\n    }\n  }\n});\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#po_order_submit#}","itemId":"submitBtn","iconCls":"up_icon"},"events":{"click":"var insCode = app.INS_CODE.getValue();//实例编码\nvar ledgerId = app.ORG_NAME.LEDGER_ID.getValue();//账簿ID\nvar docCat = app.PO_DOC_CAT_CODE.getValue();//单据类型\nvar projectId = app.PROJECT_NAME.PROJECT_ID.getValue();//项目ID\nvar deptId = app.PURCHASE_DEPT_ID.getValue();//采购部门ID\nvar bizId = app.ORDER_H_ID.getValue();\nvar insCode = app.INS_CODE.getValue();\n// TODO: 取得流程编码、电脑端审批表单和移动端审批表单\nWb.request({\n  url:'{#contextPath#}'+'/apPayReqCommonAction.do?method=getProcAndFormsByCat',\n  params:{'LEDGER_ID':ledgerId,'AP_DOC_CAT_CODE':'CGDD'},\n  success:function(res){\n    var response = Wb.decode(res.responseText);\n    if(response.flag=='0'){\n      // TODO: 取得流程编码、电脑端审批表单和移动端审批表单\n      var processCode = response.PROCESS_CODE ;\n      var pcApproveForm = response.PC_A_FORM_URL ;\n      var mobileApproveForm = response.M_A_FORM_URL ;\n      // 电脑端和移动端审批表单为变量需要设置为全路径\n      pcApproveForm = '{#appIP#}' +  '/'+pcApproveForm ;\n      mobileApproveForm = '{#appIP#}' +  mobileApproveForm ;\n      // TODO: 如果流程编码存在, 则提交流程审批处理\n      if(processCode !== \"\" && processCode !== null && processCode !== undefined){\n        // 如果项目未指定，则设置默认值为 \"-1\"\n        var prjId = projectId ;\n        if(prjId === null || prjId === \"\" || prjId === undefined){\n          prjId = \"-1\" ;\n        }\n        var orgId = app.ORG_NAME.ORG_ID.getValue();\n        if(orgId===''){\n          return;\n        }\n        var auditStatus = app.AUDIT_STATUS.getValue();\n        var _empId = '{#XIP.empId#}' ;\n        var json = {\n          'APP_IP'\t\t\t:'{#appIP#}',\n          'loginName'\t\t:'{#XIP.userName#}',\n          'AP_DOC_CAT_NAME'\t:'{#po_pur_cgsq#}',\n          'PC_A_FORM'\t\t:pcApproveForm,\n          'M_A_FORM'\t\t:mobileApproveForm,\n          'poCatCode'\t\t:docCat,\n          'DEPT_NAME'\t\t:app.PURCHASE_DEPT_NAME.DEPT_NAME.getValue(),\n          'AMT'\t\t\t\t:app.AMOUNT.getValue(),\n          'e_business_id'\t:bizId,\n          'billType'\t\t: 'CGDD',\n          'PROJECT_ID'\t\t: prjId,\n          'EMP_ID'\t\t\t: _empId,\n          'ledgerId'\t\t: ledgerId,\n          'DEPT_ID'\t\t\t: deptId,\n          'ORG_ID'\t\t\t: orgId\n        };\n        if(auditStatus === 'A'){//起草状态\n          XipWf.startAndSubmitByProcess(processCode,json,function(e){//提交流程\n            if(e.flag === 0){\n              Wb.toast('{#po_order_submit_success#}');\n              app.saveBtn.setDisabled(true);\n              app.submitBtn.setDisabled(true);\n              app.revokeBtn.setDisabled(false);\n              app.INS_CODE.setValue(e.instanceCode);\n              app.vstore.reload();\n\n              Wb.request({\n                url:'m?xwl=xc/po/order/data/selectOrderHDataById',\n                params:{'orderHId':app.ORDER_H_ID.getValue()},\n                success:function(resp){\n                  var rec = Wb.decode(resp.responseText);\n                  app.AUDIT_STATUS.setValue(rec.rows[0].AUDIT_STATUS);\n                  app.AUDIT_STATUS_DESC.setValue(rec.rows[0].AUDIT_STATUS_DESC);\n                  app.SYS_AUDIT_STATUS.setValue(rec.rows[0].SYS_AUDIT_STATUS);\n                  app.SYS_AUDIT_STATUS_DESC.setValue(rec.rows[0].SYS_AUDIT_STATUS_DESC);\n\n                }\n              });\n            }\n            else if(e.flag === 1){\n              Wb.toast(e.msg) ;\n            }else{}\n          });\n        }\n        else if(auditStatus === 'D'){//驳回状态\n\n          XipWf.submitInstance(insCode,json,function(e){//提交流程\n            if(e.flag === 0){\n              Wb.toast('{#po_order_submit_success#}');\n              app.saveBtn.setDisabled(true);\n              app.submitBtn.setDisabled(true);\n              app.revokeBtn.setDisabled(false);\n              app.vstore.reload();\n              app.INS_CODE.setValue(e.instanceCode);\n\n              Wb.request({\n                url:'m?xwl=xc/po/order/data/selectOrderHDataById',\n                params:{'orderHId':app.ORDER_H_ID.getValue()},\n                success:function(resp){\n                  var rec = Wb.decode(resp.responseText);\n                  app.AUDIT_STATUS.setValue(rec.rows[0].AUDIT_STATUS);\n                  app.AUDIT_STATUS_DESC.setValue(rec.rows[0].AUDIT_STATUS_DESC);\n                  app.SYS_AUDIT_STATUS.setValue(rec.rows[0].SYS_AUDIT_STATUS);\n                  app.SYS_AUDIT_STATUS_DESC.setValue(rec.rows[0].SYS_AUDIT_STATUS_DESC);\n\n                }\n              });\n\n\n            }\n            else if(e.flag === 1){\n              Wb.toast(e.msg) ;\n            }else{}\n          });\n        }else if(auditStatus === 'R'){//撤回状态\n          // 撤回 -> 按流程实例提交流程\n          XipWf.restartAndSubmitByProcess(insCode,processCode,json,function(e){\n            if(e.flag === 0){\n              Wb.toast('{#po_order_submit_success#}');\n              app.saveBtn.setDisabled(true);\n              app.submitBtn.setDisabled(true);\n              app.revokeBtn.setDisabled(false);\n              app.vstore.reload();\n              app.INS_CODE.setValue(e.instanceCode);\n\n\n              Wb.request({\n                url:'m?xwl=xc/po/order/data/selectOrderHDataById',\n                params:{'orderHId':app.ORDER_H_ID.getValue()},\n                success:function(resp){\n                  var rec = Wb.decode(resp.responseText);\n                  app.AUDIT_STATUS.setValue(rec.rows[0].AUDIT_STATUS);\n                  app.AUDIT_STATUS_DESC.setValue(rec.rows[0].AUDIT_STATUS_DESC);\n                  app.SYS_AUDIT_STATUS.setValue(rec.rows[0].SYS_AUDIT_STATUS);\n                  app.SYS_AUDIT_STATUS_DESC.setValue(rec.rows[0].SYS_AUDIT_STATUS_DESC);\n\n                }\n              });\n\n\n            }\n            else if(e.flag === 1){\n              Wb.toast(e.msg) ;\n            }else{}\n          },null);\n        }\n        else if(auditStatus === 'E' || auditStatus === 'C'){//运行中、结束状态\n          Wb.toast('{#po_order_not_can_submit#}');\n          return false;\n        }\n        else{\n          Wb.toast('{#po_order_submit_fail#}');\n          return false;\n        }\n      }\n    }else if(response.flag=='1'){\n      Wb.toast(response.msg);\n    }\n\n  }\n});\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#po_order_revoke#}","itemId":"revokeBtn","iconCls":"cancel_icon"},"events":{"click":"if(app.AUDIT_STATUS.getValue() === 'E') {\n  Wb.toast('{#po_order_already_audited#}');\n  return;\n}\nelse if(app.AUDIT_STATUS.getValue() === 'R'){\n  Wb.toast('{#po_order_already_revoke#}');\n  return false;\n}else if(app.AUDIT_STATUS.getValue() === 'A'){\n  Wb.toast('{#po_order_draft_status#}');\n  return false;\n}else if(app.AUDIT_STATUS.getValue() === 'D'){\n  Wb.toast('{#po_order_already_reject#}');\n  return false;\n} else if(app.INS_CODE.getValue() === null || app.INS_CODE.getValue() === '') {\n  Wb.toast('{#po_order_ins_code#}');\n  return;\n} else {\n  //撤回流程\n  XipWf.revokeByInstance(app.INS_CODE.getValue(),function(e){\n    Wb.toast(e.flag);\n    if (e.flag === 0 || e.flag == '0') {\n      Wb.toast(e.msg);\n      app.saveBtn.setDisabled(false);\n      app.submitBtn.setDisabled(false);\n      app.revokeBtn.setDisabled(true);\n      \n      app.vstore.reload();\n      Wb.request({\n        url:'m?xwl=xc/po/order/data/selectOrderHDataById',\n        params:{'orderHId':app.ORDER_H_ID.getValue()},\n        success:function(resp){\n          var rec = Wb.decode(resp.responseText);\n          app.AUDIT_STATUS.setValue(rec.rows[0].AUDIT_STATUS);\n          app.AUDIT_STATUS_DESC.setValue(rec.rows[0].AUDIT_STATUS_DESC);\n          app.SYS_AUDIT_STATUS.setValue(rec.rows[0].SYS_AUDIT_STATUS);\n          app.SYS_AUDIT_STATUS_DESC.setValue(rec.rows[0].SYS_AUDIT_STATUS_DESC);\n\n        }\n      });\n    } else {\n      Wb.toast(e.msg);\n    }\n\n\n  });\n}\n\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#po_order_monitor#}","itemId":"monitorBtn","iconCls":"viewport_icon"},"events":{"click":"if(app.INS_CODE.getValue() === null || app.INS_CODE.getValue() === ''){\n  Wb.toast('{#po_order_ins_code#}');\n}\nelse{\n  XipWf.showMonitorPage(app.INS_CODE.getValue());\n}   \n"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"layout":"column","margin":"10 10 0 0","itemId":"tr1","border":"false"},"children":[{"configs":{"layout":"fit","columnWidth":".25","itemId":"td1_1","border":"false"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/ORG_PICK/ORG_ALL_PICK","itemId":"ORG_NAME"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".25","border":"false","itemId":"td1_2"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/VENDOR_ID_PICK/VENDOR_ID_LD","itemId":"VENDOR_NAME"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".25","itemId":"td1_3","border":"false"},"children":[{"configs":{"file":"m?xwl=xc/po/po-com-lov/CONTRACT_ID_PICK/CONTRACT_ID_ORG","itemId":"CONTRACT_NAME"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".25","itemId":"td1_4","border":"false"},"children":[{"configs":{"labelWidth":"100","labelAlign":"right","itemId":"DOCUMENT_DATE","fieldLabel":"{#po_order_start_date#}"},"children":[],"expanded":false,"type":"date"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"layout":"column","margin":"10 10 0 0","itemId":"tr2","border":"false"},"children":[{"configs":{"layout":"fit","columnWidth":".25","border":"false","itemId":"td3_12"},"children":[{"configs":{"labelWidth":"100","displayField":"VAL_NAME","valueField":"VAL_CODE","labelAlign":"right","itemId":"ORDER_H_TYPE","fieldLabel":"{#po_order_order_type#}"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/po/order/data/getOrderType"},"children":[],"expanded":false,"type":"store"}],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".25","border":"false","itemId":"td2_3"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/DEPT_ID_PICK/DEPT_ID_LD","itemId":"PURCHASE_DEPT_NAME"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".25","border":"false","itemId":"td2_31"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/DEPT_ID_PICK/DEPT_ID_LD","itemId":"DEPT_NAME"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".25","border":"false","itemId":"td2_311"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/PROJECT_ID_PICK/PROJECT_ID_LD","itemId":"PROJECT_NAME"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"layout":"column","margin":"10 10 0 0","itemId":"tr3","border":"false"},"children":[{"configs":{"layout":"fit","columnWidth":".25","itemId":"td4_1","border":"false"},"children":[{"configs":{"labelWidth":"100","readOnly":"true","labelAlign":"right","itemId":"PURCHASE_PERSON_NAME","fieldLabel":"{#po_order_purchase_person#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".25","itemId":"td4_2","border":"false"},"children":[{"configs":{"labelWidth":"100","readOnly":"true","labelAlign":"right","itemId":"SYS_AUDIT_STATUS_DESC","fieldLabel":"{#po_order_status#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".25","itemId":"td2_1","border":"false"},"children":[{"configs":{"labelWidth":"100","readOnly":"true","labelAlign":"right","itemId":"ORDER_H_CODE","fieldLabel":"{#po_order_order_code#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".25","itemId":"td2_11","border":"false"},"children":[{"configs":{"labelWidth":"100","readOnly":"true","labelAlign":"right","itemId":"VERSION","fieldLabel":"{#po_order_version#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"layout":"column","margin":"10 10 10 0","border":"false","itemId":"tr4"},"children":[{"configs":{"layout":"fit","columnWidth":".25","itemId":"td3_3","border":"false"},"children":[{"configs":{"labelWidth":"100","readOnly":"true","labelAlign":"right","itemId":"INV_AMOUNT","fieldLabel":"{#po_order_inv_amount#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".25","itemId":"td3_4","border":"false"},"children":[{"configs":{"labelWidth":"100","readOnly":"true","labelAlign":"right","itemId":"AMOUNT","fieldLabel":"{#po_order_amount#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".5","itemId":"td2_2","border":"false"},"children":[{"configs":{"labelWidth":"100","labelAlign":"right","itemId":"ORDER_H_NAME","fieldLabel":"{#po_order_order_name#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"hidden":"true","itemId":"hiddenPanel"},"children":[{"configs":{"itemId":"PURCHASE_PERSON"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"AUDIT_STATUS"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"100","readOnly":"true","labelAlign":"right","itemId":"AUDIT_STATUS_DESC","fieldLabel":"{#po_pur_status#}"},"children":[],"expanded":true,"type":"text"},{"configs":{"itemId":"SYS_AUDIT_STATUS"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"INS_CODE"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"100","labelAlign":"right","itemId":"ORDER_H_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"100","labelAlign":"right","itemId":"PO_DOC_CAT_CODE"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"100","labelAlign":"right","itemId":"IS_CLOSE"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"100","labelAlign":"right","itemId":"PURCHASE_DEPT_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"100","labelAlign":"right","itemId":"DEPARTMENT_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"100","labelAlign":"right","itemId":"ORDER_H_HIS_ID"},"children":[],"expanded":false,"type":"text"}],"expanded":false,"type":"panel"}],"expanded":true,"type":"form"},{"configs":{"region":"center","selType":"checkboxmodel","itemId":"orderLGrid","editable":"true"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/po/order/data/getOrderLData"},"events":{"remove":"if(app.PO_DOC_CAT_CODE.getValue()=='CGDD'){//采购订单\n  deleteIds.push({'PUR_AP_L_ID':record.data.PUR_AP_L_ID,'ORDER_L_ID':record.data.ORDER_L_ID});\n}else if(app.PO_DOC_CAT_CODE.getValue()=='CGDD_BG'){//采购订单变更\n  deleteIds.push({'ORDER_L_HIS_ID':record.data.ORDER_L_HIS_ID});\n}\n"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"{#po_order_add#}","itemId":"addBtn","iconCls":"file_add_icon"},"children":[{"configs":{"text":"{#po_order_material#}","itemId":"addMatBtn","iconCls":"file_add_icon"},"events":{"afterrender":"\n","click":"var vgrid = app.orderLGrid;\nvar ledgerId = app.ORG_NAME.LEDGER_ID.getValue();\nvar docCatCode = app.PO_DOC_CAT_CODE.getValue();\nvar orderType = app.ORDER_H_TYPE.getValue();//订单类型\n\nif(Wb.isEmpty(ledgerId)){\n  Wb.toast('{#po_pur_first_select_org#}');\n  return;\n}\nif(Wb.isEmpty(orderType)){//订单类型为空\n  Wb.toast('{#po_order_type_not_null#}');\n  return;\n}\nvar materialProCode = '';\nif(app.ORDER_H_TYPE.getValue()=='ORDER_WZ'){//物资订单\n  materialProCode = 'ST_WZ';\n}else if(app.ORDER_H_TYPE.getValue()=='ORDER_ZC'){//资产订单\n  materialProCode = 'ST_ZC';\n}else if(app.ORDER_H_TYPE.getValue()=='ORDER_FW'){//服务订单\n  materialProCode = 'ST_FW';\n}\n\nWb.run({\n  url:'m?xwl=xc/po/order/xc_po_order_h_material',\n  success:function(app){\n    app.initWin({\n      ledgerId:ledgerId,\n      materialProCode : materialProCode,\n      hideFun:function(rs){\n        Wb.each(rs,function(r){\n          if(docCatCode=='CGDD'){\n            r.set('ORDER_L_ID',Xip.getId());\n            r.set('ORDER_L_HIS_ID','');\n          }else if(docCatCode=='CGDD_BG'){\n            r.set('ORDER_L_ID',Xip.getId());\n            r.set('ORDER_L_HIS_ID',Xip.getId());\n          }\n          var vstore = vgrid.store;\n          for(var i=0;i<vstore.getCount();i++){\n            if(vstore.getAt(i).get('MATERIAL_ID')==r.get('MATERIAL_ID')){\n              r.set('QTY',r.get('QTY')+vstore.getAt(i).get('QTY'));\n            }\n          }\n          Wb.add(vgrid,{\n            'ORDER_L_ID':r.get('ORDER_L_ID'),\n            'ORDER_L_HIS_ID':r.get('ORDER_L_HIS_ID'),\n            'MATERIAL_ID':r.get('MATERIAL_ID'),\n            'MATERIAL_CODE':r.get('MATERIAL_CODE'),\n            'MATERIAL_NAME':r.get('MATERIAL_NAME'),\n            'DIM_ID':r.get('DIM_ID'),\n            'DIM_NAME':r.get('DIM_NAME'),\n            'INV_PRICE':r.get('PURCHASE_PRICE'),\n            'IS_CLOSE':'N'\n          },'after',1,false);\n        });\n      }\n    });\n  }\n});"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#po_order_pur#}","itemId":"addPurBtn","iconCls":"file_add_icon"},"events":{"click":"var contractId = app.CONTRACT_NAME.AP_CONTRACT_ID.getValue();//合同ID\nvar docCatCode = app.PO_DOC_CAT_CODE.getValue();//单据类型\nvar orderType = app.ORDER_H_TYPE.getValue();//订单类型\nif(!Wb.isEmpty(contractId)){//合同为空\n  Wb.toast('{#po_order_exist_ct_no_pur#}');\n  return;\n}\nif(Wb.isEmpty(orderType)){//订单类型为空\n  Wb.toast('{#po_order_type_not_null#}');\n  return;\n}\nvar vgrid = app.orderLGrid;//订单行表格\nvar ledgerId = app.ORG_NAME.LEDGER_ID.getValue();//账簿ID\nvar orgId = app.ORG_NAME.ORG_ID.getValue();//组织ID\nif(Wb.isEmpty(ledgerId)){\n  Wb.toast('{#po_pur_first_select_org#}');\n  return;\n}\nvar materialPro = '';\nif(app.ORDER_H_TYPE.getValue()=='ORDER_WZ'){//物资订单\n  materialPro = 'ST_WZ';\n}else if(app.ORDER_H_TYPE.getValue()=='ORDER_ZC'){//资产订单\n  materialPro = 'ST_ZC';\n}else if(app.ORDER_H_TYPE.getValue()=='ORDER_FW'){//服务订单\n  materialPro = 'ST_FW';\n}\nWb.run({\n  url:'m?xwl=xc/po/order/xc_po_order_h_pur',\n  success:function(app){\n    app.initWin({\n      orgId:orgId,\n      materialPro:materialPro,\n      hideFun:function(rs){\n        Wb.each(rs,function(r){\n          if(docCatCode=='CGDD'){\n            r.set('ORDER_L_ID',Xip.getId());\n            r.set('ORDER_L_HIS_ID','');\n          }else if(docCatCode=='CGDD_BG'){\n            r.set('ORDER_L_ID',Xip.getId());\n            r.set('ORDER_L_HIS_ID',Xip.getId());\n          }\n          var vstore = vgrid.store;\n          for(var i=0;i<vstore.getCount();i++){\n            if(vstore.getAt(i).get('PUR_AP_H_ID')==r.get('PUR_AP_H_ID')){\n              Wb.toast('{#po_order_pur_exist#}');\n              return;\n            }\n          }\n          Wb.add(vgrid,{\n            ORDER_L_ID:r.get('ORDER_L_ID'),\n            ORDER_L_HIS_ID:r.get('ORDER_L_HIS_ID'),\n            PUR_AP_L_ID:r.get('PUR_AP_L_ID'),\n            PUR_AP_H_CODE:r.get('PUR_AP_H_CODE'),\n            MATERIAL_ID:r.get('MATERIAL_ID'),\n            MATERIAL_CODE:r.get('MATERIAL_CODE'),\n            MATERIAL_NAME:r.get('MATERIAL_NAME'),\n            DIM_ID:r.get('DIM_ID'),\n            DIM_NAME:r.get('DIM_NAME'),\n            QTY:r.get('QTY'),\n            INV_PRICE:r.get('PRICE'),\n            INV_AMOUNT:r.get('AMOUNT'),\n            IS_CLOSE:'N'\n          },'after',1,false);\n        });\n      }\n    });\n  }\n});"},"children":[],"expanded":false,"type":"item"}],"expanded":true,"type":"button"},{"configs":{"text":"-","itemId":"item1"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#po_order_delete#}","itemId":"delBtn","iconCls":"file_delete_icon"},"events":{"click":"Wb.remove(app.orderLGrid);"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#po_order_rowNum#}","align":"center","width":"50","xtype":"rownumberer","titleAlign":"center","itemId":"rowNum"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"ORDER_L_NUM","hidden":"true","align":"center","dataIndex":"ORDER_L_NUM","titleAlign":"center","itemId":"ORDER_L_NUM_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#po_order_order_l_id#}","hidden":"true","dataIndex":"ORDER_L_ID","titleAlign":"center","itemId":"ORDER_L_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"ORDER_L_HIS_ID","hidden":"true","dataIndex":"ORDER_L_HIS_ID","titleAlign":"center","itemId":"ORDER_L_HIS_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#po_order_material_id#}","hidden":"true","dataIndex":"MATERIAL_ID","titleAlign":"center","itemId":"MATERIAL_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#po_order_material_code#}","dataIndex":"MATERIAL_CODE","titleAlign":"center","itemId":"MATERIAL_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#po_order_material_name#}","dataIndex":"MATERIAL_NAME","titleAlign":"center","itemId":"MATERIAL_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#po_order_pur_code#}","dataIndex":"PUR_AP_H_CODE","titleAlign":"center","itemId":"PUR_AP_H_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"PUR_AP_L_ID","hidden":"true","dataIndex":"PUR_AP_L_ID","titleAlign":"center","itemId":"PUR_AP_L_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#po_order_dim#}","hidden":"true","dataIndex":"DIM_ID","titleAlign":"center","itemId":"DIM_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#po_order_dim#}","dataIndex":"DIM_NAME","titleAlign":"center","itemId":"DIM_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"<font color='red'>*<\/font>{#po_order_qty#}","align":"right","dataIndex":"QTY","titleAlign":"center","itemId":"QTY_COL"},"children":[{"configs":{"allowBlank":"false","minValue":"0","allowDecimals":"true","itemId":"editor"},"events":{"change":"// 数量   数量改变时，修改 含税金额\nif (Ext.isEmpty(newValue)) {\n  return false;\n}\n\nvar rec = app.orderLGrid.getSelection()[0];\nvar qty = newValue;\n// 含税单价\nvar inv_price = rec.data.INV_PRICE;\ninv_price = Ext.isEmpty(inv_price)? 0 : inv_price;\n\n// 不含税单价\nvar price = rec.data.PRICE;\nprice = Ext.isEmpty(price)? 0 : price;\n\n// 修改含税金额\nvar inv_amount = inv_price * qty;\nrec.set('INV_AMOUNT',inv_amount);\n\n// 修改不含税金额\nvar amount = price * qty;\nrec.set('AMOUNT',amount);"},"children":[],"expanded":false,"type":"number"}],"expanded":false,"type":"column"},{"configs":{"text":"<font color='red'>*<\/font>{#po_order_tax#}(%)","align":"right","dataIndex":"TAX","titleAlign":"center","itemId":"TAX_COL"},"children":[{"configs":{"allowBlank":"false","minValue":"0","allowDecimals":"true","itemId":"editor","maxValue":"100"},"events":{"change":"// 税率  税率改变时，改变 不含税单价、不含税金额\nif (Ext.isEmpty(newValue)) {\n  return false;\n}\n\nvar rec = app.orderLGrid.getSelection()[0];\nvar qty = rec.data.QTY;\nqty = Ext.isEmpty(qty) ? 0 : qty;\n// 含税单价\nvar inv_price = rec.data.INV_PRICE;\ninv_price = Ext.isEmpty(inv_price)? 0 : inv_price;\n\n// 不含税单价\nvar price = div(inv_price,(1+newValue * 0.01));\nprice = returnFloat(price);\nrec.set('PRICE',price);\n\n// 含税金额\nvar inv_amount = inv_price * qty;\nrec.set('INV_AMOUNT',inv_amount);\n\n// 修改不含税金额\nvar amount = price * qty;\nrec.set('AMOUNT',amount);"},"children":[],"expanded":false,"type":"number"}],"expanded":false,"type":"column"},{"configs":{"text":"<font color='red'>*<\/font>{#po_order_inv_price#}","align":"right","dataIndex":"INV_PRICE","titleAlign":"center","itemId":"INV_PRICE_COL","renderer":"return Wb.format(value,'0,000.00');"},"children":[{"configs":{"allowBlank":"false","minValue":"0","allowDecimals":"true","itemId":"editor"},"events":{"change":"// 含税单价\nif (Ext.isEmpty(newValue)) {\n  return false;\n}\n\nvar rec = app.orderLGrid.getSelection()[0];\nvar qty = rec.data.QTY;//数量\nqty = Ext.isEmpty(qty) ? 0 : qty;\nvar tax = rec.data.TAX; // 税率\ntax = Ext.isEmpty(tax) ? 0 : tax;\n// 含税单价\nvar inv_price = newValue;\n\n// 不含税单价\nvar price = div(inv_price,(1+tax * 0.01));\nprice = returnFloat(price);\nrec.set('PRICE',price);\n\n// 含税金额\nvar inv_amount = inv_price * qty;\nrec.set('INV_AMOUNT',inv_amount);\n\n// 修改不含税金额\nvar amount = price * qty;\nrec.set('AMOUNT',amount);\n"},"children":[],"expanded":false,"type":"number"}],"expanded":false,"type":"column"},{"configs":{"text":"{#po_order_price#}","align":"right","dataIndex":"PRICE","titleAlign":"center","itemId":"PRICE_COL","renderer":"return Wb.format(value,'0,000.00');"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#po_order_inv_amount#}","align":"right","dataIndex":"INV_AMOUNT","titleAlign":"center","itemId":"INV_AMOUNT_COL","renderer":"return Wb.format(value,'0,000.00');"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#po_order_amount#}","align":"right","dataIndex":"AMOUNT","titleAlign":"center","itemId":"AMOUNT_COL","renderer":"return Wb.format(value,'0,000.00');"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#po_order_if_close#}","dataIndex":"IS_CLOSE","titleAlign":"center","itemId":"IS_CLOSE_COL","renderer":"if(value=='Y') return '{#po_order_yes#}';\nif(value=='N') return '{#po_order_no#}';"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#RKSL#}","align":"right","dataIndex":"ENTRY_QTY","titleAlign":"center","itemId":"ENTRY_QTY_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#YKPJE#}","align":"right","dataIndex":"INVOICE_AMOUNT","titleAlign":"center","itemId":"INVOICE_AMOUNT_COL"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"window"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}