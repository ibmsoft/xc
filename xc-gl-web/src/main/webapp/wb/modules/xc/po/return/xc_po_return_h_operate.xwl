{"inframe":false,"title":"","hidden":false,"roles":{"default":1},"children":[{"configs":{"serverScript":"//---------------------获取当前模块语言对应的.json文件，放到request中----------------\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xc/po/return/json/xc_po_return_h\");\nvar userId = request.getSession().getAttribute(\"XzSessionVars\").get('userId');\nrequest.setAttribute('userId',userId);\nvar contextPath = request.getContextPath();\nrequest.setAttribute(\"contextPath\",contextPath);","itemId":"module"},"events":{"finalize":"function clearOtherFn(type){\n  if(type=='xip_pub_orgs'){\n    app.VENDOR_NAME.QUERY_LEDGER_ID.setValue('');\n    app.WAREHOUSE_NAME.QUERY_LEDGER_ID.setValue('');\n    app.CONTRACT_NAME.QUERY_LEDGER_ID.setValue('');\n\n    app.CONTRACT_NAME.AP_CONTRACT_NAME.setValue('');\n    app.CONTRACT_NAME.AP_CONTRACT_ID.setValue('');\n    app.DEPT_NAME.DEPT_NAME.setValue('');\n    app.DEPT_NAME.DEPT_ID.setValue('');\n    app.VENDOR_NAME.VENDOR_ID.setValue('');\n    app.VENDOR_NAME.VENDOR_NAME.setValue('');\n    app.PROJECT_NAME.PROJECT_ID.setValue('');\n    app.PROJECT_NAME.PROJECT_NAME.setValue('');\n  }else if(type==='xc_ap_vendors'){\n\n  }else if(type==='xip_pub_depts'){\n\n  }else if(type=='xc_po_order'){\n    app.CONTRACT_NAME.AP_CONTRACT_NAME.setValue('');\n    app.CONTRACT_NAME.AP_CONTRACT_ID.setValue('');\n    app.DEPT_NAME.DEPT_NAME.setValue('');\n    app.DEPT_NAME.DEPT_ID.setValue('');\n    app.VENDOR_NAME.VENDOR_ID.setValue('');\n    app.VENDOR_NAME.VENDOR_NAME.setValue('');\n    app.PROJECT_NAME.PROJECT_ID.setValue('');\n    app.PROJECT_NAME.PROJECT_NAME.setValue('');\n  }\n\n}\n\nfunction returnRowFn(r,type){\n  if(type=='xip_pub_orgs'){\n    app.VENDOR_NAME.QUERY_LEDGER_ID.setValue(r.data.LEDGER_ID);\n    app.WAREHOUSE_NAME.QUERY_LEDGER_ID.setValue(r.data.LEDGER_ID);\n    app.CONTRACT_NAME.QUERY_LEDGER_ID.setValue(r.data.LEDGER_ID);\n    app.ORDER_H_CODE.QUERY_LEDGER_ID.setValue(r.data.LEDGER_ID);\n\n    app.ORDER_H_CODE.ORDER_H_CODE.setValue('');\n    app.WAREHOUSE_NAME.WAREHOUSE_NAME.setValue('');\n    app.CONTRACT_NAME.AP_CONTRACT_NAME.setValue('');\n    app.CONTRACT_NAME.AP_CONTRACT_ID.setValue('');\n    app.DEPT_NAME.DEPT_NAME.setValue('');\n    app.DEPT_NAME.DEPT_ID.setValue('');\n    app.VENDOR_NAME.VENDOR_ID.setValue('');\n    app.VENDOR_NAME.VENDOR_NAME.setValue('');\n    app.PROJECT_NAME.PROJECT_ID.setValue('');\n    app.PROJECT_NAME.PROJECT_NAME.setValue(''); \n  }else if(type==='xc_ap_vendors'){\n\n\n  }else if(type==='xc_pm_projects'){\n\n  }else if(type==='xip_pub_depts'){\n\n  }else if(type=='xc_ap_emp'){\n\n  }else if(type=='xc_po_order'){\n    app.CONTRACT_NAME.AP_CONTRACT_NAME.setValue(r.data.AP_CONTRACT_NAME);\n    app.CONTRACT_NAME.AP_CONTRACT_ID.setValue(r.data.CONTRACT_ID);\n    app.DEPT_NAME.DEPT_NAME.setValue(r.data.DEPT_NAME);\n    app.DEPT_NAME.DEPT_ID.setValue(r.data.DEPT_ID);\n    app.VENDOR_NAME.VENDOR_ID.setValue(r.data.VENDOR_ID);\n    app.VENDOR_NAME.VENDOR_NAME.setValue(r.data.VENDOR_NAME);\n    app.PROJECT_NAME.PROJECT_ID.setValue(r.data.PROJECT_ID);\n    app.PROJECT_NAME.PROJECT_NAME.setValue(r.data.PROJECT_NAME);\n  }\n}","initialize":"var deleteIds = [];\nExt.apply(app,{\n  initWin:function(params){\n    Ext.apply(app,params);\n    app.showWin.show();\n    var flag = params.flag;\n    if(flag=='insert'){//添加时\n      app.showWin.setTitle('{#po_return_add#}');\n      app.saveBtn.setDisabled(false);\n      app.submitBtn.setDisabled(true);\n      app.revokeBtn.setDisabled(true);\n      \n      var vstore = app.ORG_NAME.ORG_NAME.getPicker().getStore();\n      vstore.load({\n        callback:function(){\n          app.ORG_NAME.ORG_NAME.setValue(vstore.getAt(0).get('ORG_NAME'));\n          app.ORG_NAME.ORG_ID.setValue(vstore.getAt(0).get('ORG_ID'));\n          app.ORG_NAME.LEDGER_ID.setValue(vstore.getAt(0).get('LEDGER_ID'));\n          app.ORDER_H_CODE.QUERY_LEDGER_ID.setValue(vstore.getAt(0).get('LEDGER_ID'));\n          app.WAREHOUSE_NAME.QUERY_LEDGER_ID.setValue(vstore.getAt(0).get('LEDGER_ID'));\n          app.CONTRACT_NAME.QUERY_LEDGER_ID.setValue(vstore.getAt(0).get('LEDGER_ID'));\n          app.DEPT_NAME.USER_ID.setValue('{#XIP.userId#}');\n          app.VENDOR_NAME.QUERY_LEDGER_ID.setValue(vstore.getAt(0).get('LEDGER_ID'));\n        }\n      });\n      app.AUDIT_STATUS.setValue('A');\n      app.AUDIT_STATUS_DESC.setValue('{#po_return_write_out#}');\n      app.SYS_AUDIT_STATUS.setValue('A');\n      app.SYS_AUDIT_STATUS_DESC.setValue('{#po_return_draft#}');\n      app.PURCHASE_PERSON.setValue('{#XIP.userId#}');\n      app.PO_DOC_CAT_CODE.setValue('THD');\n      app.RETURN_H_ID.setValue(Xip.getId());\n      app.returnLGrid.store.load();\n      \n    }else if(flag=='edit'){//修改时\n      app.showWin.setTitle('{#po_return_edit#}');\n      app.saveBtn.setDisabled(false);\n      app.submitBtn.setDisabled(false);\n      app.revokeBtn.setDisabled(false);\n      \n      Wb.request({\n        url:'m?xwl=xc/po/return/data/getReturnHDataById',\n        params:{'RETURN_H_ID':params.returnHId},\n        success:function(resp){\n          var response = Wb.decode(resp.responseText);\n          Wb.setValue(app.showWin,response.rows[0]);\n          app.DOCUMENT_DATE.setValue(response.rows[0].start);\n          app.WAREHOUSE_NAME.QUERY_LEDGER_ID.setValue(response.rows[0].LEDGER_ID);\n          app.VENDOR_NAME.QUERY_LEDGER_ID.setValue(response.rows[0].LEDGER_ID);\n          app.ORDER_H_CODE.QUERY_LEDGER_ID.setValue(response.rows[0].LEDGER_ID);\n        }\n      });\n      app.returnLGrid.store.load({\n        params:{'RETURN_H_ID':params.returnHId}\n      });\n    }\n  }\n});"},"children":[{"configs":{"maximized":"true","layout":"border","closeAction":"hide","buttonAlign":"center","itemId":"showWin","border":"false","modal":"true"},"events":{"afterrender":"//设置labelWidth\napp.ORG_NAME.ORG_NAME.setLabelWidth(100);\napp.VENDOR_NAME.VENDOR_NAME.setLabelWidth(100);\napp.CONTRACT_NAME.AP_CONTRACT_NAME.setLabelWidth(100);\napp.WAREHOUSE_NAME.WAREHOUSE_NAME.setLabelWidth(100);\napp.DEPT_NAME.DEPT_NAME.setLabelWidth(100);\napp.PROJECT_NAME.PROJECT_NAME.setLabelWidth(100);\n//设为只读\napp.CONTRACT_NAME.AP_CONTRACT_NAME.setReadOnly(true);\napp.DEPT_NAME.DEPT_NAME.setReadOnly(true);\napp.VENDOR_NAME.VENDOR_NAME.setReadOnly(true);\napp.PROJECT_NAME.PROJECT_NAME.setReadOnly(true);","close":"app.vstore.reload();"},"children":[{"configs":{"region":"north","layout":"auto","itemId":"contentForm","border":"false"},"children":[{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"{#po_return_save#}","itemId":"saveBtn","iconCls":"save_icon"},"events":{"click":"if(!Wb.verify(app.contentForm)){//form中存在非法数据\n  Wb.toast('{#po_return_data_illgal#}');\n  return;\n}\nif(!Wb.verifyGrid(app.returnLGrid)){//表格中存在非法数据\n  Wb.toast('{#po_return_data_illgal#}');\n  return;\n}\nvar lineNums = [];//行号\nvar vstore = app.returnLGrid.store;\nvar recs = vstore.getRange(0,vstore.getCount());\nfor(var i=0;i<vstore.getCount();i++){\n  lineNums.push(vstore.indexOf(recs[i])+1);\n}\nWb.request({\n  url:'{#contextPath#}'+'/poReturnAction.do?method=saveReturnData',\n  params:{'formStr':Wb.getValue(app.contentForm),'gridStr':Wb.getData(app.returnLGrid),'lineNums':lineNums,'deleteIds':deleteIds},\n  success:function(resp){\n    var response = Wb.decode(resp.responseText);\n    if(response.flag=='0'){\n      Wb.toast('{#po_return_save_success#}');\n      app.saveBtn.setDisabled(false);\n      app.submitBtn.setDisabled(false);\n      app.revokeBtn.setDisabled(true);\n      \n      Wb.request({\n        url:'m?xwl=xc/po/return/data/getReturnHDataById',\n        params:{'RETURN_H_ID':app.RETURN_H_ID.getValue()},\n        success:function(resp){\n          var response = Wb.decode(resp.responseText);\n          app.RETURN_H_CODE.setValue(response.rows[0].RETURN_H_CODE);\n        }\n      });\n    }else{\n      Wb.toast(response.msg);\n    }\n  }\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#po_return_submit#}","itemId":"submitBtn","iconCls":"up_icon"},"events":{"click":"// TODO: 取得流程编码、电脑端审批表单和移动端审批表单\nWb.request({\n  url:'{#contextPath#}'+'/apPayReqCommonAction.do?method=getProcAndFormsByCat',\n  params:{'LEDGER_ID':app.ORG_NAME.LEDGER_ID.getValue(),'AP_DOC_CAT_CODE':'THD'},\n  success:function(res){\n    var response = Wb.decode(res.responseText);\n    if(response.flag=='0'){\n      // TODO: 取得流程编码、电脑端审批表单和移动端审批表单\n      var processCode = response.PROCESS_CODE ;\n      var pcApproveForm = response.PC_A_FORM_URL ;\n      var mobileApproveForm = response.M_A_FORM_URL ;\n      // 电脑端和移动端审批表单为变量需要设置为全路径\n      pcApproveForm = '{#appIP#}' +  '/'+pcApproveForm ;\n      mobileApproveForm = '{#appIP#}' +  mobileApproveForm ;\n      // TODO: 如果流程编码存在, 则提交流程审批处理\n      if(processCode !== \"\" && processCode !== null && processCode !== undefined){\n        // 如果项目未指定，则设置默认值为 \"-1\"\n        var prjId = app.PROJECT_NAME.PROJECT_ID.getValue() ;\n        if(prjId === null || prjId === \"\" || prjId === undefined){\n          prjId = \"-1\" ;\n        }\n        var orgId = app.ORG_NAME.ORG_ID.getValue();\n        if(orgId==''){\n          return;\n        }\n        var auditStatus = app.AUDIT_STATUS.getValue();\n        var _empId = '{#XIP.empId#}' ;\n        var json = {\n          'APP_IP':'{#appIP#}',\n          'loginName':'{#XIP.userName#}',\n          'AP_DOC_CAT_NAME':'{#po_return_return_document#}',\n          'PC_A_FORM':pcApproveForm,\n          'M_A_FORM'\t:mobileApproveForm,\n          'poCatCode':'THD',\n          'DEPT_NAME':app.DEPT_NAME.DEPT_NAME.getValue(),\n          'AMT':'',\n          'e_business_id':app.RETURN_H_ID.getValue(),\n          'billType'\t : 'THD',\n          'PROJECT_ID'   : prjId,\n          'EMP_ID'       : _empId,\n          'ledgerId'     : app.ORG_NAME.LEDGER_ID.getValue(),\n          'DEPT_ID'      : app.DEPT_NAME.DEPT_ID.getValue(),\n          'ORG_ID'\t\t : orgId\n        };\n        if(auditStatus === 'A'){//起草状态\n          XipWf.startAndSubmitByProcess(processCode,json,function(e){//提交流程\n            if(e.flag === 0){\n              Wb.toast('{#po_return_submit_success#}');\n              app.saveBtn.setDisabled(true);\n              app.submitBtn.setDisabled(true);\n              app.revokeBtn.setDisabled(false);\n              app.INS_CODE.setValue(e.businessId);\n              app.vstore.reload();\n              Wb.request({\n                url:'m?xwl=xc/po/return/data/getReturnHDataById',\n                params:{'RETURN_H_ID':app.RETURN_H_ID.getValue()},\n                success:function(resp){\n                  var response = Wb.decode(resp.responseText);\n                  app.AUDIT_STATUS.setValue(response.rows[0].AUDIT_STATUS);\n                  app.AUDIT_STATUS_DESC.setValue(response.rows[0].AUDIT_STATUS_DESC);\n                  app.SYS_AUDIT_STATUS.setValue(response.rows[0].SYS_AUDIT_STATUS);\n                  app.SYS_AUDIT_STATUS_DESC.setValue(response.rows[0].SYS_AUDIT_STATUS_DESC);\n                }\n              });\n            }\n            else if(e.flag === 1){\n              Wb.toast(e.msg) ;\n            }else{}\n          });\n        }\n        else if(auditStatus === 'D'){//驳回状态\n          XipWf.submitInstance(rows[0].data.INS_CODE,json,function(e){//提交流程\n            if(e.flag === 0){\n              Wb.toast('{#po_return_submit_success#}');\n              app.saveBtn.setDisabled(true);\n              app.submitBtn.setDisabled(true);\n              app.revokeBtn.setDisabled(false);\n              app.vstore.reload();\n              app.INS_CODE.setValue(e.businessId);\n              Wb.request({\n                url:'m?xwl=xc/po/return/data/getReturnHDataById',\n                params:{'RETURN_H_ID':app.RETURN_H_ID.getValue()},\n                success:function(resp){\n                  var response = Wb.decode(resp.responseText);\n                  app.AUDIT_STATUS.setValue(response.rows[0].AUDIT_STATUS);\n                  app.AUDIT_STATUS_DESC.setValue(response.rows[0].AUDIT_STATUS_DESC);\n                  app.SYS_AUDIT_STATUS.setValue(response.rows[0].SYS_AUDIT_STATUS);\n                  app.SYS_AUDIT_STATUS_DESC.setValue(response.rows[0].SYS_AUDIT_STATUS_DESC);\n                }\n              });\n            }\n            else if(e.flag === 1){\n              Wb.toast(e.msg) ;\n            }else{}\n          });\n        }else if(auditStatus === 'R'){//撤回状态\n          // 撤回 -> 按流程实例提交流程\n          XipWf.restartAndSubmitByProcess(rows[0].data.INS_CODE,processCode,json,function(e){\n            if(e.flag === 0){\n              Wb.toast('{#po_return_submit_success#}');\n              app.saveBtn.setDisabled(true);\n              app.submitBtn.setDisabled(true);\n              app.revokeBtn.setDisabled(false);\n              app.vstore.reload();\n              app.INS_CODE.setValue(e.instanceCode);\n              Wb.request({\n                url:'m?xwl=xc/po/return/data/getReturnHDataById',\n                params:{'RETURN_H_ID':app.RETURN_H_ID.getValue()},\n                success:function(resp){\n                  var response = Wb.decode(resp.responseText);\n                  app.AUDIT_STATUS.setValue(response.rows[0].AUDIT_STATUS);\n                  app.AUDIT_STATUS_DESC.setValue(response.rows[0].AUDIT_STATUS_DESC);\n                  app.SYS_AUDIT_STATUS.setValue(response.rows[0].SYS_AUDIT_STATUS);\n                  app.SYS_AUDIT_STATUS_DESC.setValue(response.rows[0].SYS_AUDIT_STATUS_DESC);\n                }\n              });\n            }\n            else if(e.flag === 1){\n              Wb.toast(e.msg) ;\n            }else{}\n          },null);\n        }\n        else if(auditStatus === 'E' || auditStatus === 'C'){//运行中、结束状态\n          Wb.toast('{#po_re5turn_can_not_submit#}');\n          return false;\n        }\n        else{\n          Wb.toast('{#po_return_submit_fail#}');\n          return false;\n        }\n      }\n    }else if(response.flag=='1'){\n      Wb.toast(response.msg);\n    }\n\n  }\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#po_return_revoke#}","itemId":"revokeBtn","iconCls":"cancel_icon"},"events":{"click":"if(app.INS_CODE.getValue() === null || app.INS_CODE.getValue() === '') {\n  Wb.toast('{#po_return_ins_code_null#}');\n  return;\n}\n//撤回流程\nXipWf.revokeByInstance(app.INS_CODE.getValue(),function(e){\n  if (e.flag == '0' || e.flag === 0) {\n\tWb.toast(e.msg);\n    app.saveBtn.setDisabled(false);\n    app.submitBtn.setDisabled(false);\n    app.revokeBtn.setDisabled(true);\n    app.vstore.reload();\n    app.INS_CODE.setValue(e.instanceCode);\n    Wb.request({\n      url:'m?xwl=xc/po/return/data/getReturnHDataById',\n      params:{'RETURN_H_ID':app.RETURN_H_ID.getValue()},\n      success:function(resp){\n        var response = Wb.decode(resp.responseText);\n        app.AUDIT_STATUS.setValue(response.rows[0].AUDIT_STATUS);\n        app.AUDIT_STATUS_DESC.setValue(response.rows[0].AUDIT_STATUS_DESC);\n        app.SYS_AUDIT_STATUS.setValue(response.rows[0].SYS_AUDIT_STATUS);\n        app.SYS_AUDIT_STATUS_DESC.setValue(response.rows[0].SYS_AUDIT_STATUS_DESC);\n      }\n    });\n  }\n\n});\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#po_return_monitor#}","itemId":"monitorBtn","iconCls":"viewport_icon"},"events":{"click":"if(app.INS_CODE.getValue() === null || app.INS_CODE.getValue() === ''){\n  Wb.toast('{#po_return_ins_code_null#}');\n}\nelse{\n  XipWf.showMonitorPage(app.INS_CODE.getValue());\n}   \n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#po_return_enclosure#}","itemId":"enClosureBtn"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"layout":"column","margin":"10 10 0 0","itemId":"tr1","border":"false"},"children":[{"configs":{"layout":"fit","columnWidth":".25","itemId":"td1_1","border":"false"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/ORG_PICK/ORG_ALL_PICK","itemId":"ORG_NAME"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".25","itemId":"td1_4","border":"false"},"children":[{"configs":{"file":"m?xwl=xc/po/po-com-lov/ORDER_ID_PICK/ORDER_ID_LD","itemId":"ORDER_H_CODE"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".25","border":"false","itemId":"td2_3"},"children":[{"configs":{"file":"m?xwl=xc/po/po-com-lov/WAREHOUSE_ID_PICK/WAREHOUSE_ID_LD","itemId":"WAREHOUSE_NAME"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".25","border":"false","itemId":"td1_2"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/VENDOR_ID_PICK/VENDOR_ID_LD","itemId":"VENDOR_NAME"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"layout":"column","margin":"10 10 0 0","itemId":"tr2","border":"false"},"children":[{"configs":{"layout":"fit","columnWidth":".25","itemId":"td2_1","border":"false"},"children":[{"configs":{"labelWidth":"100","readOnly":"true","labelAlign":"right","itemId":"RETURN_H_CODE","fieldLabel":"{#po_return_return_code#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".25","itemId":"td3_4","border":"false"},"children":[{"configs":{"labelWidth":"100","labelAlign":"right","itemId":"DOCUMENT_DATE","fieldLabel":"{#po_return_start_date#}"},"children":[],"expanded":false,"type":"date"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".25","border":"false","itemId":"td1_3"},"children":[{"configs":{"file":"m?xwl=xc/ap/ap-com-lov/AP_CONTRACT_ID_PICK/AP_CONTRACT_ID_PICK_ALL","itemId":"CONTRACT_NAME"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".25","border":"false","itemId":"td1_31"},"children":[{"configs":{"file":"m?xwl=xc/po/pur/DEPT_ID_PICK/DEPT_ID_LD","itemId":"DEPT_NAME"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"layout":"column","margin":"10 10 10 0","itemId":"tr3","border":"false"},"children":[{"configs":{"layout":"fit","columnWidth":".25","border":"false","itemId":"td2_311"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/PROJECT_ID_PICK/PROJECT_ID_LD","itemId":"PROJECT_NAME"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".25","itemId":"td3_2","border":"false"},"children":[{"configs":{"labelWidth":"100","readOnly":"true","labelAlign":"right","itemId":"SYS_AUDIT_STATUS_DESC","fieldLabel":"{#po_return_status#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".5","itemId":"td2_2","border":"false"},"children":[{"configs":{"labelWidth":"100","labelAlign":"right","itemId":"RETURN_H_NAME","fieldLabel":"{#po_return_return_name#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"hidden":"true","itemId":"hiddenPanel"},"children":[{"configs":{"itemId":"PURCHASE_PERSON"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"AUDIT_STATUS"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"100","readOnly":"true","labelAlign":"right","itemId":"AUDIT_STATUS_DESC","fieldLabel":"{#po_pur_status#}"},"children":[],"expanded":true,"type":"text"},{"configs":{"itemId":"SYS_AUDIT_STATUS"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"INS_CODE"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"100","labelAlign":"right","itemId":"RETURN_H_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"100","labelAlign":"right","itemId":"PO_DOC_CAT_CODE"},"children":[],"expanded":false,"type":"text"}],"expanded":false,"type":"panel"}],"expanded":true,"type":"form"},{"configs":{"region":"center","selType":"checkboxmodel","itemId":"returnLGrid","editable":"true"},"children":[{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#po_return_rowNum#}","align":"center","width":"50","xtype":"rownumberer","titleAlign":"center","itemId":"rowNum"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"RETURN_L_ID","hidden":"true","dataIndex":"RETURN_L_ID","titleAlign":"center","itemId":"RETURN_L_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"MATERIAL_ID","hidden":"true","dataIndex":"MATERIAL_ID","titleAlign":"center","itemId":"MATERIAL_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#po_return_material_code#}","dataIndex":"MATERIAL_CODE","titleAlign":"center","itemId":"MATERIAL_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#po_return_material_name#}","dataIndex":"MATERIAL_NAME","titleAlign":"center","itemId":"MATERIAL_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#po_return_entry_l_num#}","dataIndex":"ENTRY_L_CODE","titleAlign":"center","itemId":"ENTRY_L_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"ENTRY_L_ID","hidden":"true","dataIndex":"ENTRY_L_ID","titleAlign":"center","itemId":"ENTRY_L_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"DIM_ID","hidden":"true","dataIndex":"DIM_ID","titleAlign":"center","itemId":"DIM_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#po_return_dim_name#}","dataIndex":"DIM_NAME","titleAlign":"center","itemId":"DIM_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#po_return_specification#}","dataIndex":"SPECIFICATION","titleAlign":"center","itemId":"SPECIFICATION_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#po_return_return_qty#}","dataIndex":"RETURN_QTY","titleAlign":"center","itemId":"RETURN_QTY_COL"},"children":[{"configs":{"allowDecimals":"true","itemId":"editor"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"column"},{"configs":{"text":"{#po_return_tax#}","dataIndex":"TAX","titleAlign":"center","itemId":"TAX_COL"},"children":[{"configs":{"allowDecimals":"true","itemId":"editor"},"children":[],"expanded":false,"type":"number"}],"expanded":false,"type":"column"},{"configs":{"text":"{#po_return_price#}","dataIndex":"PRICE","titleAlign":"center","itemId":"PRICE_COL"},"children":[{"configs":{"allowDecimals":"true","itemId":"editor"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"column"},{"configs":{"text":"{#po_return_inv_price#}","dataIndex":"INV_PRICE","titleAlign":"center","itemId":"INV_PRICE_COL"},"children":[{"configs":{"allowDecimals":"true","itemId":"editor"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"column"},{"configs":{"text":"{#po_return_amount#}","dataIndex":"AMOUNT","titleAlign":"center","itemId":"AMOUNT_COL"},"children":[{"configs":{"allowDecimals":"true","itemId":"editor"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"column"},{"configs":{"text":"{#po_return_inv_amount#}","dataIndex":"INV_AMOUNT","titleAlign":"center","itemId":"INV_AMOUNT_COL"},"children":[{"configs":{"allowDecimals":"true","itemId":"editor"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"column"}],"expanded":false,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"{#po_return_add#}","itemId":"addBtn","iconCls":"file_add_icon"},"events":{"click":"var vgrid = app.returnLGrid;\nvar orgHId = app.ORDER_H_CODE.ORDER_H_ID.getValue();\nif(Wb.isEmpty(orgHId)){//采购订单ID为空\n  Wb.toast('{#po_return_select_order_first#}');\n  return;\n}\nWb.run({\n\turl:'m?xwl=xc/po/return/xc_po_return_h_entry',\n  \tsuccess:function(app){\n    \tapp.initWin({\n          ORDER_H_ID:orgHId,\n        \thideFun:function(recs){\n            \tWb.each(recs,function(r){\n                \tr.set('RETURN_L_ID',Xip.getId());\n                  \tfor(var i=0;i<vgrid.store.getCount();i++){\n                      if(r.data.ENTRY_L_ID==vgrid.store.getAt(i).get('ENTRY_L_ID')){\n                        Wb.toast('{#po_return_record_exist#}');\n                        return;\n                      }\n                    }\n                  \tWb.add(vgrid,{\n                      'RETURN_L_ID':r.get('RETURN_L_ID'),\n                      'MATERIAL_ID':r.get('MATERIAL_ID'),\n                      'MATERIAL_CODE':r.get('MATERIAL_CODE'),\n                      'MATERIAL_NAME':r.get('MATERIAL_NAME'),\n                      'DIM_ID':r.get('DIM_ID'),\n                      'DIM_NAME':r.get('DIM_NAME'),\n                      'SPECIFICATION':r.get('SPECIFICATION'),\n                      'ENTRY_L_CODE':r.get('ENTRY_L_CODE'),\n                      'PRICE':r.get('PRICE'),\n                      'AMOUNT':r.get('AMOUNT')\n                    },'after',1,false);\n                });\n            }\n        });\n        \n    }\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item1"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#po_return_delete#}","itemId":"delBtn","iconCls":"file_delete_icon"},"events":{"click":"Wb.remove(app.returnLGrid);"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"store","url":"m?xwl=xc/po/return/data/selectReturnLDataByHId"},"events":{"remove":"deleteIds.push({'id':record.data.RETURN_L_ID});"},"children":[],"expanded":false,"type":"store"}],"expanded":false,"type":"grid"}],"expanded":true,"type":"window"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}