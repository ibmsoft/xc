{"inframe":false,"title":"","hidden":false,"roles":{"default":1},"children":[{"configs":{"serverScript":"//---------------------获取当前模块语言对应的.json文件，放到request中----------------\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xc/po/arrival/json/xc_po_arrival_h\");\nvar userId = request.getSession().getAttribute(\"XzSessionVars\").get('userId');\nrequest.setAttribute('userId',userId);\nvar contextPath = request.getContextPath();\nrequest.setAttribute(\"contextPath\",contextPath);","itemId":"module"},"events":{"finalize":"function clearOtherFn(type){\n  if(type=='xip_pub_orgs'){\n    app.VENDOR_NAME.QUERY_LEDGER_ID.setValue('');\n    app.WAREHOUSE_NAME.QUERY_LEDGER_ID.setValue('');\n    app.CONTRACT_NAME.QUERY_LEDGER_ID.setValue('');\n\n    app.CONTRACT_NAME.AP_CONTRACT_NAME.setValue('');\n    app.CONTRACT_NAME.AP_CONTRACT_ID.setValue('');\n    app.CONTRACT_ID.setValue('');\n    app.DEPT_NAME.DEPT_NAME.setValue('');\n    app.DEPT_NAME.DEPT_ID.setValue('');\n    app.VENDOR_NAME.VENDOR_ID.setValue('');\n    app.VENDOR_NAME.VENDOR_NAME.setValue('');\n    app.PROJECT_NAME.PROJECT_ID.setValue('');\n    app.PROJECT_NAME.PROJECT_NAME.setValue('');\n  }else if(type==='xc_ap_vendors'){\n\n  }else if(type==='xip_pub_depts'){\n\n  }else if(type=='xc_po_order'){\n    app.CONTRACT_NAME.AP_CONTRACT_NAME.setValue('');\n    app.CONTRACT_NAME.AP_CONTRACT_ID.setValue('');\n    app.CONTRACT_ID.setValue('');\n    app.DEPT_NAME.DEPT_NAME.setValue('');\n    app.DEPT_NAME.DEPT_ID.setValue('');\n    app.VENDOR_NAME.VENDOR_ID.setValue('');\n    app.VENDOR_NAME.VENDOR_NAME.setValue('');\n    app.PROJECT_NAME.PROJECT_ID.setValue('');\n    app.PROJECT_NAME.PROJECT_NAME.setValue('');\n  }\n\n}\n\nfunction returnRowFn(r,type){\n  if(type=='xip_pub_orgs'){\n    app.VENDOR_NAME.QUERY_LEDGER_ID.setValue(r.data.LEDGER_ID);\n    app.WAREHOUSE_NAME.QUERY_LEDGER_ID.setValue(r.data.LEDGER_ID);\n    app.CONTRACT_NAME.QUERY_LEDGER_ID.setValue(r.data.LEDGER_ID);\n    app.ORDER_H_CODE.QUERY_LEDGER_ID.setValue(r.data.LEDGER_ID);\n    \n    app.ORDER_H_CODE.ORDER_H_CODE.setValue('');\n    app.WAREHOUSE_NAME.WAREHOUSE_NAME.setValue('');\n    app.CONTRACT_NAME.AP_CONTRACT_NAME.setValue('');\n    app.CONTRACT_NAME.AP_CONTRACT_ID.setValue('');\n    app.CONTRACT_ID.setValue('');\n    app.DEPT_NAME.DEPT_NAME.setValue('');\n    app.DEPT_NAME.DEPT_ID.setValue('');\n    app.VENDOR_NAME.VENDOR_ID.setValue('');\n    app.VENDOR_NAME.VENDOR_NAME.setValue('');\n    app.PROJECT_NAME.PROJECT_ID.setValue('');\n    app.PROJECT_NAME.PROJECT_NAME.setValue('');\n  }else if(type==='xc_ap_vendors'){\n\n  }else if(type==='xc_pm_projects'){\n\n  }else if(type==='xip_pub_depts'){\n\n  }else if(type=='xc_ap_emp'){\n\n  }else if(type=='xc_po_order'){\n    app.CONTRACT_NAME.AP_CONTRACT_NAME.setValue(r.data.AP_CONTRACT_NAME);\n    app.CONTRACT_NAME.AP_CONTRACT_ID.setValue(r.data.CONTRACT_ID);\n    app.CONTRACT_ID.setValue(r.data.CONTRACT_ID);\n    app.DEPT_NAME.DEPT_NAME.setValue(r.data.DEPT_NAME);\n    app.DEPT_NAME.DEPT_ID.setValue(r.data.DEPT_ID);\n    app.VENDOR_NAME.VENDOR_ID.setValue(r.data.VENDOR_ID);\n    app.VENDOR_NAME.VENDOR_NAME.setValue(r.data.VENDOR_NAME);\n    app.PROJECT_NAME.PROJECT_ID.setValue(r.data.PROJECT_ID);\n    app.PROJECT_NAME.PROJECT_NAME.setValue(r.data.PROJECT_NAME);\n    //修改订单号之后，行信息要清空\n    app.arrivalLGrid.store.removeAll();\n  }\n}","initialize":"var deleteIds = [];\nExt.apply(app,{\n  initWin:function(params){\n    Ext.apply(app,params);\n    app.showWin.show();\n    var flag = params.flag;\n    var orgStore = app.ORG_NAME.ORG_NAME.getPicker().store;\n    if(flag=='insert'){//添加时\n      app.showWin.setTitle('{#po_arrival_add#}');\n      app.saveBtn.setDisabled(false);\n      app.submitBtn.setDisabled(true);\n      app.revokeBtn.setDisabled(true);\n      \n      app.arrivalLGrid.store.load();\n      orgStore.load({\n        callback:function(){\n          app.ORG_NAME.ORG_NAME.setValue(orgStore.getAt(0).get('ORG_NAME'));\n          app.ORG_NAME.ORG_ID.setValue(orgStore.getAt(0).get('ORG_ID'));\n          app.ORG_NAME.LEDGER_ID.setValue(orgStore.getAt(0).get('LEDGER_ID'));\n          app.VENDOR_NAME.QUERY_LEDGER_ID.setValue(orgStore.getAt(0).get('LEDGER_ID'));\n          app.WAREHOUSE_NAME.QUERY_LEDGER_ID.setValue(orgStore.getAt(0).get('LEDGER_ID'));\n          app.CONTRACT_NAME.QUERY_LEDGER_ID.setValue(orgStore.getAt(0).get('LEDGER_ID'));\n          app.ORDER_H_CODE.QUERY_LEDGER_ID.setValue(orgStore.getAt(0).get('LEDGER_ID'));\n        }\n      });\n      app.AUDIT_STATUS.setValue('A');\n      app.AUDIT_STATUS_DESC.setValue('{#po_arrival_write_out#}');\n      app.SYS_AUDIT_STATUS.setValue('A');\n      app.SYS_AUDIT_STATUS_DESC.setValue('{#po_arrival_draft#}');\n      app.PURCHASE_PERSON.setValue('{#XIP.userId#}');\n      app.DOCUMENT_DATE.setValue(new Date());\n      app.ARRIVAL_H_ID.setValue(Xip.getId());\n      app.PO_DOC_CAT_CODE.setValue('DHD');\n      \n    }else if(flag=='edit'){//修改时\n      app.showWin.setTitle('{#po_arrival_edit#}');\n      app.saveBtn.setDisabled(false);\n      app.submitBtn.setDisabled(false);\n      app.revokeBtn.setDisabled(false);\n      \n      Wb.request({//主信息赋值\n        url:'m?xwl=xc/po/arrival/data/selectArrivalHDataById',\n        params:{'ARRIVAL_H_ID':params.arrivalHId},\n        success:function(resp){\n          var rec = Wb.decode(resp.responseText);\n          Wb.setValue(app.showWin,rec.rows[0]);\n          app.DOCUMENT_DATE.setValue(rec.rows[0].doucmentDate);\n          app.ORG_NAME.ORG_ID.setValue(rec.rows[0].ORG_ID);\n          app.ORG_NAME.ORG_NAME.setValue(rec.rows[0].ORG_NAME);\n          app.ORDER_H_CODE.ORDER_H_CODE.setValue(rec.rows[0].ORDER_H_CODE);\n          app.ORDER_H_CODE.ORDER_H_ID.setValue(rec.rows[0].ORDER_H_ID);\n          app.ORDER_H_CODE.QUERY_LEDGER_ID.setValue(rec.rows[0].LEDGER_ID);\n          app.VENDOR_NAME.QUERY_LEDGER_ID.setValue(rec.rows[0].LEDGER_ID);\n          app.WAREHOUSE_NAME.QUERY_LEDGER_ID.setValue(rec.rows[0].LEDGER_ID);\n          app.CONTRACT_NAME.QUERY_LEDGER_ID.setValue(rec.rows[0].LEDGER_ID);\n          app.DEPT_NAME.USER_ID.setValue('{#XIP.userId#}');\n          app.DEPT_NAME.DEPT_ID.setValue(rec.rows[0].DEPT_ID);\n          app.DEPT_NAME.DEPT_NAME.setValue(rec.rows[0].DEPT_NAME);\n          app.PROJECT_NAME.PROJECT_ID.setValue(rec.rows[0].PROJECT_ID);\n          app.PROJECT_NAME.PROJECT_NAME.setValue(rec.rows[0].PROJECT_NAME);\n        }\n      });\n      app.arrivalLGrid.store.load({params:{'ARRIVAL_H_ID':params.arrivalHId}});\n    }\n  }\n});\n\n\nfunction add(arg1,arg2){\n  var r1,r2,m;\n  try{\n    r1 = arg1.toString().split('.')[1].length ;\n  }catch(e){\n    r1 = 0 ;\n  }\n  try{\n    r2 = arg2.toString().split('.')[1].length ;\n  }catch(e){\n    r2 = 0 ;\n  }\n  m = Math.pow(20,Math.max(r1,r2));\n  return (arg1 * m + arg2 * m) / m;\n}\n//乘法\nfunction mul(a, b) {\n    var c = 0,\n        d = a.toString(),\n        e = b.toString();\n    try {\n        c += d.split(\".\")[1].length;\n    } catch (f) {}\n    try {\n        c += e.split(\".\")[1].length;\n    } catch (f) {}\n    return Number(d.replace(\".\", \"\")) * Number(e.replace(\".\", \"\")) / Math.pow(10, c);\n}\n\n//除法\nfunction div(arg1, arg2) {  \n    var t1 = 0, t2 = 0, r1, r2;  \n    try {  \n        t1 = arg1.toString().split(\".\")[1].length;  \n    } catch (e) { }  \n    try {  \n        t2 = arg2.toString().split(\".\")[1].length;  \n    } catch (e) { }  \n    with (Math) {  \n        r1 = Number(arg1.toString().replace(\".\", \"\"));  \n        r2 = Number(arg2.toString().replace(\".\", \"\"));  \n        return (r1 / r2) * pow(10, t2 - t1);  \n    }  \n}  \nfunction returnFloat(args){\n  var value = Math.round(parseFloat(args)*100)/100;\n  var xsd=value.toString().split(\".\");\n  if(xsd.length==1){\n    value=value.toString()+\".00\";\n    return value;\n  }\n  if(xsd.length>1){\n    if(xsd[1].length<2){\n      value=value.toString()+\"0\";\n    }\n    return value;\n  }\n}"},"children":[{"configs":{"maximized":"true","layout":"border","closeAction":"hide","buttonAlign":"center","border":"false","itemId":"showWin","modal":"true"},"events":{"afterrender":"app.ORG_NAME.ORG_NAME.setLabelWidth(100);\napp.VENDOR_NAME.VENDOR_NAME.setLabelWidth(100);\napp.CONTRACT_NAME.AP_CONTRACT_NAME.setLabelWidth(100);\napp.CONTRACT_NAME.AP_CONTRACT_NAME.setReadOnly(true);\napp.VENDOR_NAME.VENDOR_NAME.setReadOnly(true);\napp.VENDOR_NAME.VENDOR_NAME.setFieldLabel('{#po_arrival_vendor_name#}');\napp.WAREHOUSE_NAME.WAREHOUSE_NAME.setLabelWidth(100);\napp.DEPT_NAME.DEPT_NAME.setLabelWidth(100);\napp.DEPT_NAME.DEPT_NAME.setFieldLabel(\"<font color='red'>*<\/font>{#po_arrival_dept#}\");\napp.DEPT_NAME.DEPT_NAME.allowBlank = false;\napp.PROJECT_NAME.PROJECT_NAME.setLabelWidth(100);\napp.PROJECT_NAME.PROJECT_NAME.setReadOnly(true);\napp.WAREHOUSE_NAME.WAREHOUSE_NAME.setFieldLabel(\"<font color='red'>*<\/font>{#po_arrival_warehouse#}\");\napp.WAREHOUSE_NAME.WAREHOUSE_NAME.allowBlank = false;\n\n//\napp.ORDER_H_CODE.ORDER_H_CODE.setFieldLabel(\"<font color='red'>*<\/font>{#po_arrival_order_code#}\");\napp.ORDER_H_CODE.ORDER_H_CODE.allowBlank = false;\n","close":"app.vstore.reload();"},"children":[{"configs":{"region":"north","layout":"auto","border":"false","itemId":"contentForm"},"children":[{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"{#po_arrival_save#}","itemId":"saveBtn","iconCls":"save_icon"},"events":{"click":"// 验证表单、表格\nif(!Wb.verify(app.contentForm)){//主信息数据不合法\n  Wb.toast('{#po_arrival_exist_illgal_data#}');\n  return;\n}\nif(!Wb.verifyGrid(app.arrivalLGrid)){//行信息数据不合法\n  Wb.toast('{#po_arrival_exist_illgal_data#}');\n  return;\n}\nvar vstore = app.arrivalLGrid.store;\nif(vstore.getCount()===0){//行信息为空\n  Wb.toast('{#po_arrival_detail_null#}');\n  return;\n}\n\n// 计算金额\nvar amount = 0;\nvar invAmount = 0;\nvar lineNums = [];\nfor(var i=0;i<vstore.getCount();i++){\n  amount+= vstore.getAt(i).get('AMOUNT');\n  invAmount+= vstore.getAt(i).get('INV_AMOUNT');\n}\nvar recs = vstore.getRange(0,vstore.getCount());\nfor(var j=0;j<recs.length;j++){\n  lineNums.push(vstore.indexOf(recs[j])+1);\n}\napp.AMOUNT.setValue(Wb.format(amount,'000.00'));//不含税金额\napp.INV_AMOUNT.setValue(Wb.format(invAmount,'000.00'));//含税金额\n\n\nWb.request({\n  url:'{#contextPath#}'+'/poArrivalAction.do?method=saveArrivalInfo',\n  params:{'formStr':Wb.getValue(app.contentForm),'gridStr':Wb.getData(app.arrivalLGrid),'deleteIds':deleteIds,'lineNums':lineNums},\n  success:function(resp){\n    var response = Wb.decode(resp.responseText);\n    if(response.flag=='0'){\n      Wb.toast('{#po_arrival_sava_success#}');\n      app.saveBtn.setDisabled(false);\n      app.submitBtn.setDisabled(false);\n      app.revokeBtn.setDisabled(true);\n      \n      Wb.request({\n        url : 'm?xwl=xc/po/arrival/data/selectArrivalHDataById',\n        params : {ARRIVAL_H_ID : app.ARRIVAL_H_ID.getValue()},\n        success : function(response){\n          var o = Wb.decode(response.responseText);\n          app.ARRIVAL_H_CODE.setValue(o.rows[0].ARRIVAL_H_CODE);\n        }\n      });\n    }else if(response.flag=='1'){\n      Wb.toast(response.msg);\n    }\n    \n  }\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#po_arrival_submit#}","itemId":"submitBtn","iconCls":"up_icon"},"events":{"click":"var ledgerId = app.ORG_NAME.LEDGER_ID.getValue();//账簿ID\nvar projectId = '';\nvar orgId = app.ORG_NAME.ORG_ID.getValue();//组织ID\nvar deptName = '';\nvar deptId = app.DEPT_NAME.DEPT_ID.getValue();\nvar bizId = app.ARRIVAL_H_ID.getValue();\n// TODO: 取得流程编码、电脑端审批表单和移动端审批表单\nWb.request({\n  url:'{#contextPath#}'+'/apPayReqCommonAction.do?method=getProcAndFormsByCat',\n  params:{'LEDGER_ID':ledgerId,'AP_DOC_CAT_CODE':'DHD'},\n  success:function(res){\n    var response = Wb.decode(res.responseText);\n    if(response.flag=='0'){\n      // TODO: 取得流程编码、电脑端审批表单和移动端审批表单\n      var processCode = response.PROCESS_CODE ;\n      var pcApproveForm = response.PC_A_FORM_URL ;\n      var mobileApproveForm = response.M_A_FORM_URL ;\n      // 电脑端和移动端审批表单为变量需要设置为全路径\n      pcApproveForm = '{#appIP#}' +  '/'+pcApproveForm ;\n      mobileApproveForm = '{#appIP#}' +  mobileApproveForm ;\n      // TODO: 如果流程编码存在, 则提交流程审批处理\n      if(processCode !== \"\" && processCode !== null && processCode !== undefined){\n        // 如果项目未指定，则设置默认值为 \"-1\"\n        var prjId = projectId ;\n        if(prjId === null || prjId === \"\" || prjId === undefined){\n          prjId = \"-1\" ;\n        }\n        if(orgId===''){\n          return;\n        }\n        var auditStatus = app.AUDIT_STATUS.getValue();\n        var _empId = '{#XIP.empId#}' ;\n        var json = {\n          'APP_IP':'{#appIP#}',\n          'loginName':'{#XIP.userName#}',\n          'AP_DOC_CAT_NAME':'{#po_arrival_arrival_document#}',\n          'PC_A_FORM':pcApproveForm,\n          'M_A_FORM':mobileApproveForm,\n          'poCatCode':'DHD',\n          'DEPT_NAME':deptName,\n          'AMT':app.AMOUNT.getValue(),\n          'e_business_id':bizId,\n          'billType': 'DHD',\n          'PROJECT_ID'   : prjId,\n          'EMP_ID'       : _empId,\n          'ledgerId'     : ledgerId,\n          'DEPT_ID'      : deptId,\n          'ORG_ID': orgId\n        };\n        if(auditStatus === 'A'){//起草状态\n          XipWf.startAndSubmitByProcess(processCode,json,function(e){//提交流程\n            if(e.flag === 0 || e.flag == '0'){\n              Wb.toast('{#po_arrival_submit_success#}');\n              app.saveBtn.setDisabled(true);\n              app.submitBtn.setDisabled(true);\n              app.revokeBtn.setDisabled(false);\n              app.INS_CODE.setValue(e.instanceCode);\n              Wb.request({\n                url:'m?xwl=xc/po/arrival/data/selectArrivalHDataById',\n                params:{'ARRIVAL_H_ID':bizId},\n                success:function(resp){\n                  var response = Wb.decode(resp.responseText);\n                  app.AUDIT_STATUS.setValue(response.rows[0].AUDIT_STATUS);\n                  app.AUDIT_STATUS_DESC.setValue(response.rows[0].AUDIT_STATUS_DESC);\n                  app.SYS_AUDIT_STATUS.setValue(response.rows[0].SYS_AUDIT_STATUS);\n                  app.SYS_AUDIT_STATUS_DESC.setValue(response.rows[0].SYS_AUDIT_STATUS_DESC);\n                }\n              });\n            }\n            else if(e.flag === 1 || e.flag == '1'){\n              Wb.toast(e.msg) ;\n            }else{}\n          });\n        }\n        else if(auditStatus === 'D'){//驳回状态\n          XipWf.submitInstance(rows[0].data.INS_CODE,json,function(e){//提交流程\n            if(e.flag === 0 || e.flag == '0'){\n              Wb.toast('{#po_arrival_submit_success#}');\n              app.saveBtn.setDisabled(true);\n              app.submitBtn.setDisabled(true);\n              app.revokeBtn.setDisabled(false);\n              app.INS_CODE.setValue(e.instanceCode);\n              Wb.request({\n                url:'m?xwl=xc/po/arrival/data/selectArrivalHDataById',\n                params:{'ARRIVAL_H_ID':bizId},\n                success:function(resp){\n                  var response = Wb.decode(resp.responseText);\n                  app.AUDIT_STATUS.setValue(response.rows[0].AUDIT_STATUS);\n                  app.AUDIT_STATUS_DESC.setValue(response.rows[0].AUDIT_STATUS_DESC);\n                  app.SYS_AUDIT_STATUS.setValue(response.rows[0].SYS_AUDIT_STATUS);\n                  app.SYS_AUDIT_STATUS_DESC.setValue(response.rows[0].SYS_AUDIT_STATUS_DESC);\n                }\n              });\n            }\n            else if(e.flag === 1 || e.flag == '1'){\n              Wb.toast(e.msg) ;\n            }else{}\n          });\n        }else if(auditStatus === 'R'){//撤回状态\n          // 撤回 -> 按流程实例提交流程\n          XipWf.restartAndSubmitByProcess(rows[0].data.INS_CODE,processCode,json,function(e){\n            if(e.flag === 0 || e.flag == '0'){\n              Wb.toast('{#po_arrival_submit_success#}');\n              app.saveBtn.setDisabled(true);\n              app.submitBtn.setDisabled(true);\n              app.revokeBtn.setDisabled(false);\n              app.INS_CODE.setValue(e.instanceCode);\n              Wb.request({\n                url:'m?xwl=xc/po/arrival/data/selectArrivalHDataById',\n                params:{'ARRIVAL_H_ID':bizId},\n                success:function(resp){\n                  var response = Wb.decode(resp.responseText);\n                  app.AUDIT_STATUS.setValue(response.rows[0].AUDIT_STATUS);\n                  app.AUDIT_STATUS_DESC.setValue(response.rows[0].AUDIT_STATUS_DESC);\n                  app.SYS_AUDIT_STATUS.setValue(response.rows[0].SYS_AUDIT_STATUS);\n                  app.SYS_AUDIT_STATUS_DESC.setValue(response.rows[0].SYS_AUDIT_STATUS_DESC);\n                }\n              });\n            }\n            else if(e.flag === 1 || e.flag == '1'){\n              Wb.toast(e.msg) ;\n            }else{}\n          },null);\n        }\n        else if(auditStatus === 'E' || auditStatus === 'C'){//运行中、结束状态\n          Wb.toast('{#po_arrival_can_not_submit#}');\n          return false;\n        }\n        else{\n          Wb.toast('{#po_arrival_submit_fail#}');\n          return false;\n        }\n      }\n    }else if(response.flag=='1' || response.flag == 1){\n      Wb.toast(response.msg);\n    }\n\n  }\n});\n\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#po_arrival_revoke#}","itemId":"revokeBtn","iconCls":"cancel_icon"},"events":{"click":"var insCode = app.INS_CODE.getValue();//实例编码\n\nif(rows[0].data.AUDIT_STATUS === 'E') {\n  Wb.toast('{#po_arrival_audited_not_revoke#}');\n  return false;\n}\nelse if(rows[0].data.AUDIT_STATUS === 'R'){\n  Wb.toast('{#po_arrival_draft_status_not_revoke#}');\n  return false;\n}else if(rows[0].data.AUDIT_STATUS === 'A'){\n  Wb.toast('{#po_arrival_draft_status_not_revoke#}');\n  return false;\n}else if(rows[0].data.AUDIT_STATUS === 'D'){\n  Wb.toast('{#po_arrival_draft_status_not_revoke#}');\n  return false;\n} else if(rows[0].data.INS_CODE === null || rows[0].data.INS_CODE === '') {\n  Wb.toast('{#po_arrival_ins_code_null#}');\n  return;\n} else {\n  //撤回流程\n  XipWf.revokeByInstance(insCode,function(e){\n    if (e.flag == '0' || e.flag === 0) {\n      Wb.toast(e.msg);\n      app.saveBtn.setDisabled(false);\n      app.submitBtn.setDisabled(false);\n      app.revokeBtn.setDisabled(true);\n      Wb.request({\n        url:'m?xwl=xc/po/arrival/data/selectArrivalHDataById',\n        params:{'ARRIVAL_H_ID':app.ARRIVAL_H_ID.getValue()},\n        success:function(resp){\n          var response = Wb.decode(resp.responseText);\n          app.AUDIT_STATUS.setValue(response.rows[0].AUDIT_STATUS);\n          app.AUDIT_STATUS_DESC.setValue(response.rows[0].AUDIT_STATUS_DESC);\n          app.SYS_AUDIT_STATUS.setValue(response.rows[0].SYS_AUDIT_STATUS);\n          app.SYS_AUDIT_STATUS_DESC.setValue(response.rows[0].SYS_AUDIT_STATUS_DESC);\n        }\n      });\n    } else {\n      Wb.toast(e.msg);\n    }\n\n  });\n}\n\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#po_arrival_monitor#}","itemId":"monitorBtn","iconCls":"viewport_icon"},"events":{"click":"var insCode = app.INS_CODE.getValue();//实例编码\nif(insCode === null ||insCode === '') {\n\tWb.toast('{#po_arrival_ins_code_null#}');\n\treturn;\n}\nXipWf.showMonitorPage(insCode);"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#po_arrival_enclosure#}","itemId":"enClosureBtn"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"layout":"column","margin":"10 10 0 0","border":"false","itemId":"tr1"},"children":[{"configs":{"layout":"fit","columnWidth":".25","border":"false","itemId":"td1_1"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/ORG_PICK/ORG_ALL_PICK","itemId":"ORG_NAME"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".25","border":"false","itemId":"td1_4"},"children":[{"configs":{"file":"m?xwl=xc/po/po-com-lov/ORDER_ID_PICK/ORDER_ID_LD","itemId":"ORDER_H_CODE"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".25","itemId":"td1_2","border":"false"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/VENDOR_ID_PICK/VENDOR_ID_LD","itemId":"VENDOR_NAME"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".25","border":"false","itemId":"td1_3"},"children":[{"configs":{"file":"m?xwl=xc/ap/ap-com-lov/AP_CONTRACT_ID_PICK/AP_CONTRACT_ID_PICK_ALL","itemId":"CONTRACT_NAME"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"}],"expanded":false,"type":"panel"},{"configs":{"layout":"column","margin":"10 10 0 0","border":"false","itemId":"tr2"},"children":[{"configs":{"layout":"fit","columnWidth":".25","border":"false","itemId":"td2_1"},"children":[{"configs":{"labelWidth":"100","readOnly":"true","labelAlign":"right","itemId":"ARRIVAL_H_CODE","fieldLabel":"{#po_arrival_arrival_code#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".25","border":"false","itemId":"td3_3"},"children":[{"configs":{"labelWidth":"100","allowBlank":"false","labelAlign":"right","itemId":"ARRIVAL_DATE","fieldLabel":"<font color='red'>*<\/font>{#po_arrival_arrival_date#}"},"children":[],"expanded":false,"type":"datetime"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".25","border":"false","itemId":"td3_4"},"children":[{"configs":{"labelWidth":"100","labelAlign":"right","itemId":"DOCUMENT_DATE","fieldLabel":"{#po_arrival_start_date#}"},"children":[],"expanded":false,"type":"date"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".25","itemId":"td2_3","border":"false"},"children":[{"configs":{"file":"m?xwl=xc/po/po-com-lov/WAREHOUSE_ID_PICK/WAREHOUSE_ID_LD","itemId":"WAREHOUSE_NAME"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"}],"expanded":false,"type":"panel"},{"configs":{"layout":"column","margin":"10 10 0 0","border":"false","itemId":"tr3"},"children":[{"configs":{"layout":"fit","columnWidth":".25","border":"false","itemId":"td1_2"},"children":[{"configs":{"file":"m?xwl=xc/po/pur/DEPT_ID_PICK/DEPT_ID_LD","itemId":"DEPT_NAME"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".25","border":"false","itemId":"td2_311"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/PROJECT_ID_PICK/PROJECT_ID_LD","itemId":"PROJECT_NAME"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".25","border":"false","itemId":"td3_21"},"children":[{"configs":{"labelWidth":"100","readOnly":"true","labelAlign":"right","itemId":"AMOUNT","fieldLabel":"{#po_arrival_amount#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".25","border":"false","itemId":"td3_22"},"children":[{"configs":{"labelWidth":"100","readOnly":"true","labelAlign":"right","itemId":"INV_AMOUNT","fieldLabel":"{#po_arrival_inv_amount#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":false,"type":"panel"},{"configs":{"layout":"column","margin":"10 10 0 0","border":"false","itemId":"tr4"},"children":[{"configs":{"layout":"fit","columnWidth":".25","border":"false","itemId":"td3_2"},"children":[{"configs":{"labelWidth":"100","readOnly":"true","labelAlign":"right","itemId":"SYS_AUDIT_STATUS_DESC","fieldLabel":"{#po_arrival_status#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".5","border":"false","itemId":"td2_2"},"children":[{"configs":{"labelWidth":"100","labelAlign":"right","itemId":"ARRIVAL_H_NAME","fieldLabel":"{#po_arrival_arrival_name#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":false,"type":"panel"},{"configs":{"hidden":"true","itemId":"hiddenPanel"},"children":[{"configs":{"itemId":"PURCHASE_PERSON"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"AUDIT_STATUS"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"100","readOnly":"true","labelAlign":"right","itemId":"AUDIT_STATUS_DESC","fieldLabel":"{#po_pur_status#}"},"children":[],"expanded":true,"type":"text"},{"configs":{"itemId":"SYS_AUDIT_STATUS"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"INS_CODE"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"100","labelAlign":"right","itemId":"CONTRACT_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"100","readOnly":"true","labelAlign":"right","itemId":"ARRIVAL_H_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"100","readOnly":"true","labelAlign":"right","itemId":"PO_DOC_CAT_CODE"},"children":[],"expanded":false,"type":"text"}],"expanded":false,"type":"panel"}],"expanded":true,"type":"form"},{"configs":{"region":"center","selType":"checkboxmodel","itemId":"arrivalLGrid","editable":"true"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/po/arrival/data/selectArrivalLDataById"},"events":{"remove":"deleteIds.push({'id':record.data.ARRIVAL_L_ID});"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"{#po_arrival_add#}","itemId":"addBtn","iconCls":"file_add_icon"},"events":{"click":"var vgrid = app.arrivalLGrid;//到货单行信息表格\nvar orderHId = app.ORDER_H_CODE.ORDER_H_ID.getValue();//采购订单ID\nvar orderHType = app.ORDER_H_CODE.ORDER_H_TYPE.getValue();//采购订单类型\nif (Ext.isEmpty(orderHId)) {\n  Wb.toast('{#qxxzcgddbh#}');\n  return false;\n}\nWb.run({\n  url:'m?xwl=xc/po/arrival/xc_po_arrival_h_order',\n  success:function(app){\n    app.initWin({\n      orderHId:orderHId,\n      orderHType:orderHType,\n      hideFun:function(recs){\n        Wb.each(recs,function(r){\n          r.set('ARRIVAL_L_ID',Xip.getId());\n          for(var i=0;i<vgrid.store.getCount();i++){\n            if(vgrid.store.getAt(i).get('ORDER_L_ID')==r.get('ORDER_L_ID')){\n              Wb.toast('{#po_arrival_order_l_num_exist#}');\n              return;\n            }\n          }\n          Wb.add(vgrid,{\n            'ARRIVAL_L_ID':r.get('ARRIVAL_L_ID'),\n            'MATERIAL_ID':r.get('MATERIAL_ID'),\n            'MATERIAL_CODE':r.get('MATERIAL_CODE'),\n            'MATERIAL_NAME':r.get('MATERIAL_NAME'),\n            'ORDER_L_NUM':r.get('ORDER_L_NUM'),\n            'ORDER_L_ID':r.get('ORDER_L_ID'),\n            'DIM_ID':r.get('DIM_ID'),\n            'DIM_NAME':r.get('DIM_NAME'),\n            'PRICE':r.get('PRICE'),\n            'INV_PRICE':r.get('INV_PRICE'),\n            'QTY':r.get('QTY'),\n            'TAX':r.get('TAX')\n          },'after',1,false);\n        });\n      }\n    });\n\n  }\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item1"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#po_arrival_delete#}","itemId":"delBtn","iconCls":"file_delete_icon"},"events":{"click":"Wb.remove(app.arrivalLGrid);"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#po_arrival_rowNum#}","xtype":"rownumberer","width":"50","align":"center","titleAlign":"center","itemId":"rowNum"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"ARRIVAL_L_ID","hidden":"true","dataIndex":"ARRIVAL_L_ID","titleAlign":"center","itemId":"ARRIVAL_L_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"MATERIAL_ID","hidden":"true","dataIndex":"MATERIAL_ID","titleAlign":"center","itemId":"MATERIAL_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#po_arrival_material_code#}","dataIndex":"MATERIAL_CODE","titleAlign":"center","itemId":"MATERIAL_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#po_arrival_material_name#}","dataIndex":"MATERIAL_NAME","titleAlign":"center","itemId":"MATERIAL_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#po_arrival_order_l_num#}","dataIndex":"ORDER_L_NUM","titleAlign":"center","itemId":"ORDER_L_NUM_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"DIM_ID","hidden":"true","dataIndex":"DIM_ID","titleAlign":"center","itemId":"DIM_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#po_arrival_dim_name#}","dataIndex":"DIM_NAME","titleAlign":"center","itemId":"DIM_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"<font color='red'>*<\/font>{#po_arrival_qty#}","hidden":"true","align":"right","dataIndex":"QTY","titleAlign":"center","itemId":"QTY_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"<font color='red'>*<\/font>{#po_arrival_arrival_qty#}","align":"right","dataIndex":"ARRIVAL_QTY","titleAlign":"center","itemId":"ARRIVAL_QTY_COL"},"children":[{"configs":{"allowBlank":"false","minValue":"0","itemId":"editor","allowDecimals":"true"},"events":{"change":"\n// 数量   数量改变时，修改 含税金额\nif (Ext.isEmpty(newValue)) {\n  return false;\n}\n\nvar rec = app.arrivalLGrid.getSelection()[0];\nvar qty = newValue;\n// 含税单价\nvar inv_price = rec.data.INV_PRICE;\ninv_price = Ext.isEmpty(inv_price)? 0 : inv_price;\n\n// 不含税单价\nvar price = rec.data.PRICE;\nprice = Ext.isEmpty(price)? 0 : price;\n\n// 修改含税金额\nvar inv_amount = inv_price * qty;\nrec.set('INV_AMOUNT',inv_amount);\n\n// 修改不含税金额\nvar amount = price * qty;\nrec.set('AMOUNT',amount);"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"column"},{"configs":{"text":"{#po_arrival_tax#}","align":"right","dataIndex":"TAX","titleAlign":"center","itemId":"TAX_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#po_arrival_price#}","align":"right","dataIndex":"PRICE","titleAlign":"center","itemId":"PRICE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#po_arrival_inv_price#}","align":"right","dataIndex":"INV_PRICE","titleAlign":"center","itemId":"INV_PRICE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#po_arrival_amount#}","align":"right","dataIndex":"AMOUNT","titleAlign":"center","itemId":"AMOUNT_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#po_arrival_inv_amount#}","align":"right","dataIndex":"INV_AMOUNT","titleAlign":"center","itemId":"INV_AMOUNT_COL"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":false,"type":"grid"}],"expanded":true,"type":"window"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}