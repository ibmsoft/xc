{"inframe":false,"title":"付款单录入","hidden":false,"roles":{"default":1},"children":[{"configs":{"serverScript":"// 获取模块语言对应的json文件\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xc/ap/pay/XC_AP_PAY_H\");\nvar contextPath = request.getContextPath();\nrequest.setAttribute(\"contextPath\",contextPath);\n\nrequest.setAttribute('opmode','view');\nrequest.setAttribute('vtype','normal');","itemId":"module"},"events":{"finalize":"Wb.isInsert = 'Y';\nWb.docCatCode = '{#AP_DOC_CAT_CODE#}';\n\nExt.apply(app,{\n  grid : null\n});\napp.AP_DOC_CAT_CODE.setValue(Wb.docCatCode);\nif(Wb.docCatCode=='FKD_CGJS'){\n  app.grid1.show();\n  app.grid = app.grid1;\n  app.SOURCE.getStore().removeAt(0);\n  app.SOURCE.getStore().removeAt(2);\n  app.SOURCE.getStore().removeAt(2);\n}\nif(Wb.docCatCode=='FKD_CGJS-H'){\n  app.grid2.show();\n  app.grid = app.grid2;\n  app.SOURCE.getStore().removeAt(1);\n  app.SOURCE.getStore().removeAt(1);\n  app.SOURCE.getStore().removeAt(1);\n  app.SOURCE.getStore().removeAt(1);\n  app.SOURCE.setValue('GL_H');//只能是应付单红字\n}\nif(Wb.docCatCode=='FKD_YUFK'){\n  app.grid3.show();\n  app.grid = app.grid3;\n  app.SOURCE.getStore().removeAt(0);\n  app.SOURCE.getStore().removeAt(0);\n  app.SOURCE.getStore().removeAt(1);\n}\nif(Wb.docCatCode=='FKD_YUFK-H'){\n  app.grid4.show();\n  app.grid = app.grid4;\n  app.SOURCE.getStore().removeAt(0);\n  app.SOURCE.getStore().removeAt(0);\n  app.SOURCE.getStore().removeAt(0);\n}\nif(Wb.docCatCode=='FKD_QTFK'){\n  app.td_2_4.hide();\n  app.grid5.show();\n  app.grid = app.grid5;\n  app.SOURCE.getStore().removeAt(0);\n  app.SOURCE.getStore().removeAt(0);\n  app.SOURCE.getStore().removeAt(1);\n}\nif(Wb.docCatCode=='FKD_QTFK-H'){\n  app.td_2_4.hide();\n  app.grid6.show();\n  app.grid = app.grid6;\n  app.SOURCE.getStore().removeAt(0);\n  app.SOURCE.getStore().removeAt(0);\n  app.SOURCE.getStore().removeAt(0);\n  app.SOURCE.getStore().removeAt(0);\n}\n\nif(Wb.isInsert=='Y'){\n      app.GL_DATE.setValue(new Date());\n      app.CREATED_BY_NAME.setValue('{#XIP.empName#}');\n      app.AP_PAY_H_ID.setValue(Xip.getId());\n      app.grid.store.load({\n        params:{AP_PAY_H_ID:app.AP_PAY_H_ID.getValue()}\n      });\n    }\nif(Wb.isInsert=='N'){\n  Wb.request({\n    url: 'm?xwl=xc/ap/pay/DB/XC_AP_PAY_H_SELECT_BY_ID',\n    params: {AP_PAY_H_ID:Wb.keyValue},\n    success: function(resp) {\n      var r = Wb.decode(resp.responseText);\n      r.GL_DATE=Wb.strToDate(r.GL_DATE);\n      Wb.setValue(app.editWinN,r);\n      app.VENDOR_ID_XWL.QUERY_LEDGER_ID.setValue(r.LEDGER_ID);\n      app.PROJECT_ID_XWL.QUERY_LEDGER_ID.setValue(r.LEDGER_ID);\n      app.DEPT_ID_XWL.QUERY_LEDGER_ID.setValue(r.LEDGER_ID);\n      app.ACCOUNT_NAME_XWL.QUERY_VENDOR_ID.setValue(r.VENDOR_ID);\n      \n      app.grid.store.load({\n        params:{AP_PAY_H_ID:app.AP_PAY_H_ID.getValue()}\n      });\n      \n//       if(Wb.docCatCode=='FKD_CGJS'){\n//         app.grid1.getStore().reload({params:{\n//           AP_PAY_H_ID:Wb.keyValue\n//         }});\n//       }\n//       if(Wb.docCatCode=='FKD_CGJS-H'){\n//         app.grid2.getStore().reload({params:{\n//           AP_PAY_H_ID:Wb.keyValue\n//         }});\n//       }\n//       if(Wb.docCatCode=='FKD_YUFK'){\n//         app.grid3.getStore().reload({params:{\n//           AP_PAY_H_ID:Wb.keyValue\n//         }});\n//       }\n//       if(Wb.docCatCode=='FKD_YUFK-H'){\n//         app.grid4.getStore().reload({params:{\n//           AP_PAY_H_ID:Wb.keyValue\n//         }});\n//       }\n//       if(Wb.docCatCode=='FKD_QTFK'){\n//         app.grid5.getStore().reload({params:{\n//           AP_PAY_H_ID:Wb.keyValue\n//         }});\n//       }\n//       if(Wb.docCatCode=='FKD_QTFK-H'){\n//         app.grid6.getStore().reload({params:{\n//           AP_PAY_H_ID:Wb.keyValue\n//         }});\n//       }\n\n    }\n  });\n}\nif(Wb.isInsert=='S'){\n  Wb.request({\n    url: 'm?xwl=xc/ap/pay/DB/XC_AP_PAY_H_SELECT_BY_ID',\n    params: {AP_PAY_H_ID:Wb.keyValue},\n    success: function(resp) {\n      var r = Wb.decode(resp.responseText);\n      r.GL_DATE=Wb.strToDate(r.GL_DATE);\n      Wb.setValue(app.editWinN,r);\n      \n      app.grid.store.load({\n        params:{AP_PAY_H_ID:app.AP_PAY_H_ID.getValue()}\n      });\n      \n//       if(Wb.docCatCode=='FKD_CGJS'){\n//         app.grid1.getStore().reload({params:{\n//           AP_PAY_H_ID:Wb.keyValue\n//         }});\n//       }\n//       if(Wb.docCatCode=='FKD_CGJS-H'){\n//         app.grid2.getStore().reload({params:{\n//           AP_PAY_H_ID:Wb.keyValue\n//         }});\n//       }\n//       if(Wb.docCatCode=='FKD_YUFK'){\n//         app.grid3.getStore().reload({params:{\n//           AP_PAY_H_ID:Wb.keyValue\n//         }});\n//       }\n//       if(Wb.docCatCode=='FKD_YUFK-H'){\n//         app.grid4.getStore().reload({params:{\n//           AP_PAY_H_ID:Wb.keyValue\n//         }});\n//       }\n//       if(Wb.docCatCode=='FKD_QTFK'){\n//         app.grid5.getStore().reload({params:{\n//           AP_PAY_H_ID:Wb.keyValue\n//         }});\n//       }\n//       if(Wb.docCatCode=='FKD_QTFK-H'){\n//         app.grid6.getStore().reload({params:{\n//           AP_PAY_H_ID:Wb.keyValue\n//         }});\n//       }\n    }\n  });\n  app.form1Tbar.hide();\n  app.grid1Tbar.hide();\n  app.grid2Tbar.hide();\n  app.grid3Tbar.hide();\n  app.grid4Tbar.hide();\n  app.grid5Tbar.hide();\n  app.grid6Tbar.hide();\n}\n\nfunction returnRowFn(r,type){\n  //选择账簿后给相关的组件赋值\n  if(type=='xc_gl_ledgers'){\n    app.VENDOR_ID_XWL.QUERY_LEDGER_ID.setValue(r.data.LEDGER_ID);\n    app.PROJECT_ID_XWL.QUERY_LEDGER_ID.setValue(r.data.LEDGER_ID);\n    app.DEPT_ID_XWL.QUERY_LEDGER_ID.setValue(r.data.LEDGER_ID);\n    app.AP_CONTRACT_ID_XWL.QUERY_LEDGER_ID.setValue(r.data.LEDGER_ID);\n    app.DEPOSIT_BANK_NAME_XWL.QUERY_LEDGER_ID.setValue(r.data.LEDGER_ID);\n    app.PAY_ACC_ID_PICK_XWL.QUERY_LEDGER_ID.setValue(r.data.LEDGER_ID);\n  }\n  //选择供应商后\n  if (type == 'xc_ap_vendors') {\n    //合同\n    app.AP_CONTRACT_ID_XWL.QUERY_VENDOR_ID.setValue(r.data.VENDOR_ID);\n    app.AP_CONTRACT_ID_XWL.AP_CONTRACT_ID.reset();\n    app.AP_CONTRACT_ID_XWL.AP_CONTRACT_NAME.reset();\n    //开户行\n    app.ACCOUNT_NAME_XWL.QUERY_VENDOR_ID.setValue(r.data.VENDOR_ID); \n    app.ACCOUNT_NAME_XWL.ACCOUNT_NAME.reset();\n    app.DEPOSIT_BANK_NAME.reset();\n    app.BANK_ACCOUNT.reset();\n  }\n  //选择部门后\n  if(type == 'xip_pub_depts') {\n    app.PROJECT_ID_XWL.QUERY_DEPT_ID.setValue(r.data.DEPT_ID);\n    app.PROJECT_ID_XWL.PROJECT_ID.reset();\n    app.PROJECT_ID_XWL.PROJECT_NAME.reset();\n  }  \n  //选择项目后\n  if(type == 'xc_pm_projects') {\n    if(Wb.isEmpty(app.DEPT_ID_XWL.DEPT_ID.getValue())){//回带部门\n      app.PROJECT_ID_XWL.QUERY_DEPT_ID.setValue(r.data.DEPT_ID);\n      app.DEPT_ID_XWL.DEPT_ID.setValue(r.data.DEPT_ID);\n      app.DEPT_ID_XWL.DEPT_NAME.setValue(r.data.DEPT_NAME);\n    }\n  }\n  //选择合同名称后\n  if (type == 'xc_ap_contract') {\n    if(Wb.isEmpty(app.VENDOR_ID_XWL.VENDOR_ID.getValue())){//回带供应商\n      app.AP_CONTRACT_ID_XWL.QUERY_VENDOR_ID.setValue(r.data.VENDOR_ID);\n      app.VENDOR_ID_XWL.VENDOR_ID.setValue(r.data.VENDOR_ID);\n      app.VENDOR_ID_XWL.VENDOR_NAME.setValue(r.data.VENDOR_NAME);\n      app.ACCOUNT_NAME_XWL.QUERY_VENDOR_ID.setValue(r.data.VENDOR_ID);\n    }\n  }\n  //选择付款账户后\n  if(type=='xc_gl_ld_deposit_bank'){\n    app.PAY_ACC_ID_PICK_XWL.PAY_ACC_ID.setValue(r.data.ACC_ID);\n    app.PAY_ACC_ID_PICK_XWL.PAY_ACC_NAME.setValue(r.data.ACC_NAME);\n  }\n  //选择开户行后\n  if(type=='xc_ap_vendor_banks'){\n    app.DEPOSIT_BANK_NAME.setValue(r.data.DEPOSIT_BANK_NAME);\n    app.BANK_ACCOUNT.setValue(r.data.BANK_ACCOUNT);\n  }\n}\nfunction clearOtherFn(type){\n  if(type=='xc_gl_ledgers'){\n    //清空供应商相关信息\n    app.VENDOR_ID_XWL.VENDOR_ID.reset();\n    app.VENDOR_ID_XWL.VENDOR_NAME.reset();\n    //清空部门相关信息\n    app.DEPT_ID_XWL.DEPT_ID.reset();\n    app.DEPT_ID_XWL.DEPT_NAME.reset();\n    //清空项目相关信息\n    app.PROJECT_ID_XWL.QUERY_DEPT_ID.reset();\n    app.PROJECT_ID_XWL.PROJECT_ID.reset();\n    app.PROJECT_ID_XWL.PROJECT_NAME.reset();\n    //清空合同相关信息\n    app.AP_CONTRACT_ID_XWL.QUERY_VENDOR_ID.reset();\n    app.AP_CONTRACT_ID_XWL.AP_CONTRACT_ID.reset();\n    app.AP_CONTRACT_ID_XWL.AP_CONTRACT_NAME.reset();\n    //清空付款账户相关信息\n    app.DEPOSIT_BANK_NAME_XWL.DEPOSIT_BANK_ID.reset();\n    app.DEPOSIT_BANK_NAME_XWL.D_B_NAME.reset();\n    //清空付款科目相关信息\n    app.PAY_ACC_ID_PICK_XWL.PAY_ACC_ID.reset();\n    app.PAY_ACC_ID_PICK_XWL.PAY_ACC_NAME.reset();\n    //清空开户名相关信息\n    app.ACCOUNT_NAME_XWL.QUERY_VENDOR_ID.reset();\n    app.ACCOUNT_NAME_XWL.ACCOUNT_NAME.reset();\n    app.DEPOSIT_BANK_NAME.reset();\n    app.BANK_ACCOUNT.reset();\n  }\n  //清空供应商信息时，同时清空合同名称信息\n  if(type == 'xc_ap_vendors') {\n    //清空合同相关信息\n    app.AP_CONTRACT_ID_XWL.QUERY_VENDOR_ID.reset();\n    app.AP_CONTRACT_ID_XWL.AP_CONTRACT_ID.reset();\n    app.AP_CONTRACT_ID_XWL.AP_CONTRACT_NAME.sreset();\n    //清空开户名相关信息\n    app.ACCOUNT_NAME_XWL.QUERY_VENDOR_ID.reset();\n    app.ACCOUNT_NAME_XWL.ACCOUNT_NAME.reset();\n    app.DEPOSIT_BANK_NAME.reset();\n    app.BANK_ACCOUNT.reset();\n  }\n  //清空部门同时\n  if(type == 'xip_pub_depts') {\n    //项目\n    app.PROJECT_ID_XWL.QUERY_DEPT_ID.reset();\n    app.PROJECT_ID_XWL.PROJECT_ID.reset();\n    app.PROJECT_ID_XWL.PROJECT_NAME.reset();\n  }\n  if(type=='cancelLedger'){\n    app.form1.getForm().reset();\n  }\n}\n\n\n//清空开户名的同时开户行和账户信息\nfunction clearBank(type) {\n  if(type=='bank') {\n     app.DEPOSIT_BANK_NAME.reset();\n     app.BANK_ACCOUNT.reset();\n  }\n}\n\n//清空付款账户的同时清空付款科目\nfunction clearPayAcc(type){\n  if(type=='payAcc') {\n     app.PAY_ACC_ID.reset();\n     app.PAY_ACC_NAME.reset();\n  }\n  \n}\n","initialize":"Wb.docCatCode = 'X';"},"children":[{"configs":{"itemId":"request"},"children":[{"configs":{"autoLoad":"true","itemId":"ldInitStore","url":"m?xwl=xc/com-lov/LEDGER_ID_PICK/DB/XC_GL_LEDGERS_SELECT_SEC"},"events":{"load":"app.LEDGER_ID_XWL.LEDGER_ID.setValue(store.getAt(0).get('LEDGER_ID'));\napp.LEDGER_ID_XWL.LEDGER_NAME.setValue(store.getAt(0).get('LEDGER_NAME'));\napp.VENDOR_ID_XWL.QUERY_LEDGER_ID.setValue(store.getAt(0).get('LEDGER_ID'));\napp.PROJECT_ID_XWL.QUERY_LEDGER_ID.setValue(store.getAt(0).get('LEDGER_ID'));\napp.DEPT_ID_XWL.QUERY_LEDGER_ID.setValue(store.getAt(0).get('LEDGER_ID'));\napp.AP_CONTRACT_ID_XWL.QUERY_LEDGER_ID.setValue(store.getAt(0).get('LEDGER_ID'));\napp.DEPOSIT_BANK_NAME_XWL.QUERY_LEDGER_ID.setValue(store.getAt(0).get('LEDGER_ID'));\napp.PAY_ACC_ID_PICK_XWL.QUERY_LEDGER_ID.setValue(store.getAt(0).get('LEDGER_ID'));\nWb.request({\n  url: 'm?xwl=xc/ap/inv/DB/XC_GL_LD_DEPTS_ASG_SELECT',\n  params: {LEDGER_ID:store.getAt(0).get('LEDGER_ID')},\n  success: function(resp) {\n   var r = Wb.decode(resp.responseText);\n   app.DEPT_ID_XWL.DEPT_ID.setValue(r.DEPT_ID);\n   app.DEPT_ID_XWL.DEPT_NAME.setValue(r.DEPT_NAME);\n  }\n});"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"folder"},{"configs":{"itemId":"form1Tbar"},"children":[{"configs":{"text":"{#addBtn#}","itemId":"addBtn"},"events":{"click":"app.form1.getForm().reset();\napp.LEDGER_ID_XWL.LEDGER_NAME.setReadOnly(false);\napp.AP_PAY_H_ID.setValue(Xip.getId());\napp.AP_DOC_CAT_CODE.setValue(Wb.docCatCode);\nWb.isInsert = 'Y';\napp.GL_DATE.setValue(new Date());\napp.CREATED_BY_NAME.setValue('{#XIP.empName#}');\napp.ldInitStore.load();\n\tif(Wb.docCatCode=='CGJS'){\n        app.grid1.getStore().reload({params:{\n          AP_PAY_H_ID:app.AP_PAY_H_ID.getValue()\n        }});\n      }\n      if(Wb.docCatCode=='CGJS-H'){\n        app.grid2.getStore().reload({params:{\n          AP_PAY_H_ID:app.AP_PAY_H_ID.getValue()\n        }});\n      }\n      if(Wb.docCatCode=='YUFK'){\n        app.grid3.getStore().reload({params:{\n          AP_PAY_H_ID:app.AP_PAY_H_ID.getValue()\n        }});\n      }\n      if(Wb.docCatCode=='YUFK-H'){\n        app.grid4.getStore().reload({params:{\n          AP_PAY_H_ID:app.AP_PAY_H_ID.getValue()\n        }});\n      }\n      if(Wb.docCatCode=='QTFK'){\n        app.grid5.getStore().reload({params:{\n          AP_PAY_H_ID:app.AP_PAY_H_ID.getValue()\n        }});\n      }\n      if(Wb.docCatCode=='QTFK-H'){\n        app.grid6.getStore().reload({params:{\n          AP_PAY_H_ID:app.AP_PAY_H_ID.getValue()\n        }});\n      }\n//显示保存按钮\napp.saveBtn.setDisabled(false);"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#saveBtn#}","itemId":"saveBtn"},"events":{"click":"var srcAmt = 0;\nvar grid = '';\nvar type = '';//蓝字L、红字H\n//采购结算\nif (Wb.docCatCode == 'FKD_CGJS') {\n  grid = app.grid1;\n  type = 'L';\n}\n//采购结算-红字\nif (Wb.docCatCode == 'FKD_CGJS-H') {\n  grid = app.grid2;\n  type = 'H';\n}\n//预付款\nif (Wb.docCatCode == 'FKD_YUFK') {\n  grid = app.grid3;\n  type = 'L';\n}\n//预付款-红字\nif (Wb.docCatCode == 'FKD_YUFK-H') {\n  grid = app.grid4;\n  type = 'H';\n}\n//其它付款\nif (Wb.docCatCode == 'FKD_QTFK') {\n  grid = app.grid5;\n  type = 'L';\n}\n//其它付款-红字\nif (Wb.docCatCode == 'FKD_QTFK-H') {\n  grid = app.grid6;\n  type = 'H';\n}\n\nvar getCount = grid.getStore().getCount();\nif (getCount === 0) {\n  Wb.toast('请先添加明细数据!');\n  return;\n}\nfor (var i = 0; i < getCount; i++) {\n  var r = grid.getStore().getAt(i);\n  srcAmt = srcAmt + r.get('AMOUNT');\n}\napp.AMOUNT.setValue(srcAmt);\n//判断金额是否合法\nif(type == 'L'){\n  if(app.AMOUNT.getValue() <= 0){Wb.toast('付款金额应大于0！');return false;}\n}else{\n  if(app.AMOUNT.getValue() >= 0){Wb.toast('付款金额应小于0！');return false;}  \n}\nif (!Wb.verify(app.form1)) {\n  Wb.toast('表单存在非空项或者输入的数据不合法！');\n  return;\n}\nif (!Wb.verifyGrid(grid)) {\n  Wb.toast('表格存在非空项或者输入的数据不合法！');\n  return;\n}\n\n\n//获取行数据\nvar newRecs = grid.store.getNewRecords();\nvar updateRecs = grid.store.getUpdatedRecords();\nvar deleteRecs = grid.store.getRemovedRecords();\n\nWb.request({\n  url : '{#contextPath#}/apPayBaseAction.do?method=saveApPay',\n  params : {apPayH : Wb.getValue(app.form1),\n            newRecs : Wb.getData(newRecs),\n            updateRecs : Wb.getData(updateRecs),\n            deleteRecs : Wb.getData(deleteRecs),\n            opType : Wb.isInsert\n           },\n  success : function(resp){\n    var obj = Wb.decode(resp.responseText);\n    if(obj.flag == '0'){\n      Wb.toast(obj.msg);\n      app.AP_PAY_H_ID.setValue(obj.AP_PAY_H_ID); \n      app.AP_PAY_H_CODE.setValue(obj.AP_PAY_H_CODE);\n      app.V_HEAD_ID.setValue(obj.V_HEAD_ID);\n      app.V_STATUS_NAME.setValue(\"草稿\");\n      Wb.isInsert = \"N\";\n      grid.store.load({\n        params : {AP_PAY_H_ID: app.AP_PAY_H_ID.getValue()}\n      });\n    }else{\n      Wb.toast(obj.msg);\n    }\n  }\n});\n\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#verfyBtn#}","itemId":"verfyBtn"},"events":{"click":"var headId = app.V_HEAD_ID.getValue();\nif(headId === '' || headId === null){\n    Wb.toast(\"请先保存数据，并生成凭证!\");\n    return;\n}\n\nif(app.V_STATUS_NAME.getValue() !== '草稿'){\n    Wb.toast('单据已经审核通过！');\n    return;\n}\nelse{\n    var docArray = [] ;\n    var paramJson = {'headId' : app.V_HEAD_ID.getValue(),'apId':app.AP_PAY_H_ID.getValue(),apCatCode:'FKD'} ;\n    docArray.push(paramJson) ;\n    Wb.request({\n        url: '{#contextPath#}'+'/apVoucherAction.do?method=checkVoucher',\n        params: Wb.apply({apInfo: docArray}),\n        success: function(resp) {\n            var record = Wb.decode(resp.responseText);\n            var msg = record.msg;\n            if(record.flag === '0'){\n                Wb.toast(msg);\n                app.V_STATUS_NAME.setValue('审核通过');\n                app.saveBtn.setDisabled(true);\n            }\n            if(record.flag === '1'){\n                Wb.toast(msg);\n            }\n        }\n\t});\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#cancelVerfyBtn#}","itemId":"cancelVerfyBtn"},"events":{"click":"var headId = app.V_HEAD_ID.getValue();\nif(headId === '' || headId === null){\n    Wb.toast('请先保存数据，并审核单据!');\n    return;\n}\nif(app.V_STATUS_NAME.getValue() === '草稿'){\n    Wb.toast('请先审核单据！!');\n    return;\n}\nelse{\n    var docArray = [] ;\n    var paramJson = {'headId' : app.V_HEAD_ID.getValue(),'apId':app.AP_PAY_H_ID.getValue(),apCatCode:'FKD'} ;\n    docArray.push(paramJson) ;\n    Wb.request({\n        url: '{#contextPath#}'+'/apVoucherAction.do?method=cancelCheckVoucher',\n        params: Wb.apply({apInfo: docArray}),\n        success: function(resp) {\n            var record = Wb.decode(resp.responseText);\n            var msg = record.msg;\n            app.V_STATUS_NAME.setValue('草稿');\n            app.saveBtn.setDisabled(false);\n            Wb.toast(msg);\n        }\n\t});\n}"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"layout":"fit","itemId":"viewport1"},"children":[{"configs":{"itemId":"tabs"},"events":{"beforetabchange":"//加载凭证信息\nif(newCard.title === app.edit_v_xwl.xwl_v_panel.title){\n  Wb.request({\n    url: 'm?xwl=xc/gl/journal/data-db/common-data/select-v-head',\n    params: {'headId' : app.V_HEAD_ID.getValue()},\n    success: function(resp) {\n      var headJson = Wb.decode(resp.responseText);\n      Wb.setValue(app.edit_v_xwl.form1,headJson);\n      Wb.setValue(app.edit_v_xwl.bbar,headJson);\n      //处理会计日期\n      var accDate = headJson.accountDate;\n      app.edit_v_xwl.accountDate.setValue(Wb.strToDate(accDate));\n      // 加载凭证分录行\n      app.edit_v_xwl.grid1.getStore().load({params :{'headId':app.V_HEAD_ID.getValue()}});\n    }\n  });\n\n}"},"children":[{"configs":{"title":"付款单","layout":"border","itemId":"tab1"},"children":[{"configs":{"region":"center","tbar":"app.form1Tbar","autoScroll":"true","border":"false","itemId":"form1"},"children":[{"configs":{"style":"fontSize:20px","html":"<font style=\"\">付款单<\/font>","margin":"10 0 20 0","labelAlign":"center","itemId":"title"},"children":[],"expanded":false,"type":"label"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"column","margin":"10 10 10 0","itemId":"tr1"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"fit","columnWidth":".25","itemId":"td_1_1"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/LEDGER_ID_PICK/LEDGER_ID_PICK_SEC","itemId":"LEDGER_ID_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"fit","columnWidth":".25","itemId":"td_1_2"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","allowBlank":"false","pickList":"[\n  ['FKD_CGJS','采购结算'],\n  ['FKD_YUFK','预付款'],\n  ['FKD_QTFK','其它付款'],\n  ['FKD_CGJS-H','采购结算-红字'],\n  ['FKD_YUFK-H','预付款-红字'],\n  ['FKD_QTFK-H','其它付款-红字']\n]","labelAlign":"right","itemId":"AP_DOC_CAT_CODE","fieldLabel":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#AP_DOC_CAT_CODE_L#}"},"events":{"change":"if(newValue=='FKD_CGJS-H'||newValue=='FKD_YUFK-H'||newValue=='FKD_QTFK-H'){\n\tapp.title.setText('<font style=\"color:red;\">付款单<\/font>',false);\n    app.AMOUNT.setFieldStyle('color:red;');\n}\nif(newValue === 'FKD_YUFK' || newValue === 'FKD_YUFK-H'){\n\tapp.AP_CONTRACT_ID_XWL.AP_CONTRACT_NAME.setFieldLabel('<font style=\"color:red;\">*<\/font>'+'合同名称');\n    app.AP_CONTRACT_ID_XWL.AP_CONTRACT_NAME.allowBlank = false;\n}"},"children":[],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"fit","columnWidth":".25","itemId":"td_1_3"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","emptyText":"系统自动生成","labelAlign":"right","itemId":"AP_PAY_H_CODE","fieldLabel":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#AP_PAY_H_CODE#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"fit","columnWidth":".25","itemId":"td_1_4"},"children":[{"configs":{"labelWidth":"80","allowBlank":"false","labelAlign":"right","itemId":"GL_DATE","fieldLabel":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#GL_DATE#}"},"children":[],"expanded":false,"type":"date"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"column","margin":"10 10 10 0","split":"true","itemId":"tr2"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"fit","columnWidth":".25","itemId":"td_2_1"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/VENDOR_ID_PICK/VENDOR_ID_LD","itemId":"VENDOR_ID_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"fit","columnWidth":".25","itemId":"td_2_2"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/DEPT_ID_PICK/DEPT_ID_LD","itemId":"DEPT_ID_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"fit","columnWidth":".25","itemId":"td_1_3"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/PROJECT_ID_PICK/PROJECT_ID_LD","itemId":"PROJECT_ID_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"fit","columnWidth":".25","itemId":"td_2_4"},"children":[{"configs":{"file":"m?xwl=xc/ap/ap-com-lov/AP_CONTRACT_ID_PICK/AP_CONTRACT_ID_PICK_ALL","itemId":"AP_CONTRACT_ID_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"column","margin":"10 10 10 0","itemId":"tr3"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"fit","columnWidth":".25","itemId":"td_3_1"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"AMOUNT","fieldLabel":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#AMOUNT#}"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"fit","columnWidth":".25","itemId":"td_3_2"},"children":[{"configs":{"labelWidth":"80","allowBlank":"false","pickList":"[\n  ['GL_H','应付单(红字)'],\n  ['GL_L','应付单(蓝字)'],\n  ['REQ','申请单'],\n  ['PAY','付款单'],\n  ['TEMP','手工模板']\n]","labelAlign":"right","itemId":"SOURCE","fieldLabel":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#SOURCE#}"},"events":{"change":"app.grid1ReqBtn.hide();\napp.grid1InqGlBtn.hide();\napp.grid2PayBtn.hide();\napp.grid2InqGlHBtn.hide();\napp.grid3ReqBtn.hide();\napp.grid3CreateBtn.hide();\napp.grid4PayBtn.hide();\napp.grid4CreateBtn.hide();\napp.grid5ReqBtn.hide();\napp.grid5PurTypeBtn.hide();\napp.grid6CreateBtn.hide();\napp.grid1ApPayReqHCode.hide();\napp.grid2ApPayHCode.hide();\napp.grid4ApPayHCode.hide();\napp.grid5ApPayReqHCode.hide();\n// app.grid1.store.removeAll();//改变来源之后，把之前的数据移除store中\n// app.grid2.store.removeAll();//改变来源之后，把之前的数据移除store中\n// app.grid3.store.removeAll();//改变来源之后，把之前的数据移除store中\n// app.grid4.store.removeAll();//改变来源之后，把之前的数据移除store中\n// app.grid5.store.removeAll();//改变来源之后，把之前的数据移除store中\n// app.grid6.store.removeAll();//改变来源之后，把之前的数据移除store中\napp.grid.store.removeAll();//改变来源之后，把之前的数据移除store中\n\nif(newValue=='PAY'){\n  app.grid2PayBtn.show();\n  app.grid4PayBtn.show();\n  app.grid2ApPayHCode.show();\n  app.grid4ApPayHCode.show();\n}\nif(newValue=='GL_L'){\n  app.grid1InqGlBtn.show();\n  app.grid2InqGlLBtn.show();\n  app.grid2InqGlHBtn.hide();\n}\nif(newValue=='GL_H'){\n  app.grid2InqGlHBtn.show();\n  app.grid2InqGlLBtn.hide();\n}\nif(newValue=='REQ'){\n  app.grid1ReqBtn.show();\n  app.grid3ReqBtn.show();\n  app.grid5ReqBtn.show();\n  app.grid1ApPayReqHCode.show();\n  app.grid5ApPayReqHCode.show();\n}\nif(newValue=='TEMP'){\n  app.grid3CreateBtn.show();\n  app.grid4CreateBtn.show();\n  app.grid5PurTypeBtn.show();\n  app.grid6CreateBtn.show();\n}"},"children":[],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"fit","columnWidth":".5","itemId":"td_3_3"},"children":[{"configs":{"labelWidth":"80","allowBlank":"false","labelAlign":"right","itemId":"DESCRIPTION","fieldLabel":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#DESCRIPTION#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"title":"付款信息","itemId":"fieldset1"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","height":"35","layout":"column","itemId":"tr4"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"fit","columnWidth":".25","itemId":"td_4_1"},"children":[{"configs":{"labelWidth":"70","allowBlank":"false","displayField":"MODE_NAME","valueField":"MODE_ID","labelAlign":"right","itemId":"PAY_TYPE","fieldLabel":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#PAY_TYPE#}","editable":"false"},"events":{"change":"Wb.request({\n    url : 'm?xwl=xc/ap/pay/DB/payTypeSelect',\n    params : {LEDGER_ID : app.LEDGER_ID_XWL.LEDGER_ID.getValue(),MODE_ID : newValue},//传参\n    success : function(resp){\n        var temp = Wb.decode(resp.responseText);//返回的数据\n        if(temp.rows[0].MODE_TYPE !== 'bank'){//付款方式不为银行\n            app.DEPOSIT_BANK_NAME_XWL.DEPOSIT_BANK_ID.reset();\n            app.DEPOSIT_BANK_NAME_XWL.D_B_NAME.reset();\n            app.DEPOSIT_BANK_NAME_XWL.D_B_NAME.allowBlank = true;\n            app.DEPOSIT_BANK_NAME_XWL.D_B_NAME.setReadOnly(true);\n            app.PAY_ACC_ID_PICK_XWL.PAY_ACC_ID.setValue(temp.rows[0].PAY_ACC_ID);\n            app.PAY_ACC_ID_PICK_XWL.PAY_ACC_NAME.setValue(temp.rows[0].PAY_ACC_NAME);\n        }\n        if(temp.rows[0].MODE_TYPE == 'bank' && newValue !== null){//付款方式为银行并且付款科目不为空\n            app.DEPOSIT_BANK_NAME_XWL.D_B_NAME.setReadOnly(false);\n            app.DEPOSIT_BANK_NAME_XWL.D_B_NAME.allowBlank = false;\n            app.PAY_ACC_ID_PICK_XWL.PAY_ACC_ID.setValue(temp.rows[0].PAY_ACC_ID);\n            app.PAY_ACC_ID_PICK_XWL.PAY_ACC_NAME.setValue(temp.rows[0].PAY_ACC_NAME);\n        }\n    }\n});"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/ap/pay/DB/payTypeSelect"},"events":{"beforeload":"store.proxy.extraParams.LEDGER_ID = app.LEDGER_ID_XWL.LEDGER_ID.getValue();"},"children":[],"expanded":false,"type":"store"}],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"fit","columnWidth":".25","itemId":"td_4_2"},"children":[{"configs":{"file":"m?xwl=xc/ap/ap-com-lov/DEPOSIT_BANK_ID_PICK/DEPOSIT_BANK_ID_LD","itemId":"DEPOSIT_BANK_NAME_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"fit","columnWidth":".25","itemId":"td_4_3"},"children":[{"configs":{"file":"m?xwl=xc/ap/ap-com-lov/ACC_ID_PICK/PAY_ACC_ID_PICK","itemId":"PAY_ACC_ID_PICK_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"fit","columnWidth":".25","itemId":"td_4_4"},"children":[{"configs":{"file":"m?xwl=xc/ap/ap-com-lov/CA_ID_PICK/CA_ID_PICK_ALL","itemId":"CA_NAME_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"fieldset"},{"configs":{"title":"供应商银行","itemId":"fieldset2"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","height":"35","layout":"column","itemId":"tr5"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"fit","columnWidth":".25","itemId":"td_5_1"},"children":[{"configs":{"file":"m?xwl=xc/ap/ap-com-lov/ACCOUNT_NAME_PICK/ACCOUNT_NAME_ALL","itemId":"ACCOUNT_NAME_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"fit","columnWidth":".25","itemId":"td_5_2"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"DEPOSIT_BANK_NAME","fieldLabel":"{#DEPOSIT_BANK_NAME#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"fit","columnWidth":".25","itemId":"td_5_3"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"BANK_ACCOUNT","fieldLabel":"{#BANK_ACCOUNT#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"fieldset"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"column","itemId":"tr8"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_8_1"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","value":"{#XIP.empName#}","labelAlign":"right","itemId":"CREATED_BY_NAME","fieldLabel":"{#CREATED_BY_NAME#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_8_2"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"SIGNATORY","fieldLabel":"{#SIGNATORY#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_8_3"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"V_STATUS_NAME","fieldLabel":"{#V_STATUS_NAME#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"hidden":"true","itemId":"hidden_p"},"children":[{"configs":{"hidden":"true","itemId":"AP_PAY_H_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","value":"{#XIP.userId#}","itemId":"USER_ID","fieldLabel":"USER_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"V_HEAD_ID","fieldLabel":"凭证头ID"},"children":[],"expanded":false,"type":"text"}],"expanded":false,"type":"panel"}],"expanded":true,"type":"form"},{"configs":{"region":"south","pagingBar":"false","height":"200","hidden":"true","itemId":"grid1","editable":"true"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/ap/pay/DB/XC_AP_PAY_L_SELECT"},"children":[],"expanded":false,"type":"store"},{"configs":{"normalName":"grid1Tbar","itemId":"tbar"},"children":[{"configs":{"text":"{#reqBtn#}","hidden":"true","normalName":"grid1ReqBtn","itemId":"reqBtn"},"events":{"click":"var payHId = app.AP_PAY_H_ID.getValue();\nvar ledgerId = app.LEDGER_ID_XWL.LEDGER_ID.getValue();\nvar vendorId = app.VENDOR_ID_XWL.VENDOR_ID.getValue();\nif(Wb.isEmpty(ledgerId)){\n\tWb.toast('请先选择账簿！');\n    return false;\n}\n\nif(Wb.isEmpty(vendorId)){\n\tWb.toast('请先选择供应商！');\n    return false;\n}\nvar curGrid = app.grid1;\nvar P_AP_CONTRACT_NAME = app.AP_CONTRACT_ID_XWL.AP_CONTRACT_NAME.getValue();\nvar P_AP_DOC_CAT_CODE = app.AP_DOC_CAT_CODE.getValue();\nWb.run({\n  url: 'm?xwl=xc/ap/pay/LOV/LOV_XC_AP_PAY_REQ_H', \n  success: function(app) {\n    app.initWin({\n\t\tAP_PAY_H_ID:payHId,\n        AP_DOC_CAT_CODE:P_AP_DOC_CAT_CODE,\n        AP_CONTRACT_NAME:P_AP_CONTRACT_NAME,\n        LEDGER_ID:ledgerId,\n        VENDOR_ID:vendorId,\n        hideFun:function(rs){\n              Wb.each(rs, function(r) {\n                r.set('AP_PAY_L_ID',Xip.getId());\n                r.set('AP_PAY_H_ID',payHId);\n                var grid1Store = curGrid.getStore();\n                for(var i=0;i<grid1Store.getCount();i++){\n                  var gr = grid1Store.getAt(i);\n                  if(gr.get('AP_PAY_REQ_L_ID')==r.get('AP_PAY_REQ_L_ID')){\n                    return false;\n                  }\n                }\n                Wb.add(curGrid, {\n                  AP_PAY_L_ID:r.get('AP_PAY_L_ID'),\n                  AP_PAY_H_ID:r.get('AP_PAY_H_ID'),\n                  AP_PAY_REQ_H_ID:r.get('AP_PAY_REQ_H_ID'),\n                  AP_PAY_REQ_L_ID:r.get('AP_PAY_REQ_L_ID'),\n                  AP_PAY_REQ_H_CODE:r.get('AP_PAY_REQ_H_CODE'),\n                  AP_INV_GL_H_ID:r.get('AP_INV_GL_H_ID'),\n                  PROJECT_ID:r.get('PROJECT_ID'),\n                  DEPT_ID:r.get('DEPT_ID'),\n                  ACC_ID:r.get('AP_ACC_ID_DEBT'),\n                  CCID:r.get('CCID'),\n                  AP_DOC_CAT_CODE:r.get('GL_AP_DOC_CAT_CODE'),\n                  AP_CONTRACT_ID:r.get('AP_CONTRACT_ID'),\n                  AP_PAY_H_CODE:r.get('AP_PAY_H_CODE'),\n                  AP_DOC_CAT_NAME:r.get('GL_AP_DOC_CAT_NAME'),\n                  AP_INV_GL_H_CODE:r.get('AP_INV_GL_H_CODE'),\n                  AP_CONTRACT_NAME:r.get('AP_CONTRACT_NAME'),\n                  DEPT_NAME:r.get('DEPT_NAME'),\n                  PROJECT_NAME:r.get('PROJECT_NAME'),\n                  ACC_NAME:r.get('AP_ACC_NAME_DEBT'),\n                 \n                   AMOUNT:r.get('PAY_AMT'),\n                  DESCRIPTION:r.get('DESCRIPTION')\n                }, 'after', 1, false);\n              });\n        }\n    });\n  }\n});\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#inqGlBtn#}","hidden":"true","normalName":"grid1InqGlBtn","itemId":"inqGlBtn"},"events":{"click":"var payHId = app.AP_PAY_H_ID.getValue();\nvar ledgerId = app.LEDGER_ID_XWL.LEDGER_ID.getValue();\nvar vendorId = app.VENDOR_ID_XWL.VENDOR_ID.getValue();\nvar contractId = app.AP_CONTRACT_ID_XWL.AP_CONTRACT_ID.getValue();\nif(Wb.isEmpty(ledgerId)){\n\tWb.toast('请先选择账簿！');\n    return false;\n}\nif(Wb.isEmpty(vendorId)){\n\tWb.toast('请先选择供应商！');\n    return false;\n}\nvar curGrid = app.grid1;\nWb.run({\n  url: 'm?xwl=xc/ap/pay/LOV/LOV_XC_AP_INV_GL_H', \n  success: function(app) {\n    app.initWin({\n\t\tAP_PAY_H_ID:payHId,\n        AP_DOC_CAT_CODE:'应付单蓝字',\n        LEDGER_ID:ledgerId,\n        VENDOR_ID:vendorId,\n        CONTRACT_ID:contractId,\n        hideFun:function(rs){\n              Wb.each(rs, function(r) {\n                r.set('AP_PAY_L_ID',Xip.getId());\n                r.set('AP_PAY_H_ID',payHId);\n                var grid1Store = curGrid.getStore();\n                for(var i=0;i<grid1Store.getCount();i++){\n                  var gr = grid1Store.getAt(i);\n                  if(gr.get('AP_INV_GL_H_ID')==r.get('AP_INV_GL_H_ID')){\n                    return false;\n                  }\n                }\n                Wb.add(curGrid, {\n                  AP_PAY_L_ID:r.get('AP_PAY_L_ID'),\n                  AP_PAY_H_ID:r.get('AP_PAY_H_ID'),\n                  AP_INV_GL_H_ID:r.get('AP_INV_GL_H_ID'),\n                  PROJECT_ID:r.get('PROJECT_ID'),\n                  DEPT_ID:r.get('DEPT_ID'),\n                  ACC_ID:r.get('AP_ACC_ID_DEBT'),\n                  CCID:r.get('CCID'),\n                  AP_DOC_CAT_CODE:r.get('AP_DOC_CAT_CODE'),\n                  AP_CONTRACT_ID:r.get('AP_CONTRACT_ID'),\n                  AP_PAY_H_CODE:r.get('AP_PAY_H_CODE'),\n                  AP_DOC_CAT_NAME:r.get('AP_DOC_CAT_NAME'),\n                  AP_INV_GL_H_CODE:r.get('AP_INV_GL_H_CODE'),\n                  AP_CONTRACT_NAME:r.get('AP_CONTRACT_NAME'),\n                  DEPT_NAME:r.get('DEPT_NAME'),\n                  PROJECT_NAME:r.get('PROJECT_NAME'),\n                  ACC_NAME:r.get('AP_ACC_NAME_DEBT'),\n                  AMOUNT:r.get('PAY_AMT'),\n                  DESCRIPTION:r.get('DESCRIPTION')\n                }, 'after', 1, false);\n              });\n        }\n    });\n  }\n});\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#delBtn#}","itemId":"delBtn"},"events":{"click":"Ext.Msg.confirm(\"警告\", \"确定要删除吗？\", function (button) {\n    if (button == \"yes\") {\n      Wb.remove(app.grid1);\n    }\n});"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","dataIndex":"AP_PAY_L_ID","itemId":"AP_PAY_L_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"AP_PAY_H_ID","itemId":"AP_PAY_H_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"L_AP_PAY_L_ID","itemId":"L_AP_PAY_L_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"L_AP_PAY_H_ID","itemId":"L_AP_PAY_H_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"AP_PAY_REQ_H_ID","itemId":"AP_PAY_REQ_H_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"AP_PAY_REQ_L_ID","itemId":"AP_PAY_REQ_L_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"AP_INV_GL_H_ID","itemId":"AP_INV_GL_H_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"AP_PUR_TYPE_ID","itemId":"AP_PUR_TYPE_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"BG_ITEM_ID","itemId":"BG_ITEM_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"ACC_ID","itemId":"ACC_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"CCID","itemId":"CCID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"AP_CONTRACT_ID","itemId":"AP_CONTRACT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"PROJECT_ID","itemId":"PROJECT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"DEPT_ID","itemId":"DEPT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"AP_DOC_CAT_CODE","itemId":"AP_DOC_CAT_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#AP_PAY_REQ_H_CODE_COL#}","hidden":"true","width":"120","dataIndex":"AP_PAY_REQ_H_CODE","titleAlign":"center","normalName":"grid1ApPayReqHCode","itemId":"AP_PAY_REQ_H_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#AP_DOC_CAT_NAME_COL#}","width":"120","dataIndex":"AP_DOC_CAT_NAME","titleAlign":"center","itemId":"AP_DOC_CAT_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#AP_INV_GL_H_CODE_COL#}","width":"120","dataIndex":"AP_INV_GL_H_CODE","titleAlign":"center","itemId":"AP_INV_GL_H_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#AP_CONTRACT_NAME#}","width":"150","dataIndex":"AP_CONTRACT_NAME","titleAlign":"center","itemId":"AP_CONTRACT_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#DEPT_NAME#}","width":"150","dataIndex":"DEPT_NAME","titleAlign":"center","itemId":"DEPT_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#PROJECT_NAME#}","width":"150","dataIndex":"PROJECT_NAME","titleAlign":"center","itemId":"PROJECT_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#ACC_NAME#}","width":"150","dataIndex":"ACC_NAME","titleAlign":"center","itemId":"ACC_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#AMOUNT#}","width":"100","dataIndex":"AMOUNT","format":"0,000.00","titleAlign":"center","itemId":"AMOUNT_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#DESCRIPTION#}","width":"200","dataIndex":"DESCRIPTION","titleAlign":"center","itemId":"DESCRIPTION_COL"},"children":[{"configs":{"itemId":"editor"},"children":[],"expanded":false,"type":"textarea"}],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"},{"configs":{"region":"south","pagingBar":"false","height":"200","hidden":"true","itemId":"grid2","editable":"true"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/ap/pay/DB/XC_AP_PAY_L_SELECT"},"children":[],"expanded":false,"type":"store"},{"configs":{"normalName":"grid2Tbar","itemId":"tbar"},"children":[{"configs":{"text":"{#payBtn#}","hidden":"true","normalName":"grid2PayBtn","itemId":"payBtn"},"events":{"click":"var payHId = app.AP_PAY_H_ID.getValue();\n//var docCatCode = app.AP_DOC_CAT_CODE.getValue();\n\nvar ledgerId = app.LEDGER_ID_XWL.LEDGER_ID.getValue();\n\nif(Wb.isEmpty(ledgerId)){\n\tWb.toast('请先选择账簿！');\n    return false;\n}\n// if(Wb.isEmpty(docCatCode)){\n//  Wb.toast('请先选择应付单或者付款单！');\n//  return false;\n// }\n\n\nvar curGrid = app.grid2;\nWb.run({\n  url: 'm?xwl=xc/ap/pay/LOV/LOV_XC_AP_PAY_H', \n  success: function(app) {\n    app.initWin({\n\t\tLEDGER_ID:ledgerId,\n        AP_DOC_CAT_CODE:'CGJS',\n        hideFun:function(rs){\n          Wb.each(rs, function(r) {\n                r.set('L_AP_PAY_H_ID',r.get('AP_PAY_H_ID'));\n                r.set('L_AP_PAY_L_ID',r.get('AP_PAY_L_ID'));\n                r.set('AP_PAY_L_ID',Xip.getId());\n                r.set('AP_PAY_H_ID',payHId);\n                var grid1Store = curGrid.getStore();\n                for(var i=0;i<grid1Store.getCount();i++){\n                  var gr = grid1Store.getAt(i);\n                  if(gr.get('L_AP_PAY_L_ID')==r.get('L_AP_PAY_L_ID')){\n                    return false;\n                  }\n                }\n                Wb.add(curGrid, {\n                  AP_PAY_L_ID:r.get('AP_PAY_L_ID'),\n                  AP_PAY_H_ID:r.get('AP_PAY_H_ID'),\n                  L_AP_PAY_H_ID:r.get('L_AP_PAY_H_ID'),\n                  L_AP_PAY_L_ID:r.get('L_AP_PAY_L_ID'),\n                  AP_INV_GL_H_ID:r.get('AP_INV_GL_H_ID'),\n                  PROJECT_ID:r.get('PROJECT_ID'),\n                  DEPT_ID:r.get('DEPT_ID'),\n                  ACC_ID:r.get('ACC_ID'),\n                  CCID:r.get('CCID'),\n                  AP_DOC_CAT_CODE:r.get('AP_DOC_CAT_CODE'),\n                  AP_CONTRACT_ID:r.get('AP_CONTRACT_ID'),\n                  AP_PAY_H_CODE:r.get('AP_PAY_H_CODE'),\n                  AP_DOC_CAT_NAME:r.get('AP_DOC_CAT_NAME'),\n                  AP_INV_GL_H_CODE:r.get('AP_INV_GL_H_CODE'),\n                  AP_CONTRACT_NAME:r.get('AP_CONTRACT_NAME'),\n                  DEPT_NAME:r.get('DEPT_NAME'),\n                  PROJECT_NAME:r.get('PROJECT_NAME'),\n                  ACC_NAME:r.get('ACC_NAME'),\n                  AMOUNT:r.get('PAY_AMT')*-1,\n                  DESCRIPTION:r.get('DESCRIPTION')\n                }, 'after', 1, false);\n              });\n        }\n    });\n  }\n});\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#inqGlHBtn#}","hidden":"true","normalName":"grid2InqGlHBtn","itemId":"inqGlHBtn"},"events":{"click":"var payHId = app.AP_PAY_H_ID.getValue();\nvar ledgerId = app.LEDGER_ID_XWL.LEDGER_ID.getValue();\nvar vendorId = app.VENDOR_ID_XWL.VENDOR_ID.getValue();\nif(Wb.isEmpty(ledgerId)){\n\tWb.toast('请先选择账簿！');\n    return false;\n}\nif(Wb.isEmpty(vendorId)){\n\tWb.toast('请先选择供应商！');\n    return false;\n}\nvar curGrid = app.grid2;\nWb.run({\n  url: 'm?xwl=xc/ap/pay/LOV/LOV_XC_AP_INV_GL_H', \n  success: function(app) {\n    app.initWin({\n\t\tAP_PAY_H_ID:payHId,\n        AP_DOC_CAT_CODE:'回冲应付单红字',\n        LEDGER_ID:ledgerId,\n        VENDOR_ID:vendorId,\n        hideFun:function(rs){\n              Wb.each(rs, function(r) {\n                r.set('AP_PAY_L_ID',Xip.getId());\n                r.set('AP_PAY_H_ID',payHId);\n                var grid1Store = curGrid.getStore();\n                for(var i=0;i<grid1Store.getCount();i++){\n                  var gr = grid1Store.getAt(i);\n                  if(gr.get('AP_INV_GL_H_ID')==r.get('AP_INV_GL_H_ID')){\n                    return false;\n                  }\n                }\n                Wb.add(curGrid, {\n                  AP_PAY_L_ID:r.get('AP_PAY_L_ID'),\n                  AP_PAY_H_ID:r.get('AP_PAY_H_ID'),\n                  AP_INV_GL_H_ID:r.get('AP_INV_GL_H_ID'),\n                  PROJECT_ID:r.get('PROJECT_ID'),\n                  DEPT_ID:r.get('DEPT_ID'),\n                  ACC_ID:r.get('AP_ACC_ID_DEBT'),\n                  CCID:r.get('CCID'),\n                  AP_DOC_CAT_CODE:r.get('AP_DOC_CAT_CODE'),\n                  AP_CONTRACT_ID:r.get('AP_CONTRACT_ID'),\n                  AP_PAY_H_CODE:r.get('AP_PAY_H_CODE'),\n                  AP_DOC_CAT_NAME:r.get('AP_DOC_CAT_NAME'),\n                  AP_INV_GL_H_CODE:r.get('AP_INV_GL_H_CODE'),\n                  AP_CONTRACT_NAME:r.get('AP_CONTRACT_NAME'),\n                  DEPT_NAME:r.get('DEPT_NAME'),\n                  PROJECT_NAME:r.get('PROJECT_NAME'),\n                  ACC_NAME:r.get('AP_ACC_NAME_DEBT'),\n                  AMOUNT:r.get('PAY_AMT'),\n                  DESCRIPTION:r.get('DESCRIPTION')\n                }, 'after', 1, false);\n              });\n        }\n    });\n  }\n});\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#inqGlLBtn#}","hidden":"true","normalName":"grid2InqGlLBtn","itemId":"inqGlLBtn"},"events":{"click":"var payHId = app.AP_PAY_H_ID.getValue();\nvar ledgerId = app.LEDGER_ID_XWL.LEDGER_ID.getValue();\nvar vendorId = app.VENDOR_ID_XWL.VENDOR_ID.getValue();\nif(Wb.isEmpty(ledgerId)){\n\tWb.toast('请先选择账簿！');\n    return false;\n}\nif(Wb.isEmpty(vendorId)){\n\tWb.toast('请先选择供应商！');\n    return false;\n}\nvar curGrid = app.grid2;\nWb.run({\n  url: 'm?xwl=xc/ap/pay/LOV/LOV_XC_AP_INV_GL_H', \n  success: function(app) {\n    app.initWin({\n\t\tAP_PAY_H_ID:payHId,\n        AP_DOC_CAT_CODE:'回冲应付单蓝字',\n        LEDGER_ID:ledgerId,\n        VENDOR_ID:vendorId,\n        hideFun:function(rs){\n              Wb.each(rs, function(r) {\n                r.set('AP_PAY_L_ID',Xip.getId());\n                r.set('AP_PAY_H_ID',payHId);\n                var grid1Store = curGrid.getStore();\n                for(var i=0;i<grid1Store.getCount();i++){\n                  var gr = grid1Store.getAt(i);\n                  if(gr.get('AP_INV_GL_H_ID')==r.get('AP_INV_GL_H_ID')){\n                    return false;\n                  }\n                }\n                Wb.add(curGrid, {\n                  AP_PAY_L_ID:r.get('AP_PAY_L_ID'),\n                  AP_PAY_H_ID:r.get('AP_PAY_H_ID'),\n                  AP_INV_GL_H_ID:r.get('AP_INV_GL_H_ID'),\n                  PROJECT_ID:r.get('PROJECT_ID'),\n                  DEPT_ID:r.get('DEPT_ID'),\n                  ACC_ID:r.get('AP_ACC_ID_DEBT'),\n                  CCID:r.get('CCID'),\n                  AP_DOC_CAT_CODE:r.get('AP_DOC_CAT_CODE'),\n                  AP_CONTRACT_ID:r.get('AP_CONTRACT_ID'),\n                  AP_PAY_H_CODE:r.get('AP_PAY_H_CODE'),\n                  AP_DOC_CAT_NAME:r.get('AP_DOC_CAT_NAME'),\n                  AP_INV_GL_H_CODE:r.get('AP_INV_GL_H_CODE'),\n                  AP_CONTRACT_NAME:r.get('AP_CONTRACT_NAME'),\n                  DEPT_NAME:r.get('DEPT_NAME'),\n                  PROJECT_NAME:r.get('PROJECT_NAME'),\n                  ACC_NAME:r.get('AP_ACC_NAME_DEBT'),\n                  AMOUNT:r.get('PAY_AMT'),\n                  DESCRIPTION:r.get('DESCRIPTION')\n                }, 'after', 1, false);\n              });\n        }\n    });\n  }\n});\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#delBtn#}","itemId":"delBtn"},"events":{"click":"Ext.Msg.confirm(\"警告\", \"确定要删除吗？\", function (button) {\n    if (button == \"yes\") {\n      Wb.remove(app.grid2);\n    }\n});"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","dataIndex":"AP_PAY_L_ID","itemId":"AP_PAY_L_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"AP_PAY_H_ID","itemId":"AP_PAY_H_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"L_AP_PAY_L_ID","itemId":"L_AP_PAY_L_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"L_AP_PAY_H_ID","itemId":"L_AP_PAY_H_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"AP_PAY_REQ_H_ID","itemId":"AP_PAY_REQ_H_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"AP_INV_GL_H_ID","itemId":"AP_INV_GL_H_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"AP_PUR_TYPE_ID","itemId":"AP_PUR_TYPE_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"BG_ITEM_ID","itemId":"BG_ITEM_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"ACC_ID","itemId":"ACC_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"CCID","itemId":"CCID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"AP_CONTRACT_ID","itemId":"AP_CONTRACT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"PROJECT_ID","itemId":"PROJECT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"DEPT_ID","itemId":"DEPT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"AP_DOC_CAT_CODE","itemId":"AP_DOC_CAT_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>付款单","width":"120","dataIndex":"AP_PAY_H_CODE","titleAlign":"center","normalName":"grid2ApPayHCode","itemId":"AP_PAY_H_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"应付单类型","width":"120","dataIndex":"AP_DOC_CAT_NAME","titleAlign":"center","itemId":"AP_DOC_CAT_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>应付单","width":"120","dataIndex":"AP_INV_GL_H_CODE","titleAlign":"center","itemId":"AP_INV_GL_H_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"合同","width":"150","dataIndex":"AP_CONTRACT_NAME","titleAlign":"center","itemId":"AP_CONTRACT_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"成本中心","width":"150","dataIndex":"DEPT_NAME","titleAlign":"center","itemId":"DEPT_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"项目","width":"150","dataIndex":"PROJECT_NAME","titleAlign":"center","itemId":"PROJECT_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>科目/辅助项","width":"150","dataIndex":"ACC_NAME","titleAlign":"center","itemId":"ACC_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>付款金额","width":"100","dataIndex":"AMOUNT","titleAlign":"center","itemId":"AMOUNT_COL","renderer":"if(app.AP_DOC_CAT_CODE.getValue()=='FKD_CGJS-H'||app.AP_DOC_CAT_CODE.getValue()=='FKD_YUFK-H'||app.AP_DOC_CAT_CODE.getValue()=='FKD_QTFK-H'){\n  return '<font color=blue><\/font><span style=\"color:red;\">' + value + '<\/span>';\n}else{\n  return value;\n}\n"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>摘要","width":"200","dataIndex":"DESCRIPTION","titleAlign":"center","itemId":"DESCRIPTION_COL"},"children":[{"configs":{"allowBlank":"false","itemId":"editor"},"children":[],"expanded":false,"type":"textarea"}],"expanded":true,"type":"column"}],"expanded":false,"type":"array"}],"expanded":true,"type":"grid"},{"configs":{"region":"south","pagingBar":"false","height":"200","hidden":"true","itemId":"grid3","editable":"true"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/ap/pay/DB/XC_AP_PAY_L_SELECT"},"children":[],"expanded":false,"type":"store"},{"configs":{"normalName":"grid3Tbar","itemId":"tbar"},"children":[{"configs":{"text":"{#reqBtn#}","hidden":"true","normalName":"grid3ReqBtn","itemId":"reqBtn"},"events":{"tagEvents":"{\n  show : function(button,option){\n    app.AP_PAY_REQ_H_CODE_COL3.show();\n  }\n}","click":"var payHId = app.AP_PAY_H_ID.getValue();\nvar ledgerId = app.LEDGER_ID_XWL.LEDGER_ID.getValue();\nvar vendorId = app.VENDOR_ID_XWL.VENDOR_ID.getValue();\n\nif(Wb.isEmpty(ledgerId)){\n\tWb.toast('请先选择账簿！');\n    return false;\n}\nif(Wb.isEmpty(vendorId)){\n\tWb.toast('请先选择供应商！');\n    return false;\n}\n\nif(app.grid3.getStore().getCount()>0){\n\tWb.toast('预付款明细不能超过一条！');\n    return false;\n}\n\nvar curGrid = app.grid3;\nvar P_AP_CONTRACT_NAME = app.AP_CONTRACT_ID_XWL.AP_CONTRACT_NAME.getValue();\nvar P_AP_DOC_CAT_CODE = app.AP_DOC_CAT_CODE.getValue();\nWb.run({\n  url: 'm?xwl=xc/ap/pay/LOV/LOV_XC_AP_PAY_REQ_H_YUFK', \n  success: function(app) {\n    app.initWin({\n\t\tAP_PAY_H_ID:payHId,\n        AP_DOC_CAT_CODE:P_AP_DOC_CAT_CODE,\n        AP_CONTRACT_NAME:P_AP_CONTRACT_NAME,\n        LEDGER_ID:ledgerId,\n        VENDOR_ID:vendorId,\n        hideFun:function(rs){\n              Wb.each(rs, function(r) {\n                //Wb.setValue(app.editWinN,Wb.decode(r));\n                r.set('AP_PAY_L_ID',Xip.getId());\n                r.set('AP_PAY_H_ID',payHId);\n                var grid1Store = curGrid.getStore();\n                for(var i=0;i<grid1Store.getCount();i++){\n                  var gr = grid1Store.getAt(i);\n                  if(gr.get('AP_PAY_REQ_L_ID')==r.get('AP_PAY_REQ_L_ID')){\n                    return false;\n                  }\n                }\n                Wb.add(curGrid, {\n                  AP_PAY_L_ID:r.get('AP_PAY_L_ID'),\n                  AP_PAY_H_ID:r.get('AP_PAY_H_ID'),\n                  AP_PAY_REQ_H_ID:r.get('AP_PAY_REQ_H_ID'),\n                  AP_PAY_REQ_L_ID:r.get('AP_PAY_REQ_L_ID'),\n                  AP_PAY_REQ_H_CODE:r.get('AP_PAY_REQ_H_CODE'),\n                  AP_INV_GL_H_ID:r.get('AP_INV_GL_H_ID'),\n                  PROJECT_ID:r.get('PROJECT_ID'),\n                  DEPT_ID:r.get('DEPT_ID'),\n                  ACC_ID:r.get('AP_ACC_ID_PRE'),\n                  CCID:r.get('CCID'),\n                  AP_DOC_CAT_CODE:r.get('GL_AP_DOC_CAT_CODE'),\n                  AP_CONTRACT_ID:r.get('AP_CONTRACT_ID'),\n                  AP_PAY_H_CODE:r.get('AP_PAY_H_CODE'),\n                  AP_DOC_CAT_NAME:r.get('GL_AP_DOC_CAT_NAME'),\n                  AP_INV_GL_H_CODE:r.get('AP_INV_GL_H_CODE'),\n                  AP_CONTRACT_NAME:r.get('AP_CONTRACT_NAME'),\n                  DEPT_NAME:r.get('DEPT_NAME'),\n                  PROJECT_NAME:r.get('PROJECT_NAME'),\n                  ACC_NAME:r.get('AP_ACC_NAME_PRE'),\n                  AMOUNT:r.get('PAY_AMT'),\n                  DESCRIPTION:r.get('DESCRIPTION')\n                }, 'after', 1, false);\n              });\n        }\n    });\n  }\n});\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#createBtn#}","hidden":"true","normalName":"grid3CreateBtn","itemId":"createBtn"},"events":{"tagEvents":"{\n  show : function(button,option){\n    app.AP_PAY_REQ_H_CODE_COL3.hide();\n  }\n}","click":"var payHId = app.AP_PAY_H_ID.getValue();\nvar ledgerId = app.LEDGER_ID_XWL.LEDGER_ID.getValue();\nif(Wb.isEmpty(ledgerId)){\n\tWb.toast('请先选择账簿！');\n    return false;\n}\n\nif(app.grid3.getStore().getCount()>0){\n\tWb.toast('预付款明细不能超过一条！');\n    return false;\n}\n\nvar curGrid = app.grid3;\nWb.request({\n                        url: 'm?xwl=xc/ap/ld/ledgers/DB/XC_GL_LEDGERS_SELECT_BY_ID',\n                        params: {\n                            LEDGER_ID: app.LEDGER_ID_XWL.LEDGER_ID.getValue()\n                        },\n                        success: function(resp) {\n                            var o = Wb.decode(resp.responseText);\n                             Wb.add(curGrid,{\n                             AP_PAY_L_ID:Xip.getId(),\n                             AP_PAY_H_ID:payHId,\n                             ACC_ID:o.AP_ACC_ID_PRE,\n                             ACC_NAME:o.AP_ACC_NAME_PRE,  \n                             DESCRIPTION:app.DESCRIPTION.getValue()\n                             }, 'after', 1, false);\n                        }\n                    });\n// Wb.run({\n//   url: 'm?xwl=xc/ap/pay/LOV/LOV_XC_AP_PUR_TYPE', \n//   success: function(app) {\n//     app.initWin({\n// \t\tAP_PAY_H_ID:payHId,\n//         AP_DOC_CAT_CODE:'',\n//         LEDGER_ID:ledgerId,\n//         hideFun:function(rs){\n//               Wb.each(rs, function(r) {\n//                 r.set('AP_PAY_L_ID',Xip.getId());\n//                 r.set('AP_PAY_H_ID',payHId);\n//                 var grid1Store = curGrid.getStore();\n//                 for(var i=0;i<grid1Store.getCount();i++){\n//                   var gr = grid1Store.getAt(i);\n//                   if(gr.get('AP_PUR_TYPE_ID')==r.get('AP_PUR_TYPE_ID')){\n//                     return false;\n//                   }\n//                 }\n//                 Wb.add(curGrid, {\n//                   AP_PAY_L_ID:r.get('AP_PAY_L_ID'),\n//                   AP_PAY_H_ID:r.get('AP_PAY_H_ID'),\n//                   AP_PAY_REQ_H_ID:r.get('AP_PAY_REQ_H_ID'),\n//                   AP_PAY_REQ_L_ID:r.get('AP_PAY_REQ_L_ID'),\n//                   AP_PAY_REQ_H_CODE:r.get('AP_PAY_REQ_H_CODE'),\n//                   AP_INV_GL_H_ID:r.get('AP_INV_GL_H_ID'),\n//                   PROJECT_ID:r.get('PROJECT_ID'),\n//                   DEPT_ID:r.get('DEPT_ID'),\n//                   ACC_ID:r.get('AP_ACC_ID_DEBT'),\n//                   CCID:r.get('CCID'),\n//                   CCID_NAME:r.get('CCID_NAME'),\n//                   AP_DOC_CAT_CODE:r.get('GL_AP_DOC_CAT_CODE'),\n//                   AP_CONTRACT_ID:r.get('AP_CONTRACT_ID'),\n//                   AP_PUR_TYPE_ID:r.get('AP_PUR_TYPE_ID'),\n//                   AP_PUR_TYPE_NAME:r.get('AP_PUR_TYPE_NAME'),\n//                   BG_ITEM_ID:r.get('BG_ITEM_ID'),\n//                   BG_ITEM_NAME:r.get('BG_ITEM_NAME'),\n//                   AP_PAY_H_CODE:r.get('AP_PAY_H_CODE'),\n//                   AP_DOC_CAT_NAME:r.get('GL_AP_DOC_CAT_NAME'),\n//                   AP_INV_GL_H_CODE:r.get('AP_INV_GL_H_CODE'),\n//                   AP_CONTRACT_NAME:r.get('AP_CONTRACT_NAME'),\n//                   DEPT_NAME:r.get('DEPT_NAME'),\n//                   PROJECT_NAME:r.get('PROJECT_NAME'),\n//                   ACC_NAME:r.get('AP_ACC_NAME_DEBT'),\n//                   AMOUNT:r.get('PAY_AMT'),\n//                   DESCRIPTION:r.get('DESCRIPTION')\n//                 }, 'after', 1, false);\n//               });\n//         }\n//     });\n//   }\n// });\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#delBtn#}","itemId":"delBtn"},"events":{"click":"Ext.Msg.confirm(\"警告\", \"确定要删除吗？\", function (button) {\n    if (button == \"yes\") {\n      Wb.remove(app.grid3);\n    }\n});"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","dataIndex":"AP_PAY_L_ID","itemId":"AP_PAY_L_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"AP_PAY_H_ID","itemId":"AP_PAY_H_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"L_AP_PAY_L_ID","itemId":"L_AP_PAY_L_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"L_AP_PAY_H_ID","itemId":"L_AP_PAY_H_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"AP_PAY_REQ_H_ID","itemId":"AP_PAY_REQ_H_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#AP_PAY_REQ_H_CODE_COL#}","width":"200","dataIndex":"AP_PAY_REQ_H_CODE","titleAlign":"center","itemId":"AP_PAY_REQ_H_CODE_COL3"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"AP_INV_GL_H_ID","itemId":"AP_INV_GL_H_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"AP_PUR_TYPE_ID","itemId":"AP_PUR_TYPE_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"BG_ITEM_ID","itemId":"BG_ITEM_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"ACC_ID","itemId":"ACC_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"CCID","itemId":"CCID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"AP_CONTRACT_ID","itemId":"AP_CONTRACT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"PROJECT_ID","itemId":"PROJECT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"DEPT_ID","itemId":"DEPT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"AP_DOC_CAT_CODE","itemId":"AP_DOC_CAT_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#AP_PAY_H_CODE_COL#}","hidden":"true","width":"120","dataIndex":"AP_PAY_H_CODE","titleAlign":"center","normalName":"grid4ApPayHCode","itemId":"AP_PAY_H_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#DEPT_NAME#}","width":"150","dataIndex":"DEPT_NAME","titleAlign":"center","itemId":"DEPT_NAME_COL"},"children":[{"configs":{"labelWidth":"100","labelAlign":"right","normalName":"DEPT_NAME_PICK","itemId":"editor"},"children":[{"configs":{"tagConfigs":"minWidth:400","height":"300","itemId":"pickComp"},"events":{"itemdblclick":"var r=app.grid3.getSelectionModel().getSelection()[0];\nr.set('DEPT_ID',record.data.DEPT_ID);\nr.set('DEPT_NAME',record.data.DEPT_NAME);\nr.dirty = true;\napp.DEPT_NAME_PICK.setValue(record.data.DEPT_NAME);\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"pageSize":"5","autoLoad":"true","itemId":"store","url":"m?xwl=xc/com-lov/DEPT_ID_PICK/DB/GRID_XIP_PUB_DEPTS_SELECT_LD"},"events":{"beforeload":"operation.params = Wb.getValue([app.form1,app.tbar]);"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","dataIndex":"DEPT_ID","itemId":"DEPT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"成本中心编码","dataIndex":"DEPT_CODE","itemId":"DEPT_CODE_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"成本中心名称","dataIndex":"DEPT_NAME","itemId":"DEPT_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"100","emptyText":"成本中心编码/名称","labelAlign":"right","itemId":"QUERY_CODE_NAME"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.pickComp.getStore().load();\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":true,"type":"column"},{"configs":{"text":"{#PROJECT_NAME#}","width":"150","dataIndex":"PROJECT_NAME","titleAlign":"center","itemId":"PROJECT_NAME_COL"},"children":[{"configs":{"labelWidth":"100","labelAlign":"right","normalName":"PROJECT_NAME_PICK","itemId":"editor"},"children":[{"configs":{"tagConfigs":"minWidth:400","height":"300","itemId":"pickComp"},"events":{"itemdblclick":"var r=app.grid3.getSelectionModel().getSelection()[0];\nr.set('PROJECT_ID',record.data.PROJECT_ID);\nr.set('PROJECT_NAME',record.data.PROJECT_NAME);\nr.dirty = true;\napp.PROJECT_NAME_PICK.setValue(record.data.PROJECT_NAME);\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"pageSize":"5","autoLoad":"true","itemId":"store","url":"m?xwl=xc/com-lov/PROJECT_ID_PICK/DB/GRID_XC_PM_PROJECT_SELECT"},"events":{"beforeload":"operation.params = Wb.getValue([app.form1,app.tbar]);"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","dataIndex":"PROJECT_ID","itemId":"PROJECT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"项目编码","dataIndex":"PROJECT_CODE","itemId":"PROJECT_CODE_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"项目名称","dataIndex":"PROJECT_NAME","itemId":"PROJECT_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"100","emptyText":"项目编码/名称","labelAlign":"right","itemId":"QUERY_CODE_NAME"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.pickComp.getStore().load();\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":true,"type":"column"},{"configs":{"text":"{#AP_CONTRACT_NAME#}","hidden":"true","width":"150","dataIndex":"AP_CONTRACT_NAME","titleAlign":"center","itemId":"AP_CONTRACT_NAME_COL"},"children":[{"configs":{"labelWidth":"100","labelAlign":"right","normalName":"AR_CONTRACT_NAME_PICK","itemId":"editor"},"children":[{"configs":{"tagConfigs":"minWidth:400","height":"300","itemId":"pickComp"},"events":{"itemdblclick":"var r=app.grid4.getSelectionModel().getSelection()[0];\nr.set('AP_CONTRACT_ID',record.data.AP_CONTRACT_ID);\nr.set('AP_CONTRACT_NAME',record.data.AP_CONTRACT_NAME);\nr.dirty = true;\napp.AP_CONTRACT_NAME_PICK.setValue(record.data.AP_CONTRACT_NAME);\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"pageSize":"5","autoLoad":"true","itemId":"store","url":"m?xwl=xc/ap/ap-com-lov/AP_CONTRACT_ID_PICK/DB/GRID_XC_AP_CONTRACT_SELECT"},"events":{"beforeload":"operation.params = Wb.getValue([app.form1,app.tbar]);"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","dataIndex":"AP_CONTRACT_ID","itemId":"AP_CONTRACT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"项目编码","dataIndex":"AP_CONTRACT_CODE","itemId":"AP_CONTRACT_CODE_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"项目名称","dataIndex":"AP_CONTRACT_NAME","itemId":"AP_CONTRACT_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"100","emptyText":"合同编码/名称","labelAlign":"right","itemId":"QUERY_CODE_NAME"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.pickComp.getStore().load();\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":true,"type":"column"},{"configs":{"text":"{#BG_ITEM_NAME#}","width":"150","dataIndex":"BG_ITEM_NAME","titleAlign":"center","itemId":"BG_ITEM_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#AP_PUR_TYPE_NAME#}","hidden":"true","width":"120","dataIndex":"AP_PUR_TYPE_NAME","titleAlign":"center","itemId":"AP_PUR_TYPE_NAME_COL"},"children":[{"configs":{"labelWidth":"100","labelAlign":"right","normalName":"AP_PUR_TYPE_NAME_PICK","itemId":"editor"},"children":[{"configs":{"tagConfigs":"minWidth:400","hidden":"300","itemId":"pickComp"},"events":{"itemdblclick":"var r=app.grid3.getSelectionModel().getSelection()[0];\nr.set('AP_PUR_TYPE_ID',record.data.AP_PUR_TYPE_ID);\nr.set('AP_PUR_TYPE_NAME',record.data.AP_PUR_TYPE_NAME);\nr.dirty = true;\napp.AP_PUR_TYPE_NAME_PICK.setValue(record.data.AP_PUR_TYPE_NAME);\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"pageSize":"5","autoLoad":"true","itemId":"store","url":"m?xwl=xc/ap/pay/LOV/DB/XC_AP_LD_PUR_TYPE_SELECT_YUFK"},"events":{"beforeload":"operation.params = Wb.getValue([app.form1,app.tbar]);"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","dataIndex":"AP_PUR_TYPE_ID","itemId":"AP_PUR_TYPE_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"采购类型","dataIndex":"AP_PUR_TYPE_NAME","itemId":"AP_PUR_TYPE_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"应付科目","dataIndex":"AP_ACC_NAME_DEBT","itemId":"AP_ACC_NAME_DEBT_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"100","emptyText":"采购类型编码/名称","labelAlign":"right","itemId":"QUERY_CODE_NAME"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.pickComp.getStore().load();\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":true,"type":"column"},{"configs":{"text":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#ACC_NAME#}","width":"150","dataIndex":"ACC_NAME","titleAlign":"center","itemId":"ACC_NAME_COL"},"children":[{"configs":{"labelWidth":"100","allowBlank":"false","labelAlign":"right","normalName":"ACC_NAME_PICK","itemId":"editor"},"children":[{"configs":{"tagConfigs":"minWidth:400","height":"300","itemId":"pickComp"},"events":{"itemdblclick":"var r=app.grid3.getSelectionModel().getSelection()[0];\nr.set('ACC_ID',record.data.ACC_ID);\nr.set('ACC_NAME',record.data.ACC_NAME);\nr.dirty = true;\napp.ACC_NAME_PICK.setValue(record.data.ACC_NAME);\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"pageSize":"5","autoLoad":"true","itemId":"store","url":"m?xwl=xc/com-lov/ACC_ID_PICK/DB/XC_BG_LD_ACCOUNTS_SELECT_LD"},"events":{"beforeload":"operation.params = Wb.getValue([app.form1,app.tbar]);"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","dataIndex":"ACC_ID","itemId":"ACC_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"科目编码","dataIndex":"ACC_CODE","itemId":"ACC_CODE_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"科目名称","dataIndex":"ACC_NAME","itemId":"ACC_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"100","emptyText":"科目编码/名称","labelAlign":"right","itemId":"QUERY_CODE_NAME"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.pickComp.getStore().load();\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":true,"type":"column"},{"configs":{"text":"{#CCID_NAME#}","hidden":"true","width":"150","dataIndex":"CCID_NAME","titleAlign":"center","itemId":"CCID_NAME_COL"},"children":[{"configs":{"displayField":"CCID_NAME","triggerCls":"x-form-search-trigger","valueField":"CCID","itemId":"editor","onTriggerClick":"  // 账簿\n  var ledgerId = app.LEDGER_ID_XWL.LEDGER_ID.getValue() ;\n  if(ledgerId === \"\" ||ledgerId === null || ledgerId === undefined){\n    Wb.info('请选择账簿!') ;\n    return false ;\n  }\n  \n  // 会计日期\n  var accDate = app.GL_DATE.getValue() ;\n  if(accDate === \"\" ||accDate === null || accDate === undefined){\n    Wb.info('请选择会计日期!') ;\n    return false ;\n  }else{\n\taccDate = Wb.dateToStr(accDate).substring(0,7);\n  }\n  \n  // TODO: 当前选中\n  var r = app.grid3.getSelection()[0] ; \n  \n  // TODO: 显示科目选择窗口\n  Wb.run({\n    url:'m?xwl=xc/gl/journal/v-windows/handler-ccid-win',\n    params : {\n      'ledgerId' : ledgerId,\n      'vtype' : '{#vtype#}'\n    },          \n    success:function(appObj){\n      appObj.initWindow({\n        accName : r.data.ACC_NAME,\n        ledgerId : ledgerId,\n        periodCode : accDate ,\n        groupId : 'ALL',\n        handlerCCID : function(returnObj){\n          // TODO: 处理CCID信息\n          var rObj = Wb.decode(returnObj) ;\n          r.set('ACC_ID', rObj.acc_id) ;    \n          r.set('ACC_NAME', rObj.acc_name);\n          r.set('CCID', rObj.acc_ccid) ;    \n          r.set('CCID_NAME', rObj.acc_ccid_name);\n          if(!Wb.isEmpty(rObj.dim_id)){\n          r.set('DIM_ID', rObj.dim_id) ;\n          r.set('DIM_NAME', rObj.dim_name) ;\n          }\n          // 禁用账簿\n           app.LEDGER_ID_XWL.LEDGER_ID.setReadOnly(true) ;\n        }\n      });\n    }  \n  }) ;   "},"events":{"beforequery":"var combo = e.combo;\nif(!e.forceAll){\n  var value = e.query;\n  combo.store.filterBy(function(record,id){\n    var text = record.get(combo.displayField);\n    return (text.indexOf(value)!=-1);\n  });\n  combo.expand();\n  return false;\n}","specialkey":"// TODO: 按回车键执行借方和贷方金额切换\nif (e.getKey() == e.ENTER) {\n  // 账簿\n  var ledgerId = app.LEDGER_ID_XWL.LEDGER_ID.getValue() ;\n  if(ledgerId === \"\" ||ledgerId === null || ledgerId === undefined){\n    Wb.info('请选择账簿!') ;\n    return false ;\n  }\n  \n  // 会计日期\n  var accDate = app.GL_DATE.getValue();\n  if(accDate === \"\" ||accDate === null || accDate === undefined){\n    Wb.info('请选择会计日期!') ;\n    return false ;\n  }else{\n    accDate = Wb.dateToStr(accDate).substring(0,7);\n  }\n  \n  // TODO: 当前选中\n  var r = app.grid3.getSelection()[0] ; \n  \n  // TODO: 显示科目选择窗口\n  Wb.run({\n    url:'m?xwl=xc/gl/journal/v-windows/handler-ccid-win',\n    params : {\n      'ledgerId' : ledgerId ,\n      'vtype' : '{#vtype#}'\n    },          \n    success:function(appObj){\n      appObj.initWindow({\n        accName : r.data.ACC_NAME,\n        ledgerId : ledgerId,\n        periodCode : accDate ,\n        groupId : 'ALL',\n        handlerCCID : function(returnObj){\n          // TODO: 处理CCID信息\n          var rObj = Wb.decode(returnObj) ;\n          r.set('ACC_ID', rObj.acc_id) ;    \n          r.set('ACC_NAME', rObj.acc_name);\n          r.set('CCID', rObj.acc_ccid) ;    \n          r.set('CCID_NAME', rObj.acc_ccid_name);\n          if(!Wb.isEmpty(rObj.dim_id)){\n            r.set('DIM_ID', rObj.dim_id) ;\n            r.set('DIM_NAME', rObj.dim_name) ;\n          }\n          // 禁用账簿\n           app.LEDGER_ID_XWL.LEDGER_ID.setReadOnly(true) ;\n        }\n      });\n    }  \n  }) ;   \n}"},"children":[],"expanded":true,"type":"combo"}],"expanded":true,"type":"column"},{"configs":{"text":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#AMOUNT#}","width":"100","dataIndex":"AMOUNT","format":"0,000.00","titleAlign":"center","itemId":"AMOUNT_COL"},"children":[{"configs":{"allowBlank":"false","itemId":"editor"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"column"},{"configs":{"text":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#DESCRIPTION#}","width":"200","dataIndex":"DESCRIPTION","titleAlign":"center","itemId":"DESCRIPTION_COL"},"children":[{"configs":{"allowBlank":"false","itemId":"editor"},"children":[],"expanded":false,"type":"textarea"}],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"},{"configs":{"region":"south","pagingBar":"false","height":"200","hidden":"true","itemId":"grid4","editable":"true"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/ap/pay/DB/XC_AP_PAY_L_SELECT"},"children":[],"expanded":false,"type":"store"},{"configs":{"normalName":"grid4Tbar","itemId":"tbar"},"children":[{"configs":{"text":"{#payBtn#}","hidden":"true","normalName":"grid4PayBtn","itemId":"payBtn"},"events":{"click":"var payHId = app.AP_PAY_H_ID.getValue();\n\nvar ledgerId = app.LEDGER_ID_XWL.LEDGER_ID.getValue();\n\nif(Wb.isEmpty(ledgerId)){\n\tWb.toast('请先选择账簿！');\n    return false;\n}\n\nif(app.grid4.getStore().getCount()>0){\n\tWb.toast('预付款明细不能超过一条！');\n    return false;\n}\n\nvar curGrid = app.grid4;\nWb.run({\n  url: 'm?xwl=xc/ap/pay/LOV/LOV_XC_AP_PAY_H', \n  success: function(app) {\n    app.initWin({\n\t\tLEDGER_ID:ledgerId,\n        AP_DOC_CAT_CODE:'YUFK',\n        hideFun:function(rs){\n          Wb.each(rs, function(r) {\n                r.set('L_AP_PAY_H_ID',r.get('AP_PAY_H_ID'));\n                r.set('L_AP_PAY_L_ID',r.get('AP_PAY_L_ID'));\n                r.set('AP_PAY_L_ID',Xip.getId());\n                r.set('AP_PAY_H_ID',payHId);\n                var grid1Store = curGrid.getStore();\n                for(var i=0;i<grid1Store.getCount();i++){\n                  var gr = grid1Store.getAt(i);\n                  if(gr.get('L_AP_PAY_L_ID')==r.get('L_AP_PAY_L_ID')){\n                    return false;\n                  }\n                }\n                Wb.add(curGrid, {\n                  AP_PAY_L_ID:r.get('AP_PAY_L_ID'),\n                  AP_PAY_H_ID:r.get('AP_PAY_H_ID'),\n                  L_AP_PAY_H_ID:r.get('L_AP_PAY_H_ID'),\n                  L_AP_PAY_L_ID:r.get('L_AP_PAY_L_ID'),\n                  AP_INV_GL_H_ID:r.get('AP_INV_GL_H_ID'),\n                  PROJECT_ID:r.get('PROJECT_ID'),\n                  DEPT_ID:r.get('DEPT_ID'),\n                  ACC_ID:r.get('ACC_ID'),\n                  CCID:r.get('CCID'),\n                  AP_DOC_CAT_CODE:r.get('AP_DOC_CAT_CODE'),\n                  AP_CONTRACT_ID:r.get('AP_CONTRACT_ID'),\n                  AP_PAY_H_CODE:r.get('AP_PAY_H_CODE'),\n                  AP_DOC_CAT_NAME:r.get('AP_DOC_CAT_NAME'),\n                  AP_INV_GL_H_CODE:r.get('AP_INV_GL_H_CODE'),\n                  AP_CONTRACT_NAME:r.get('AP_CONTRACT_NAME'),\n                  DEPT_NAME:r.get('DEPT_NAME'),\n                  PROJECT_NAME:r.get('PROJECT_NAME'),\n                  ACC_NAME:r.get('ACC_NAME'),\n                  AMOUNT:r.get('PAY_AMT')*-1,\n                  DESCRIPTION:r.get('DESCRIPTION')\n                }, 'after', 1, false);\n              });\n        }\n    });\n  }\n});\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#createBtn#}","hidden":"true","normalName":"grid4CreateBtn","itemId":"createBtn"},"events":{"click":"var payHId = app.AP_PAY_H_ID.getValue();\nvar ledgerId = app.LEDGER_ID_XWL.LEDGER_ID.getValue();\nif(Wb.isEmpty(ledgerId)){\n\tWb.toast('请先选择账簿！');\n    return false;\n}\n\nif(app.grid4.getStore().getCount()>0){\n\tWb.toast('预付款明细不能超过一条！');\n    return false;\n}\n\nvar curGrid = app.grid4;\nWb.request({\n  url: 'm?xwl=xc/ap/ld/ledgers/DB/XC_GL_LEDGERS_SELECT_BY_ID',\n  params: {\n    LEDGER_ID: app.LEDGER_ID_XWL.LEDGER_ID.getValue()\n  },\n  success: function(resp) {\n    var o = Wb.decode(resp.responseText);\n    Wb.addEdit(curGrid,{\n      AP_PAY_L_ID:Xip.getId(),\n      AP_PAY_H_ID:payHId,\n      ACC_ID:o.AP_ACC_ID_PRE,\n      ACC_NAME:o.AP_ACC_NAME_PRE,  \n      DESCRIPTION:app.DESCRIPTION.getValue()\n    });\n  }\n});\n// Wb.run({\n//   url: 'm?xwl=xc/ap/pay/LOV/LOV_XC_AP_PUR_TYPE', \n//   success: function(app) {\n//     app.initWin({\n// \t\tAP_PAY_H_ID:payHId,\n//         AP_DOC_CAT_CODE:'',\n//         LEDGER_ID:ledgerId,\n//         hideFun:function(rs){\n//               Wb.each(rs, function(r) {\n//                 r.set('AP_PAY_L_ID',Xip.getId());\n//                 r.set('AP_PAY_H_ID',payHId);\n//                 var grid1Store = curGrid.getStore();\n//                 for(var i=0;i<grid1Store.getCount();i++){\n//                   var gr = grid1Store.getAt(i);\n//                   if(gr.get('AP_PUR_TYPE_ID')==r.get('AP_PUR_TYPE_ID')){\n//                     return false;\n//                   }\n//                 }\n//                 Wb.add(curGrid, {\n//                   AP_PAY_L_ID:r.get('AP_PAY_L_ID'),\n//                   AP_PAY_H_ID:r.get('AP_PAY_H_ID'),\n//                   AP_PAY_REQ_H_ID:r.get('AP_PAY_REQ_H_ID'),\n//                   AP_PAY_REQ_L_ID:r.get('AP_PAY_REQ_L_ID'),\n//                   AP_PAY_REQ_H_CODE:r.get('AP_PAY_REQ_H_CODE'),\n//                   AP_INV_GL_H_ID:r.get('AP_INV_GL_H_ID'),\n//                   PROJECT_ID:r.get('PROJECT_ID'),\n//                   DEPT_ID:r.get('DEPT_ID'),\n//                   ACC_ID:r.get('AP_ACC_ID_DEBT'),\n//                   CCID:r.get('CCID'),\n//                   CCID_NAME:r.get('CCID_NAME'),\n//                   AP_DOC_CAT_CODE:r.get('GL_AP_DOC_CAT_CODE'),\n//                   AP_CONTRACT_ID:r.get('AP_CONTRACT_ID'),\n//                   AP_PUR_TYPE_ID:r.get('AP_PUR_TYPE_ID'),\n//                   AP_PUR_TYPE_NAME:r.get('AP_PUR_TYPE_NAME'),\n//                   BG_ITEM_ID:r.get('BG_ITEM_ID'),\n//                   BG_ITEM_NAME:r.get('BG_ITEM_NAME'),\n//                   AP_PAY_H_CODE:r.get('AP_PAY_H_CODE'),\n//                   AP_DOC_CAT_NAME:r.get('GL_AP_DOC_CAT_NAME'),\n//                   AP_INV_GL_H_CODE:r.get('AP_INV_GL_H_CODE'),\n//                   AP_CONTRACT_NAME:r.get('AP_CONTRACT_NAME'),\n//                   DEPT_NAME:r.get('DEPT_NAME'),\n//                   PROJECT_NAME:r.get('PROJECT_NAME'),\n//                   ACC_NAME:r.get('AP_ACC_NAME_DEBT'),\n//                   AMOUNT:r.get('PAY_AMT')*-1,\n//                   DESCRIPTION:r.get('DESCRIPTION')\n//                 }, 'after', 1, false);\n//               });\n//         }\n//     });\n//   }\n// });\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#delBtn#}","itemId":"delBtn"},"events":{"click":"Ext.Msg.confirm(\"警告\", \"确定要删除吗？\", function (button) {\n    if (button == \"yes\") {\n      Wb.remove(app.grid4);\n    }\n});"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","dataIndex":"AP_PAY_L_ID","itemId":"AP_PAY_L_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"AP_PAY_H_ID","itemId":"AP_PAY_H_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"L_AP_PAY_L_ID","itemId":"L_AP_PAY_L_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"L_AP_PAY_H_ID","itemId":"L_AP_PAY_H_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"AP_PAY_REQ_H_ID","itemId":"AP_PAY_REQ_H_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"AP_INV_GL_H_ID","itemId":"AP_INV_GL_H_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"AP_PUR_TYPE_ID","itemId":"AP_PUR_TYPE_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"BG_ITEM_ID","itemId":"BG_ITEM_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"ACC_ID","itemId":"ACC_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"CCID","itemId":"CCID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"AP_CONTRACT_ID","itemId":"AP_CONTRACT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"PROJECT_ID","itemId":"PROJECT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"DEPT_ID","itemId":"DEPT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"AP_DOC_CAT_CODE","itemId":"AP_DOC_CAT_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#AP_PAY_H_CODE_COL#}","hidden":"true","width":"120","dataIndex":"AP_PAY_H_CODE","titleAlign":"center","normalName":"grid4ApPayHCode","itemId":"AP_PAY_H_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#DEPT_NAME#}","width":"150","dataIndex":"DEPT_NAME","titleAlign":"center","itemId":"DEPT_NAME_COL"},"children":[{"configs":{"labelWidth":"100","labelAlign":"right","normalName":"DEPT_NAME_PICK","itemId":"editor"},"children":[{"configs":{"tagConfigs":"minWidth:400","hidden":"300","itemId":"pickComp"},"events":{"itemdblclick":"var r=app.grid4.getSelectionModel().getSelection()[0];\nr.set('DEPT_ID',record.data.DEPT_ID);\nr.set('DEPT_NAME',record.data.DEPT_NAME);\nr.dirty = true;\napp.DEPT_NAME_PICK.setValue(record.data.DEPT_NAME);\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"pageSize":"5","autoLoad":"true","itemId":"store","url":"m?xwl=xc/com-lov/DEPT_ID_PICK/DB/GRID_XIP_PUB_DEPTS_SELECT_LD"},"events":{"beforeload":"operation.params = Wb.getValue([app.form1,app.tbar]);"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","dataIndex":"DEPT_ID","itemId":"DEPT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"成本中心编码","dataIndex":"DEPT_CODE","itemId":"DEPT_CODE_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"成本中心名称","dataIndex":"DEPT_NAME","itemId":"DEPT_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"100","emptyText":"成本中心编码/名称","labelAlign":"right","itemId":"QUERY_CODE_NAME"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.pickComp.getStore().load();\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":true,"type":"column"},{"configs":{"text":"{#PROJECT_NAME#}","width":"150","dataIndex":"PROJECT_NAME","titleAlign":"center","itemId":"PROJECT_NAME_COL"},"children":[{"configs":{"labelWidth":"100","labelAlign":"right","normalName":"PROJECT_NAME_PICK","itemId":"editor"},"children":[{"configs":{"tagConfigs":"minWidth:400","hidden":"300","itemId":"pickComp"},"events":{"itemdblclick":"var r=app.grid4.getSelectionModel().getSelection()[0];\nr.set('PROJECT_ID',record.data.PROJECT_ID);\nr.set('PROJECT_NAME',record.data.PROJECT_NAME);\nr.dirty = true;\napp.PROJECT_NAME_PICK.setValue(record.data.PROJECT_NAME);\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"pageSize":"5","autoLoad":"true","itemId":"store","url":"m?xwl=xc/com-lov/PROJECT_ID_PICK/DB/GRID_XC_PM_PROJECT_SELECT"},"events":{"beforeload":"operation.params = Wb.getValue([app.form1,app.tbar]);"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","dataIndex":"PROJECT_ID","itemId":"PROJECT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"项目编码","dataIndex":"PROJECT_CODE","itemId":"PROJECT_CODE_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"项目名称","dataIndex":"PROJECT_NAME","itemId":"PROJECT_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"100","emptyText":"项目编码/名称","labelAlign":"right","itemId":"QUERY_CODE_NAME"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.pickComp.getStore().load();\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":true,"type":"column"},{"configs":{"text":"{#AP_CONTRACT_NAME#}","hidden":"true","width":"150","dataIndex":"AP_CONTRACT_NAME","titleAlign":"center","itemId":"AP_CONTRACT_NAME_COL"},"children":[{"configs":{"labelWidth":"100","labelAlign":"right","normalName":"AP_CONTRACT_NAME_PICK","itemId":"editor"},"children":[{"configs":{"tagConfigs":"minWidth:400","hidden":"300","itemId":"pickComp"},"events":{"itemdblclick":"var r=app.grid4.getSelectionModel().getSelection()[0];\nr.set('AP_CONTRACT_ID',record.data.AP_CONTRACT_ID);\nr.set('AP_CONTRACT_NAME',record.data.AP_CONTRACT_NAME);\nr.dirty = true;\napp.AP_CONTRACT_NAME_PICK.setValue(record.data.AP_CONTRACT_NAME);\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"pageSize":"5","autoLoad":"true","itemId":"store","url":"m?xwl=xc/ap/ap-com-lov/AP_CONTRACT_ID_PICK/DB/GRID_XC_AP_CONTRACT_SELECT"},"events":{"beforeload":"operation.params = Wb.getValue([app.form1,app.tbar]);"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","dataIndex":"AP_CONTRACT_ID","itemId":"AP_CONTRACT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"项目编码","dataIndex":"AP_CONTRACT_CODE","itemId":"AP_CONTRACT_CODE_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"项目名称","dataIndex":"AP_CONTRACT_NAME","itemId":"AP_CONTRACT_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"100","emptyText":"合同编码/名称","labelAlign":"right","itemId":"QUERY_CODE_NAME"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.pickComp.getStore().load();\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":true,"type":"column"},{"configs":{"text":"{#BG_ITEM_NAME#}","width":"150","dataIndex":"BG_ITEM_NAME","titleAlign":"center","itemId":"BG_ITEM_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#AP_PUR_TYPE_NAME#}","hidden":"true","width":"120","dataIndex":"AP_PUR_TYPE_NAME","titleAlign":"center","itemId":"AP_PUR_TYPE_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#ACC_NAME#}","width":"150","dataIndex":"ACC_NAME","titleAlign":"center","itemId":"ACC_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#CCID_NAME#}","hidden":"true","width":"150","dataIndex":"CCID_NAME","titleAlign":"center","itemId":"CCID_NAME_COL"},"children":[{"configs":{"labelWidth":"100","labelAlign":"right","normalName":"CCID_NAME_PICK","itemId":"editor"},"children":[{"configs":{"tagConfigs":"minWidth:400","hidden":"300","itemId":"pickComp"},"events":{"itemdblclick":"var r=app.grid4.getSelectionModel().getSelection()[0];\nr.set('CCID',record.data.CCID);\nr.set('CCID_NAME',record.data.CCID_NAME);\nr.dirty = true;\napp.CCID_NAME_PICK.setValue(record.data.CCID_NAME);\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"pageSize":"5","autoLoad":"true","itemId":"store","url":"m?xwl=xc/com-lov/CCID_PICK/DB/GRID_XC_GL_CCID_SELECT"},"events":{"beforeload":"operation.params = Wb.getValue([app.form1,app.tbar]);"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","dataIndex":"CCID","itemId":"CCID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"科目组合编码","dataIndex":"CCID_CODE","itemId":"CCID_CODE_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"科目组合名称","dataIndex":"CCID_NAME","itemId":"CCID_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"100","emptyText":"科目组合编码/名称","labelAlign":"right","itemId":"QUERY_CODE_NAME"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.pickComp.getStore().load();\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":true,"type":"column"},{"configs":{"text":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#AMOUNT#}","width":"100","dataIndex":"AMOUNT","format":"0,000.00","titleAlign":"center","itemId":"AMOUNT_COL"},"children":[{"configs":{"allowBlank":"false","itemId":"editor","maxValue":"0"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"column"},{"configs":{"text":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#DESCRIPTION#}","width":"200","dataIndex":"DESCRIPTION","titleAlign":"center","itemId":"DESCRIPTION_COL"},"children":[{"configs":{"allowBlank":"false","itemId":"editor"},"children":[],"expanded":false,"type":"textarea"}],"expanded":true,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"},{"configs":{"region":"south","pagingBar":"false","height":"200","hidden":"true","itemId":"grid5","editable":"true"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/ap/pay/DB/XC_AP_PAY_L_SELECT"},"children":[],"expanded":false,"type":"store"},{"configs":{"normalName":"grid5Tbar","itemId":"tbar"},"children":[{"configs":{"text":"{#reqBtn#}","hidden":"true","normalName":"grid5ReqBtn","itemId":"reqBtn"},"events":{"click":"var payHId = app.AP_PAY_H_ID.getValue();\nvar ledgerId = app.LEDGER_ID_XWL.LEDGER_ID.getValue();\nvar vendorId = app.VENDOR_ID_XWL.VENDOR_ID.getValue();\nif(Wb.isEmpty(ledgerId)){\n\tWb.toast('请先选择账簿！');\n    return false;\n}\nif(Wb.isEmpty(vendorId)){\n\tWb.toast('请先选择供应商！');\n    return false;\n}\nvar curGrid = app.grid5;\nvar P_AP_CONTRACT_NAME = app.AP_CONTRACT_ID_XWL.AP_CONTRACT_NAME.getValue();\nvar P_AP_DOC_CAT_CODE = app.AP_DOC_CAT_CODE.getValue();\nWb.run({\n  url: 'm?xwl=xc/ap/pay/LOV/LOV_XC_AP_PAY_REQ_H', \n  success: function(app) {\n    app.initWin({\n\t\tAP_PAY_H_ID:payHId,\n        AP_DOC_CAT_CODE:P_AP_DOC_CAT_CODE,\n        AP_CONTRACT_NAME:P_AP_CONTRACT_NAME,\n        LEDGER_ID:ledgerId,\n        VENDOR_ID:vendorId,\n        hideFun:function(rs){\n              Wb.each(rs, function(r) {\n                r.set('AP_PAY_L_ID',Xip.getId());\n                r.set('AP_PAY_H_ID',payHId);\n                var grid1Store = curGrid.getStore();\n                for(var i=0;i<grid1Store.getCount();i++){\n                  var gr = grid1Store.getAt(i);\n                  if(gr.get('AP_PAY_REQ_L_ID')==r.get('AP_PAY_REQ_L_ID')){\n                    return false;\n                  }\n                }\n                if(!Wb.isEmpty(r.get('AP_ACC_NAME_INV'))){\n                 r.set('AP_ACC_ID_DEBT',r.get('AP_ACC_ID_INV'));\n                 r.set('AP_ACC_NAME_DEBT',r.get('AP_ACC_NAME_INV'));\n                }\n                Wb.add(curGrid, {\n                  AP_PAY_L_ID:r.get('AP_PAY_L_ID'),\n                  AP_PAY_H_ID:r.get('AP_PAY_H_ID'),\n                  AP_PAY_REQ_H_ID:r.get('AP_PAY_REQ_H_ID'),\n                  AP_PAY_REQ_L_ID:r.get('AP_PAY_REQ_L_ID'),\n                  AP_PAY_REQ_H_CODE:r.get('AP_PAY_REQ_H_CODE'),\n                  AP_INV_GL_H_ID:r.get('AP_INV_GL_H_ID'),\n                  PROJECT_ID:r.get('PROJECT_ID'),\n                  AP_PUR_TYPE_ID:r.get('AP_PUR_TYPE_ID'),\n                  AP_PUR_TYPE_NAME:r.get('AP_PUR_TYPE_NAME'),\n                  DEPT_ID:r.get('DEPT_ID'),\n                  ACC_ID:r.get('AP_ACC_ID_DEBT'),\n                  CCID:r.get('CCID'),\n                  AP_DOC_CAT_CODE:r.get('GL_AP_DOC_CAT_CODE'),\n                  AP_CONTRACT_ID:r.get('AP_CONTRACT_ID'),\n                  AP_PAY_H_CODE:r.get('AP_PAY_H_CODE'),\n                  AP_DOC_CAT_NAME:r.get('GL_AP_DOC_CAT_NAME'),\n                  AP_INV_GL_H_CODE:r.get('AP_INV_GL_H_CODE'),\n                  AP_CONTRACT_NAME:r.get('AP_CONTRACT_NAME'),\n                  DEPT_NAME:r.get('DEPT_NAME'),\n                  PROJECT_NAME:r.get('PROJECT_NAME'),\n                  ACC_NAME:r.get('AP_ACC_NAME_DEBT'),\n                  AMOUNT:r.get('PAY_AMT'),\n                  DESCRIPTION:r.get('DESCRIPTION')\n                }, 'after', 1, false);\n              });\n        }\n    });\n  }\n});\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#purTypeBtn#}","hidden":"true","normalName":"grid5PurTypeBtn","itemId":"purTypeBtn"},"events":{"click":"var payHId = app.AP_PAY_H_ID.getValue();\nvar ledgerId = app.LEDGER_ID_XWL.LEDGER_ID.getValue();\nif(Wb.isEmpty(ledgerId)){\n\tWb.toast('请先选择账簿！');\n    return false;\n}\nvar curGrid = app.grid5;\nWb.run({\n  url: 'm?xwl=xc/ap/pay/LOV/LOV_XC_AP_PUR_TYPE', \n  success: function(app) {\n    app.initWin({\n\t\tAP_PAY_H_ID:payHId,\n        AP_DOC_CAT_CODE:'',\n        LEDGER_ID:ledgerId,\n        hideFun:function(rs){\n              Wb.each(rs, function(r) {\n                r.set('AP_PAY_L_ID',Xip.getId());\n                r.set('AP_PAY_H_ID',payHId);\n                r.set('ACC_ID',r.get('AP_ACC_ID_INV'));\n                r.set('ACC_NAME',r.get('AP_ACC_NAME_INV'));\n                r.set('AMOUNT',r.get('PAY_AMT'));\n                r.set('AP_DOC_CAT_CODE',r.get('GL_AP_DOC_CAT_CODE'));\n                r.set('AP_DOC_CAT_NAME',r.get('GL_AP_DOC_CAT_NAME'));\n                var grid1Store = curGrid.getStore();\n                for(var i=0;i<grid1Store.getCount();i++){\n                  var gr = grid1Store.getAt(i);\n                  if(gr.get('AP_PUR_TYPE_ID')==r.get('AP_PUR_TYPE_ID')){\n                    return false;\n                  }\n                }\n                Wb.add(curGrid,r.data, 'after', 1, false);\n//                 Wb.add(curGrid, {\n//                   AP_PAY_L_ID:r.get('AP_PAY_L_ID'),\n//                   AP_PAY_H_ID:r.get('AP_PAY_H_ID'),\n//                   AP_PAY_REQ_H_ID:r.get('AP_PAY_REQ_H_ID'),\n//                   AP_PAY_REQ_L_ID:r.get('AP_PAY_REQ_L_ID'),\n//                   AP_PAY_REQ_H_CODE:r.get('AP_PAY_REQ_H_CODE'),\n//                   AP_INV_GL_H_ID:r.get('AP_INV_GL_H_ID'),\n//                   PROJECT_ID:r.get('PROJECT_ID'),\n//                   DEPT_ID:r.get('DEPT_ID'),\n//                   ACC_ID:r.get('AP_ACC_ID_DEBT'),\n//                   CCID:r.get('CCID'),\n//                   CCID_NAME:r.get('CCID_NAME'),\n//                   AP_DOC_CAT_CODE:r.get('GL_AP_DOC_CAT_CODE'),\n//                   AP_CONTRACT_ID:r.get('AP_CONTRACT_ID'),\n//                   AP_PUR_TYPE_ID:r.get('AP_PUR_TYPE_ID'),\n//                   AP_PUR_TYPE_NAME:r.get('AP_PUR_TYPE_NAME'),\n//                   BG_ITEM_ID:r.get('BG_ITEM_ID'),\n//                   BG_ITEM_NAME:r.get('BG_ITEM_NAME'),\n//                   AP_PAY_H_CODE:r.get('AP_PAY_H_CODE'),\n//                   AP_DOC_CAT_NAME:r.get('GL_AP_DOC_CAT_NAME'),\n//                   AP_INV_GL_H_CODE:r.get('AP_INV_GL_H_CODE'),\n//                   AP_CONTRACT_NAME:r.get('AP_CONTRACT_NAME'),\n//                   DEPT_NAME:r.get('DEPT_NAME'),\n//                   PROJECT_NAME:r.get('PROJECT_NAME'),\n//                   ACC_NAME:r.get('AP_ACC_NAME_DEBT'),\n//                   AMOUNT:r.get('PAY_AMT'),\n//                   DESCRIPTION:r.get('DESCRIPTION')\n//                 }, 'after', 1, false);\n              });\n        }\n    });\n  }\n});\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#delBtn#}","itemId":"delBtn"},"events":{"click":"Ext.Msg.confirm(\"警告\", \"确定要删除吗？\", function (button) {\n    if (button == \"yes\") {\n      Wb.remove(app.grid5);\n    }\n});"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","dataIndex":"AP_PAY_L_ID","itemId":"AP_PAY_L_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"AP_PAY_H_ID","itemId":"AP_PAY_H_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"L_AP_PAY_L_ID","itemId":"L_AP_PAY_L_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"L_AP_PAY_H_ID","itemId":"L_AP_PAY_H_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"AP_PAY_REQ_H_ID","itemId":"AP_PAY_REQ_H_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"AP_INV_GL_H_ID","itemId":"AP_INV_GL_H_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"AP_PUR_TYPE_ID","itemId":"AP_PUR_TYPE_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"BG_ITEM_ID","itemId":"BG_ITEM_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"ACC_ID","itemId":"ACC_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"CCID","itemId":"CCID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"AP_CONTRACT_ID","itemId":"AP_CONTRACT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"PROJECT_ID","itemId":"PROJECT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"DEPT_ID","itemId":"DEPT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"AP_DOC_CAT_CODE","itemId":"AP_DOC_CAT_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#AP_PAY_REQ_H_CODE_COL#}","width":"120","dataIndex":"AP_PAY_REQ_H_CODE","titleAlign":"center","normalName":"grid5ApPayReqHCode","itemId":"AP_PAY_REQ_H_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#DEPT_NAME#}","width":"150","dataIndex":"DEPT_NAME","titleAlign":"center","itemId":"DEPT_NAME_COL"},"children":[{"configs":{"labelWidth":"100","labelAlign":"right","normalName":"DEPT_NAME_PICK","itemId":"editor"},"children":[{"configs":{"tagConfigs":"minWidth:400","hidden":"300","itemId":"pickComp"},"events":{"itemdblclick":"var r=app.grid5.getSelectionModel().getSelection()[0];\nr.set('DEPT_ID',record.data.DEPT_ID);\nr.set('DEPT_NAME',record.data.DEPT_NAME);\nr.dirty = true;\napp.DEPT_NAME_PICK.setValue(record.data.DEPT_NAME);\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"pageSize":"5","autoLoad":"true","itemId":"store","url":"m?xwl=xc/com-lov/DEPT_ID_PICK/DB/GRID_XIP_PUB_DEPTS_SELECT_LD"},"events":{"beforeload":"operation.params = Wb.getValue([app.form1,app.tbar]);"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","dataIndex":"DEPT_ID","itemId":"DEPT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"成本中心编码","dataIndex":"DEPT_CODE","itemId":"DEPT_CODE_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"成本中心名称","dataIndex":"DEPT_NAME","itemId":"DEPT_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"100","emptyText":"成本中心编码/名称","labelAlign":"right","itemId":"QUERY_CODE_NAME"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.pickComp.getStore().load();\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":true,"type":"column"},{"configs":{"text":"{#PROJECT_NAME#}","width":"150","dataIndex":"PROJECT_NAME","titleAlign":"center","itemId":"PROJECT_NAME_COL"},"children":[{"configs":{"labelWidth":"100","labelAlign":"right","normalName":"PROJECT_NAME_PICK","itemId":"editor"},"children":[{"configs":{"tagConfigs":"minWidth:400","hidden":"300","itemId":"pickComp"},"events":{"itemdblclick":"var r=app.grid5.getSelectionModel().getSelection()[0];\nr.set('PROJECT_ID',record.data.PROJECT_ID);\nr.set('PROJECT_NAME',record.data.PROJECT_NAME);\nr.dirty = true;\napp.PROJECT_NAME_PICK.setValue(record.data.PROJECT_NAME);\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"pageSize":"5","autoLoad":"true","itemId":"store","url":"m?xwl=xc/com-lov/PROJECT_ID_PICK/DB/GRID_XC_PM_PROJECT_SELECT"},"events":{"beforeload":"operation.params = Wb.getValue([app.form1,app.tbar]);"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","dataIndex":"PROJECT_ID","itemId":"PROJECT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"项目编码","dataIndex":"PROJECT_CODE","itemId":"PROJECT_CODE_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"项目名称","dataIndex":"PROJECT_NAME","itemId":"PROJECT_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"100","emptyText":"项目编码/名称","labelAlign":"right","itemId":"QUERY_CODE_NAME"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.pickComp.getStore().load();\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":true,"type":"column"},{"configs":{"text":"{#AP_CONTRACT_NAME#}","hidden":"true","width":"150","dataIndex":"AP_CONTRACT_NAME","titleAlign":"center","itemId":"AP_CONTRACT_NAME_COL"},"children":[{"configs":{"labelWidth":"100","labelAlign":"right","normalName":"AP_CONTRACT_NAME_PICK","itemId":"editor"},"children":[{"configs":{"tagConfigs":"minWidth:400","hidden":"300","itemId":"pickComp"},"events":{"itemdblclick":"var r=app.grid5.getSelectionModel().getSelection()[0];\nr.set('AP_CONTRACT_ID',record.data.AP_CONTRACT_ID);\nr.set('AP_CONTRACT_NAME',record.data.AP_CONTRACT_NAME);\nr.dirty = true;\napp.AP_CONTRACT_NAME_PICK.setValue(record.data.AP_CONTRACT_NAME);\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"pageSize":"5","autoLoad":"true","itemId":"store","url":"m?xwl=xc/ap/ap-com-lov/AP_CONTRACT_ID_PICK/DB/GRID_XC_AP_CONTRACT_SELECT"},"events":{"beforeload":"operation.params = Wb.getValue([app.form1,app.tbar]);"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","dataIndex":"AP_CONTRACT_ID","itemId":"AP_CONTRACT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"项目编码","dataIndex":"AP_CONTRACT_CODE","itemId":"AP_CONTRACT_CODE_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"项目名称","dataIndex":"AP_CONTRACT_NAME","itemId":"AP_CONTRACT_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"100","emptyText":"合同编码/名称","labelAlign":"right","itemId":"QUERY_CODE_NAME"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.pickComp.getStore().load();\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":true,"type":"column"},{"configs":{"text":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#AP_PUR_TYPE_NAME#}","width":"120","dataIndex":"AP_PUR_TYPE_NAME","titleAlign":"center","itemId":"AP_PUR_TYPE_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#BG_ITEM_NAME#}","width":"150","dataIndex":"BG_ITEM_NAME","titleAlign":"center","itemId":"BG_ITEM_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#ACC_NAME#}","width":"150","dataIndex":"ACC_NAME","titleAlign":"center","itemId":"ACC_NAME_COL"},"children":[{"configs":{"labelWidth":"100","labelAlign":"right","normalName":"ACC_NAME_PICK","itemId":"editor"},"children":[{"configs":{"tagConfigs":"minWidth:400","hidden":"300","itemId":"pickComp"},"events":{"itemdblclick":"var r=app.grid5.getSelectionModel().getSelection()[0];\nr.set('ACC_ID',record.data.ACC_ID);\nr.set('ACC_NAME',record.data.ACC_NAME);\nr.dirty = true;\napp.ACC_NAME_PICK.setValue(record.data.ACC_NAME);\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"pageSize":"5","autoLoad":"true","itemId":"store","url":"m?xwl=xc/com-lov/ACC_ID_PICK/DB/XC_BG_LD_ACCOUNTS_SELECT_LD"},"events":{"beforeload":"operation.params = Wb.getValue([app.form1,app.tbar]);"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","dataIndex":"ACC_ID","itemId":"ACC_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"科目编码","dataIndex":"ACC_CODE","itemId":"ACC_CODE_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"科目名称","dataIndex":"ACC_NAME","itemId":"ACC_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"100","emptyText":"科目编码/名称","labelAlign":"right","itemId":"QUERY_CODE_NAME"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.pickComp.getStore().load();\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":false,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":true,"type":"column"},{"configs":{"text":"{#CCID_NAME#}","width":"150","dataIndex":"CCID_NAME","titleAlign":"center","itemId":"CCID_NAME_COL"},"children":[{"configs":{"displayField":"CCID_NAME","triggerCls":"x-form-search-trigger","valueField":"CCID","itemId":"editor","onTriggerClick":"  // 账簿\n  var ledgerId = app.LEDGER_ID_XWL.LEDGER_ID.getValue() ;\n  if(ledgerId === \"\" ||ledgerId === null || ledgerId === undefined){\n    Wb.info('请选择账簿!') ;\n    return false ;\n  }\n  \n  // 会计日期\n  var accDate = app.GL_DATE.getValue() ;\n  if(accDate === \"\" ||accDate === null || accDate === undefined){\n    Wb.info('请选择会计日期!') ;\n    return false ;\n  }else{\n\taccDate = Wb.dateToStr(accDate).substring(0,7);\n  }\n  \n  // TODO: 当前选中\n  var r = app.grid5.getSelection()[0] ; \n  \n  // TODO: 显示科目选择窗口\n  Wb.run({\n    url:'m?xwl=xc/gl/journal/v-windows/handler-ccid-win',\n    params : {\n      'ledgerId' : ledgerId,\n      'vtype' : '{#vtype#}'\n    },          \n    success:function(appObj){\n      appObj.initWindow({\n        accName : r.data.ACC_NAME,\n        ledgerId : ledgerId,\n        periodCode : accDate ,\n        groupId : 'ALL',\n        handlerCCID : function(returnObj){\n          // TODO: 处理CCID信息\n          var rObj = Wb.decode(returnObj) ;\n          r.set('ACC_ID', rObj.acc_id) ;    \n          r.set('ACC_NAME', rObj.acc_name);\n          r.set('CCID', rObj.acc_ccid) ;    \n          r.set('CCID_NAME', rObj.acc_ccid_name);\n          // 禁用账簿\n           app.LEDGER_ID_XWL.LEDGER_ID.setReadOnly(true) ;\n        }\n      });\n    }  \n  }) ;   "},"events":{"beforequery":"var combo = e.combo;\nif(!e.forceAll){\n  var value = e.query;\n  combo.store.filterBy(function(record,id){\n    var text = record.get(combo.displayField);\n    return (text.indexOf(value)!=-1);\n  });\n  combo.expand();\n  return false;\n}","specialkey":"// TODO: 按回车键执行借方和贷方金额切换\nif (e.getKey() == e.ENTER) {\n  // 账簿\n  var ledgerId = app.LEDGER_ID_XWL.LEDGER_ID.getValue() ;\n  if(ledgerId === \"\" ||ledgerId === null || ledgerId === undefined){\n    Wb.info('请选择账簿!') ;\n    return false ;\n  }\n  \n  // 会计日期\n  var accDate = app.GL_DATE.getValue();\n  if(accDate === \"\" ||accDate === null || accDate === undefined){\n    Wb.info('请选择会计日期!') ;\n    return false ;\n  }else{\n    accDate = Wb.dateToStr(accDate).substring(0,7);\n  }\n  \n  // TODO: 当前选中\n  var r = app.grid5.getSelection()[0] ; \n  \n  // TODO: 显示科目选择窗口\n  Wb.run({\n    url:'m?xwl=xc/gl/journal/v-windows/handler-ccid-win',\n    params : {\n      'ledgerId' : ledgerId ,\n      'vtype' : '{#vtype#}'\n    },          \n    success:function(appObj){\n      appObj.initWindow({\n        accName : r.data.ACC_NAME,\n        ledgerId : ledgerId,\n        periodCode : accDate ,\n        groupId : 'ALL',\n        handlerCCID : function(returnObj){\n          // TODO: 处理CCID信息\n          var rObj = Wb.decode(returnObj) ;\n          r.set('ACC_ID', rObj.acc_id) ;    \n          r.set('ACC_NAME', rObj.acc_name);\n          r.set('CCID', rObj.acc_ccid) ;    \n          r.set('CCID_NAME', rObj.acc_ccid_name);\n          // 禁用账簿\n           app.LEDGER_ID_XWL.LEDGER_ID.setReadOnly(true) ;\n        }\n      });\n    }  \n  }) ;   \n}"},"children":[],"expanded":true,"type":"combo"}],"expanded":true,"type":"column"},{"configs":{"text":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#AMOUNT#}","width":"100","dataIndex":"AMOUNT","format":"0,000.00","titleAlign":"center","itemId":"AMOUNT_COL"},"children":[{"configs":{"itemId":"editor"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"column"},{"configs":{"text":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#DESCRIPTION#}","width":"200","dataIndex":"DESCRIPTION","titleAlign":"center","itemId":"DESCRIPTION_COL"},"children":[{"configs":{"allowBlank":"false","itemId":"editor"},"children":[],"expanded":false,"type":"textarea"}],"expanded":true,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"},{"configs":{"region":"south","pagingBar":"false","height":"200","hidden":"true","itemId":"grid6","editable":"true"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/ap/pay/DB/XC_AP_PAY_L_SELECT"},"children":[],"expanded":false,"type":"store"},{"configs":{"normalName":"grid6Tbar","itemId":"tbar"},"children":[{"configs":{"text":"{#createBtn#}","normalName":"grid6CreateBtn","itemId":"createBtn"},"events":{"click":"var payHId = app.AP_PAY_H_ID.getValue();\nvar ledgerId = app.LEDGER_ID_XWL.LEDGER_ID.getValue();\nif(Wb.isEmpty(ledgerId)){\n\tWb.toast('请先选择账簿！');\n    return false;\n}\nvar curGrid = app.grid6;\nWb.run({\n  url: 'm?xwl=xc/ap/pay/LOV/LOV_XC_AP_PUR_TYPE', \n  success: function(app) {\n    app.initWin({\n\t\tAP_PAY_H_ID:payHId,\n        AP_DOC_CAT_CODE:'',\n        LEDGER_ID:ledgerId,\n        hideFun:function(rs){\n              Wb.each(rs, function(r) {\n                r.set('AP_PAY_L_ID',Xip.getId());\n                r.set('AP_PAY_H_ID',payHId);\n                r.set('ACC_ID',r.get('AP_ACC_ID_INV'));\n                r.set('ACC_NAME',r.get('AP_ACC_NAME_INV'));\n                r.set('AMOUNT',r.get('PAY_AMT'));\n                r.set('AP_DOC_CAT_CODE',r.get('GL_AP_DOC_CAT_CODE'));\n                r.set('AP_DOC_CAT_NAME',r.get('GL_AP_DOC_CAT_NAME'));\n                var grid1Store = curGrid.getStore();\n                for(var i=0;i<grid1Store.getCount();i++){\n                  var gr = grid1Store.getAt(i);\n                  if(gr.get('AP_PUR_TYPE_ID')==r.get('AP_PUR_TYPE_ID')){\n                    return false;\n                  }\n                }\n                Wb.add(curGrid,r.data, 'after', 1, false);\n//                 Wb.add(curGrid, {\n//                   AP_PAY_L_ID:r.get('AP_PAY_L_ID'),\n//                   AP_PAY_H_ID:r.get('AP_PAY_H_ID'),\n//                   AP_PAY_REQ_H_ID:r.get('AP_PAY_REQ_H_ID'),\n//                   AP_PAY_REQ_L_ID:r.get('AP_PAY_REQ_L_ID'),\n//                   AP_PAY_REQ_H_CODE:r.get('AP_PAY_REQ_H_CODE'),\n//                   AP_INV_GL_H_ID:r.get('AP_INV_GL_H_ID'),\n//                   PROJECT_ID:r.get('PROJECT_ID'),\n//                   DEPT_ID:r.get('DEPT_ID'),\n//                   ACC_ID:r.get('AP_ACC_ID_DEBT'),\n//                   CCID:r.get('CCID'),\n//                   CCID_NAME:r.get('CCID_NAME'),\n//                   AP_DOC_CAT_CODE:r.get('GL_AP_DOC_CAT_CODE'),\n//                   AP_CONTRACT_ID:r.get('AP_CONTRACT_ID'),\n//                   AP_PUR_TYPE_ID:r.get('AP_PUR_TYPE_ID'),\n//                   AP_PUR_TYPE_NAME:r.get('AP_PUR_TYPE_NAME'),\n//                   BG_ITEM_ID:r.get('BG_ITEM_ID'),\n//                   BG_ITEM_NAME:r.get('BG_ITEM_NAME'),\n//                   AP_PAY_H_CODE:r.get('AP_PAY_H_CODE'),\n//                   AP_DOC_CAT_NAME:r.get('GL_AP_DOC_CAT_NAME'),\n//                   AP_INV_GL_H_CODE:r.get('AP_INV_GL_H_CODE'),\n//                   AP_CONTRACT_NAME:r.get('AP_CONTRACT_NAME'),\n//                   DEPT_NAME:r.get('DEPT_NAME'),\n//                   PROJECT_NAME:r.get('PROJECT_NAME'),\n//                   ACC_NAME:r.get('AP_ACC_NAME_DEBT'),\n//                   AMOUNT:r.get('PAY_AMT')*-1,\n//                   DESCRIPTION:r.get('DESCRIPTION')\n//                 }, 'after', 1, false);\n              });\n        }\n    });\n  }\n});\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#delBtn#}","itemId":"delBtn"},"events":{"click":"Ext.Msg.confirm(\"警告\", \"确定要删除吗？\", function (button) {\n    if (button == \"yes\") {\n      Wb.remove(app.grid6);\n    }\n});"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","dataIndex":"AP_PAY_L_ID","itemId":"AP_PAY_L_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"AP_PAY_H_ID","itemId":"AP_PAY_H_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"L_AP_PAY_L_ID","itemId":"L_AP_PAY_L_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"L_AP_PAY_H_ID","itemId":"L_AP_PAY_H_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"AP_PAY_REQ_H_ID","itemId":"AP_PAY_REQ_H_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"AP_INV_GL_H_ID","itemId":"AP_INV_GL_H_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"AP_PUR_TYPE_ID","itemId":"AP_PUR_TYPE_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"BG_ITEM_ID","itemId":"BG_ITEM_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"ACC_ID","itemId":"ACC_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"CCID","itemId":"CCID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"AP_CONTRACT_ID","itemId":"AP_CONTRACT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"PROJECT_ID","itemId":"PROJECT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"DEPT_ID","itemId":"DEPT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"AP_DOC_CAT_CODE","itemId":"AP_DOC_CAT_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#DEPT_NAME#}","width":"150","dataIndex":"DEPT_NAME","titleAlign":"center","itemId":"DEPT_NAME_COL"},"children":[{"configs":{"labelWidth":"100","labelAlign":"right","normalName":"DEPT_NAME_PICK","itemId":"editor"},"children":[{"configs":{"tagConfigs":"minWidth:400","hidden":"300","itemId":"pickComp"},"events":{"itemdblclick":"var r=app.grid6.getSelectionModel().getSelection()[0];\nr.set('DEPT_ID',record.data.DEPT_ID);\nr.set('DEPT_NAME',record.data.DEPT_NAME);\nr.dirty = true;\napp.DEPT_NAME_PICK.setValue(record.data.DEPT_NAME);\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"pageSize":"5","autoLoad":"true","itemId":"store","url":"m?xwl=xc/com-lov/DEPT_ID_PICK/DB/GRID_XIP_PUB_DEPTS_SELECT_LD"},"events":{"beforeload":"operation.params = Wb.getValue([app.form1,app.tbar]);"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","dataIndex":"DEPT_ID","itemId":"DEPT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"成本中心编码","dataIndex":"DEPT_CODE","itemId":"DEPT_CODE_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"成本中心名称","dataIndex":"DEPT_NAME","itemId":"DEPT_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"100","emptyText":"成本中心编码/名称","labelAlign":"right","itemId":"QUERY_CODE_NAME"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.pickComp.getStore().load();\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":true,"type":"column"},{"configs":{"text":"{#PROJECT_NAME#}","width":"150","dataIndex":"PROJECT_NAME","titleAlign":"center","itemId":"PROJECT_NAME_COL"},"children":[{"configs":{"labelWidth":"100","labelAlign":"right","normalName":"PROJECT_NAME_PICK","itemId":"editor"},"children":[{"configs":{"tagConfigs":"minWidth:400","hidden":"300","itemId":"pickComp"},"events":{"itemdblclick":"var r=app.grid6.getSelectionModel().getSelection()[0];\nr.set('PROJECT_ID',record.data.PROJECT_ID);\nr.set('PROJECT_NAME',record.data.PROJECT_NAME);\nr.dirty = true;\napp.PROJECT_NAME_PICK.setValue(record.data.PROJECT_NAME);\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"pageSize":"5","autoLoad":"true","itemId":"store","url":"m?xwl=xc/com-lov/PROJECT_ID_PICK/DB/GRID_XC_PM_PROJECT_SELECT"},"events":{"beforeload":"operation.params = Wb.getValue([app.form1,app.tbar]);"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","dataIndex":"PROJECT_ID","itemId":"PROJECT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"项目编码","dataIndex":"PROJECT_CODE","itemId":"PROJECT_CODE_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"项目名称","dataIndex":"PROJECT_NAME","itemId":"PROJECT_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"100","emptyText":"项目编码/名称","labelAlign":"right","itemId":"QUERY_CODE_NAME"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.pickComp.getStore().load();\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":true,"type":"column"},{"configs":{"text":"{#AP_CONTRACT_NAME#}","hidden":"true","width":"150","dataIndex":"AP_CONTRACT_NAME","titleAlign":"center","itemId":"AP_CONTRACT_NAME_COL"},"children":[{"configs":{"labelWidth":"100","labelAlign":"right","normalName":"AP_CONTRACT_NAME_PICK","itemId":"editor"},"children":[{"configs":{"tagConfigs":"minWidth:400","hidden":"300","itemId":"pickComp"},"events":{"itemdblclick":"var r=app.grid6.getSelectionModel().getSelection()[0];\nr.set('AP_CONTRACT_ID',record.data.AP_CONTRACT_ID);\nr.set('AP_CONTRACT_NAME',record.data.AP_CONTRACT_NAME);\nr.dirty = true;\napp.AP_CONTRACT_NAME_PICK.setValue(record.data.AP_CONTRACT_NAME);\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"pageSize":"5","autoLoad":"true","itemId":"store","url":"m?xwl=xc/ap/ap-com-lov/AP_CONTRACT_ID_PICK/DB/GRID_XC_AP_CONTRACT_SELECT"},"events":{"beforeload":"operation.params = Wb.getValue([app.form1,app.tbar]);"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","dataIndex":"AP_CONTRACT_ID","itemId":"AP_CONTRACT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"项目编码","dataIndex":"AP_CONTRACT_CODE","itemId":"AP_CONTRACT_CODE_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"项目名称","dataIndex":"AP_CONTRACT_NAME","itemId":"AP_CONTRACT_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"100","emptyText":"合同编码/名称","labelAlign":"right","itemId":"QUERY_CODE_NAME"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.pickComp.getStore().load();\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":true,"type":"column"},{"configs":{"text":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#AP_PUR_TYPE_NAME#}","width":"120","dataIndex":"AP_PUR_TYPE_NAME","titleAlign":"center","itemId":"AP_PUR_TYPE_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#BG_ITEM_NAME#}","width":"150","dataIndex":"BG_ITEM_NAME","titleAlign":"center","itemId":"BG_ITEM_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#ACC_NAME#}","width":"150","dataIndex":"ACC_NAME","titleAlign":"center","itemId":"ACC_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#CCID_NAME#}","width":"150","dataIndex":"CCID_NAME","itemId":"CCID_NAME_COL"},"children":[{"configs":{"displayField":"CCID_NAME","triggerCls":"x-form-search-trigger","valueField":"CCID","itemId":"editor","onTriggerClick":"  // 账簿\n  var ledgerId = app.LEDGER_ID_XWL.LEDGER_ID.getValue() ;\n  if(ledgerId === \"\" ||ledgerId === null || ledgerId === undefined){\n    Wb.info('请选择账簿!') ;\n    return false ;\n  }\n  \n  // 会计日期\n  var accDate = app.GL_DATE.getValue() ;\n  if(accDate === \"\" ||accDate === null || accDate === undefined){\n    Wb.info('请选择会计日期!') ;\n    return false ;\n  }else{\n\taccDate = Wb.dateToStr(accDate).substring(0,7);\n  }\n  \n  // TODO: 当前选中\n  var r = app.grid6.getSelection()[0] ; \n  \n  // TODO: 显示科目选择窗口\n  Wb.run({\n    url:'m?xwl=xc/gl/journal/v-windows/handler-ccid-win',\n    params : {\n      'ledgerId' : ledgerId,\n      'vtype' : '{#vtype#}'\n    },          \n    success:function(appObj){\n      appObj.initWindow({\n        accName : r.data.ACC_NAME,\n        ledgerId : ledgerId,\n        periodCode : accDate ,\n        groupId : 'ALL',\n        handlerCCID : function(returnObj){\n          // TODO: 处理CCID信息\n          var rObj = Wb.decode(returnObj) ;\n          r.set('ACC_ID', rObj.acc_id) ;    \n          r.set('ACC_NAME', rObj.acc_name);\n          r.set('CCID', rObj.acc_ccid) ;    \n          r.set('CCID_NAME', rObj.acc_ccid_name);\n          // 禁用账簿\n           app.LEDGER_ID_XWL.LEDGER_ID.setReadOnly(true) ;\n        }\n      });\n    }  \n  }) ;   "},"events":{"beforequery":"var combo = e.combo;\nif(!e.forceAll){\n  var value = e.query;\n  combo.store.filterBy(function(record,id){\n    var text = record.get(combo.displayField);\n    return (text.indexOf(value)!=-1);\n  });\n  combo.expand();\n  return false;\n}","specialkey":"// TODO: 按回车键执行借方和贷方金额切换\nif (e.getKey() == e.ENTER) {\n  // 账簿\n  var ledgerId = app.LEDGER_ID_XWL.LEDGER_ID.getValue() ;\n  if(ledgerId === \"\" ||ledgerId === null || ledgerId === undefined){\n    Wb.info('请选择账簿!') ;\n    return false ;\n  }\n  \n  // 会计日期\n  var accDate = app.GL_DATE.getValue();\n  if(accDate === \"\" ||accDate === null || accDate === undefined){\n    Wb.info('请选择会计日期!') ;\n    return false ;\n  }else{\n    accDate = Wb.dateToStr(accDate).substring(0,7);\n  }\n  \n  // TODO: 当前选中\n  var r = app.grid6.getSelection()[0] ; \n  \n  // TODO: 显示科目选择窗口\n  Wb.run({\n    url:'m?xwl=xc/gl/journal/v-windows/handler-ccid-win',\n    params : {\n      'ledgerId' : ledgerId ,\n      'vtype' : '{#vtype#}'\n    },          \n    success:function(appObj){\n      appObj.initWindow({\n        accName : r.data.ACC_NAME,\n        ledgerId : ledgerId,\n        periodCode : accDate ,\n        groupId : 'ALL',\n        handlerCCID : function(returnObj){\n          // TODO: 处理CCID信息\n          var rObj = Wb.decode(returnObj) ;\n          r.set('ACC_ID', rObj.acc_id) ;    \n          r.set('ACC_NAME', rObj.acc_name);\n          r.set('CCID', rObj.acc_ccid) ;    \n          r.set('CCID_NAME', rObj.acc_ccid_name);\n          // 禁用账簿\n           app.LEDGER_ID_XWL.LEDGER_ID.setReadOnly(true) ;\n        }\n      });\n    }  \n  }) ;   \n}"},"children":[],"expanded":true,"type":"combo"}],"expanded":true,"type":"column"},{"configs":{"text":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#AMOUNT#}","width":"100","dataIndex":"AMOUNT","format":"0,000.00","titleAlign":"center","itemId":"AMOUNT_COL"},"children":[{"configs":{"itemId":"editor"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"column"},{"configs":{"text":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#DESCRIPTION#}","width":"200","dataIndex":"DESCRIPTION","titleAlign":"center","itemId":"DESCRIPTION_COL"},"children":[{"configs":{"allowBlank":"false","itemId":"editor"},"children":[],"expanded":false,"type":"textarea"}],"expanded":true,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"panel"},{"configs":{"file":"m?xwl=xc/gl/journal/v-windows/new-xwl-voucher","itemId":"edit_v_xwl"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"tab"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}