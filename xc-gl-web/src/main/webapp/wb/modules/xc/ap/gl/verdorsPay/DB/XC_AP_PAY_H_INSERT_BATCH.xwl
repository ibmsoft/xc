{"inframe":false,"title":"","hidden":false,"roles":{"default":1},"children":[{"configs":{"serverScript":"var recs = Wb.decode(request.getParameter('payH'));\nvar  rs, meta, row, p_qc_rows = [];\nWb.each(recs, function(rec) {\n  rs = app.run('select UUID() AP_PAY_H_ID,(select lm.ld_mode_id from xc_gl_ld_pr_modes lm where lm.ledger_id=\\''+rec.LEDGER_ID+'\\' and lm.PAY_ACC_ID=xc.ACC_ID) PUR_TYPE_ID,NULL AP_PAY_H_CODE,\\'FKD_YUFK\\' AP_DOC_CAT_CODE,xb.LEDGER_ID,concat(\\''+rec.PERIOD_CODE+'\\',\\'-01\\') GL_DATE,'+\n               'XC.VENDOR_ID,xc.PROJECT_ID,xc.DEPT_ID,(CASE xa.balance_direction WHEN \\'1\\' THEN SUM(xb.pjtd_dr - xb.pjtd_cr) ELSE SUM(xb.pjtd_cr - xb.pjtd_dr) END) AMOUNT,'+\n               'xc.ACC_ID PAY_ACC_ID,xc.CCID PAY_CCID,0 INIT,\\'TEMP\\' SOURCE,\\'期初原始数据\\' DESCRIPTION'+\n               ' FROM xc_gl_balance xb,xc_gl_ccid xc,xc_gl_accounts XA WHERE xb.ccid = xc.ccid  AND xc.acc_id = xa.acc_id'+\n               '  AND xc.ledger_id = \\''+rec.LEDGER_ID+'\\''+\n               '  AND xb.period_code = \\''+rec.PERIOD_CODE+'\\''+\n               '  AND xc.acc_id =  \\''+rec.ACC_ID+'\\' '+\n               '  AND xb.ccid =  \\''+rec.CCID+'\\''+\n               '  AND xb.CURRENCY_CODE =  \\''+rec.CURRENCY_CODE+'\\' '\n              );\n  meta = rs.getMetaData();\n  while (rs.next()) {\n    row = Wb.getRecord(rs, meta);\n    p_qc_rows.push(row);\n  }\n});\nrequest.setAttribute('qcRows',Wb.encode(p_qc_rows));","itemId":"module"},"children":[{"configs":{"oracle":"insert into xc_ap_pay_h (\n  AP_PAY_H_ID,AP_PAY_H_CODE,AP_PAY_VENDOR_H_ID,AP_DOC_CAT_CODE,LEDGER_ID,\n  GL_DATE,VENDOR_ID,PROJECT_ID,DEPT_ID,AP_CONTRACT_ID,\n  AMOUNT,PAY_ACC_ID,PAY_CCID,INIT,\n  SOURCE,V_HEAD_ID,V_STATUS,DESCRIPTION,VERIFIER_ID,\n  VERFY_DATE,CREATION_DATE,CREATED_BY,LAST_UPDATE_DATE,LAST_UPDATED_BY\n) values (\n  {?varchar.AP_PAY_H_ID?},{?varchar.AP_PAY_H_CODE?},{?varchar.AP_PAY_VENDOR_H_ID?},{?varchar.AP_DOC_CAT_CODE?},{?varchar.LEDGER_ID?},\n  sysdate,{?varchar.VENDOR_ID?},{?varchar.PROJECT_ID?},{?varchar.DEPT_ID?},{?varchar.AP_CONTRACT_ID?},\n  {?decimal.AMOUNT?},{?varchar.PAY_ACC_ID?},{?varchar.PAY_CCID?},'0',\n  {?varchar.SOURCE?},{?varchar.V_HEAD_ID?},{?varchar.V_STATUS?},{?varchar.DESCRIPTION?},{?varchar.VERIFIER_ID?},\n  {?timestamp.VERFY_DATE?},sysdate,{?XIP.userId?},sysdate,{?XIP.userId?}\n)","itemId":"insert","mysql":"insert into xc_ap_pay_h (\n  AP_PAY_H_ID,AP_PAY_H_CODE,AP_PAY_VENDOR_H_ID,AP_DOC_CAT_CODE,LEDGER_ID,\n  GL_DATE,VENDOR_ID,PROJECT_ID,DEPT_ID,AP_CONTRACT_ID,\n  AMOUNT,PAY_ACC_ID,PAY_CCID,INIT,\n  SOURCE,V_HEAD_ID,V_STATUS,DESCRIPTION,VERIFIER_ID,\n  VERFY_DATE,CREATION_DATE,CREATED_BY,LAST_UPDATE_DATE,LAST_UPDATED_BY\n) values (\n  {?varchar.AP_PAY_H_ID?},{?varchar.AP_PAY_H_CODE?},{?varchar.AP_PAY_VENDOR_H_ID?},{?varchar.AP_DOC_CAT_CODE?},{?varchar.LEDGER_ID?},\n   date_sub(date_format({?varchar.GL_DATE?},'%Y-%m-%d'),interval 1 day),{?varchar.VENDOR_ID?},{?varchar.PROJECT_ID?},{?varchar.DEPT_ID?},{?varchar.AP_CONTRACT_ID?},\n  {?decimal.AMOUNT?},{?varchar.PAY_ACC_ID?},{?varchar.PAY_CCID?},'0',\n  {?varchar.SOURCE?},{?varchar.V_HEAD_ID?},{?varchar.V_STATUS?},{?varchar.DESCRIPTION?},{?varchar.VERIFIER_ID?},\n  {?timestamp.VERFY_DATE?},SYSDATE(),{?XIP.userId?},SYSDATE(),{?XIP.userId?}\n)"},"children":[],"expanded":false,"type":"sqlswitcher"},{"configs":{"sql":"{#insert#}","transaction":"start","itemId":"query1","arrayName":"qcRows"},"children":[],"expanded":false,"type":"query"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}