{"inframe":false,"title":"我的采购发票","hidden":false,"roles":{"default":1},"children":[{"configs":{"serverScript":"//---------------------获取当前模块语言对应的.json文件，放到request中----------------\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xc/ap/inv/json/XC_AP_INVOICE_H_MY\");\nvar userId = request.getSession().getAttribute(\"XzSessionVars\").get('userId');\n\nvar protocol = request.getProtocol() ;\nvar ipAddr = request.getServerName();\nvar port = request.getServerPort() ;\nvar ctxPath = request.getContextPath() ;\n\nvar pp = protocol.substr(0,5) ;\nprotocol = (pp.indexOf(\"https\") == -1 ? \"http\" : \"https\") ;\nvar url = protocol + \"://\" + ipAddr +\":\" + port + ctxPath ;\n\nrequest.setAttribute('contextPath',ctxPath);\nrequest.setAttribute(\"userId\",userId);\nrequest.setAttribute(\"appIP\",url);\nvar appId = request.getSession().getAttribute(\"XzSessionVars\").get('appId');\nrequest.setAttribute(\"funId\",request.getParameter('funId'));\nrequest.setAttribute(\"appId\",request.getParameter('appId'));","itemId":"module"},"events":{"finalize":"function returnRowFn(r,type){\n  if(type==='xc_gl_ledgers'){\n    app.queryBtn.fireEvent('click');\n  }\n}\nfunction clearOtherFn(type){\n  //清空账薄时清空面板中所有信息\n  if(type=='xc_gl_ledgers'){\n    app.LEDGER_XWL.LEDGER_ID.setValue('');\n    app.LEDGER_XWL.LEDGER_NAME.setValue('');\n    app.queryBtn.fireEvent('click');\n  }\n  \n}"},"children":[{"configs":{"itemId":"request"},"children":[{"configs":{"autoLoad":"true","itemId":"ldInitStore","url":"m?xwl=xc/com-lov/LEDGER_ID_PICK/DB/XC_GL_LEDGERS_SELECT_SEC"},"events":{"load":"if(store.getCount()>0){\napp.LEDGER_XWL.LEDGER_ID.setValue(store.getAt(0).get('LEDGER_ID'));\napp.LEDGER_XWL.LEDGER_NAME.setValue(store.getAt(0).get('LEDGER_NAME'));\napp.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"folder"},{"configs":{"layout":"border","itemId":"viewport1"},"children":[{"configs":{"region":"north","buttonAlign":"center","itemId":"form1"},"children":[{"configs":{"layout":"column","margin":"10 0 0 0","border":"false","itemId":"tr1"},"children":[{"configs":{"layout":"form","columnWidth":".22","border":"false","itemId":"td_1_1"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/LEDGER_ID_PICK/LEDGER_ID_PICK_SEC","itemId":"LEDGER_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".22","border":"false","itemId":"td_1_2"},"children":[{"configs":{"labelWidth":"80","value":"All","pickList":"[\n  ['All','{#all#}'],\n  ['CGFP','{#cgfp#}'],\n  ['CGFP-H','{#cgfpH#}'],\n  ['CGFP-CGDD','{#cgfpCgdd#}'],\n  ['CGFP-CGDD-H','{#cgfpCgddH#}']\n]","labelAlign":"right","itemId":"AP_DOC_CAT_CODE","fieldLabel":"{#AP_DOC_CAT_CODE#}"},"events":{"select":"app.queryBtn.fireEvent('click');","specialkey":"if(e.getKey()===13) {\n  app.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".22","border":"false","itemId":"td_1_3"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"AP_INV_H_CODE","fieldLabel":"{#AP_INV_H_CODE#}"},"events":{"specialkey":"if(e.getKey()===13) {\n  app.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"columnWidth":".34","border":"false","itemId":"td_1_4"},"children":[{"configs":{"layout":"column","padding":"0","border":"false","itemId":"tr_1_4_1"},"children":[{"configs":{"layout":"form","columnWidth":".55","padding":"0","border":"false","itemId":"tr_1_4_1_1"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","padding":"0","itemId":"INV_AMOUNT_START","fieldLabel":"{#INV_AMOUNT_START#}"},"events":{"specialkey":"if(e.getKey()===13) {\n  app.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".1","border":"false","itemId":"tr_1_4_1_2"},"children":[{"configs":{"text":"-","labelAlign":"center","itemId":"label1"},"children":[],"expanded":false,"type":"label"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".35","border":"false","itemId":"tr_1_4_1_3"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"INV_AMOUNT_END","fieldLabel":"{#INV_AMOUNT_END#}"},"events":{"specialkey":"if(e.getKey()===13) {\n  app.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"layout":"column","margin":"10 0 0 0","border":"false","itemId":"tr2"},"children":[{"configs":{"layout":"form","columnWidth":".22","border":"false","itemId":"td_2_11"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"VENDOR_NAME","fieldLabel":"{#VENDOR_NAME#}"},"events":{"specialkey":"if(e.getKey()===13) {\n  app.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".22","border":"false","itemId":"td_2_1"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"PROJECT_NAME","fieldLabel":"{#PROJECT_NAME#}"},"events":{"specialkey":"if(e.getKey()===13) {\n  app.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".22","border":"false","itemId":"td_1_3"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"DEPT_NAME","fieldLabel":"{#DEPT_NAME#}"},"events":{"specialkey":"if(e.getKey()===13) {\n  app.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".34","border":"false","itemId":"td_2_4"},"children":[{"configs":{"layout":"column","border":"false","itemId":"tr_2_4_1"},"children":[{"configs":{"layout":"form","columnWidth":".55","border":"false","itemId":"td_2_4_1_1"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"BIZ_DATE_START","fieldLabel":"{#BIZ_DATE_START#}"},"events":{"afterrender":"// 设置默认值为当前月的第一天\n// date.setValue(Ext.util.Format.date(new Date(), 'Y-m-') + '01');","select":"app.queryBtn.fireEvent('click');","specialkey":"if(e.getKey()===13) {\n  app.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"date"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".1","border":"false","itemId":"td_2_4_1_2"},"children":[{"configs":{"text":"-","labelAlign":"center","itemId":"label1"},"children":[],"expanded":false,"type":"label"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".35","border":"false","itemId":"td_2_4_1_3"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"BIZ_DATE_END","fieldLabel":"{#BIZ_DATE_END#}"},"events":{"select":"app.queryBtn.fireEvent('click');","specialkey":"if(e.getKey()===13) {\n  app.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"date"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"layout":"column","margin":"10 0 10 0","border":"false","itemId":"tr3"},"children":[{"configs":{"layout":"form","columnWidth":".22","border":"false","itemId":"td_3_1"},"children":[{"configs":{"labelWidth":"80","value":"ALL","pickList":"[\n  ['ALL','{#all#}'],\n  ['A','{#A_SYS_STATUS#}'],\n  ['C','{#C_SYS_STATUS#}'],\n  ['E','{#E_SYS_STATUS#}'],\n  ['F','{#F_SYS_STATUS#}']\n]","labelAlign":"right","itemId":"SYS_AUDIT_STATUS","fieldLabel":"{#SYS_AUDIT_STATUS#}"},"events":{"select":"app.queryBtn.fireEvent('click');","specialkey":"if(e.getKey()===13) {\n  app.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":true,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".22","border":"false","itemId":"td_3_2"},"children":[{"configs":{"labelWidth":"80","value":"ALL","pickList":"[\n  ['ALL','{#all#}'],\n  ['A','{#A_STATUS#}'],\n  ['C','{#C_STATUS#}'],\n  ['D','{#D_STATUS#}'],\n  ['E','{#E_STATUS#}'],\n  ['R','{#R_STATUS#}']\n]","labelAlign":"right","itemId":"AUDIT_STATUS","fieldLabel":"{#AUDIT_STATUS#}"},"events":{"select":"app.queryBtn.fireEvent('click');","specialkey":"if(e.getKey()===13) {\n  app.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".22","border":"false","itemId":"td_3_3"},"children":[{"configs":{"labelWidth":"80","value":"ALL","pickList":"[\n    ['ALL','{#all#}'],\n\t['1','{#1_SIGN_STATUS#}'],\n  \t['2','{#2_SIGN_STATUS#}'],\n  \t['3','{#3_SIGN_STATUS#}'],\n]","labelAlign":"right","itemId":"SIGN_STATUS","fieldLabel":"{#SIGN_STATUS#}"},"events":{"select":"app.queryBtn.fireEvent('click');","specialkey":"if(e.getKey()===13) {\n  app.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".34","border":"false","itemId":"td_3_4"},"children":[{"configs":{"layout":"column","border":"false","itemId":"tr_3_4_1"},"children":[{"configs":{"layout":"form","columnWidth":".55","border":"false","itemId":"td_2_2"},"children":[{"configs":{"labelWidth":"80","value":"ALL","pickList":"[\n    ['ALL','{#all#}'],\n\t['AP','{#SOURCE_AP#}'],\n  \t['PO','{#SOURCE_PO#}']\n]","labelAlign":"right","itemId":"SOURCE","fieldLabel":"{#SOURCE#}"},"events":{"select":"app.queryBtn.fireEvent('click');","specialkey":"if(e.getKey()===13) {\n  app.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"combo"},{"configs":{"labelWidth":"80","hidden":"true","value":"{#XIP.userId#}","labelAlign":"right","itemId":"CREATED_BY","fieldLabel":"{#CREATED_BY_NAME#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".02","border":"false","itemId":"td_3_4_1_21"},"children":[{"configs":{"itemId":"空格"},"children":[],"expanded":false,"type":"label"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".2","border":"false","itemId":"td_3_4_1_2"},"children":[{"configs":{"text":"{#queryBtn#}","itemId":"queryBtn","iconCls":"seek_icon"},"events":{"click":"app.grid1.store.load({params : Wb.getValue(app.form1)});"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".2","border":"false","itemId":"td_3_4_1_3"},"children":[{"configs":{"text":"{#clearBtn#}","itemId":"clearBtn","iconCls":"refresh_icon"},"events":{"click":"app.form1.getForm().reset();\napp.queryBtn.fireEvent('click');"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"form"},{"configs":{"region":"center","selType":"checkboxmodel","itemId":"grid1"},"events":{"itemdblclick":"app.updbtn.fireEvent('click');"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/ap/inv/DB/XC_AP_INVOICE_H_SELECT"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"{#insertBtn#}","itemId":"addBtn","iconCls":"file_add_icon"},"children":[{"configs":{"text":"{#cgfp#}","itemId":"addPtfpBtn","iconCls":"file_add_icon"},"events":{"click":"var curGrid = app.grid1;\nWb.run({\n  url: 'm?xwl=xc/ap/inv/XC_AP_INVOICE_H_NO_C', \n  success: function(apps) {\n    apps.initWin({\n\t\tAP_INV_H_ID:'',\n        IS_INSERT:'Y',\n        LEDGER_ID : app.LEDGER_XWL.LEDGER_ID.getValue(),\n        LEDGER_NAME : app.LEDGER_XWL.LEDGER_NAME.getValue(),\n        AP_DOC_CAT_CODE:'CGFP',\n        hideFun:function(){\n          app.queryBtn.fireEvent('click');\n        }\n    });\n  }\n});\n"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#cgfpH#}","itemId":"addPtfpHBtn","iconCls":"file_add_icon"},"events":{"click":"var curGrid = app.grid1;\nWb.run({\n  url: 'm?xwl=xc/ap/inv/XC_AP_INVOICE_H_NO_C', \n  success: function(apps) {\n    apps.initWin({\n\t\tAP_INV_H_ID:'',\n        IS_INSERT:'Y',\n        LEDGER_ID : app.LEDGER_XWL.LEDGER_ID.getValue(),\n        LEDGER_NAME : app.LEDGER_XWL.LEDGER_NAME.getValue(),\n        AP_DOC_CAT_CODE:'CGFP-H',\n        hideFun:function(){\n          app.queryBtn.fireEvent('click');\n        }\n    });\n  }\n});\n"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#cgfpCgdd#}","itemId":"addCgfpCgddBtn","iconCls":"file_add_icon"},"events":{"click":"var curGrid = app.grid1;\nWb.run({\n  url: 'm?xwl=xc/ap/inv/XC_AP_INVOICE_H_NO_C', \n  success: function(apps) {\n    apps.initWin({\n\t\tAP_INV_H_ID:'',\n        IS_INSERT:'Y',\n        LEDGER_ID : app.LEDGER_XWL.LEDGER_ID.getValue(),\n        LEDGER_NAME : app.LEDGER_XWL.LEDGER_NAME.getValue(),\n        AP_DOC_CAT_CODE:'CGFP-CGDD',\n        hideFun:function(){\n          app.queryBtn.fireEvent('click');\n        }\n    });\n  }\n});\n"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#cgfpCgddH#}","itemId":"addCgfpCgddHBtn","iconCls":"file_add_icon"},"events":{"click":"var curGrid = app.grid1;\nWb.run({\n  url: 'm?xwl=xc/ap/inv/XC_AP_INVOICE_H_NO_C', \n  success: function(apps) {\n    apps.initWin({\n\t\tAP_INV_H_ID:'',\n        IS_INSERT:'Y',\n        LEDGER_ID : app.LEDGER_XWL.LEDGER_ID.getValue(),\n        LEDGER_NAME : app.LEDGER_XWL.LEDGER_NAME.getValue(),\n        AP_DOC_CAT_CODE:'CGFP-CGDD-H',\n        hideFun:function(){\n          app.queryBtn.fireEvent('click');\n        }\n    });\n  }\n});\n"},"children":[],"expanded":false,"type":"item"}],"expanded":true,"type":"item"},{"configs":{"text":"{#updbtn#}","itemId":"updbtn","iconCls":"file_edit_icon"},"events":{"click":"var curGrid = app.grid1;\nvar recs = curGrid.getSelection();\nif (recs.length > 1 || recs.length === 0) {//大于一条或没选择会警告\n    Wb.toast('{#updateRec#}');\n    return;\n}\nvar r = recs[0];\nWb.run({\n    url: 'm?xwl=xc/ap/inv/XC_AP_INVOICE_H_NO_C', \n    success: function(apps) {\n        apps.initWin({\n            AP_INV_H_ID:r.get('AP_INV_H_ID'),\n            IS_INSERT:'N',\n            flag:'update',\n            AP_DOC_CAT_CODE:r.get('AP_DOC_CAT_CODE'),\n            hideFun:function(){\n                app.queryBtn.fireEvent('click');\n            }\n        });\n    }\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#delBtn#}","itemId":"delBtn","iconCls":"file_delete_icon"},"events":{"click":"var recs = app.grid1.getSelection();\nif (!recs.length) {\n    Wb.toast('{#deleteRec#}');\n    return;\n}\nvar invoiceArray = [];\nfor(var i = 0;i < recs.length;i++){\n    if(recs[i].data.SYS_AUDIT_STATUS == 'A'){\n        var deleteData =  {AP_INV_H_ID : recs[i].data.AP_INV_H_ID};\n        invoiceArray.push(deleteData);\n    }\n}\nif(invoiceArray.length === 0){\n    Wb.toast('{#deleteRec1#}');\n    return;\n}\nWb.confirm('{#confirm2#} ' + recs.length + ' {#confirm#}', function() {\n    //调用删除销售发票的后台程序\n    Wb.request({\n        url : '{#contextPath#}' + '/apDocsAction.do?method=deleteInvoice',\n        params : Wb.apply({invoiceId: invoiceArray}),\n        success : function(resp){\n            var record = Wb.decode(resp.responseText);\n            var msg = record.msg;\n            Wb.toast(msg);\n            app.queryBtn.fireEvent('click');\n        }\n    });\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#seekBtn#}","itemId":"seekBtn","iconCls":"seek_icon"},"events":{"click":"var curGrid = app.grid1;\nvar r=curGrid.getSelectionModel().getSelection()[0];\nvar rec = curGrid.getSelection();\nif (rec.length > 1 || rec.length === 0) {//大于一条或没选择会警告\n    Wb.toast('{#seekRec#}');\n    return;\n}\nWb.run({\n  url: 'm?xwl=xc/ap/inv/XC_AP_INVOICE_H_NO_C', \n  success: function(apps) {\n    apps.initWin({\n\t\tAP_INV_H_ID:r.get('AP_INV_H_ID'),\n        IS_INSERT:'S',\n        AP_DOC_CAT_CODE:r.get('AP_DOC_CAT_CODE'),\n        hideFun:function(){\n          app.queryBtn.fireEvent('click');\n        }\n    });\n  }\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#submitButton#}","itemId":"submitButton","iconCls":"check_icon"},"events":{"click":"var rows = app.grid1.getSelection();//获得选中数据\nif (rows.length > 1 || rows.length === 0) {//大于一条或没选择会警告\n\tWb.toast('{#submitRec#}');\n\treturn;\n}\nvar auditStatus = rows[0].data.AUDIT_STATUS;\nif(auditStatus === 'E' || auditStatus === 'C'){//运行中、结束状态\n    Wb.toast('{#submitWarn#}');\n    return false;\n}\n//账簿是否启用预算检查\nvar store = app.ldInitStore;\nvar idx = store.find('LEDGER_ID',app.LEDGER_XWL.LEDGER_ID.getValue());\nvar rr = store.getAt(idx);\nvar BG_IS_CHK = rr.data.BG_IS_CHK;//预算检查：Y-是，N-否\nif(BG_IS_CHK === \"\" || BG_IS_CHK === null || BG_IS_CHK === undefined){\n    BG_IS_CHK = 'N' ;\n}\nWb.request({\n    url : 'm?xwl=xc/ap/inv/DB/XC_AP_INVOICE_L_SELECT',\n    params : {AP_INV_H_ID : rows[0].data.AP_INV_H_ID},\n    success : function(resp){\n        if(Wb.decode(resp.responseText).total === 0){\n            Wb.toast('采购发票\"'+rows[0].data.AP_INV_H_CODE+'\"没有单据明细，不能提交！');\n            return;\n        }\n        var checkBudgetArray = [];\n        var checkParamJson = {isChkBg : BG_IS_CHK,apDocId:rows[0].data.AP_INV_H_ID,apDocCat : \"CGFP\"};\n        checkBudgetArray.push(checkParamJson);\n        //执行预算校验\n        Wb.request({\n            url : '{#contextPath#}' + '/apDocsAction.do?method=checkBudget',\n            params : Wb.apply({checkArray: checkBudgetArray}),\n            success : function(resp){\n               var response = Wb.decode(resp.responseText);\n                if(response.flag == \"0\"){\n                  //执行阶段：BGCHK-预算校验,QRY-单据类型信息查询\n                    var phase = response.phase;\n                    if(phase === 'BGCHK'){\n                        //-1 校验不通过或者校验异常；0 校验通过；1校验不通过，但预算不是绝对控制，给出警告提示    \n                        var chkFlag = response.chkFlag;\n                        if(chkFlag === \"-1\"){\n                            Wb.toast(response.msg);\n                            return ;\n                        }\n                        else if(chkFlag === \"1\"){\n                            Ext.Msg.confirm('{#warning1#}',response.msg,function(id){\n                                if(id == 'yes'){\n                                    submitProcess();\n                                }\n                            });\n                        }\n                    }\n                    else{\n                        submitProcess();\n                    }\n                }\n                else{\n                    Wb.toast(response.msg);\n                }\n            }\n        });\n        \n    }\n});\nfunction submitProcess(){\n    Wb.request({\n        url : '{#contextPath#}' + '/apDocsAction.do?method=getInvoiceProcAndForms',\n        params : {LEDGER_ID : rows[0].data.LEDGER_ID,AP_DOC_CAT_CODE : rows[0].data.AP_DOC_CAT_CODE},\n        success : function(resp){\n            var temp = Wb.decode(resp.responseText);\n            if(temp.flag === '0'){\n                //取得流程编码、电脑端审批表单和移动端审批表单\n                var processCODE = temp.PROCESS_CODE;\n                var pcApproveForm = temp.PC_A_FORM_URL;\n                var mobileApproveForm = temp.M_A_FORM_URL;\n                var orgId = temp.ORG_ID;\n                if(pcApproveForm === \"\" || pcApproveForm === null || pcApproveForm === undefined){\n                    Wb.toast('{#submitWarn7#}：'+rows[0].data.AP_DOC_CAT_NAME+'{#submitWarn8#}');\n                    return;\n                }\n                //电脑端和移动端审批表单为变量需要设置为全路径\n                pcApproveForm = '{#appIP#}' +  '/' + pcApproveForm;\n                mobileApproveForm = '{#appIP#}' +  mobileApproveForm;\n                //如果流程编码存在, 则提交流程审批处理\n                if(processCODE !== \"\" && processCODE !== null && processCODE !== undefined){\n                    //如果项目未指定，则设置默认值为 \"-1\"\n                    var prjId = rows[0].data.PROJECT_ID;\n                    if(prjId === null || prjId === \"\" || prjId === undefined){\n                        prjId = \"-1\" ;\n                    }\n                    var json = {\n                        'APP_IP'\t\t\t: '{#appIP#}',\n                        'EMP_ID'\t\t\t: '{#XIP.empId#}',\n                        'loginName'\t\t\t: '{#XIP.userName#}',\n                        'AP_DOC_CAT_NAME'\t: rows[0].data.AP_DOC_CAT_NAME,\n                        'M_A_FORM'\t\t\t: mobileApproveForm,\n                        'PC_A_FORM'\t\t\t: pcApproveForm,\n                        'apCatCode'\t\t\t: 'CGFP',\n                        'billType'\t\t\t: rows[0].data.AP_DOC_CAT_CODE,\n                        'DEPT_ID'\t\t\t: rows[0].data.DEPT_ID,\n                        'DEPT_NAME'\t\t\t: rows[0].data.DEPT_NAME,\n                        'PROJECT_ID'\t\t: prjId,\n                        'ORG_ID'\t\t\t: orgId,\n                        'ledgerId'\t\t\t: rows[0].data.LEDGER_ID,\n                        'AMT'\t\t\t\t: rows[0].data.INV_AMOUNT,\n                        'ABSAMT'\t\t\t: Math.abs(rows[0].data.INV_AMOUNT),//金额绝对值\n                        'e_business_id'\t\t: rows[0].data.AP_INV_H_ID\n                    };\n                    if(auditStatus === 'A'){//起草状态\n                        XipWf.startAndSubmitByProcess(processCODE,json,function(e){//提交流程\n                            if(e.flag === 0){\n                                app.queryBtn.fireEvent('click');\n                                Wb.toast('{#successSubmit#}');\n                            }\n                            else if(e.flag === 1){\n                                Wb.info(e.msg) ;\n                            }else{}\n                        });\n                    }\n                    else if(auditStatus === 'D'){//驳回状态\n                        XipWf.submitInstance(rows[0].data.INS_CODE,json,function(e){//提交流程\n                            if(e.flag === 0){\n                                app.queryBtn.fireEvent('click');\n                                Wb.toast('{#successSubmit#}');\n                            }\n                            else if(e.flag === 1){\n                                Wb.toast(e.msg) ;\n                            }else{}\n                        });\n                    }\n                    else if(auditStatus === 'R'){//撤回状态\n                        XipWf.restartAndSubmitByProcess(rows[0].data.INS_CODE,processCODE,json,function(e){//提交流程\n                            if(e.flag === 0){\n                                app.queryBtn.fireEvent('click');\n                                Wb.toast('{#successSubmit#}');\n                            }\n                            else if(e.flag === 1){\n                                Wb.toast(e.msg) ;\n                            }else{}\n                        });\n                    }\n                    else{\n                        Wb.toast('{#submitWarns#}');\n                        return false;\n                    }\n                }\n                else{\n                    Wb.toast('{#submitWarn7#}：'+rows[0].data.AP_DOC_CAT_NAME+'{#submitWarn9#}');\n                }\n            }\n            else{\n                Wb.toast(temp.msg);\n            }\n        }\n    });\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#monitorBtn#}","itemId":"monitorBtn","iconCls":"viewport_icon"},"events":{"click":"var rows=app.grid1.getSelection();\nif (rows.length > 1 || rows.length === 0) {\n    Wb.toast('{#monitorRec#}');\n    return;\n}\nif(rows[0].data.INS_CODE === null || rows[0].data.INS_CODE === ''){\n    Wb.toast('{#monitorWarn#}');\n    return;\n}\nelse{\n    XipWf.showMonitorPage(rows[0].data.INS_CODE);\n}   \n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#withdrawBtn#}","itemId":"withdrawBtn","iconCls":"cancel_icon"},"events":{"click":"var rows=app.grid1.getSelection();\nif(rows.length != 1){\n\tWb.toast('{#withdrawRec#}');\n\treturn;\n}\nif(rows[0].data.INS_CODE === null || rows[0].data.INS_CODE === '') {\n\tWb.toast('{#withdrawWarn1#}');\n\treturn;\n}\nelse if(rows[0].data.SYS_AUDIT_STATUS === 'F') {\n\tWb.toast('{#withdrawWarn2#}');\n\treturn;\n}\nelse if(rows[0].data.AUDIT_STATUS === 'E') {\n\tWb.toast('{#withdrawWarn3#}');\n\treturn;\n}\nelse if(rows[0].data.AUDIT_STATUS === 'R'){\n\tWb.toast('{#withdrawWarn4#}');\n    return false;\n}\nelse if(rows[0].data.AUDIT_STATUS === 'D'){\n\tWb.toast('{#withdrawWarn5#}');\n    return false;\n}\nelse {\n    Wb.confirm('{#confirm3#} ' + rows.length + ' {#confirm#}', function() {\n        //撤回流程\n        XipWf.revokeByInstance(rows[0].data.INS_CODE,function(e){\n            Wb.toast(e.msg);\n            app.queryBtn.fireEvent('click');\n        });\n    });\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#payListBtn#}","itemId":"payListBtn","iconCls":"aim_icon"},"events":{"click":"var curGrid = app.grid1;\nvar rec = curGrid.getSelection();\nif (rec.length > 1 || rec.length === 0) {\n    Wb.toast('{#payListRec#}');\n    return;\n}\nif(!Wb.isEmpty(rec[0].data.GL_AP_INV_GL_H_ID)){\n    Wb.run({\n        url: 'm?xwl=xc/ap/trans/XC_AP_INV_TRANS_ALL', \n        success: function(app) {\n            app.initWin({\n                SOURCE_ID:rec[0].data.GL_AP_INV_GL_H_ID,\n                AP_INV_GL_H_ID:rec[0].data.GL_AP_INV_GL_H_ID,\n                QUERY_FROM:'YFD'\n            });\n        }\n    });\n}\nelse{\n    Wb.toast('{#payListWarn1#}');\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#enclosureBtn#}","itemId":"enclosureBtn","iconCls":"attach_icon"},"events":{"click":"var rows = app.grid1.getSelection();\nif (rows.length > 1 || rows.length === 0) {\n    Wb.toast('{#enclosureRec#}');\n    return;\n}\nelse{\n    var temp_id = rows[0].data.AP_INV_H_ID;\n    var temp_code = rows[0].data.AP_INV_H_CODE;\n    Wb.request({\n        url : '{#contextPath#}' + '/apDocsAction.do?method=getApAttCatCode',\n        params : {LEDGER_ID : rows[0].data.LEDGER_ID,AP_DOC_CAT_CODE : rows[0].data.AP_DOC_CAT_CODE},\n        success : function(resp){\n            var temp = Wb.decode(resp.responseText);\n            if(temp.flag == '0'){\n                var attCatCode = temp.attCatCode;\n                Xip.showAttachmentManager('{#XIP.userId#}',temp_id,'',attCatCode,temp_code,'Y','Y','Y',function(){},10); \n            }\n            else{\n                Wb.toast(temp.msg);\n            }\n        }\n    });\n}"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#order#}","align":"center","xtype":"rownumberer","width":"50","titleAlign":"center","itemId":"ORDERBY"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#LEDGER_NAME#}","hidden":"true","width":"150","dataIndex":"LEDGER_NAME","titleAlign":"center","itemId":"LEDGER_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#AP_DOC_CAT_CODE#}","hidden":"true","width":"150","dataIndex":"AP_DOC_CAT_CODE","titleAlign":"center","itemId":"AP_DOC_CAT_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#AP_DOC_CAT_NAME#}","width":"160","dataIndex":"AP_DOC_CAT_NAME","titleAlign":"center","itemId":"AP_DOC_CAT_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#AP_INV_H_CODE#}","width":"200","dataIndex":"AP_INV_H_CODE","titleAlign":"center","itemId":"AP_INV_H_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#BIZ_DATE#}","width":"100","dataIndex":"BIZ_DATE","titleAlign":"center","itemId":"BIZ_DATE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#VENDOR_NAME#}","width":"200","dataIndex":"VENDOR_NAME","titleAlign":"center","itemId":"VENDOR_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#AP_CONTRACT_NAME#}","width":"150","dataIndex":"AP_CONTRACT_NAME","titleAlign":"center","itemId":"AP_CONTRACT_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#DEPT_NAME#}","width":"150","dataIndex":"DEPT_NAME","titleAlign":"center","itemId":"DEPT_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#PROJECT_NAME#}","width":"150","dataIndex":"PROJECT_NAME","titleAlign":"center","itemId":"PROJECT_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#INV_AMOUNT#}","width":"120","align":"right","dataIndex":"INV_AMOUNT","format":"0,000.00","titleAlign":"center","itemId":"INV_AMOUNT_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#NO_PAY_AMT#}","width":"120","align":"right","dataIndex":"NO_PAY_AMT","format":"0,000.00","titleAlign":"center","itemId":"NO_PAY_AMT_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#TAX_RATE#}","width":"100","align":"right","dataIndex":"TAX_RATE","titleAlign":"center","itemId":"TAX_RATE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#TAX_AMT#}","width":"120","align":"right","dataIndex":"TAX_AMT","format":"0,000.00","titleAlign":"center","itemId":"TAX_AMT_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#DESCRIPTION#}","width":"200","dataIndex":"DESCRIPTION","titleAlign":"center","itemId":"DESCRIPTION_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#CREATED_BY_NAME#}","width":"100","dataIndex":"CREATED_BY_NAME","titleAlign":"center","itemId":"CREATED_BY_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#INS_CODE#}","hidden":"true","dataIndex":"INS_CODE","titleAlign":"center","itemId":"INS_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#AUDIT_STATUS#}","hidden":"true","dataIndex":"AUDIT_STATUS","titleAlign":"center","itemId":"AUDIT_STATUS_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#SYS_AUDIT_STATUS_DESC#}","width":"100","dataIndex":"XC_AP_SYS_AUDIT_STATUS","titleAlign":"center","itemId":"SYS_AUDIT_STATUS_DESC_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#AP_INV_H_ID#}","hidden":"true","dataIndex":"AP_INV_H_ID","titleAlign":"center","itemId":"AP_INV_H_ID_COL"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}