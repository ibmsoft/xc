{"inframe":false,"title":"付款申请单查询","hidden":false,"roles":{"default":1},"children":[{"configs":{"serverScript":"var ctxPath = request.getContextPath() ;\nrequest.setAttribute('contextPath',ctxPath);\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,'xc/ap/req/json/XC_AP_PAY_REQ_H_ALL');","itemId":"module"},"events":{"finalize":"function returnRowFn(r,type){\n  if(type==='xc_gl_ledgers'){\n    Wb.reload(app.grid1);\n  }\n}\nfunction clearOtherFn(type){\n  if(type=='xc_gl_ledgers'){\n  }\n}"},"children":[{"configs":{"itemId":"request"},"children":[{"configs":{"autoLoad":"true","itemId":"ldInitStore","url":"m?xwl=xc/com-lov/LEDGER_ID_PICK/DB/XC_GL_LEDGERS_SELECT_SEC"},"events":{"load":"app.LEDGER_XWL.LEDGER_ID.setValue(store.getAt(0).get('LEDGER_ID'));\napp.LEDGER_XWL.LEDGER_NAME.setValue(store.getAt(0).get('LEDGER_NAME'));\napp.grid1.getStore().load();"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"folder"},{"configs":{"title":"退回原因","height":"200","width":"500","layout":"fit","closeAction":"hide","dialog":"true","itemId":"win","modal":"true"},"events":{"ok":"// TODO: 执行单据取消处理\nvar rows = app.grid1.getSelection() ;\nvar r = rows[0].data ;\nvar docId = r.AP_PAY_REQ_H_ID ;\n\nvar cr = app.cancel_reason.getValue() ;\nif(cr === null || cr === \"\" || cr === undefined){\n  Wb.toast('请填写退回原因') ;\n  return false ;\n}\n\n// TODO: 进度条\nvar msg = Ext.MessageBox.show({\n  title:'请等待',\n  msg:'正在提交请求，请稍后...',\n  width:240,\n  wait:true,\n  progress :true,\n  closable :false\n});\n// 提交请求\nWb.request({\n  url:'{#contextPath#}'+'/apDocsAction.do?method=revokeCompleteProcess',\n  params:{'docId':r.AP_PAY_REQ_H_ID,'docCat':'FKSQD','cancelReason':app.cancel_reason.getValue()},\n  success:function(resp){\n    msg.hide() ;\n    app.win.hide() ;\n  \tapp.queryBtn.fireEvent('click');\n    app.cancel_reason.reset();\n    var rec = Wb.decode(resp.responseText);\n    if(rec.flag==='0'){\n      Wb.toast(rec.msg);\n    }else{\n    \tWb.toast(rec.msg);\n    }\n  }\n});\n\n\n"},"children":[{"configs":{"layout":"fit","border":"false","itemId":"form"},"children":[{"configs":{"emptyText":"{#cancelReason#}","itemId":"cancel_reason"},"children":[],"expanded":false,"type":"textarea"}],"expanded":true,"type":"form"}],"expanded":false,"type":"window"},{"configs":{"layout":"border","itemId":"viewport1"},"children":[{"configs":{"region":"north","buttonAlign":"center","itemId":"form1"},"children":[{"configs":{"layout":"column","margin":"10 0 0 0","border":"false","itemId":"tr1"},"children":[{"configs":{"layout":"form","columnWidth":".22","border":"false","itemId":"td_1_1"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/LEDGER_ID_PICK/LEDGER_ID_PICK_SEC","itemId":"LEDGER_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".22","border":"false","itemId":"td_1_2"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"VENDOR_NAME","fieldLabel":"{#vendorName#}"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n  app.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".22","border":"false","itemId":"td_1_3"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"AP_CONTRACT_NAME","fieldLabel":"{#contractName#}"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n  app.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"columnWidth":".34","border":"false","itemId":"td_1_4"},"children":[{"configs":{"layout":"column","padding":"0","border":"false","itemId":"tr_1_4_1"},"children":[{"configs":{"layout":"form","columnWidth":".55","padding":"0","border":"false","itemId":"tr_1_4_1_1"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","padding":"0","itemId":"AMOUNT_START","fieldLabel":"{#amount#}"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n  app.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".1","border":"false","itemId":"tr_1_4_1_2"},"children":[{"configs":{"text":"-","labelAlign":"center","itemId":"label1"},"children":[],"expanded":false,"type":"label"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".35","border":"false","itemId":"tr_1_4_1_3"},"children":[{"configs":{"labelWidth":"30","labelAlign":"right","itemId":"AMOUNT_END"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n  app.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"layout":"column","margin":"10 0 0 0","border":"false","itemId":"tr2"},"children":[{"configs":{"layout":"form","columnWidth":".22","border":"false","itemId":"td_2_1"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"PROJECT_NAME","fieldLabel":"{#projectName#}"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n  app.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".22","border":"false","itemId":"td_2_2"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"CREATED_BY_NAME","fieldLabel":"{#creatByName#}"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n  app.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".22","border":"false","itemId":"td_2_3"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"DESCRIPTION","fieldLabel":"{#descrition#}"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n  app.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".34","border":"false","itemId":"td_2_4"},"children":[{"configs":{"layout":"column","border":"false","itemId":"tr_2_4_1"},"children":[{"configs":{"layout":"form","columnWidth":".55","border":"false","itemId":"td_2_4_1_1"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"BIZ_DATE_START","fieldLabel":"{#bizDate#}"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n  app.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"date"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".1","border":"false","itemId":"td_2_4_1_2"},"children":[{"configs":{"text":"-","labelAlign":"center","itemId":"label1"},"children":[],"expanded":false,"type":"label"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".35","border":"false","itemId":"td_2_4_1_3"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"BIZ_DATE_END"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n  app.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"date"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"layout":"column","margin":"10 0 10 0","border":"false","itemId":"tr3"},"children":[{"configs":{"layout":"form","columnWidth":".22","border":"false","itemId":"td_3_1"},"children":[{"configs":{"labelWidth":"80","displayField":"VAL_NAME","valueField":"VAL_CODE","pickList":"[['A','{#a#}'],['C','{#c#}'],['E','{#e#}'],['ALL','{#ALL#}']]","labelAlign":"right","itemId":"SYS_AUDIT_STATUS","fieldLabel":"{#status#}"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n  app.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":true,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".22","border":"false","itemId":"td_3_2"},"children":[{"configs":{"labelWidth":"80","hidden":"true","pickList":"[\n  ['A','起草'],\n  ['C','已回退'],\n  ['D','已驳回'],\n  ['E','审批通过'],\n  ['R','审批中'],\n]","labelAlign":"right","itemId":"AUDIT_STATUS","fieldLabel":"{#auditStatus#}"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n  app.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"combo"},{"configs":{"labelWidth":"80","pickList":"[\n  ['CGJS','{#CGJS#}'],\n  ['YUFK','{#YUFK#}'],\n  ['QTFK','{#QTFK#}'],\n  ['ALL','{#ALL#}']\n]","labelAlign":"right","itemId":"AP_DOC_CAT_CODE","fieldLabel":"{#docCatCode#}"},"events":{"select":"//app.queryBtn.fireEvent('click');","specialkey":"if(Ext.EventObject.getKey()==13){\n    app.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".22","border":"false","itemId":"td_3_3"},"children":[{"configs":{"labelWidth":"80","pickList":"[\n\t['Y','{#Y#}'],\n  \t['N','{#N#}'],\n  \t['ALL','{#ALL#}']\n]","labelAlign":"right","itemId":"IS_CLOSE","fieldLabel":"{#isClose#}"},"events":{"specialkey":"if(Ext.EventObject.getKey==13){\n  app.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".34","border":"false","itemId":"td_3_4"},"children":[{"configs":{"layout":"column","border":"false","itemId":"tr_3_4_1"},"children":[{"configs":{"layout":"form","columnWidth":".5","border":"false","itemId":"td_3_4_1_1"},"children":[{"configs":{"labelWidth":"80","pickList":"[['Y','{#Y#}'],['N','{#N#}'],['ALL','{#ALL#}']]","labelAlign":"right","itemId":"IS_PAY_ALL","fieldLabel":"{#isPayAll#}"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n  app.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".02","border":"false","itemId":"td_3_4_1_21"},"children":[{"configs":{"itemId":"空格"},"children":[],"expanded":false,"type":"label"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".2","border":"false","itemId":"td_3_4_1_2"},"children":[{"configs":{"text":"{#query#}","itemId":"queryBtn","iconCls":"seek_icon"},"events":{"click":"Wb.reload(app.grid1);"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".2","border":"false","itemId":"td_3_4_1_3"},"children":[{"configs":{"text":"{#clear#}","itemId":"clearBtn","iconCls":"refresh_icon"},"events":{"click":"app.form1.getForm().reset();\napp.grid1.store.removeAll();"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"form"},{"configs":{"region":"center","selType":"checkboxmodel","itemId":"grid1"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/ap/req/DB/XC_AP_PAY_REQ_H_SELECT"},"events":{"beforeload":"operation.params = Wb.getValue(app.form1);"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"{#seek#}","itemId":"seekBtn","iconCls":"seek_icon"},"events":{"click":"var curGrid = app.grid1;\nvar r=curGrid.getSelectionModel().getSelection()[0];\nWb.run({\n  url: 'm?xwl=xc/ap/req/XC_AP_PAY_REQ_H_NO_C', \n  success: function(app) {\n    app.initWin({\n\t\tAP_PAY_REQ_H_ID:r.get('AP_PAY_REQ_H_ID'),\n        IS_INSERT:'S',\n        AP_DOC_CAT_CODE:r.get('AP_DOC_CAT_CODE'),\n        hideFun:function(){\n          Wb.reload(curGrid.store);\n        }\n    });\n  }\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#monitor#}","itemId":"monitorBtn","iconCls":"viewport_icon"},"events":{"click":"\nvar rows=app.grid1.getSelection();\nif(rows.length!=1){\n  Wb.toast('{#monitorMsg1#}');\n}else{\n  if(rows[0].data.AP_PAY_REQ_H_ID !== ''){\n      if(rows[0].data.INS_CODE === null){\n          Wb.toast('{#monitorMsg2#}');\n      }else{\n          //提交流程\n        XipWf.showMonitorPage(rows[0].data.INS_CODE);\n      }   \n  }else{\n      Wb.toast('{#monitorMsg3#}');\n  }\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#withdraw#}","itemId":"withdrawBtn","iconCls":"first_icon"},"events":{"click":"var rows=app.grid1.getSelection();\nif(rows.length!=1){\n  Wb.toast('{#withdrawMsg1#}');\n  return false ;\n}\n\nif(rows[0].data.INS_CODE === null||rows[0].data.INS_CODE ===''){\n  Wb.toast('{#withdrawMsg2#}');\n  return false ;\n}\nif(rows[0].data.AUDIT_STATUS === 'A'){\n  Wb.toast('{#withdrawMsg3#}');\n  return false;\n}\nif(rows[0].data.AUDIT_STATUS == 'R'){\n  Wb.toast('{#withdrawMsg4#}');\n  return false;\n}\nWb.request({\n  url:'m?xwl=xc/ap/req/DB/isExistByReqHId_1',\n  params:{'AP_PAY_REQ_H_ID':rows[0].data.AP_PAY_REQ_H_ID},\n  async:false,\n  success:function(resp){\n    var rec = Wb.decode(resp.responseText);\n    if(rec.total===0){\n      Wb.request({\n        url:'m?xwl=xc/ap/req/DB/isExistByReqHId',\n        params:{'AP_PAY_REQ_H_ID':rows[0].data.AP_PAY_REQ_H_ID},\n        async:false,\n        success:function(resp){\n          var rec = Wb.decode(resp.responseText);\n          if(rec.total===0){\n            app.win.show();  \n          }else{\n          \tWb.toast('{#withdrawMsg5#}');\n          }\n        }\n      });\n    }else{\n          \tWb.toast('{#withdrawMsg6#}');\n    }\n  }\n});\n\n\n\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#payList#}","itemId":"payListBtn"},"events":{"click":"var curGrid = app.grid1;\nvar rec = curGrid.getSelection();\nif (rec.length > 1 || rec.length === 0) {\n    Wb.toast('{#payListMsg#}');\n    return;\n}\nWb.run({\n  url: 'm?xwl=xc/ap/trans/XC_AP_REQ_TRANS_ALL', \n  success: function(app) {\n    app.initWin({\n      SOURCE_ID:rec[0].data.AP_PAY_REQ_H_ID,//来源id（付款申请单id）\n      //AP_INV_GL_H_ID:rec[0].data.AP_INV_GL_H_ID,\n      QUERY_FROM:'SQ'\n    });\n  }\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#close#}","itemId":"closeBtn","iconCls":"stop_icon"},"events":{"click":"var recs = app.grid1.getSelection();\nif (!recs.length) {\n  return;\n}\nvar rows = Wb.getData(recs);\nvar ids = [];\nfor(var i=0;i<rows.length;i++){\n  if(rows[i].IS_CLOSE=='Y'){\n    Wb.toast('{#closeMsg1#}');\n    return;\n  }\n  if(rows[i].AUDIT_STATUS=='A'){\n    Wb.toast('{#closeMsg5#}');\n    return;\n  }\n  var id = {'id':rows[i].AP_PAY_REQ_H_ID};\n  ids.push(id);\n}\nWb.confirm('{#closeMsg1#}' + recs.length + '{#closeMsg2#}', function() {\n  Wb.each(rows, function(row) {\n    row.IS_CLOSE = 'Y';\n  });\n  Wb.request({\n    url: '{#contextPath#}'+'/apPayReqCommonAction.do?method=closeDoc',\n    params: Wb.apply({\n      'ids': ids\n    }),\n    success: function() {\n      Wb.reload(app.grid1);\n    }\n  });\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#open#}","hidden":"true","itemId":"openBtn","iconCls":"run_icon"},"events":{"click":"var recs = app.grid1.getSelection();\nif (!recs.length) {\n  return;\n}\nvar rows = Wb.getData(recs);\nWb.each(rows, function(row) {\n  row.IS_CLOSE = 'N';\n});\nWb.confirm('{#openMsg1#}' + recs.length + '{#openMsg2#}', function() {\n  Wb.request({\n    url: 'm?xwl=xc/ap/req/DB/XC_AP_PAY_REQ_H_UPDATE_CLOSE',\n    params: Wb.apply({\n      closeRec: rows\n    }),\n    success: function() {\n      Wb.reload(app.grid1);\n    }\n  });\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#Enclosure#}","itemId":"enclosureBtn","iconCls":"attach_icon"},"events":{"click":"var rows = app.grid1.getSelection();\nif(rows.length<1){\n  Wb.toast('{#enclosureMsg#}');\n}else{\n    var temp_id = rows[0].data.AP_PAY_REQ_H_ID;\n    var temp_code = rows[0].data.AP_DOC_CAT_CODE;\n    Xip.showAttachmentManager('{#XIP.userId#}',temp_id,'','AP_REC_DOCS',temp_code,'Y','Y','Y',function(){},2); \n}"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#rowNum#}","xtype":"rownumberer","align":"center","width":"50","titleAlign":"center","itemId":"rowNum"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#ledgerName#}","width":"200","dataIndex":"LEDGER_NAME","titleAlign":"center","itemId":"LEDGER_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#payReqCode#}","width":"200","dataIndex":"AP_PAY_REQ_H_CODE","titleAlign":"center","itemId":"AP_PAY_REQ_H_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#payReqId#}","hidden":"true","width":"200","dataIndex":"AP_PAY_REQ_H_ID","titleAlign":"center","itemId":"AP_PAY_REQ_H_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#payType#}","width":"100","dataIndex":"AP_DOC_CAT_NAME","titleAlign":"center","itemId":"AP_DOC_CAT_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#descrition#}","dataIndex":"DESCRIPTION","titleAlign":"center","itemId":"DESCRIPTION_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#vendorName#}","dataIndex":"VENDOR_NAME","titleAlign":"center","itemId":"VENDOR_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#applyAmount#}","align":"right","dataIndex":"AMOUNT","titleAlign":"center","itemId":"AMOUNT_COL","renderer":"return Wb.format(value,'0,000.00');"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#paidAmt#}","align":"right","dataIndex":"PAID_AMT","titleAlign":"center","itemId":"PAID_AMT_COL","renderer":"return Wb.format(value,'0,000.00');"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#bizDate#}","dataIndex":"BIZ_DATE","titleAlign":"center","itemId":"BIZ_DATE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#contractName#}","dataIndex":"AP_CONTRACT_NAME","titleAlign":"center","itemId":"AP_CONTRACT_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#deptName#}","dataIndex":"DEPT_NAME","titleAlign":"center","itemId":"DEPT_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#projectName#}","dataIndex":"PROJECT_NAME","titleAlign":"center","itemId":"PROJECT_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#creatByName#}","dataIndex":"CREATED_BY_NAME","titleAlign":"center","itemId":"CREATED_BY_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#appUserName#}","hidden":"true","dataIndex":"APP_USER_NAME","titleAlign":"center","itemId":"APP_USER_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#status#}","dataIndex":"SYS_AUDIT_STATUS_NAME","titleAlign":"center","itemId":"SYS_AUDIT_STATUS_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#isClose#}","dataIndex":"IS_CLOSE","titleAlign":"center","itemId":"IS_CLOSE_NAME_COL","renderer":"if(value==\"Y\")\n  return '{#Y#}';\nelse  \n  return '{#N#}';"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}