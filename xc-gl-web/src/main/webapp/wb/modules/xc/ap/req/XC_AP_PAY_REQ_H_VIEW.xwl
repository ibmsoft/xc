{"inframe":false,"title":"付款申请单审批时查看","hidden":false,"roles":{"default":1},"children":[{"configs":{"serverScript":"var apPayReqvHId = request.getParameter(\"businessId\");\nrequest.setAttribute(\"apPayReqvHId\",apPayReqvHId);\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,'xc/ap/req/json/XC_AP_PAY_REQ_H_NO_C');","itemId":"module"},"events":{"finalize":"Wb.isInsert = 'Y';\nWb.docCatCode = '{#AP_DOC_CAT_CODE#}';\n\n//Wb.docCatCode=\"CGJS\";\n\napp.AP_DOC_CAT_CODE.setValue(Wb.docCatCode);\n\n\n    if(Wb.docCatCode=='CGJS'){\n      app.grid1.show();\n    }\n    if(Wb.docCatCode=='QTFK'){\n      app.grid2.show();\n      app.td_2_4.hide();\n    }\n    if(Wb.isInsert=='Y'){\n      app.AP_PAY_REQ_H_ID.setValue(Xip.getId());\n      app.BIZ_DATE.setValue(new Date());\n      app.CREATED_BY_NAME.setValue('{#XIP.empName#}');\n      app.SYS_AUDIT_STATUS_DESC.setValue('{#draft#}');\n      app.SYS_AUDIT_STATUS.setValue('A');\n      app.IS_CLOSE_NAME.setValue('{#N#}');\n      if(Wb.docCatCode=='CGJS'){\n        app.grid1.getStore().reload({params:{\n          AP_PAY_REQ_H_ID:app.AP_PAY_REQ_H_ID.getValue()\n        }});\n      }\n      if(Wb.docCatCode=='QTFK'){\n        app.grid2.getStore().reload({params:{\n          AP_PAY_REQ_H_ID:app.AP_PAY_REQ_H_ID.getValue()\n        }});\n      }\n    }\n    if(Wb.isInsert=='N'){\n      Wb.request({\n        url: 'm?xwl=xc/ap/req/DB/XC_AP_PAY_REQ_H_SELECT_BY_ID',\n        params: {AP_PAY_REQ_H_ID:Wb.keyValue},\n        success: function(resp) {\n          var r = Wb.decode(resp.responseText);\n          r.BIZ_DATE=Wb.strToDate(r.BIZ_DATE);\n          Wb.setValue(app.editWinN,r);\n          app.VENDOR_ID_XWL.QUERY_LEDGER_ID.setValue(r.LEDGER_ID);\n          app.PROJECT_ID_XWL.QUERY_LEDGER_ID.setValue(r.LEDGER_ID);\n          app.DEPT_ID_XWL.QUERY_LEDGER_ID.setValue(r.LEDGER_ID);\n          app.ACCOUNT_NAME_XWL.QUERY_VENDOR_ID.setValue(r.VENDOR_ID);\n          if(Wb.docCatCode=='CGJS'){\n            app.grid1.getStore().reload({params:{\n                AP_PAY_REQ_H_ID:Wb.keyValue\n            }});\n          }\n          if(Wb.docCatCode=='QTFK'){\n            app.grid2.getStore().reload({params:{\n                AP_PAY_REQ_H_ID:Wb.keyValue\n            }});\n          }\n          \n        }\n      });\n    }\n    if(Wb.isInsert=='S'){\n      Wb.request({\n        url: 'm?xwl=xc/ap/req/DB/XC_AP_PAY_REQ_H_SELECT_BY_ID',\n        params: {AP_PAY_REQ_H_ID:Wb.keyValue},\n        success: function(resp) {\n          var r = Wb.decode(resp.responseText);\n          r.BIZ_DATE=Wb.strToDate(r.BIZ_DATE);\n          Wb.setValue(app.editWinN,r);\n          //app.VENDOR_ID_XWL.QUERY_LEDGER_ID.setValue(r.LEDGER_ID);\n          //app.PROJECT_ID_XWL.QUERY_LEDGER_ID.setValue(r.LEDGER_ID);\n          //app.DEPT_ID_XWL.QUERY_LEDGER_ID.setValue(r.LEDGER_ID);\n          //app.ACCOUNT_NAME_XWL.QUERY_VENDOR_ID.setValue(r.VENDOR_ID);\n          if(Wb.docCatCode=='CGJS'){\n            app.grid1.getStore().reload({params:{\n                AP_PAY_REQ_H_ID:Wb.keyValue\n            }});\n          }\n          if(Wb.docCatCode=='QTFK'){\n            app.grid2.getStore().reload({params:{\n                AP_PAY_REQ_H_ID:Wb.keyValue\n            }});\n          }\n        }\n      });\n      app.form1Tbar.hide();\n    }\n\nfunction returnRowFn(r,type){\n\tif(type=='xc_gl_ledgers'){\n      app.VENDOR_ID_XWL.QUERY_LEDGER_ID.setValue(r.data.LEDGER_ID);\n      app.PROJECT_ID_XWL.QUERY_LEDGER_ID.setValue(r.data.LEDGER_ID);\n      app.DEPT_ID_XWL.QUERY_LEDGER_ID.setValue(r.data.LEDGER_ID);\n      app.QUERY_LEDGER_ID.setValue(r.data.LEDGER_ID);\n    }\n  \n    if(type=='xc_ap_vendors'){     \n       if(app.ACCOUNT_NAME_XWL.QUERY_VENDOR_ID.getValue()!==r.data.VENDOR_ID){\n         app.ACCOUNT_NAME_XWL.ACCOUNT_NAME.setValue('');\n         app.DEPOSIT_BANK_NAME.setValue('');\n         app.BANK_ACCOUNT.setValue('');\n       }\n      app.ACCOUNT_NAME_XWL.QUERY_VENDOR_ID.setValue(r.data.VENDOR_ID);\n    }\n  \n    if(type=='xc_ap_vendor_banks'){\n      app.DEPOSIT_BANK_NAME.setValue(r.data.DEPOSIT_BANK_NAME);\n      app.BANK_ACCOUNT.setValue(r.data.BANK_ACCOUNT);\n    }\n}\nfunction clearOtherFn(type){\n  if(type=='xc_gl_ledgers'){\n    app.VENDOR_ID_XWL.VENDOR_ID.setValue('');\n    app.VENDOR_ID_XWL.VENDOR_NAME.setValue('');\n    app.PROJECT_ID_XWL.PROJECT_ID.setValue('');\n    app.PROJECT_ID_XWL.PROJECT_NAME.setValue('');\n    app.DEPT_ID_XWL.DEPT_ID.setValue('');\n    app.DEPT_ID_XWL.DEPT_NAME.setValue('');\n  }\n  \n  //清空账薄时清空面板中所有信息\n  if(type=='cancelLedger'){\n    app.form1.getForm().reset();    \n    app.VENDOR_ID_XWL.VENDOR_ID.setValue('');\n    app.VENDOR_ID_XWL.VENDOR_NAME.setValue('');\n    app.PROJECT_ID_XWL.PROJECT_ID.setValue('');\n    app.PROJECT_ID_XWL.PROJECT_NAME.setValue('');\n    app.DEPT_ID_XWL.DEPT_ID.setValue('');\n    app.DEPT_ID_XWL.DEPT_NAME.setValue('');\n  }\n  \n}\n\n//清空开户名的同时开户行和账户信息\nfunction clearBank(type) {\n  if(type=='bank') {\n     app.DEPOSIT_BANK_NAME.reset();\n     app.BANK_ACCOUNT.reset();\n  }\n}\n\n//清空付款账户的同时清空付款科目\nfunction clearPayAcc(type){\n  if(type=='payAcc') {\n     app.PAY_ACC_ID.reset();\n     app.PAY_ACC_NAME.reset();\n  }\n}\n\napp.LEDGER_ID_XWL.LEDGER_NAME.allowBlank=false;\napp.VENDOR_ID_XWL.VENDOR_NAME.allowBlank=false;","initialize":"Wb.docCatCode = 'X';"},"children":[{"configs":{"layout":"border","itemId":"viewport1"},"events":{"beforerender":"//付款申请ID 流程中传过来的\nvar apPayReqvHId = '{#apPayReqvHId#}';\n//根据付款申请ID得到采购单据类型\nWb.request({\n\turl : 'm?xwl=xc/ap/req/DB/XC_AP_PAY_REQ_H_SELECT_BY_ID',\n    async : false,\n    params : {AP_PAY_REQ_H_ID : apPayReqvHId},\n    success : function(resp){\n        var data = Wb.decode(resp.responseText);\n        var docCatCode = data.AP_DOC_CAT_CODE;//单据类型编码\n       if(docCatCode == 'CGJS'){\n            app.grid1.show();\n        }\n        if(docCatCode == 'QTFK'){\n            app.grid2.show();\n            app.td_2_4.hide();\n        }\n        if(docCatCode == 'CGJS'){\n            app.grid1.getStore().reload({params:{AP_PAY_REQ_H_ID:apPayReqvHId}});\n        }\n        if(docCatCode == 'QTFK'){\n            app.grid2.getStore().reload({params:{AP_PAY_REQ_H_ID:apPayReqvHId}});\n        }\n        Wb.setValue(app.form1,data);\n        app.BIZ_DATE.setValue(Ext.util.Format.date(data.BIZ_DATE,'Y-m-d'));\n\t}\n});"},"children":[{"configs":{"tbar":"app.form1Tbar","region":"north","autoScroll":"true","itemId":"form1","border":"false"},"children":[{"configs":{"style":"fontSize:30px","margin":"10 0 20 0","html":"<font style=\"\">{#title#}<\/font>","labelAlign":"center","itemId":"title"},"children":[],"expanded":false,"type":"label"},{"configs":{"layout":"column","itemId":"tr1","border":"false"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_1_1"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"LEDGER_NAME","fieldLabel":"{#ledgerName#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_1_2"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"AP_DOC_CAT_NAME","fieldLabel":"{#docCatCode#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_1_3"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"AP_PAY_REQ_H_CODE","fieldLabel":"{#payReqCode#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_1_4"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","allowBlank":"false","labelAlign":"right","itemId":"BIZ_DATE","fieldLabel":"{#bizDate#}"},"children":[],"expanded":false,"type":"date"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"layout":"column","itemId":"tr2","border":"false"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_2_1"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"VENDOR_NAME","fieldLabel":"{#vendorName#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_2_2"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"PROJECT_NAME","fieldLabel":"{#projectName#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_1_3"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"DEPT_NAME","fieldLabel":"{#deptName#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_2_4"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"AP_CONTRACT_NAME","fieldLabel":"{#contract#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"layout":"column","itemId":"tr3","border":"false"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_3_1"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","fieldStyle":"direction:rtl;","labelAlign":"right","itemId":"AMOUNT","fieldLabel":"{#applyAmount#}"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_3_2"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","allowBlank":"false","labelAlign":"right","itemId":"DESCRIPTION","fieldLabel":"{#description#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"title":"供应商信息","itemId":"fieldset2"},"children":[{"configs":{"height":"35","layout":"column","itemId":"tr5","border":"false"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_5_1"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"ACCOUNT_NAME","fieldLabel":"{#accountName#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_5_2"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"DEPOSIT_BANK_NAME","fieldLabel":"{#bank#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_5_3"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"BANK_ACCOUNT","fieldLabel":"{#bankAccount#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"fieldset"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"column","margin":"0 0 10 0","itemId":"tr6","border":"false"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_8_1"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"CREATED_BY_NAME","fieldLabel":"{#creatByName#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_8_2"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"SYS_AUDIT_STATUS_DESC","fieldLabel":"{#status#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_8_3"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"IS_CLOSE_NAME","fieldLabel":"{#isClose#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"hidden":"true","itemId":"hidden_p"},"children":[{"configs":{"hidden":"true","itemId":"AP_PAY_REQ_H_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"AUDIT_STATUS"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"SYS_AUDIT_STATUS"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"INS_CODE"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","value":"{#XIP.userId#}","itemId":"USER_ID","fieldLabel":"USER_ID"},"children":[],"expanded":false,"type":"text"}],"expanded":false,"type":"panel"}],"expanded":true,"type":"form"},{"configs":{"region":"center","pagingBar":"false","hidden":"true","itemId":"grid2","editable":"true"},"children":[{"configs":{"itemId":"store","autoLoad":"true","url":"m?xwl=xc/ap/req/DB/XC_AP_PAY_REQ_L_SELECT"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"付款申请行ID","hidden":"true","dataIndex":"AP_PAY_REQ_L_ID","itemId":"AP_PAY_REQ_L_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"付款申请主ID","hidden":"true","dataIndex":"AP_PAY_REQ_H_ID","itemId":"AP_PAY_REQ_H_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"采购类型ID","hidden":"true","dataIndex":"AP_PUR_TYPE_ID","itemId":"AP_PUR_TYPE_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"预算项目ID","hidden":"true","dataIndex":"BG_ITEM_ID","itemId":"BG_ITEM_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#purchaseType#}","dataIndex":"AP_PUR_TYPE_NAME","itemId":"AP_PUR_TYPE_NAME_COL","flex":"2"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#budget#}","dataIndex":"BG_ITEM_NAME","itemId":"BG_ITEM_NAME_COL","flex":"3"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#applyAmount#}","dataIndex":"AMOUNT","itemId":"AMOUNT_COL","flex":"1"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#description#}","dataIndex":"DESCRIPTION","itemId":"DESCRIPTION_COL","flex":"3"},"children":[],"expanded":true,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"},{"configs":{"region":"center","pagingBar":"false","hidden":"true","itemId":"grid1","editable":"true"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/ap/req/DB/XC_AP_PAY_REQ_L_SELECT"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"付款申请行ID","hidden":"true","dataIndex":"AP_PAY_REQ_L_ID","itemId":"AP_PAY_REQ_L_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"付款申请主ID","hidden":"true","dataIndex":"AP_PAY_REQ_H_ID","itemId":"AP_PAY_REQ_H_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"应付单ID","hidden":"true","dataIndex":"AP_INV_GL_H_ID","itemId":"AP_INV_GL_H_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"合同ID","hidden":"true","dataIndex":"AP_CONTRACT_ID","itemId":"AP_CONTRACT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#invCode#}","width":"150","dataIndex":"AP_INV_GL_H_CODE","itemId":"AP_INV_GL_H_CODE_COL","renderer":"metaData.style='background-color:#ffffd0';\nreturn value;"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#contract#}","width":"150","dataIndex":"AP_CONTRACT_NAME","itemId":"AP_CONTRACT_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#deptName#}","width":"150","dataIndex":"DEPT_NAME","itemId":"DEPT_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#projectName#}","width":"150","dataIndex":"PROJECT_NAME","itemId":"PROJECT_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#applyAmount#}","width":"100","dataIndex":"AMOUNT","itemId":"AMOUNT_COL","renderer":"metaData.style='background-color:#ffffd0';\nreturn value;"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#description#}","width":"200","dataIndex":"DESCRIPTION","itemId":"DESCRIPTION_COL","renderer":"metaData.style='background-color:#ffffd0';\nreturn value;"},"children":[],"expanded":true,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}