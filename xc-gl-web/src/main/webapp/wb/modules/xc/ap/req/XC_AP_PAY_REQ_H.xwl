{"inframe":false,"title":"付款申请单录入","hidden":false,"roles":{"default":1},"children":[{"configs":{"serverScript":"var userId = request.getSession().getAttribute(\"XzSessionVars\").get('userId');\n\nvar protocol = request.getProtocol() ;\nvar ipAddr = request.getServerName();\nvar port = request.getServerPort() ;\nvar ctxPath = request.getContextPath() ;\n\nvar pp = protocol.substr(0,5) ;\nprotocol = (pp.indexOf(\"https\") == -1 ? \"http\" : \"https\") ;\n\nvar url = protocol + \"://\" + ipAddr +\":\" + port + ctxPath ;\n\nrequest.setAttribute('contextPath',ctxPath);\nrequest.setAttribute(\"userId\",userId);\nrequest.setAttribute(\"appIP\",url);\nvar appId = request.getSession().getAttribute(\"XzSessionVars\").get('appId');\nrequest.setAttribute(\"funId\",request.getParameter('funId'));\nrequest.setAttribute(\"appId\",request.getParameter('appId'));\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,'xc/ap/req/json/XC_AP_PAY_REQ_H');","itemId":"module"},"events":{"finalize":"Wb.isInsert = 'Y';\nWb.docCatCode = '{#AP_DOC_CAT_CODE#}';\n\n//Wb.docCatCode=\"CGJS\";\n\napp.AP_DOC_CAT_CODE.setValue(Wb.docCatCode);\n\n    if(Wb.docCatCode=='CGJS'){\n      app.grid1.show();\n    }\n    if(Wb.docCatCode=='QTFK'){\n      app.grid2.show();\n      app.td_2_4.hide();\n    }\n    if(Wb.docCatCode=='YUFK'){\n     app.AMOUNT.setReadOnly(false);\n      app.AP_CONTRACT_ID_XWL.AP_CONTRACT_NAME.allowBlank=false;\n      app.AP_CONTRACT_ID_XWL.AP_CONTRACT_NAME.setFieldLabel('<span style=\"color: rgb(255, 0, 0);\">*<\/span>'+'{#contractName#}');\n    }\n \n    if(Wb.isInsert=='Y'){\n      app.AP_PAY_REQ_H_ID.setValue(Xip.getId());\n      app.BIZ_DATE.setValue(new Date());\n      app.CREATED_BY_NAME.setValue('{#XIP.empName#}');\n      app.SYS_AUDIT_STATUS_DESC.setValue('{#draft#}');\n      app.SYS_AUDIT_STATUS.setValue('A');\n      app.AUDIT_STATUS.setValue('A');\n      app.IS_CLOSE_NAME.setValue('{#N#}');\n      if(Wb.docCatCode=='CGJS'){\n        app.grid1.getStore().reload({params:{\n          AP_PAY_REQ_H_ID:app.AP_PAY_REQ_H_ID.getValue()\n        }});\n      }\n      if(Wb.docCatCode=='QTFK'){\n        app.grid2.getStore().reload({params:{\n          AP_PAY_REQ_H_ID:app.AP_PAY_REQ_H_ID.getValue()\n        }});\n      }\n    }\n    if(Wb.isInsert=='N'){\n      Wb.request({\n        url: 'm?xwl=xc/ap/req/DB/XC_AP_PAY_REQ_H_SELECT_BY_ID',\n        params: {AP_PAY_REQ_H_ID:Wb.keyValue},\n        success: function(resp) {\n          var r = Wb.decode(resp.responseText);\n          r.BIZ_DATE=Wb.strToDate(r.BIZ_DATE);\n          Wb.setValue(app.editWinN,r);\n          app.VENDOR_ID_XWL.QUERY_LEDGER_ID.setValue(r.LEDGER_ID);\n          app.PROJECT_ID_XWL.QUERY_LEDGER_ID.setValue(r.LEDGER_ID);\n          app.DEPT_ID_XWL.QUERY_LEDGER_ID.setValue(r.LEDGER_ID);\n          app.ACCOUNT_NAME_XWL.QUERY_VENDOR_ID.setValue(r.VENDOR_ID);\n          app.AP_CONTRACT_ID_XWL.QUERY_LEDGER_ID.setValue(r.LEDGER_ID);\n          if(Wb.docCatCode=='CGJS'){\n            app.grid1.getStore().reload({params:{\n                AP_PAY_REQ_H_ID:Wb.keyValue\n            }});\n          }\n          if(Wb.docCatCode=='QTFK'){\n            app.grid2.getStore().reload({params:{\n                AP_PAY_REQ_H_ID:Wb.keyValue\n            }});\n          }\n          \n        }\n      });\n    }\n    if(Wb.isInsert=='S'){\n      Wb.request({\n        url: 'm?xwl=xc/ap/req/DB/XC_AP_PAY_REQ_H_SELECT_BY_ID',\n        params: {AP_PAY_REQ_H_ID:Wb.keyValue},\n        success: function(resp) {\n          var r = Wb.decode(resp.responseText);\n          r.BIZ_DATE=Wb.strToDate(r.BIZ_DATE);\n          Wb.setValue(app.editWinN,r);\n          //app.VENDOR_ID_XWL.QUERY_LEDGER_ID.setValue(r.LEDGER_ID);\n          //app.PROJECT_ID_XWL.QUERY_LEDGER_ID.setValue(r.LEDGER_ID);\n          //app.DEPT_ID_XWL.QUERY_LEDGER_ID.setValue(r.LEDGER_ID);\n          //app.ACCOUNT_NAME_XWL.QUERY_VENDOR_ID.setValue(r.VENDOR_ID);\n          if(Wb.docCatCode=='CGJS'){\n            app.grid1.getStore().reload({params:{\n                AP_PAY_REQ_H_ID:Wb.keyValue\n            }});\n          }\n          if(Wb.docCatCode=='QTFK'){\n            app.grid2.getStore().reload({params:{\n                AP_PAY_REQ_H_ID:Wb.keyValue\n            }});\n          }\n        }\n      });\n      app.form1Tbar.hide();\n    }\n\nfunction returnRowFn(r,type){\n\tif(type=='xc_gl_ledgers'){\n        app.VENDOR_ID_XWL.QUERY_LEDGER_ID.setValue(r.data.LEDGER_ID);\n        app.PROJECT_ID_XWL.QUERY_LEDGER_ID.setValue(r.data.LEDGER_ID);\n        app.DEPT_ID_XWL.QUERY_LEDGER_ID.setValue(r.data.LEDGER_ID);\n        app.AP_CONTRACT_ID_XWL.QUERY_LEDGER_ID.setValue(r.data.LEDGER_ID);\n        app.ACCOUNT_NAME_XWL.QUERY_VENDOR_ID.setValue(app.VENDOR_ID_XWL.VENDOR_ID.getValue());\n    }\n    if(type=='xc_ap_vendors'){     \n        if(app.ACCOUNT_NAME_XWL.QUERY_VENDOR_ID.getValue()!==r.data.VENDOR_ID){\n            app.ACCOUNT_NAME_XWL.ACCOUNT_NAME.setValue('');\n            app.DEPOSIT_BANK_NAME.setValue('');\n            app.BANK_ACCOUNT.setValue('');\n        }\n        app.ACCOUNT_NAME_XWL.QUERY_VENDOR_ID.setValue(r.data.VENDOR_ID);\n        app.AP_CONTRACT_ID_XWL.QUERY_VENDOR_ID.setValue(app.VENDOR_ID_XWL.VENDOR_ID.getValue());\n        app.AP_CONTRACT_ID_XWL.AP_CONTRACT_ID.setValue('');\n        app.AP_CONTRACT_ID_XWL.AP_CONTRACT_NAME.setValue(''); \n        //切换供应商把行表数据删除\n        app.grid1.store.removeAll();\n    }\n    if (type == 'xc_ap_contract') {\n        app.VENDOR_ID_XWL.VENDOR_ID.setValue(r.data.VENDOR_ID);\n        app.VENDOR_ID_XWL.VENDOR_NAME.setValue(r.data.VENDOR_NAME);\n        app.ACCOUNT_NAME_XWL.QUERY_VENDOR_ID.setValue(r.data.VENDOR_ID);\n    }\n  \n    if(type=='xc_ap_vendor_banks'){\n        app.DEPOSIT_BANK_NAME.setValue(r.data.DEPOSIT_BANK_NAME);\n        app.BANK_ACCOUNT.setValue(r.data.BANK_ACCOUNT);\n    }\n  \n    //选择项目带回成本中心\n    if(type == 'xc_pm_projects') {\n        app.DEPT_ID_XWL.DEPT_ID.setValue(r.data.DEPT_ID);\n        app.DEPT_ID_XWL.DEPT_NAME.setValue(r.data.DEPT_NAME);\n    }\n  \n    //选择成本中心为项目查询的成本中心赋值\n    if(type == 'xip_pub_depts') {\n        app.PROJECT_ID_XWL.QUERY_DEPT_ID.setValue(r.data.DEPT_ID);\n    }\n}\nfunction clearOtherFn(type){\n    if(type=='xc_gl_ledgers'){\n        app.VENDOR_ID_XWL.VENDOR_ID.setValue('');\n        app.VENDOR_ID_XWL.VENDOR_NAME.setValue('');\n        app.PROJECT_ID_XWL.PROJECT_ID.setValue('');\n        app.PROJECT_ID_XWL.PROJECT_NAME.setValue('');\n        app.DEPT_ID_XWL.DEPT_ID.setValue('');\n        app.DEPT_ID_XWL.DEPT_NAME.setValue('');\n        app.AP_CONTRACT_ID_XWL.AP_CONTRACT_ID.setValue('');\n        app.AP_CONTRACT_ID_XWL.AP_CONTRACT_NAME.setValue('');\n        app.ACCOUNT_NAME_XWL.ACCOUNT_NAME.setValue('');\n        app.ACCOUNT_NAME_XWL.ACCOUNT_NAME.setValue('');\n        app.DEPOSIT_BANK_NAME.setValue('');\n        app.BANK_ACCOUNT.setValue('');\n    }\n  \n    //清空账薄时清空面板中所有信息\n    if(type=='cancelLedger'){\n        app.form1.getForm().reset();    \n        app.VENDOR_ID_XWL.VENDOR_ID.setValue('');\n        app.VENDOR_ID_XWL.VENDOR_NAME.setValue('');\n        app.PROJECT_ID_XWL.PROJECT_ID.setValue('');\n        app.PROJECT_ID_XWL.PROJECT_NAME.setValue('');\n        app.DEPT_ID_XWL.DEPT_ID.setValue('');\n        app.DEPT_ID_XWL.DEPT_NAME.setValue('');\n        app.AP_CONTRACT_ID_XWL.AP_CONTRACT_ID.setValue('');\n        app.AP_CONTRACT_ID_XWL.AP_CONTRACT_NAME.setValue('');\n        app.ACCOUNT_NAME_XWL.ACCOUNT_NAME.setValue('');\n        app.ACCOUNT_NAME_XWL.ACCOUNT_NAME.setValue('');\n        app.DEPOSIT_BANK_NAME.setValue('');\n        app.BANK_ACCOUNT.setValue('');\n    }\n    if(type=='xc_ap_vendors'){\n\n        //清空供应商时清空合同\n        app.AP_CONTRACT_ID_XWL.QUERY_VENDOR_ID.setValue('');\n        app.AP_CONTRACT_ID_XWL.AP_CONTRACT_ID.setValue('');\n        app.AP_CONTRACT_ID_XWL.AP_CONTRACT_NAME.setValue('');\n        app.ACCOUNT_NAME_XWL.QUERY_VENDOR_ID.setValue('');\n        app.ACCOUNT_NAME_XWL.ACCOUNT_NAME.setValue('');\n        app.DEPOSIT_BANK_NAME.setValue('');\n        app.BANK_ACCOUNT.setValue('');\t\n    }\n    \n    //情况成本中心同时清空项目查询条件里的成本中心\n    if(type == 'xip_pub_depts') {\n        app.PROJECT_ID_XWL.QUERY_DEPT_ID.setValue('');\n    }\n    \n}\n\n//清空开户名的同时开户行和账户信息\nfunction clearBank(type) {\n    if(type=='bank') {\n        app.DEPOSIT_BANK_NAME.reset();\n        app.BANK_ACCOUNT.reset();\n    }\n}\n\n//清空付款账户的同时清空付款科目\nfunction clearPayAcc(type){\n    if(type=='payAcc') {\n        app.PAY_ACC_ID.reset();\n        app.PAY_ACC_NAME.reset();\n    }\n}\napp.LEDGER_ID_XWL.LEDGER_NAME.allowBlank=false;\napp.VENDOR_ID_XWL.VENDOR_NAME.allowBlank=false;","initialize":"Wb.docCatCode = 'X';"},"children":[{"configs":{"itemId":"request"},"children":[{"configs":{"autoLoad":"true","itemId":"ldInitStore","url":"m?xwl=xc/com-lov/LEDGER_ID_PICK/DB/XC_GL_LEDGERS_SELECT_SEC"},"events":{"load":"Wb.ledgerStroe = store;\napp.LEDGER_ID_XWL.LEDGER_ID.setValue(store.getAt(0).get('LEDGER_ID'));\napp.LEDGER_ID_XWL.LEDGER_NAME.setValue(store.getAt(0).get('LEDGER_NAME'));\napp.VENDOR_ID_XWL.QUERY_LEDGER_ID.setValue(store.getAt(0).get('LEDGER_ID'));\napp.PROJECT_ID_XWL.QUERY_LEDGER_ID.setValue(store.getAt(0).get('LEDGER_ID'));\napp.DEPT_ID_XWL.QUERY_LEDGER_ID.setValue(store.getAt(0).get('LEDGER_ID'));\napp.ACCOUNT_NAME_XWL.QUERY_VENDOR_ID.setValue(store.getAt(0).get('LEDGER_ID'));\napp.AP_CONTRACT_ID_XWL.QUERY_LEDGER_ID.setValue(store.getAt(0).get('LEDGER_ID'));\nWb.request({\n  url: 'm?xwl=xc/ap/inv/DB/XC_GL_LD_DEPTS_ASG_SELECT',\n  params: {LEDGER_ID:store.getAt(0).get('LEDGER_ID')},\n  success: function(resp) {\n   var r = Wb.decode(resp.responseText);\n   app.DEPT_ID_XWL.DEPT_ID.setValue(r.DEPT_ID);\n   app.DEPT_ID_XWL.DEPT_NAME.setValue(r.DEPT_NAME);\n  }\n});\n\n\n"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"folder"},{"configs":{"itemId":"form1Tbar"},"children":[{"configs":{"text":"{#add#}","itemId":"addBtn","iconCls":"file_add_icon"},"events":{"click":"app.form1.getForm().reset();\napp.AP_PAY_REQ_H_ID.setValue(Xip.getId());\n  app.BIZ_DATE.setValue(new Date());\napp.AP_DOC_CAT_CODE.setValue(Wb.docCatCode);\nif(Wb.docCatCode=='CGJS'){\n\tapp.grid1.getStore().reload({params:{\n\t\tAP_PAY_REQ_H_ID:app.AP_PAY_REQ_H_ID.getValue()\n\t}});\n}\nif(Wb.docCatCode=='QTFK'){\n\tapp.grid2.getStore().reload({params:{\n\t\tAP_PAY_REQ_H_ID:app.AP_PAY_REQ_H_ID.getValue()\n\t}});\n}\nWb.isInsert = 'Y';\n\napp.submitButton.setDisabled(false);\napp.saveBtn.setDisabled(false);\n\nvar lstore = Wb.ledgerStroe;\n\n\nif(lstore.getCount()==1){\napp.LEDGER_ID_XWL.LEDGER_ID.setValue(lstore.getAt(0).get('LEDGER_ID'));\napp.LEDGER_ID_XWL.LEDGER_NAME.setValue(lstore.getAt(0).get('LEDGER_NAME'));\napp.VENDOR_ID_XWL.QUERY_LEDGER_ID.setValue(lstore.getAt(0).get('LEDGER_ID'));\napp.PROJECT_ID_XWL.QUERY_LEDGER_ID.setValue(lstore.getAt(0).get('LEDGER_ID'));\napp.DEPT_ID_XWL.QUERY_LEDGER_ID.setValue(lstore.getAt(0).get('LEDGER_ID'));\napp.ACCOUNT_NAME_XWL.QUERY_VENDOR_ID.setValue(lstore.getAt(0).get('LEDGER_ID'));\napp.AP_CONTRACT_ID_XWL.QUERY_LEDGER_ID.setValue(lstore.getAt(0).get('LEDGER_ID'));\n\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#save#}","itemId":"saveBtn","iconCls":"save_icon"},"events":{"click":"//采购结算需要保存FORM1 和 grid1\nif (Wb.docCatCode == 'CGJS') {\n\n    var getCount = app.grid1.getStore().getCount();\n    if (getCount === 0) {\n        Wb.toast('{#saveMsg1#}');\n        return;\n    }\n\n    var AMOUNT = 0;\n    for (var i = 0; i < app.grid1.getStore().getCount(); i++) {\n        var r = app.grid1.getStore().getAt(i);\n        AMOUNT = AMOUNT + r.get('AMOUNT');\n    }\n\n    if (Wb.isEmpty(AMOUNT) || AMOUNT === 0) {\n        Wb.toast('{#saveMsg2#}');\n        return;\n    } else {\n        app.AMOUNT.setValue(AMOUNT);\n    }\n\n    if (Wb.isInsert == 'N') {\n        //验证grid1数据是否合法\n        if (!Wb.verifyGrid(app.grid1)) {\n            Wb.toast('{#saveMsg3#}');\n            return;\n        }\n        if (app.form1.isValid()) {\n            Wb.request({\n                url: 'm?xwl=xc/ap/req/DB/XC_AP_PAY_REQ_H_UPDATE1',\n                params: Wb.getValue(app.form1),\n                success: function(resp) {\n                    Wb.sync({\n                        grid: app.grid1,\n                        params: {\n                            'AP_DOC_CAT_CODE': app.AP_DOC_CAT_CODE.getValue(),\n                          \t'AP_PAY_REQ_H_CODE':app.AP_PAY_REQ_H_CODE.getValue()\n                        },\n                        url: 'm?xwl=xc/ap/req/DB/XC_AP_PAY_REQ_L_SAVE',\n                        message: '{#saveMsg4#}',\n                        success: function(resp) {\n\n                            Wb.reload(app.grid1);\n                            Wb.toast('{#saveMsg5#}');\n                        }\n                    });\n                }\n            });\n        } else {\n            Wb.toast('{#saveMsg3#}');\n        }\n\n    }\n    if (Wb.isInsert == 'Y') {\n        //验证grid1数据是否合法\n        if (!Wb.verifyGrid(app.grid1)) {\n            Wb.toast('{#saveMsg3#}');\n            return;\n        }\n        if (app.form1.isValid()) {\n            Wb.request({\n                url: '{#contextPath#}' + '/getApCodeAction.do?method=getApCode',\n                //后台java代码生成\n                method: 'POST',\n                async: false,\n                //异步传参\n                params: {\n                    'ledgerId': app.LEDGER_ID_XWL.LEDGER_ID.getValue(),\n                    'apDocCatCode': app.AP_DOC_CAT_CODE.getValue(),\n                    'date': Ext.util.Format.date(app.BIZ_DATE.getValue(), 'Y-m-d'),\n                    'userId': app.USER_ID.getValue()\n                },\n                success: function(resp) {\n                    var record = Wb.decode(resp.responseText);\n                    var apDocCode = record.apDocCode;\n                    if (Wb.isEmpty(apDocCode)) {\n                        Wb.toast('{#saveMsg6#}');\n                    } else {\n                        app.AP_PAY_REQ_H_CODE.setValue(apDocCode);\n                        Wb.request({\n                            url: 'm?xwl=xc/ap/req/DB/XC_AP_PAY_REQ_H_INSERT1',\n                            params: Wb.getValue(app.form1),\n                            success: function(resp) {\n                                Wb.isInsert = 'N';\n                                Wb.sync({\n                                    grid: app.grid1,\n                                    params: {\n                                      'AP_DOC_CAT_CODE': app.AP_DOC_CAT_CODE.getValue(),\n                                      'AP_PAY_REQ_H_CODE':app.AP_PAY_REQ_H_CODE.getValue()\n                                    },\n                                    url: 'm?xwl=xc/ap/req/DB/XC_AP_PAY_REQ_L_SAVE',\n                                    message: '{#saveMsg4#}',\n                                    success: function(resp) {\n                                        //                     var AMOUNT = 0;\n                                        //                     for(var i=0;i<app.grid1.getStore().getCount();i++){\n                                        //                       var r = app.grid1.getStore().getAt(i);\n                                        //                       AMOUNT = AMOUNT+r.get('AMOUNT');\n                                        //                     }\n                                        app.AUDIT_STATUS.setValue('A');\n                                        //                     app.AMOUNT.setValue(AMOUNT);\n                                        Wb.reload(app.grid1, {\n                                            params: {\n                                                AP_PAY_REQ_H_ID: app.AP_PAY_REQ_H_ID.getValue()\n                                            }\n                                        });\n                                        Wb.toast('{#saveMsg5#}');\n                                    }\n                                });\n                            }\n                        });\n                    }\n                }\n            });\n\n        } else {\n            Wb.toast('{#saveMsg3#}');\n        }\n\n    }\n}\n//其它付款需要保存FORM1 和 grid2\nif (Wb.docCatCode == 'QTFK') {\n    var getCount = app.grid2.getStore().getCount();\n    if (getCount === 0) {\n        Wb.toast('{#saveMsg1#}');\n        return;\n    }\n\n    var AMOUNT = 0;\n    for (var i = 0; i < app.grid2.getStore().getCount(); i++) {\n        var r = app.grid2.getStore().getAt(i);\n        AMOUNT = AMOUNT + r.get('AMOUNT');\n    }\n    if (Wb.isEmpty(AMOUNT) || AMOUNT === 0) {\n        Wb.toast('{#saveMsg2#}');\n        return;\n    } else {\n        app.AMOUNT.setValue(AMOUNT);\n    }\n\n    if (Wb.isInsert == 'N') {\n        //验证grid2数据是否合法\n        if (!Wb.verifyGrid(app.grid2)) {\n            Wb.toast('{#saveMsg3#}');\n            return;\n        }\n        if (app.form1.isValid()) {\n            Wb.request({\n                url: 'm?xwl=xc/ap/req/DB/XC_AP_PAY_REQ_H_UPDATE1',\n                params: Wb.getValue(app.form1),\n                success: function(resp) {\n\n                    Wb.sync({\n                        grid: app.grid2,\n                        url: 'm?xwl=xc/ap/req/DB/XC_AP_PAY_REQ_L_SAVE',\n                      \tparams:{'AP_PAY_REQ_H_CODE':app.AP_PAY_REQ_H_CODE.getValue()},\n                        message: '{#saveMsg4#}',\n                        success: function(resp) {\n\n                            Wb.reload(app.grid2);\n                            Wb.toast('{#saveMsg5#}');\n                        }\n                    });\n                }\n            });\n        } else {\n            Wb.toast('{#saveMsg3#}');\n        }\n\n    }\n    if (Wb.isInsert == 'Y') {\n        //验证grid2数据是否合法\n        if (!Wb.verifyGrid(app.grid2)) {\n            Wb.toast('{#saveMsg3#}');\n            return;\n        }\n        if (app.form1.isValid()) {\n            Wb.request({\n                url: '{#contextPath#}' + '/getApCodeAction.do?method=getApCode',\n                //后台java代码生成\n                method: 'POST',\n                async: false,\n                //异步传参\n                params: {\n                    'ledgerId': app.LEDGER_ID_XWL.LEDGER_ID.getValue(),\n                    'apDocCatCode': app.AP_DOC_CAT_CODE.getValue(),\n                    'date': Ext.util.Format.date(app.BIZ_DATE.getValue(), 'Y-m-d'),\n                    'userId': app.USER_ID.getValue()\n                },\n                success: function(resp) {\n                    var record = Wb.decode(resp.responseText);\n                    var apDocCode = record.apDocCode;\n                    app.AP_PAY_REQ_H_CODE.setValue(apDocCode);\n                    if (Wb.isEmpty(apDocCode)) {\n                        Wb.toast('{#saveMsg6#}');\n                    } else {\n                        app.AP_PAY_REQ_H_CODE.setValue(apDocCode);\n                        Wb.request({\n                            url: 'm?xwl=xc/ap/req/DB/XC_AP_PAY_REQ_H_INSERT1',\n                            params: Wb.getValue(app.form1),\n                            success: function(resp) {\n                                app.AUDIT_STATUS.setValue('A');\n                                Wb.isInsert = 'N';\n                                Wb.sync({\n                                    grid: app.grid2,\n                                    url: 'm?xwl=xc/ap/req/DB/XC_AP_PAY_REQ_L_SAVE',\n                                  \tparams:{'AP_PAY_REQ_H_CODE':app.AP_PAY_REQ_H_CODE.getValue()},\n                                    message: '{#saveMsg4#}',\n                                    success: function(resp) {\n                                        Wb.reload(app.grid2, {\n                                            params: {\n                                                AP_PAY_REQ_H_ID: app.AP_PAY_REQ_H_ID.getValue()\n                                            }\n                                        });\n                                        Wb.toast('{#saveMsg5#}');\n                                    }\n                                });\n                            }\n                        });\n                    }\n\n                }\n            });\n\n        } else {\n            Wb.toast('{#saveMsg3#}');\n        }\n\n    }\n}\n//预付款需要保存FORM1\nif (Wb.docCatCode == 'YUFK') {\n    var amount = app.AMOUNT.getValue();\n    if (Wb.isEmpty(amount) || amount === 0) {\n        Wb.toast('{#saveMsg7#}');\n        return false;\n    }\n    if (Wb.isInsert == 'N') {\n        if (app.form1.isValid()) {\n            Wb.request({\n                url: 'm?xwl=xc/ap/req/DB/XC_AP_PAY_REQ_H_UPDATE',\n                params: Wb.getValue(app.form1),\n                success: function(resp) {\n                    Wb.toast('{#saveMsg5#}');\n                }\n            });\n        } else {\n            Wb.toast('{#saveMsg3#}');\n        }\n    }\n    if (Wb.isInsert == 'Y') {\n        if (app.form1.isValid()) {\n            Wb.request({\n                url: '{#contextPath#}' + '/getApCodeAction.do?method=getApCode',\n                //后台java代码生成\n                method: 'POST',\n                async: false,\n                //异步传参\n                params: {\n                    'ledgerId': app.LEDGER_ID_XWL.LEDGER_ID.getValue(),\n                    'apDocCatCode': app.AP_DOC_CAT_CODE.getValue(),\n                    'date': Ext.util.Format.date(app.BIZ_DATE.getValue(), 'Y-m-d'),\n                    'userId': app.USER_ID.getValue()\n                },\n                success: function(resp) {\n                    var record = Wb.decode(resp.responseText);\n                    var apDocCode = record.apDocCode;\n                    app.AP_PAY_REQ_H_CODE.setValue(apDocCode);\n                    if (Wb.isEmpty(apDocCode)) {\n                        Wb.toast('{#saveMsg6#}');\n                    } else {\n                        app.AP_PAY_REQ_H_CODE.setValue(apDocCode);\n                        Wb.request({\n                            url: 'm?xwl=xc/ap/req/DB/XC_AP_PAY_REQ_H_INSERT',\n                            params: Wb.getValue(app.form1),\n                            success: function(resp) {\n                                app.AUDIT_STATUS.setValue('A');\n                                Wb.toast('{#saveMsg5#}');\n                                Wb.isInsert = 'N';\n                              \t\n                            }\n                        });\n                    }\n\n                }\n            });\n\n        } else {\n            Wb.toast('{#saveMsg3#}');\n        }\n    }\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#submit#}","itemId":"submitButton","iconCls":"check_icon"},"events":{"click":"if(!app.form1.getForm().isValid()){\n  Wb.toast('{#submitMsg6#}');\n  return;\n}\nif(Wb.isInsert=='Y'){\n  Wb.toast('{#submitMsg7#}');\n  return false;\n}\nvar AP_DOC_CAT_CODE = app.AP_DOC_CAT_CODE.getValue();\n// TODO: 员工信息\nvar _empId = '{#XIP.empId#}' ;\nWb.request({\n  url : 'm?xwl=xc/ap/req/DB/XC_AP_PAY_REQ_L_SELECT',\n  params : {AP_PAY_REQ_H_ID : app.AP_PAY_REQ_H_ID.getValue()},\n  success : function(resp){\n    if(Wb.decode(resp.responseText).total === 0 && AP_DOC_CAT_CODE !== 'YUFK'){\n      Wb.toast(app.AP_PAY_REQ_H_CODE.getValue()+'{#submitMsg2#}');\n      return;\n    }\n    Wb.request({\n      url : '{#contextPath#}'+'/apPayReqCommonAction.do?method=getProcAndFormsByCat',\n      params : {LEDGER_ID : app.LEDGER_ID_XWL.LEDGER_ID.getValue(),AP_DOC_CAT_CODE : AP_DOC_CAT_CODE},\n      success : function(resp){\n        var response = Wb.decode(resp.responseText) ;\n        if(response.flag == \"0\"){\n          // TODO: 取得流程编码、电脑端审批表单和移动端审批表单\n          var processCode = response.PROCESS_CODE ;\n          var pcApproveForm = response.PC_A_FORM_URL ;\n          var mobileApproveForm = response.M_A_FORM_URL ;\n\n          // 电脑端和移动端审批表单为变量需要设置为全路径\n          pcApproveForm = '{#appIP#}' +  '/'+pcApproveForm ;\n          mobileApproveForm = '{#appIP#}' +  mobileApproveForm ;\n          // TODO: 如果流程编码存在, 则提交流程审批处理\n          if(processCode !== \"\" && processCode !== null && processCode !== undefined){\n            // 如果项目未指定，则设置默认值为 \"-1\"\n            var prjId = app.PROJECT_ID_XWL.PROJECT_ID.getValue() ;\n            if(prjId === null || prjId === \"\" || prjId === undefined){\n              prjId = \"-1\" ;\n            }\n            var orgId = '';\n            Wb.request({//查询组织ID\n              url:'m?xwl=xc/ap/req/DB/select-ld-org',\n              params:{'ledgerId':app.LEDGER_ID_XWL.LEDGER_ID.getValue()},\n              async:false,\n              success:function(resp){\n                var record = Wb.decode(resp.responseText);\n                orgId = record.rows[0].ORG_ID;\n              }\n            });\n            if(orgId==''){\n              return;\n            }\n            var auditStatus = app.AUDIT_STATUS.getValue();\n            var _empId = '{#XIP.empId#}' ;\n            var json = {\n              'APP_IP':'{#appIP#}',\n              'loginName':'{#XIP.userName#}',\n              'AP_DOC_CAT_NAME':app.AP_DOC_CAT_CODE.getDisplayValue(),\n              'PC_A_FORM':pcApproveForm,\n              'M_A_FORM' :mobileApproveForm,\n              'apCatCode':'FKSQD',\n              'DEPT_NAME':app.DEPT_ID_XWL.DEPT_NAME.getValue(),\n              'AMT':app.AMOUNT.getValue(),\n              'e_business_id':app.AP_PAY_REQ_H_ID.getValue(),\n              'billType'\t : app.AP_DOC_CAT_CODE.getValue(),\n              'PROJECT_ID'   : prjId,\n              'EMP_ID'       : _empId,\n              'ledgerId'     : app.LEDGER_ID_XWL.LEDGER_ID.getValue(),\n              'DEPT_ID'      : app.DEPT_ID_XWL.DEPT_ID.getValue(),\n              'ORG_ID'\t\t:orgId\n            };\n            if(auditStatus === 'A'){//起草状态\n              XipWf.startAndSubmitByProcess(processCode,json,function(e){//提交流程\n                if(e.flag === 0){\n                  app.INS_CODE.setValue(e.instanceCode);\n                  app.submitButton.setDisabled(true);\n                  app.saveBtn.setDisabled(true);\n                  app.AUDIT_STATUS.setValue('C');\n                  app.SYS_AUDIT_STATUS_DESC.setValue('{#r#}');\n                  Wb.toast('{#submitMsg3#}');\n                }\n                else if(e.flag === 1){\n                  Wb.toast(e.msg) ;\n                }else{}\n              });\n            }\n            else if(auditStatus === 'D'){//驳回状态\n              XipWf.submitInstance(app.INS_CODE.getValue(),json,function(e){//提交流程\n                if(e.flag === 0){\n                  app.submitButton.setDisabled(true);\n                  app.saveBtn.setDisabled(true);\n                  app.AUDIT_STATUS.setValue('C');\n                  app.SYS_AUDIT_STATUS_DESC.setValue('{#r#}');\n                  Wb.toast('{#submitMsg3#}');\n                }\n                else if(e.flag === 1){\n                  Wb.toast(e.msg) ;\n                }else{}\n              });\n            }else if(auditStatus === 'R'){//撤回状态\n              // 撤回 -> 按流程实例提交流程\n              XipWf.restartAndSubmitByProcess(app.INS_CODE.getValue(),processCode,json,function(e){\n                if(e.flag === 0){\n                  app.submitButton.setDisabled(true);\n                  app.saveBtn.setDisabled(true);\n                  app.AUDIT_STATUS.setValue('C');\n                  app.SYS_AUDIT_STATUS_DESC.setValue('{#r#}');\n                  Wb.toast('{#submitMsg3#}');\n                }\n                else if(e.flag === 1){\n                  Wb.toast(e.msg) ;\n                }else{}\n              },null);\n            }\n            else if(auditStatus === 'E' || auditStatus === 'C'){//运行中、结束状态\n              Wb.toast('{#submitMsg4#}');\n              return false;\n            }\n            else{\n              Wb.toast('{#submitMsg5#}');\n              return false;\n            }\n\n          }\n        }\n      }\n    });\n\n  }\n});\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#monitor#}","itemId":"monitorBtn","iconCls":"viewport_icon"},"events":{"click":"if(app.INS_CODE.getValue() === null || app.INS_CODE.getValue() === ''){\n    Wb.toast('{#monitorMsg3#}');\n}\nelse{\n    XipWf.showMonitorPage(app.INS_CODE.getValue());\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#withdraw#}","itemId":"withdrawBtn","iconCls":"cancel_icon"},"events":{"click":"if(app.INS_CODE.getValue() === null || app.INS_CODE.getValue() === '') {\n\tWb.toast('{#withdrawMsg2#}');\n\treturn;\n}\nelse if(app.AUDIT_STATUS.getValue() === 'E') {\n\tWb.toast('{#withdrawMsg3#}');\n\treturn;\n}\nelse if(app.AUDIT_STATUS.getValue() === 'R'){\n    Wb.toast('{#withdrawMsg5#}');\n    return;\n}\nelse {\n\t//撤回流程\n\tXipWf.revokeByInstance(app.INS_CODE.getValue(),function(e){\n        if(e.flag === '0'){\n            app.AUDIT_STATUS.setValue('A');\n            app.SYS_AUDIT_STATUS_DESC.setValue('{#draft#}');\n            app.submitButton.setDisabled(false);\n            app.saveBtn.setDisabled(false);\n            Wb.request({\n                url : 'm?xwl=xc/ap/req/DB/saveAuditStatus',\n                params : {AP_PAY_REQ_H_ID:app.AP_PAY_REQ_H_ID.getValue(),AUDIT_STATUS:'R',AUDIT_STATUS_DESC:'{#withdraw#}',SYS_AUDIT_STATUS:'A',SYS_AUDIT_STATUS_DESC:'{#draft#}'}\n            });\n            Wb.toast(e.msg);\n          }\n          else if(e.flag === '1'){\n              Wb.toast(e.msg);\n          }\n\t});\n}"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"layout":"border","itemId":"viewport1"},"children":[{"configs":{"region":"center","tbar":"app.form1Tbar","border":"false","itemId":"form1"},"children":[{"configs":{"style":"fontSize:30px","html":"<font style=\"\">{#title#}<\/font>","margin":"10 0 20 0","labelAlign":"center","itemId":"title"},"children":[],"expanded":false,"type":"label"},{"configs":{"layout":"column","border":"false","itemId":"tr1"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_1_1"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/LEDGER_ID_PICK/LEDGER_ID_PICK_SEC","itemId":"LEDGER_ID_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_1_2"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","allowBlank":"false","pickList":"[['CGJS','{#cgjs#}'],['YUFK','{#yufk#}'],['QTFK','{#qtfk#}']]","labelAlign":"right","itemId":"AP_DOC_CAT_CODE","fieldLabel":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#docCatCode#}"},"children":[],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_1_3"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"AP_PAY_REQ_H_CODE","fieldLabel":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#payReqCode#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_1_4"},"children":[{"configs":{"labelWidth":"80","allowBlank":"false","labelAlign":"right","itemId":"BIZ_DATE","fieldLabel":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#bizDate#}"},"children":[],"expanded":false,"type":"date"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"layout":"column","border":"false","itemId":"tr2"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_2_1"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/VENDOR_ID_PICK/VENDOR_ID_LD","itemId":"VENDOR_ID_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_2_2"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/DEPT_ID_PICK/DEPT_ID_LD","itemId":"DEPT_ID_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_1_3"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/PROJECT_ID_PICK/PROJECT_ID_LD","itemId":"PROJECT_ID_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_2_4"},"children":[{"configs":{"file":"m?xwl=xc/ap/ap-com-lov/AP_CONTRACT_ID_PICK/AP_CONTRACT_ID_PICK_ALL","itemId":"AP_CONTRACT_ID_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"layout":"column","border":"false","itemId":"tr3"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_3_1"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","fieldStyle":"direction:rtl;","labelAlign":"right","itemId":"AMOUNT","fieldLabel":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#applyAmount#}"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".490","itemId":"td_3_2"},"children":[{"configs":{"labelWidth":"80","allowBlank":"false","labelAlign":"right","itemId":"DESCRIPTION","fieldLabel":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#description#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"title":"供应商信息","itemId":"fieldset2"},"children":[{"configs":{"height":"35","layout":"column","border":"false","itemId":"tr5"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_5_1"},"children":[{"configs":{"file":"m?xwl=xc/ap/ap-com-lov/ACCOUNT_NAME_PICK/ACCOUNT_NAME_ALL","itemId":"ACCOUNT_NAME_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_5_2"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"DEPOSIT_BANK_NAME","fieldLabel":"{#bank#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_5_3"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"BANK_ACCOUNT","fieldLabel":"{#bankAccount#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"fieldset"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"column","border":"false","itemId":"tr6"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_8_1"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"CREATED_BY_NAME","fieldLabel":"{#creatByName#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_8_2"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"SYS_AUDIT_STATUS_DESC","fieldLabel":"{#status#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_8_3"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"IS_CLOSE_NAME","fieldLabel":"{#isClose#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"hidden":"true","itemId":"hidden_p"},"children":[{"configs":{"hidden":"true","itemId":"AP_PAY_REQ_H_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"AUDIT_STATUS"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"SYS_AUDIT_STATUS"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"INS_CODE"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","value":"{#XIP.userId#}","itemId":"USER_ID","fieldLabel":"USER_ID"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":false,"type":"form"},{"configs":{"region":"south","pagingBar":"false","height":"280","hidden":"true","itemId":"grid2","editable":"true"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/ap/req/DB/XC_AP_PAY_REQ_L_SELECT"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"{#add#}","itemId":"purTypeBtn"},"events":{"click":"//Wb.addEdit(app.grid2,{AP_PAY_REQ_L_ID:Xip.getId(),AP_PAY_REQ_H_ID:app.AP_PAY_REQ_H_ID.getValue()});\n\nvar payReqHId = app.AP_PAY_REQ_H_ID.getValue();\nvar ledgerId = app.LEDGER_ID_XWL.LEDGER_ID.getValue();\nif(Wb.isEmpty(ledgerId)){\n\tWb.toast('{#addMsg1#}');\n    return false;\n}\nvar curGrid = app.grid2;\nWb.run({\n  url: 'm?xwl=xc/ap/req/LOV/LOV_XC_AP_PUR_TYPE', \n  success: function(app) {\n    app.initWin({\n        AP_DOC_CAT_CODE:'',\n        LEDGER_ID:ledgerId,\n        hideFun:function(rs){\n              Wb.each(rs, function(r) {\n                r.set('AP_PAY_REQ_L_ID',Xip.getId());\n                r.set('AP_PAY_REQ_H_ID',payReqHId);\n                var grid1Store = curGrid.getStore();\n                for(var i=0;i<grid1Store.getCount();i++){\n                  var gr = grid1Store.getAt(i);\n                  if(gr.get('AP_PUR_TYPE_ID')==r.get('AP_PUR_TYPE_ID')){\n                    return false;\n                  }\n                }\n                Wb.add(curGrid, {\n                  AP_PAY_REQ_L_ID:r.get('AP_PAY_REQ_L_ID'),\n                  AP_PAY_REQ_H_ID:r.get('AP_PAY_REQ_H_ID'),\n                  AP_INV_GL_H_ID:r.get('AP_INV_GL_H_ID'),\n                  AP_INV_GL_H_CODE:r.get('AP_INV_GL_H_CODE'),\n                  AP_CONTRACT_ID:r.get('AP_CONTRACT_ID'),\n                  AP_CONTRACT_NAME:r.get('AP_CONTRACT_NAME'),\n                  AP_PUR_TYPE_ID:r.get('AP_PUR_TYPE_ID'),\n                  AP_PUR_TYPE_NAME:r.get('AP_PUR_TYPE_NAME'),\n                  BG_ITEM_ID:r.get('BG_ITEM_ID'),\n                  BG_ITEM_NAME:r.get('BG_ITEM_NAME'),\n                  DEPT_ID:r.get('DEPT_ID'),\n                  DEPT_NAME:r.get('DEPT_NAME'),\n                  PROJECT_ID:r.get('PROJECT_ID'),\n                  PROJECT_NAME:r.get('PROJECT_NAME'),\n                  AMOUNT:r.get('PAY_AMT'),\n                  DESCRIPTION:r.get('DESCRIPTION')\n                }, 'after', 1, false);\n              });\n        }\n    });\n  }\n});\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"删除","itemId":"delBtn"},"events":{"click":"Ext.Msg.confirm('{#deleteMsg4#}', '{#deleteMsg5#}', function (button) {\n    if (button == \"yes\") {\n      Wb.remove(app.grid2);\n      Wb.sync({\n            grid: app.grid2,\n            url: 'm?xwl=xc/ap/req/DB/XC_AP_PAY_REQ_L_SAVE',\n            message: '{#saveMsg4#}',\n            success: function(resp) {\n              Wb.toast('{#deleteMsg6#}',true);\n            }\n          });\n    }\n});"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"付款申请行ID","hidden":"true","dataIndex":"AP_PAY_REQ_L_ID","titleAlign":"center","itemId":"AP_PAY_REQ_L_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"付款申请主ID","hidden":"true","dataIndex":"AP_PAY_REQ_H_ID","itemId":"AP_PAY_REQ_H_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"采购类型ID","hidden":"true","dataIndex":"AP_PUR_TYPE_ID","itemId":"AP_PUR_TYPE_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"预算项目ID","hidden":"true","dataIndex":"BG_ITEM_ID","itemId":"BG_ITEM_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#purchaseType#}","dataIndex":"AP_PUR_TYPE_NAME","titleAlign":"center","itemId":"AP_PUR_TYPE_NAME_COL","flex":"2"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#budget#}","dataIndex":"BG_ITEM_NAME","titleAlign":"center","itemId":"BG_ITEM_NAME_COL","flex":"3"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#applyAmount#}","align":"right","dataIndex":"AMOUNT","titleAlign":"center","itemId":"AMOUNT_COL","renderer":"return Wb.format(value,'0,000.00');","flex":"1"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"<span style=\"color: rgb(255, 0, 0);\"><\/span>{#description#}","dataIndex":"DESCRIPTION","titleAlign":"center","itemId":"DESCRIPTION_COL","flex":"3"},"children":[{"configs":{"itemId":"editor"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"column"}],"expanded":true,"type":"array"}],"expanded":false,"type":"grid"},{"configs":{"region":"south","pagingBar":"false","height":"280","hidden":"true","itemId":"grid1","editable":"true"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/ap/req/DB/XC_AP_PAY_REQ_L_SELECT"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"{#add#}","itemId":"inqGlBtn"},"events":{"click":"//Wb.addEdit(app.grid1,{AP_PAY_REQ_L_ID:Xip.getId(),AP_PAY_REQ_H_ID:app.AP_PAY_REQ_H_ID.getValue()});\n\nvar payReqHId = app.AP_PAY_REQ_H_ID.getValue();\nvar ledgerId = app.LEDGER_ID_XWL.LEDGER_ID.getValue();\nvar vendorId = app.VENDOR_ID_XWL.VENDOR_ID.getValue();\nvar contractId = app.AP_CONTRACT_ID_XWL.AP_CONTRACT_ID.getValue();//合同为非必填条件\nvar deptId = app.DEPT_ID_XWL.DEPT_ID.getValue();//部门\nif(Wb.isEmpty(ledgerId)){\n\tWb.toast('{#addMsg1#}');\n    return false;\n}\nif(Wb.isEmpty(vendorId)){\n\tWb.toast('{#addMsg2#}');\n    return false;\n}\nif(Wb.isEmpty(deptId)){\n\tWb.toast('{#addMsg4#}');\n    return false;\n}\nvar curGrid = app.grid1;\nWb.run({\n  url: 'm?xwl=xc/ap/req/LOV/LOV_XC_AP_INV_GL_H', \n  success: function(app) {\n    app.initWin({\n        AP_DOC_CAT_CODE:'',\n        LEDGER_ID:ledgerId,\n        VENDOR_ID:vendorId,\n        CONTRACT_ID:contractId,\n      \tDEPT_ID:deptId,\n        hideFun:function(rs){\n              Wb.each(rs, function(r) {\n                r.set('AP_PAY_REQ_L_ID',Xip.getId());\n                r.set('AP_PAY_REQ_H_ID',payReqHId);\n                var grid1Store = curGrid.getStore();\n                for(var i=0;i<grid1Store.getCount();i++){\n                  var gr = grid1Store.getAt(i);\n                  if(gr.get('AP_INV_GL_H_ID')==r.get('AP_INV_GL_H_ID')){\n                    Wb.toast('{#addMsg3#}');\n                    return false;\n                  }\n                }\n                Wb.add(curGrid, {\n                  AP_PAY_REQ_L_ID:r.get('AP_PAY_REQ_L_ID'),\n                  AP_PAY_REQ_H_ID:r.get('AP_PAY_REQ_H_ID'),\n                  AP_INV_GL_H_ID:r.get('AP_INV_GL_H_ID'),\n                  AP_INV_GL_H_CODE:r.get('AP_INV_GL_H_CODE'),\n                  AP_CONTRACT_ID:r.get('AP_CONTRACT_ID'),\n                  AP_CONTRACT_NAME:r.get('AP_CONTRACT_NAME'),\n                  AP_PUR_TYPE_ID:r.get('AP_PUR_TYPE_ID'),\n                  AP_PUR_TYPE_NAME:r.get('AP_PUR_TYPE_NAME'),\n                  BG_ITEM_ID:r.get('BG_ITEM_ID'),\n                  BG_ITEM_NAME:r.get('BG_ITEM_NAME'),\n                  DEPT_ID:r.get('DEPT_ID'),\n                  DEPT_NAME:r.get('DEPT_NAME'),\n                  PROJECT_ID:r.get('PROJECT_ID'),\n                  PROJECT_NAME:r.get('PROJECT_NAME'),\n                  AMOUNT:r.get('PAY_AMT'),//行申请金额\n                  PAID_AMT:0,//已付款金额\n                  NO_PAY_AMT:r.get('PAY_AMT'),//未付款金额\n                  DESCRIPTION:r.get('DESCRIPTION')\n                }, 'after', 1, false);\n              });\n        }\n    });\n  }\n});\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"删除","itemId":"delBtn"},"events":{"click":"Ext.Msg.confirm('{#deleteMsg4#}', '{#deleteMsg5#}', function (button) {\n    if (button == \"yes\") {\n      Wb.remove(app.grid1);\n      Wb.sync({\n            grid: app.grid1,\n            url: 'm?xwl=xc/ap/req/DB/XC_AP_PAY_REQ_L_SAVE',\n            message: '{#saveMsg4#}',\n            success: function(resp) {\n              Wb.toast('{#deleteMsg6#}',true);\n            }\n          });\n    }\n});"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"付款申请行ID","hidden":"true","dataIndex":"AP_PAY_REQ_L_ID","itemId":"AP_PAY_REQ_L_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"付款申请主ID","hidden":"true","dataIndex":"AP_PAY_REQ_H_ID","itemId":"AP_PAY_REQ_H_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"应付单ID","hidden":"true","dataIndex":"AP_INV_GL_H_ID","itemId":"AP_INV_GL_H_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"合同ID","hidden":"true","dataIndex":"AP_CONTRACT_ID","itemId":"AP_CONTRACT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#invCode#}","width":"300","dataIndex":"AP_INV_GL_H_CODE","titleAlign":"center","itemId":"AP_INV_GL_H_CODE_COL","renderer":"metaData.style='background-color:#ffffd0';\nreturn value;","flex":"1"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#contractName#}","dataIndex":"AP_CONTRACT_NAME","titleAlign":"center","itemId":"AP_CONTRACT_NAME_COL","flex":"2"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#deptName#}","dataIndex":"DEPT_NAME","titleAlign":"center","itemId":"DEPT_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#projectName#}","dataIndex":"PROJECT_NAME","titleAlign":"center","itemId":"PROJECT_NAME_COL","flex":"2"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#applyAmount#}","align":"right","dataIndex":"AMOUNT","titleAlign":"center","itemId":"AMOUNT_COL","renderer":"return Wb.format(value,'0,000.00');"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"<span style=\"color: rgb(255, 0, 0);\"><\/span>{#description#}","dataIndex":"DESCRIPTION","titleAlign":"center","itemId":"DESCRIPTION_COL","renderer":"metaData.style='background-color:#ffffd0';\nreturn value;","flex":"3"},"children":[{"configs":{"itemId":"editor"},"children":[],"expanded":false,"type":"textarea"}],"expanded":true,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}