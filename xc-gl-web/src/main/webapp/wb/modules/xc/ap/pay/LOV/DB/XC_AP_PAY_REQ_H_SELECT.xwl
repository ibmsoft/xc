{"inframe":false,"title":"","hidden":false,"roles":{"default":1},"children":[{"configs":{"serverScript":"//   LEDGER_ID : Wb.ledger_id,\n//   VENDOR_ID : Wb.vendor_id,\n//   AP_CONTRACT_ID : Wb.ap_contract_id,\n//   AP_DOC_CAT_CODE : Wb.ap_doc_cat_code,\n//   PROJECT_ID : Wb.project_id,\n//   AP_PAY_REQ_H_CODE : app.AP_PAY_REQ_H_CODE.getValue(),\n//   CREATED_BY_NAME : app.CREATED_BY_NAME.getValue()\n\nvar data = app.get();\nvar sql = \"\";\n\n//单据类型\nif(data.AP_DOC_CAT_CODE == 'FKD_YUFK'){\n  sql += \" AND h.AP_DOC_CAT_CODE = 'YUFK'\";\n}else if(data.AP_DOC_CAT_CODE == 'FKD_CGJS'){\n  sql += \" AND h.AP_DOC_CAT_CODE = 'CGJS'\";\n}else if(data.AP_DOC_CAT_CODE == 'FKD_QTFK'){\n  sql += \" AND h.AP_DOC_CAT_CODE = 'QTFK'\";\n}\n\n//合同\nif(Wb.isEmpty(data.AP_CONTRACT_ID)){\n  sql += \" AND (h.AP_CONTRACT_ID is null or h.AP_CONTRACT_ID = '')\";\n}else{\n  sql += \" AND h.AP_CONTRACT_ID = '\"+data.AP_CONTRACT_ID+\"'\";\n}\n//项目\nif(!Wb.isEmpty(data.PROJECT_ID)){\n  sql += \" and h.PROJECT_ID = '\"+data.PROJECT_ID+\"'\";\n}\n\nif (!Wb.isEmpty(data.AP_PAY_REQ_H_CODE)) {\n    sql+=' and (h.AP_PAY_REQ_H_CODE like \\'%'+data.AP_PAY_REQ_H_CODE+'%\\' ';\n    sql+=' or h.DESCRIPTION like \\'%'+data.AP_PAY_REQ_H_CODE+'%\\' )';\n}\nif (!Wb.isEmpty(data.CREATED_BY_NAME)) {\n  sql+=' and CREATED_BY_NAME like \\'%'+data.CREATED_BY_NAME+'%\\' ';\n}\n\n\nrequest.setAttribute('sql', sql);","itemId":"module"},"children":[{"configs":{"oracle":"SELECT \n  h.AP_PAY_REQ_H_ID,\n  h.AP_PAY_REQ_H_CODE,\n  h.AP_DOC_CAT_CODE,\n  h.LEDGER_ID,\n  h.BIZ_DATE,\n  h.VENDOR_ID,\n  h.PROJECT_ID,\n  project.PROJECT_NAME,\n  h.DEPT_ID,\n  h.AP_CONTRACT_ID,\n  NVL(h.AMOUNT,0) AS AMOUNT,\n  NVL(h.PAID_AMT,0) AS PAID_AMT,\n  NVL(h.NO_PAY_AMT,0) AS NO_PAY_AMT,\n  NVL(h.OCCUPY_AMT,0) AS OCCUPY_AMT,\n  h.PAY_TYPE,\n  h.ACCOUNT_NAME,\n  h.DEPOSIT_BANK_NAME,\n  h.BANK_ACCOUNT,\n  h.IS_CLOSE,\n  h.DESCRIPTION,\n  h.SYS_AUDIT_STATUS,\n  h.SYS_AUDIT_STATUS_DESC,\n  h.INS_CODE,\n  h.AUDIT_STATUS,\n  h.AUDIT_STATUS_DESC,\n  h.AUDIT_DATE,\n  h.CREATED_BY,\n  emp.EMP_NAME CREATED_BY_NAME,\n  l.AP_PAY_REQ_L_ID ,\n  l.AP_INV_GL_H_ID L_AP_INV_GL_H_ID,\n  l.AP_CONTRACT_ID L_AP_CONTRACT_ID,\n  l.AP_PUR_TYPE_ID L_AP_PUR_TYPE_ID,\n  l.BG_ITEM_ID L_BG_ITEM_ID,\n  l.AMOUNT L_AMOUNT,\n  l.PAID_AMT L_PAID_AMT,\n  l.NO_PAY_AMT L_NO_PAY_AMT,\n  l.DESCRIPTION L_DESCRIPTION,\n  inv.AP_INV_GL_H_CODE,\n  inv.DESCRIPTION INV_DESCRIPTION,\n  inv.AP_CONTRACT_ID INV_AP_CONTRACT_ID,\n  (SELECT AP_CONTRACT_NAME FROM xc_ap_contract WHERE AP_CONTRACT_ID = inv.AP_CONTRACT_ID) INV_AP_CONTRACT_NAME,\n  inv.DEPT_ID INV_DEPT_ID,\n  (SELECT DEPT_NAME FROM xip_pub_depts WHERE DEPT_ID = inv.DEPT_ID) INV_DEPT_NAME,\n  inv.PROJECT_ID INV_PROJECT_ID,\n  (SELECT PROJECT_NAME FROM xc_pm_projects WHERE PROJECT_ID = inv.PROJECT_ID) INV_PROJECT_NAME,\n  inv.AP_ACC_ID_DEBT INV_AP_ACC_ID_DEBT,\n  (SELECT ACC_NAME FROM xc_gl_accounts WHERE ACC_ID = inv.AP_ACC_ID_DEBT) INV_AP_ACC_NAME_DEBT\nFROM \n\txc_ap_pay_req_h h\n        LEFT JOIN xc_pm_projects project on project.PROJECT_ID = h.PROJECT_ID\n        LEFT JOIN xip_pub_emps emp on emp.EMP_ID = (select EMP_ID from xip_pub_users where USER_ID=h.CREATED_BY),\n\txc_ap_pay_req_l l\n\t\tLEFT JOIN xc_ap_inv_gl_h inv ON inv.AP_INV_GL_H_ID = l.AP_INV_GL_H_ID\nWHERE h.AP_PAY_REQ_H_ID = l.AP_PAY_REQ_H_ID\nAND  h.IS_CLOSE = 'N'\nAND  h.LEDGER_ID = {?varchar.LEDGER_ID?}\nAND  h.VENDOR_ID = {?varchar.VENDOR_ID?}\nAND  h.AUDIT_STATUS = 'E'\nAND  l.NO_PAY_AMT > 0\n{#sql#}\nORDER BY h.CREATION_DATE DESC","itemId":"sqlswitcher1","mysql":"SELECT \n  h.AP_PAY_REQ_H_ID,\n  h.AP_PAY_REQ_H_CODE,\n  h.AP_DOC_CAT_CODE,\n  h.LEDGER_ID,\n  h.BIZ_DATE,\n  h.VENDOR_ID,\n  h.PROJECT_ID,\n  project.PROJECT_NAME,\n  h.DEPT_ID,\n  h.AP_CONTRACT_ID,\n  IFNULL(h.AMOUNT,0) AS AMOUNT,\n  IFNULL(h.PAID_AMT,0) AS PAID_AMT,\n  IFNULL(h.NO_PAY_AMT,0) AS NO_PAY_AMT,\n  IFNULL(h.OCCUPY_AMT,0) AS OCCUPY_AMT,\n  h.PAY_TYPE,\n  h.ACCOUNT_NAME,\n  h.DEPOSIT_BANK_NAME,\n  h.BANK_ACCOUNT,\n  h.IS_CLOSE,\n  h.DESCRIPTION,\n  h.SYS_AUDIT_STATUS,\n  h.SYS_AUDIT_STATUS_DESC,\n  h.INS_CODE,\n  h.AUDIT_STATUS,\n  h.AUDIT_STATUS_DESC,\n  h.AUDIT_DATE,\n  h.CREATED_BY,\n  emp.EMP_NAME CREATED_BY_NAME,\n  l.AP_PAY_REQ_L_ID ,\n  l.AP_INV_GL_H_ID L_AP_INV_GL_H_ID,\n  l.AP_CONTRACT_ID L_AP_CONTRACT_ID,\n  l.AP_PUR_TYPE_ID L_AP_PUR_TYPE_ID,\n  l.BG_ITEM_ID L_BG_ITEM_ID,\n  l.AMOUNT L_AMOUNT,\n  l.PAID_AMT L_PAID_AMT,\n  l.NO_PAY_AMT L_NO_PAY_AMT,\n  l.DESCRIPTION L_DESCRIPTION,\n  inv.AP_INV_GL_H_CODE,\n  inv.DESCRIPTION INV_DESCRIPTION,\n  inv.AP_CONTRACT_ID INV_AP_CONTRACT_ID,\n  (SELECT AP_CONTRACT_NAME FROM xc_ap_contract WHERE AP_CONTRACT_ID = inv.AP_CONTRACT_ID) INV_AP_CONTRACT_NAME,\n  inv.DEPT_ID INV_DEPT_ID,\n  (SELECT DEPT_NAME FROM xip_pub_depts WHERE DEPT_ID = inv.DEPT_ID) INV_DEPT_NAME,\n  inv.PROJECT_ID INV_PROJECT_ID,\n  (SELECT PROJECT_NAME FROM xc_pm_projects WHERE PROJECT_ID = inv.PROJECT_ID) INV_PROJECT_NAME,\n  inv.AP_ACC_ID_DEBT INV_AP_ACC_ID_DEBT,\n  (SELECT ACC_NAME FROM xc_gl_accounts WHERE ACC_ID = inv.AP_ACC_ID_DEBT) INV_AP_ACC_NAME_DEBT\nFROM \n\txc_ap_pay_req_h h\n        LEFT JOIN xc_pm_projects project on project.PROJECT_ID = h.PROJECT_ID\n        LEFT JOIN xip_pub_emps emp on emp.EMP_ID = (select EMP_ID from xip_pub_users where USER_ID=h.CREATED_BY),\n\txc_ap_pay_req_l l\n\t\tLEFT JOIN xc_ap_inv_gl_h inv ON inv.AP_INV_GL_H_ID = l.AP_INV_GL_H_ID\nWHERE h.AP_PAY_REQ_H_ID = l.AP_PAY_REQ_H_ID\nAND  h.IS_CLOSE = 'N'\nAND  h.LEDGER_ID = {?varchar.LEDGER_ID?}\nAND  h.VENDOR_ID = {?varchar.VENDOR_ID?}\nAND  h.AUDIT_STATUS = 'E'\nAND  l.NO_PAY_AMT > 0\n{#sql#}\nORDER BY h.CREATION_DATE DESC"},"children":[],"expanded":false,"type":"sqlswitcher"},{"configs":{"sql":"{#sqlswitcher1#}","itemId":"dataprovider1"},"children":[],"expanded":false,"type":"dataprovider"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}