{"inframe":false,"title":"核销单查询","hidden":false,"roles":{"default":1},"children":[{"configs":{"serverScript":"// 获取模块语言对应的json文件\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xc/ap/cancel/XC_AP_CANCEL\");\n\nvar contextPath = request.getContextPath();\nrequest.setAttribute(\"contextPath\",contextPath);","itemId":"module"},"events":{"finalize":"function returnRowFn(r,type){\n  if(type==='xc_gl_ledgers'){\n    Wb.reload(app.grid1);\n  }\n}\nfunction clearOtherFn(type){\n  if(type=='xc_gl_ledgers'){\n  }\n}"},"children":[{"configs":{"itemId":"request"},"children":[{"configs":{"autoLoad":"true","itemId":"ldInitStore","url":"m?xwl=xc/com-lov/LEDGER_ID_PICK/DB/XC_GL_LEDGERS_SELECT_SEC"},"events":{"load":"app.LEDGER_XWL.LEDGER_ID.setValue(store.getAt(0).get('LEDGER_ID'));\napp.LEDGER_XWL.LEDGER_NAME.setValue(store.getAt(0).get('LEDGER_NAME'));\napp.grid1.getStore().load();"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"folder"},{"configs":{"layout":"border","border":"false","itemId":"viewport1"},"children":[{"configs":{"region":"north","itemId":"form1"},"children":[{"configs":{"layout":"column","margin":"10 10 10 0","border":"false","itemId":"tr_1"},"children":[{"configs":{"layout":"fit","columnWidth":".25","border":"false","itemId":"td_1_1"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/LEDGER_ID_PICK/LEDGER_ID_PICK_SEC","itemId":"LEDGER_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".25","border":"false","itemId":"td_1_2"},"children":[{"configs":{"labelWidth":"80","pickList":"[\n  ['YFHYUF','{#YFHYUF#}'],\n  ['YFHYS','{#YFHYS#}'],\n  ['YFHLDC','{#YFHLDC#}'],\n  ['YUFHLDC','{#YUFHLDC#}']\n]","labelAlign":"right","itemId":"AP_CANCEL_TYPE","fieldLabel":"{#AP_CANCEL_TYPE#}"},"events":{"select":"app.queryBtn.fireEvent(\"click\");\n","specialkey":"if(Ext.EventObject.getKey()==13){\n    app.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".25","border":"false","itemId":"td_1_3"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"VENDOR_NAME","fieldLabel":"{#VENDOR#}"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n    app.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".25","border":"false","itemId":"td_1_4"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"DESCRIPTION","fieldLabel":"{#DESCRIPTION#}"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n    app.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"layout":"column","margin":"10 10 10 0","border":"false","itemId":"tr_2"},"children":[{"configs":{"tagConfigs":"{\n  baseCls:'my-panel-no-border'\n\n}","layout":"column","columnWidth":".25","border":"false","itemId":"td_2_1"},"children":[{"configs":{"text":"{#CANCEL_AMT#}：","width":"80","margin":"3 5 0 0","labelAlign":"right","itemId":"label11"},"children":[],"expanded":false,"type":"label"},{"configs":{"tagConfigs":"{\n  columnWidth : .5\n}","itemId":"SRC_AMT_START"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n    app.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"number"},{"configs":{"text":"-","width":"10","labelAlign":"center","itemId":"label1"},"children":[],"expanded":false,"type":"label"},{"configs":{"tagConfigs":"{\n  columnWidth : .5\n}","labelWidth":"70","labelAlign":"right","itemId":"SRC_AMT_END","fieldLabel":"{#SRC_AMT_END#}"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n    app.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"{\n  baseCls:'my-panel-no-border'\n\n}","layout":"column","columnWidth":".25","itemId":"td_2_2","border":"false"},"children":[{"configs":{"text":"{#BUSINESS_DATE#}：","width":"80","margin":"3 5 0 0","labelAlign":"right","itemId":"label11"},"children":[],"expanded":false,"type":"label"},{"configs":{"tagConfigs":"{\n  columnWidth : .5\n}","itemId":"GL_DATE_START","editable":"false"},"events":{"select":"app.queryBtn.fireEvent('click');","specialkey":"if(Ext.EventObject.getKey()==13){\n    app.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"date"},{"configs":{"text":"-","width":"10","labelAlign":"center","itemId":"label1"},"children":[],"expanded":false,"type":"label"},{"configs":{"tagConfigs":"{\n  columnWidth : .5\n}","labelWidth":"70","labelAlign":"right","itemId":"GL_DATE_END","editable":"false"},"events":{"select":"app.queryBtn.fireEvent('click');","specialkey":"if(Ext.EventObject.getKey()==13){\n    app.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"date"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"{\n  baseCls:'my-panel-no-border'\n\n}","layout":"fit","columnWidth":".25","border":"false","itemId":"td_2_3"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"CREATED_BY_NAME","fieldLabel":"{#ORIGINATOR#}"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n    app.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"layout":"column","columnWidth":".25","border":"false","itemId":"td_2_4"},"children":[{"configs":{"width":"85","itemId":"空格"},"children":[],"expanded":false,"type":"label"},{"configs":{"text":"{#QUERY#}","itemId":"queryBtn","iconCls":"seek_icon"},"events":{"click":"Wb.reload(app.grid1);"},"children":[],"expanded":false,"type":"button"},{"configs":{"width":"20","itemId":"空格1"},"children":[],"expanded":false,"type":"label"},{"configs":{"text":"{#RESET#}","itemId":"clearBtn","iconCls":"refresh_icon"},"events":{"click":"app.form1.getForm().reset();\napp.queryBtn.fireEvent('click');"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"panel"}],"expanded":false,"type":"panel"}],"expanded":false,"type":"form"},{"configs":{"region":"center","selType":"checkboxmodel","itemId":"grid1"},"events":{"itemdblclick":"app.ModifyBtn.fireEvent('click');"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/ap/cancel/DB/XC_AP_CANCEL_H_SELECT"},"events":{"beforeload":"operation.params = Wb.getValue(app.form1);"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"{#ADD#}","itemId":"AddBtn","iconCls":"file_add_icon"},"children":[{"configs":{"text":"{#YFHYUF#}","itemId":"YFHYUFBtn","iconCls":"file_add_icon"},"events":{"click":"var curGrid = app.grid1;\nWb.run({\n  url: 'm?xwl=xc/ap/cancel/XC_AP_CANCEL_H_NO_C', \n  success: function(app) {\n    app.initWin({\n\t\tAP_CANCEL_H_ID:'',\n        IS_INSERT:'Y',\n        AP_CANCEL_TYPE:'YFHYUF',\n        hideFun:function(){\n          Wb.reload(curGrid.store);\n        }\n    });\n  }\n});"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#YFHYS#}","itemId":"YFHYSBtn","iconCls":"file_add_icon"},"events":{"click":"var curGrid = app.grid1;\nWb.run({\n  url: 'm?xwl=xc/ap/cancel/XC_AP_CANCEL_H_NO_C', \n  success: function(app) {\n    app.initWin({\n\t\tAP_CANCEL_H_ID:'',\n        IS_INSERT:'Y',\n        AP_CANCEL_TYPE:'YFHYS',\n        hideFun:function(){\n          Wb.reload(curGrid.store);\n        }\n    });\n  }\n});"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#YFHLDC#}","itemId":"YFHLDCBtn","iconCls":"file_add_icon"},"events":{"click":"var curGrid = app.grid1;\nWb.run({\n  url: 'm?xwl=xc/ap/cancel/XC_AP_CANCEL_H_NO_C', \n  success: function(app) {\n    app.initWin({\n\t\tAP_CANCEL_H_ID:'',\n        IS_INSERT:'Y',\n        AP_CANCEL_TYPE:'YFHLDC',\n        hideFun:function(){\n          Wb.reload(curGrid.store);\n        }\n    });\n  }\n});"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#YUFHLDC#}","itemId":"YUFHLDCBtn","iconCls":"file_add_icon"},"events":{"click":"var curGrid = app.grid1;\nWb.run({\n  url: 'm?xwl=xc/ap/cancel/XC_AP_CANCEL_H_NO_C', \n  success: function(app) {\n    app.initWin({\n\t\tAP_CANCEL_H_ID:'',\n        IS_INSERT:'Y',\n        AP_CANCEL_TYPE:'YUFHLDC',\n        hideFun:function(){\n          Wb.reload(curGrid.store);\n        }\n    });\n  }\n});"},"children":[],"expanded":false,"type":"item"}],"expanded":true,"type":"item"},{"configs":{"text":"{#MODIFY#}","itemId":"ModifyBtn","iconCls":"file_edit_icon"},"events":{"click":"var curGrid = app.grid1;\nvar rec = curGrid.getSelection();\nif (rec.length > 1 || rec.length === 0) {//大于一条或没选择会警告\n    Wb.toast(\"{#qxzytxyxgddj#}\");//请选择一条需要修改的单据！\n    return;\n}\nWb.run({\n  url: 'm?xwl=xc/ap/cancel/XC_AP_CANCEL_H_NO_C', \n  success: function(app) {\n    app.initWin({\n\t\tAP_CANCEL_H_ID:rec[0].data.AP_CANCEL_H_ID,\n        IS_INSERT:'N',\n        hideFun:function(){\n          Wb.reload(curGrid.store);\n        }\n    });\n  }\n});\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#DELETE#}","itemId":"delBtn","iconCls":"file_delete_icon"},"events":{"click":"var rows = app.grid1.getSelection();\nif(rows.length === 0){\n    Wb.toast(\"{#qxzxyscddj#}\");//请选择需要删除的单据!\n    return;\n}\n\n//验证是否可以删除操作在eclipse中进行\nWb.confirm(\"{#qdscsxzd#} \"+rows.length+\" {#tjlm#}\",function(){//确定删除所选择的 条记录吗？\n  Wb.request({\n    url:'{#contextPath#}/apCancelAction.do?method=deleteCancel',\n    params:{deleteRecs:Wb.getData(rows)},\n    success:function(resp){\n      var obj = Wb.decode(resp.responseText);\n      var msg = obj.msg;\n      app.grid1.store.load();\n      Wb.toast(msg);\n    }\n  });\n});\n\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#VERIFY#}","itemId":"verfyBtn","iconCls":"up_icon"},"events":{"click":"var rows = app.grid1.getSelection();\nif(rows.length === 0){\n    Wb.toast(\"{#qxzxyshddj#}\");//请选择需要审核的单据!\n    return;\n}\nelse{\n    //单据ID数组\n    var docArray = [];\n    var j = 0;//判断是否审核通过\n    Wb.each(rows,function(r){\n        var apId = r.data.AP_CANCEL_H_ID;//单据ID\n        var headId = r.data.V_HEAD_ID;//凭证头ID\n        if(r.data.V_STATUS !== '1'){\n            j++;\n        }\n        var paramJson = {'headId' : headId,'apId':apId,apCatCode:'HXD'} ;\n        docArray.push(paramJson) ;\n    });\n    if(j > 0){\n        Wb.toast('{#djyjshtg#}');//单据已经审核通过！\n        return;\n    }\n    Wb.request({\n        url: '{#contextPath#}'+'/apVoucherAction.do?method=checkVoucher',\n        params: Wb.apply({apInfo: docArray}),\n        success: function(resp) {\n            var record = Wb.decode(resp.responseText);\n            var msg = record.msg;\n            Wb.reload(app.grid1.store);\n            Wb.toast(msg);\n        }\n\t});\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#CANCEL_VERIFY#}","itemId":"cancelVerfyBtn","iconCls":"cancel_icon"},"events":{"click":"var rows = app.grid1.getSelection();\nif(rows.length === 0){\n    Wb.toast(\"{#qxzxyqxshddj#}\");//请选择需要取消审核的单据!\n    return;\n}\nelse{\n    //单据ID数组\n    var docArray = [];\n    var j = 0;//判断是否审核通过\n    Wb.each(rows,function(r){\n        var apId = r.data.AP_CANCEL_H_ID;//单据ID\n        var headId = r.data.V_HEAD_ID;//凭证头ID\n        if(r.data.V_STATUS !== '3'){\n            j++;\n        }\n        var paramJson = {'headId' : headId,'apId':apId,apCatCode:'HXD'} ;\n        docArray.push(paramJson) ;\n    });\n    if(j > 0){\n        Wb.toast('{#qxzyjshtgddj#}');//请选择已经审核通过的单据！\n        return;\n    }\n    Wb.request({\n        url: '{#contextPath#}'+'/apVoucherAction.do?method=cancelCheckVoucher',\n        params: Wb.apply({apInfo: docArray}),\n        success: function(resp) {\n            var record = Wb.decode(resp.responseText);\n            var msg = record.msg;\n            Wb.reload(app.grid1.store);\n            Wb.toast(msg);\n        }\n\t});\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#SEE#}","itemId":"seekBtn","iconCls":"seek_icon"},"events":{"click":"var curGrid = app.grid1;\nvar rec = curGrid.getSelection();\nif (rec.length > 1 || rec.length === 0) {//大于一条或没选择会警告\n    Wb.toast(\"{#qxzytxyckddj#}\");//请选择一条需要查看的单据!\n    return;\n}\nWb.run({\n  url: 'm?xwl=xc/ap/cancel/XC_AP_CANCEL_H_NO_C', \n  success: function(app) {\n    app.initWin({\n\t\tAP_CANCEL_H_ID:rec[0].data.AP_CANCEL_H_ID,\n        IS_INSERT:'S',\n        hideFun:function(){\n          Wb.reload(curGrid.store);\n        }\n    });\n  }\n});"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#SERIAL_NUMBER#}","align":"center","width":"50","xtype":"rownumberer","titleAlign":"center","itemId":"ROWNUM_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#AP_CANCEL_H_CODE1#}","width":"150","dataIndex":"AP_CANCEL_H_CODE","titleAlign":"center","itemId":"AP_CANCEL_H_CODE_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#AP_CANCEL_TYPE#}","width":"150","dataIndex":"AP_CANCEL_TYPE","titleAlign":"center","itemId":"AP_CANCEL_TYPE_COL","renderer":"if(value == \"YFHYUF\"){\n  return \"{#YFHYUF#}\";\n}else\nif(value == \"YFHYS\"){\n  return \"{#YFHYS#}\";\n}else\nif(value == \"YFHLDC\"){\n  return \"{#YFHLDC#}\";\n}else\nif(value == \"YUFHLDC\"){\n  return \"{#YUFHLDC#}\";\n}\n"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#BUSINESS_DATE#}","width":"100","dataIndex":"GL_DATE","titleAlign":"center","itemId":"GL_DATE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#VENDOR#}","width":"300","dataIndex":"VENDOR_NAME","titleAlign":"center","itemId":"VENDOR_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#CANCEL_AMT#}","align":"right","width":"80","dataIndex":"SRC_AMT","format":"0,000.00","titleAlign":"center","itemId":"SRC_AMT_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#ORIGINATOR#}","width":"100","dataIndex":"CREATED_BY_NAME","titleAlign":"center","itemId":"CREATED_BY_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#STATUS#}","width":"100","dataIndex":"V_STATUS","titleAlign":"center","itemId":"V_STATUS_COL","renderer":"if(value == \"1\"){\n  return \"{#CG#}\";\n}\nif(value == \"3\"){\n  return \"{#SHTG#}\";\n}"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#DESCRIPTION#}","width":"250","dataIndex":"DESCRIPTION","titleAlign":"center","itemId":"DESCRIPTION_COL"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}