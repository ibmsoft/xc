{"inframe":false,"title":"我的付款申请单","hidden":false,"roles":{"default":1},"children":[{"configs":{"serverScript":"var userId = request.getSession().getAttribute(\"XzSessionVars\").get('userId');\n\nvar protocol = request.getProtocol() ;\nvar ipAddr = request.getServerName();\nvar port = request.getServerPort() ;\nvar ctxPath = request.getContextPath() ;\n\nvar pp = protocol.substr(0,5) ;\nprotocol = (pp.indexOf(\"https\") == -1 ? \"http\" : \"https\") ;\n\nvar url = protocol + \"://\" + ipAddr +\":\" + port + ctxPath ;\n\nrequest.setAttribute('contextPath',ctxPath);\nrequest.setAttribute(\"userId\",userId);\nrequest.setAttribute(\"appIP\",url);\nvar appId = request.getSession().getAttribute(\"XzSessionVars\").get('appId');\nrequest.setAttribute(\"funId\",request.getParameter('funId'));\nrequest.setAttribute(\"appId\",request.getParameter('appId'));\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,'xc/ap/req/json/XC_AP_PAY_REQ_H_MY');","itemId":"module"},"events":{"finalize":"function returnRowFn(r,type){\n  if(type==='xc_gl_ledgers'){\n    Wb.reload(app.grid1);\n  }\n}\nfunction clearOtherFn(type){\n  if(type=='xc_gl_ledgers'){\n  }\n}"},"children":[{"configs":{"itemId":"request"},"children":[{"configs":{"autoLoad":"true","itemId":"ldInitStore","url":"m?xwl=xc/com-lov/LEDGER_ID_PICK/DB/XC_GL_LEDGERS_SELECT_SEC"},"events":{"load":"app.LEDGER_XWL.LEDGER_ID.setValue(store.getAt(0).get('LEDGER_ID'));\napp.LEDGER_XWL.LEDGER_NAME.setValue(store.getAt(0).get('LEDGER_NAME'));\napp.grid1.getStore().load();"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"folder"},{"configs":{"layout":"border","itemId":"viewport1"},"children":[{"configs":{"region":"north","buttonAlign":"center","itemId":"form1"},"children":[{"configs":{"layout":"column","margin":"10 0 0 0","border":"false","itemId":"tr1"},"children":[{"configs":{"layout":"form","columnWidth":".22","border":"false","itemId":"td_1_1"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/LEDGER_ID_PICK/LEDGER_ID_PICK_SEC","itemId":"LEDGER_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".22","border":"false","itemId":"td_1_2"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"VENDOR_NAME","fieldLabel":"{#vendorName#}"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n  app.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".22","border":"false","itemId":"td_1_3"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"AP_CONTRACT_NAME","fieldLabel":"{#contractName#}"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n  app.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"columnWidth":".34","border":"false","itemId":"td_1_4"},"children":[{"configs":{"layout":"column","padding":"0","border":"false","itemId":"tr_1_4_1"},"children":[{"configs":{"layout":"form","columnWidth":".55","padding":"0","border":"false","itemId":"tr_1_4_1_1"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","padding":"0","itemId":"AMOUNT_START","fieldLabel":"{#amount#}"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n  app.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".1","border":"false","itemId":"tr_1_4_1_2"},"children":[{"configs":{"text":"-","labelAlign":"center","itemId":"label1"},"children":[],"expanded":false,"type":"label"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".35","border":"false","itemId":"tr_1_4_1_3"},"children":[{"configs":{"labelWidth":"30","labelAlign":"right","itemId":"AMOUNT_END"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n  app.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":false,"type":"panel"}],"expanded":false,"type":"panel"},{"configs":{"layout":"column","margin":"10 0 0 0","border":"false","itemId":"tr2"},"children":[{"configs":{"layout":"form","columnWidth":".22","border":"false","itemId":"td_2_1"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"PROJECT_NAME","fieldLabel":"{#projectName#}"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n  app.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".22","border":"false","itemId":"td_2_2"},"children":[{"configs":{"labelWidth":"80","hidden":"true","value":"{#XIP.userId#}","labelAlign":"right","itemId":"CREATED_BY","fieldLabel":"{#creatByName#}"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"80","pickList":"[['Y','{#Y#}'],['N','{#N#}'],['ALL','{#ALL#}']]","labelAlign":"right","itemId":"IS_PAY_ALL","fieldLabel":"{#isPayAll#}"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n  app.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".22","border":"false","itemId":"td_2_3"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"DESCRIPTION","fieldLabel":"{#description#}"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n  app.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".34","border":"false","itemId":"td_2_4"},"children":[{"configs":{"layout":"column","border":"false","itemId":"tr_2_4_1"},"children":[{"configs":{"layout":"form","columnWidth":".55","border":"false","itemId":"td_2_4_1_1"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"BIZ_DATE_START","fieldLabel":"{#bizDate#}"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n  app.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"date"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".1","border":"false","itemId":"td_2_4_1_2"},"children":[{"configs":{"text":"-","labelAlign":"center","itemId":"label1"},"children":[],"expanded":false,"type":"label"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".35","border":"false","itemId":"td_2_4_1_3"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"BIZ_DATE_END"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n  app.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"date"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"layout":"column","margin":"10 0 10 0","border":"false","itemId":"tr3"},"children":[{"configs":{"layout":"form","columnWidth":".22","border":"false","itemId":"td_3_1"},"children":[{"configs":{"labelWidth":"80","displayField":"VAL_NAME","valueField":"VAL_CODE","pickList":"[['A','{#a#}'],['C','{#r#}'],['E','{#e#}'],['ALL','{#ALL#}']]","labelAlign":"right","itemId":"SYS_AUDIT_STATUS","fieldLabel":"{#status#}"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n  app.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":true,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".22","border":"false","itemId":"td_3_2"},"children":[{"configs":{"labelWidth":"80","hidden":"true","pickList":"[\n  ['A','起草'],\n  ['C','已回退'],\n  ['D','已驳回'],\n  ['E','审批通过'],\n  ['R','审批中'],\n]","labelAlign":"right","itemId":"AUDIT_STATUS","fieldLabel":"工作流状态"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n  app.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"combo"},{"configs":{"labelWidth":"80","pickList":"[\n  ['CGJS','{#cgjs#}'],\n  ['YUFK','{#yufk#}'],\n  ['QTFK','{#qtfk#}'],\n  ['ALL','{#ALL#}']\n]","labelAlign":"right","itemId":"AP_DOC_CAT_CODE","fieldLabel":"{#docCatCode#}"},"events":{"select":"//app.queryBtn.fireEvent('click');","specialkey":"if(Ext.EventObject.getKey()==13){\n    app.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".22","border":"false","itemId":"td_3_3"},"children":[{"configs":{"labelWidth":"80","value":"N","pickList":"[\n\t['Y','{#Y#}'],\n  \t['N','{#N#}'],\n  \t['ALL','{#ALL#}']\n]","labelAlign":"right","itemId":"IS_CLOSE","fieldLabel":"{#isClose#}"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n  app.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".34","border":"false","itemId":"td_3_4"},"children":[{"configs":{"layout":"column","border":"false","itemId":"tr_3_4_1"},"children":[{"configs":{"layout":"form","columnWidth":".10","border":"false","itemId":"td_3_4_1_1"},"children":[{"configs":{"itemId":"空格"},"children":[],"expanded":false,"type":"label"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".2","border":"false","itemId":"td_3_4_1_2"},"children":[{"configs":{"text":"{#query#}","itemId":"queryBtn","iconCls":"seek_icon"},"events":{"click":"Wb.reload(app.grid1);"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".2","border":"false","itemId":"td_3_4_1_3"},"children":[{"configs":{"text":"{#clear#}","itemId":"clearBtn","iconCls":"refresh_icon"},"events":{"click":"app.form1.getForm().reset();\napp.grid1.getStore().removeAll();"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":false,"type":"panel"}],"expanded":false,"type":"panel"}],"expanded":true,"type":"form"},{"configs":{"region":"center","selType":"checkboxmodel","itemId":"grid1"},"events":{"itemdblclick":"app.updbtn.fireEvent('click');"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/ap/req/DB/XC_AP_PAY_REQ_H_SELECT"},"events":{"beforeload":"operation.params = Wb.getValue(app.form1);"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"{#add#}","itemId":"addBtn","iconCls":"file_add_icon"},"children":[{"configs":{"text":"{#cgjs#}","itemId":"addCgjsBtn","iconCls":"file_add_icon"},"events":{"click":"var curGrid = app.grid1;\nWb.run({\n  url: 'm?xwl=xc/ap/req/XC_AP_PAY_REQ_H_NO_C', \n  success: function(app) {\n    app.initWin({\n\t\tUSER_SCORE_ID:'',\n        IS_INSERT:'Y',\n        AP_DOC_CAT_CODE:'CGJS',\n        hideFun:function(){\n          Wb.reload(curGrid.store);\n        }\n    });\n  }\n});\n"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#yufk#}","itemId":"addYfkBtn","iconCls":"file_add_icon"},"events":{"click":"var curGrid = app.grid1;\nWb.run({\n  url: 'm?xwl=xc/ap/req/XC_AP_PAY_REQ_H_NO_C', \n  success: function(app) {\n    app.initWin({\n\t\tUSER_SCORE_ID:'',\n        IS_INSERT:'Y',\n        AP_DOC_CAT_CODE:'YUFK',\n        hideFun:function(){\n          Wb.reload(curGrid.store);\n        }\n    });\n  }\n});\n"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#qtfk#}","itemId":"addQtfkBtn","iconCls":"file_add_icon"},"events":{"click":"var curGrid = app.grid1;\nWb.run({\n  url: 'm?xwl=xc/ap/req/XC_AP_PAY_REQ_H_NO_C', \n  success: function(app) {\n    app.initWin({\n\t\tUSER_SCORE_ID:'',\n        IS_INSERT:'Y',\n        AP_DOC_CAT_CODE:'QTFK',\n        hideFun:function(){\n          Wb.reload(curGrid.store);\n        }\n    });\n  }\n});"},"children":[],"expanded":false,"type":"item"}],"expanded":false,"type":"item"},{"configs":{"text":"{#edit#}","itemId":"updbtn","iconCls":"file_edit_icon"},"events":{"click":"var curGrid = app.grid1;\nvar r=curGrid.getSelectionModel().getSelection()[0];\nWb.run({\n  url: 'm?xwl=xc/ap/req/XC_AP_PAY_REQ_H_NO_C', \n  success: function(app) {\n    app.initWin({\n\t\tAP_PAY_REQ_H_ID:r.get('AP_PAY_REQ_H_ID'),\n        IS_INSERT:'N',\n        AP_DOC_CAT_CODE:r.get('AP_DOC_CAT_CODE'),\n        hideFun:function(){\n          Wb.reload(curGrid.store);\n        }\n    });\n  }\n});\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#delete#}","itemId":"delBtn","iconCls":"file_delete_icon"},"events":{"click":"var recs = app.grid1.getSelection();\nif (!recs.length) {\n  Wb.warn('{#deleteMsg1#}');\n  return;\n}\n\nvar ids = [];\nfor(var i=0;i<recs.length;i++){\n  if(recs[0].data.AUDIT_STATUS=='E'||recs[0].data.AUDIT_STATUS=='C'){\n    Wb.toast('{#deleteMsg5#}');\n    return;\n  }\n  var id = {'id':recs[0].data.AP_PAY_REQ_H_ID};\n  ids.push(id);\n}\nWb.confirm('{#deleteMsg2#}' + recs.length + '{#deleteMsg3#}', function() {\n  Wb.request({\n    url: '{#contextPath#}'+'/apPayReqCommonAction.do?method=delPayReq',\n    params:{'payReqHId':ids},\n    success: function(resp) {\n      var rec = Wb.decode(resp.responseText);\n      if(rec.flag=='0'){\n        Wb.toast('{#deleteMsg4#}');\n         Wb.remove(app.grid1, recs);\n      }else if(rec.flag=='1'){\n        Wb.toast(rec.msg);\n      }\n     \n    }\n  });\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#submit#}","itemId":"submitButton","iconCls":"check_icon"},"events":{"click":"var rows = app.grid1.getSelection();//获得选中数据\nif (!rows.length) {//选中的数据条数\n  Wb.toast('{#submitMsg1#}');\n  return;\n}\nelse {\n  Wb.request({\n    url : 'm?xwl=xc/ap/req/DB/XC_AP_PAY_REQ_L_SELECT',\n    params : {AP_PAY_REQ_H_ID : rows[0].data.AP_PAY_REQ_H_ID},\n    success : function(resp){\n      if(Wb.decode(resp.responseText).total === 0 && rows[0].data.AP_DOC_CAT_CODE !== 'YUFK'){\n        Wb.toast(rows[0].data.AP_PAY_REQ_H_CODE+'{#submitMsg2#}');\n        return;\n      }\n      Wb.request({\n        url : '{#contextPath#}'+'/apPayReqCommonAction.do?method=getProcAndFormsByCat',\n        params : {'LEDGER_ID' : rows[0].data.LEDGER_ID,'AP_DOC_CAT_CODE' : rows[0].data.AP_DOC_CAT_CODE},\n        async:false,\n        success : function(resp){\n          var response = Wb.decode(resp.responseText) ;\n          if(response.flag == \"0\"){\n            // TODO: 取得流程编码、电脑端审批表单和移动端审批表单\n            var processCode = response.PROCESS_CODE ;\n            var pcApproveForm = response.PC_A_FORM_URL ;\n            var mobileApproveForm = response.M_A_FORM_URL ;\n\n            // 电脑端和移动端审批表单为变量需要设置为全路径\n            pcApproveForm = '{#appIP#}' +  '/'+pcApproveForm ;\n            mobileApproveForm = '{#appIP#}' +  mobileApproveForm ;\n            // TODO: 如果流程编码存在, 则提交流程审批处理\n            if(processCode !== \"\" && processCode !== null && processCode !== undefined){\n              // 如果项目未指定，则设置默认值为 \"-1\"\n              var prjId = rows[0].data.PROJECT_ID ;\n              if(prjId === null || prjId === \"\" || prjId === undefined){\n                prjId = \"-1\" ;\n              }\n              var orgId = '';\n              Wb.request({//查询组织ID\n                url:'m?xwl=xc/ap/req/DB/select-ld-org',\n                params:{'ledgerId':rows[0].data.LEDGER_ID},\n                async:false,\n                success:function(resp){\n                  var record = Wb.decode(resp.responseText);\n                  orgId = record.rows[0].ORG_ID;\n                }\n              });\n              if(orgId==''){\n                return;\n              }\n              var auditStatus = rows[0].data.AUDIT_STATUS;\n              var _empId = '{#XIP.empId#}' ;\n              var json = {\n                'APP_IP':'{#appIP#}',\n                'loginName':'{#XIP.userName#}',\n                'AP_DOC_CAT_NAME':rows[0].data.AP_DOC_CAT_NAME,\n                'PC_A_FORM':pcApproveForm,\n                'M_A_FORM'\t:mobileApproveForm,\n                'apCatCode':'FKSQD',\n                'DEPT_NAME':rows[0].data.DEPT_NAME,\n                'AMT':rows[0].data.AMOUNT,\n                'e_business_id':rows[0].data.AP_PAY_REQ_H_ID,\n                'billType'\t : rows[0].data.AP_DOC_CAT_CODE,\n                'PROJECT_ID'   : rows[0].data.PROJECT_ID,\n                'EMP_ID'       : _empId,\n                'ledgerId'     : rows[0].data.LEDGER_ID,\n                'DEPT_ID'      : rows[0].data.DEPT_ID,\n                'ORG_ID'\t\t : orgId\n              };\n              if(auditStatus === 'A'){//起草状态\n                XipWf.startAndSubmitByProcess(processCode,json,function(e){//提交流程\n                  if(e.flag === 0){\n                    app.queryBtn.fireEvent('click');\n                    Wb.toast('{#submitMsg3#}');\n                    app.grid1.getStore().reload();\n                  }\n                  else if(e.flag === 1){\n                    Wb.toast(e.msg) ;\n                  }else{}\n                });\n              }\n              else if(auditStatus === 'D'){//驳回状态\n                XipWf.submitInstance(rows[0].data.INS_CODE,json,function(e){//提交流程\n                  if(e.flag === 0){\n                    app.queryBtn.fireEvent('click');\n                    Wb.toast('{#submitMsg3#}');\n                    app.grid1.getStore().reload();\n                  }\n                  else if(e.flag === 1){\n                    Wb.toast(e.msg) ;\n                  }else{}\n                });\n              }else if(auditStatus === 'R'){//撤回状态\n                // 撤回 -> 按流程实例提交流程\n                XipWf.restartAndSubmitByProcess(rows[0].data.INS_CODE,processCode,json,function(e){\n                  if(e.flag === 0){\n                    //app.submitButton.setDisabled(true);\n                    Wb.toast('{#submitMsg4#}');\n                    app.grid1.getStore().reload();\n                  }\n                  else if(e.flag === 1){\n                    Wb.toast(e.msg) ;\n                  }else{}\n                },null);\n              }\n              else if(auditStatus === 'E' || auditStatus === 'C'){//运行中、结束状态\n                Wb.toast('{#submitMsg4#}');\n                return false;\n              }\n              else{\n                Wb.toast('{#submitMsg5#}');\n                return false;\n              }\n            }\n          }else{\n            Wb.toast('{#submitMsg5#}');\n            return false;\n          }\n        }\n      });\n    }\n  });\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#monitor#}","itemId":"monitorBtn","iconCls":"viewport_icon"},"events":{"click":"var rows = app.grid1.getSelection();\nif(rows.length != 1){\n\tWb.toast('{#monitorMsg1#}');\n}\nelse{\n    if(rows[0].data.INS_CODE === null || rows[0].data.INS_CODE === ''){\n        Wb.toast('{#monitorMsg2#}');\n\t}\n    else{\n        XipWf.showMonitorPage(rows[0].data.INS_CODE);\n    }   \n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#withdraw#}","itemId":"withdrawBtn","iconCls":"cancel_icon"},"events":{"click":"var rows=app.grid1.getSelection();\nif(rows.length != 1){\n\tWb.toast('{#withdrawMsg1#}');\n\treturn;\n}\nif(rows[0].data.INS_CODE === null || rows[0].data.INS_CODE === '') {\n\tWb.toast('{#withdrawMsg2#}');\n\treturn;\n}\nelse if(rows[0].data.AUDIT_STATUS === 'E') {\n\tWb.toast('{#withdrawMsg3#}');\n\treturn;\n}\nelse if(rows[0].data.AUDIT_STATUS === 'R'){\n    Wb.toast('{#withdrawMsg4#}');\n    return false;\n}else if(rows[0].data.AUDIT_STATUS === 'A'){\n    Wb.toast('{#withdrawMsg5#}');\n    return false;\n}else if(rows[0].data.AUDIT_STATUS === 'D'){\n    Wb.toast('{#withdrawMsg5#}');\n    return false;\n}\nelse {\n\t//撤回流程\n\tXipWf.revokeByInstance(rows[0].data.INS_CODE,function(e){\n     \n        if(e.flag === '0'){\n            Wb.request({\n                url : 'm?xwl=xc/ap/req/DB/saveAuditStatus',\n                params : {AP_PAY_REQ_H_ID:rows[0].data.AP_PAY_REQ_H_ID,AUDIT_STATUS:'R',AUDIT_STATUS_DESC:'{#withdraw#}',SYS_AUDIT_STATUS:'A',SYS_AUDIT_STATUS_DESC:'{#draft#}'},\n              \tsuccess:function(resp){\n                \tWb.toast(e.msg);\n        \t\t\tapp.grid1.getStore().reload();\n                }\n            });\n        }\n\t\t\n\t});\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#payments#}","itemId":"payListBtn"},"events":{"click":"var curGrid = app.grid1;\nvar rec = curGrid.getSelection();\nif (rec.length > 1 || rec.length === 0) {\n    Wb.toast('{#payMsg1#}');\n    return;\n}\nWb.run({\n  url: 'm?xwl=xc/ap/trans/XC_AP_REQ_TRANS_ALL', \n  success: function(app) {\n    app.initWin({\n      SOURCE_ID:rec[0].data.AP_PAY_REQ_H_ID,//来源id（付款申请id）\n      QUERY_FROM:'SQ'\n    });\n  }\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#close#}","itemId":"closeBtn","iconCls":"stop_icon"},"events":{"click":"var recs = app.grid1.getSelection();\nif (!recs.length) {\n  return;\n}\nvar rows = Wb.getData(recs);\nvar ids = [];\nvar isNext = true;\nfor(var i=0;i<rows.length;i++){\n   if(rows[i].IS_CLOSE=='Y'){\n    Wb.toast('{#closeMsg1#}');\n    isNext = false;\n    return;\n  }\n  if(rows[i].AUDIT_STATUS=='A'){\n    Wb.toast('{#closeMsg5#}');\n    isNext = false;\n    return;\n  }\n  var id = {'id':rows[i].AP_PAY_REQ_H_ID};\n  ids.push(id);\n}\nif(isNext){\n  \n  Ext.Msg.confirm('{#closeMsg2#}','{#closeMsg3#}' + recs.length + '{#closeMsg4#}', function(btn) {\n    if(btn=='yes'){\n      Wb.each(rows, function(row) {\n        row.IS_CLOSE = 'Y';\n      });\n      Wb.request({\n        url: '{#contextPath#}'+'/apPayReqCommonAction.do?method=closeDoc',\n        params: Wb.apply({\n          'ids': ids\n        }),\n        success: function() {\n          Wb.reload(app.grid1);\n        }\n      });\n    }\n\n  });\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#open#}","hidden":"true","itemId":"openBtn","iconCls":"run_icon"},"events":{"click":"var recs = app.grid1.getSelection();\nif (!recs.length) {\n  return;\n}\nvar rows = Wb.getData(recs);\nvar isNext = true;\nWb.each(rows, function(row) {\n  if(row.IS_CLOSE=='N'){\n    Wb.toast('{#openMsg3#}');\n    isNext = false;\n    return;\n  }\n});\nif(isNext){\n\n  Ext.Msg.confirm('{#closeMsg2#}','{#openMsg1#}' + recs.length + '{#openMsg2#}', function(btn) {\n    if(btn=='yes'){\n      Wb.each(rows, function(row) {\n        row.IS_CLOSE = 'N';\n      });\n      Wb.request({\n        url: 'm?xwl=xc/ap/req/DB/XC_AP_PAY_REQ_H_UPDATE_CLOSE',\n        params: Wb.apply({\n          closeRec: rows\n        }),\n        success: function() {\n          Wb.reload(app.grid1);\n        }\n      });\n    }\n\n  });\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#enclosure#}","itemId":"enclosureBtn","iconCls":"attach_icon"},"events":{"click":"var rows = app.grid1.getSelection();\nif(rows.length<1){\n  Wb.toast('{#enclosureMsg#}');\n}else{\n    var temp_id = rows[0].data.AP_PAY_REQ_H_ID;\n    var temp_code = rows[0].data.AP_DOC_CAT_CODE;\n  \tWb.request({\n    \turl : '{#contextPath#}'+'/apPayReqCommonAction.do?method=getProcAndFormsByCat',\n        params : {'LEDGER_ID' : rows[0].data.LEDGER_ID,'AP_DOC_CAT_CODE' : rows[0].data.AP_DOC_CAT_CODE},\n      \tsuccess:function(resp){\n          var rec = Wb.decode(resp.responseText);\n          if(rec.flag=='0'){\n            var attCatCode = rec.ATT_CAT_CODE;\n             Xip.showAttachmentManager('{#XIP.userId#}',temp_id,'',attCatCode,temp_code,'Y','Y','Y',function(){},2); \n          }\n        }\n    });\n   \n}"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#req_rowNum#}","align":"center","width":"50","xtype":"rownumberer","titleAlign":"center","itemId":"column1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#ledgerName#}","dataIndex":"LEDGER_NAME","titleAlign":"center","itemId":"LEDGER_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#payReqCode#}","width":"160","dataIndex":"AP_PAY_REQ_H_CODE","titleAlign":"center","itemId":"AP_PAY_REQ_H_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#payType#}","dataIndex":"AP_DOC_CAT_NAME","titleAlign":"center","itemId":"AP_DOC_CAT_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#payTypeCode#}","hidden":"true","dataIndex":"AP_DOC_CAT_CODE","titleAlign":"center","itemId":"AP_DOC_CAT_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#description#}","dataIndex":"DESCRIPTION","titleAlign":"center","itemId":"DESCRIPTION_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#vendorName#}","width":"200","dataIndex":"VENDOR_NAME","titleAlign":"center","itemId":"VENDOR_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#applyAmount#}","align":"right","dataIndex":"AMOUNT","titleAlign":"center","itemId":"AMOUNT_COL","renderer":"return Wb.format(value,'0,000.00');"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#paidAmt#}","align":"right","dataIndex":"PAID_AMT","titleAlign":"center","itemId":"PAID_AMT_COL","renderer":"return Wb.format(value,'0,000.00');"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#bizDate#}","dataIndex":"BIZ_DATE","titleAlign":"center","itemId":"BIZ_DATE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#contractName#}","dataIndex":"AP_CONTRACT_NAME","titleAlign":"center","itemId":"AP_CONTRACT_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#deptName#}","dataIndex":"DEPT_NAME","titleAlign":"center","itemId":"DEPT_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#projectName#}","dataIndex":"PROJECT_NAME","titleAlign":"center","itemId":"PROJECT_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#projectId#}","hidden":"true","dataIndex":"PROJECT_ID","titleAlign":"center","itemId":"PROJECT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#ledgerId#}","hidden":"true","dataIndex":"LEDGER_ID","titleAlign":"center","itemId":"LEDGER_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#deptId#}","hidden":"true","dataIndex":"DEPT_ID","titleAlign":"center","itemId":"DEPT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#creatByName#}","dataIndex":"CREATED_BY_NAME","titleAlign":"center","itemId":"CREATED_BY_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#appUserName#}","hidden":"true","dataIndex":"APP_USER_NAME","titleAlign":"center","itemId":"APP_USER_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#status#}","dataIndex":"SYS_AUDIT_STATUS_NAME","titleAlign":"center","itemId":"SYS_AUDIT_STATUS_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#isClose#}","dataIndex":"IS_CLOSE","titleAlign":"center","itemId":"IS_CLOSE_NAME_COL","renderer":"if(value==\"Y\")\n  return '{#Y#}';\nelse  \n  return '{#N#}';"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#isClose#}","hidden":"true","dataIndex":"IS_CLOSE","titleAlign":"center","itemId":"IS_CLOSE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#req_ins_code#}","hidden":"true","dataIndex":"INS_CODE","titleAlign":"center","itemId":"INS_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"AUDIT_STATUS","hidden":"true","dataIndex":"AUDIT_STATUS","titleAlign":"center","itemId":"AUDIT_STATUS_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"ID","hidden":"true","dataIndex":"AP_PAY_REQ_H_ID","titleAlign":"center","itemId":"AP_PAY_REQ_H_ID_COL"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}