{"inframe":false,"title":"采购发票查看","hidden":false,"roles":{"default":1},"children":[{"configs":{"jsLinks":"[\"platform/util/platformUtil.js\"]","serverScript":"//---------------------获取当前模块语言对应的.json文件，放到request中----------------\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xc/ap/inv/json/XC_AP_INVOICE_H_VIEW\");\nvar apInvHId = request.getParameter(\"businessId\");\nrequest.setAttribute(\"apInvHId\",apInvHId);\nrequest.setAttribute('opmode','view');","itemId":"module"},"events":{"finalize":"if('{#opType#}' === 'view'){\n    app.form1Tbar.show();\n}"},"children":[{"configs":{"hidden":"true","itemId":"form1Tbar"},"children":[{"configs":{"text":"流程监控","itemId":"monitorBtn","iconCls":"viewport_icon"},"events":{"click":"if(app.INS_CODE.getValue() === null || app.INS_CODE.getValue() === ''){\n    Wb.toast('该单据没有提交，不能监控！');\n}\nelse{\n    XipWf.showMonitorPage(app.INS_CODE.getValue());\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"退回发起人","itemId":"withdrawBtn","iconCls":"cancel_icon"},"events":{"click":"if(app.INS_CODE.getValue() === null || app.INS_CODE.getValue() === '') {\n\tWb.toast('该单据没有提交，不能撤回！');\n\treturn;\n}\nelse if(app.AUDIT_STATUS.getValue() === 'E') {\n\tWb.toast('流程已通过，不能撤回！');\n\treturn;\n}\nelse if(app.AUDIT_STATUS.getValue() === 'R'){\n    Wb.toast('流程已撤回！');\n    return;\n}\nelse {\n\t//撤回流程\n\tXipWf.revokeByInstance(app.INS_CODE.getValue(),function(e){\n        if(e.flag === '0'){\n            app.AUDIT_STATUS.setValue('A');\n            app.SYS_AUDIT_STATUS_DESC.setValue('草稿');\n            app.submitButton.setDisabled(false);\n            app.saveBtn.setDisabled(false);\n            Wb.request({\n                url : 'm?xwl=xc/ap/inv/DB/saveAuditStatus',\n                params : {AP_INV_H_ID:app.AP_INV_H_ID.getValue(),AUDIT_STATUS:'R',INS_CODE : app.INS_CODE.getValue(),AUDIT_STATUS_DESC:'{#XIP.empName#}'+'撤回',AUDIT_DATE : null,SYS_AUDIT_STATUS:'A',SYS_AUDIT_STATUS_DESC:'草稿'}\n            });\n            Wb.toast(e.msg);\n          }\n          else if(e.flag === '1'){\n              Wb.toast(e.msg);\n          }\n\t});\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"取消复核","itemId":"cancelPayBtn"},"events":{"click":"var ap_inv_h_id = app.AP_INV_H_ID.getValue();\nvar ledger_id = app.LEDGER_ID_XWL.LEDGER_ID.getValue();\nif(Wb.isInsert=='Y'){\n  Wb.toast('请先保存当前记录！');\n}else{\nWb.run({\n                    url: 'm?xwl=xc/ap/inv/LOV/LOV_XC_AP_INV_PRE', \n                    success: function(app) {\n                      \n                      app.initWin({\n                          AP_INV_H_ID:ap_inv_h_id,\n                          LEDGER_ID:ledger_id,\n                          hideFun:function(rs){\n                            Wb.each(rs, function(r) {\n                              \n                              \n                            });\n                            //Wb.reload(curGrid.store);\n                          }\n                      });\n                    }\n                  });\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"附件","itemId":"enclosureBtn","iconCls":"attach_icon"},"events":{"click":"var temp_id = app.AP_INV_H_ID.getValue();\nvar temp_code = app.AP_INV_H_CODE.getValue();\nXip.showAttachmentManager('{#XIP.userId#}',temp_id,'','AP_REC_DOCS',temp_code,'Y','Y','Y',function(){},2); \n"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"layout":"border","itemId":"viewport1"},"events":{"beforerender":"//采购发票ID 流程中传过来的\nvar apInvHId = '{#apInvHId#}';\n//根据采购发票ID得到采购单据类型\nWb.request({\n\turl : 'm?xwl=xc/ap/inv/DB/XC_AP_INVOICE_H_SELECT_BY_ID',\n    async : false,\n    params : {AP_INV_H_ID : apInvHId},\n    success : function(resp){\n        var data = Wb.decode(resp.responseText);\n        var docCatCode = data.AP_DOC_CAT_CODE;//单据类型编码\n        data.BIZ_DATE = Wb.strToDate(data.BIZ_DATE);\n        Wb.setValue(app.viewForm,data);\n        if(docCatCode == 'CGFP-CGDD-H' || docCatCode == 'CGFP-CGDD') {\n            app.grid1.hide();\n            app.grid2.show();\n        }\n        app.grid1.getStore().reload({params: {AP_INV_H_ID: apInvHId}});\n        app.grid2.getStore().reload({params: {AP_INV_H_ID: apInvHId}});\n\t}\n});"},"children":[{"configs":{"tbar":"app.form1Tbar","region":"north","autoScroll":"true","itemId":"viewForm","border":"false"},"children":[{"configs":{"style":"fontSize:20px","margin":"10 0 20 0","html":"<font style=\"\">采购发票<\/font>","labelAlign":"center","itemId":"title"},"children":[],"expanded":false,"type":"label"},{"configs":{"layout":"column","margin":"5 0 0 0","itemId":"tr1","border":"false"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_1_1"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"LEDGER_NAME","fieldLabel":"{#LEDGER_NAME#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_1_2"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","pickList":"[\n  ['CGFP','{#cgfp#}'],\n  ['CGFP-H','{#cgfpH#}'],\n  ['CGFP-CGDD','{#cgfpCgdd#}'],\n  ['CGFP-CGDD-H','{#cgfpCgddH#}']\n]","itemId":"AP_DOC_CAT_CODE","fieldLabel":"{#AP_DOC_CAT_CODE#}"},"events":{"change":"if(newValue=='CGFP'){\n\tapp.title.setText('{#cgfp#}',false);\n}\nif(newValue=='CGFP-H'){\n\tapp.title.setText('<font style=\"color:red;\">{#cgfpH#}<\/font>',false);\n    app.INV_AMOUNT.setFieldStyle('color:red;');\n    app.TAX_AMT.setFieldStyle('color:red;');\n}\nif(newValue=='CGFP-CGDD'){\n\tapp.title.setText('{#cgfpCgdd#}',false);\n}\nif(newValue=='CGFP-CGDD-H'){\n\tapp.title.setText('<font style=\"color:red;\">{#cgfpCgddH#}<\/font>',false);\n    app.INV_AMOUNT.setFieldStyle('color:red;');\n    app.TAX_AMT.setFieldStyle('color:red;');\n}"},"children":[],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_1_3"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","emptyText":"系统自动生成","labelAlign":"right","itemId":"AP_INV_H_CODE","fieldLabel":"{#AP_INV_H_CODE#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_1_4"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","allowBlank":"false","labelAlign":"right","itemId":"BIZ_DATE","fieldLabel":"{#BIZ_DATE#}"},"children":[],"expanded":false,"type":"date"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"layout":"column","margin":"5 0 0 0","itemId":"tr2","border":"false"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_2_1"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"VENDOR_NAME","fieldLabel":"{#VENDOR_NAME#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","hidden":"true","layout":"form","columnWidth":".245","itemId":"td_2_2"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"L_AP_INV_H_CODE","fieldLabel":"{#AP_INVOICE_H_CODE#}"},"events":{"change":"if(newValue !== null && newValue !== ''){\n  app.td_2_2.show();\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_1_3"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"DEPT_NAME","fieldLabel":"{#DEPT_NAME#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_2_4"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"PROJECT_NAME","fieldLabel":"{#PROJECT_NAME#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"layout":"column","margin":"5 0 0 0","itemId":"tr3","border":"false"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_3_1"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"AP_CONTRACT_NAME","fieldLabel":"{#AP_CONTRACT_NAME#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_3_2"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"INV_AMOUNT","fieldLabel":"{#INV_AMOUNT#}"},"children":[],"expanded":false,"type":"number"},{"configs":{"labelWidth":"80","readOnly":"true","hidden":"true","labelAlign":"right","itemId":"AMOUNT","fieldLabel":"{#AMOUNT#}"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_3_3"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"TAX_AMT","fieldLabel":"{#TAX_AMT#}"},"events":{"change":"if(newValue !== 0){\n\tapp.td_3_4.show();\n}\nif(newValue === 0 || newValue === null){\n\tapp.td_3_4.hide();\n}"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","hidden":"true","layout":"form","columnWidth":".245","itemId":"td_3_4"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","minValue":"0","labelAlign":"right","itemId":"TAX_RATE","allowDecimals":"false","fieldLabel":"{#TAX_RATE#}(%)"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"layout":"column","margin":"5 0 0 0","itemId":"tr4","border":"false"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".49","itemId":"td_4_1"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","allowBlank":"false","labelAlign":"right","itemId":"DESCRIPTION","fieldLabel":"{#DESCRIPTION#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_4_2"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"INV_NO","fieldLabel":"{#INV_NO#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_4_3"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"CANCEL_AMT","fieldLabel":"{#CANCEL_AMT#}"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"layout":"column","margin":"5 0 5 0","itemId":"tr5","border":"false"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_5_1"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","value":"{#XIP.empName#}","labelAlign":"right","itemId":"CREATED_BY_NAME","fieldLabel":"{#CREATED_BY_NAME#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_5_2"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"SIGN_USER_NAME","fieldLabel":"{#SIGN_USER_NAME#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_5_3"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"FIN_USER_NAME","fieldLabel":"{#FIN_USER_NAME#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_5_4"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"XC_AP_SYS_AUDIT_STATUS","fieldLabel":"{#SYS_AUDIT_STATUS_DESC#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"hidden":"true","itemId":"hidden_p"},"children":[{"configs":{"hidden":"true","itemId":"AP_INV_H_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"INS_CODE"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"AUDIT_STATUS"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","value":"{#XIP.userId#}","itemId":"USER_ID","fieldLabel":"USER_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"apDocCode","fieldLabel":"apDocCode"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"form"},{"configs":{"region":"center","pagingBar":"false","itemId":"grid1","editable":"true"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/ap/inv/DB/XC_AP_INVOICE_L_SELECT"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"<font color=\"red\">*<\/font>{#AP_PUR_TYPE_NAME#}","width":"150","dataIndex":"AP_PUR_TYPE_NAME","titleAlign":"center","itemId":"AP_PUR_TYPE_NAME_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#BG_ITEM_NAME#}","width":"150","dataIndex":"BG_ITEM_NAME","titleAlign":"center","itemId":"BG_ITEM_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"<font color=\"red\">*<\/font>{#AMOUNT#}","align":"right","width":"100","dataIndex":"AMOUNT","titleAlign":"center","format":"0,000.00","itemId":"AMOUNT_COL","renderer":"if (app.AP_DOC_CAT_CODE.getValue() == 'CGFP-H') {\n    value = '<font color=red>'+Wb.format(value,'0,000.00')+'<\/font>';\n}\nelse {\n    value = Wb.format(value,'0,000.00');\n}\nreturn value;"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#QTY#}","width":"80","align":"right","dataIndex":"QTY","titleAlign":"center","itemId":"QTY_COL","renderer":"if (app.AP_DOC_CAT_CODE.getValue() == 'CGFP-H') {\n    value = '<font color=red>'+value+'<\/font>';\n}\nelse {\n    value = value;\n}\nreturn value;"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#DIM_CODE#}","hidden":"true","dataIndex":"DIM_CODE","titleAlign":"center","itemId":"DIM_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"<font color=\"red\">*<\/font>{#DIM_NAME#}","width":"80","dataIndex":"DIM_NAME","titleAlign":"center","itemId":"DIM_NAME_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#DESCRIPTION#}","width":"300","dataIndex":"DESCRIPTION","titleAlign":"center","itemId":"DESCRIPTION_COL"},"children":[],"expanded":true,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"},{"configs":{"region":"center","pagingBar":"false","selType":"checkboxmodel","hidden":"true","itemId":"grid2","editable":"true"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/ap/inv/DB/XC_AP_INVOICE_L_SELECT"},"events":{"update":"isEditCol = 'Y';","remove":"isEditCol = 'Y';","add":"isEditCol = 'Y';"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#ORDER_H_CODE#}","width":"150","dataIndex":"ORDER_H_CODE","titleAlign":"center","itemId":"ORDER_H_CODE_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#ORDER_L_NUM#}","width":"100","dataIndex":"ORDER_L_NUM","titleAlign":"center","itemId":"ORDER_L_NUM_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#BG_ITEM_NAME#}","width":"150","dataIndex":"BG_ITEM_NAME","titleAlign":"center","itemId":"BG_ITEM_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#MATERIAL_CODE#}","width":"120","dataIndex":"MATERIAL_CODE","titleAlign":"center","itemId":"MATERIAL_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#MATERIAL_NAME#}","width":"120","dataIndex":"MATERIAL_NAME","titleAlign":"center","itemId":"MATERIAL_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#SPECIFICATION#}","width":"100","dataIndex":"SPECIFICATION","titleAlign":"center","itemId":"SPECIFICATION_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#AMOUNT#}","width":"100","align":"right","dataIndex":"AMOUNT","format":"0,000.00","titleAlign":"center","itemId":"AMOUNT_COL","renderer":"if (app.AP_DOC_CAT_CODE.getValue() == 'CGFP-CGDD-H') {\n    value = '<font color=red>'+Wb.format(value,'0,000.00')+'<\/font>';\n}\nelse {\n    value = Wb.format(value,'0,000.00');\n}\nreturn value;"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#QTY#}","align":"right","width":"80","dataIndex":"QTY","titleAlign":"center","itemId":"QTY_COL","renderer":"if (app.AP_DOC_CAT_CODE.getValue() == 'CGFP-CGDD-H') {\n    value = '<font color=red>'+value+'<\/font>';\n}\nelse {\n    value = value;\n}\nreturn value;"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#DIM_NAME#}","width":"80","dataIndex":"DIM_NAME","titleAlign":"center","itemId":"DIM_NAME_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#DESCRIPTION#}","width":"300","dataIndex":"DESCRIPTION","titleAlign":"center","itemId":"DESCRIPTION_COL"},"children":[],"expanded":true,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}