{"inframe":false,"title":"查询应付单","hidden":false,"roles":{"default":1},"children":[{"configs":{"serverScript":"/*\n核销单 \n核销类型：应付红蓝对冲\n过滤条件1（死）：账簿、供应商、单据类型-应付单蓝、余额大于0、审核通过\n过滤条件2（活）：应付单编码、制单人\n过滤条件3（待考虑，暂不实现）：来源单据的合同\n*/\nvar sql = '';\nvar data = app.get();\napp.info(Wb.encode(data));\napp.info(data.AP_CONTRACT_NAME);\nif (!Wb.isEmpty(data.AP_CONTRACT_NAME)) {\n  sql += \" AND (contract.AP_CONTRACT_CODE LIKE '%{#AP_CONTRACT_NAME#}%' OR contract.AP_CONTRACT_NAME LIKE '%{#AP_CONTRACT_NAME#}%')\";\n}\n// if (!Wb.isEmpty(data.CREATED_BY_NAME)) {\n//   sql+=' and CREATED_BY_NAME like \\'%'+data.CREATED_BY_NAME+'%\\' ';\n// }\n// if (!Wb.isEmpty(data.AP_INV_GL_H_CODE)) {\n//     sql+=' and (AP_INV_GL_H_CODE like \\'%'+data.AP_INV_GL_H_CODE+'%\\' ';\n//     sql+=' or DESCRIPTION like \\'%'+data.AP_INV_GL_H_CODE+'%\\' )';\n// }\nrequest.setAttribute('sql', sql);","itemId":"module"},"children":[{"configs":{"oracle":"SELECT\n\th.AP_INV_GL_H_ID,\n\th.AP_INV_GL_H_CODE,\n\th.GL_DATE,\n\th.DESCRIPTION,\n\tNVL(h.INV_AMOUNT,0) AS INV_AMOUNT,\n\tNVL(h.NO_PAY_AMT,0) AS NO_PAY_AMT,\n\th.AP_CONTRACT_ID,\n\th.DEPT_ID,\n\th.PROJECT_ID,\n\th.AP_ACC_ID_DEBT AS ACC_ID,\n\th.AP_CCID_DEBT AS CCID,\n\tcontract.AP_CONTRACT_NAME,\n\tdept.DEPT_NAME,\n\tproject.PROJECT_NAME,\n\taccount.ACC_NAME,\n\tccid.CCID_NAME,\n\temp.EMP_NAME AS CREATED_BY_NAME\nFROM\n\txc_ap_inv_gl_h h\n\t\tLEFT JOIN xc_gl_ledgers ledger ON ledger.LEDGER_ID = h.LEDGER_ID\n\t\tLEFT JOIN xc_pm_projects project ON project.PROJECT_ID = h.PROJECT_ID\n\t\tLEFT JOIN xip_pub_depts dept ON dept.DEPT_ID = h.DEPT_ID\n\t\tLEFT JOIN xc_ap_contract contract ON contract.AP_CONTRACT_ID = h.AP_CONTRACT_ID\n\t\tLEFT JOIN xc_gl_accounts account ON account.ACC_ID = h.AP_ACC_ID_DEBT\n\t\tLEFT JOIN xc_gl_ccid ccid ON ccid.CCID = h.AP_CCID_DEBT\n\t\tLEFT JOIN xip_pub_emps emp ON emp.EMP_ID = (SELECT EMP_ID FROM xip_pub_users WHERE USER_ID=h.CREATED_BY)\nWHERE \n\th.LEDGER_ID = {?LEDGER_ID?}\nAND h.VENDOR_ID = {?VENDOR_ID?}\nAND h.AP_DOC_CAT_CODE = 'YFD'\nAND h.NO_PAY_AMT > 0\nAND h.V_STATUS >= 3\nAND h.AP_INV_GL_H_CODE IS NOT NULL\nAND h.AP_INV_GL_H_CODE <> ''\n{#sql#}\nAND (h.AP_INV_GL_H_CODE LIKE '%{#AP_INV_GL_H_CODE#}%' OR h.DESCRIPTION LIKE '%{#AP_INV_GL_H_CODE#}%')\nAND emp.EMP_NAME LIKE '%{#CREATED_BY_NAME#}%'\n\nORDER BY \n\th.CREATION_DATE DESC","itemId":"sqlswitcher1","mysql":"SELECT\n\th.AP_INV_GL_H_ID,\n\th.AP_INV_GL_H_CODE,\n\th.GL_DATE,\n\th.DESCRIPTION,\n\tIFNULL(h.INV_AMOUNT,0) AS INV_AMOUNT,\n\tIFNULL(h.NO_PAY_AMT,0) AS NO_PAY_AMT,\n\th.AP_CONTRACT_ID,\n\th.DEPT_ID,\n\th.PROJECT_ID,\n\th.AP_ACC_ID_DEBT AS ACC_ID,\n\th.AP_CCID_DEBT AS CCID,\n\tcontract.AP_CONTRACT_NAME,\n\tdept.DEPT_NAME,\n\tproject.PROJECT_NAME,\n\taccount.ACC_NAME,\n\tccid.CCID_NAME,\n\temp.EMP_NAME AS CREATED_BY_NAME\nFROM\n\txc_ap_inv_gl_h h\n\t\tLEFT JOIN xc_gl_ledgers ledger ON ledger.LEDGER_ID = h.LEDGER_ID\n\t\tLEFT JOIN xc_pm_projects project ON project.PROJECT_ID = h.PROJECT_ID\n\t\tLEFT JOIN xip_pub_depts dept ON dept.DEPT_ID = h.DEPT_ID\n\t\tLEFT JOIN xc_ap_contract contract ON contract.AP_CONTRACT_ID = h.AP_CONTRACT_ID\n\t\tLEFT JOIN xc_gl_accounts account ON account.ACC_ID = h.AP_ACC_ID_DEBT\n\t\tLEFT JOIN xc_gl_ccid ccid ON ccid.CCID = h.AP_CCID_DEBT\n\t\tLEFT JOIN xip_pub_emps emp ON emp.EMP_ID = (SELECT EMP_ID FROM xip_pub_users WHERE USER_ID=h.CREATED_BY)\nWHERE \n\th.LEDGER_ID = {?LEDGER_ID?}\nAND h.VENDOR_ID = {?VENDOR_ID?}\nAND h.AP_DOC_CAT_CODE = 'YFD'\nAND h.NO_PAY_AMT > 0\nAND h.V_STATUS >= 3\nAND h.AP_INV_GL_H_CODE IS NOT NULL\nAND h.AP_INV_GL_H_CODE <> ''\n{#sql#}\nAND (h.AP_INV_GL_H_CODE LIKE '%{#AP_INV_GL_H_CODE#}%' OR h.DESCRIPTION LIKE '%{#AP_INV_GL_H_CODE#}%')\nAND emp.EMP_NAME LIKE '%{#CREATED_BY_NAME#}%'\n\nORDER BY \n\th.CREATION_DATE DESC"},"children":[],"expanded":false,"type":"sqlswitcher"},{"configs":{"sql":"{#sqlswitcher1#}","itemId":"dataprovider1"},"children":[],"expanded":false,"type":"dataprovider"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":"search_icon"}