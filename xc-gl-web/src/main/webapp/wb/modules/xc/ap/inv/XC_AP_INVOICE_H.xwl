{"inframe":false,"title":"采购发票录入","hidden":false,"roles":{"default":1},"children":[{"configs":{"jsLinks":"[\"platform/util/platformUtil.js\"]","serverScript":"//---------------------获取当前模块语言对应的.json文件，放到request中----------------\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xc/ap/inv/json/XC_AP_INVOICE_H_NO_C\");\nvar userId = request.getSession().getAttribute(\"XzSessionVars\").get('userId');\n\nvar protocol = request.getProtocol() ;\nvar ipAddr = request.getServerName();\nvar port = request.getServerPort() ;\nvar ctxPath = request.getContextPath() ;\n\nvar pp = protocol.substr(0,5) ;\nprotocol = (pp.indexOf(\"https\") == -1 ? \"http\" : \"https\") ;\nvar url = protocol + \"://\" + ipAddr +\":\" + port + ctxPath ;\n\nrequest.setAttribute('contextPath',ctxPath);\nrequest.setAttribute(\"userId\",userId);\nrequest.setAttribute(\"appIP\",url);\nvar appId = request.getSession().getAttribute(\"XzSessionVars\").get('appId');\nrequest.setAttribute(\"funId\",request.getParameter('funId'));\nrequest.setAttribute(\"appId\",request.getParameter('appId'));","itemId":"module"},"events":{"finalize":"var tableValue = '';//窗口中的所有信息\nvar isEditCol = 'N';//判断是否更新过行信息\nvar deleteDtl = [];\nWb.isInsert = 'Y';\nWb.docCatCode = '{#AP_DOC_CAT_CODES#}';\napp.AP_INV_H_ID.setValue(Xip.getId());\napp.AP_DOC_CAT_CODE.setValue(Wb.docCatCode);\n\n//设置税额和数量（红字应该小于0）\nif (Wb.docCatCode == 'PTFP-H' || Wb.docCatCode == 'ZZSFP-H') {\n\tapp.TAX_AMT.setMaxValue(0);\n    app.INV_AMOUNT.setFieldStyle('color:red;');\n    app.TAX_AMT.setFieldStyle('color:red;');\n    app.QTY_COL.getEditor().setMaxValue(0);\n    app.AMOUNT_COL.getEditor().setMaxValue(0);\n}\nelse {\n    app.TAX_AMT.setMinValue(0);\n    app.QTY_COL.getEditor().setMinValue(0);\n    app.AMOUNT_COL.getEditor().setMinValue(0);\n}\nif (Wb.docCatCode == 'ZZSFP' || Wb.docCatCode == 'ZZSFP-H') {\n    app.td_3_3.show();\n    app.td_3_4.show();\n    app.TAX_AMT.allowBlank = false;\n    app.TAX_RATE.allowBlank = false;\n}\nif (Wb.docCatCode == 'PTFP' || Wb.docCatCode == 'ZZSFP') {\n    app.td_2_2.hide();\n}\n\nif (Wb.isInsert == 'Y') {\n    app.BIZ_DATE.setValue(new Date());\n    app.AUDIT_STATUS.setValue('A');\n    app.ldInitStore.load();\n    app.grid1.getStore().reload({\n        params: {\n            AP_INV_H_ID: app.AP_INV_H_ID.getValue()\n        }\n    });\n}\n\n\nfunction returnRowFn(r, type) {\n    if (type == 'xc_gl_ledgers') {\n        setLedger(r.data.LEDGER_ID);\n        setMinDate(r.data.LEDGER_ID);\n        if(Wb.docCatCode=='PTFP-H'){\n          app.AP_INVOICE_H_ID_PICK.QUERY_AP_DOC_CAT_CODE.setValue('PTFP');\n        }\n        if(Wb.docCatCode=='ZZSFP-H'){\n          app.AP_INVOICE_H_ID_PICK.QUERY_AP_DOC_CAT_CODE.setValue('ZZSFP');\n        }\n    }\n  \n    //选择合同名称后为供应商赋值\n    if (type == 'xc_ap_contract') {\n        app.VENDOR_ID_XWL.VENDOR_ID.setValue(r.data.VENDOR_ID);\n        app.VENDOR_ID_XWL.VENDOR_NAME.setValue(r.data.VENDOR_NAME);\n    }\n  \n    //选择供应商后为合同名称加筛选条件\n    if (type == 'xc_ap_vendors') {\n        if(app.AP_INVOICE_H_ID_PICK.L_AP_INV_H_CODE.getValue() !== null && app.AP_INVOICE_H_ID_PICK.L_AP_INV_H_CODE.getValue() !== ''){\n            clearAll();\n            app.VENDOR_ID_XWL.VENDOR_ID.setValue(r.data.VENDOR_ID);\n            app.VENDOR_ID_XWL.VENDOR_NAME.setValue(r.data.VENDOR_NAME);\n        }\n        else{\n            app.AP_CONTRACT_ID_XWL.QUERY_VENDOR_ID.setValue(app.VENDOR_ID_XWL.VENDOR_ID.getValue());\n            app.AP_CONTRACT_ID_XWL.AP_CONTRACT_ID.setValue('');\n            app.AP_CONTRACT_ID_XWL.AP_CONTRACT_NAME.setValue('');\n        }\n    }\n    \n    //为蓝字发票筛选时带上供应商条件\n    if(type == 'xc_ap_invoice_h_before') {\n        app.AP_INVOICE_H_ID_PICK.QUERY_VENDOR_ID.setValue(app.VENDOR_ID_XWL.VENDOR_ID.getValue());\n    }\n  \n    //选择项目带回成本中心\n    if(type == 'xc_pm_projects') {\n      app.DEPT_ID_XWL.DEPT_ID.setValue(r.data.DEPT_ID);\n      app.DEPT_ID_XWL.DEPT_NAME.setValue(r.data.DEPT_NAME);\n    }\n  \n    //选择成本中心为项目查询的成本中心赋值\n    if(type == 'xip_pub_depts') {\n        app.PROJECT_ID_XWL.QUERY_DEPT_ID.setValue(r.data.DEPT_ID);\n    }\n  \n    if (type == 'xc_ap_invoice_h') {\n        setMaxOrMinValue(null);\n        //选择蓝字发票都为项目和成本中心与供应商赋值\n        app.DEPT_ID_XWL.DEPT_ID.setValue(r.data.DEPT_ID);\n        app.DEPT_ID_XWL.DEPT_NAME.setValue(r.data.DEPT_NAME);\n        app.PROJECT_ID_XWL.PROJECT_ID.setValue(r.data.PROJECT_ID);\n        app.PROJECT_ID_XWL.PROJECT_NAME.setValue(r.data.PROJECT_NAME);\n        app.VENDOR_ID_XWL.VENDOR_ID.setValue(r.data.VENDOR_ID);\n        app.VENDOR_ID_XWL.VENDOR_NAME.setValue(r.data.VENDOR_NAME);\n\n        app.TAX_AMT.setValue(r.get('TAX_AMT') * -1);\n        app.TAX_AMT.setMaxValue(0);\n        app.TAX_AMT.setMinValue(r.get('TAX_AMT') * -1);\n        app.INV_AMOUNT.setValue(r.get('INV_AMOUNT') * -1);\n        app.INV_AMOUNT.setMaxValue(0);\n        app.INV_AMOUNT.setMinValue(r.get('INV_AMOUNT') * -1);\n        app.TAX_RATE.setValue(r.get('TAX_RATE'));\n        app.TAX_RATE.setMaxValue(r.get('TAX_RATE'));\n        app.DESCRIPTION.setValue(r.data.DESCRIPTION);\n\n        app.store1.load({\n            params: {\n                AP_INV_H_ID: app.AP_INVOICE_H_ID_PICK.L_AP_INV_H_ID.getValue()\n            },\n            callback: function() {\n                // 避免累加\n                /*app.grid1.getStore().reload({\n                    params: {\n                        AP_INV_H_ID: app.AP_INVOICE_H_ID_PICK.L_AP_INV_H_ID.getValue()\n                    }\n                });*/\n                app.grid1.getStore().removeAll();\n                for (var i = 0; i < app.store1.getCount(); i++) {\n                    var r = app.store1.getAt(i);\n                    r.set('L_AP_INV_H_ID', r.get('AP_INV_H_ID'));\n                    r.set('L_AP_INV_L_ID', r.get('AP_INV_L_ID'));\n                    r.set('AP_INV_L_ID', null);\n                    r.set('AP_INV_H_ID', app.AP_INV_H_ID.getValue());\n                    r.set('AMOUNT', r.get('AMOUNT') * -1);\n                    r.set('QTY', r.get('QTY') * -1);\n                    app.QTY_COL.getEditor().setMinValue(r.get('QTY'));\n                    app.AMOUNT_COL.getEditor().setMinValue(r.get('AMOUNT'));\n                    app.grid1.getStore().add(r.getData());\n                }\n                app.purTypeBtn.hide();\n            }\n        });\n    }\n}\nfunction clearOtherFn(type) {\n    if (type == 'xc_gl_ledgers') {\n\t\tclearAll();\n    }\n   \n    //清空供应商信息时，同时清空合同名称和蓝字发票\n    if(type == 'xc_ap_vendors') {      \n        if(app.AP_INVOICE_H_ID_PICK.L_AP_INV_H_CODE.getValue() !== null && app.AP_INVOICE_H_ID_PICK.L_AP_INV_H_CODE.getValue() !== ''){\n            clearAll();\n            setMaxOrMinValue(null);\n        }\n        else{\n            app.AP_CONTRACT_ID_XWL.QUERY_VENDOR_ID.setValue('');\n            app.AP_CONTRACT_ID_XWL.AP_CONTRACT_ID.setValue('');\n            app.AP_CONTRACT_ID_XWL.AP_CONTRACT_NAME.setValue('');\n        }\n    }\n    \n    //清空账薄时清空面板中所有信息\n    if (type == 'cancelLedger') {\n\t\tclearAll();\n        setLedger('');\n        setMinDate(null);\n    }\n  \n    //情况成本中心同时清空项目查询条件里的成本中心\n    if(type == 'xip_pub_depts') {\n        app.PROJECT_ID_XWL.QUERY_DEPT_ID.setValue('');\n    }\n    //清空蓝字发票，清空明细和税额\n    if(type == 'cancelApInvoice'){\n\t\tclearAll();\n        setMaxOrMinValue(null);\n    }\n    \n}\nfunction setLedger(ledgerId) {\n    app.VENDOR_ID_XWL.QUERY_LEDGER_ID.setValue(ledgerId);\n    app.PROJECT_ID_XWL.QUERY_LEDGER_ID.setValue(ledgerId);\n    app.DEPT_ID_XWL.QUERY_LEDGER_ID.setValue(ledgerId);\n    app.AP_CONTRACT_ID_XWL.QUERY_LEDGER_ID.setValue(ledgerId);\n    app.AP_INVOICE_H_ID_PICK.QUERY_LEDGER_ID.setValue(ledgerId);\n}\nfunction clearAll(){\n\tapp.DEPT_ID_XWL.DEPT_ID.setValue('');\n    app.DEPT_ID_XWL.DEPT_NAME.setValue('');\n    app.PROJECT_ID_XWL.PROJECT_ID.setValue('');\n    app.PROJECT_ID_XWL.PROJECT_NAME.setValue('');\n    app.VENDOR_ID_XWL.VENDOR_ID.setValue('');\n    app.VENDOR_ID_XWL.VENDOR_NAME.setValue('');\n    app.AP_CONTRACT_ID_XWL.AP_CONTRACT_ID.setValue('');\n    app.AP_CONTRACT_ID_XWL.AP_CONTRACT_NAME.setValue('');\n    app.AP_CONTRACT_ID_XWL.QUERY_VENDOR_ID.setValue('');\n    app.AP_INVOICE_H_ID_PICK.L_AP_INV_H_ID.setValue('');\n    app.AP_INVOICE_H_ID_PICK.L_AP_INV_H_CODE.setValue('');\n    app.INV_AMOUNT.reset();  \n    app.TAX_AMT.reset();\n    app.TAX_RATE.reset();\n    app.DESCRIPTION.reset();\n    app.grid1.getStore().removeAll();\n    //显示选择采购类型按钮\n    app.purTypeBtn.show();\n}\napp.LEDGER_ID_XWL.LEDGER_NAME.allowBlank = false;\napp.VENDOR_ID_XWL.VENDOR_NAME.allowBlank = false;\n////账薄、供应商、蓝字发票设置为可修改/不可修改状态\nfunction setSomeReadOnly(flag){\n    //账薄、供应商、蓝字发票设置为不可修改状态\n    app.LEDGER_ID_XWL.LEDGER_NAME.setReadOnly(flag);\n    app.VENDOR_ID_XWL.VENDOR_NAME.setReadOnly(flag);\n    app.AP_INVOICE_H_ID_PICK.L_AP_INV_H_CODE.setReadOnly(flag);\n}\nfunction setMaxOrMinValue(flag){\n    app.TAX_AMT.setMinValue(flag);\n    app.INV_AMOUNT.setMinValue(flag);\n    app.TAX_RATE.setMaxValue(17);\n    app.QTY_COL.getEditor().setMinValue(flag);\n    app.AMOUNT_COL.getEditor().setMinValue(flag);\n}\nfunction setMinDate(ledgerId){\n    Wb.request({//账簿会计期查询\n        url : 'm?xwl=xc/ar/inv/DB/ledgerDateSelect',\n        params : {LEDGER_ID : ledgerId},\n        success : function(resp){\n            var temp = Wb.decode(resp.responseText);\n            if(temp.total > 0){\n                app.BIZ_DATE.setMinValue(Wb.strToDate(temp.rows[0].START_DATE));\n            }\n            else {}\n        }\n    });\n}"},"children":[{"configs":{"itemId":"request"},"children":[{"configs":{"autoLoad":"true","itemId":"ldInitStore","url":"m?xwl=xc/com-lov/LEDGER_ID_PICK/DB/XC_GL_LEDGERS_SELECT_SEC"},"events":{"load":"app.LEDGER_ID_XWL.LEDGER_ID.setValue(store.getAt(0).get('LEDGER_ID'));\napp.LEDGER_ID_XWL.LEDGER_NAME.setValue(store.getAt(0).get('LEDGER_NAME'));\napp.VENDOR_ID_XWL.QUERY_LEDGER_ID.setValue(store.getAt(0).get('LEDGER_ID'));\napp.PROJECT_ID_XWL.QUERY_LEDGER_ID.setValue(store.getAt(0).get('LEDGER_ID'));\napp.DEPT_ID_XWL.QUERY_LEDGER_ID.setValue(store.getAt(0).get('LEDGER_ID'));\napp.AP_CONTRACT_ID_XWL.QUERY_LEDGER_ID.setValue(store.getAt(0).get('LEDGER_ID'));\napp.AP_INVOICE_H_ID_PICK.QUERY_LEDGER_ID.setValue(store.getAt(0).get('LEDGER_ID'));\nif(Wb.docCatCode=='PTFP-H'){\n  app.AP_INVOICE_H_ID_PICK.QUERY_AP_DOC_CAT_CODE.setValue('PTFP');\n}\nif(Wb.docCatCode=='ZZSFP-H'){\n  app.AP_INVOICE_H_ID_PICK.QUERY_AP_DOC_CAT_CODE.setValue('ZZSFP');\n}\nsetMinDate(store.getAt(0).get('LEDGER_ID'));"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"store1","url":"m?xwl=xc/ap/inv/DB/XC_AP_INVOICE_L_SELECT"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"folder"},{"configs":{"itemId":"form1Tbar"},"children":[{"configs":{"text":"{#addBtn#}","itemId":"addBtn","iconCls":"file_add_icon"},"events":{"click":"app.form1.getForm().reset();\napp.AP_INV_H_ID.setValue(Xip.getId());\napp.AP_DOC_CAT_CODE.setValue(Wb.docCatCode);\napp.BIZ_DATE.setValue(new Date());\napp.AUDIT_STATUS.setValue('A');\napp.ldInitStore.load();\napp.grid1.getStore().reload({params:{\n\t\tAP_INV_H_ID:app.AP_INV_H_ID.getValue()\n\t}});\nWb.isInsert = 'Y';\n//账薄、供应商、蓝字发票还原为可修改状态\nsetSomeReadOnly(false);\nif (Wb.docCatCode == 'PTFP-H' || Wb.docCatCode == 'ZZSFP-H')\n    setMaxOrMinValue(null);\napp.submitButton.setDisabled(false);\napp.saveBtn.setDisabled(false);\napp.purTypeBtn.show();"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#saveBtn#}","itemId":"saveBtn","iconCls":"save_icon"},"events":{"click":"var srcAmt = 0;\n\n//发票无明细不让保存\nif (app.grid1.getStore().getCount() < 1) {\n    Wb.toast('{#saveWarn1#}');\n    return;\n}\nfor (var i = 0; i < app.grid1.getStore().getCount(); i++) {\n    var r = app.grid1.getStore().getAt(i);\n    srcAmt = srcAmt + r.get('AMOUNT');\n    //行摘要\n    var DESCRIPTION = r.get('DESCRIPTION');\n    if(DESCRIPTION === null || DESCRIPTION === ''){\n\t\tr.set('DESCRIPTION',app.DESCRIPTION.getValue());\n    }\n}\napp.AMOUNT.setValue(srcAmt);\nif (Wb.isEmpty(app.TAX_AMT.getValue())) {\n    app.INV_AMOUNT.setValue(srcAmt);\n} else {\n    app.INV_AMOUNT.setValue(srcAmt + app.TAX_AMT.getValue());\n}\n/*--------------  验证数据是否合法  ---------------*/\nvar remove = app.grid1.getStore().getRemovedRecords();\nfor(var i = 0;i < remove.length;i++){\n    var deleteData =  {AP_INV_L_ID : remove[i].data.AP_INV_L_ID};\n    deleteDtl.push(deleteData);\n}\nif (app.form1.isValid()) {\n    if (!Wb.verifyGrid(app.grid1)) {\n        Wb.toast('{#saveWarn2#}');\n        return;\n    } else {\n        Wb.request({\n            url : '{#contextPath#}'+'/apDocsAction.do?method=saveOrUpdateInvoice',\n            params : {'mainTabInfo' : Wb.encode(Wb.getValue(app.form1)),rowTabInfo : Wb.encode(Wb.getData(app.grid1)),deleteDtl : deleteDtl},\n            success : function(resp){\n                var record = Wb.decode(resp.responseText);\n                var msg = record.msg;\n                if(record.flag === '0'){\n                    setSomeReadOnly(true);\n                    app.AP_INV_H_CODE.setValue(record.apDocCode);\n                    Wb.isInsert = 'N';\n                    app.grid1.getStore().load({params: {AP_INV_H_ID: app.AP_INV_H_ID.getValue()}});\n                }\n                Wb.toast(msg);\n                tableValue = Wb.encode(Wb.getValue(app.form1));\n                isEditCol = 'N';\n            }\n        });\n    }\n} else {\n    Wb.toast('{#saveWarn4#}');\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#submitButton#}","itemId":"submitButton","iconCls":"check_icon"},"events":{"click":"if(Wb.isInsert=='Y' || tableValue !== Wb.encode(Wb.getValue(app.form1)) || isEditCol == 'Y'){\n    Wb.toast('{#submitWarn1#}');\n    return false;\n}\nif(!app.form1.getForm().isValid()){\n    Wb.toast('{#saveWarn4#}');\n    return;\n}\nvar AP_DOC_CAT_CODE = app.AP_DOC_CAT_CODE.getValue();\nWb.request({\n    url : 'm?xwl=xc/ap/inv/DB/XC_AP_INVOICE_L_SELECT',\n    params : {AP_INV_H_ID : app.AP_INV_H_ID.getValue()},\n    success : function(resp){\n        if(Wb.decode(resp.responseText).total === 0){\n            Wb.toast('{#submitWarn5#}\"'+app.AP_INV_H_CODE.getValue()+'\"{#submitWarn6#}');\n            return;\n        }\n        Wb.request({\n            url : '{#contextPath#}' + '/apDocsAction.do?method=getInvoiceProcAndForms',\n            params : {LEDGER_ID : app.LEDGER_ID_XWL.LEDGER_ID.getValue(),\n                      AP_DOC_CAT_CODE : AP_DOC_CAT_CODE\n            },\n            success : function(resp){\n                var temp = Wb.decode(resp.responseText);\n                if(temp.flag === '0'){\n                    //取得流程编码、电脑端审批表单和移动端审批表单\n                    var processCODE = temp.PROCESS_CODE;\n                    var pcApproveForm = temp.PC_A_FORM_URL;\n                    var mobileApproveForm = temp.M_A_FORM_URL;\n                    var orgId = temp.ORG_ID;\n                    if(pcApproveForm === \"\" || pcApproveForm === null || pcApproveForm === undefined){\n                        Wb.toast('{#submitWarn7#}：'+app.AP_DOC_CAT_CODE.getDisplayValue()+'{#submitWarn8#}');\n                        return;\n                    }\n                    //电脑端和移动端审批表单为变量需要设置为全路径\n                    pcApproveForm = '{#appIP#}' +  '/' + pcApproveForm;\n                    mobileApproveForm = '{#appIP#}' +  mobileApproveForm;\n                    //如果流程编码存在, 则提交流程审批处理\n                    if(processCODE !== \"\" && processCODE !== null && processCODE !== undefined){\n                        //如果项目未指定，则设置默认值为 \"-1\"\n                        var prjId = app.PROJECT_ID_XWL.PROJECT_ID.getValue();\n                        if(prjId === null || prjId === \"\" || prjId === undefined){\n                            prjId = \"-1\" ;\n                        }\n                        var auditStatus = app.AUDIT_STATUS.getValue();\n                        var json = {\n                            'APP_IP'\t\t\t: '{#appIP#}',\n                            'EMP_ID'\t\t\t: '{#XIP.empId#}',\n                            'loginName'\t\t\t: '{#XIP.userName#}',\n                            'AP_DOC_CAT_NAME'\t: app.AP_DOC_CAT_CODE.getDisplayValue(),\n                            'M_A_FORM'\t\t\t: mobileApproveForm,\n                            'PC_A_FORM'\t\t\t: pcApproveForm,\n                            'apCatCode'\t\t\t: 'CGFP',\n                            'billType'\t\t\t: app.AP_DOC_CAT_CODE.getValue(),\n                            'DEPT_ID'\t\t\t: app.DEPT_ID_XWL.DEPT_ID.getValue() ,\n                            'DEPT_NAME'\t\t\t: app.DEPT_ID_XWL.DEPT_NAME.getValue(),\n                            'PROJECT_ID'\t\t: prjId,\n                            'ORG_ID'\t\t\t: orgId,\n                            'ledgerId'\t\t\t: app.LEDGER_ID_XWL.LEDGER_ID.getValue(),\n                            'AMT'\t\t\t\t: app.INV_AMOUNT.getValue(),\n                            'ABSAMT'\t\t\t: Math.abs(app.INV_AMOUNT.getValue()),//金额绝对值\n                            'e_business_id'\t\t: app.AP_INV_H_ID.getValue()\n                        };\n                        if(auditStatus === 'A'){//起草状态\n                            XipWf.startAndSubmitByProcess(processCODE,json,function(e){//提交流程\n                                if(e.flag === 0){\n                                    app.INS_CODE.setValue(e.instanceCode);\n                                    app.submitButton.setDisabled(true);\n                                    app.saveBtn.setDisabled(true);\n                                    app.AUDIT_STATUS.setValue('C');\n                                    app.SYS_AUDIT_STATUS_DESC.setValue('{#C_SYS_STATUS#}');\n                                    Wb.toast('{#submitWarn2#}');\n                                }\n                                else if(e.flag === 1){\n                                    Wb.toast(e.msg) ;\n                                }\n                            });\n                        }\n                        else if(auditStatus === 'D'){//驳回状态\n                            XipWf.submitInstance(app.INS_CODE.getValue(),json,function(e){//提交流程\n                                if(e.flag === 0){\n                                    app.submitButton.setDisabled(true);\n                                    app.saveBtn.setDisabled(true);\n                                    app.AUDIT_STATUS.setValue('C');\n                                    app.SYS_AUDIT_STATUS_DESC.setValue('{#C_SYS_STATUS#}');\n                                    Wb.toast('{#submitWarn2#}');\n                                }\n                                else if(e.flag === 1){\n                                    Wb.toast(e.msg) ;\n                                }\n                            });\n                        }\n                        else if(auditStatus === 'R'){//撤回状态\n                            XipWf.restartAndSubmitByProcess(app.INS_CODE.getValue(),processCODE,json,function(e){//提交流程\n                                if(e.flag === 0){\n                                    app.submitButton.setDisabled(true);\n                                    app.saveBtn.setDisabled(true);\n                                    app.AUDIT_STATUS.setValue('C');\n                                    app.SYS_AUDIT_STATUS_DESC.setValue('{#C_SYS_STATUS#}');\n                                    Wb.toast('{#submitWarn2#}');\n                                }\n                                else if(e.flag === 1){\n                                    Wb.toast(e.msg) ;\n                                }\n                            });\n                        }\n                        else if(auditStatus === 'E' || auditStatus === 'C'){//运行中、结束状态\n                            Wb.toast('{#submitWarn3#}');\n                            return false;\n                        }\n                        else{\n                            Wb.toast('{#submitWarn4#}');\n                            return false;\n                        }\n                    }\n                    else{\n                        Wb.toast('{#submitWarn7#}：'+app.AP_DOC_CAT_CODE.getDisplayValue()+'{#submitWarn9#}');\n                    }\n                }\n                else{\n                    Wb.toast(temp.msg);\n                }\n            }\n        });\n    }\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#monitorBtn#}","itemId":"monitorBtn","iconCls":"viewport_icon"},"events":{"click":"if(app.INS_CODE.getValue() === null || app.INS_CODE.getValue() === ''){\n    Wb.toast('{#monitorWarn1#}');\n    return;\n}\nelse{\n    XipWf.showMonitorPage(app.INS_CODE.getValue());\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#withdrawBtn#}","itemId":"withdrawBtn","iconCls":"cancel_icon"},"events":{"click":"if(app.INS_CODE.getValue() === null || app.INS_CODE.getValue() === '') {\n    Wb.toast('{#withdrawWarn1#}');\n\treturn;\n}\nelse if(app.AUDIT_STATUS.getValue() === 'E') {\n    Wb.toast('{#withdrawWarn2#}');\n\treturn;\n}\nelse if(app.AUDIT_STATUS.getValue() === 'R'){\n    Wb.toast('{#withdrawWarn3#}');\n    return;\n}\nelse {\n\t//撤回流程\n\tXipWf.revokeByInstance(app.INS_CODE.getValue(),function(e){\n        if(e.flag === '0'){\n            app.AUDIT_STATUS.setValue('R');\n            app.SYS_AUDIT_STATUS_DESC.setValue('{#A_SYS_STATUS#}');\n            app.submitButton.setDisabled(false);\n            app.saveBtn.setDisabled(false);\n        }\n        Wb.toast(e.msg);\n        tableValue = Wb.encode(Wb.getValue(app.form1));\n\t});\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#cancelPayBtn#}","itemId":"cancelPayBtn"},"events":{"click":"var ap_inv_h_id = app.AP_INV_H_ID.getValue();\nvar ap_doc_cat_code = 'FKD_YUFK';\nvar curGrid = app.grid1;\nif(Wb.isInsert=='Y'){\n    Wb.toast('{#cancelPayWarn1#}');\n    return false;\n}\nif (app.AP_DOC_CAT_CODE.getValue() == 'PTFP' || app.AP_DOC_CAT_CODE.getValue() == 'ZZSFP') {\n    ap_doc_cat_code = 'FKD_YUFK';\n} else {\n    ap_doc_cat_code = 'FKD_YUFK-H';\n}\nvar ledger_id = app.LEDGER_ID_XWL.LEDGER_ID.getValue();\nif(app.SYS_AUDIT_STATUS_DESC.getValue() !== '草稿'){\n    Wb.toast('{#cancelPayWarn2#}');\n    return;\n}\nWb.run({\n    url: 'm?xwl=xc/ap/inv/LOV/LOV_XC_AP_INV_PRE',\n    success: function(apps) {\n        apps.initWin({\n            AP_INV_H_ID: ap_inv_h_id,\n            LEDGER_ID: ledger_id,\n            AP_DOC_CAT_CODE: ap_doc_cat_code,\n            hideFun: function(rs) {\n                app.CANCEL_AMT.setValue(rs);\n                Wb.reload(curGrid.store);\n                tableValue = Wb.encode(Wb.getValue(app.form1));\n            }\n        });\n    }\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#enclosureBtn#}","itemId":"enclosureBtn","iconCls":"attach_icon"},"events":{"click":"if(Wb.isInsert=='Y'){\n    Wb.toast('{#enclosureWarn1#}');\n    return false;\n}\nvar temp_id = app.AP_INV_H_ID.getValue();\nvar temp_code = app.AP_INV_H_CODE.getValue();\nWb.request({\n    url : '{#contextPath#}' + '/apDocsAction.do?method=getApAttCatCode',\n    params : {LEDGER_ID : app.LEDGER_ID_XWL.LEDGER_ID.getValue(),AP_DOC_CAT_CODE : app.AP_DOC_CAT_CODE.getValue()},\n    success : function(resp){\n        var temp = Wb.decode(resp.responseText);\n        if(temp.flag == '0'){\n            var attCatCode = temp.attCatCode;\n            Xip.showAttachmentManager('{#XIP.userId#}',temp_id,'',attCatCode,temp_code,'Y','Y','Y',function(){},2); \n        }\n        else{\n            Wb.toast(temp.msg);\n        }\n    }\n});"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"layout":"border","itemId":"viewport1"},"children":[{"configs":{"region":"north","tbar":"app.form1Tbar","autoScroll":"true","border":"false","itemId":"form1"},"children":[{"configs":{"style":"fontSize:20px","html":"<font style=\"\">采购发票<\/font>","margin":"10 0 20 0","labelAlign":"center","itemId":"title"},"children":[],"expanded":false,"type":"label"},{"configs":{"layout":"column","margin":"5 0 0 0","border":"false","itemId":"tr1"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_1_1"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/LEDGER_ID_PICK/LEDGER_ID_PICK_SEC","itemId":"LEDGER_ID_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_1_2"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","pickList":"[\n  ['PTFP','{#ptfp#}'],\n  ['ZZSFP','{#zzszyfp#}'],\n  ['PTFP-H','{#ptfpH#}'],\n  ['ZZSFP-H','{#zzszyfpH#}']\n]","labelAlign":"right","itemId":"AP_DOC_CAT_CODE","fieldLabel":"{#AP_DOC_CAT_CODE#}"},"events":{"change":"if(newValue=='PTFP'){\n\tapp.title.setText('{#ptfp#}',false);\n}\nif(newValue=='PTFP-H'){\n\tapp.title.setText('<font style=\"color:red;\">{#ptfp#}<\/font>',false);\n    app.AP_INVOICE_H_ID_PICK.QUERY_AP_DOC_CAT_CODE.setValue('PTFP');\n}\nif(newValue=='ZZSFP'){\n\tapp.title.setText('{#zzszyfp#}',false);\n}\nif(newValue=='ZZSFP-H'){\n\tapp.title.setText('<font style=\"color:red;\">{#zzszyfp#}<\/font>',false);\n    app.AP_INVOICE_H_ID_PICK.QUERY_AP_DOC_CAT_CODE.setValue('ZZSFP');\n}"},"children":[],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_1_3"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","emptyText":"系统自动生成","labelAlign":"right","itemId":"AP_INV_H_CODE","fieldLabel":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#AP_INV_H_CODE#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_1_4"},"children":[{"configs":{"labelWidth":"80","allowBlank":"false","labelAlign":"right","itemId":"BIZ_DATE","fieldLabel":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#BIZ_DATE#}"},"children":[],"expanded":false,"type":"date"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"layout":"column","margin":"5 0 0 0","border":"false","itemId":"tr2"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_2_1"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/VENDOR_ID_PICK/VENDOR_ID_LD","itemId":"VENDOR_ID_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_2_2"},"children":[{"configs":{"file":"m?xwl=xc/ap/ap-com-lov/AP_INVOICE_H_ID_PICK/AP_INVOICE_H_ID_PICK_INV_L","itemId":"AP_INVOICE_H_ID_PICK"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_1_3"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/DEPT_ID_PICK/DEPT_ID_LD","itemId":"DEPT_ID_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_2_4"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/PROJECT_ID_PICK/PROJECT_ID_LD","itemId":"PROJECT_ID_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"layout":"column","margin":"5 0 0 0","border":"false","itemId":"tr3"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_3_1"},"children":[{"configs":{"file":"m?xwl=xc/ap/ap-com-lov/AP_CONTRACT_ID_PICK/AP_CONTRACT_ID_PICK_ALL","itemId":"AP_CONTRACT_ID_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_3_2"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"INV_AMOUNT","fieldLabel":"<span style='color:red'>*<\/span>{#INV_AMOUNT#}"},"children":[],"expanded":false,"type":"number"},{"configs":{"labelWidth":"80","readOnly":"true","hidden":"true","labelAlign":"right","itemId":"AMOUNT","fieldLabel":"{#AMOUNT#}"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","hidden":"true","layout":"form","columnWidth":".245","itemId":"td_3_3"},"children":[{"configs":{"tagConfigs":"baseChars:\"-.0123456789\"","labelWidth":"80","labelAlign":"right","itemId":"TAX_AMT","fieldLabel":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#TAX_AMT#}"},"events":{"blur":"if(number.getValue()==0){\n  number.setValue('');\n}"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","hidden":"true","layout":"form","columnWidth":".245","itemId":"td_3_4"},"children":[{"configs":{"labelWidth":"80","minValue":"0","labelAlign":"right","allowDecimals":"false","itemId":"TAX_RATE","fieldLabel":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#TAX_RATE#}(%)","maxValue":"17"},"events":{"blur":"if(number.getValue()>number.maxValue){\n  number.setValue('');\n}"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"layout":"column","margin":"5 0 0 0","border":"false","itemId":"tr4"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".49","itemId":"td_4_1"},"children":[{"configs":{"labelWidth":"80","allowBlank":"false","labelAlign":"right","itemId":"DESCRIPTION","fieldLabel":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#DESCRIPTION#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_4_2"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"INV_NO","fieldLabel":"{#INV_NO#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_4_3"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"CANCEL_AMT","fieldLabel":"{#CANCEL_AMT#}"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"panel"}],"expanded":false,"type":"panel"},{"configs":{"layout":"column","margin":"5 0 5 0","border":"false","itemId":"tr5"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_5_1"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","value":"{#XIP.empName#}","labelAlign":"right","itemId":"CREATED_BY_NAME","fieldLabel":"{#CREATED_BY_NAME#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_5_2"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"SIGN_USER_NAME","fieldLabel":"{#SIGN_USER_NAME#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_5_3"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"FIN_USER_NAME","fieldLabel":"{#FIN_USER_NAME#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_5_4"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","value":"{#A_SYS_STATUS#}","labelAlign":"right","itemId":"SYS_AUDIT_STATUS_DESC","fieldLabel":"{#SYS_AUDIT_STATUS_DESC#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"hidden":"true","itemId":"hidden_p"},"children":[{"configs":{"hidden":"true","itemId":"AP_INV_H_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"INS_CODE"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"AUDIT_STATUS"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","value":"{#XIP.userId#}","itemId":"USER_ID","fieldLabel":"USER_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"apDocCode","fieldLabel":"apDocCode"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"form"},{"configs":{"region":"center","pagingBar":"false","selType":"checkboxmodel","itemId":"grid1","editable":"true"},"events":{"tagEvents":"'cellclick' : function(grid1,td,cellIndex,record,tr,rowIndex,e,eOpts){\n    if(cellIndex == 12){\n        var store = grid1.getStore();\n        var DIM_NAME = record.data.DIM_NAME;\n        var DIM_CODE = record.data.DIM_CODE;\n        if(rowIndex > 0){\n            if(DIM_CODE === '' || DIM_CODE === null){\n                var r = store.getAt(0);\n                record.set('DIM_CODE',r.data.DIM_CODE);\n                record.set('DIM_NAME',r.data.DIM_NAME);\n            }\n        }\n    }\n}"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/ap/inv/DB/XC_AP_INVOICE_L_SELECT"},"events":{"update":"isEditCol = 'Y';","remove":"isEditCol = 'Y';","add":"isEditCol = 'Y';"},"children":[],"expanded":false,"type":"store"},{"configs":{"normalName":"grid1Tbar","itemId":"tbar"},"children":[{"configs":{"text":"{#purTypeBtn#}","itemId":"purTypeBtn","iconCls":"db_form_add_icon"},"events":{"click":"var invHId = app.AP_INV_H_ID.getValue();\nvar ledgerId = app.LEDGER_ID_XWL.LEDGER_ID.getValue();\nif(Wb.isEmpty(ledgerId)){\n\tWb.toast('{#selectInfo1#}');\n    return false;\n}\n//设置数量\nvar tempQty = 1;\nif (Wb.docCatCode == 'PTFP-H' || Wb.docCatCode == 'ZZSFP-H') {\n\ttempQty = -1;  \n}\nvar curGrid = app.grid1;\nWb.run({\n    url: 'm?xwl=xc/ap/inv/LOV/LOV_XC_AP_PUR_TYPE', \n    params:{docCatCode:Wb.docCatCode},//发票类型\n    success: function(app) {\n      app.initWin({\n          AP_DOC_CAT_CODE:'',\n          LEDGER_ID:ledgerId,\n          hideFun:function(rs){\n              Wb.each(rs, function(r) {\n                  r.set('AP_INV_L_ID',Xip.getId());\n                  r.set('AP_INV_H_ID',invHId);\n                  r.set('QTY',tempQty);\n\n                  var grid1Store = curGrid.getStore();\n                  if(grid1Store.getCount() > 0){\n                      r.set('DIM_CODE',grid1Store.getAt(0).get('DIM_CODE'));\n                      r.set('DIM_NAME',grid1Store.getAt(0).get('DIM_NAME'));\n                  }\n                  for(var i=0;i<grid1Store.getCount();i++){\n                      var gr = grid1Store.getAt(i);\n                      if(gr.get('AP_PUR_TYPE_ID')==r.get('AP_PUR_TYPE_ID')){\n//                           return false;\n                          curGrid.getStore().removeAt(i);\n                      }\n                  }\n                  Wb.add(curGrid, {\n                      AP_INV_L_ID:null,\n                      AP_INV_H_ID:r.get('AP_INV_H_ID'),\n                      AP_PUR_TYPE_ID:r.get('AP_PUR_TYPE_ID'),\n                      AP_PUR_TYPE_NAME:r.get('AP_PUR_TYPE_NAME'),\n                      BG_ITEM_ID:r.get('BG_ITEM_ID'),\n                      BG_ITEM_NAME:r.get('BG_ITEM_NAME'),\n                      DEPT_ID:r.get('DEPT_ID'),\n                      DEPT_NAME:r.get('DEPT_NAME'),\n                      PROJECT_ID:r.get('PROJECT_ID'),\n                      PROJECT_NAME:r.get('PROJECT_NAME'),\n                      ACC_ID:r.get('AP_ACC_ID_DEBT'),\n                      ACC_NAME:r.get('AP_ACC_NAME_DEBT'),\n                      DIM_CODE:r.get('DIM_CODE'),\n                      DIM_NAME:r.get('DIM_NAME'),\n                      CCID:r.get('CCID'),\n                      AMOUNT:r.get('PAY_AMT'),\n                      QTY:r.get('QTY'),\n                      DESCRIPTION:r.get('DESCRIPTION')\n                  }, 'after', 1, false);\n              });\n          }\n      });\n    }\n});\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#delBtn#}","itemId":"delBtn","iconCls":"file_delete_icon"},"events":{"click":"/**\n*\tupdate：panghd date：20160510\n*\t删除原则，先将选中记录在表格中移除，点击主单保存时，才真正从数据库删除。\n**/\nvar recs = app.grid1.getSelection();\nif (!recs.length) {\n    Wb.warn('请选择需要删除的记录。');\n    return;\n}\n\nWb.confirm('确定要删除选择的 ' + recs.length + ' 条记录吗？', function() {\n\tWb.remove(app.grid1, recs);\n});"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#AP_INV_L_ID#}","hidden":"true","dataIndex":"AP_INV_L_ID","titleAlign":"center","itemId":"AP_INV_L_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#AP_INV_H_ID#}","hidden":"true","dataIndex":"AP_INV_H_ID","titleAlign":"center","itemId":"AP_INV_H_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#L_AP_INV_H_ID#}","hidden":"true","dataIndex":"L_AP_INV_H_ID","titleAlign":"center","itemId":"L_AP_INV_H_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#L_AP_INV_L_ID#}","hidden":"true","dataIndex":"L_AP_INV_L_ID","titleAlign":"center","itemId":"L_AP_INV_L_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#AP_PUR_TYPE_ID#}","hidden":"true","dataIndex":"AP_PUR_TYPE_ID","titleAlign":"center","itemId":"AP_PUR_TYPE_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#BG_ITEM_ID#}","hidden":"true","dataIndex":"BG_ITEM_ID","titleAlign":"center","itemId":"BG_ITEM_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"<font color=\"red\">*<\/font>{#AP_PUR_TYPE_NAME#}","width":"150","dataIndex":"AP_PUR_TYPE_NAME","titleAlign":"center","itemId":"AP_PUR_TYPE_NAME_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#BG_ITEM_NAME#}","width":"150","dataIndex":"BG_ITEM_NAME","titleAlign":"center","itemId":"BG_ITEM_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"<font color=\"red\">*<\/font>{#AMOUNT#}","width":"100","align":"right","dataIndex":"AMOUNT","format":"0,000.00","titleAlign":"center","itemId":"AMOUNT_COL"},"children":[{"configs":{"itemId":"editor"},"events":{"blur":"if(number.getValue()===0){\n  number.setValue('');\n}"},"children":[],"expanded":false,"type":"number"}],"expanded":false,"type":"column"},{"configs":{"text":"{#QTY#}","align":"right","width":"80","dataIndex":"QTY","titleAlign":"center","itemId":"QTY_COL"},"children":[{"configs":{"decimalPrecision":"6","itemId":"editor"},"events":{"blur":"if(number.getValue()===0){\n  number.setValue('');\n}"},"children":[],"expanded":false,"type":"number"}],"expanded":false,"type":"column"},{"configs":{"text":"{#DIM_CODE#}","hidden":"true","dataIndex":"DIM_CODE","titleAlign":"center","itemId":"DIM_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"<font color=\"red\">*<\/font>{#DIM_NAME#}","width":"80","dataIndex":"DIM_NAME","titleAlign":"center","itemId":"DIM_NAME_COL"},"children":[{"configs":{"labelWidth":"80","allowBlank":"false","labelAlign":"right","normalName":"DIM_NAME_PICK","itemId":"editor"},"events":{"focus":"// var r=app.grid1.getSelectionModel().getSelection()[0];\n// var grid1Store = app.grid1.getStore();\n// if(grid1Store.getCount() > 0){\n//     r.set('DIM_CODE',grid1Store.getAt(0).get('DIM_CODE'));\n//     r.set('DIM_NAME',grid1Store.getAt(0).get('DIM_NAME'));\n// }\n// var r=app.grid1.getSelectionModel().getSelection()[0];\n// var grid1Store = app.grid1.getStore();\n// for(var i = 0;i < grid1Store.getCount();i++){\n//     if(grid1Store.getAt(i).get('DIM_CODE') !== '' && grid1Store.getAt(i).get('DIM_CODE') !== null){\n//         r.set('DIM_CODE',grid1Store.getAt(i).get('DIM_CODE'));\n//         r.set('DIM_NAME',grid1Store.getAt(i).get('DIM_NAME'));\n//     }\n// }"},"children":[{"configs":{"tagConfigs":"minWidth:400","height":"300","barExportButtons":"false","barExportAllButtons":"false","itemId":"pickComp"},"events":{"itemdblclick":"var r=app.grid1.getSelectionModel().getSelection()[0];\nr.set('DIM_CODE',record.data.DIM_CODE);\nr.set('DIM_NAME',record.data.DIM_NAME);\napp.DIM_NAME_PICK.setValue(record.data.DIM_NAME);\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/ap/inv/DB/XC_GL_DIMENSIONS_SELECT"},"events":{"beforeload":"operation.params = Wb.getValue(app.tbar);"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","dataIndex":"DIM_ID","itemId":"DIM_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#DIM_CODE_COL#}","dataIndex":"DIM_CODE","itemId":"DIM_CODE_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#DIM_NAME_COL#}","dataIndex":"DIM_NAME","itemId":"DIM_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"100","emptyText":"{#DIM_CODE_NAME#}","labelAlign":"right","itemId":"QUERY_CODE_NAME"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.pickComp.getStore().load();\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":true,"type":"column"},{"configs":{"text":"{#DESCRIPTION#}","width":"300","dataIndex":"DESCRIPTION","titleAlign":"center","itemId":"DESCRIPTION_COL"},"children":[{"configs":{"itemId":"editor"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}