{"inframe":false,"title":"","hidden":false,"roles":{"default":1},"children":[{"configs":{"initScript":"var lang = request.getSession().getAttribute(\"XzSessionVars\").get('language');\nrequest.setAttribute(\"language\",lang);","serverScript":"//---------------------获取当前模块语言对应的.json文件，放到request中----------------\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xc/ap/trans/json/XC_AP_INV_TRANS_ALL\");","itemId":"module"},"events":{"initialize":"Ext.apply(app, {\n  initWin: function(params) {\n    Ext.apply(app, params);\n    app.editWinN = new Ext.window.Window(app.editWinN);\n    app.editWinN.show();\n    app.AP_PAY_H_ID.setValue(params.AP_PAY_H_ID);\n    app.AP_INV_GL_H_ID.setValue(params.AP_INV_GL_H_ID);\n    app.SOURCE_ID.setValue(params.SOURCE_ID);\n    app.AP_CONTRACT_ID.setValue(params.AP_CONTRACT_ID);\n    app.QUERY_FROM.setValue(params.QUERY_FROM);\n    Wb.request({\n        url: 'm?xwl=xc/ap/gl/DB/XC_AP_INV_GL_H_SELECT_BY_ID',\n        params: {AP_INV_GL_H_ID: params.AP_INV_GL_H_ID},\n        success: function(resp) {\n            var r = Wb.decode(resp.responseText);\n            app.L_AP_INV_GL_H_ID.setValue(r.L_AP_INV_GL_H_ID);\n            app.grid1.store.load({params : Wb.getValue(app.form1)});\n        }\n    });\n   }\n});\n// TODO: 增加合计行\nfunction addTotalLine(){\n    Ext.define('lineModel', {  \n        extend: 'Ext.data.Model',  \n        fields: [  \n            {name: 'SOURCE_NAME'},\n            {name: 'TRANS_DATE'},  \n            {name: 'SOURCE_CODE'},\n            {name: 'AP_DOC_CAT_NAME'},\n            {name: 'CR_AMT'},  \n            {name: 'DR_AMT'},  \n            {name: 'NO_PAY_AMT'},  \n            {name: 'DFJE'},  \n            {name: 'JFJE'}\n        ]  \n    });\n    var r = Ext.create('lineModel', {\n        'SOURCE_NAME':'',\n        'TRANS_DATE':'',\n        'SOURCE_CODE':'',\n        'AP_DOC_CAT_NAME':'{#total#}',\n        'CR_AMT':'', \n        'DR_AMT':'',\n        'AMOUNT': '',\n        'NO_PAY_AMT':'',\n        'DFJE':'',\n        'JFJE':''\n    });\n    var p = app.grid1.store.getCount() ;\n    app.grid1.store.insert(p,r);\n}"},"children":[{"configs":{"maximized":"true","layout":"border","itemId":"editWinN","modal":"true"},"children":[{"configs":{"region":"north","hidden":"true","itemId":"form1"},"children":[{"configs":{"itemId":"SOURCE_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"AP_INV_GL_H_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"AP_PAY_H_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"AP_CONTRACT_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"QUERY_FROM"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"L_AP_INV_GL_H_ID"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"form"},{"configs":{"region":"center","itemId":"grid1"},"events":{"itemdblclick":"app.seekBtn.fireEvent('click');"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/ap/trans/DB/XC_AP_INV_TRANS_SELECT"},"events":{"load":"//增加合计行\naddTotalLine();\nvar i = store.find('AP_DOC_CAT_NAME','{#total#}');\nvar r = store.getAt(i) ;\n// 设置原币借方和贷方合计数\nvar t_edr = 0;\nvar t_ecr = 0;\nvar t_occ = 0;\nvar inv_amount = 0;\nWb.each(records, function(rec){\n    var edr = rec.data.JFJE;\n    if(edr === \"\" || edr === null || edr === undefined){edr = 0;}\n    var ecr = rec.data.DFJE;\n    if(ecr === \"\" || ecr === null || ecr === undefined){ecr = 0;}\n    var occ = rec.data.SQJE;\n    if(occ === \"\" || occ === null || occ === undefined){occ = 0;}\n    var inv = rec.data.INV_AMOUNT;\n    if(inv === \"\" || inv === null || inv === undefined){inv = 0;}\n    t_edr += edr;\n    t_ecr += ecr;\n    t_occ += occ;\n    inv_amount = inv;\n    if(app.L_AP_INV_GL_H_ID.getValue() !== '' && app.L_AP_INV_GL_H_ID.getValue() !== null)\n        rec.set('INV_AMOUNT', Wb.format(0,'0,000.00'));\n    else\n        rec.set('INV_AMOUNT', Wb.format(t_ecr - t_edr,'0,000.00'));\n});\nr.set('JFJE', t_edr);\nr.set('DFJE', t_ecr);\nr.set('SQJE', t_occ);\nif(app.L_AP_INV_GL_H_ID.getValue() !== '' && app.L_AP_INV_GL_H_ID.getValue() !== null)\n    r.set('INV_AMOUNT', Wb.format(0,'0,000.00'));\nelse\n    r.set('INV_AMOUNT', Wb.format(t_ecr - t_edr,'0,000.00'));\nstore.commitChanges();"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"{#seekBtn#}","itemId":"seekBtn","iconCls":"seek_icon"},"events":{"click":"var recs = app.grid1.getSelection();\nif(recs.length !== 1){\n  Wb.toast('{#selectRec#}');\n  return;\n}\n\nvar ap_doc_cat_code = recs[0].data.AP_DOC_CAT_CODE;//获取单据类型\nvar source_id = recs[0].data.SOURCE_ID;//获取来源单据id\nvar ap_pay_h_id = recs[0].data.AP_PAY_H_ID;\nif(ap_doc_cat_code == 'YFD' || ap_doc_cat_code == 'YFD-H'){//应付\n    Wb.run({\n        url: 'm?xwl=xc/ap/gl/XC_AP_INV_GL_H_NO_C', \n        params : {'businessId' : source_id},\n        success: function(app) {\n            app.initWin({\n                AP_INV_GL_H_ID:source_id,\n                IS_INSERT:'S',\n                AP_DOC_CAT_CODE:ap_doc_cat_code,\n                hideFun:function(){\n                    Wb.isInsert = 'N';\n                }\n            });\n        }\n    });\n}\nelse if(ap_doc_cat_code == 'YFHYS' || ap_doc_cat_code == 'YFHLDC' || ap_doc_cat_code == 'YFHYUF' || ap_doc_cat_code == 'YUFHLDC'){//核销\n    Wb.run({\n        url: 'm?xwl=xc/ap/cancel/XC_AP_CANCEL_H_NO_C', \n        success: function(app) {\n            app.initWin({\n                AP_CANCEL_H_ID:source_id,\n                IS_INSERT:'S',\n                hideFun:function(){\n                    Wb.isInsert = 'N';\n                }\n            });\n        }\n    });\n}\nelse if(ap_doc_cat_code == 'YSHYF'){//核销（应收核应付）\n    Wb.run({\n        url: 'm?xwl=xc/ar/cancel/XC_AR_CANCEL_H_NO_C', \n        success: function(app) {\n            app.initWin({\n                AR_CANCEL_H_ID:source_id,\n                IS_INSERT:'S',\n                hideFun:function(){\n                    Wb.isInsert = 'N';\n                }\n            });\n        }\n    });\n}\nelse if(ap_doc_cat_code == 'YUFK' || ap_doc_cat_code == 'CGJS'){//申请\n    Wb.run({\n        url: 'm?xwl=xc/ap/req/XC_AP_PAY_REQ_H_NO_C', \n        success: function(app) {\n            app.initWin({\n                AP_PAY_REQ_H_ID:source_id,\n                IS_INSERT:'S',\n                AP_DOC_CAT_CODE:ap_doc_cat_code,\n                hideFun:function(){\n                    Wb.isInsert = 'N';\n                }\n            });\n        }\n    });\n}\nelse if(ap_doc_cat_code == 'YUETZD'){//调整\n    Wb.run({\n        url: 'm?xwl=xc/ap/adj/XC_AP_INV_GL_ADJ_NO_C', \n        success: function(app) {\n            app.initWin({\n                GL_ADJ_ID:source_id,\n                IS_INSERT:'S',\n                hideFun:function(){\n                    Wb.isInsert = 'N';\n                }\n            });\n        }\n    });\n}\nelse if(ap_doc_cat_code == 'FKD_CGJS' || ap_doc_cat_code == 'FKD_CGJS-H' || ap_doc_cat_code == 'FKD_YUFK' || ap_doc_cat_code == 'FKD_YUFK-H'){//结算付款\n    Wb.run({\n        url: 'm?xwl=xc/ap/pay/XC_AP_PAY_H_NO_C', \n        success: function(app) {\n            app.initWin({\n                AP_PAY_H_ID:source_id,\n                IS_INSERT:'S',\n                AP_DOC_CAT_CODE:ap_doc_cat_code,\n                hideFun:function(){\n                   Wb.isInsert = 'N';\n                }\n            });\n        }\n    });\n}"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#order#}","align":"center","xtype":"rownumberer","width":"50","titleAlign":"center","itemId":"ORDERBY"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#AP_DOC_CAT_NAME#}","width":"160","dataIndex":"AP_DOC_CAT_NAME","titleAlign":"center","itemId":"AP_DOC_CAT_NAME_COL","renderer":"if('{#language#}' == 'zh'){\n\tif(value === '应付单')\n\t\tvalue = '应付单';\n\tif(value === '应付单-红字')\n\t\tvalue = '应付单-红字';\n\tif(value === '应付红蓝对冲')\n\t\tvalue = '应付红蓝对冲';\n\tif(value === '应付核应收')\n\t\tvalue = '应付核应收';\n\tif(value === '应收核应付')\n\t\tvalue = '应收核应付';\n\tif(value === '应付核销预付')\n\t\tvalue = '应付核销预付';\n\tif(value === '应付调整单')\n\t\tvalue = '应付调整单';\n\tif(value === '采购结算')\n\t\tvalue = '采购结算';\n\tif(value === '采购结算')\n\t\tvalue = '采购结算';\n\tif(value === '采购结算-红字')\n\t\tvalue = '采购结算-红字';\n}\nelse if('{#language#}' == 'en'){\n\tif(value === '应付单')\n\t\tvalue = 'Pay Doc';\n\tif(value === '应付单-红字')\n\t\tvalue = 'Pay Doc-Letter';\n\tif(value === '应付红蓝对冲')\n\t\tvalue = 'Red and blue hedge';\n\tif(value === '应付核应收')\n\t\tvalue = 'Accounts payable';\n\tif(value === '应收核应付')\n\t\tvalue = 'Accounts receivable';\n\tif(value === '应付核销预付')\n\t\tvalue = 'Pay off in advance';\n\tif(value === '应付调整单')\n\t\tvalue = 'Adjustment sheet';\n\tif(value === '采购结算')\n\t\tvalue = 'Procurement settlement';\n\tif(value === '采购结算')\n\t\tvalue = 'Procurement settlement';\n\tif(value === '采购结算-红字')\n\t\tvalue = 'Procurement settlement-Letter';\n}\nreturn value;"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#SOURCE_CODE#}","width":"200","dataIndex":"AP_DOC_CODE","titleAlign":"center","itemId":"AP_DOC_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#GL_DATE#}","width":"100","xtype":"datecolumn","dataIndex":"GL_DATE","titleAlign":"center","itemId":"GL_DATE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#DESCRIPTION#}","width":"200","dataIndex":"DESCRIPTION","titleAlign":"center","itemId":"DESCRIPTION_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#DFJE#}","align":"right","width":"120","dataIndex":"DFJE","format":"0,000.00","titleAlign":"center","itemId":"DFJE_COL","renderer":"if(value === null || value === '')\n    return Wb.format(0,'0,000.00');\nelse\n    return Wb.format(value,'0,000.00');"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#JFJE#}","align":"right","width":"120","dataIndex":"JFJE","format":"0,000.00","titleAlign":"center","itemId":"JFJE_COL","renderer":"if(value === null || value === '')\n    return Wb.format(0,'0,000.00');\nelse\n    return Wb.format(value,'0,000.00');"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#REQ_AMOUNT#}","align":"right","width":"120","dataIndex":"SQJE","format":"0,000.00","titleAlign":"center","itemId":"SQJE_COL","renderer":"if(value === null || value === '')\n    return Wb.format(0,'0,000.00');\nelse\n    return Wb.format(value,'0,000.00');"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#AMOUNT#}","align":"right","width":"120","dataIndex":"INV_AMOUNT","format":"0,000.00","titleAlign":"center","itemId":"AMOUNT_COL"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"window"}],"expanded":true,"type":"module"}],"pageLink":"{container:false}","iconCls":""}