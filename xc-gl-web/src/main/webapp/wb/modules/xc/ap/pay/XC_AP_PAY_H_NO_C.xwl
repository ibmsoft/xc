{"inframe":false,"title":"付款单录入-采购结算","hidden":false,"roles":{"default":1},"children":[{"configs":{"serverScript":"// 获取模块语言对应的json文件\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xc/ap/pay/XC_AP_PAY_H_NO_C\");\nvar contextPath = request.getContextPath();\nrequest.setAttribute(\"contextPath\",contextPath);\n\n// var headId = request.getParameter(\"headId\");\n// request.setAttribute('headId',headId);\nrequest.setAttribute('opmode','view');\nrequest.setAttribute('vtype','normal');","itemId":"module"},"events":{"initialize":"Wb.isInsert = 'Y';//操作类型\nWb.docCatCode = 'CGJS';//付款单单据类型\nWb.h_ap_inv_gl_h_id = '';//应付单id\nWb.h_ap_pay_req_h_id = '';//付款申请单id\nWb.h_ap_pay_h_id = '';//付款单id-红字冲销（传过来的付款单id）\nWb.flag = '';//是否是全额支付\nWb.recordFormData = null;//记录表单数据\n\nExt.apply(app, {\n  grid: null,\n  initWin: function(params) {\n    Ext.apply(app, params);\n    //显示窗口\n    app.editWinN = new Ext.window.Window(app.editWinN);\n    app.editWinN.show();\n    //参数赋值\n    app.AP_DOC_CAT_CODE.setValue(params.AP_DOC_CAT_CODE);\n    Wb.isInsert = params.IS_INSERT;\n    Wb.docCatCode = params.AP_DOC_CAT_CODE;\n    Wb.h_ap_inv_gl_h_id = params.H_AP_INV_GL_H_ID;\n    Wb.h_ap_pay_req_h_id = params.H_AP_PAY_REQ_H_ID;\n    Wb.h_ap_pay_h_id = params.AP_PAY_H_ID;\n    Wb.flag = params.flag;\n    var sourceData;\n    if (Wb.docCatCode == 'FKD_CGJS') {//采购结算-篮字\n      app.grid = app.grid1;\n      sourceData = [\n        { 'VALUE' : 'GL_L' , 'NAME' : '{#GL_L#}' },\n        { 'VALUE' : 'REQ' , 'NAME' : '{#REQ#}'}\n      ];\n      app.SOURCE.getStore().loadData(sourceData,false);\n      app.SOURCE.setValue('GL_L');\n    }\n    if (Wb.docCatCode == 'FKD_CGJS-H') {//采购结算-红字\n      app.grid = app.grid2;\n      sourceData = [\n        { 'VALUE' : 'GL_H' , 'NAME' : '{#GL_H#}'}\n      ];\n      app.SOURCE.getStore().loadData(sourceData,false);\n      app.SOURCE.setValue('GL_H');\n    }\n    if (Wb.docCatCode == 'FKD_YUFK') {\n      app.grid = app.grid3;\n      sourceData = [\n        { 'VALUE' : 'REQ' , 'NAME' : '{#REQ#}'},\n        { 'VALUE' : 'TEMP' , 'NAME' : '{#TEMP#}'}\n      ];\n      app.SOURCE.getStore().loadData(sourceData,false);\n      app.SOURCE.setValue('REQ');\n      app.AP_CONTRACT_ID_XWL.AP_CONTRACT_NAME.allowBlank = false;\n    }\n    if (Wb.docCatCode == 'FKD_YUFK-H') {\n      app.grid = app.grid4;\n      sourceData = [\n        { 'VALUE' : 'PAY' , 'NAME' : '{#PAY#}'},\n        { 'VALUE' : 'TEMP' , 'NAME' : '{#TEMP#}'}\n      ];\n      app.SOURCE.getStore().loadData(sourceData,false);\n      app.SOURCE.setValue('PAY');\n      app.AP_CONTRACT_ID_XWL.AP_CONTRACT_NAME.allowBlank = false;\n    }\n    if (Wb.docCatCode == 'FKD_QTFK') {\n      app.grid = app.grid5;\n      app.td_2_4.hide();\n      sourceData = [\n        { 'VALUE' : 'REQ' , 'NAME' : '{#REQ#}'},\n        { 'VALUE' : 'TEMP' , 'NAME' : '{#TEMP#}'}\n      ];\n      app.SOURCE.getStore().loadData(sourceData,false);\n      app.SOURCE.setValue('REQ');\n    }\n    if (Wb.docCatCode == 'FKD_QTFK-H') {\n      app.grid = app.grid6;\n      app.td_2_4.hide();\n      sourceData = [\n        { 'VALUE' : 'TEMP' , 'NAME' : '{#TEMP#}'}\n      ];\n      app.SOURCE.getStore().loadData(sourceData,false);\n      app.SOURCE.setValue('TEMP');\n    }\n    app.LEDGER_ID_XWL.LEDGER_NAME.allowBlank = false;\n    app.VENDOR_ID_XWL.VENDOR_NAME.allowBlank = false;\n    \n    //显示、加载表格\n    app.grid.show();\n    app.grid.store.load({\n      params:{AP_PAY_H_ID: app.AP_PAY_H_ID.getValue()}\n    });\n    \n    //付款单-新增\n    if(Wb.isInsert == \"Y\" && Wb.isEmpty(Wb.h_ap_inv_gl_h_id) && Wb.isEmpty(Wb.h_ap_pay_req_h_id)){\n      //初始化数据\n      var ledger_store = app.LEDGER_ID_XWL.LEDGER_NAME.getPicker().getStore();\n      ledger_store.load({\n        scope : this,\n        callback : function(records, operation, success){\n          app.LEDGER_ID_XWL.LEDGER_ID.setValue(records[0].data.LEDGER_ID);\n          app.LEDGER_ID_XWL.LEDGER_NAME.setValue(records[0].data.LEDGER_NAME);\n          returnRowFn(records[0], \"xc_gl_ledgers\");\n          //updateGlDATEMinValue(records[0].data.LEDGER_ID);//最小日期\n          app.GL_DATE.setValue(new Date());\n          app.CREATED_BY_NAME.setValue('{#XIP.empName#}');//制单人\n          \n        }\n      });\n\n    }\n    \n    //应付单-全额支付\n    if(Wb.isInsert == \"Y\" && !Wb.isEmpty(Wb.h_ap_inv_gl_h_id) && Wb.isEmpty(Wb.h_ap_pay_req_h_id)){\n      Wb.h_ap_pay_h_id = Xip.getId();//付款单id\n      app.addBtn.hide();//隐藏新增按钮\n      //根据id查询应付单信息\n      Wb.request({\n        async:false,\n        url:'m?xwl=xc/ap/pay/DB/select_inv_by_id',\n        params:{AP_INV_GL_H_ID:Wb.h_ap_inv_gl_h_id},\n        success:function(resp){\n          var data = Wb.decode(resp.responseText);\n          updateGlDATEMinValue(data.LEDGER_ID);//最小日期\n          data.GL_DATE = new Date();// 将入账日期设为当前日期  \n          Wb.setValue(app.editWinN, data);//赋值\n          app.CREATED_BY_NAME.setValue('{#XIP.empName#}');//制单人\n          app.LEDGER_ID_XWL.LEDGER_NAME.setReadOnly(true);\n          app.VENDOR_ID_XWL.VENDOR_NAME.setReadOnly(true);\n          app.DEPT_ID_XWL.DEPT_NAME.setReadOnly(true);\n          app.PROJECT_ID_XWL.PROJECT_NAME.setReadOnly(true);\n          app.AP_CONTRACT_ID_XWL.AP_CONTRACT_NAME.setReadOnly(true);\n          app.SOURCE.setReadOnly(true);\n          app.DESCRIPTION.setReadOnly(true);\n          \n          app.VENDOR_ID_XWL.QUERY_LEDGER_ID.setValue(data.LEDGER_ID);\n          app.DEPT_ID_XWL.QUERY_LEDGER_ID.setValue(data.LEDGER_ID);\n          app.PROJECT_ID_XWL.QUERY_LEDGER_ID.setValue(data.LEDGER_ID);\n          app.PROJECT_ID_XWL.QUERY_DEPT_ID.setValue(data.DEPT_ID);\n          app.AP_CONTRACT_ID_XWL.QUERY_LEDGER_ID.setValue(data.LEDGER_ID);\n          app.AP_CONTRACT_ID_XWL.QUERY_VENDOR_ID.setValue(data.VENDOR_ID);\n          app.DEPOSIT_BANK_NAME_XWL.QUERY_LEDGER_ID.setValue(data.LEDGER_ID);\n          app.PAY_ACC_ID_PICK_XWL.QUERY_LEDGER_ID.setValue(data.LEDGER_ID);\n          app.ACCOUNT_NAME_XWL.QUERY_VENDOR_ID.setValue(data.VENDOR_ID);\n          //新增行\n          app.grid.store.load({\n            params:{AP_PAY_H_ID: Wb.h_ap_pay_h_id},\n            scope: this,\n            callback: function(records, operation, success) {\n              Wb.add(app.grid,{\n                AP_PAY_H_ID : Wb.h_ap_pay_h_id,\n                AP_PAY_L_ID : Xip.getId(),\n                AP_INV_GL_H_ID : data.AP_INV_GL_H_ID,\n                AP_INV_GL_H_CODE : data.AP_INV_GL_H_CODE,\n                DEPT_ID\t: data.DEPT_ID,\n                DEPT_NAME : data.DEPT_NAME,\n                AP_CONTRACT_ID : data.AP_CONTRACT_ID,\n                AP_CONTRACT_NAME : data.AP_CONTRACT_NAME,\n                AP_DOC_CAT_CODE : data.INV_AP_DOC_CAT_CODE,\n                PROJECT_ID : data.PROJECT_ID,\n                PROJECT_NAME : data.PROJECT_NAME,\n                AMOUNT : data.AMOUNT,\n                ACC_ID : data.AP_ACC_ID_DEBT,\n                ACC_NAME : data.AP_ACC_NAME_DEBT,\n                DESCRIPTION : data.DESCRIPTION\n              },'last',0,false);\n            }\n          });\n          Wb.recordFormData = Wb.encode(Wb.getValue(app.form1));//记录表单数据\n          \n          \n        }\n      });\n      \n    }\n    \n    //申请单-全额支付\n    if(Wb.isInsert == \"Y\" && Wb.isEmpty(Wb.h_ap_inv_gl_h_id) && !Wb.isEmpty(Wb.h_ap_pay_req_h_id)){\n      \n    }\n    \n    //付款单-修改\n    if(Wb.isInsert == \"N\" && !Wb.isEmpty(Wb.h_ap_pay_h_id)){\n      Wb.request({\n        url: 'm?xwl=xc/ap/pay/DB/XC_AP_PAY_H_SELECT_BY_ID',\n        params: {AP_PAY_H_ID: Wb.h_ap_pay_h_id},\n        success: function(resp) {\n          var r = Wb.decode(resp.responseText);\n          r.GL_DATE = Wb.strToDate(r.GL_DATE);\n          if (r.V_STATUS == \"1\" || r.V_STATUS === '' || r.V_STATUS === null) {\n            app.saveBtn.setDisabled(false);\n            app.verfyBtn.setDisabled(false);\n            app.cancelVerfyBtn.setDisabled(true);\n          } else {\n            app.saveBtn.setDisabled(true);\n            app.verfyBtn.setDisabled(true);\n            app.cancelVerfyBtn.setDisabled(false);\n          }\n          app.LEDGER_ID_XWL.LEDGER_ID.setValue(r.LEDGER_ID);\n          updateGlDATEMinValue(r.LEDGER_ID);//最小日期\n          app.PAY_TYPE.getStore().load();//加载付款方式\n          Wb.setValue(app.editWinN, r);\n          ///////////////////\n          app.VENDOR_ID_XWL.QUERY_LEDGER_ID.setValue(r.LEDGER_ID);\n          app.PROJECT_ID_XWL.QUERY_LEDGER_ID.setValue(r.LEDGER_ID);\n          app.DEPT_ID_XWL.QUERY_LEDGER_ID.setValue(r.LEDGER_ID);\n          app.DEPOSIT_BANK_NAME_XWL.QUERY_LEDGER_ID.setValue(r.LEDGER_ID);\n          app.PAY_ACC_ID_PICK_XWL.QUERY_LEDGER_ID.setValue(r.LEDGER_ID);\n\n          app.ACCOUNT_NAME_XWL.QUERY_VENDOR_ID.setValue(r.VENDOR_ID);\n          app.CREATED_BY_NAME.setValue(r.CREATED_BY_NAME);\n          app.SIGNATORY.setValue(r.SIGN_USER_NAME);\n          //为合同名称加上筛选条件\n          app.AP_CONTRACT_ID_XWL.QUERY_VENDOR_ID.setValue(r.VENDOR_ID);\n          app.AP_CONTRACT_ID_XWL.QUERY_LEDGER_ID.setValue(r.LEDGER_ID);\n          app.grid.store.load({\n            params:{AP_PAY_H_ID: Wb.h_ap_pay_h_id},\n            callback : function(records, operation, success){\n              if(Wb.docCatCode.indexOf('CGJS') > -1 || Wb.docCatCode.indexOf('QTFK') > -1){\n                app.PROJECT_ID_XWL.PROJECT_NAME.setReadOnly(true);\n              }else{\n                app.PROJECT_ID_XWL.PROJECT_NAME.setReadOnly(false);\n              }\n            }\n          });\n\n          app.LEDGER_ID_XWL.LEDGER_NAME.setReadOnly(true);\n          app.SOURCE.setReadOnly(true);\n          //项目置灰\n          \n          Wb.recordFormData = Wb.encode(Wb.getValue(app.form1));//记录表单数据\n\n        }\n      });\n    }\n    \n    //查看\n    if(Wb.isInsert == \"S\" && !Wb.isEmpty(Wb.h_ap_pay_h_id)){\n      Wb.request({\n        url: 'm?xwl=xc/ap/pay/DB/XC_AP_PAY_H_SELECT_BY_ID',\n        params: {AP_PAY_H_ID: Wb.h_ap_pay_h_id},\n        success: function(resp) {\n          var r = Wb.decode(resp.responseText);\n          updateGlDATEMinValue(r.LEDGER_ID);//最小日期\n          r.GL_DATE = Wb.strToDate(r.GL_DATE);\n          app.LEDGER_ID_XWL.LEDGER_ID.setValue(r.LEDGER_ID);\n          app.PAY_TYPE.getStore().load();//加载付款方式\n          Wb.setValue(app.editWinN, r);\n          app.SIGNATORY.setValue(r.SIGN_USER_NAME);\n          app.grid.store.load({\n            params:{AP_PAY_H_ID: Wb.h_ap_pay_h_id}\n          });\n          setReadOnly1();\n          setReadOnly2();\n          \n          app.saveBtn.setDisabled(true);\n          \n        }\n      });\n\n      app.form1Tbar.hide();\n      app.grid1Tbar.hide();\n      app.grid2Tbar.hide();\n      app.grid3Tbar.hide();\n      app.grid4Tbar.hide();\n      app.grid5Tbar.hide();\n      app.grid6Tbar.hide();\n      Wb.reload(app.payTypeStore);\n    }\n    \n\n    \n\n       \n    }\n});\n\n\n////\nfunction returnRowFn(r, type) {\n  //选择账簿后给相关的组件赋值\n  if(type=='xc_gl_ledgers'){\n    updateGlDATEMinValue(r.data.LEDGER_ID);//最小日期\n    //供应商\n    app.VENDOR_ID_XWL.QUERY_LEDGER_ID.setValue(r.data.LEDGER_ID);\n    app.VENDOR_ID_XWL.VENDOR_ID.reset();\n    app.VENDOR_ID_XWL.VENDOR_NAME.reset();\n    //部门\n    app.DEPT_ID_XWL.QUERY_LEDGER_ID.setValue(r.data.LEDGER_ID);\n    app.DEPT_ID_XWL.DEPT_ID.reset();\n    app.DEPT_ID_XWL.DEPT_NAME.reset();\n    //项目\n    app.PROJECT_ID_XWL.QUERY_LEDGER_ID.setValue(r.data.LEDGER_ID);\n    app.PROJECT_ID_XWL.QUERY_DEPT_ID.reset();\n    app.PROJECT_ID_XWL.PROJECT_ID.reset();\n    app.PROJECT_ID_XWL.PROJECT_NAME.reset();\n    //合同\n    app.AP_CONTRACT_ID_XWL.QUERY_LEDGER_ID.setValue(r.data.LEDGER_ID);\n    app.AP_CONTRACT_ID_XWL.QUERY_VENDOR_ID.reset();\n    app.AP_CONTRACT_ID_XWL.AP_CONTRACT_ID.reset();\n    app.AP_CONTRACT_ID_XWL.AP_CONTRACT_NAME.reset();\n    //付款账户\n    app.DEPOSIT_BANK_NAME_XWL.QUERY_LEDGER_ID.setValue(r.data.LEDGER_ID);\n    app.DEPOSIT_BANK_NAME_XWL.DEPOSIT_BANK_ID.reset();\n    app.DEPOSIT_BANK_NAME_XWL.D_B_NAME.reset();\n    //付款科目\n    app.PAY_ACC_ID_PICK_XWL.QUERY_LEDGER_ID.setValue(r.data.LEDGER_ID);\n    app.PAY_ACC_ID_PICK_XWL.PAY_ACC_ID.reset();\n    app.PAY_ACC_ID_PICK_XWL.PAY_ACC_NAME.reset();\n    //开户名\n    app.ACCOUNT_NAME_XWL.QUERY_VENDOR_ID.reset();\n    app.ACCOUNT_NAME_XWL.ACCOUNT_NAME.reset();\n    app.DEPOSIT_BANK_NAME.reset();\n    app.BANK_ACCOUNT.reset();\n  }\n  //选择供应商后\n  if (type == 'xc_ap_vendors') {\n    //合同\n    app.AP_CONTRACT_ID_XWL.QUERY_VENDOR_ID.setValue(r.data.VENDOR_ID);\n    app.AP_CONTRACT_ID_XWL.AP_CONTRACT_ID.reset();\n    app.AP_CONTRACT_ID_XWL.AP_CONTRACT_NAME.reset();\n    //开户行\n    app.ACCOUNT_NAME_XWL.QUERY_VENDOR_ID.setValue(r.data.VENDOR_ID); \n    app.ACCOUNT_NAME_XWL.ACCOUNT_NAME.reset();\n    app.DEPOSIT_BANK_NAME.reset();\n    app.BANK_ACCOUNT.reset();\n  }\n  //选择部门后\n  if(type == 'xip_pub_depts') {\n    app.PROJECT_ID_XWL.QUERY_DEPT_ID.setValue(r.data.DEPT_ID);\n    app.PROJECT_ID_XWL.PROJECT_ID.reset();\n    app.PROJECT_ID_XWL.PROJECT_NAME.reset();\n  }  \n  //选择项目后\n  if(type == 'xc_pm_projects') {\n    if(Wb.isEmpty(app.DEPT_ID_XWL.DEPT_ID.getValue())){//回带部门\n      app.PROJECT_ID_XWL.QUERY_DEPT_ID.setValue(r.data.DEPT_ID);\n      app.DEPT_ID_XWL.DEPT_ID.setValue(r.data.DEPT_ID);\n      app.DEPT_ID_XWL.DEPT_NAME.setValue(r.data.DEPT_NAME);\n    }\n  }\n  //选择合同名称后\n  if (type == 'xc_ap_contract') {\n    if(Wb.isEmpty(app.VENDOR_ID_XWL.VENDOR_ID.getValue())){//回带供应商\n      app.AP_CONTRACT_ID_XWL.QUERY_VENDOR_ID.setValue(r.data.VENDOR_ID);\n      app.VENDOR_ID_XWL.VENDOR_ID.setValue(r.data.VENDOR_ID);\n      app.VENDOR_ID_XWL.VENDOR_NAME.setValue(r.data.VENDOR_NAME);\n      app.ACCOUNT_NAME_XWL.QUERY_VENDOR_ID.setValue(r.data.VENDOR_ID);\n    }\n  }\n  //选择付款账户后\n  if(type=='xc_gl_ld_deposit_bank'){\n    app.PAY_ACC_ID_PICK_XWL.PAY_ACC_ID.setValue(r.data.ACC_ID);\n    app.PAY_ACC_ID_PICK_XWL.PAY_ACC_NAME.setValue(r.data.ACC_NAME);\n  }\n  //选择开户行后\n  if(type=='xc_ap_vendor_banks'){\n    app.DEPOSIT_BANK_NAME.setValue(r.data.DEPOSIT_BANK_NAME);\n    app.BANK_ACCOUNT.setValue(r.data.BANK_ACCOUNT);\n  }\n}\nfunction clearOtherFn(type) {\n  if(type=='xc_gl_ledgers'){\n    //账簿\n    app.LEDGER_ID_XWL.LEDGER_ID.reset();\n    app.LEDGER_ID_XWL.LEDGER_NAME.reset();\n    //供应商\n    app.VENDOR_ID_XWL.QUERY_LEDGER_ID.reset();\n    app.VENDOR_ID_XWL.VENDOR_ID.reset();\n    app.VENDOR_ID_XWL.VENDOR_NAME.reset();\n    //部门\n    app.DEPT_ID_XWL.QUERY_LEDGER_ID.reset();\n    app.DEPT_ID_XWL.DEPT_ID.reset();\n    app.DEPT_ID_XWL.DEPT_NAME.reset();\n    //项目\n    app.PROJECT_ID_XWL.QUERY_LEDGER_ID.reset();\n    app.PROJECT_ID_XWL.QUERY_DEPT_ID.reset();\n    app.PROJECT_ID_XWL.PROJECT_ID.reset();\n    app.PROJECT_ID_XWL.PROJECT_NAME.reset();\n    //合同\n    app.AP_CONTRACT_ID_XWL.QUERY_LEDGER_ID.reset();\n    app.AP_CONTRACT_ID_XWL.QUERY_VENDOR_ID.reset();\n    app.AP_CONTRACT_ID_XWL.AP_CONTRACT_ID.reset();\n    app.AP_CONTRACT_ID_XWL.AP_CONTRACT_NAME.reset();\n    //付款账户\n    app.DEPOSIT_BANK_NAME_XWL.QUERY_LEDGER_ID.reset();\n    app.DEPOSIT_BANK_NAME_XWL.DEPOSIT_BANK_ID.reset();\n    app.DEPOSIT_BANK_NAME_XWL.D_B_NAME.reset();\n    //付款科目\n    app.PAY_ACC_ID_PICK_XWL.QUERY_LEDGER_ID.reset();\n    app.PAY_ACC_ID_PICK_XWL.PAY_ACC_ID.reset();\n    app.PAY_ACC_ID_PICK_XWL.PAY_ACC_NAME.reset();\n    //开户名\n    app.ACCOUNT_NAME_XWL.QUERY_VENDOR_ID.reset();\n    app.ACCOUNT_NAME_XWL.ACCOUNT_NAME.reset();\n    app.DEPOSIT_BANK_NAME.reset();\n    app.BANK_ACCOUNT.reset();\n  }\n  //清空供应商信息时，同时清空合同名称信息\n  if(type == 'xc_ap_vendors') {\n    //清空合同相关信息\n    app.AP_CONTRACT_ID_XWL.QUERY_VENDOR_ID.reset();\n    app.AP_CONTRACT_ID_XWL.AP_CONTRACT_ID.reset();\n    app.AP_CONTRACT_ID_XWL.AP_CONTRACT_NAME.reset();\n    //清空开户名相关信息\n    app.ACCOUNT_NAME_XWL.QUERY_VENDOR_ID.reset();\n    app.ACCOUNT_NAME_XWL.ACCOUNT_NAME.reset();\n    app.DEPOSIT_BANK_NAME.reset();\n    app.BANK_ACCOUNT.reset();\n  }\n  //清空部门同时\n  if(type == 'xip_pub_depts') {\n    //项目\n    app.PROJECT_ID_XWL.QUERY_DEPT_ID.reset();\n    app.PROJECT_ID_XWL.PROJECT_ID.reset();\n    app.PROJECT_ID_XWL.PROJECT_NAME.reset();\n  }\n}\n//清空开户名的同时开户行和账户信息\nfunction clearBank(type) {\n    if (type == 'bank') {\n        app.DEPOSIT_BANK_NAME.reset();\n        app.BANK_ACCOUNT.reset();\n    }\n}\n\n//清空付款账户的同时清空付款科目\nfunction clearPayAcc(type) {\n    if (type == 'payAcc') {\n        app.PAY_ACC_ID.reset();\n        app.PAY_ACC_NAME.reset();\n    }\n}\n//将前三行信息设为只读\nfunction setReadOnly1(){\n  app.LEDGER_ID_XWL.LEDGER_NAME.setReadOnly(true);\n  app.GL_DATE.setReadOnly(true);\n  app.VENDOR_ID_XWL.VENDOR_NAME.setReadOnly(true);\n  app.DEPT_ID_XWL.DEPT_NAME.setReadOnly(true);\n  app.PROJECT_ID_XWL.PROJECT_NAME.setReadOnly(true);\n  app.AP_CONTRACT_ID_XWL.AP_CONTRACT_NAME.setReadOnly(true);\n  app.SOURCE.setReadOnly(true);\n  app.DESCRIPTION.setReadOnly(true);\n  \n}\n//将付款信息和供应商银行设为只读\nfunction setReadOnly2(){\n  app.PAY_TYPE.setReadOnly(true);\n  app.DEPOSIT_BANK_NAME_XWL.D_B_NAME.setReadOnly(true);\n  app.PAY_ACC_ID_PICK_XWL.PAY_ACC_NAME.setReadOnly(true);\n  app.CA_NAME_XWL.CA_NAME.setReadOnly(true);\n  \n  app.ACCOUNT_NAME_XWL.ACCOUNT_NAME.setReadOnly(true);\n  app.DEPOSIT_BANK_NAME.setReadOnly(true);\n  app.BANK_ACCOUNT.setReadOnly(true);\n}\n\n//项目置灰\nfunction setProjectReadOnly(flag){\n  app.PROJECT_ID_XWL.PROJECT_NAME.setReadOnly(flag);\n}\n\n\n//判断单据是否被修改过\nfunction whetherModified(){\n  var a = Wb.encode(Wb.getValue(app.form1));//记录表单数据\n  if(a != Wb.recordFormData){//判断表单数据是否相等\n    return true;\n  }\n  var count1 = app.grid.getStore().getModifiedRecords().length;//被修改的记录数\n  if(count1 > 0){\n    return true;\n  }\n  var count2 = app.grid.getStore().getRemovedRecords().length;//被删除的记录数\n  if(count2 > 0){\n    return true;\n  }\n  return false;\n}\n\n/*\n  修改业务日期最小值（业务日期不可小于账簿开始会计期）\n  参数是账簿id\n*/\nfunction updateGlDATEMinValue(ledgerId){\n  Wb.request({\n    async : false,\n    url : 'm?xwl=xc/ap/pay/DB/selectLedgerStartDate',\n    params : {LEDGER_ID : ledgerId},\n    success : function(resp){\n\n      var startDate = Wb.decode(resp.responseText).START_DATE;\n      if(!Wb.isEmpty(startDate)){\n        app.GL_DATE.setMinValue(Wb.strToDate(startDate));\n      }else{\n        app.GL_DATE.setMinValue();\n      }\n      \n    }\n  });\n}\n\n"},"children":[{"configs":{"itemId":"request"},"children":[{"configs":{"itemId":"ldInitStore","url":"m?xwl=xc/com-lov/LEDGER_ID_PICK/DB/XC_GL_LEDGERS_SELECT_SEC"},"events":{"load":"\nif (Wb.isInsert == 'Y') {\n  if(Wb.isEmpty(Wb.h_ap_inv_gl_h_id)){\n    app.LEDGER_ID_XWL.LEDGER_ID.setValue(store.getAt(0).get('LEDGER_ID'));\n\tapp.LEDGER_ID_XWL.LEDGER_NAME.setValue(store.getAt(0).get('LEDGER_NAME'));\n\tapp.VENDOR_ID_XWL.QUERY_LEDGER_ID.setValue(store.getAt(0).get('LEDGER_ID'));\n\tapp.PROJECT_ID_XWL.QUERY_LEDGER_ID.setValue(store.getAt(0).get('LEDGER_ID'));\n\tapp.DEPT_ID_XWL.QUERY_LEDGER_ID.setValue(store.getAt(0).get('LEDGER_ID'));\n\tapp.AP_CONTRACT_ID_XWL.QUERY_LEDGER_ID.setValue(store.getAt(0).get('LEDGER_ID'));\n\tapp.DEPOSIT_BANK_NAME_XWL.QUERY_LEDGER_ID.setValue(store.getAt(0).get('LEDGER_ID'));\n\tapp.PAY_ACC_ID_PICK_XWL.QUERY_LEDGER_ID.setValue(store.getAt(0).get('LEDGER_ID'));\n  }\n  if(Wb.isEmpty(Wb.h_ap_pay_req_h_id)){\n    app.LEDGER_ID_XWL.LEDGER_ID.setValue(store.getAt(0).get('LEDGER_ID'));\n\tapp.LEDGER_ID_XWL.LEDGER_NAME.setValue(store.getAt(0).get('LEDGER_NAME'));\n\tapp.VENDOR_ID_XWL.QUERY_LEDGER_ID.setValue(store.getAt(0).get('LEDGER_ID'));\n\tapp.PROJECT_ID_XWL.QUERY_LEDGER_ID.setValue(store.getAt(0).get('LEDGER_ID'));\n\tapp.DEPT_ID_XWL.QUERY_LEDGER_ID.setValue(store.getAt(0).get('LEDGER_ID'));\n\tapp.AP_CONTRACT_ID_XWL.QUERY_LEDGER_ID.setValue(store.getAt(0).get('LEDGER_ID'));\n\tapp.DEPOSIT_BANK_NAME_XWL.QUERY_LEDGER_ID.setValue(store.getAt(0).get('LEDGER_ID'));\n\tapp.PAY_ACC_ID_PICK_XWL.QUERY_LEDGER_ID.setValue(store.getAt(0).get('LEDGER_ID'));\n  }\n  \n  \n  /*Wb.request({\n  url: 'm?xwl=xc/ap/inv/DB/XC_GL_LD_DEPTS_ASG_SELECT',\n  params: {LEDGER_ID:store.getAt(0).get('LEDGER_ID')},\n  success: function(resp) {\n   var r = Wb.decode(resp.responseText);\n   app.DEPT_ID_XWL.DEPT_ID.setValue(r.DEPT_ID);\n   app.DEPT_ID_XWL.DEPT_NAME.setValue(r.DEPT_NAME);\n  }\n});*/\n\n\n}"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"folder"},{"configs":{"itemId":"form1Tbar"},"children":[{"configs":{"text":"{#addBtn#}","itemId":"addBtn"},"events":{"click":"app.form1.getForm().reset();\napp.LEDGER_ID_XWL.LEDGER_NAME.setReadOnly(false);\napp.AP_PAY_H_ID.setValue(Xip.getId());\napp.AP_DOC_CAT_CODE.setValue(Wb.docCatCode);\nWb.isInsert = 'Y';\nvar ledger_store = app.LEDGER_ID_XWL.LEDGER_NAME.getPicker().getStore();\nledger_store.load({\n  scope : this,\n  callback : function(records, operation, success){\n    app.LEDGER_ID_XWL.LEDGER_ID.setValue(records[0].data.LEDGER_ID);\n    app.LEDGER_ID_XWL.LEDGER_NAME.setValue(records[0].data.LEDGER_NAME);\n    returnRowFn(records[0], \"xc_gl_ledgers\");\n    app.GL_DATE.setValue(new Date());\n    app.CREATED_BY_NAME.setValue('{#XIP.empName#}');//制单人\n    app.SOURCE.setReadOnly(false);\n    app.SOURCE.setValue(app.SOURCE.getStore().getAt(0));\n  }\n});\napp.grid.getStore().load({\n  params : {AP_PAY_H_ID:app.AP_PAY_H_ID.getValue()}\n});\n\n//显示保存按钮\napp.saveBtn.setDisabled(false);\napp.verfyBtn.setDisabled(true);\napp.cancelVerfyBtn.setDisabled(true);\n\n//项目只白\nsetProjectReadOnly(false);\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#saveBtn#}","itemId":"saveBtn"},"events":{"click":"\nvar srcAmt = 0;\nvar grid = '';\nvar type = '';//蓝字L、红字H\n//采购结算\nif (Wb.docCatCode == 'FKD_CGJS') {\n  grid = app.grid1;\n  type = 'L';\n}\n//采购结算-红字\nif (Wb.docCatCode == 'FKD_CGJS-H') {\n  grid = app.grid2;\n  type = 'H';\n}\n//预付款\nif (Wb.docCatCode == 'FKD_YUFK') {\n  grid = app.grid3;\n  type = 'L';\n}\n//预付款-红字\nif (Wb.docCatCode == 'FKD_YUFK-H') {\n  grid = app.grid4;\n  type = 'H';\n}\n//其它付款\nif (Wb.docCatCode == 'FKD_QTFK') {\n  grid = app.grid5;\n  type = 'L';\n}\n//其它付款-红字\nif (Wb.docCatCode == 'FKD_QTFK-H') {\n  grid = app.grid6;\n  type = 'H';\n}\n\nvar getCount = grid.getStore().getCount();\nif (getCount === 0) {\n  Wb.toast('{#qxtjmxsj#}');//请先添加明细数据\n  return;\n}\nfor (var i = 0; i < getCount; i++) {\n  var r = grid.getStore().getAt(i);\n  srcAmt = srcAmt + r.get('AMOUNT');\n}\napp.AMOUNT.setValue(srcAmt);\n\n//判断金额是否合法\nif(type == 'L'){\n  if(app.AMOUNT.getValue() <= 0){Wb.toast('{#fkjeydyl#}');return false;} //付款金额应大于0\n}else{\n  if(app.AMOUNT.getValue() >= 0){Wb.toast('{#fkjeydyl#}');return false;} // 付款金额应小于0\n}\nif (!Wb.verify(app.form1)) {\n  Wb.toast('{#bdczfkxhzsrdsjbhf#}');//表单存在非空项或者输入的数据不合法\n  return;\n}\nif (!Wb.verifyGrid(grid)) {\n  Wb.toast('{#bgczfkxhzsrdsjbhf#}');//表格存在非空项或者输入的数据不合法\n  return;\n}\n\n//处理行部门、合同、项目、摘要\nfor(var i=0; i<app.grid.store.getCount(); i++){\n  var rec = app.grid.store.getAt(i);\n  rec.set('DEPT_ID',app.DEPT_ID_XWL.DEPT_ID.getValue());\n  rec.set('AP_CONTRACT_ID',app.AP_CONTRACT_ID_XWL.AP_CONTRACT_ID.getValue());\n  if(Wb.isEmpty(rec.get('DESCRIPTION'))){\n    rec.set('DESCRIPTION',app.DESCRIPTION.getValue());\n  }\n  if(Wb.docCatCode == 'FKD_YUFK' || Wb.docCatCode == 'FKD_YUFK-H'){\n    rec.set('PROJECT_ID',app.PROJECT_ID_XWL.PROJECT_ID.getValue());\n    rec.set('PROJECT_NAME',app.PROJECT_ID_XWL.PROJECT_NAME.getValue());\n  }\n}\n\n//获取行数据\nvar newRecs = Wb.getData(grid.store.getNewRecords());\nvar updateRecs = Wb.getData(grid.store.getUpdatedRecords());\nvar deleteRecs = Wb.getData(grid.store.getRemovedRecords());\n\n\nWb.request({\n  url : '{#contextPath#}/apPayBaseAction.do?method=saveApPay',\n  params : {apPayH : Wb.getValue(app.form1),\n            newRecs : newRecs,\n            updateRecs : updateRecs,\n            deleteRecs : deleteRecs,\n            opType : Wb.isInsert\n           },\n  success : function(resp){\n    var obj = Wb.decode(resp.responseText);\n    if(obj.flag == '0'){\n      Wb.toast(obj.msg);\n      app.AP_PAY_H_ID.setValue(obj.AP_PAY_H_ID); \n      app.AP_PAY_H_CODE.setValue(obj.AP_PAY_H_CODE);\n      app.V_HEAD_ID.setValue(obj.V_HEAD_ID);\n      app.V_STATUS.setValue('1');\n      Wb.isInsert = \"N\";\n      grid.store.load({\n        params : {AP_PAY_H_ID: app.AP_PAY_H_ID.getValue()}\n      });\n      Wb.recordFormData = Wb.encode(Wb.getValue(app.form1));//记录表单数据\n    }else{\n      Wb.toast(obj.msg);\n    }\n    \n  }\n});\n\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#verfyBtn#}","itemId":"verfyBtn"},"events":{"click":"//验证单据是否被修改\nif(whetherModified()){\n  Wb.toast('{#djybxg_qxbcdj#}');//单据已被修改，请先保存单据\n  return false;\n}\n\nvar ap_doc_cat_code = app.AP_DOC_CAT_CODE.getValue();//单据类型\nvar source = app.SOURCE.getValue();//来源\n\nif(app.V_STATUS.getValue() !== '1'){\n  Wb.toast('{#djyyshtg#}');//单据已经审核通过\n  return;\n}\n\n//预算控制\nif( (ap_doc_cat_code == 'FKD_QTFK' || ap_doc_cat_code == 'FKD_QTFK-H') &&  source == 'TEMP'){\n  //账簿是否启用预算检查\n  var store = app.LEDGER_ID_XWL.LEDGER_NAME.getPicker().getStore();\n  var idx = store.find('LEDGER_ID',app.LEDGER_ID_XWL.LEDGER_ID.getValue());\n  var rr = store.getAt(idx);\n  var BG_IS_CHK = rr.data.BG_IS_CHK;//预算检查：Y-是，N-否\n  if(BG_IS_CHK === \"\" || BG_IS_CHK === null || BG_IS_CHK === undefined){\n    BG_IS_CHK = 'N' ;\n  }\n  \n  var checkBudgetArray = [];\n  var checkParamJson = {isChkBg : BG_IS_CHK,apDocId:app.AP_PAY_H_ID.getValue(),apDocCat : \"FKD\"};\n  checkBudgetArray.push(checkParamJson);\n  //执行预算校验\n  Wb.request({\n    url : '{#contextPath#}' + '/apDocsAction.do?method=checkBudget',\n    params : {checkArray: checkBudgetArray},\n    success : function(resp){\n      var response = Wb.decode(resp.responseText);\n      if(response.flag == \"0\"){\n        //执行阶段：BGCHK-预算校验,QRY-单据类型信息查询\n        var phase = response.phase;\n        if(phase === 'BGCHK'){\n          //-1 校验不通过或者校验异常；0 校验通过；1校验不通过，但预算不是绝对控制，给出警告提示    \n          var chkFlag = response.chkFlag;\n          if(chkFlag === \"-1\"){\n            Wb.toast(response.msg);\n            return ;\n          }\n          else if(chkFlag === \"1\"){\n            Ext.Msg.confirm('{#jg#}',response.msg,function(id){//\n              if(id == 'yes'){\n                verfyDoc();\n              }\n            });\n          }\n        }\n        else{\n          verfyDoc();\n        }\n      }\n    }\n  });\n}else{\n//不需要进行预算控制的\n  verfyDoc();\n}\n\n\n//审核单据\nfunction verfyDoc(){\n  var docArray = [] ;\n  var paramJson = {'headId' : app.V_HEAD_ID.getValue(),'apId':app.AP_PAY_H_ID.getValue(),apCatCode:'FKD'} ;\n  docArray.push(paramJson) ;\n  Wb.request({\n    url: '{#contextPath#}'+'/apVoucherAction.do?method=checkVoucher',\n    params: Wb.apply({apInfo: docArray}),\n    success: function(resp) {\n      var record = Wb.decode(resp.responseText);\n      var msg = record.msg;\n      if(record.flag === '0'){\n        Wb.toast(msg);\n        app.V_STATUS.setValue('3');\n        app.saveBtn.setDisabled(true);\n        app.verfyBtn.setDisabled(true);\n      }\n      if(record.flag === '1'){\n        Wb.toast(msg);\n      }\n    }\n  });\n}\n\n\n\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#cancelVerfyBtn#}","itemId":"cancelVerfyBtn"},"events":{"click":"var headId = app.V_HEAD_ID.getValue();\nif(headId === '' || headId === null){\n  Wb.toast('{#qxbcsjbshdj#}');//请先保存数据，并审核单据!\n  return;\n}\nif(app.V_STATUS.getValue() === '1'){\n  Wb.toast('{#qxshdj#}');//请先审核单据\n  return;\n}\nelse{\n  var docArray = [] ;\n  var paramJson = {'headId' : app.V_HEAD_ID.getValue(),'apId':app.AP_PAY_H_ID.getValue(),apCatCode:'FKD'} ;\n  docArray.push(paramJson) ;\n  Wb.request({\n    url: '{#contextPath#}'+'/apVoucherAction.do?method=cancelCheckVoucher',\n    params: Wb.apply({apInfo: docArray}),\n    success: function(resp) {\n      var record = Wb.decode(resp.responseText);\n      var msg = record.msg;\n      if(record.flag === '0'){\n        Wb.toast(msg);\n        app.V_STATUS.setValue('1');\n        app.saveBtn.setDisabled(false);\n        app.verfyBtn.setDisabled(false);\n      }\n      if(record.flag === '1'){\n        Wb.toast(msg);\n      }\n    }\n  });\n}"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"maximized":"true","height":"600","width":"1000","layout":"fit","closeAction":"hide","itemId":"editWinN"},"events":{"hide":"app.hideFun();"},"children":[{"configs":{"itemId":"tabs"},"events":{"beforetabchange":"//加载凭证信息\nif(newCard.title === app.edit_v_xwl.xwl_v_panel.title){\n    Wb.request({\n        url: 'm?xwl=xc/gl/journal/data-db/common-data/select-v-head',\n        params: {'headId' : app.V_HEAD_ID.getValue()},\n        success: function(resp) {\n            var headJson = Wb.decode(resp.responseText);\n            Wb.setValue(app.edit_v_xwl.form1,headJson);\n            Wb.setValue(app.edit_v_xwl.bbar,headJson);\n            //处理会计日期\n            var accDate = headJson.accountDate;\n            app.edit_v_xwl.accountDate.setValue(Wb.strToDate(accDate));\n        }\n    });\n    // 加载凭证分录行\n    app.edit_v_xwl.grid1.getStore().load({params :{'headId':app.V_HEAD_ID.getValue()}});\n}"},"children":[{"configs":{"title":"{#TITLE#}","layout":"border","itemId":"tab1"},"children":[{"configs":{"region":"north","tbar":"app.form1Tbar","autoScroll":"true","layout":"auto","border":"false","itemId":"form1"},"children":[{"configs":{"style":"fontSize:20px","margin":"10 0 20 0","labelAlign":"center","itemId":"title"},"children":[],"expanded":false,"type":"label"},{"configs":{"layout":"column","margin":"10 10 10 0","border":"false","itemId":"tr1"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"fit","columnWidth":".25","itemId":"td_1_1"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/LEDGER_ID_PICK/LEDGER_ID_PICK_SEC","itemId":"LEDGER_ID_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"fit","columnWidth":".25","itemId":"td_1_2"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","allowBlank":"false","pickList":"[\n  ['FKD_CGJS','{#FKD_CGJS#}'],\n  ['FKD_YUFK','{#FKD_YUFK#}'],\n  ['FKD_QTFK','{#FKD_QTFK#}'],\n  ['FKD_CGJS-H','{#FKD_CGJS-H#}'],\n  ['FKD_YUFK-H','{#FKD_YUFK-H#}'],\n  ['FKD_QTFK-H','{#FKD_QTFK-H#}']\n]","labelAlign":"right","itemId":"AP_DOC_CAT_CODE","fieldLabel":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#AP_DOC_CAT_CODE_L#}"},"events":{"change":"\nif(newValue=='FKD_CGJS-H'||newValue=='FKD_YUFK-H'||newValue=='FKD_QTFK-H'){\n  app.title.setText('<font style=\"color:red;\">{#TITLE#}<\/font>',false);\n  app.AMOUNT.setFieldStyle('color:red;');\n}else{\n  app.title.setText('<font style=\"color:black;\">{#TITLE#}<\/font>',false);\n  app.AMOUNT.setFieldStyle('color:black;');\n}\n\nif(newValue === 'FKD_YUFK' || newValue === 'FKD_YUFK-H'){\n  app.AP_CONTRACT_ID_XWL.AP_CONTRACT_NAME.setFieldLabel('<font style=\"color:red;\">*<\/font>'+'{#AP_CONTRACT_NAME#}');\n  app.AP_CONTRACT_ID_XWL.AP_CONTRACT_NAME.allowBlank = false;\n}"},"children":[],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"fit","columnWidth":".25","itemId":"td_1_3"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","emptyText":"{#SystemAutoCreate#}","labelAlign":"right","itemId":"AP_PAY_H_CODE","fieldLabel":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#AP_PAY_H_CODE#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"fit","columnWidth":".25","itemId":"td_1_4"},"children":[{"configs":{"labelWidth":"80","allowBlank":"false","labelAlign":"right","itemId":"GL_DATE","fieldLabel":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#GL_DATE#}"},"children":[],"expanded":false,"type":"date"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"column","margin":"10 10 10 0","split":"true","border":"false","itemId":"tr2"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"fit","columnWidth":".25","itemId":"td_2_1"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/VENDOR_ID_PICK/VENDOR_ID_LD","itemId":"VENDOR_ID_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"fit","columnWidth":".25","itemId":"td_2_2"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/DEPT_ID_PICK/DEPT_ID_LD","itemId":"DEPT_ID_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"fit","columnWidth":".25","itemId":"td_1_3"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/PROJECT_ID_PICK/PROJECT_ID_LD","itemId":"PROJECT_ID_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"fit","columnWidth":".25","itemId":"td_2_4"},"children":[{"configs":{"file":"m?xwl=xc/ap/ap-com-lov/AP_CONTRACT_ID_PICK/AP_CONTRACT_ID_PICK_ALL","itemId":"AP_CONTRACT_ID_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"column","margin":"10 10 10 0","border":"false","itemId":"tr3"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"fit","columnWidth":".25","itemId":"td_3_1"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"AMOUNT","fieldLabel":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#AMOUNT#}"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"fit","columnWidth":".25","itemId":"td_3_2"},"children":[{"configs":{"labelWidth":"80","allowBlank":"false","queryMode":"local","displayField":"NAME","valueField":"VALUE","labelAlign":"right","itemId":"SOURCE","fieldLabel":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#SOURCE#}"},"events":{"change":"\nvar ap_doc_cat_code = app.AP_DOC_CAT_CODE.getValue();//获取单据类型\napp.grid.store.removeAll();//改变来源之后，把之前的数据移除store中\n\nif(ap_doc_cat_code == 'FKD_CGJS'){//采购结算\n  if(newValue == 'GL_L'){//应付单蓝\n    app.grid1InqGlBtn.show();\n    app.grid1ReqBtn.hide();\n  }else if(newValue == 'REQ'){//申请单\n    app.grid1InqGlBtn.hide();\n    app.grid1ReqBtn.show();\n  }\n}else\nif(ap_doc_cat_code == 'FKD_CGJS-H'){//采购结算红\n  if(newValue == 'GL_H'){//应付单红\n    app.grid2InqGlHBtn.show();\n  }\n}else\nif(ap_doc_cat_code == 'FKD_YUFK'){//预付款\n  if(newValue == 'REQ'){//申请单\n    app.grid3ReqBtn.show();\n    app.grid3CreateBtn.hide();\n  }else if(newValue == 'TEMP'){//手感模版\n    app.grid3ReqBtn.hide();\n    app.grid3CreateBtn.show();\n  }\n}else\nif(ap_doc_cat_code == 'FKD_YUFK-H'){//预付款红\n  if(newValue == 'PAY'){//付款单\n    app.grid4PayBtn.show();\n    app.grid4CreateBtn.hide();\n  }else if(newValue == 'TEMP'){//手感模版\n    app.grid4PayBtn.hide();\n    app.grid4CreateBtn.show();\n  }\n}else\nif(ap_doc_cat_code == 'FKD_QTFK'){//其他付款\n  if(newValue == 'REQ'){//申请单\n    app.grid5ReqBtn.show();\n    app.grid5PurTypeBtn.hide();\n  }else if(newValue == 'TEMP'){//手感模版\n    app.grid5ReqBtn.hide();\n    app.grid5PurTypeBtn.show();\n  }\n}else\nif(ap_doc_cat_code == 'FKD_QTFK-H'){//其他付款红\n  if(newValue == 'TEMP'){//手感模版\n    app.grid6purTypeBtn.show();\n  }\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"},"children":[{"configs":{"itemId":"store","fields":"[\n  {name: 'VALUE', type: 'string'},\n  {name: 'NAME',  type: 'string'}\n]"},"children":[],"expanded":false,"type":"store"}],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"fit","columnWidth":".5","itemId":"td_3_3"},"children":[{"configs":{"labelWidth":"80","allowBlank":"false","labelAlign":"right","itemId":"DESCRIPTION","fieldLabel":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#DESCRIPTION#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"title":"{#PayInformation#}","margin":"10 10 10 0","itemId":"fieldset1"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"column","margin":"5 0 10 0","itemId":"tr4"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"fit","columnWidth":".25","itemId":"td_4_1"},"children":[{"configs":{"labelWidth":"70","allowBlank":"false","displayField":"MODE_NAME","valueField":"MODE_ID","labelAlign":"right","itemId":"PAY_TYPE","fieldLabel":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#PAY_TYPE#}","editable":"false"},"events":{"select":"var rec = records[0];\n\n// if(rec.data.MODE_TYPE == 'cash'){//付款方式为 现金结算\n  \n\n// }\n\nif(rec.data.MODE_TYPE == 'bank'){//付款方式为银行并且付款科目不为空\n  app.DEPOSIT_BANK_NAME_XWL.D_B_NAME.setReadOnly(false);\n  app.DEPOSIT_BANK_NAME_XWL.D_B_NAME.allowBlank = false;\n  app.PAY_ACC_ID_PICK_XWL.PAY_ACC_ID.setValue(rec.data.PAY_ACC_ID);\n  app.PAY_ACC_ID_PICK_XWL.PAY_ACC_NAME.setValue(rec.data.PAY_ACC_NAME);\n\n}else{\n  //清空付款账户并置灰，并清空付款科目\n  app.DEPOSIT_BANK_NAME_XWL.DEPOSIT_BANK_ID.reset();\n  app.DEPOSIT_BANK_NAME_XWL.D_B_NAME.reset();\n  app.DEPOSIT_BANK_NAME_XWL.D_B_NAME.allowBlank = true;\n  app.DEPOSIT_BANK_NAME_XWL.D_B_NAME.setReadOnly(true);\n  app.PAY_ACC_ID_PICK_XWL.PAY_ACC_ID.setValue(rec.data.PAY_ACC_ID);\n  app.PAY_ACC_ID_PICK_XWL.PAY_ACC_NAME.setValue(rec.data.PAY_ACC_NAME);\n  //清空供应商银行信息\n  app.ACCOUNT_NAME_XWL.ACCOUNT_NAME.reset();\n  app.DEPOSIT_BANK_NAME.reset();\n  app.BANK_ACCOUNT.reset();\n}","change":"\n\n// Wb.request({\n//     url : 'm?xwl=xc/ap/pay/DB/payTypeSelect',\n//     params : {LEDGER_ID : app.LEDGER_ID_XWL.LEDGER_ID.getValue(),MODE_ID : newValue},//传参\n//     success : function(resp){\n//         var temp = Wb.decode(resp.responseText);//返回的数据\n//         if(temp.rows[0].MODE_TYPE == 'cash'){//付款方式为 现金结算\n//             app.DEPOSIT_BANK_NAME_XWL.DEPOSIT_BANK_ID.reset();\n//             app.DEPOSIT_BANK_NAME_XWL.D_B_NAME.reset();\n//             app.DEPOSIT_BANK_NAME_XWL.D_B_NAME.allowBlank = true;\n//             app.DEPOSIT_BANK_NAME_XWL.D_B_NAME.setReadOnly(true);\n//             //当oldValue为空的时候，说明是初始化操作\n//             if(Wb.isEmpty(oldValue) || oldValue === undefined){\n// \t\t\t\t//do nothing\n//             }else{\n//                 app.PAY_ACC_ID_PICK_XWL.PAY_ACC_ID.setValue(temp.rows[0].PAY_ACC_ID);\n//                 app.PAY_ACC_ID_PICK_XWL.PAY_ACC_NAME.setValue(temp.rows[0].PAY_ACC_NAME);\n            \n//             }\n            \n//         }\n//         if(temp.rows[0].MODE_TYPE == 'bank'){//付款方式为银行并且付款科目不为空\n//             app.DEPOSIT_BANK_NAME_XWL.D_B_NAME.setReadOnly(false);\n//             app.DEPOSIT_BANK_NAME_XWL.D_B_NAME.allowBlank = false;\n//             //当oldValue为空的时候，说明是初始化操作\n//             if(Wb.isEmpty(oldValue) || oldValue === undefined){\n// \t\t\t\t//do nothing\n//             }else{\n//                 app.PAY_ACC_ID_PICK_XWL.PAY_ACC_ID.setValue(temp.rows[0].PAY_ACC_ID);\n//                 app.PAY_ACC_ID_PICK_XWL.PAY_ACC_NAME.setValue(temp.rows[0].PAY_ACC_NAME);\n            \n//             }\n//         }\n//     }\n// });\n\n"},"children":[{"configs":{"autoSync":"false","normalName":"payTypeStore","itemId":"store","url":"m?xwl=xc/ap/pay/DB/payTypeSelect"},"events":{"beforeload":"store.proxy.extraParams.LEDGER_ID = app.LEDGER_ID_XWL.LEDGER_ID.getValue();"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"fit","columnWidth":".25","itemId":"td_4_2"},"children":[{"configs":{"file":"m?xwl=xc/ap/ap-com-lov/DEPOSIT_BANK_ID_PICK/DEPOSIT_BANK_ID_LD","itemId":"DEPOSIT_BANK_NAME_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"fit","columnWidth":".25","itemId":"td_4_3"},"children":[{"configs":{"file":"m?xwl=xc/ap/ap-com-lov/ACC_ID_PICK/PAY_ACC_ID_PICK","itemId":"PAY_ACC_ID_PICK_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"fit","columnWidth":".25","itemId":"td_4_4"},"children":[{"configs":{"file":"m?xwl=xc/ap/ap-com-lov/CA_ID_PICK/CA_ID_PICK_ALL","itemId":"CA_NAME_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"fieldset"},{"configs":{"title":"{#VendorBank#}","margin":"10 10 10 0","itemId":"fieldset2"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"column","margin":"5 0 10 0","itemId":"tr5"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"fit","columnWidth":".25","itemId":"td_5_1"},"children":[{"configs":{"file":"m?xwl=xc/ap/ap-com-lov/ACCOUNT_NAME_PICK/ACCOUNT_NAME_ALL","itemId":"ACCOUNT_NAME_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"fit","columnWidth":".25","itemId":"td_5_2"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"DEPOSIT_BANK_NAME","fieldLabel":"{#DEPOSIT_BANK_NAME#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"fit","columnWidth":".25","itemId":"td_5_3"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"BANK_ACCOUNT","fieldLabel":"{#BANK_ACCOUNT#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"fieldset"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"column","margin":"10 10 10 0","itemId":"tr8"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"fit","columnWidth":".25","itemId":"td_8_1"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"CREATED_BY_NAME","fieldLabel":"{#CREATED_BY_NAME#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"fit","columnWidth":".25","itemId":"td_8_2"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"SIGNATORY","fieldLabel":"{#SIGNATORY#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"fit","columnWidth":".245","itemId":"td_8_3"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","value":"1","labelAlign":"right","pickList":"[\n  ['1','{#CG#}'],\n  ['3','{#SHTG#}']\n]","itemId":"V_STATUS","fieldLabel":"{#V_STATUS#}"},"children":[],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"}],"expanded":false,"type":"panel"},{"configs":{"hidden":"true","itemId":"hidden_p"},"children":[{"configs":{"hidden":"true","itemId":"AP_PAY_H_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","value":"{#XIP.userId#}","itemId":"USER_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"V_HEAD_ID"},"children":[],"expanded":false,"type":"text"}],"expanded":false,"type":"panel"}],"expanded":true,"type":"form"},{"configs":{"region":"center","pagingBar":"false","selType":"checkboxmodel","hidden":"true","itemId":"grid1"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/ap/pay/DB/XC_AP_PAY_L_SELECT"},"children":[],"expanded":false,"type":"store"},{"configs":{"normalName":"grid1Tbar","itemId":"tbar"},"children":[{"configs":{"text":"{#reqBtn#}","hidden":"true","normalName":"grid1ReqBtn","itemId":"reqBtn"},"events":{"tagEvents":"{\n  show : function(button, options){\n    app.AP_PAY_REQ_H_CODE_COL1.show();\n  }\n}","click":"var ap_pay_h_id = app.AP_PAY_H_ID.getValue();//付款单id\nvar ledger_id = app.LEDGER_ID_XWL.LEDGER_ID.getValue();//账簿id\nvar vendor_id = app.VENDOR_ID_XWL.VENDOR_ID.getValue();//供应商id\nvar ap_contract_id = app.AP_CONTRACT_ID_XWL.AP_CONTRACT_ID.getValue();//合同id\nvar ap_doc_cat_code = app.AP_DOC_CAT_CODE.getValue();//单据类型\nvar project_id = app.PROJECT_ID_XWL.PROJECT_ID.getValue();//项目id\n\n\nif(Wb.isEmpty(ledger_id)){\n  Wb.toast('{#qxxzzb#}');//请先选择账簿\n  return false;\n}\nif(Wb.isEmpty(vendor_id)){\n  Wb.toast('{#qxxzgys#}');//请先选择供应商\n  return false;\n}\nvar curGrid = app.grid1;\nvar P_AP_CONTRACT_NAME = app.AP_CONTRACT_ID_XWL.AP_CONTRACT_NAME.getValue();\n\n\nWb.run({\n  url: 'm?xwl=xc/ap/pay/LOV/LOV_XC_AP_PAY_REQ_H', \n  success: function(app) {\n    app.initWin({\n      AP_PAY_H_ID : ap_pay_h_id,\n      AP_DOC_CAT_CODE : ap_doc_cat_code,\n      LEDGER_ID : ledger_id,\n      VENDOR_ID : vendor_id,\n      AP_CONTRACT_ID : ap_contract_id,\n      PROJECT_ID : project_id,\n      hideFun:function(rs){\n        Wb.each(rs, function(r) {\n          r.set('AP_PAY_L_ID',Xip.getId());\n          r.set('AP_PAY_H_ID',ap_pay_h_id);\n          var grid1Store = curGrid.getStore();\n          for(var i=0;i<grid1Store.getCount();i++){\n            var gr = grid1Store.getAt(i);\n            if(gr.get('AP_PAY_REQ_L_ID')==r.get('AP_PAY_REQ_L_ID')){\n              return false;\n            }\n          }\n\n          Wb.add(curGrid, {\n            AP_PAY_L_ID:r.get('AP_PAY_L_ID'),\n            AP_PAY_H_ID:r.get('AP_PAY_H_ID'),\n            AP_PAY_REQ_H_ID:r.get('AP_PAY_REQ_H_ID'),\n            AP_PAY_REQ_L_ID:r.get('AP_PAY_REQ_L_ID'),\n            AP_PAY_REQ_H_CODE:r.get('AP_PAY_REQ_H_CODE'),\n            AP_INV_GL_H_ID:r.get('L_AP_INV_GL_H_ID'),\n            PROJECT_ID: r.get('PROJECT_ID'),\n            ACC_ID:r.get('INV_AP_ACC_ID_DEBT'),\n            ACC_NAME:r.get('INV_AP_ACC_NAME_DEBT'),\n            CCID:r.get('INV_CCID'),\n            AP_INV_GL_H_CODE:r.get('AP_INV_GL_H_CODE'),\n            PROJECT_NAME:r.get('PROJECT_NAME'),\n            AMOUNT:r.get('PAY_AMT'),\n            DESCRIPTION:r.get('DESCRIPTION')\n          }, 'after', 1, false);\n        });\n        if(curGrid.getStore().getCount() > 0){\n          setProjectReadOnly(true);//项目置灰\n        }\n        \n      }\n    });\n  }\n});\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#inqGlBtn#}","hidden":"true","normalName":"grid1InqGlBtn","itemId":"inqGlBtn"},"events":{"tagEvents":"{\n  show : function(button, options){\n    app.AP_PAY_REQ_H_CODE_COL1.hide();\n  }\n}","click":"var ap_pay_h_id = app.AP_PAY_H_ID.getValue();//付款单id\nvar ledger_id = app.LEDGER_ID_XWL.LEDGER_ID.getValue();//账簿id\nvar vendor_id = app.VENDOR_ID_XWL.VENDOR_ID.getValue();//供应商id\nvar ap_contract_id = app.AP_CONTRACT_ID_XWL.AP_CONTRACT_ID.getValue();//合同id\nvar ap_doc_cat_code = app.AP_DOC_CAT_CODE.getValue();//单据类型\nvar project_id = app.PROJECT_ID_XWL.PROJECT_ID.getValue();//项目id\n\nif(Wb.isEmpty(ledger_id)){\n  Wb.toast('{#qxxzzb#}');//请先选择账簿\n  return false;\n}\nif(Wb.isEmpty(vendor_id)){\n  Wb.toast('{#qxxzgys#}');//请先选择供应商\n  return false;\n}\nvar curGrid = app.grid1;\n\nWb.run({\n  url: 'm?xwl=xc/ap/pay/LOV/LOV_XC_AP_INV_GL_H', \n  success: function(app) {\n    app.initWin({\n      AP_PAY_H_ID : ap_pay_h_id,\n      AP_DOC_CAT_CODE : ap_doc_cat_code,\n      LEDGER_ID : ledger_id,\n      VENDOR_ID : vendor_id,\n      AP_CONTRACT_ID : ap_contract_id,\n      PROJECT_ID : project_id,\n      hideFun:function(rs){\n        Wb.each(rs, function(r) {\n          r.set('AP_PAY_L_ID',Xip.getId());\n          r.set('AP_PAY_H_ID',ap_pay_h_id);\n          var grid1Store = curGrid.getStore();\n          for(var i=0;i<grid1Store.getCount();i++){\n            var gr = grid1Store.getAt(i);\n            if(gr.get('AP_INV_GL_H_ID')==r.get('AP_INV_GL_H_ID')){\n              return false;\n            }\n          }\n          Wb.add(curGrid, {\n            AP_PAY_L_ID:r.get('AP_PAY_L_ID'),\n            AP_PAY_H_ID:r.get('AP_PAY_H_ID'),\n            AP_INV_GL_H_ID:r.get('AP_INV_GL_H_ID'),\n            PROJECT_ID:r.get('PROJECT_ID'),\n            DEPT_ID:r.get('DEPT_ID'),\n            ACC_ID:r.get('ACC_ID'),\n            CCID:r.get('CCID'),\n            AP_CONTRACT_ID:r.get('AP_CONTRACT_ID'),\n            AP_INV_GL_H_CODE:r.get('AP_INV_GL_H_CODE'),\n            AP_CONTRACT_NAME:r.get('AP_CONTRACT_NAME'),\n            DEPT_NAME:r.get('DEPT_NAME'),\n            PROJECT_NAME:r.get('PROJECT_NAME'),\n            ACC_NAME:r.get('ACC_NAME'),\n            AMOUNT:r.get('PAY_AMT'),\n            DESCRIPTION:r.get('DESCRIPTION')\n          }, 'after', 1, false);\n        });\n        if(curGrid.getStore().getCount() > 0){\n          setProjectReadOnly(true);//项目置灰\n        }\n      }\n    });\n  }\n});\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#delBtn#}","normalName":"grid1delBtn","itemId":"delBtn"},"events":{"click":"\nWb.remove(app.grid1);\nif(app.grid.store.getCount() === 0){\n  setProjectReadOnly(false);\n}"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#AP_PAY_REQ_H_CODE_COL#}","hidden":"true","width":"150","dataIndex":"AP_PAY_REQ_H_CODE","titleAlign":"center","itemId":"AP_PAY_REQ_H_CODE_COL1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#AP_INV_GL_H_CODE_COL#}","width":"200","dataIndex":"AP_INV_GL_H_CODE","titleAlign":"center","itemId":"AP_INV_GL_H_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#PROJECT_NAME#}","width":"200","dataIndex":"PROJECT_NAME","titleAlign":"center","itemId":"PROJECT_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#ACC_NAME#}","width":"200","dataIndex":"ACC_NAME","titleAlign":"center","itemId":"ACC_NAME_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#AMOUNT#}","align":"right","width":"100","dataIndex":"AMOUNT","titleAlign":"center","itemId":"AMOUNT_COL","renderer":"return Ext.util.Format.number(value,'0,000.00');"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#DESCRIPTION#}","dataIndex":"DESCRIPTION","titleAlign":"center","itemId":"DESCRIPTION_COL","flex":"1"},"children":[{"configs":{"itemId":"editor"},"children":[],"expanded":false,"type":"textarea"}],"expanded":true,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"},{"configs":{"region":"center","pagingBar":"false","selType":"checkboxmodel","hidden":"true","itemId":"grid2"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/ap/pay/DB/XC_AP_PAY_L_SELECT"},"children":[],"expanded":false,"type":"store"},{"configs":{"normalName":"grid2Tbar","itemId":"tbar"},"children":[{"configs":{"text":"{#inqGlHBtn#}","hidden":"true","normalName":"grid2InqGlHBtn","itemId":"inqGlHBtn"},"events":{"click":"var ap_pay_h_id = app.AP_PAY_H_ID.getValue();//付款单id\nvar ledger_id = app.LEDGER_ID_XWL.LEDGER_ID.getValue();//账簿id\nvar vendor_id = app.VENDOR_ID_XWL.VENDOR_ID.getValue();//供应商id\nvar ap_contract_id = app.AP_CONTRACT_ID_XWL.AP_CONTRACT_ID.getValue();//合同id\nvar ap_doc_cat_code = app.AP_DOC_CAT_CODE.getValue();//单据类型\nvar project_id = app.PROJECT_ID_XWL.PROJECT_ID.getValue();//项目id\n\n\nif(Wb.isEmpty(ledger_id)){\n  Wb.toast('{#qxxzzb#}');//请先选择账簿\n  return false;\n}\nif(Wb.isEmpty(vendor_id)){\n  Wb.toast('{#qxxzgys#}');//请先选择供应商\n  return false;\n}\nvar curGrid = app.grid2;\nWb.run({\n  url: 'm?xwl=xc/ap/pay/LOV/LOV_XC_AP_INV_GL_H', \n  success: function(app) {\n    app.initWin({\n      AP_PAY_H_ID : ap_pay_h_id,\n      AP_DOC_CAT_CODE : ap_doc_cat_code,\n      LEDGER_ID : ledger_id,\n      VENDOR_ID : vendor_id,\n      AP_CONTRACT_ID : ap_contract_id,\n      PROJECT_ID : project_id,\n      hideFun:function(rs){\n        Wb.each(rs, function(r) {\n          r.set('AP_PAY_L_ID',Xip.getId());\n          r.set('AP_PAY_H_ID',ap_pay_h_id);\n          var grid1Store = curGrid.getStore();\n          for(var i=0;i<grid1Store.getCount();i++){\n            var gr = grid1Store.getAt(i);\n            if(gr.get('AP_INV_GL_H_ID')==r.get('AP_INV_GL_H_ID')){\n              return false;\n            }\n          }\n          Wb.add(curGrid, {\n            AP_PAY_L_ID:r.get('AP_PAY_L_ID'),\n            AP_PAY_H_ID:r.get('AP_PAY_H_ID'),\n            AP_INV_GL_H_ID:r.get('AP_INV_GL_H_ID'),\n            PROJECT_ID:r.get('PROJECT_ID'),\n            DEPT_ID:r.get('DEPT_ID'),\n            ACC_ID:r.get('ACC_ID'),\n            CCID:r.get('CCID'),\n            AP_DOC_CAT_CODE:r.get('AP_DOC_CAT_CODE'),\n            AP_CONTRACT_ID:r.get('AP_CONTRACT_ID'),\n            AP_PAY_H_CODE:r.get('AP_PAY_H_CODE'),\n            AP_DOC_CAT_NAME:r.get('AP_DOC_CAT_NAME'),\n            AP_INV_GL_H_CODE:r.get('AP_INV_GL_H_CODE'),\n            AP_CONTRACT_NAME:r.get('AP_CONTRACT_NAME'),\n            DEPT_NAME:r.get('DEPT_NAME'),\n            PROJECT_NAME:r.get('PROJECT_NAME'),\n            ACC_NAME:r.get('ACC_NAME'),\n            AMOUNT:r.get('PAY_AMT'),\n            DESCRIPTION:r.get('DESCRIPTION')\n          }, 'after', 1, false);\n        });\n        setProjectReadOnly(true);//项目置灰\n      }\n    });\n  }\n});\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#delBtn#}","itemId":"delBtn"},"events":{"click":"\nWb.remove(app.grid2);\nif(app.grid.store.getCount() === 0){\n  setProjectReadOnly(false);\n}"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","dataIndex":"AP_DOC_CAT_CODE","itemId":"AP_DOC_CAT_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#AP_PAY_H_CODE_COL#}","hidden":"true","width":"120","dataIndex":"AP_PAY_H_CODE","titleAlign":"center","normalName":"grid2ApPayHCode","itemId":"AP_PAY_H_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#AP_DOC_CAT_NAME_COL#}","hidden":"true","width":"120","dataIndex":"AP_DOC_CAT_NAME","titleAlign":"center","itemId":"AP_DOC_CAT_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#AP_INV_GL_H_CODE_COL#}","width":"120","dataIndex":"AP_INV_GL_H_CODE","titleAlign":"center","itemId":"AP_INV_GL_H_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#AP_CONTRACT_NAME#}","width":"150","dataIndex":"AP_CONTRACT_NAME","titleAlign":"center","itemId":"AP_CONTRACT_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#DEPT_NAME#}","hidden":"true","width":"150","dataIndex":"DEPT_NAME","titleAlign":"center","itemId":"DEPT_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#PROJECT_NAME#}","width":"150","dataIndex":"PROJECT_NAME","titleAlign":"center","itemId":"PROJECT_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#ACC_NAME#}","width":"150","dataIndex":"ACC_NAME","titleAlign":"center","itemId":"ACC_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#AMOUNT#}","align":"right","width":"100","dataIndex":"AMOUNT","format":"0,000.00","titleAlign":"center","itemId":"AMOUNT_COL","renderer":"return Ext.util.Format.number(value,'0,000.00');\n\n"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#DESCRIPTION#}","dataIndex":"DESCRIPTION","titleAlign":"center","itemId":"DESCRIPTION_COL","flex":"1"},"children":[{"configs":{"itemId":"editor"},"children":[],"expanded":false,"type":"textarea"}],"expanded":true,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"},{"configs":{"region":"center","pagingBar":"false","selType":"checkboxmodel","hidden":"true","itemId":"grid3","editable":"true"},"events":{"tagEvents":"{\n  beforeedit : function(editor,e,o){\n    if(app.SOURCE.getValue() == 'REQ'){\n      return false;\n    }else{\n      return true;\n    }\n  }\n}"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/ap/pay/DB/XC_AP_PAY_L_SELECT"},"children":[],"expanded":false,"type":"store"},{"configs":{"normalName":"grid3Tbar","itemId":"tbar"},"children":[{"configs":{"text":"{#reqBtn#}","hidden":"true","normalName":"grid3ReqBtn","itemId":"reqBtn"},"events":{"tagEvents":"{\n  show : function(button,option){\n    app.AP_PAY_REQ_H_CODE_COL3.show();\n  }\n}","click":"var ap_pay_h_id = app.AP_PAY_H_ID.getValue();//付款单id\nvar ledger_id = app.LEDGER_ID_XWL.LEDGER_ID.getValue();//账簿id\nvar vendor_id = app.VENDOR_ID_XWL.VENDOR_ID.getValue();//供应商id\nvar ap_contract_id = app.AP_CONTRACT_ID_XWL.AP_CONTRACT_ID.getValue();//合同id\nvar ap_doc_cat_code = app.AP_DOC_CAT_CODE.getValue();//单据类型\nvar project_id = app.PROJECT_ID_XWL.PROJECT_ID.getValue();//项目id\n\nif(Wb.isEmpty(ledger_id)){\n  Wb.toast('{#qxxzzb#}');//请先选择账簿\n  return false;\n}\nif(Wb.isEmpty(vendor_id)){\n  Wb.toast('{#qxxzgys#}');//请先选择供应商\n  return false;\n}\n\nif(app.grid.getStore().getCount()>0){\n  Wb.toast('{#yfkmxbncgyt#}');//预付款明细不能超过一条\n  return false;\n}\n\nvar curGrid = app.grid3;\n\nWb.run({\n  url: 'm?xwl=xc/ap/pay/LOV/LOV_XC_AP_PAY_REQ_H_YUFK', \n  success: function(app) {\n    app.initWin({\n      AP_PAY_H_ID : ap_pay_h_id,\n      AP_DOC_CAT_CODE : ap_doc_cat_code,\n      LEDGER_ID : ledger_id,\n      VENDOR_ID : vendor_id,\n      AP_CONTRACT_ID : ap_contract_id,\n      PROJECT_ID : project_id,\n      hideFun:function(rs){\n        //获取账簿预付款科目\n        var acc_id = '';\n        var acc_name = '';\n        if(rs.length > 0){\n          Wb.request({\n            async : false,\n            url : 'm?xwl=xc/ap/pay/DB/select_ledger_ap_acc_pre',\n            params : {\n              LEDGER_ID : ledger_id\n            },\n            success : function(resp){\n              var data = Wb.decode(resp.responseText);\n              acc_id = data.ACC_ID;\n              acc_name = data.ACC_NAME;\n            }\n          });\n        }\n        Wb.each(rs, function(r) {\n          r.set('AP_PAY_L_ID',Xip.getId());\n          r.set('AP_PAY_H_ID',ap_pay_h_id);\n          var grid1Store = curGrid.getStore();\n          for(var i=0;i<grid1Store.getCount();i++){\n            var gr = grid1Store.getAt(i);\n            if(gr.get('AP_PAY_REQ_L_ID')==r.get('AP_PAY_REQ_L_ID')){\n              return false;\n            }\n          }\n\n          Wb.add(curGrid, {\n            AP_PAY_L_ID:r.get('AP_PAY_L_ID'),\n            AP_PAY_H_ID:r.get('AP_PAY_H_ID'),\n            AP_PAY_REQ_H_ID:r.get('AP_PAY_REQ_H_ID'),\n            AP_PAY_REQ_H_CODE:r.get('AP_PAY_REQ_H_CODE'),\n            PROJECT_ID:r.get('PROJECT_ID'),\n            DEPT_ID:r.get('DEPT_ID'),\n            ACC_ID:acc_id,\n            AP_DOC_CAT_CODE:r.get('AP_DOC_CAT_CODE'),\n            AP_CONTRACT_ID:r.get('AP_CONTRACT_ID'),\n            AP_CONTRACT_NAME:r.get('AP_CONTRACT_NAME'),\n            DEPT_NAME:r.get('DEPT_NAME'),\n            PROJECT_NAME:r.get('PROJECT_NAME'),\n            ACC_NAME:acc_name,\n            AMOUNT:r.get('PAY_AMT'),\n            DESCRIPTION:r.get('DESCRIPTION')\n          }, 'after', 1, false);\n        });\n        if(curGrid.getStore().getCount() > 0){\n          setProjectReadOnly(true);//项目置灰\n        }\n        \n      }\n    });\n  }\n});\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#createBtn#}","hidden":"true","normalName":"grid3CreateBtn","itemId":"createBtn"},"events":{"tagEvents":"{\n  show : function(button,option){\n    app.AP_PAY_REQ_H_CODE_COL3.hide();\n  }\n}","click":"var ap_pay_h_id = app.AP_PAY_H_ID.getValue();//付款单id\nvar ledger_id = app.LEDGER_ID_XWL.LEDGER_ID.getValue();//账簿id\n\nif(Wb.isEmpty(ledger_id)){\n  Wb.toast('{#qxxzzb#}');//请先选择账簿\n  return false;\n}\n\nif(app.grid.getStore().getCount()>0){\n  Wb.toast('{#yfkmxbncgyt#}');//预付款明细不能超过一条\n  return false;\n}\n\nvar curGrid = app.grid3;\nWb.request({\n  url: 'm?xwl=xc/ap/pay/DB/select_ledger_ap_acc_pre',\n  params: {\n    LEDGER_ID: ledger_id\n  },\n  success: function(resp) {\n    var data = Wb.decode(resp.responseText);\n    Wb.add(curGrid,{\n      AP_PAY_L_ID:Xip.getId(),\n      AP_PAY_H_ID:ap_pay_h_id,\n      ACC_ID:data.ACC_ID,\n      ACC_NAME:data.ACC_NAME,  \n      DESCRIPTION:app.DESCRIPTION.getValue()\n    }, 'after', 1, false);\n  }\n});\n\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#delBtn#}","itemId":"delBtn"},"events":{"click":"\nWb.remove(app.grid3);\nif(app.grid.store.getCount() === 0){\n  setProjectReadOnly(false);\n}"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"<font color = 'red'>*<\/font>{#AP_PAY_REQ_H_CODE_COL#}","hidden":"true","width":"150","align":"center","dataIndex":"AP_PAY_REQ_H_CODE","itemId":"AP_PAY_REQ_H_CODE_COL3"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"AP_DOC_CAT_CODE","itemId":"AP_DOC_CAT_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#AP_PAY_H_CODE_COL#}","hidden":"true","width":"120","dataIndex":"AP_PAY_H_CODE","titleAlign":"center","normalName":"grid4ApPayHCode","itemId":"AP_PAY_H_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#DEPT_NAME#}","hidden":"true","width":"150","dataIndex":"DEPT_NAME","titleAlign":"center","itemId":"DEPT_NAME_COL"},"children":[{"configs":{"labelWidth":"100","labelAlign":"right","normalName":"DEPT_NAME_PICK","itemId":"editor"},"children":[{"configs":{"tagConfigs":"minWidth:400","height":"300","itemId":"pickComp"},"events":{"itemdblclick":"var r=app.grid3.getSelectionModel().getSelection()[0];\nr.set('DEPT_ID',record.data.DEPT_ID);\nr.set('DEPT_NAME',record.data.DEPT_NAME);\nr.dirty = true;\napp.DEPT_NAME_PICK.setValue(record.data.DEPT_NAME);\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/com-lov/DEPT_ID_PICK/DB/GRID_XIP_PUB_DEPTS_SELECT_LD"},"events":{"beforeload":"operation.params = Wb.getValue([app.form1,app.tbar]);"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","dataIndex":"DEPT_ID","itemId":"DEPT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#CODE#}","dataIndex":"DEPT_CODE","itemId":"DEPT_CODE_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#NAME#}","dataIndex":"DEPT_NAME","itemId":"DEPT_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"100","emptyText":"{#CODE_NAME#}","labelAlign":"right","itemId":"QUERY_CODE_NAME"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.pickComp.getStore().load();\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":true,"type":"column"},{"configs":{"text":"{#PROJECT_NAME#}","width":"150","dataIndex":"PROJECT_NAME","titleAlign":"center","itemId":"PROJECT_NAME_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#AP_CONTRACT_NAME#}","hidden":"true","width":"150","dataIndex":"AP_CONTRACT_NAME","titleAlign":"center","itemId":"AP_CONTRACT_NAME_COL"},"children":[{"configs":{"labelWidth":"100","labelAlign":"right","normalName":"AP_CONTRACT_NAME_PICK","itemId":"editor"},"children":[{"configs":{"tagConfigs":"minWidth:400","height":"300","itemId":"pickComp"},"events":{"itemdblclick":"var r=app.grid3.getSelectionModel().getSelection()[0];\nr.set('AP_CONTRACT_ID',record.data.AP_CONTRACT_ID);\nr.set('AP_CONTRACT_NAME',record.data.AP_CONTRACT_NAME);\nr.dirty = true;\napp.AP_CONTRACT_NAME_PICK.setValue(record.data.AP_CONTRACT_NAME);\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/ap/ap-com-lov/AP_CONTRACT_ID_PICK/DB/GRID_XC_AP_CONTRACT_SELECT"},"events":{"beforeload":"operation.params = Wb.getValue([app.form1,app.tbar]);"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","dataIndex":"AP_CONTRACT_ID","itemId":"AP_CONTRACT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#CODE#}","dataIndex":"AP_CONTRACT_CODE","itemId":"AP_CONTRACT_CODE_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#NAME#}","dataIndex":"AP_CONTRACT_NAME","itemId":"AP_CONTRACT_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"100","emptyText":"{#CODE_NAME#}","labelAlign":"right","itemId":"QUERY_CODE_NAME"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.pickComp.getStore().load();\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":true,"type":"column"},{"configs":{"text":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#ACC_NAME#}","width":"150","dataIndex":"ACC_NAME","titleAlign":"center","itemId":"ACC_NAME_COL"},"children":[{"configs":{"labelWidth":"100","allowBlank":"false","labelAlign":"right","normalName":"ACC_NAME_PICK","itemId":"editor"},"children":[{"configs":{"tagConfigs":"minWidth:400","height":"300","itemId":"pickComp"},"events":{"itemdblclick":"var r=app.grid3.getSelectionModel().getSelection()[0];\nr.set('ACC_ID',record.data.ACC_ID);\nr.set('ACC_NAME',record.data.ACC_NAME);\nr.dirty = true;\napp.ACC_NAME_PICK.setValue(record.data.ACC_NAME);\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/com-lov/ACC_ID_PICK/DB/XC_BG_LD_ACCOUNTS_SELECT_LD"},"events":{"beforeload":"operation.params = Wb.getValue([app.form1,app.tbar]);"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","dataIndex":"ACC_ID","itemId":"ACC_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#CODE#}","dataIndex":"ACC_CODE","itemId":"ACC_CODE_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#NAME#}","dataIndex":"ACC_NAME","itemId":"ACC_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"100","emptyText":"{#CODE_NAME#}","labelAlign":"right","itemId":"QUERY_CODE_NAME"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.pickComp.getStore().load();\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":true,"type":"column"},{"configs":{"text":"{#CCID_NAME#}","width":"150","dataIndex":"CCID_NAME","titleAlign":"center","itemId":"CCID_NAME_COL"},"children":[{"configs":{"displayField":"CCID_NAME","triggerCls":"x-form-search-trigger","valueField":"CCID","itemId":"editor","onTriggerClick":"  // 账簿\n  var ledgerId = app.LEDGER_ID_XWL.LEDGER_ID.getValue() ;\n  if(ledgerId === \"\" ||ledgerId === null || ledgerId === undefined){\n    Wb.info('{#qxzzb#}') ;//请选择账簿\n    return false ;\n  }\n  \n  // 会计日期\n  var accDate = app.GL_DATE.getValue() ;\n  if(accDate === \"\" ||accDate === null || accDate === undefined){\n    Wb.info('{#qxzkjrq#}') ;//请选择会计日期\n    return false ;\n  }else{\n\taccDate = Wb.dateToStr(accDate).substring(0,7);\n  }\n  \n  // TODO: 当前选中\n  var r = app.grid3.getSelection()[0] ; \n  \n  // TODO: 显示科目选择窗口\n  Wb.run({\n    url:'m?xwl=xc/gl/journal/v-windows/handler-ccid-win',\n    params : {\n      'ledgerId' : ledgerId,\n      'vtype' : '{#vtype#}'\n    },          \n    success:function(appObj){\n      appObj.initWindow({\n        accName : r.data.ACC_NAME,\n        ledgerId : ledgerId,\n        periodCode : accDate ,\n        groupId : 'ALL',\n        handlerCCID : function(returnObj){\n          // TODO: 处理CCID信息\n          var rObj = Wb.decode(returnObj) ;\n          r.set('ACC_ID', rObj.acc_id) ;    \n          r.set('ACC_NAME', rObj.acc_name);\n          r.set('CCID', rObj.acc_ccid) ;    \n          r.set('CCID_NAME', rObj.acc_ccid_name);\n          if(!Wb.isEmpty(rObj.dim_id)){\n          r.set('DIM_ID', rObj.dim_id) ;\n          r.set('DIM_NAME', rObj.dim_name) ;\n          }\n          // 禁用账簿\n           app.LEDGER_ID_XWL.LEDGER_ID.setReadOnly(true) ;\n        }\n      });\n    }  \n  }) ;   "},"events":{"beforequery":"var combo = e.combo;\nif(!e.forceAll){\n  var value = e.query;\n  combo.store.filterBy(function(record,id){\n    var text = record.get(combo.displayField);\n    return (text.indexOf(value)!=-1);\n  });\n  combo.expand();\n  return false;\n}","specialkey":"// TODO: 按回车键执行借方和贷方金额切换\nif (e.getKey() == e.ENTER) {\n  // 账簿\n  var ledgerId = app.LEDGER_ID_XWL.LEDGER_ID.getValue() ;\n  if(ledgerId === \"\" ||ledgerId === null || ledgerId === undefined){\n    Wb.info('请选择账簿!') ;\n    return false ;\n  }\n  \n  // 会计日期\n  var accDate = app.GL_DATE.getValue();\n  if(accDate === \"\" ||accDate === null || accDate === undefined){\n    Wb.info('请选择会计日期!') ;\n    return false ;\n  }else{\n    accDate = Wb.dateToStr(accDate).substring(0,7);\n  }\n  \n  // TODO: 当前选中\n  var r = app.grid3.getSelection()[0] ; \n  \n  // TODO: 显示科目选择窗口\n  Wb.run({\n    url:'m?xwl=xc/gl/journal/v-windows/handler-ccid-win',\n    params : {\n      'ledgerId' : ledgerId ,\n      'vtype' : '{#vtype#}'\n    },          \n    success:function(appObj){\n      appObj.initWindow({\n        accName : r.data.ACC_NAME,\n        ledgerId : ledgerId,\n        periodCode : accDate ,\n        groupId : 'ALL',\n        handlerCCID : function(returnObj){\n          // TODO: 处理CCID信息\n          var rObj = Wb.decode(returnObj) ;\n          r.set('ACC_ID', rObj.acc_id) ;    \n          r.set('ACC_NAME', rObj.acc_name);\n          r.set('CCID', rObj.acc_ccid) ;    \n          r.set('CCID_NAME', rObj.acc_ccid_name);\n          if(!Wb.isEmpty(rObj.dim_id)){\n            r.set('DIM_ID', rObj.dim_id) ;\n            r.set('DIM_NAME', rObj.dim_name) ;\n          }\n          // 禁用账簿\n           app.LEDGER_ID_XWL.LEDGER_ID.setReadOnly(true) ;\n        }\n      });\n    }  \n  }) ;   \n}"},"children":[],"expanded":true,"type":"combo"}],"expanded":true,"type":"column"},{"configs":{"text":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#AMOUNT#}","align":"right","width":"100","dataIndex":"AMOUNT","titleAlign":"center","normalName":"YUFK_AMOUNT_COL","itemId":"AMOUNT_COL","renderer":"return Ext.util.Format.number(value,'0,000.00');"},"children":[{"configs":{"itemId":"editor"},"events":{"change":"if( newValue < 0 ){\n  Wb.toast('该单据金额应大于 0 !');\n  number.setValue(0);\n}"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"column"},{"configs":{"text":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#DESCRIPTION#}","dataIndex":"DESCRIPTION","titleAlign":"center","itemId":"DESCRIPTION_COL","flex":"1"},"children":[{"configs":{"itemId":"editor"},"children":[],"expanded":false,"type":"textarea"}],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"},{"configs":{"region":"center","pagingBar":"false","selType":"checkboxmodel","hidden":"true","itemId":"grid4","editable":"true"},"events":{"tagEvents":"{\n  beforeedit : function(editor,e,o){\n    if(app.SOURCE.getValue() == 'PAY'){\n      return false;\n    }else{\n      return true;\n    }\n  }\n}"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/ap/pay/DB/XC_AP_PAY_L_SELECT"},"children":[],"expanded":false,"type":"store"},{"configs":{"normalName":"grid4Tbar","itemId":"tbar"},"children":[{"configs":{"text":"{#payBtn#}","hidden":"true","normalName":"grid4PayBtn","itemId":"payBtn"},"events":{"tagEvents":"{\n  show : function(button,option){\n    app.grid4ApPayHCode.show();\n  }\n}","click":"var ap_pay_h_id = app.AP_PAY_H_ID.getValue();//付款单id\nvar ledger_id = app.LEDGER_ID_XWL.LEDGER_ID.getValue();//账簿id\nvar vendor_id = app.VENDOR_ID_XWL.VENDOR_ID.getValue();//供应商id\nvar ap_contract_id = app.AP_CONTRACT_ID_XWL.AP_CONTRACT_ID.getValue();//合同id\nvar ap_doc_cat_code = app.AP_DOC_CAT_CODE.getValue();//单据类型\nvar project_id = app.PROJECT_ID_XWL.PROJECT_ID.getValue();//项目id\n\n\nif(Wb.isEmpty(ledger_id)){\n  Wb.toast('{#qxxzzb#}');//请先选择账簿\n  return false;\n}\n\nif(app.grid4.getStore().getCount()>0){\n  Wb.toast('{#yfkmxbncgyt#}');//预付款明细不能超过一条\n  return false;\n}\n//           Wb.request({\n//             async : false,\n//             url : 'm?xwl=xc/ap/pay/DB/select_ledger_ap_acc_pre',\n//             params : {\n//               LEDGER_ID : ledger_id\n//             },\n//             success : function(resp){\n//               var data = Wb.decode(resp.responseText);\n//               acc_id = data.ACC_ID;\n//               acc_name = data.ACC_NAME;\n//             }\n//           });\nvar curGrid = app.grid4;\nWb.run({\n  url: 'm?xwl=xc/ap/pay/LOV/LOV_XC_AP_PAY_H', \n  success: function(app) {\n    app.initWin({\n      AP_PAY_H_ID : ap_pay_h_id,\n      AP_DOC_CAT_CODE : ap_doc_cat_code,\n      LEDGER_ID : ledger_id,\n      VENDOR_ID : vendor_id,\n      AP_CONTRACT_ID : ap_contract_id,\n      PROJECT_ID : project_id,\n      hideFun:function(rs){\n        Wb.each(rs, function(r) {\n          r.set('AP_PAY_L_ID',Xip.getId());\n          r.set('AP_PAY_H_ID',ap_pay_h_id);\n          var grid1Store = curGrid.getStore();\n          for(var i=0;i<grid1Store.getCount();i++){\n            var gr = grid1Store.getAt(i);\n            if(gr.get('L_AP_PAY_L_ID')==r.get('L_AP_PAY_L_ID')){\n              return false;\n            }\n          }\n          Wb.add(curGrid, {\n            AP_PAY_L_ID:r.get('AP_PAY_L_ID'),\n            AP_PAY_H_ID:r.get('AP_PAY_H_ID'),\n            L_AP_PAY_H_ID:r.get('L_AP_PAY_H_ID'),\n            L_AP_PAY_L_ID:r.get('L_AP_PAY_L_ID'),\n            AP_INV_GL_H_ID:r.get('AP_INV_GL_H_ID'),\n            PROJECT_ID:r.get('PROJECT_ID'),\n            ACC_ID:r.get('ACC_ID'),\n            CCID:r.get('CCID'),\n            AP_PAY_H_CODE:r.get('AP_PAY_H_CODE'),\n            PROJECT_NAME:r.get('PROJECT_NAME'),\n            ACC_NAME:r.get('ACC_NAME'),\n            AMOUNT:r.get('PAY_AMT')*(-1),\n            DESCRIPTION:r.get('DESCRIPTION')\n          }, 'after', 1, false);\n        });\n        \n        if(curGrid.getStore().getCount() > 0){\n          setProjectReadOnly(true);//项目置灰\n        }\n        \n      }\n    });\n  }\n});\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#createBtn#}","hidden":"true","normalName":"grid4CreateBtn","itemId":"createBtn"},"events":{"tagEvents":"{\n  show : function(button,option){\n    app.grid4ApPayHCode.hide();\n  }\n}","click":"var ap_pay_h_id = app.AP_PAY_H_ID.getValue();//付款单id\nvar ledger_id = app.LEDGER_ID_XWL.LEDGER_ID.getValue();//账簿id\n\nif(Wb.isEmpty(ledger_id)){\n  Wb.toast('{#qxxzzb#}');//请先选择账簿\n  return false;\n}\n\nif(app.grid.getStore().getCount()>0){\n  Wb.toast('{#yfkmxbncgyt#}');//预付款明细不能超过一条\n  return false;\n}\n\nvar curGrid = app.grid4;\nWb.request({\n  url: 'm?xwl=xc/ap/pay/DB/select_ledger_ap_acc_pre',\n  params: {\n    LEDGER_ID: ledger_id\n  },\n  success: function(resp) {\n    var data = Wb.decode(resp.responseText);\n    Wb.addEdit(curGrid,{\n      AP_PAY_L_ID:Xip.getId(),\n      AP_PAY_H_ID:ap_pay_h_id,\n      ACC_ID:data.ACC_ID,\n      ACC_NAME:data.ACC_NAME,  \n      DESCRIPTION:app.DESCRIPTION.getValue()\n    }, 'after', 1, false);\n  }\n});\n\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#delBtn#}","itemId":"delBtn"},"events":{"click":"\nWb.remove(app.grid4);\nif(app.grid.store.getCount() === 0){\n  setProjectReadOnly(false);\n}"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","dataIndex":"AP_DOC_CAT_CODE","itemId":"AP_DOC_CAT_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#AP_PAY_H_CODE_COL#}","hidden":"true","width":"150","dataIndex":"AP_PAY_H_CODE","titleAlign":"center","normalName":"grid4ApPayHCode","itemId":"AP_PAY_H_CODE_COL4"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#DEPT_NAME#}","hidden":"true","width":"150","dataIndex":"DEPT_NAME","titleAlign":"center","itemId":"DEPT_NAME_COL"},"children":[{"configs":{"labelWidth":"100","labelAlign":"right","normalName":"DEPT_NAME_PICK","itemId":"editor"},"children":[{"configs":{"tagConfigs":"minWidth:400","height":"300","itemId":"pickComp"},"events":{"itemdblclick":"var r=app.grid4.getSelectionModel().getSelection()[0];\nr.set('DEPT_ID',record.data.DEPT_ID);\nr.set('DEPT_NAME',record.data.DEPT_NAME);\nr.dirty = true;\napp.DEPT_NAME_PICK.setValue(record.data.DEPT_NAME);\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/com-lov/DEPT_ID_PICK/DB/GRID_XIP_PUB_DEPTS_SELECT_LD"},"events":{"beforeload":"operation.params = Wb.getValue([app.form1,app.tbar]);"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","dataIndex":"DEPT_ID","itemId":"DEPT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#CODE#}","dataIndex":"DEPT_CODE","itemId":"DEPT_CODE_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#NAME#}","dataIndex":"DEPT_NAME","itemId":"DEPT_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"100","emptyText":"{#CODE_NAME#}","labelAlign":"right","itemId":"QUERY_CODE_NAME"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.pickComp.getStore().load();\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":true,"type":"column"},{"configs":{"text":"{#PROJECT_NAME#}","width":"150","dataIndex":"PROJECT_NAME","titleAlign":"center","itemId":"PROJECT_NAME_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#AP_CONTRACT_NAME#}","hidden":"true","width":"150","dataIndex":"AP_CONTRACT_NAME","titleAlign":"center","itemId":"AP_CONTRACT_NAME_COL"},"children":[{"configs":{"labelWidth":"100","labelAlign":"right","normalName":"AP_CONTRACT_NAME_PICK","itemId":"editor"},"children":[{"configs":{"tagConfigs":"minWidth:400","height":"300","itemId":"pickComp"},"events":{"itemdblclick":"var r=app.grid4.getSelectionModel().getSelection()[0];\nr.set('AP_CONTRACT_ID',record.data.AP_CONTRACT_ID);\nr.set('AP_CONTRACT_NAME',record.data.AP_CONTRACT_NAME);\nr.dirty = true;\napp.AP_CONTRACT_NAME_PICK.setValue(record.data.AP_CONTRACT_NAME);\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/ap/ap-com-lov/AP_CONTRACT_ID_PICK/DB/GRID_XC_AP_CONTRACT_SELECT"},"events":{"beforeload":"operation.params = Wb.getValue([app.form1,app.tbar]);"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","dataIndex":"AP_CONTRACT_ID","itemId":"AP_CONTRACT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#CODE#}","dataIndex":"AP_CONTRACT_CODE","itemId":"AP_CONTRACT_CODE_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#NAME#}","dataIndex":"AP_CONTRACT_NAME","itemId":"AP_CONTRACT_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"100","emptyText":"合同编码/名称","labelAlign":"right","itemId":"QUERY_CODE_NAME"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.pickComp.getStore().load();\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":true,"type":"column"},{"configs":{"text":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#ACC_NAME#}","width":"150","dataIndex":"ACC_NAME","titleAlign":"center","itemId":"ACC_NAME_COL"},"children":[{"configs":{"labelWidth":"100","allowBlank":"false","labelAlign":"right","normalName":"ACC_NAME_PICK","itemId":"editor"},"children":[{"configs":{"tagConfigs":"minWidth:400","height":"300","itemId":"pickComp"},"events":{"itemdblclick":"var r=app.grid4.getSelectionModel().getSelection()[0];\nr.set('ACC_ID',record.data.ACC_ID);\nr.set('ACC_NAME',record.data.ACC_NAME);\nr.dirty = true;\napp.ACC_NAME_PICK.setValue(record.data.ACC_NAME);\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/com-lov/ACC_ID_PICK/DB/XC_BG_LD_ACCOUNTS_SELECT_LD"},"events":{"beforeload":"operation.params = Wb.getValue([app.form1,app.tbar]);"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","dataIndex":"ACC_ID","itemId":"ACC_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#CODE#}","dataIndex":"ACC_CODE","itemId":"ACC_CODE_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#NAME#}","dataIndex":"ACC_NAME","itemId":"ACC_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"100","emptyText":"{#CODE_NAME#}","labelAlign":"right","itemId":"QUERY_CODE_NAME"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.pickComp.getStore().load();\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":true,"type":"column"},{"configs":{"text":"{#CCID_NAME#}","width":"150","dataIndex":"CCID_NAME","titleAlign":"center","itemId":"CCID_NAME_COL"},"children":[{"configs":{"displayField":"CCID_NAME","triggerCls":"x-form-search-trigger","valueField":"CCID","itemId":"editor","onTriggerClick":"  // 账簿\n  var ledgerId = app.LEDGER_ID_XWL.LEDGER_ID.getValue() ;\n  if(ledgerId === \"\" ||ledgerId === null || ledgerId === undefined){\n    Wb.info('{#qxzzb#}') ;//请选择账簿\n    return false ;\n  }\n  \n  // 会计日期\n  var accDate = app.GL_DATE.getValue() ;\n  if(accDate === \"\" ||accDate === null || accDate === undefined){\n    Wb.info('{#qxzkjrq#}') ;//请选择会计日期\n    return false ;\n  }else{\n\taccDate = Wb.dateToStr(accDate).substring(0,7);\n  }\n  \n  // TODO: 当前选中\n  var r = app.grid4.getSelection()[0] ; \n  \n  // TODO: 显示科目选择窗口\n  Wb.run({\n    url:'m?xwl=xc/gl/journal/v-windows/handler-ccid-win',\n    params : {\n      'ledgerId' : ledgerId,\n      'vtype' : '{#vtype#}'\n    },          \n    success:function(appObj){\n      appObj.initWindow({\n        accName : r.data.ACC_NAME,\n        ledgerId : ledgerId,\n        periodCode : accDate ,\n        groupId : 'ALL',\n        handlerCCID : function(returnObj){\n          // TODO: 处理CCID信息\n          var rObj = Wb.decode(returnObj) ;\n          r.set('ACC_ID', rObj.acc_id) ;    \n          r.set('ACC_NAME', rObj.acc_name);\n          r.set('CCID', rObj.acc_ccid) ;    \n          r.set('CCID_NAME', rObj.acc_ccid_name);\n          // 禁用账簿\n           app.LEDGER_ID_XWL.LEDGER_ID.setReadOnly(true) ;\n        }\n      });\n    }  \n  }) ;   "},"events":{"beforequery":"var combo = e.combo;\nif(!e.forceAll){\n  var value = e.query;\n  combo.store.filterBy(function(record,id){\n    var text = record.get(combo.displayField);\n    return (text.indexOf(value)!=-1);\n  });\n  combo.expand();\n  return false;\n}","specialkey":"// TODO: 按回车键执行借方和贷方金额切换\nif (e.getKey() == e.ENTER) {\n  // 账簿\n  var ledgerId = app.LEDGER_ID_XWL.LEDGER_ID.getValue() ;\n  if(ledgerId === \"\" ||ledgerId === null || ledgerId === undefined){\n    Wb.info('请选择账簿!') ;\n    return false ;\n  }\n  \n  // 会计日期\n  var accDate = app.GL_DATE.getValue();\n  if(accDate === \"\" ||accDate === null || accDate === undefined){\n    Wb.info('请选择会计日期!') ;\n    return false ;\n  }else{\n    accDate = Wb.dateToStr(accDate).substring(0,7);\n  }\n  \n  // TODO: 当前选中\n  var r = app.grid4.getSelection()[0] ; \n  \n  // TODO: 显示科目选择窗口\n  Wb.run({\n    url:'m?xwl=xc/gl/journal/v-windows/handler-ccid-win',\n    params : {\n      'ledgerId' : ledgerId ,\n      'vtype' : '{#vtype#}'\n    },          \n    success:function(appObj){\n      appObj.initWindow({\n        accName : r.data.ACC_NAME,\n        ledgerId : ledgerId,\n        periodCode : accDate ,\n        groupId : 'ALL',\n        handlerCCID : function(returnObj){\n          // TODO: 处理CCID信息\n          var rObj = Wb.decode(returnObj) ;\n          r.set('ACC_ID', rObj.acc_id) ;    \n          r.set('ACC_NAME', rObj.acc_name);\n          r.set('CCID', rObj.acc_ccid) ;    \n          r.set('CCID_NAME', rObj.acc_ccid_name);\n          // 禁用账簿\n           app.LEDGER_ID_XWL.LEDGER_ID.setReadOnly(true) ;\n        }\n      });\n    }  \n  }) ;   \n}"},"children":[],"expanded":true,"type":"combo"}],"expanded":true,"type":"column"},{"configs":{"text":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#AMOUNT#}","align":"right","width":"100","dataIndex":"AMOUNT","titleAlign":"center","itemId":"AMOUNT_COL","renderer":"return Ext.util.Format.number(value,'0,000.00');"},"children":[{"configs":{"itemId":"editor"},"events":{"change":"if( newValue > 0 ){\n  Wb.toast('该单据金额应小于 0 !');\n  number.setValue(-0);\n  return;\n}"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"column"},{"configs":{"text":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#DESCRIPTION#}","dataIndex":"DESCRIPTION","titleAlign":"center","itemId":"DESCRIPTION_COL","flex":"1"},"children":[{"configs":{"itemId":"editor"},"children":[],"expanded":false,"type":"textarea"}],"expanded":true,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"},{"configs":{"region":"center","pagingBar":"false","selType":"checkboxmodel","hidden":"true","itemId":"grid5","editable":"true"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/ap/pay/DB/XC_AP_PAY_L_SELECT"},"children":[],"expanded":false,"type":"store"},{"configs":{"normalName":"grid5Tbar","itemId":"tbar"},"children":[{"configs":{"text":"{#reqBtn#}","hidden":"true","normalName":"grid5ReqBtn","itemId":"reqBtn"},"events":{"tagEvents":"{\n  show : function(button,option){\n    app.AP_PAY_REQ_H_CODE_COL5.show();\n    app.DEPT_NAME_COL5.show();\n    app.PROJECT_NAME_COL5.show();\n    app.AMOUNT_COL5.getEditor().setReadOnly(true);\n    app.DESCRIPTION_COL5.getEditor().setReadOnly(true);\n  }\n}","click":"\nvar ap_pay_h_id = app.AP_PAY_H_ID.getValue();//付款单id\nvar ledger_id = app.LEDGER_ID_XWL.LEDGER_ID.getValue();//账簿id\nvar vendor_id = app.VENDOR_ID_XWL.VENDOR_ID.getValue();//供应商id\nvar ap_contract_id = app.AP_CONTRACT_ID_XWL.AP_CONTRACT_ID.getValue();//合同id\nvar ap_doc_cat_code = app.AP_DOC_CAT_CODE.getValue();//单据类型\nvar project_id = app.PROJECT_ID_XWL.PROJECT_ID.getValue();//项目id\n\n\nif(Wb.isEmpty(ledger_id)){\n  Wb.toast('{#qxxzzb#}');//请先选择账簿\n  return false;\n}\nif(Wb.isEmpty(vendor_id)){\n  Wb.toast('{#qxxzgys#}');//请先选择供应商\n  return false;\n}\nvar curGrid = app.grid5;\n\n\nWb.run({\n  url: 'm?xwl=xc/ap/pay/LOV/LOV_XC_AP_PAY_REQ_QTFK', \n  success: function(app) {\n    app.initWin({\n      AP_PAY_H_ID : ap_pay_h_id,\n      AP_DOC_CAT_CODE : ap_doc_cat_code,\n      LEDGER_ID : ledger_id,\n      VENDOR_ID : vendor_id,\n      AP_CONTRACT_ID : ap_contract_id,\n      PROJECT_ID : project_id,\n      hideFun:function(rs){\n        Wb.each(rs, function(r) {\n          r.set('AP_PAY_L_ID',Xip.getId());\n          r.set('AP_PAY_H_ID',ap_pay_h_id);\n          var grid1Store = curGrid.getStore();\n          for(var i=0;i<grid1Store.getCount();i++){\n            var gr = grid1Store.getAt(i);\n            if(gr.get('AP_PAY_REQ_L_ID')==r.get('AP_PAY_REQ_L_ID')){\n              return false;\n            }\n          }\n          Wb.add(curGrid, {\n            AP_PAY_L_ID:r.get('AP_PAY_L_ID'),\n            AP_PAY_H_ID:r.get('AP_PAY_H_ID'),\n            AP_PAY_REQ_H_ID:r.get('AP_PAY_REQ_H_ID'),\n            AP_PAY_REQ_L_ID:r.get('AP_PAY_REQ_L_ID'),\n            AP_PAY_REQ_H_CODE:r.get('AP_PAY_REQ_H_CODE'),\n            AP_PUR_TYPE_ID:r.get('AP_PUR_TYPE_ID'),\n            AP_PUR_TYPE_NAME:r.get('AP_PUR_TYPE_NAME'),\n            PROJECT_ID:r.get('PROJECT_ID'),\n            DEPT_ID:r.get('DEPT_ID'),\n            AP_CONTRACT_ID:r.get('AP_CONTRACT_ID'),\n            AP_CONTRACT_NAME:r.get('AP_CONTRACT_NAME'),\n            DEPT_NAME:r.get('DEPT_NAME'),\n            PROJECT_NAME:r.get('PROJECT_NAME'),\n            AMOUNT:r.get('PAY_AMT'),\n            DESCRIPTION:r.get('DESCRIPTION')\n          }, 'after', 1, false);\n        });\n        setProjectReadOnly(true);//项目置灰\n      }\n    });\n  }\n});\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#purTypeBtn#}","hidden":"true","normalName":"grid5PurTypeBtn","itemId":"purTypeBtn"},"events":{"tagEvents":"{\n  show : function(button,option){\n    app.AP_PAY_REQ_H_CODE_COL5.hide();\n    app.DEPT_NAME_COL5.hide();\n    app.PROJECT_NAME_COL5.hide();\n    app.AMOUNT_COL5.getEditor().setReadOnly(false);\n    app.DESCRIPTION_COL5.getEditor().setReadOnly(false);\n  }\n}\n","click":"var ap_pay_h_id = app.AP_PAY_H_ID.getValue();//付款单id\nvar ledger_id = app.LEDGER_ID_XWL.LEDGER_ID.getValue();//账簿id\nvar vendor_id = app.VENDOR_ID_XWL.VENDOR_ID.getValue();//供应商id\nvar ap_contract_id = app.AP_CONTRACT_ID_XWL.AP_CONTRACT_ID.getValue();//合同id\nvar ap_doc_cat_code = app.AP_DOC_CAT_CODE.getValue();//单据类型\nvar project_id = app.PROJECT_ID_XWL.PROJECT_ID.getValue();//项目id\n\nif(Wb.isEmpty(ledger_id)){\n  Wb.toast('{#qxxzzb#}');//请先选择账簿\n  return false;\n}\n\nvar curGrid = app.grid5;\n\nWb.run({\n  url: 'm?xwl=xc/ap/pay/LOV/LOV_XC_AP_PUR_TYPE', \n  success: function(app) {\n    app.initWin({\n      AP_PAY_H_ID : ap_pay_h_id,\n      AP_DOC_CAT_CODE : ap_doc_cat_code,\n      LEDGER_ID : ledger_id,\n      VENDOR_ID : vendor_id,\n      AP_CONTRACT_ID : ap_contract_id,\n      PROJECT_ID : project_id,\n      hideFun:function(rs){\n        Wb.each(rs, function(r) {\n          r.set('AP_PAY_L_ID',Xip.getId());\n          r.set('AP_PAY_H_ID',ap_pay_h_id);\n          r.set('ACC_ID',r.get('AP_ACC_ID_INV'));\n          r.set('ACC_NAME',r.get('AP_ACC_NAME_INV'));\n          r.set('AMOUNT',r.get('PAY_AMT'));\n          r.set('AP_DOC_CAT_CODE',r.get('GL_AP_DOC_CAT_CODE'));\n          r.set('AP_DOC_CAT_NAME',r.get('GL_AP_DOC_CAT_NAME'));\n          var grid1Store = curGrid.getStore();\n          for(var i=0;i<grid1Store.getCount();i++){\n            var gr = grid1Store.getAt(i);\n            if(gr.get('AP_PUR_TYPE_ID')==r.get('AP_PUR_TYPE_ID')){\n              return false;\n            }\n          }\n          Wb.add(curGrid,r.data, 'after', 1, false);\n          if(curGrid.getStore().getCount() > 0){\n            setProjectReadOnly(true);//项目置灰\n          }\n        });\n      }\n    });\n  }\n});\n"},"children":[],"expanded":true,"type":"button"},{"configs":{"text":"{#delBtn#}","itemId":"delBtn"},"events":{"click":"\nWb.remove(app.grid5);\nif(app.grid.store.getCount() === 0){\n  setProjectReadOnly(false);\n}"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#AP_PAY_REQ_H_CODE_COL#}","width":"150","dataIndex":"AP_PAY_REQ_H_CODE","titleAlign":"center","itemId":"AP_PAY_REQ_H_CODE_COL5"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#DEPT_NAME#}","width":"150","dataIndex":"DEPT_NAME","titleAlign":"center","itemId":"DEPT_NAME_COL5"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#PROJECT_NAME#}","width":"150","dataIndex":"PROJECT_NAME","titleAlign":"center","itemId":"PROJECT_NAME_COL5"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#AP_PUR_TYPE_NAME#}","width":"120","dataIndex":"AP_PUR_TYPE_NAME","titleAlign":"center","itemId":"AP_PUR_TYPE_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#BG_ITEM_NAME#}","width":"150","dataIndex":"BG_ITEM_NAME","titleAlign":"center","itemId":"BG_ITEM_NAME_COL"},"children":[{"configs":{"labelWidth":"100","labelAlign":"right","normalName":"BG_ITEM_PICK","itemId":"editor"},"events":{"expand":"app.pickComp.getStore().load();"},"children":[{"configs":{"tagConfigs":"minWidth:400","height":"300","barExportButtons":"false","barExportAllButtons":"false","itemId":"pickComp"},"events":{"itemdblclick":"var r=app.grid.getSelectionModel().getSelection()[0];\nr.set('BG_ITEM_ID',record.data.BG_ITEM_ID);\nr.set('BG_ITEM_NAME',record.data.BG_ITEM_NAME);\napp.BG_ITEM_PICK.setValue(record.data.BG_ITEM_NAME);\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/com-lov/BG_ITEM_ID_PICK/DB/XC_BG_ITEMS_LD_SELECT"},"events":{"beforeload":"operation.params = Wb.getValue([app.form1,app.tbar]);"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","dataIndex":"BG_ITEM_ID","itemId":"BG_ITEM_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#CODE#}","dataIndex":"BG_ITEM_CODE","itemId":"BG_ITEM_CODE_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#NAME#}","dataIndex":"BG_ITEM_NAME","itemId":"BG_ITEM_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"100","emptyText":"{#CODE_NAME#}","labelAlign":"right","itemId":"QUERY_CODE_NAME"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.searchButton.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"searchButton","iconCls":"seek_icon"},"events":{"click":"app.pickComp.getStore().load();"},"children":[],"expanded":false,"type":"button"},{"configs":{"itemId":"cancelBtn","iconCls":"delete_icon"},"events":{"click":"var r=app.grid1.getSelectionModel().getSelection()[0];\nr.set('BG_ITEM_ID',null);\nr.set('BG_ITEM_NAME',null);\napp.BG_ITEM_PICK.setValue(null);\napp.BG_ITEM_PICK.getPicker().hide();"},"children":[],"expanded":false,"type":"item"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":true,"type":"column"},{"configs":{"text":"<font color='red'>*<\/font>{#ACC_NAME#}","width":"150","dataIndex":"ACC_NAME","titleAlign":"center","itemId":"ACC_NAME_COL"},"children":[{"configs":{"labelWidth":"100","labelAlign":"right","normalName":"ACC_NAME_PICK","itemId":"editor"},"children":[{"configs":{"tagConfigs":"minWidth:400","height":"300","itemId":"pickComp"},"events":{"itemdblclick":"var r=app.grid5.getSelectionModel().getSelection()[0];\nr.set('ACC_ID',record.data.ACC_ID);\nr.set('ACC_NAME',record.data.ACC_NAME);\nr.dirty = true;\napp.ACC_NAME_PICK.setValue(record.data.ACC_NAME);\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/com-lov/ACC_ID_PICK/DB/XC_BG_LD_ACCOUNTS_SELECT_LD"},"events":{"beforeload":"operation.params = Wb.getValue([app.form1,app.tbar]);"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","dataIndex":"ACC_ID","itemId":"ACC_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#CODE#}","dataIndex":"ACC_CODE","itemId":"ACC_CODE_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#NAME#}","dataIndex":"ACC_NAME","itemId":"ACC_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"100","emptyText":"{#CODE_NAME#}","labelAlign":"right","itemId":"QUERY_CODE_NAME"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.pickComp.getStore().load();\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":true,"type":"column"},{"configs":{"text":"{#CCID_NAME#}","width":"150","dataIndex":"CCID_NAME","titleAlign":"center","itemId":"CCID_NAME_COL"},"children":[{"configs":{"displayField":"CCID_NAME","triggerCls":"x-form-search-trigger","valueField":"CCID","itemId":"editor","onTriggerClick":"  // 账簿\n  var ledgerId = app.LEDGER_ID_XWL.LEDGER_ID.getValue() ;\n  if(ledgerId === \"\" ||ledgerId === null || ledgerId === undefined){\n    Wb.info('{#qxzzb#}') ;//请选择账簿\n    return false ;\n  }\n  \n  // 会计日期\n  var accDate = app.GL_DATE.getValue() ;\n  if(accDate === \"\" ||accDate === null || accDate === undefined){\n    Wb.info('{#qxzkjrq#}') ;//请选择会计日期\n    return false ;\n  }else{\n\taccDate = Wb.dateToStr(accDate).substring(0,7);\n  }\n  \n  // TODO: 当前选中\n  var r = app.grid5.getSelection()[0] ; \n  \n  // TODO: 显示科目选择窗口\n  Wb.run({\n    url:'m?xwl=xc/gl/journal/v-windows/handler-ccid-win',\n    params : {\n      'ledgerId' : ledgerId,\n      'vtype' : '{#vtype#}'\n    },          \n    success:function(appObj){\n      appObj.initWindow({\n        accName : r.data.ACC_NAME,\n        ledgerId : ledgerId,\n        periodCode : accDate ,\n        groupId : 'ALL',\n        handlerCCID : function(returnObj){\n          // TODO: 处理CCID信息\n          var rObj = Wb.decode(returnObj) ;\n          r.set('ACC_ID', rObj.acc_id) ;    \n          r.set('ACC_NAME', rObj.acc_name);\n          r.set('CCID', rObj.acc_ccid) ;    \n          r.set('CCID_NAME', rObj.acc_ccid_name);\n          // 禁用账簿\n           app.LEDGER_ID_XWL.LEDGER_ID.setReadOnly(true) ;\n        }\n      });\n    }  \n  }) ;   "},"events":{"beforequery":"var combo = e.combo;\nif(!e.forceAll){\n  var value = e.query;\n  combo.store.filterBy(function(record,id){\n    var text = record.get(combo.displayField);\n    return (text.indexOf(value)!=-1);\n  });\n  combo.expand();\n  return false;\n}","specialkey":"// TODO: 按回车键执行借方和贷方金额切换\nif (e.getKey() == e.ENTER) {\n  // 账簿\n  var ledgerId = app.LEDGER_ID_XWL.LEDGER_ID.getValue() ;\n  if(ledgerId === \"\" ||ledgerId === null || ledgerId === undefined){\n    Wb.info('请选择账簿!') ;\n    return false ;\n  }\n  \n  // 会计日期\n  var accDate = app.GL_DATE.getValue();\n  if(accDate === \"\" ||accDate === null || accDate === undefined){\n    Wb.info('请选择会计日期!') ;\n    return false ;\n  }else{\n    accDate = Wb.dateToStr(accDate).substring(0,7);\n  }\n  \n  // TODO: 当前选中\n  var r = app.grid5.getSelection()[0] ; \n  \n  // TODO: 显示科目选择窗口\n  Wb.run({\n    url:'m?xwl=xc/gl/journal/v-windows/handler-ccid-win',\n    params : {\n      'ledgerId' : ledgerId ,\n      'vtype' : '{#vtype#}'\n    },          \n    success:function(appObj){\n      appObj.initWindow({\n        accName : r.data.ACC_NAME,\n        ledgerId : ledgerId,\n        periodCode : accDate ,\n        groupId : 'ALL',\n        handlerCCID : function(returnObj){\n          // TODO: 处理CCID信息\n          var rObj = Wb.decode(returnObj) ;\n          r.set('ACC_ID', rObj.acc_id) ;    \n          r.set('ACC_NAME', rObj.acc_name);\n          r.set('CCID', rObj.acc_ccid) ;    \n          r.set('CCID_NAME', rObj.acc_ccid_name);\n          // 禁用账簿\n           app.LEDGER_ID_XWL.LEDGER_ID.setReadOnly(true) ;\n        }\n      });\n    }  \n  }) ;   \n}"},"children":[],"expanded":true,"type":"combo"}],"expanded":true,"type":"column"},{"configs":{"text":"<font color='red'>*<\/font>{#AMOUNT#}","align":"right","width":"100","dataIndex":"AMOUNT","titleAlign":"center","itemId":"AMOUNT_COL5","renderer":"return Ext.util.Format.number(value,'0,000.00');"},"children":[{"configs":{"minValue":"0","itemId":"editor"},"events":{"change":"if( newValue < 0 ){\n  Wb.toast('该单据金额应大于 0 !');\n  number.setValue(0);\n}"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"column"},{"configs":{"text":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#DESCRIPTION#}","width":"200","dataIndex":"DESCRIPTION","titleAlign":"center","itemId":"DESCRIPTION_COL5"},"children":[{"configs":{"itemId":"editor"},"children":[],"expanded":false,"type":"textarea"}],"expanded":true,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"},{"configs":{"region":"center","pagingBar":"false","selType":"checkboxmodel","hidden":"true","itemId":"grid6","editable":"true"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/ap/pay/DB/XC_AP_PAY_L_SELECT"},"children":[],"expanded":false,"type":"store"},{"configs":{"normalName":"grid6Tbar","itemId":"tbar"},"children":[{"configs":{"text":"{#purTypeBtn#}","normalName":"grid6purTypeBtn","itemId":"purTypeBtn"},"events":{"click":"var ap_pay_h_id = app.AP_PAY_H_ID.getValue();//付款单id\nvar ledger_id = app.LEDGER_ID_XWL.LEDGER_ID.getValue();//账簿id\nvar vendor_id = app.VENDOR_ID_XWL.VENDOR_ID.getValue();//供应商id\nvar ap_contract_id = app.AP_CONTRACT_ID_XWL.AP_CONTRACT_ID.getValue();//合同id\nvar ap_doc_cat_code = app.AP_DOC_CAT_CODE.getValue();//单据类型\nvar project_id = app.PROJECT_ID_XWL.PROJECT_ID.getValue();//项目id\n\n\n\nif(Wb.isEmpty(ledger_id)){\n  Wb.toast('{#qxxzzb#}');//请先选择账簿\n  return false;\n}\nvar curGrid = app.grid6;\nWb.run({\n  url: 'm?xwl=xc/ap/pay/LOV/LOV_XC_AP_PUR_TYPE', \n  success: function(app) {\n    app.initWin({\n      AP_PAY_H_ID : ap_pay_h_id,\n      AP_DOC_CAT_CODE : ap_doc_cat_code,\n      LEDGER_ID : ledger_id,\n      VENDOR_ID : vendor_id,\n      AP_CONTRACT_ID : ap_contract_id,\n      PROJECT_ID : project_id,\n      hideFun:function(rs){\n        Wb.each(rs, function(r) {\n          r.set('AP_PAY_L_ID',Xip.getId());\n          r.set('AP_PAY_H_ID',ap_pay_h_id);\n          r.set('ACC_ID',r.get('AP_ACC_ID_INV'));\n          r.set('ACC_NAME',r.get('AP_ACC_NAME_INV'));\n          r.set('AMOUNT',r.get('PAY_AMT'));\n          r.set('AP_DOC_CAT_CODE',r.get('GL_AP_DOC_CAT_CODE'));\n          r.set('AP_DOC_CAT_NAME',r.get('GL_AP_DOC_CAT_NAME'));\n          var grid1Store = curGrid.getStore();\n          for(var i=0;i<grid1Store.getCount();i++){\n            var gr = grid1Store.getAt(i);\n            if(gr.get('AP_PUR_TYPE_ID')==r.get('AP_PUR_TYPE_ID')){\n              return false;\n            }\n          }\n          Wb.add(curGrid,r.data, 'after', 1, false);\n          if(curGrid.getStore().getCount() > 0){\n            setProjectReadOnly(true);//项目置灰\n          }\n        });\n      }\n    });\n  }\n});\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#delBtn#}","itemId":"delBtn"},"events":{"click":"\nWb.remove(app.grid6);\nif(app.grid.store.getCount() === 0){\n  setProjectReadOnly(false);\n}"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","dataIndex":"AP_DOC_CAT_CODE","itemId":"AP_DOC_CAT_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#DEPT_NAME#}","hidden":"true","width":"150","dataIndex":"DEPT_NAME","titleAlign":"center","itemId":"DEPT_NAME_COL"},"children":[{"configs":{"labelWidth":"100","labelAlign":"right","normalName":"DEPT_NAME_PICK","itemId":"editor"},"children":[{"configs":{"tagConfigs":"minWidth:400","height":"300","itemId":"pickComp"},"events":{"itemdblclick":"var r=app.grid6.getSelectionModel().getSelection()[0];\nr.set('DEPT_ID',record.data.DEPT_ID);\nr.set('DEPT_NAME',record.data.DEPT_NAME);\nr.dirty = true;\napp.DEPT_NAME_PICK.setValue(record.data.DEPT_NAME);\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/com-lov/DEPT_ID_PICK/DB/GRID_XIP_PUB_DEPTS_SELECT_LD"},"events":{"beforeload":"operation.params = Wb.getValue([app.form1,app.tbar]);"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","dataIndex":"DEPT_ID","itemId":"DEPT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#CODE#}","dataIndex":"DEPT_CODE","itemId":"DEPT_CODE_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#NAME#}","dataIndex":"DEPT_NAME","itemId":"DEPT_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"100","emptyText":"{#CODE_NAME#}","labelAlign":"right","itemId":"QUERY_CODE_NAME"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.pickComp.getStore().load();\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":true,"type":"column"},{"configs":{"text":"{#PROJECT_NAME#}","width":"150","dataIndex":"PROJECT_NAME","titleAlign":"center","itemId":"PROJECT_NAME_COL"},"children":[{"configs":{"labelWidth":"100","labelAlign":"right","normalName":"PROJECT_NAME_PICK","itemId":"editor"},"children":[{"configs":{"tagConfigs":"minWidth:400","height":"300","itemId":"pickComp"},"events":{"itemdblclick":"var r=app.grid6.getSelectionModel().getSelection()[0];\nr.set('PROJECT_ID',record.data.PROJECT_ID);\nr.set('PROJECT_NAME',record.data.PROJECT_NAME);\nr.dirty = true;\napp.PROJECT_NAME_PICK.setValue(record.data.PROJECT_NAME);\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/com-lov/PROJECT_ID_PICK/DB/GRID_XC_PM_PROJECT_SELECT"},"events":{"beforeload":"operation.params = Wb.getValue([app.form1,app.tbar]);"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","dataIndex":"PROJECT_ID","itemId":"PROJECT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#CODE#}","dataIndex":"PROJECT_CODE","itemId":"PROJECT_CODE_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#NAME#}","dataIndex":"PROJECT_NAME","itemId":"PROJECT_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"100","emptyText":"{#CODE_NAME#}","labelAlign":"right","itemId":"QUERY_CODE_NAME"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.pickComp.getStore().load();\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":true,"type":"column"},{"configs":{"text":"{#AP_CONTRACT_NAME#}","hidden":"true","width":"150","dataIndex":"AP_CONTRACT_NAME","titleAlign":"center","itemId":"AP_CONTRACT_NAME_COL"},"children":[{"configs":{"labelWidth":"100","labelAlign":"right","normalName":"AP_CONTRACT_NAME_PICK","itemId":"editor"},"children":[{"configs":{"tagConfigs":"minWidth:400","height":"300","itemId":"pickComp"},"events":{"itemdblclick":"var r=app.grid6.getSelectionModel().getSelection()[0];\nr.set('AP_CONTRACT_ID',record.data.AP_CONTRACT_ID);\nr.set('AP_CONTRACT_NAME',record.data.AP_CONTRACT_NAME);\nr.dirty = true;\napp.AP_CONTRACT_NAME_PICK.setValue(record.data.AP_CONTRACT_NAME);\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/ap/ap-com-lov/AP_CONTRACT_ID_PICK/DB/GRID_XC_AP_CONTRACT_SELECT"},"events":{"beforeload":"operation.params = Wb.getValue([app.form1,app.tbar]);"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","dataIndex":"AP_CONTRACT_ID","itemId":"AP_CONTRACT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#CODE#}","dataIndex":"AP_CONTRACT_CODE","itemId":"AP_CONTRACT_CODE_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#NAME#}","dataIndex":"AP_CONTRACT_NAME","itemId":"AP_CONTRACT_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"100","emptyText":"{#CODE_NAME#}","labelAlign":"right","itemId":"QUERY_CODE_NAME"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.pickComp.getStore().load();\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":true,"type":"column"},{"configs":{"text":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#AP_PUR_TYPE_NAME#}","width":"120","dataIndex":"AP_PUR_TYPE_NAME","titleAlign":"center","itemId":"AP_PUR_TYPE_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#BG_ITEM_NAME#}","width":"150","dataIndex":"BG_ITEM_NAME","titleAlign":"center","itemId":"BG_ITEM_NAME_COL"},"children":[{"configs":{"labelWidth":"100","labelAlign":"right","normalName":"BG_ITEM_PICK","itemId":"editor"},"events":{"expand":"app.pickComp.getStore().load();"},"children":[{"configs":{"tagConfigs":"minWidth:400","height":"300","barExportButtons":"false","barExportAllButtons":"false","itemId":"pickComp"},"events":{"itemdblclick":"var r=app.grid.getSelectionModel().getSelection()[0];\nr.set('BG_ITEM_ID',record.data.BG_ITEM_ID);\nr.set('BG_ITEM_NAME',record.data.BG_ITEM_NAME);\napp.BG_ITEM_PICK.setValue(record.data.BG_ITEM_NAME);\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/com-lov/BG_ITEM_ID_PICK/DB/XC_BG_ITEMS_LD_SELECT"},"events":{"beforeload":"operation.params = Wb.getValue([app.form1,app.tbar]);"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","dataIndex":"BG_ITEM_ID","itemId":"BG_ITEM_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#CODE#}","dataIndex":"BG_ITEM_CODE","itemId":"BG_ITEM_CODE_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#NAME#}","dataIndex":"BG_ITEM_NAME","itemId":"BG_ITEM_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"100","emptyText":"{#CODE_NAME#}","labelAlign":"right","itemId":"QUERY_CODE_NAME"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.searchButton.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"searchButton","iconCls":"seek_icon"},"events":{"click":"app.pickComp.getStore().load();"},"children":[],"expanded":false,"type":"button"},{"configs":{"itemId":"cancelBtn","iconCls":"delete_icon"},"events":{"click":"var r=app.grid1.getSelectionModel().getSelection()[0];\nr.set('BG_ITEM_ID',null);\nr.set('BG_ITEM_NAME',null);\napp.BG_ITEM_PICK.setValue(null);\napp.BG_ITEM_PICK.getPicker().hide();"},"children":[],"expanded":false,"type":"item"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":true,"type":"column"},{"configs":{"text":"{#ACC_NAME#}","width":"150","dataIndex":"ACC_NAME","titleAlign":"center","itemId":"ACC_NAME_COL"},"children":[{"configs":{"labelWidth":"100","labelAlign":"right","normalName":"ACC_NAME_PICK","itemId":"editor"},"children":[{"configs":{"tagConfigs":"minWidth:400","height":"300","itemId":"pickComp"},"events":{"itemdblclick":"var r=app.grid6.getSelectionModel().getSelection()[0];\nr.set('ACC_ID',record.data.ACC_ID);\nr.set('ACC_NAME',record.data.ACC_NAME);\nr.dirty = true;\napp.ACC_NAME_PICK.setValue(record.data.ACC_NAME);\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/com-lov/ACC_ID_PICK/DB/XC_BG_LD_ACCOUNTS_SELECT_LD"},"events":{"beforeload":"operation.params = Wb.getValue([app.form1,app.tbar]);"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","dataIndex":"ACC_ID","itemId":"ACC_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#CODE#}","dataIndex":"ACC_CODE","itemId":"ACC_CODE_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#NAME#}","dataIndex":"ACC_NAME","itemId":"ACC_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"100","emptyText":"{#CODE_NAME#}","labelAlign":"right","itemId":"QUERY_CODE_NAME"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.pickComp.getStore().load();\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":true,"type":"column"},{"configs":{"text":"{#CCID_NAME#}","width":"150","dataIndex":"CCID_NAME","itemId":"CCID_NAME_COL"},"children":[{"configs":{"displayField":"CCID_NAME","triggerCls":"x-form-search-trigger","valueField":"CCID","itemId":"editor","onTriggerClick":"  // 账簿\n  var ledgerId = app.LEDGER_ID_XWL.LEDGER_ID.getValue() ;\n  if(ledgerId === \"\" ||ledgerId === null || ledgerId === undefined){\n    Wb.info('{#qxzzb#}') ;//请选择账簿\n    return false ;\n  }\n  \n  // 会计日期\n  var accDate = app.GL_DATE.getValue() ;\n  if(accDate === \"\" ||accDate === null || accDate === undefined){\n    Wb.info('{#qxzkjrq#}') ;//请选择会计日期\n    return false ;\n  }else{\n\taccDate = Wb.dateToStr(accDate).substring(0,7);\n  }\n  \n  // TODO: 当前选中\n  var r = app.grid6.getSelection()[0] ; \n  \n  // TODO: 显示科目选择窗口\n  Wb.run({\n    url:'m?xwl=xc/gl/journal/v-windows/handler-ccid-win',\n    params : {\n      'ledgerId' : ledgerId,\n      'vtype' : '{#vtype#}'\n    },          \n    success:function(appObj){\n      appObj.initWindow({\n        accName : r.data.ACC_NAME,\n        ledgerId : ledgerId,\n        periodCode : accDate ,\n        groupId : 'ALL',\n        handlerCCID : function(returnObj){\n          // TODO: 处理CCID信息\n          var rObj = Wb.decode(returnObj) ;\n          r.set('ACC_ID', rObj.acc_id) ;    \n          r.set('ACC_NAME', rObj.acc_name);\n          r.set('CCID', rObj.acc_ccid) ;    \n          r.set('CCID_NAME', rObj.acc_ccid_name);\n          // 禁用账簿\n           app.LEDGER_ID_XWL.LEDGER_ID.setReadOnly(true) ;\n        }\n      });\n    }  \n  }) ;   "},"events":{"beforequery":"var combo = e.combo;\nif(!e.forceAll){\n  var value = e.query;\n  combo.store.filterBy(function(record,id){\n    var text = record.get(combo.displayField);\n    return (text.indexOf(value)!=-1);\n  });\n  combo.expand();\n  return false;\n}","specialkey":"// TODO: 按回车键执行借方和贷方金额切换\nif (e.getKey() == e.ENTER) {\n  // 账簿\n  var ledgerId = app.LEDGER_ID_XWL.LEDGER_ID.getValue() ;\n  if(ledgerId === \"\" ||ledgerId === null || ledgerId === undefined){\n    Wb.info('请选择账簿!') ;\n    return false ;\n  }\n  \n  // 会计日期\n  var accDate = app.GL_DATE.getValue();\n  if(accDate === \"\" ||accDate === null || accDate === undefined){\n    Wb.info('请选择会计日期!') ;\n    return false ;\n  }else{\n    accDate = Wb.dateToStr(accDate).substring(0,7);\n  }\n  \n  // TODO: 当前选中\n  var r = app.grid6.getSelection()[0] ; \n  \n  // TODO: 显示科目选择窗口\n  Wb.run({\n    url:'m?xwl=xc/gl/journal/v-windows/handler-ccid-win',\n    params : {\n      'ledgerId' : ledgerId ,\n      'vtype' : '{#vtype#}'\n    },          \n    success:function(appObj){\n      appObj.initWindow({\n        accName : r.data.ACC_NAME,\n        ledgerId : ledgerId,\n        periodCode : accDate ,\n        groupId : 'ALL',\n        handlerCCID : function(returnObj){\n          // TODO: 处理CCID信息\n          var rObj = Wb.decode(returnObj) ;\n          r.set('ACC_ID', rObj.acc_id) ;    \n          r.set('ACC_NAME', rObj.acc_name);\n          r.set('CCID', rObj.acc_ccid) ;    \n          r.set('CCID_NAME', rObj.acc_ccid_name);\n          // 禁用账簿\n           app.LEDGER_ID_XWL.LEDGER_ID.setReadOnly(true) ;\n        }\n      });\n    }  \n  }) ;   \n}"},"children":[],"expanded":true,"type":"combo"}],"expanded":true,"type":"column"},{"configs":{"text":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#AMOUNT#}","align":"right","width":"100","dataIndex":"AMOUNT","titleAlign":"center","itemId":"AMOUNT_COL","renderer":"return Ext.util.Format.number(value,'0,000.00');"},"children":[{"configs":{"itemId":"editor","maxValue":"0"},"events":{"change":"if( newValue > 0 ){\n  Wb.toast('该单据金额应小于 0 !');\n  number.setValue(-0);\n  return;\n}"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"column"},{"configs":{"text":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#DESCRIPTION#}","dataIndex":"DESCRIPTION","titleAlign":"center","itemId":"DESCRIPTION_COL","flex":"1"},"children":[{"configs":{"itemId":"editor"},"children":[],"expanded":false,"type":"textarea"}],"expanded":true,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"},{"configs":{"region":"south","itemId":"form2"},"children":[],"expanded":false,"type":"form"}],"expanded":true,"type":"panel"},{"configs":{"file":"m?xwl=xc/gl/journal/v-windows/new-xwl-voucher","itemId":"edit_v_xwl"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"tab"}],"expanded":true,"type":"window"}],"expanded":true,"type":"module"}],"pageLink":"{container:false}","iconCls":""}