{"inframe":false,"title":"","hidden":false,"roles":{"default":1},"children":[{"configs":{"serverScript":"//获取多语言的类别\nvar lang = request.getSession().getAttribute(\"XzSessionVars\").get('language');\nrequest.setAttribute(\"language\",lang);\n\nvar sql, data = app.get();\nsql = '';\n// if (!Wb.isEmpty(data.V_STATUS_YES)) {\n//   if('Y'==data.V_STATUS_YES){\n//    sql+=' and h.V_STATUS>=3 ';  \n//   }\n// }\n\n// if (!Wb.isEmpty(data.LEDGER_ID)) {\n//   sql+=' and h.LEDGER_ID={?LEDGER_ID?}';\n// }\n\n//单据类型\nif(data.AP_DOC_CAT_CODE != 'ALL' && !Wb.isEmpty(data.AP_DOC_CAT_CODE)) {\n  sql+=\" and h.AP_DOC_CAT_CODE= '\"+data.AP_DOC_CAT_CODE+\"' \";\n}\n\nif (!Wb.isEmpty(data.AP_PAY_H_CODE)) {\n  sql+=' and h.AP_PAY_H_CODE like \\'%'+data.AP_PAY_H_CODE+'%\\' ';\n}\nif (!Wb.isEmpty(data.AMOUNT_START)) {\n  sql+=' and h.AMOUNT >='+data.AMOUNT_START;\n}\nif (!Wb.isEmpty(data.AMOUNT_END)) {\n  sql+=' and h.AMOUNT <='+data.AMOUNT_END;\n}\nif (!Wb.isEmpty(data.VENDOR_NAME)) {\n  sql += \" and (vendor.VENDOR_CODE like '%\"+data.VENDOR_NAME+\"%' or vendor.VENDOR_NAME like '%\"+data.VENDOR_NAME+\"%')\";\n}\nif (!Wb.isEmpty(data.PROJECT_NAME)) {\n  sql += \" and (project.PROJECT_CODE like '%\"+data.PROJECT_NAME+\"%' or project.PROJECT_NAME like '%\"+data.PROJECT_NAME+\"%')\";\n}\n//签字状态\nif(data.SIGN_STATUS!='ALL'){\n  sql += \" and h.SIGN_STATUS = '\"+data.SIGN_STATUS+\"' \";\n}\n//状态\nif(!(data.V_STATUS == 'ALL' || Wb.isEmpty(data.V_STATUS))){\n  sql += \" and h.V_STATUS = '\"+data.V_STATUS+\"' \";\n}\n\nif (!Wb.isEmpty(data.GL_DATE_START)) {\n  if (!Wb.isEmpty(data.GL_DATE_END)) {\n    sql+=' and h.GL_DATE BETWEEN {?GL_DATE_START?} and {?GL_DATE_END?} ';\n  }else{\n\tsql+=' and h.GL_DATE >= {?GL_DATE_START?}';\n  }\n}else{\n\tif (!Wb.isEmpty(data.GL_DATE_END)) {\n      sql+=' and h.GL_DATE <= {?GL_DATE_END?}';\n    }\n}\nrequest.setAttribute('sql', sql);","itemId":"module"},"children":[{"configs":{"sql":"SELECT \n\th.* ,\n\tledger.LEDGER_CODE,\n\tledger.LEDGER_NAME,\n\tvendor.VENDOR_CODE,\n\tvendor.VENDOR_NAME,\n\tproject.PROJECT_CODE,\n\tproject.PROJECT_NAME,\n\tdept.DEPT_CODE,\n\tdept.DEPT_NAME,\n\tcontract.AP_CONTRACT_CODE,\n\tcontract.AP_CONTRACT_NAME,\n\taccount.ACC_CODE,\n\taccount.ACC_NAME,\n\tccid.CCID_CODE,\n\tccid.CCID_NAME,\n\temp.EMP_NAME CREATED_BY_NAME,\n  \temp1.EMP_NAME SIGN_USER_NAME,\n\tdtl1.VAL_NAME V_STATUS_NAME,\n\tdtl2.VAL_NAME SIGN_STATUS_NAME,\nCASE h.AP_DOC_CAT_CODE\n\tWHEN 'FKD_YUFK' THEN (SELECT SUM(l.NO_CANCEL_AMT) FROM xc_ap_pay_l l WHERE l.AP_PAY_H_ID = h.AP_PAY_H_ID)  \n\tWHEN 'FKD_YUFK-H' THEN (SELECT SUM(l.NO_CANCEL_AMT) FROM xc_ap_pay_l l WHERE l.AP_PAY_H_ID = h.AP_PAY_H_ID)  \n\tELSE 0\nEND NO_PAY_AMT \n\t\nFROM xc_ap_pay_h h\n\tLEFT JOIN xc_gl_ledgers ledger ON ledger.LEDGER_ID = h.LEDGER_ID\n\tLEFT JOIN xc_ap_vendors vendor ON vendor.VENDOR_ID = h.VENDOR_ID\n\tLEFT JOIN xc_pm_projects project ON project.PROJECT_ID = h.PROJECT_ID\n\tLEFT JOIN xip_pub_depts dept ON dept.DEPT_ID = h.DEPT_ID\n\tLEFT JOIN xc_ap_contract contract ON contract.AP_CONTRACT_ID= h.AP_CONTRACT_ID\n\tLEFT JOIN xc_gl_accounts account ON account.ACC_ID = h.PAY_ACC_ID\n\tLEFT JOIN xc_gl_ccid ccid ON ccid.CCID = h.PAY_CCID\n\tLEFT JOIN xip_pub_emps emp ON emp.EMP_ID = (SELECT EMP_ID FROM xip_pub_users WHERE USER_ID=h.CREATED_BY)\n  \tLEFT JOIN xip_pub_emps emp1 ON emp1.EMP_ID = (SELECT EMP_ID FROM xip_pub_users WHERE USER_ID=h.SIGN_USER_ID)\n\tLEFT JOIN xip_pub_val_set_dtl_lang dtl1 ON (dtl1.VAL_SET_CODE='XC_GL_V_STATUS' and dtl1.VAL_CODE=h.V_STATUS and dtl1.VAL_SET_LANG = '{#language#}')\n  \tLEFT JOIN xip_pub_val_set_dtl_lang dtl2 ON (dtl2.VAL_SET_CODE='XC_EX_SIGN_STATUS' and dtl2.VAL_CODE=h.SIGN_STATUS and dtl2.VAL_SET_LANG = '{#language#}')\n    LEFT JOIN xip_pub_val_set_dtl_lang dtl3 ON (dtl3.VAL_SET_CODE='XC_AP_PAY_TYPE' and dtl3.VAL_CODE=h.V_STATUS and dtl3.VAL_SET_LANG = '{#language#}')\nWHERE \n\th.LEDGER_ID={?LEDGER_ID?}\nAND h.INIT = '2'\n{#sql#}\nORDER BY h.CREATION_DATE DESC","itemId":"dataprovider1"},"children":[],"expanded":false,"type":"dataprovider"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}