{"inframe":false,"title":"","hidden":false,"roles":{"default":1},"children":[{"configs":{"serverScript":"var recs = Wb.decode(request.getParameter('destroy'));\n\nWb.each(recs, function(rec) {\n    app.run('SELECT 1 FROM xc_ap_inv_gl_h WHERE AP_INV_GL_H_ID=\\''+rec.AP_INV_GL_H_ID+'\\' AND V_STATUS>=3 ',{ \n       errorText:'凭证审核通过，不允许删除'\n\t});\n    \n    app.run('SELECT 1 FROM xc_ap_inv_gl_h WHERE AP_INV_GL_H_ID=\\''+rec.AP_INV_GL_H_ID+'\\' AND AP_INV_H_ID is not null ',{ \n       errorText:'发票复核生成，不允许删除'\n\t});\n});\n\napp.run('delete from xc_ap_inv_gl_l where AP_INV_GL_H_ID={?AP_INV_GL_H_ID?}', {\n  arrayName: 'destroy',\n  transaction: 'start' //开始事务\n});\n\n\napp.run('delete from xc_ap_inv_gl_h where AP_INV_GL_H_ID={?AP_INV_GL_H_ID?}', {\n  arrayName: 'destroy'\n});\n\napp.run('delete from xc_ap_inv_trans where SOURCE_ID={?AP_INV_GL_H_ID?}', {\n  arrayName: 'destroy'\n});\n\napp.run('update xc_ap_inv_gl_h set '+\n          'NO_PAY_AMT=NO_PAY_AMT-{?decimal.INV_AMOUNT?},'+\n          'NO_REQ_AMT=NO_REQ_AMT-{?decimal.INV_AMOUNT?}'+\n          ' where AP_INV_GL_H_ID={?L_AP_INV_GL_H_ID?}',\n{\n    arrayName: 'destroy'\n});","itemId":"module"},"children":[],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}