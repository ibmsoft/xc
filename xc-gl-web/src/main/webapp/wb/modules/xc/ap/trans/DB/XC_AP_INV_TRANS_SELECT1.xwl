{"inframe":false,"title":"","hidden":false,"roles":{"default":1},"children":[{"configs":{"serverScript":"var sql, data = app.get();\nsql = ' where 1=1 ';\nif(!Wb.isEmpty(data.QUERY_FROM)){\n  //申请单(申请单的SOURCE_ID是申请单id)\n  if('SQ'==data.QUERY_FROM){\n   sql+= 'and (a.SOURCE_ID={?SOURCE_ID?} or (a.SOURCE_DTL_ID =(select AP_PAY_L_ID from xc_ap_pay_l c where c.AP_PAY_REQ_H_ID  = {?SOURCE_ID?} and c.AP_PAY_L_ID = a.SOURCE_DTL_ID)))';\n  }\n}else{\n  if (!Wb.isEmpty(data.AP_INV_GL_H_ID)) {\n    sql+=' and a.AP_INV_GL_H_ID={?AP_INV_GL_H_ID?}';\n  }\n  if (!Wb.isEmpty(data.SOURCE_ID)) {\n    sql+=' and (a.SOURCE_ID={?SOURCE_ID?} or (a.SOURCE_DTL_ID =(select AP_PAY_L_ID from xc_ap_pay_l where a.SOURCE_ID = {?SOURCE_ID?} )))';\n  }\n  if (!Wb.isEmpty(data.SOURCE_DTL_ID)) {\n    sql+=' and a.SOURCE_DTL_ID={?SOURCE_DTL_ID?}';\n  }\n}\nrequest.setAttribute('sql', sql);\n","itemId":"module"},"children":[{"configs":{"oracle":"SELECT \n  a.*,\n  b.ap_cat_name as AP_DOC_CAT_NAME,\n  sum(a.DR_AMT) as JFJE,\n  sum(a.REQ_AMT) as SQJE,\n  a.AP_DOC_CODE AS SOURCE_CODE,\n  a.DESCRIPTION AS SOURCE_NAME\nFROM\n  xc_ap_inv_trans a left join xc_ap_doc_cats b\non a.ap_doc_cat_code = b.ap_cat_code\n{#sql#} \n group by AP_PAY_H_ID\norder by CREATION_DATE","itemId":"select","mysql":"SELECT \n  a.*,\n  b.ap_cat_name as AP_DOC_CAT_NAME,\n  case\n  when a.AP_DOC_CAT_CODE = 'CGJS'\n  then\n  sum(a.DR_AMT)\n  when a.AP_DOC_CAT_CODE = 'QTFK'\n  then\n  sum(a.DR_AMT)\n  when a.AP_DOC_CAT_CODE = 'FKD_QTFK'\n  then\n  sum(a.DR_AMT)\n  when a.AP_DOC_CAT_CODE = 'FKD_CGJS'\n  then\n  sum(a.DR_AMT)\n  else\n  a.DR_AMT \n  end as JFJE,\n  case\n  when a.AP_DOC_CAT_CODE = 'CGJS'\n  then\n  sum(a.REQ_AMT)\n  when a.AP_DOC_CAT_CODE = 'QTFK'\n  then\n  sum(a.REQ_AMT)\n  when a.AP_DOC_CAT_CODE = 'FKD_QTFK'\n  then\n  sum(a.REQ_AMT)\n  when a.AP_DOC_CAT_CODE = 'FKD_CGJS'\n  then\n  sum(a.REQ_AMT)\n  else\n  a.REQ_AMT \n  end as SQJE,\n  a.AP_DOC_CODE AS SOURCE_CODE,\n  a.DESCRIPTION AS SOURCE_NAME\nFROM\n  xc_ap_inv_trans a left join xc_ap_doc_cats b\non a.ap_doc_cat_code = b.ap_cat_code\n{#sql#} \nand\n(a.ap_inv_gl_h_id is null or a.ap_inv_gl_h_id = '')\ngroup by a.ap_doc_code\norder by CREATION_DATE\nlimit {?bigint.start?},{?bigint.limit?}"},"children":[],"expanded":false,"type":"sqlswitcher"},{"configs":{"autoPage":"false","sql":"{#select#}","itemId":"dataprovider1"},"children":[],"expanded":false,"type":"dataprovider"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}