{"inframe":false,"title":"合同管理","hidden":false,"roles":{"default":1},"children":[{"configs":{"serverScript":"var userId = request.getSession().getAttribute(\"XzSessionVars\").get('userId');\n\nvar protocol = request.getProtocol() ;\nvar ipAddr = request.getServerName();\nvar port = request.getServerPort() ;\nvar ctxPath = request.getContextPath() ;\n\nvar pp = protocol.substr(0,5) ;\nprotocol = (pp.indexOf(\"https\") == -1 ? \"http\" : \"https\") ;\n\nvar url = protocol + \"://\" + ipAddr +\":\" + port + ctxPath ;\n\nrequest.setAttribute('contextPath',ctxPath);\nrequest.setAttribute(\"userId\",userId);\nrequest.setAttribute(\"appIP\",url);\nvar appId = request.getSession().getAttribute(\"XzSessionVars\").get('appId');\nrequest.setAttribute(\"funId\",request.getParameter('funId'));\nrequest.setAttribute(\"appId\",request.getParameter('appId'));\n//引入对应的json文件\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,'xc/ap/ct/json/XC_AP_CONTRACT');","itemId":"module"},"events":{"finalize":"var ledgerId;\nvar legerName;\nvar vendorId;\nvar legeridDefault;\nvar legernameDefault;\n\napp.DEPT_NAME.DEPT_NAME.fieldLabel='{#deptName#}';\napp.DEPT_NAME.DEPT_NAME.allowBlank=true;\n\nfunction clearOtherFn(type){\n  if(type=='xip_pub_orgs'){\n    app.LEDGER_ID.setValue('');\n    app.VENDOR_NAME.VENDOR_NAME.setValue('');\n  \tapp.VENDOR_NAME.QUERY_LEDGER_ID.setValue('');\n    app.DEPT_NAME.DEPT_NAME.setValue('');\n    app.DEPT_NAME.QUERY_LEDGER_ID.setValue('');\n    app.DEPT_ID.setValue('');\n    app.PROJECT_NAME.PROJECT_NAME.setValue('');\n    app.PROJECT_NAME.QUERY_DEPT_ID.setValue('');\n    app.PROJECT_ID.setValue('');\n  }else if(type==='xc_ap_vendors'){\n   \n  }else if(type==='xip_pub_depts'){\n    app.PROJECT_NAME.PROJECT_NAME.setValue('');//项目\n    app.PROJECT_NAME.QUERY_DEPT_ID.setValue('');\n    app.PROJECT_ID.setValue('');\n    app.DEPT_ID.setValue('');\n  }\n\n}\n\nfunction returnRowFn(r,type){\n  if(type=='xip_pub_orgs'){\n    app.LEDGER_ID.setValue(r.data.LEDGER_ID);\n    app.VENDOR_NAME.QUERY_LEDGER_ID.setValue(r.data.LEDGER_ID);\n    app.VENDOR_NAME.VENDOR_NAME.setValue('');\n    app.DEPT_NAME.QUERY_LEDGER_ID.setValue(r.data.LEDGER_ID);\n    app.DEPT_NAME.DEPT_NAME.setValue('');\n    app.DEPT_ID.setValue('');\n    app.PROJECT_NAME.PROJECT_NAME.setValue('');\n    app.PROJECT_ID.setValue('');\n  }else if(type==='xc_ap_vendors'){\n\n  }else if(type==='xc_pm_projects'){\n\tapp.PROJECT_ID.setValue(r.data.PROJECT_ID);\n  }else if(type==='xip_pub_depts'){\n   app.PROJECT_NAME.QUERY_DEPT_ID.setValue(r.get('DEPT_ID'));\n   app.PROJECT_NAME.PROJECT_NAME.setValue('');\n   app.PROJECT_ID.setValue('');\n   app.DEPT_ID.setValue(r.get('DEPT_ID'));\n  }else if(type=='xc_ap_emp'){\n    app.EMP_ID.setValue(r.data.EMP_ID);\n  }\n}","initialize":"var change = '';\nvar addWinValue = '';\nvar isEdit = 'N';"},"children":[{"configs":{"itemId":"request"},"children":[{"configs":{"autoLoad":"true","itemId":"ldInitStore","url":"m?xwl=xc/com-lov/LEDGER_ID_PICK/DB/XC_GL_LEDGERS_SELECT_SEC"},"events":{"load":"var orgStore = app.ORG_NAME.ORG_NAME.getPicker().getStore();\norgStore.load();//组织store加载\nvar vorg = app.QUERY_ORG_NAME.ORG_NAME.getPicker().getStore();\napp.CONTRACT_CLASSIFY.store.load();\nvorg.load({\n  callback:function(){\n    app.QUERY_ORG_NAME.ORG_NAME.setValue(vorg.getAt(0).get('ORG_NAME'));\n     app.QUERY_ORG_NAME.ORG_ID.setValue(vorg.getAt(0).get('ORG_ID'));\n    app.queryBtn.fireEvent('click');\n}\n}\n);\n\n\n\n\n\n"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"folder"},{"configs":{"maximized":"true","height":"500","layout":"border","width":"800","closeAction":"hide","buttonAlign":"center","itemId":"historyWin","modal":"true","maximizable":"true"},"children":[{"configs":{"region":"center","selType":"checkboxmodel","itemId":"historyGrid"},"events":{"itemdblclick":"app.updateBtn.fireEvent('click');"},"children":[{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"{#seek#}","itemId":"lookHistoryBtn","iconCls":"seek_icon"},"events":{"click":"var vrec = app.historyGrid.getSelection();\nif(vrec.length<1){\n  Wb.toast('{#editMsg1#}');\n  return;\n}\nWb.run({\n\turl:'m?xwl=xc/ap/ct/XC_AP_CONTRACT_VIEW',\n  \tsuccess:function(app){\n      app.initWin({\n      \t'contractId':vrec[0].data.AP_CONTRACT_ID,\n        'flag':'history'\n      });\n    }\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#back#}","itemId":"returnBtn","iconCls":"first_icon"},"events":{"click":"app.historyWin.hide();"},"children":[],"expanded":false,"type":"button"}],"expanded":false,"type":"toolbar"},{"configs":{"itemId":"store","url":"m?xwl=xc/ap/ct/data/getContractHisInfo"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#rowNum#}","align":"center","width":"50","xtype":"rownumberer","itemId":"Row_num"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"合同ID","hidden":"true","dataIndex":"AP_CONTRACT_ID","titleAlign":"center","itemId":"AP_CONTRACT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#ledgerId#}","hidden":"true","dataIndex":"LEDGER_ID","itemId":"LEDGER_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#ledgerName#}","hidden":"true","width":"150","dataIndex":"LEDGER_NAME","titleAlign":"center","itemId":"LEDGER_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#version#}","width":"150","dataIndex":"VERSION","titleAlign":"center","itemId":"VERSION_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#orgId#}","hidden":"true","dataIndex":"ORG_ID","itemId":"ORG_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#org#}","width":"150","dataIndex":"ORG_NAME","titleAlign":"center","itemId":"ORG_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#code#}","dataIndex":"AP_CONTRACT_CODE","titleAlign":"center","itemId":"AP_CONTRACT_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#c_name#}","width":"120","dataIndex":"AP_CONTRACT_NAME","titleAlign":"center","itemId":"AP_CONTRACT_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#vendorId#}","hidden":"true","dataIndex":"VENDOR_ID","itemId":"VENDOR_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#vendorName#}","dataIndex":"VENDOR_NAME","titleAlign":"center","itemId":"VENDOR_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#contractType#}","dataIndex":"AP_CONTRACT_TYPE","titleAlign":"center","itemId":"AP_CONTRACT_TYPE_COL","renderer":"if(value=='BKHT') return '{#bkht#}';\nelse if(value=='KKHT') return '{#kkht#}';"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#contractClassify#}","hidden":"true","dataIndex":"CONTRACT_CLASSIFY","titleAlign":"center","itemId":"CONTRACT_CLASSIFY_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#contractClassify#}","dataIndex":"CONTRACT_TYPE_NAME","titleAlign":"center","itemId":"CONTRACT_TYPE_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#workflowStatus#}","hidden":"true","dataIndex":"AUDIT_STATUS","titleAlign":"center","itemId":"AUDIT_STATUS_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#workflowStatus#}","hidden":"true","dataIndex":"AUDIT_STATUS_DESC","titleAlign":"center","itemId":"AUDIT_STATUS_DESC_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#auditStatus#}","hidden":"true","dataIndex":"SYS_AUDIT_STATUS","titleAlign":"center","itemId":"SYS_AUDIT_STATUS_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#auditStatus#}","dataIndex":"SYS_AUDIT_STATUS_DESC","titleAlign":"center","itemId":"SYS_AUDIT_STATUS_DESC_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#projectId#}","hidden":"true","dataIndex":"PROJECT_ID","itemId":"PROJECT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#projectName#}","dataIndex":"PROJECT_NAME","titleAlign":"center","itemId":"PROJECT_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#deptId#}","hidden":"true","dataIndex":"DEPT_ID","itemId":"DEPT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#deptName#}","dataIndex":"DEPT_NAME","titleAlign":"center","itemId":"DEPT_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#contractAmt#}","align":"right","dataIndex":"AMOUNT","titleAlign":"center","itemId":"AMOUNT_COL","renderer":"return Wb.format(value,'0,000.00');"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#taxAmt#}","align":"right","dataIndex":"TAX_AMT","titleAlign":"center","itemId":"TAX_AMT_COL","renderer":"return Wb.format(value,'0,000.00');"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#invAmount#}","align":"right","dataIndex":"INV_AMOUNT","titleAlign":"center","itemId":"INV_AMOUNT_COL","renderer":"return Wb.format(value,'0,000.00');"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#startDate#}","dataIndex":"START_DATE","format":"Y-m-d","titleAlign":"center","itemId":"START_DATE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#endDate#}","dataIndex":"END_DATE","format":"Y-m-d","titleAlign":"center","itemId":"END_DATE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#isClose#}","dataIndex":"IS_CLOSE","titleAlign":"center","itemId":"IS_CLOSE_COL","renderer":"if(value==\"Y\"){\n  return '{#Y#}';\n}else{\n  return '{#N#}';\n}\n  "},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#description#}","dataIndex":"DESCRIPTION","titleAlign":"center","itemId":"DESCRIPTION_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#principal#}","hidden":"true","dataIndex":"CONTRACT_USER","titleAlign":"center","itemId":"CONTRACT_USER_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#principal#}","dataIndex":"EMP_NAME","titleAlign":"center","itemId":"EMP_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#principal#}","hidden":"true","dataIndex":"EMP_ID","titleAlign":"center","itemId":"EMP_ID_COL"},"children":[],"expanded":false,"type":"column"}],"expanded":false,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":false,"type":"window"},{"configs":{"title":"往来明细","height":"500","width":"600","layout":"border","closeAction":"hide","itemId":"mxWin"},"children":[{"configs":{"region":"north","height":"130","style":"border-width:0px","layout":"form","border":"false","itemId":"form2"},"children":[{"configs":{"frame":"false","style":"border-width:0px","layout":"form","border":"true","itemId":"panel1"},"children":[{"configs":{"frame":"false","style":"border-width:0px;padding-top:10px","layout":"column","border":"false","itemId":"tr1"},"children":[{"configs":{"frame":"false","style":"border-width:0px","layout":"form","columnWidth":".4","border":"false","itemId":"td_1"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"AP_CONTRACT_CODE_MX","fieldLabel":"{#code#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"frame":"false","style":"border-width:0px","layout":"form","columnWidth":".4","border":"false","itemId":"td_2"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","allowBlank":"false","width":"280","labelAlign":"right","itemId":"AP_CONTRACT_NAME_MX","fieldLabel":"{#c_name#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"frame":"false","style":"border-width:0px;padding-top:0px","layout":"column","border":"false","itemId":"tr2"},"children":[{"configs":{"frame":"false","style":"border-width:0px","layout":"form","columnWidth":".4","border":"false","itemId":"td_1"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"VENDOR_NAME_MX","fieldLabel":"{#vendorName#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"frame":"false","style":"border-width:0px","layout":"form","columnWidth":".4","border":"false","itemId":"td_2"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"AMOUNT_MX","fieldLabel":"{#contractAmt#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":false,"type":"panel"},{"configs":{"frame":"false","style":"border-width:0px;padding-top:0px","layout":"column","border":"false","itemId":"tr3"},"children":[{"configs":{"frame":"false","style":"border-width:0px","layout":"form","columnWidth":".4","border":"false","itemId":"td_1"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","allowBlank":"false","format":"Y-m-d","labelAlign":"right","itemId":"START_DATE_MX","fieldLabel":"*{#startDate#}"},"children":[],"expanded":true,"type":"date"}],"expanded":true,"type":"panel"},{"configs":{"frame":"false","style":"border-width:0px","layout":"form","columnWidth":".4","border":"false","itemId":"td_2"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","format":"Y-m-d","labelAlign":"right","itemId":"END_DATE_MX","fieldLabel":"{#endDate#}"},"children":[],"expanded":true,"type":"date"},{"configs":{"hidden":"true","itemId":"AP_CONTRACT_ID_TXT"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":false,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"form"},{"configs":{"region":"center","style":"padding-top:20px","buttonAlign":"center","itemId":"grid1"},"children":[{"configs":{"itemId":"buttons"},"children":[{"configs":{"text":"{#save#}","itemId":"saveBtn","iconCls":"ok_icon"},"events":{"click":"app.mxWin.hide();"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#cancel#}","itemId":"closeBtn","iconCls":"cancel_icon"},"events":{"click":"app.mxWin.hide();"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"array"},{"configs":{"itemId":"store","url":"m?xwl=xc/ap/ct/data/selectMX"},"children":[],"expanded":true,"type":"store"},{"configs":{"itemId":"features"},"children":[{"configs":{"ftype":"summary","itemId":"features"},"children":[],"expanded":false,"type":"feature"}],"expanded":true,"type":"array"},{"configs":{"itemId":"columns"},"children":[{"configs":{"summaryRenderer":"return '{#summary#}';","text":"{#date#}","dataIndex":"T_DATE","itemId":"T_DATE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"summaryRenderer":"\n\nreturn value.toFixed(2);\n","text":"{#prepaidAmt#}","xtype":"numbercolumn","align":"right","dataIndex":"YF_AMOUNT","itemId":"AMOUNT_YF_COL","summaryType":"sum"},"children":[],"expanded":false,"type":"column"},{"configs":{"summaryRenderer":"return value.toFixed(2);","text":"{#settledAmt#}","xtype":"numbercolumn","align":"right","dataIndex":"JS_AMOUNT","itemId":"AMOUNT_JS_COL","summaryType":"sum"},"children":[],"expanded":false,"type":"column"},{"configs":{"summaryRenderer":"return value.toFixed(2);","text":"{#invoiceAmt#}","xtype":"numbercolumn","align":"right","dataIndex":"FP_AMOUNT","itemId":"AMOUNT_FP_COL","summaryType":"sum"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":false,"type":"grid"}],"expanded":false,"type":"window"},{"configs":{"maximized":"true","height":"400","width":"700","layout":"border","closeAction":"hide","buttonAlign":"center","itemId":"addEditewin","maximizable":"true"},"events":{"show":"var attCatCode = '';\nWb.request({\n  url : '{#contextPath#}'+'/apPayReqCommonAction.do?method=getProcAndFormsByCat',\n  params:{'LEDGER_ID':app.ORG_NAME.LEDGER_ID.getValue(),'AP_DOC_CAT_CODE':'CGHT'},\n  success:function(resp){\n    var rec = Wb.decode(resp.responseText);\n    if(rec.flag=='0'){\n       attCatCode = rec.ATT_CAT_CODE;\n    }else{\n       Wb.toast('{#xc_ap_ct_doc_cat#}'+'CGHT'+'{#xc_ap_ct_enclosure_no_set#}');\n    }\n    document.getElementById('enclosurePanel').src = '{#contextPath#}/m?xwl=xip/tools/att/attrManage/attrManage' + '&userId=' + '{#userId#}' + '&srcId=' + app.AP_CONTRACT_ID.getValue() + '&attCat=' + attCatCode;\n  }\n});\n"},"children":[{"configs":{"region":"north","frame":"false","buttonAlign":"center","border":"false","bodyPadding":"0 0 0 0","itemId":"form1"},"children":[{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"{#xc_ap_ct_save#}","itemId":"saveBtn","iconCls":"save_icon"},"events":{"click":"app.VENDOR_NAME.VENDOR_NAME.allowBlank=false;\napp.DEPT_NAME.DEPT_NAME.allowBlank = false;\napp.INV_AMOUNT.setValue(app.AMOUNT.getValue()+app.TAX_AMT.getValue());\nif(!Wb.verify(app.form1)){\n  Wb.toast('{#saveMsg1#}');\n  return;\n}\n\nvar deptid = app.DEPT_NAME.DEPT_ID.getValue();\nvar proid =app.PROJECT_NAME.PROJECT_ID.getValue();\nvar vendorid = app.VENDOR_NAME.VENDOR_ID.getValue();\nvar empid = app.CONTRACT_USER.EMP_ID.getValue();\n\n\nvar startDate = app.START_DATE.getValue();\nvar endDate = app.END_DATE.getValue();\nif(startDate>endDate){\n  Wb.toast('{#saveMsg4#}');\n  return;\n}\nWb.request({\n  url:'{#contextPath#}'+'/apContractAction.do?method=saveContarct',\n  params:{'info':Wb.getValue(app.form1)},\n  success:function(resp){\n    var rec = Wb.decode(resp.responseText);\n    if(rec.flag=='0'){\n      Wb.toast('{#saveMsg5#}');\n      app.Grid.store.reload();\n      isEdit = 'Y';\n      addWinValue=Wb.encode(Wb.getValue(app.form1));\n      app.submit1Btn.setDisabled(false);\n    }else if(rec.flag=='1'){\n      Wb.toast(rec.msg);\n    }\n\n  }\n});\n\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#submit#}","itemId":"submit1Btn","disabled":"true","iconCls":"up_icon"},"events":{"click":"if(addWinValue!=Wb.encode(Wb.getValue(app.form1))&&isEdit=='Y'){\n  Wb.toast('{#save_can_submit#}');\n  return;\n}\n// TODO: 取得流程编码、电脑端审批表单和移动端审批表单\nWb.request({\n  url:'{#contextPath#}'+'/apPayReqCommonAction.do?method=getProcAndFormsByCat',\n  params:{'LEDGER_ID':app.ORG_NAME.LEDGER_ID.getValue(),'AP_DOC_CAT_CODE':'CGHT'},\n  success:function(resp){\n    var rec = Wb.decode(resp.responseText);\n    if(rec.flag=='0'){\n      var processCode = rec.PROCESS_CODE;\n      var pcApproveForm = rec.PC_A_FORM_URL;\n      var mApproveForm = rec.M_A_FORM_URL;\n      var bizId = '';\n      var catCode = '';\n      // 电脑端和移动端审批表单为变量需要设置为全路径\n      pcApproveForm = '{#appIP#}' +  '/'+pcApproveForm ;\n      mApproveForm = '{#appIP#}' +  '/'+mApproveForm ;\n      // TODO: 如果流程编码存在, 则提交流程审批处理\n      if(processCode !== \"\" && processCode !== null && processCode !== undefined){\n        // 如果项目未指定，则设置默认值为 \"-1\"\n        var prjId = app.PROJECT_ID.getValue();\n        if(prjId === null || prjId === \"\" || prjId === undefined){\n          prjId = \"-1\" ;\n        }\n        var orgId = app.ORG_ID.getValue();\n        if(orgId==''){\n          return;\n        }\n        if(change=='true'){\n          bizId = app.AP_CONTRACT_HIS_ID.getValue();\n          catCode = 'CGHTBG';\n        }else if(change=='false'){\n          bizId = app.AP_CONTRACT_ID.getValue();\n          catCode = 'CGHT';\n        }\n        var auditStatus = app.AUDIT_STATUS.getValue();\n        var _empId = '{#XIP.empId#}' ;\n        var json = {\n          'APP_IP':'{#appIP#}',\n          'loginName':'{#XIP.userName#}',\n          'AP_DOC_CAT_NAME':'{#cght#}',\n          'apCatCode':catCode,\n          'PC_A_FORM':pcApproveForm,\n          'M_A_FORM' :mApproveForm,\n          'DEPT_NAME':app.DEPT_NAME.DEPT_NAME.getValue(),\n          'AMT':app.INV_AMOUNT.getValue(),\n          'e_business_id':bizId,\n          'billType'\t : 'CGHT',\n          'PROJECT_ID'   : app.PROJECT_ID.getValue(),\n          'EMP_ID'       : _empId,\n          'ledgerId'     : app.LEDGER_ID.getValue(),\n          'DEPT_ID'      : app.DEPT_ID.getValue(),\n          'ORG_ID'\t\t: orgId\n        };\n        if(auditStatus === 'A'){//起草状态\n          XipWf.startAndSubmitByProcess(processCode,json,function(e){//提交流程\n            if(e.flag === 0){\n              app.queryBtn.fireEvent('click');\n              app.INS_CODE.setValue(e.instanceCode);\n              app.saveBtn.setDisabled(true);\n              app.submit1Btn.setDisabled(true);\n              app.revokeBtn1.setDisabled(false);\n              Wb.toast('{#submitMsg4#}');\n              if(catCode=='CGHTBG'){\n                Wb.request({\n                  url:'m?xwl=xc/ap/ct/data/getContractHisInfoByHisId',\n                  params:{'contractHisId':app.AP_CONTRACT_HIS_ID.getValue()},\n                  success:function(resp){\n                    var rec = Wb.decode(resp.responseText);\n                    app.AUDIT_STATUS.setValue(rec.rows[0].AUDIT_STATUS);\n                    app.AUDIT_STATUS_DESC.setValue(rec.rows[0].AUDIT_STATUS_DESC);\n                    app.SYS_AUDIT_STATUS.setValue(rec.rows[0].SYS_AUDIT_STATUS);\n                    app.SYS_AUDIT_STATUS_DESC.setValue(rec.rows[0].SYS_AUDIT_STATUS_DESC);\n                  }\n                });\n              }else if(catCode=='CGHT'){\n                Wb.request({\n                  url:'m?xwl=xc/ap/ct/data/getContractInfo',\n                  params:{'contractId':app.AP_CONTRACT_ID.getValue()},\n                  success:function(resp){\n                    var rec = Wb.decode(resp.responseText);\n                    app.AUDIT_STATUS.setValue(rec.rows[0].AUDIT_STATUS);\n                    app.AUDIT_STATUS_DESC.setValue(rec.rows[0].AUDIT_STATUS_DESC);\n                    app.SYS_AUDIT_STATUS.setValue(rec.rows[0].SYS_AUDIT_STATUS);\n                    app.SYS_AUDIT_STATUS_DESC.setValue(rec.rows[0].SYS_AUDIT_STATUS_DESC);\n                  }\n                });\n              }\n\n            }\n            else if(e.flag === 1){\n              Wb.toast(e.msg) ;\n            }else{}\n          });\n        }\n        else if(auditStatus === 'D'){//驳回状态\n          XipWf.submitInstance(app.INS_CODE.getValue(),json,function(e){//提交流程\n            if(e.flag === 0){\n              app.queryBtn.fireEvent('click');\n              Wb.toast('{#submitMsg4#}');\n              app.INS_CODE.setValue(e.instanceCode);\n              app.saveBtn.setDisabled(true);\n              app.submit1Btn.setDisabled(true);\n              app.revokeBtn1.setDisabled(false);\n              if(catCode=='CGHTBG'){\n                Wb.request({\n                  url:'m?xwl=xc/ap/ct/data/getContractHisInfoByHisId',\n                  params:{'contractHisId':app.AP_CONTRACT_HIS_ID.getValue()},\n                  success:function(resp){\n                    var rec = Wb.decode(resp.responseText);\n                    app.AUDIT_STATUS.setValue(rec.rows[0].AUDIT_STATUS);\n                    app.AUDIT_STATUS_DESC.setValue(rec.rows[0].AUDIT_STATUS_DESC);\n                    app.SYS_AUDIT_STATUS.setValue(rec.rows[0].SYS_AUDIT_STATUS);\n                    app.SYS_AUDIT_STATUS_DESC.setValue(rec.rows[0].SYS_AUDIT_STATUS_DESC);\n                  }\n                });\n              }else if(catCode=='CGHT'){\n                Wb.request({\n                  url:'m?xwl=xc/ap/ct/data/getContractInfo',\n                  params:{'contractId':app.AP_CONTRACT_ID.getValue()},\n                  success:function(resp){\n                    var rec = Wb.decode(resp.responseText);\n                    app.AUDIT_STATUS.setValue(rec.rows[0].AUDIT_STATUS);\n                    app.AUDIT_STATUS_DESC.setValue(rec.rows[0].AUDIT_STATUS_DESC);\n                    app.SYS_AUDIT_STATUS.setValue(rec.rows[0].SYS_AUDIT_STATUS);\n                    app.SYS_AUDIT_STATUS_DESC.setValue(rec.rows[0].SYS_AUDIT_STATUS_DESC);\n                  }\n                });\n              }\n            }\n            else if(e.flag === 1){\n              Wb.toast(e.msg) ;\n            }else{}\n          });\n        }else if(auditStatus === 'R'){//撤回状态\n          // 撤回 -> 按流程实例提交流程\n          XipWf.restartAndSubmitByProcess(app.INS_CODE.getValue(),processCode,json,function(e){\n            if(e.flag === 0){\n              Wb.toast('{#submitMsg4#}');\n              app.INS_CODE.setValue(e.instanceCode);\n              app.saveBtn.setDisabled(true);\n              app.submit1Btn.setDisabled(true);\n              app.revokeBtn1.setDisabled(false);\n              if(catCode=='CGHTBG'){\n                Wb.request({\n                  url:'m?xwl=xc/ap/ct/data/getContractHisInfoByHisId',\n                  params:{'contractHisId':app.AP_CONTRACT_HIS_ID.getValue()},\n                  success:function(resp){\n                    var rec = Wb.decode(resp.responseText);\n                    app.AUDIT_STATUS.setValue(rec.rows[0].AUDIT_STATUS);\n                    app.AUDIT_STATUS_DESC.setValue(rec.rows[0].AUDIT_STATUS_DESC);\n                    app.SYS_AUDIT_STATUS.setValue(rec.rows[0].SYS_AUDIT_STATUS);\n                    app.SYS_AUDIT_STATUS_DESC.setValue(rec.rows[0].SYS_AUDIT_STATUS_DESC);\n                  }\n                });\n              }else if(catCode=='CGHT'){\n                Wb.request({\n                  url:'m?xwl=xc/ap/ct/data/getContractInfo',\n                  params:{'contractId':app.AP_CONTRACT_ID.getValue()},\n                  success:function(resp){\n                    var rec = Wb.decode(resp.responseText);\n                    app.AUDIT_STATUS.setValue(rec.rows[0].AUDIT_STATUS);\n                    app.AUDIT_STATUS_DESC.setValue(rec.rows[0].AUDIT_STATUS_DESC);\n                    app.SYS_AUDIT_STATUS.setValue(rec.rows[0].SYS_AUDIT_STATUS);\n                    app.SYS_AUDIT_STATUS_DESC.setValue(rec.rows[0].SYS_AUDIT_STATUS_DESC);\n                  }\n                });\n              }\n            }\n            else if(e.flag === 1){\n              Wb.toast(e.msg) ;\n            }else{}\n          },null);\n        }\n        else if(auditStatus === 'E' || auditStatus === 'C'){//运行中、结束状态\n          Wb.toast('{#submitMsg4#}');\n          return false;\n        }\n        else{\n          Wb.toast('{#submitMsg5#}');\n          return false;\n        }\n      }\n    }else{\n      Wb.toast('{#xc_ap_ct_doc_cat#}'+'CGHT'+'{#xc_ap_ct_process_no_set#}');\n    }\n  }\n});\n"},"children":[],"expanded":true,"type":"button"},{"configs":{"text":"{#revoke#}","itemId":"revokeBtn1","disabled":"true","iconCls":"cancel_icon"},"events":{"click":"if(app.INS_CODE.getValue() === null || app.INS_CODE.getValue() === '') {\n  Wb.toast('{#monitorMsg2#}');\n  return;\n}\nelse if(app.AUDIT_STATUS.getValue() === 'E') {\n  Wb.toast('{#withdrawMsg3#}');\n  return;\n}\nelse if(app.AUDIT_STATUS.getValue() === 'R'){\n  Wb.toast('{#withdrawMsg4#}');\n  return false;\n}else if(app.AUDIT_STATUS.getValue() === 'A'){\n  Wb.toast('{#withdrawMsg5#}');\n  return false;\n}else if(app.AUDIT_STATUS.getValue() === 'D'){\n  Wb.toast('{#withdrawMsg5#}');\n  return false;\n}\nelse {\n  //撤回流程\n  XipWf.revokeByInstance(app.INS_CODE.getValue(),function(e){\n    app.queryBtn.fireEvent('click');\n    app.saveBtn.setDisabled(false);\n    app.submit1Btn.setDisabled(false);\n    app.revokeBtn1.setDisabled(true);\n    Wb.toast('{#xc_ap_ct_revoke_success#}');\n    if(change=='true'){\n      Wb.request({\n        url:'m?xwl=xc/ap/ct/data/getContractHisInfoByHisId',\n        params:{'contractHisId':app.AP_CONTRACT_HIS_ID.getValue()},\n        success:function(resp){\n          var rec = Wb.decode(resp.responseText);\n          app.AUDIT_STATUS.setValue(rec.rows[0].AUDIT_STATUS);\n          app.AUDIT_STATUS_DESC.setValue(rec.rows[0].AUDIT_STATUS_DESC);\n          app.SYS_AUDIT_STATUS.setValue(rec.rows[0].SYS_AUDIT_STATUS);\n          app.SYS_AUDIT_STATUS_DESC.setValue(rec.rows[0].SYS_AUDIT_STATUS_DESC);\n          Wb.request({\n            url:'m?xwl=xc/ap/ct/data/updateSysAuditStaus',\n            params:{'SYS_AUDIT_STATUS':'E','SYS_AUDIT_STATUS_DESC':'{#audited#}','AP_CONTRACT_ID':app.AP_CONTRACT_ID.getValue()},\n            success:function(resp){\n\n            }\n          });\n        }\n      });\n    }else if(change=='false'){\n      Wb.request({\n        url:'m?xwl=xc/ap/ct/data/getContractInfo',\n        params:{'contractId':app.AP_CONTRACT_ID.getValue()},\n        success:function(resp){\n          var rec = Wb.decode(resp.responseText);\n          app.AUDIT_STATUS.setValue(rec.rows[0].AUDIT_STATUS);\n          app.AUDIT_STATUS_DESC.setValue(rec.rows[0].AUDIT_STATUS_DESC);\n          app.SYS_AUDIT_STATUS.setValue(rec.rows[0].SYS_AUDIT_STATUS);\n          app.SYS_AUDIT_STATUS_DESC.setValue(rec.rows[0].SYS_AUDIT_STATUS_DESC);\n        }\n      });\n    }\n  });\n\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#monitor#}","itemId":"monitorBtn1","iconCls":"viewport_icon"},"events":{"click":"if(app.INS_CODE.getValue() === null || app.INS_CODE.getValue() === ''){\n  Wb.toast('{#monitorMsg2#}');\n}\nelse{\n  XipWf.showMonitorPage(app.INS_CODE.getValue());\n}   \n"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"frame":"false","style":"border-width:0px;padding-top:10px","layout":"column","border":"false","itemId":"tr_1"},"children":[{"configs":{"style":"border-width:0px","layout":"form","columnWidth":".3","border":"false","itemId":"td1_1"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/ORG_PICK/ORG_ALL_PICK","itemId":"ORG_NAME"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"frame":"false","style":"border-width:0px","layout":"form","columnWidth":".3","border":"false","itemId":"td_111"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/DEPT_ID_PICK/DEPT_ID_LD","itemId":"DEPT_NAME"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"frame":"false","style":"border-width:0px","layout":"form","columnWidth":".3","border":"false","itemId":"td_22"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/PROJECT_ID_PICK/PROJECT_ID_LD","itemId":"PROJECT_NAME"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"frame":"false","style":"border-width:0px;padding-top:10px","layout":"column","border":"false","itemId":"tr_2"},"children":[{"configs":{"frame":"false","style":"border-width:0px","layout":"form","columnWidth":".3","border":"false","itemId":"td_11"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/VENDOR_ID_PICK/VENDOR_ID_LD","itemId":"VENDOR_NAME"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"frame":"false","style":"border-width:0px","layout":"form","columnWidth":".3","border":"false","itemId":"td_1"},"children":[{"configs":{"labelWidth":"80","allowBlank":"false","width":"280","labelAlign":"right","itemId":"AP_CONTRACT_CODE","fieldLabel":"<font color='red'>*<\/font>{#code#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"frame":"false","style":"border-width:0px","layout":"form","columnWidth":".3","border":"false","itemId":"td_2"},"children":[{"configs":{"labelWidth":"80","allowBlank":"false","width":"280","labelAlign":"right","itemId":"AP_CONTRACT_NAME","fieldLabel":"<font color='red'>*<\/font>{#c_name#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"frame":"false","style":"border-width:0px;padding-top:10px","layout":"column","border":"false","itemId":"tr_3"},"children":[{"configs":{"frame":"false","style":"border-width:0px","layout":"form","columnWidth":".3","border":"false","itemId":"td_2"},"children":[{"configs":{"labelWidth":"80","decimalPrecision":"2","allowBlank":"false","minValue":"0","labelAlign":"right","allowDecimals":"true","itemId":"AMOUNT","fieldLabel":"{#contractAmt#}"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"panel"},{"configs":{"frame":"false","style":"border-width:0px","layout":"form","columnWidth":".3","border":"false","itemId":"td_21"},"children":[{"configs":{"labelWidth":"80","decimalPrecision":"2","allowBlank":"false","minValue":"0","labelAlign":"right","allowDecimals":"true","itemId":"TAX_AMT","fieldLabel":"{#taxAmt#}"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"panel"},{"configs":{"frame":"false","style":"border-width:0px","layout":"form","columnWidth":".3","border":"false","itemId":"td_22"},"children":[{"configs":{"labelWidth":"80","decimalPrecision":"2","readOnly":"true","allowBlank":"false","minValue":"0","labelAlign":"right","allowDecimals":"true","itemId":"INV_AMOUNT","fieldLabel":"{#invAmount#}"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"frame":"false","style":"border-width:0px;padding-top:10px","layout":"column","border":"false","itemId":"tr_4"},"children":[{"configs":{"frame":"false","style":"border-width:0px","layout":"form","columnWidth":".3","border":"false","itemId":"td_1"},"children":[{"configs":{"labelWidth":"80","allowBlank":"false","format":"Y-m-d","labelAlign":"right","itemId":"START_DATE","fieldLabel":"<font color='red'>*<\/font>{#startDate#}"},"children":[],"expanded":true,"type":"date"}],"expanded":true,"type":"panel"},{"configs":{"frame":"false","style":"border-width:0px","layout":"form","columnWidth":".3","border":"false","itemId":"td_2"},"children":[{"configs":{"labelWidth":"80","allowBlank":"false","format":"Y-m-d","labelAlign":"right","itemId":"END_DATE","fieldLabel":"<font color='red'>*<\/font>{#endDate#}"},"children":[],"expanded":false,"type":"date"}],"expanded":true,"type":"panel"},{"configs":{"frame":"false","style":"border-width:0px","layout":"form","columnWidth":".3","border":"false","itemId":"td_21"},"children":[{"configs":{"labelWidth":"80","allowBlank":"false","width":"280","pickList":"[['BKHT','{#bkht#}'],['KKHT','{#kkht#}']]","labelAlign":"right","itemId":"AP_CONTRACT_TYPE","fieldLabel":"{#contractType#}","editable":"false"},"children":[],"expanded":true,"type":"combo"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"frame":"false","style":"border-width:0px;padding-top:10px","layout":"column","border":"false","itemId":"tr_5"},"children":[{"configs":{"frame":"false","style":"border-width:0px","layout":"form","columnWidth":".3","border":"false","itemId":"td_212"},"children":[{"configs":{"labelWidth":"80","allowBlank":"false","displayField":"VAL_NAME","width":"280","valueField":"VAL_CODE","labelAlign":"right","itemId":"CONTRACT_CLASSIFY","fieldLabel":"{#contractClassify#}","editable":"false"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/ap/ct/data/selectContractType"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"frame":"false","style":"border-width:0px","layout":"form","columnWidth":".3","border":"false","itemId":"td_21"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","allowBlank":"false","width":"280","labelAlign":"right","itemId":"VERSION","fieldLabel":"<font color='red'>*<\/font>{#version#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"frame":"false","style":"border-width:0px","layout":"form","columnWidth":".3","border":"false","itemId":"td_211"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","allowBlank":"false","width":"280","labelAlign":"right","itemId":"SYS_AUDIT_STATUS_DESC","fieldLabel":"{#auditStatus#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"frame":"false","style":"border-width:0px;padding-top:10px","layout":"column","border":"false","itemId":"tr_6"},"children":[{"configs":{"frame":"false","style":"border-width:0px","layout":"form","columnWidth":".45","border":"false","itemId":"td_1"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/EMP_ID_PICK/EMP_ID_LD","itemId":"CONTRACT_USER"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"frame":"false","style":"border-width:0px","layout":"form","columnWidth":".45","border":"false","itemId":"td_11"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"DESCRIPTION","fieldLabel":"{#description#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"frame":"false","style":"border-width:0px;padding-top:10px","hidden":"true","layout":"column","border":"false","itemId":"hidden"},"children":[{"configs":{"hidden":"true","itemId":"AP_CONTRACT_ID","fieldLabel":"AP_CONTRACT_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"IS_CLOSE"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"LEDGER_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"allowBlank":"false","itemId":"ORG_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"80","readOnly":"true","width":"280","labelAlign":"right","itemId":"AUDIT_STATUS","fieldLabel":"{#auditStatus#}"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"80","readOnly":"true","allowBlank":"false","width":"280","labelAlign":"right","itemId":"AUDIT_STATUS_DESC","fieldLabel":"{#auditStatus#}"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"80","readOnly":"true","width":"280","labelAlign":"right","itemId":"SYS_AUDIT_STATUS","fieldLabel":"{#auditStatus#}"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"80","width":"280","labelAlign":"right","itemId":"EMP_ID","fieldLabel":"{#principal#}"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"80","width":"280","labelAlign":"right","itemId":"PROJECT_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"80","width":"280","labelAlign":"right","itemId":"INS_CODE"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"80","width":"280","labelAlign":"right","itemId":"DEPT_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"80","width":"280","labelAlign":"right","itemId":"AP_CONTRACT_HIS_ID"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"form"},{"configs":{"region":"center","itemId":"tab1"},"children":[{"configs":{"title":"{#enclosure#}","html":"<iframe width=\"100%\" height=\"100%\" id= 'enclosurePanel' src=\"\" frameborder=0><\/iframe>\n","itemId":"enclosurePanel"},"children":[],"expanded":true,"type":"panel"},{"configs":{"title":"{#cgdd#}","border":"false","itemId":"cgddPanel"},"children":[],"expanded":false,"type":"panel"},{"configs":{"title":"{#dhd#}","border":"false","itemId":"dhdPanel"},"children":[],"expanded":false,"type":"panel"},{"configs":{"title":"{#rkd#}","border":"false","itemId":"rkdPanel"},"children":[],"expanded":false,"type":"panel"}],"expanded":false,"type":"tab"}],"expanded":true,"type":"window"},{"configs":{"layout":"border","itemId":"viewport1"},"children":[{"configs":{"region":"north","frame":"true","height":"130","style":"border-width:0px","layout":"form","buttonAlign":"center","itemId":"queryForm"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"column","border":"false","itemId":"tr1"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".25","border":"false","itemId":"td_1_1"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/ORG_PICK/ORG_ALL_PICK","itemId":"QUERY_ORG_NAME"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".25","border":"false","itemId":"td_1_3"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"NAME","fieldLabel":"{#codeName#}"},"events":{"specialkey":"if(e.getKey()===13){app.queryBtn.fireEvent('click');}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".25","border":"false","itemId":"td2_1"},"children":[{"configs":{"labelWidth":"80","displayField":"VAL_NAME","width":"280","valueField":"VAL_CODE","labelAlign":"right","itemId":"QUERY_CONTRACT_TYPE","fieldLabel":"{#contractType#}","editable":"false"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n  app.queryBtn.fireEvent('click');\n}"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/ap/ct/data/selectValueset"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".25","border":"false","itemId":"td2_2"},"children":[{"configs":{"labelWidth":"80","displayField":"VAL_NAME","width":"280","valueField":"VAL_CODE","labelAlign":"right","itemId":"QUERY_CONTRACT_CLASSIFY","fieldLabel":"{#contractClassify#}","editable":"false"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n  app.queryBtn.fireEvent('click');\n}"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/ap/ct/data/selectContractType"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"column","border":"false","itemId":"tr2"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".25","border":"false","itemId":"td_1_4"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","pickList":"[['A','{#writeOut#}'],['C','{#operating#}'],['E','{#audited#}'],['D','{#reject#}'],['R','{#revoke#}'],['','{#all#}']]","itemId":"QUERY_AUDIT_STATUS","fieldLabel":"{#workflowStatus#}"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n  app.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"combo"}],"expanded":false,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".25","border":"false","itemId":"td_1_41"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","pickList":"[['A','{#draft#}'],['C','{#auditing#}'],['E','{#audited#}'],['B','{#xc_ap_changing#}'],['','{#all#}']]","itemId":"QUERY_SYS_AUDIT_STATUS","fieldLabel":"{#auditStatus#}"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n  app.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".25","border":"false","itemId":"td2_3"},"children":[{"configs":{"labelWidth":"80","format":"Y-m-d","labelAlign":"right","itemId":"startDate","fieldLabel":"{#signDate#}"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n  app.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"date"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".25","border":"false","itemId":"td2_4"},"children":[{"configs":{"labelWidth":"80","format":"Y-m-d","labelAlign":"right","itemId":"endDate","fieldLabel":"{#to#}"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n  app.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"date"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"column","border":"false","itemId":"tr3"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".25","border":"false","itemId":"td3_1"},"children":[{"configs":{"labelWidth":"80","value":"N","pickList":"[['Y','{#Y#}'],['N','{#N#}']]","labelAlign":"right","itemId":"QUERY_IS_CLOSE","fieldLabel":"{#isClose#}"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n  app.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","style":"padding-left:50px","layout":"column","columnWidth":".05","border":"false","itemId":"td_1_41"},"children":[{"configs":{"text":"{#query#}","itemId":"queryBtn","iconCls":"seek_icon"},"events":{"click":"if(!Wb.isEmpty(app.endDate.getValue())){\n  if(app.startDate.getValue()>app.endDate.getValue()){\n  Wb.toast('{#saveMsg4#}');\n    return;\n}\n}\napp.Grid.getStore().load({\n\tparams:{'orgId':app.QUERY_ORG_NAME.ORG_ID.getValue(),'contractName':app.NAME.getValue(),\n           'auditStatus':app.QUERY_AUDIT_STATUS.getValue(),'contractType':app.QUERY_CONTRACT_TYPE.getValue(),\n           'contractClassify':app.QUERY_CONTRACT_CLASSIFY.getValue(),'startDate':app.startDate.getValue(),'endDate':app.endDate.getValue(),\n           'isClose':app.QUERY_IS_CLOSE.getValue(),'sysAuditStatus':app.QUERY_SYS_AUDIT_STATUS.getValue()}\n});"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","style":"padding-left:80px","layout":"column","columnWidth":".1","border":"false","itemId":"td_1_411"},"children":[{"configs":{"text":"{#clear#}","itemId":"clearBtn","iconCls":"refresh_icon"},"events":{"click":"app.queryForm.getForm().reset();\napp.Grid.store.removeAll();\n"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":false,"type":"form"},{"configs":{"region":"center","selType":"checkboxmodel","border":"true","itemId":"Grid"},"events":{"itemdblclick":"var rows = app.Grid.getSelection();\nif (rows.length != 1) {\n\n  Wb.toast('{#editMsg1#}');\n\n  return;\n} else {\n\n  // var edtiewin = new Ext.window.Window(app.addEditewin);\n  var vid = rows[0].data.AP_CONTRACT_ID; \n\n\n\n\n\n  app.addEditewin.setTitle('{#edit#}');\n  app.AP_CONTRACT_ID.setValue(vid); //设置ID\n  app.optype.setValue(\"edit\"); //\n  app.isWin.setValue(\"Y\"); //\n\n\n\n\n  //app.LEDGER_ID.setValue(rows[0].data.LEDGER_ID); \n  app.LEDGER_NAME.LEDGER_ID.setValue(rows[0].data.LEDGER_ID); \n\n  app.LEDGER_NAME.LEDGER_NAME.setValue(rows[0].data.LEDGER_NAME); \n  app.AP_CONTRACT_TYPE.setValue(rows[0].data.AP_CONTRACT_TYPE); \n  app.AP_CONTRACT_CODE.setValue(rows[0].data.AP_CONTRACT_CODE); \n  app.AP_CONTRACT_NAME.setValue(rows[0].data.AP_CONTRACT_NAME); \n  // app.VENDOR_ID.setValue(rows[0].data.VENDOR_ID); \n  app.VENDOR_NAME.VENDOR_ID.setValue(rows[0].data.VENDOR_ID); \n  app.VENDOR_NAME.VENDOR_NAME.setValue(rows[0].data.VENDOR_NAME); \n  app.VENDOR_NAME.QUERY_LEDGER_ID.setValue(rows[0].data.LEDGER_ID); \n\n  app.AMOUNT.setValue(rows[0].data.AMOUNT); \n  app.START_DATE.setValue(rows[0].data.START_DATE);   \n\n  app.END_DATE.setValue(rows[0].data.END_DATE); \n  app.DEPT_NAME.DEPT_ID.setValue(rows[0].data.DEPT_ID); \n  app.DEPT_NAME.DEPT_NAME.setValue(rows[0].data.DEPT_NAME); \n  app.DEPT_NAME.QUERY_LEDGER_ID.setValue(rows[0].data.LEDGER_ID); \n\n  app.PROJECT_NAME.PROJECT_ID.setValue(rows[0].data.PROJECT_ID); \n  app.PROJECT_NAME.PROJECT_NAME.setValue(rows[0].data.PROJECT_NAME); \n  app.PROJECT_NAME.QUERY_LEDGER_ID.setValue(rows[0].data.LEDGER_ID); \n\n\n  app.CONTRACT_USER.EMP_ID.setValue(rows[0].data.CONTRACT_USER); \n\n  app.CONTRACT_USER.EMP_NAME.setValue(rows[0].data.EMP_NAME); \n  app.CONTRACT_USER.QUERY_LEDGER_ID.setValue(rows[0].data.LEDGER_ID); \n  // app.CONTRACT_USER.setValue(rows[0].data.CONTRACT_USER); \n  app.DESCRIPTION.setValue(rows[0].data.DESCRIPTION); \n\n  app.addEditewin.show();\n  Wb.request({\n    url: 'm?xwl=xc/ap/ct/data/mxExist',\n    params:{AP_CONTRACT_ID:vid},\n    async:false,\n    method: 'POST',\n    success:function(response){\n      var rep = Ext.JSON.decode(response.responseText);\n      var num = rep.NUM;\n\n      if( num>0){\n        app.AP_CONTRACT_CODE.setReadOnly(true);\n\t\tapp.VENDOR_NAME.VENDOR_NAME.setReadOnly(true);\n        app.LEDGER_NAME.LEDGER_NAME.setReadOnly(true);\n        app.AP_CONTRACT_NAME.setReadOnly(true);\n        app.AMOUNT.setReadOnly(true);\n        app.START_DATE.setReadOnly(true);\n        app.END_DATE.setReadOnly(true);\n        app.DEPT_NAME.DEPT_NAME.setReadOnly(true);\n\t\tapp.PROJECT_NAME.PROJECT_NAME.setReadOnly(true);\n        app.AP_CONTRACT_TYPE.setReadOnly(true);\n      }else{\n        app.AP_CONTRACT_CODE.setReadOnly(true);\n        app.VENDOR_NAME.VENDOR_NAME.setReadOnly(true);\n        app.LEDGER_NAME.LEDGER_NAME.setReadOnly(true);\n        app.AP_CONTRACT_NAME.setReadOnly(false);\n        app.AMOUNT.setReadOnly(false);\n        app.START_DATE.setReadOnly(false);\n        app.END_DATE.setReadOnly(false);\n        app.DEPT_NAME.DEPT_NAME.setReadOnly(false);\n\t\tapp.PROJECT_NAME.PROJECT_NAME.setReadOnly(false);\n        app.AP_CONTRACT_TYPE.setReadOnly(false);\n      }\n    }\n  });\n\n\n}"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/ap/ct/data/select"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"-","itemId":"item1"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#add#}","itemId":"addBtn","iconCls":"file_add_icon"},"events":{"click":"//var win = new Ext.window.Window(app.addEditewin);\n\napp.form1.getForm().reset();\nvar uid = Xip.getId();\napp.AP_CONTRACT_ID.setValue(uid); //设置ID\n\napp.AP_CONTRACT_CODE.setReadOnly(false);\n\napp.AP_CONTRACT_CODE.setReadOnly(false);\napp.VENDOR_NAME.VENDOR_NAME.setReadOnly(false);\napp.AP_CONTRACT_NAME.setReadOnly(false);\napp.AMOUNT.setReadOnly(false);\napp.START_DATE.setReadOnly(false);\napp.END_DATE.setReadOnly(false);\napp.DEPT_NAME.DEPT_NAME.setReadOnly(false);\napp.PROJECT_NAME.PROJECT_NAME.setReadOnly(false);\napp.AP_CONTRACT_TYPE.setReadOnly(false);\napp.AP_CONTRACT_TYPE.store.load();\n\napp.addEditewin.setTitle('{#add#}');\n\nvar   r =  app.AP_CONTRACT_TYPE.store.getAt(0);\napp.ORG_NAME.ORG_NAME.setReadOnly(false);\napp.AP_CONTRACT_TYPE.setValue(r.get('VAL_CODE'));     //隐藏的值  \napp.AP_CONTRACT_TYPE.setRawValue(r.get('VAL_NAME')); \nvar orgStore = app.ORG_NAME.ORG_NAME.getPicker().getStore();\napp.ORG_NAME.ORG_NAME.setValue(orgStore.getAt(0).get('ORG_NAME'));\napp.ORG_NAME.ORG_ID.setValue(orgStore.getAt(0).get('ORG_ID'));\napp.ORG_NAME.LEDGER_ID.setValue(orgStore.getAt(0).get('LEDGER_ID'));\napp.LEDGER_ID.setValue(orgStore.getAt(0).get('LEDGER_ID'));\napp.ORG_ID.setValue(orgStore.getAt(0).get('ORG_ID'));\nvar ledgerId = app.LEDGER_ID.getValue();\napp.VENDOR_NAME.QUERY_LEDGER_ID.setValue(ledgerId); \napp.DEPT_NAME.QUERY_LEDGER_ID.setValue(ledgerId); \napp.PROJECT_NAME.QUERY_LEDGER_ID.setValue(ledgerId);\napp.CONTRACT_USER.QUERY_LEDGER_ID.setValue(ledgerId);\napp.IS_CLOSE.setValue('N');\napp.VERSION.setValue(0);\napp.AUDIT_STATUS.setValue('A');\napp.AUDIT_STATUS_DESC.setValue('{#writeOut#}');\napp.SYS_AUDIT_STATUS.setValue('A');\napp.SYS_AUDIT_STATUS_DESC.setValue('{#draft#}');\napp.tab1.setActiveTab(app.enclosurePanel);\napp.addEditewin.show();\nchange = 'false';\napp.saveBtn.setDisabled(false);\n\n\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item11"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#edit#}","itemId":"editBtn","iconCls":"file_edit_icon"},"events":{"click":"var rows = app.Grid.getSelection();\nif (rows.length < 1) {\n  Wb.toast('{#editMsg1#}');\n  return;\n} \nif(rows[0].data.AUDIT_STATUS=='C'||rows[0].data.AUDIT_STATUS=='E'||rows[0].data.AUDIT_STATUS=='B'){\n \tWb.toast('{#edit_msg2#}');\n  \treturn;\n}\napp.submit1Btn.setDisabled(false);\nvar vid = rows[0].data.AP_CONTRACT_ID; \napp.addEditewin.setTitle('{#edit#}');\napp.AP_CONTRACT_ID.setValue(vid); //设置ID\n\napp.AP_CONTRACT_TYPE.setValue(rows[0].data.AP_CONTRACT_TYPE); \napp.AP_CONTRACT_CODE.setValue(rows[0].data.AP_CONTRACT_CODE); \napp.AP_CONTRACT_NAME.setValue(rows[0].data.AP_CONTRACT_NAME); \napp.VENDOR_NAME.VENDOR_ID.setValue(rows[0].data.VENDOR_ID); \napp.VENDOR_NAME.VENDOR_NAME.setValue(rows[0].data.VENDOR_NAME); \napp.VENDOR_NAME.QUERY_LEDGER_ID.setValue(rows[0].data.LEDGER_ID); \n\napp.ORG_ID.setValue(rows[0].data.ORG_ID);\n\napp.AMOUNT.setValue(rows[0].data.AMOUNT); \napp.START_DATE.setValue(rows[0].data.START_DATE);   \n\napp.END_DATE.setValue(rows[0].data.END_DATE); \napp.DEPT_NAME.DEPT_ID.setValue(rows[0].data.DEPT_ID); \napp.DEPT_NAME.DEPT_NAME.setValue(rows[0].data.DEPT_NAME); \napp.DEPT_NAME.QUERY_LEDGER_ID.setValue(rows[0].data.LEDGER_ID); \n\napp.PROJECT_NAME.PROJECT_ID.setValue(rows[0].data.PROJECT_ID); \napp.PROJECT_NAME.PROJECT_NAME.setValue(rows[0].data.PROJECT_NAME); \napp.PROJECT_NAME.QUERY_LEDGER_ID.setValue(rows[0].data.LEDGER_ID); \n\n\napp.CONTRACT_USER.EMP_ID.setValue(rows[0].data.CONTRACT_USER); \n\napp.CONTRACT_USER.EMP_NAME.setValue(rows[0].data.EMP_NAME); \napp.CONTRACT_USER.QUERY_LEDGER_ID.setValue(rows[0].data.LEDGER_ID); \n// app.CONTRACT_USER.setValue(rows[0].data.CONTRACT_USER); \napp.DESCRIPTION.setValue(rows[0].data.DESCRIPTION); \napp.IS_CLOSE.setValue(rows[0].data.IS_CLOSE);\nWb.setValue(app.form1,rows[0].data);\naddWinValue = Wb.encode(Wb.getValue(app.form1));\nisEdit = 'Y';\napp.ORG_NAME.ORG_NAME.setReadOnly(true);\napp.VENDOR_NAME.VENDOR_NAME.setReadOnly(true);\napp.AP_CONTRACT_CODE.setReadOnly(true);\napp.addEditewin.show();\nWb.request({\n  url: 'm?xwl=xc/ap/ct/data/mxExist',\n  params:{AP_CONTRACT_ID:vid},\n  async:false,\n  method: 'POST',\n  success:function(response){\n    var rep = Ext.JSON.decode(response.responseText);\n    var num = rep.NUM;\n\n    if( num>0){\n      app.AP_CONTRACT_CODE.setReadOnly(true);\n      app.VENDOR_NAME.VENDOR_NAME.setReadOnly(true);\n      app.ORG_NAME.ORG_NAME.setReadOnly(true);\n      app.AP_CONTRACT_NAME.setReadOnly(true);\n      app.AMOUNT.setReadOnly(true);\n      app.START_DATE.setReadOnly(true);\n      app.END_DATE.setReadOnly(true);\n      app.DEPT_NAME.DEPT_NAME.setReadOnly(true);\n      app.PROJECT_NAME.PROJECT_NAME.setReadOnly(true);\n      app.AP_CONTRACT_TYPE.setReadOnly(true);\n    }else{\n      app.AP_CONTRACT_CODE.setReadOnly(true);\n      app.VENDOR_NAME.VENDOR_NAME.setReadOnly(true);\n      app.ORG_NAME.ORG_NAME.setReadOnly(true);\n      app.AP_CONTRACT_NAME.setReadOnly(false);\n      app.AMOUNT.setReadOnly(false);\n      app.START_DATE.setReadOnly(false);\n      app.END_DATE.setReadOnly(false);\n      app.DEPT_NAME.DEPT_NAME.setReadOnly(false);\n      app.PROJECT_NAME.PROJECT_NAME.setReadOnly(false);\n      app.AP_CONTRACT_TYPE.setReadOnly(false);\n    }\n  }\n});\nchange = 'false';\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item12"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#delete#}","itemId":"delBtn","iconCls":"file_delete_icon"},"events":{"click":"var rows=app.Grid.getSelectionModel().getSelection();\nif(rows.length===0){\n   Wb.toast('{#deleteMsg1#}');\n  return;\n}\nelse{\n   Ext.Msg.confirm('{#prompt#}','{#deleteMsg2#}',function(a){\n      if(a=='yes'){\n      var ids = [] ;\n      Ext.each(rows,function(r){\n        var id = {'id':r.data.AP_CONTRACT_ID};\n        ids.push(id);\n      });\n        Wb.request({\n         url : '{#contextPath#}'+'/apContractAction.do?method=delContractInfo',\n         params : {'idArray':ids},\n         success :function(response){\n           var rec = Wb.decode(response.responseText);\n           if(rec.flag=='0'){\n              Wb.toast('{#deleteMsg3#}');\n           \t  Wb.remove(app.Grid,rows);\n           }else if(rec.flag=='1'){\n              Wb.toast(rec.msg);\n           }\n         }\n      });\n     \n    }else{\n      return false ;\n    }\n   });\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item12111"},"children":[],"expanded":true,"type":"item"},{"configs":{"text":"{#seek#}","itemId":"seekBtn","iconCls":"seek_icon"},"events":{"click":"var rows = app.Grid.getSelection();\nif(rows.length==0){\n  Wb.toast('{#monitorMsg1#}');\n  return;\n}\nWb.run({\n\turl:'m?xwl=xc/ap/ct/XC_AP_CONTRACT_VIEW',\n  \tsuccess:function(app){\n      app.initWin({\n      \t'contractId':rows[0].data.AP_CONTRACT_ID,\n        'flag':'current'\n      });\n    }\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item121111"},"children":[],"expanded":true,"type":"item"},{"configs":{"text":"{#change#}","itemId":"changeBtn"},"events":{"click":"var rows = app.Grid.getSelection();\nif (rows.length < 1) {\n  Wb.toast('{#editMsg1#}');\n  return;\n} \nif(rows[0].data.AUDIT_STATUS!='E'&&rows[0].data.AUDIT_STATUS!='B'){//合同没有审批通过\n  Wb.toast('{#changeMsg1#}');\n  return;\n}\nif(rows[0].data.IS_CLOSE=='Y'){\n   Wb.toast('{#xc_ap_ct_close_not_change#}');\n  return;\n}\nisEdit = 'Y';\napp.ORG_NAME.ORG_NAME.setReadOnly(true);\napp.VENDOR_NAME.VENDOR_NAME.setReadOnly(true);\napp.AP_CONTRACT_CODE.setReadOnly(true);\nWb.request({\n  url:'m?xwl=xc/ap/ct/data/ifExistDraft',\n  params:{'AP_CONTRACT_ID':rows[0].data.AP_CONTRACT_ID},\n  success:function(resp){\n    var rec = Wb.decode(resp.responseText);\n    if(rec.total>0){//存在未审核通过的变更\n      var vid = rows[0].data.AP_CONTRACT_ID; \n      app.addEditewin.setTitle('{#change#}');\n      app.AP_CONTRACT_ID.setValue(vid); //设置ID\n\n      app.AP_CONTRACT_TYPE.setValue(rec.rows[0].AP_CONTRACT_TYPE); \n      app.AP_CONTRACT_CODE.setValue(rec.rows[0].AP_CONTRACT_CODE); \n      app.AP_CONTRACT_NAME.setValue(rec.rows[0].AP_CONTRACT_NAME); \n      app.VENDOR_NAME.VENDOR_ID.setValue(rec.rows[0].VENDOR_ID); \n      app.VENDOR_NAME.VENDOR_NAME.setValue(rec.rows[0].VENDOR_NAME); \n      app.VENDOR_NAME.QUERY_LEDGER_ID.setValue(rec.rows[0].LEDGER_ID); \n\n      app.ORG_ID.setValue(rec.rows[0].ORG_ID);\n\n      app.AMOUNT.setValue(rec.rows[0].AMOUNT); \n      app.DEPT_NAME.DEPT_ID.setValue(rec.rows[0].DEPT_ID); \n      app.DEPT_NAME.DEPT_NAME.setValue(rec.rows[0].DEPT_NAME); \n      app.DEPT_NAME.QUERY_LEDGER_ID.setValue(rec.rows[0].LEDGER_ID); \n\n      app.PROJECT_NAME.PROJECT_ID.setValue(rec.rows[0].PROJECT_ID); \n      app.PROJECT_NAME.PROJECT_NAME.setValue(rec.rows[0].PROJECT_NAME); \n      app.PROJECT_NAME.QUERY_LEDGER_ID.setValue(rec.rows[0].LEDGER_ID); \n\n\n      app.CONTRACT_USER.EMP_ID.setValue(rec.rows[0].CONTRACT_USER); \n\n      app.CONTRACT_USER.EMP_NAME.setValue(rec.rows[0].EMP_NAME); \n      app.CONTRACT_USER.QUERY_LEDGER_ID.setValue(rec.rows[0].LEDGER_ID); \n      app.DESCRIPTION.setValue(rec.rows[0].DESCRIPTION); \n      app.IS_CLOSE.setValue(rec.rows[0].IS_CLOSE);\n      Wb.setValue(app.form1,rec.rows[0]);\n      app.START_DATE.setValue(rec.rows[0].start);\n      app.END_DATE.setValue(rec.rows[0].end); \n      if(rec.rows[0].AUDIT_STATUS=='C'){\n        app.saveBtn.setDisabled(true);\n      \tapp.submit1Btn.setDisabled(true);\n        app.revokeBtn1.setDisabled(false);\n      }else{\n      \tapp.saveBtn.setDisabled(false);\n      \tapp.submit1Btn.setDisabled(false);\n      }\n      \n      app.addEditewin.show();\n      change = 'true';\n    }else{//不存在未审核通过的变更\n      var contractHisId = Xip.getId();\n\t  app.AP_CONTRACT_HIS_ID.setValue(contractHisId);\n      var vid = rows[0].data.AP_CONTRACT_ID; \n      app.addEditewin.setTitle('{#change#}');\n      app.AP_CONTRACT_ID.setValue(vid); //设置ID\n\n      app.AP_CONTRACT_TYPE.setValue(rows[0].data.AP_CONTRACT_TYPE); \n      app.AP_CONTRACT_CODE.setValue(rows[0].data.AP_CONTRACT_CODE); \n      app.AP_CONTRACT_NAME.setValue(rows[0].data.AP_CONTRACT_NAME); \n      app.VENDOR_NAME.VENDOR_ID.setValue(rows[0].data.VENDOR_ID); \n      app.VENDOR_NAME.VENDOR_NAME.setValue(rows[0].data.VENDOR_NAME); \n      app.VENDOR_NAME.QUERY_LEDGER_ID.setValue(rows[0].data.LEDGER_ID); \n\n      app.ORG_ID.setValue(rows[0].data.ORG_ID);\n\n      app.AMOUNT.setValue(rows[0].data.AMOUNT); \n      app.START_DATE.setValue(rows[0].data.START_DATE);   \n\n      app.END_DATE.setValue(rows[0].data.END_DATE); \n      app.DEPT_NAME.DEPT_ID.setValue(rows[0].data.DEPT_ID); \n      app.DEPT_NAME.DEPT_NAME.setValue(rows[0].data.DEPT_NAME); \n      app.DEPT_NAME.QUERY_LEDGER_ID.setValue(rows[0].data.LEDGER_ID); \n\n      app.PROJECT_NAME.PROJECT_ID.setValue(rows[0].data.PROJECT_ID); \n      app.PROJECT_NAME.PROJECT_NAME.setValue(rows[0].data.PROJECT_NAME); \n      app.PROJECT_NAME.QUERY_LEDGER_ID.setValue(rows[0].data.LEDGER_ID); \n\n\n      app.CONTRACT_USER.EMP_ID.setValue(rows[0].data.CONTRACT_USER); \n\n      app.CONTRACT_USER.EMP_NAME.setValue(rows[0].data.EMP_NAME); \n      app.CONTRACT_USER.QUERY_LEDGER_ID.setValue(rows[0].data.LEDGER_ID); \n      app.DESCRIPTION.setValue(rows[0].data.DESCRIPTION); \n      app.IS_CLOSE.setValue(rows[0].data.IS_CLOSE);\n      Wb.setValue(app.form1,rows[0].data);\n      app.AUDIT_STATUS.setValue('A');\n      app.AUDIT_STATUS_DESC.setValue('{#writeOut#}');\n      app.SYS_AUDIT_STATUS.setValue('A');\n      app.SYS_AUDIT_STATUS_DESC.setValue('{#draft#}');\n      app.VERSION.setValue(parseInt(rows[0].data.VERSION)+1);\n      app.saveBtn.setDisabled(false);\n      app.submit1Btn.setDisabled(false);\n      app.addEditewin.show();\n      change = 'true';\n      app.INS_CODE.setValue('');\n    }\n  }\n});\n\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item3"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#historyVerison#}","itemId":"historyVersionBtn"},"events":{"click":"var rows = app.Grid.getSelection();\nif(rows.length==0){\n  Wb.toast('{#monitorMsg1#}');\n  return;\n}\nvar contractId = rows[0].data.AP_CONTRACT_ID;\napp.historyWin.show();\napp.historyGrid.store.load({\n  params:{'contractId':contractId}\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item4"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#submit#}","itemId":"submitBtn","iconCls":"up_icon"},"events":{"click":"var rows = app.Grid.getSelection();//获得选中数据\nif (!rows.length) {//选中的数据条数\n  Wb.toast('{#submitMsg1#}');\n  return;\n}else if(rows[0].data.AUDIT_STATUS=='C'||rows[0].data.AUDIT_STATUS=='E'){\n  Wb.toast('{#can_not_submit#}');\n  return;\n}\nelse {\n  // TODO: 取得流程编码、电脑端审批表单和移动端审批表单\n  Wb.request({\n    url:'{#contextPath#}'+'/apPayReqCommonAction.do?method=getProcAndFormsByCat',\n    params:{'LEDGER_ID':rows[0].data.LEDGER_ID,'AP_DOC_CAT_CODE':'CGHT'},\n    success:function(resp){\n      var rec = Wb.decode(resp.responseText);\n      if(rec.flag=='0'){\n        var processCode = rec.PROCESS_CODE;\n        var pcApproveForm = rec.PC_A_FORM_URL;\n        var mApproveForm = rec.M_A_FORM_URL;\n        // 电脑端和移动端审批表单为变量需要设置为全路径\n        pcApproveForm = '{#appIP#}' +  '/'+pcApproveForm ;\n        mApproveForm = '{#appIP#}' +  '/'+mApproveForm ;\n        // TODO: 如果流程编码存在, 则提交流程审批处理\n        if(processCode !== \"\" && processCode !== null && processCode !== undefined){\n          // 如果项目未指定，则设置默认值为 \"-1\"\n          var prjId = rows[0].data.PROJECT_ID ;\n          if(prjId === null || prjId === \"\" || prjId === undefined){\n            prjId = \"-1\" ;\n          }\n          var orgId = rows[0].data.ORG_ID;\n          if(orgId==''){\n            return;\n          }\n          var auditStatus = rows[0].data.AUDIT_STATUS;\n          var _empId = '{#XIP.empId#}' ;\n          var json = {\n            'APP_IP':'{#appIP#}',\n            'loginName':'{#XIP.userName#}',\n            'AP_DOC_CAT_NAME':'{#cght#}',\n            'PC_A_FORM':pcApproveForm,\n            'M_A_FORM' :mApproveForm,\n            'apCatCode':'CGHT',\n            'DEPT_NAME':rows[0].data.DEPT_NAME,\n            'AMT':rows[0].data.INV_AMOUNT,\n            'e_business_id':rows[0].data.AP_CONTRACT_ID,\n            'billType'\t : 'CGHT',\n            'PROJECT_ID'   : rows[0].data.PROJECT_ID,\n            'EMP_ID'       : _empId,\n            'ledgerId'     : rows[0].data.LEDGER_ID,\n            'DEPT_ID'      : rows[0].data.DEPT_ID,\n            'ORG_ID'\t\t : orgId\n          };\n          if(auditStatus === 'A'){//起草状态\n            XipWf.startAndSubmitByProcess(processCode,json,function(e){//提交流程\n              if(e.flag === 0){\n                app.queryBtn.fireEvent('click');\n                Wb.toast('{#submitMsg4#}');\n              }\n              else if(e.flag === 1){\n                Wb.toast(e.msg) ;\n              }else{}\n            });\n          }\n          else if(auditStatus === 'D'){//驳回状态\n            XipWf.submitInstance(rows[0].data.INS_CODE,json,function(e){//提交流程\n              if(e.flag === 0){\n                app.queryBtn.fireEvent('click');\n                Wb.toast('{#submitMsg4#}');\n                app.Grid.getStore().reload();\n              }\n              else if(e.flag === 1){\n                Wb.toast(e.msg) ;\n              }else{}\n            });\n          }else if(auditStatus === 'R'){//撤回状态\n            // 撤回 -> 按流程实例提交流程\n            XipWf.restartAndSubmitByProcess(rows[0].data.INS_CODE,processCode,json,function(e){\n              if(e.flag === 0){\n                //app.submitButton.setDisabled(true);\n                Wb.toast('{#submitMsg4#}');\n                app.Grid.getStore().reload();\n              }\n              else if(e.flag === 1){\n                Wb.toast(e.msg) ;\n              }else{}\n            },null);\n          }\n          else if(auditStatus === 'E' || auditStatus === 'C'){//运行中、结束状态\n            Wb.toast('{#submitMsg4#}');\n            return false;\n          }\n          else{\n            Wb.toast('{#submitMsg5#}');\n            return false;\n          }\n        }\n      }else{\n        Wb.toast('{#xc_ap_ct_doc_cat#}'+'CGHT'+'{#xc_ap_ct_process_no_set#}');\n      }\n    }\n  });\n\n\n\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item5"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#monitor#}","itemId":"monitorBtn","iconCls":"viewport_icon"},"events":{"click":"var rows = app.Grid.getSelection();\nif(rows.length != 1){\n\tWb.toast('{#monitorMsg1#}');\n}\nelse{\n    if(rows[0].data.INS_CODE === null || rows[0].data.INS_CODE === ''){\n        Wb.toast('{#monitorMsg2#}');\n\t}\n    else{\n        XipWf.showMonitorPage(rows[0].data.INS_CODE);\n    }   \n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item6"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#revoke#}","itemId":"revokeBtn","iconCls":"cancel_icon"},"events":{"click":"var rows=app.Grid.getSelection();\nif(rows.length != 1){\n\tWb.toast('{#monitorMsg1#}');\n\treturn;\n}\nif(rows[0].data.INS_CODE === null || rows[0].data.INS_CODE === '') {\n\tWb.toast('{#monitorMsg2#}');\n\treturn;\n}\nelse if(rows[0].data.AUDIT_STATUS === 'E') {\n\tWb.toast('{#withdrawMsg3#}');\n\treturn;\n}\nelse if(rows[0].data.AUDIT_STATUS === 'R'){\n    Wb.toast('{#withdrawMsg4#}');\n    return false;\n}else if(rows[0].data.AUDIT_STATUS === 'A'){\n    Wb.toast('{#withdrawMsg5#}');\n    return false;\n}else if(rows[0].data.AUDIT_STATUS === 'D'){\n    Wb.toast('{#withdrawMsg5#}');\n    return false;\n}\nelse {\n\t//撤回流程\n\tXipWf.revokeByInstance(rows[0].data.INS_CODE,function(e){\n     \tapp.queryBtn.fireEvent('click');\n      \tWb.toast('{#xc_ap_ct_revoke_success#}');\n\t});\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item2"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#mx#}","itemId":"mxBtn"},"events":{"click":"\nvar rows = app.Grid.getSelection();\nif (rows.length != 1) {\n\n   Wb.toast('editMsg1');\n  \n  return;\n} else {\n // var mxwin = new Ext.window.Window(app.mxWin);\n\n  \n   var vid = rows[0].data.AP_CONTRACT_ID; \n    app.AP_CONTRACT_CODE_MX.setValue(rows[0].data.AP_CONTRACT_CODE); \n    app.AP_CONTRACT_NAME_MX.setValue(rows[0].data.AP_CONTRACT_NAME); \n    app.VENDOR_NAME_MX.setValue(rows[0].data.VENDOR_NAME);  \n    app.AMOUNT_MX.setValue(rows[0].data.AMOUNT); \n    app.START_DATE_MX.setValue(rows[0].data.START_DATE); \n\n  app.END_DATE_MX.setValue(rows[0].data.END_DATE); \n //   Wb.edit(app.Grid,app.mxWin);\n    app.mxWin.show();\n\n    app.AP_CONTRACT_ID_TXT.setValue(vid); //设置ID\n    app.grid1.store.load( {  params:{AP_CONTRACT_ID:vid}});\n\n\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item13"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#close#}","itemId":"closeBtn"},"events":{"click":"var rows=app.Grid.getSelectionModel().getSelection();\nif(rows.length===0){\n  Ext.Msg.alert('{#prompt#}','{#close1#}');\n  return;\n}\nelse{\n   Ext.Msg.confirm('{#prompt#}','{#closeMsg2#}',function(a){\n      if(a=='yes'){\n      var ids = [] ;\n      Ext.each(rows,function(r){\n        var id = {'id':r.data.AP_CONTRACT_ID};\n        ids.push(id);\n      });\n        Wb.request({\n         url : '{#contextPath#}'+'/apContractAction.do?method=closeContract',\n         params : {'idArray':ids},\n         success :function(response){\n           var rec = Wb.decode(response.responseText);\n           if(rec.flag=='0'){\n              Wb.toast('{#closeMsg3#}');\n           \t  app.queryBtn.fireEvent(\"click\");\n           }else if(rec.flag=='1'){\n           \t\tWb.toast(rec.msg);\n           }\n          \n         }\n      });\n     \n    }else{\n      return false ;\n    }\n   });\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item14"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"{#reopen#}","itemId":"openBtn"},"events":{"click":"var rows=app.Grid.getSelectionModel().getSelection();\nif(rows.length===0){\n  Ext.Msg.alert('{#prompt#}','{#openMsg1#}');\n  return;\n}\nelse{\n   Ext.Msg.confirm('{#prompt#}','{#openMsg2#}',function(a){\n      if(a=='yes'){\n      var ids = [] ;\n      Ext.each(rows,function(r){\n        var id = {'id':r.data.AP_CONTRACT_ID};\n        ids.push(id);\n      });\n        Wb.request({\n         url : '{#contextPath#}'+'/apContractAction.do?method=openContract',\n         params : {'idArray':ids},\n         success :function(response){\n           var rec = Wb.decode(response.responseText);\n           if(rec.flag=='0'){\n              Wb.toast('{#openMsg3#}');\n              app.queryBtn.fireEvent(\"click\");\n           }\n         }\n      });\n     \n    }else{\n      return false ;\n    }\n   });\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"item141"},"children":[],"expanded":false,"type":"item"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#rowNum#}","align":"center","width":"50","xtype":"rownumberer","itemId":"Row_num"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"合同ID","hidden":"true","dataIndex":"AP_CONTRACT_ID","titleAlign":"center","itemId":"AP_CONTRACT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#ledgerId#}","hidden":"true","dataIndex":"LEDGER_ID","itemId":"LEDGER_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#ledgerName#}","hidden":"true","width":"150","dataIndex":"LEDGER_NAME","titleAlign":"center","itemId":"LEDGER_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#orgId#}","hidden":"true","dataIndex":"ORG_ID","itemId":"ORG_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#org#}","width":"150","dataIndex":"ORG_NAME","titleAlign":"center","itemId":"ORG_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#code#}","dataIndex":"AP_CONTRACT_CODE","titleAlign":"center","itemId":"AP_CONTRACT_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#c_name#}","width":"120","dataIndex":"AP_CONTRACT_NAME","titleAlign":"center","itemId":"AP_CONTRACT_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#vendorId#}","hidden":"true","dataIndex":"VENDOR_ID","itemId":"VENDOR_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#vendorName#}","dataIndex":"VENDOR_NAME","titleAlign":"center","itemId":"VENDOR_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#contractType#}","dataIndex":"AP_CONTRACT_TYPE","titleAlign":"center","itemId":"AP_CONTRACT_TYPE_COL","renderer":"if(value=='BKHT') return '{#bkht#}';\nelse if(value=='KKHT') return '{#kkht#}';"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#contractClassify#}","hidden":"true","dataIndex":"CONTRACT_CLASSIFY","titleAlign":"center","itemId":"CONTRACT_CLASSIFY_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#contractClassify#}","dataIndex":"CONTRACT_TYPE_NAME","titleAlign":"center","itemId":"CONTRACT_TYPE_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#workflowStatus#}","hidden":"true","dataIndex":"AUDIT_STATUS","titleAlign":"center","itemId":"AUDIT_STATUS_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#workflowStatus#}","hidden":"true","dataIndex":"AUDIT_STATUS_DESC","titleAlign":"center","itemId":"AUDIT_STATUS_DESC_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#auditStatus#}","dataIndex":"SYS_AUDIT_STATUS","titleAlign":"center","itemId":"SYS_AUDIT_STATUS_COL","renderer":"if(value=='A') return '{#draft#}';\nif(value=='C') return '{#auditing#}';\nif(value=='B') return '{#xc_ap_changing#}';\nif(value=='E') return '{#audited#}';"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#auditStatus#}","hidden":"true","dataIndex":"SYS_AUDIT_STATUS_DESC","titleAlign":"center","itemId":"SYS_AUDIT_STATUS_DESC_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#projectId#}","hidden":"true","dataIndex":"PROJECT_ID","itemId":"PROJECT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#projectName#}","dataIndex":"PROJECT_NAME","titleAlign":"center","itemId":"PROJECT_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#deptId#}","hidden":"true","dataIndex":"DEPT_ID","itemId":"DEPT_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#deptName#}","dataIndex":"DEPT_NAME","titleAlign":"center","itemId":"DEPT_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#contractAmt#}","align":"right","dataIndex":"AMOUNT","titleAlign":"center","itemId":"AMOUNT_COL","renderer":"return Wb.format(value,'0,000.00');"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#taxAmt#}","align":"right","dataIndex":"TAX_AMT","titleAlign":"center","itemId":"TAX_AMT_COL","renderer":"return Wb.format(value,'0,000.00');"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#invAmount#}","align":"right","dataIndex":"INV_AMOUNT","titleAlign":"center","itemId":"INV_AMOUNT_COL","renderer":"return Wb.format(value,'0,000.00');"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#startDate#}","dataIndex":"START_DATE","format":"Y-m-d","titleAlign":"center","itemId":"START_DATE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#endDate#}","dataIndex":"END_DATE","format":"Y-m-d","titleAlign":"center","itemId":"END_DATE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#isClose#}","dataIndex":"IS_CLOSE","titleAlign":"center","itemId":"IS_CLOSE_COL","renderer":"if(value==\"Y\"){\n  return '{#Y#}';\n}else{\n  return '{#N#}';\n}\n  "},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#description#}","dataIndex":"DESCRIPTION","titleAlign":"center","itemId":"DESCRIPTION_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#principal#}","hidden":"true","dataIndex":"CONTRACT_USER","titleAlign":"center","itemId":"CONTRACT_USER_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#principal#}","dataIndex":"EMP_NAME","titleAlign":"center","itemId":"EMP_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#principal#}","hidden":"true","dataIndex":"EMP_ID","titleAlign":"center","itemId":"EMP_ID_COL"},"children":[],"expanded":false,"type":"column"}],"expanded":false,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":false,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}