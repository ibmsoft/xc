{"inframe":false,"title":"账簿单据类型设置","hidden":false,"roles":{"default":1},"children":[{"configs":{"initScript":"com.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xc/ap/ld/docCats/XC_AP_LD_DOC_CAT\");","itemId":"module"},"events":{"finalize":"function returnRowFn(r,type){\n  var ledgerId = r.data.LEDGER_ID;\n  if(type==='xc_gl_ledgers'){\n    Wb.request({\n      url: 'm?xwl=xc/ap/ld/docCats/DB/XC_AP_LD_DOC_CAT_EXISTS',\n      params: {LEDGER_ID:ledgerId},\n      async : false,\n      success: function(resp) {\n        var r = Wb.decode(resp.responseText);\n        if(r.rowNum===0){\n          Wb.request({\n            url: 'm?xwl=xc/ap/ld/docCats/DB/XC_AP_LD_DOC_CAT_INSERT',\n            params: {LEDGER_ID:ledgerId},\n            async : false,\n            success: function(resp) {\n            }\n          });\n        }else{\n        }\n        Wb.reload(app.grid1);\n        app.grid2.getStore().reload({params:{\n\t\t\tLEDGER_ID:app.LEDGER_XWL.LEDGER_ID.getValue(),\n\t\t\tVAL_CODE:'-1'\n        }});\n      }\n    });\n  }\n}\nfunction clearOtherFn(type){\n  if(type=='xc_gl_ledgers'){\n  }\n}\n//设置账簿的输入框背景色，并且设置必输。\napp.LEDGER_XWL.LEDGER_NAME.setFieldStyle('background-color: #ffffd0; background-image: none;');\napp.LEDGER_XWL.LEDGER_NAME.allowBlank=false;"},"children":[{"configs":{"itemId":"request"},"children":[{"configs":{"autoLoad":"true","itemId":"ldInitStore","url":"m?xwl=xc/com-lov/LEDGER_ID_PICK/DB/XC_GL_LEDGERS_SELECT_SEC"},"events":{"load":"app.LEDGER_XWL.LEDGER_ID.setValue(store.getAt(0).get('LEDGER_ID'));\napp.LEDGER_XWL.LEDGER_NAME.setValue(store.getAt(0).get('LEDGER_NAME'));\nWb.request({\n  url: 'm?xwl=xc/ap/ld/docCats/DB/XC_AP_LD_DOC_CAT_EXISTS',\n  params: {LEDGER_ID:store.getAt(0).get('LEDGER_ID')},\n  async : false,\n  success: function(resp) {\n    var r = Wb.decode(resp.responseText);\n\tif(r.rowNum===0){\n      Wb.request({\n        url: 'm?xwl=xc/ap/ld/docCats/DB/XC_AP_LD_DOC_CAT_INSERT',\n        params: {LEDGER_ID:store.getAt(0).get('LEDGER_ID')},\n        async : false,\n        success: function(resp) {\n        }\n      });\n    }else{\n    }\n    app.grid1.getStore().load();\n  }\n});"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"folder"},{"configs":{"layout":"border","itemId":"viewport1"},"children":[{"configs":{"region":"north","itemId":"form1"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"column","border":"false","itemId":"tr1"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".25","border":"false","itemId":"td_1_1"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/LEDGER_ID_PICK/LEDGER_ID_PICK_SEC","itemId":"LEDGER_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"form"},{"configs":{"region":"center","pagingBar":"false","itemId":"grid1"},"events":{"itemclick":"Wb.request({\n    url: 'm?xwl=xc/ap/ld/docCats/DB/XC_AP_LD_DOC_CAT_EXISTS',\n    params: {\n        LEDGER_ID: app.LEDGER_XWL.LEDGER_ID.getValue(),AP_DOC_CAT_CODE: record.data.VAL_CODE\n    },\n    success: function(resp) {\n        var r = Wb.decode(resp.responseText);\n        if (r.rowNum === 0) {\n            Wb.request({\n                url: 'm?xwl=xc/ap/ld/docCats/DB/XC_AP_LD_DOC_CAT_INSERT',\n                params: {\n                    LEDGER_ID: app.LEDGER_XWL.LEDGER_ID.getValue(),\n                    AP_DOC_CAT_CODE: record.data.VAL_CODE\n                },\n                success: function(resp) {\n                    app.grid2.getStore().reload({\n                        params: {\n                            LEDGER_ID: app.LEDGER_XWL.LEDGER_ID.getValue(),\n                            VAL_CODE: record.data.VAL_CODE\n                        },\n                        callback: null\n                    });\n                }\n            });\n        } else {\n            app.grid2.getStore().reload({\n                params: {\n                    LEDGER_ID: app.LEDGER_XWL.LEDGER_ID.getValue(),\n                    VAL_CODE: record.data.VAL_CODE\n                },\n                callback: null\n            });\n        }\n    }\n});\nif(record.get('VAL_CODE') === 'CGFP'){\n\tapp.IS_SIGN_COL.show();\n}\nelse{\n\tapp.IS_SIGN_COL.hide();\n}\n//  if(record.get('VAL_CODE') === 'TZD'){\n//      app.RULE_DESC_COL.hide();\n//     }else{\n//        app.RULE_DESC_COL.show();\n//     }\nif(record.get('VAL_CODE') === 'FKD' || record.get('VAL_CODE') === 'YFD' || record.get('VAL_CODE') === 'HXD' || record.get('VAL_CODE') === 'TZD'){\n\tapp.PROCESS_NAME_COLS.hide();\n//     app.PC_W_FORM_NAME_COL.hide();\n//     app.PC_A_FORM_NAME_COL.hide();\n//     app.PC_P_FORM_NAME_COL.hide();\n//     app.M_W_FORM_NAME_COL.hide();\n//     app.M_A_FORM_NAME_COL.hide();\n}\nelse{\n\tapp.PROCESS_NAME_COLS.show();\n//     app.PC_W_FORM_NAME_COL.show();\n//     app.PC_A_FORM_NAME_COL.show();\n//     app.PC_P_FORM_NAME_COL.show();\n//     app.M_W_FORM_NAME_COL.show();\n//     app.M_A_FORM_NAME_COL.show();\n}"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/ap/ld/docCats/DB/XC_AP_DOC_CLASS_SELECT"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"{#saveBtn#}","itemId":"saveBtn","iconCls":"save_icon"},"events":{"click":"if (!Wb.verifyGrid(app.grid2)) //验证数据是否合法\n  return;\nWb.sync({\n  grid: app.grid2,\n  url: 'm?xwl=xc/ap/ld/docCats/DB/XC_AP_LD_DOC_CAT_GRID_UPDATE',\n  message: '{#message#}',\n  success: function(resp) {\n    Wb.reload(app.grid2);\n    Wb.toast('{#SAVETIP#}');\n  }\n});"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#XH#}","align":"center","width":"50","xtype":"rownumberer","itemId":"column1"},"events":{"afterrender":"\n\n"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#VAL_CODE_COL#}","width":"150","dataIndex":"VAL_CODE","titleAlign":"center","itemId":"VAL_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#VAL_NAME_COL#}","width":"200","dataIndex":"VAL_NAME","titleAlign":"center","itemId":"VAL_NAME_COL"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"},{"configs":{"region":"south","height":"320","itemId":"grid2","editable":"true"},"events":{"tagEvents":"/**cellclick(  grid,  td,  cellIndex,  record,  tr, rowIndex,  e, eOpts ){\n  \n    var celdata = record.data.DOC_CLASS; // Get field name\nif(cellIndex===4){\n \t\t\n     if(celdata=='FKD'){\n\t\t\treturn false;\n       }\n    }\n    \n}**/"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/ap/ld/docCats/DB/XC_AP_LD_DOC_CAT_SELECT"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#XH#}","align":"center","width":"50","xtype":"rownumberer","titleAlign":"center","itemId":"column1"},"events":{"afterrender":"\n\n"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#VAL_NAME_COL#}","width":"150","dataIndex":"AP_DOC_CAT_CODE","titleAlign":"center","itemId":"AP_DOC_CAT_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#AR_CAT_CODE_COL#}","hidden":"true","width":"150","dataIndex":"AP_CAT_CODE","titleAlign":"center","itemId":"AP_CAT_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#AR_CAT_NAME_COL#}","width":"200","dataIndex":"AP_CAT_NAME","titleAlign":"center","itemId":"AP_CAT_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#PROCESS_NAME_COL#}","width":"150","dataIndex":"PROCESS_NAME","titleAlign":"center","itemId":"PROCESS_NAME_COLS"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","normalName":"PROCESS_NAME_PICK","itemId":"editor"},"children":[{"configs":{"tagConfigs":"minWidth:400","itemId":"pickComp"},"events":{"itemdblclick":"var r=app.grid2.getSelectionModel().getSelection()[0];\nr.set('PROCESS_ID',record.data.PROCESS_ID);\nr.set('PROCESS_NAME',record.data.PROCESS_NAME);\nr.dirty = true;\napp.PROCESS_NAME_PICK.setValue(record.data.PROCESS_NAME);\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"pageSize":"5","autoLoad":"true","itemId":"store","url":"m?xwl=xc/com-lov/PROCESS_ID_PICK/DB/XIP_WF_PROCESSES_SELECT"},"events":{"beforeload":"operation.params = Wb.getValue(app.tbar);"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","dataIndex":"PROCESS_ID","itemId":"PROCESS_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#PROCESS_CODE_COL#}","dataIndex":"PROCESS_CODE","itemId":"PROCESS_CODE_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#PROCESS_NAME_COL1#}","dataIndex":"PROCESS_NAME","itemId":"PROCESS_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"100","emptyText":"{#QUERY_CODE_NAME#}","labelAlign":"right","itemId":"QUERY_CODE_NAME"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.pickComp.getStore().load();\n}"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"100","hidden":"true","value":"AP","labelAlign":"right","itemId":"QUERY_CODE"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"cancelBtn","iconCls":"delete_icon"},"events":{"click":"var r=app.grid2.getSelectionModel().getSelection()[0];\nr.set('PROCESS_ID','');\nr.set('PROCESS_NAME','');\nr.dirty = true;\napp.PROCESS_NAME_PICK.setValue('');\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[],"expanded":false,"type":"item"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":false,"type":"column"},{"configs":{"text":"{#IS_SIGN_COL#}","width":"80","xtype":"checkcolumn","dataIndex":"IS_SIGN","itemId":"IS_SIGN_COL"},"events":{"checkchange":"var record = app.grid2.store.getAt(rowIndex);\n\nif(record.data.IS_SIGN_VAL===1){\n  return;\n}else{\n  \n  if(record.data.IS_SIGN===1){\n      Ext.Msg.alert('提示',\"没有签收的不可以改为签收!\");\n      record.set(\"IS_SIGN\", 0);\n      return false;\n  }else{\n  }\n\n}"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#RULE_DESC_COL#}","hidden":"true","width":"180","dataIndex":"RULE_DESC","titleAlign":"center","itemId":"RULE_DESC_COL"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","normalName":"RULE_DESC_PICK","itemId":"editor"},"children":[{"configs":{"tagConfigs":"minWidth:400","itemId":"pickComp"},"events":{"itemdblclick":"var r=app.grid2.getSelectionModel().getSelection()[0];\nr.set('RULE_CODE',record.data.RULE_CODE);\nr.set('RULE_DESC',record.data.RULE_DESC);\napp.RULE_DESC_PICK.setValue(record.data.RULE_DESC);\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"pageSize":"5","itemId":"store","autoLoad":"true","url":"m?xwl=xc/com-lov/RULE_CODE_PICK/DB/XC_GL_RULES_SELECT"},"events":{"beforeload":"operation.params = Wb.getValue(app.tbar);"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#CODE_COL#}","dataIndex":"RULE_CODE","itemId":"RULE_CODE_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#NAME_COL#}","dataIndex":"RULE_DESC","itemId":"RULE_DESC_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"100","emptyText":"{#RULE_DESC_COL#}","labelAlign":"right","itemId":"QUERY_CODE_NAME"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.pickComp.getStore().load();\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":false,"type":"column"},{"configs":{"text":"{#PC_W_FORM_NAME_COL#}","hidden":"true","width":"150","dataIndex":"PC_W_FORM_NAME","titleAlign":"center","itemId":"PC_W_FORM_NAME_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#PC_A_FORM_NAME_COL#}","hidden":"true","width":"150","dataIndex":"PC_A_FORM_NAME","titleAlign":"center","itemId":"PC_A_FORM_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#PC_P_FORM_NAME_COL#}","hidden":"true","width":"150","dataIndex":"PC_P_FORM_NAME","titleAlign":"center","itemId":"PC_P_FORM_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#M_W_FORM_NAME_COL#}","hidden":"true","width":"150","dataIndex":"M_W_FORM_NAME","titleAlign":"center","itemId":"M_W_FORM_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#M_A_FORM_NAME_COL#}","hidden":"true","width":"150","dataIndex":"M_A_FORM_NAME","titleAlign":"center","itemId":"M_A_FORM_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#PROCESS_NAME_COL#}","hidden":"true","width":"150","dataIndex":"PROCESS_ID","titleAlign":"center","itemId":"PROCESS_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#IS_SIGN_COL#}","hidden":"true","width":"100","dataIndex":"IS_SIGN_VAL","titleAlign":"center","itemId":"IS_SIGN_VAL_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#RULE_DESC_COL#}","hidden":"true","width":"180","dataIndex":"RULE_CODE","titleAlign":"center","itemId":"RULE_CODE_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#DESCRIPTION_COL#}","width":"200","dataIndex":"DESCRIPTION","titleAlign":"center","itemId":"DESCRIPTION_COL"},"children":[],"expanded":true,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}