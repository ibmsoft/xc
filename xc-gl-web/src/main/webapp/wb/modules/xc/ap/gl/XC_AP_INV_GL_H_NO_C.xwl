{"inframe":false,"title":"","hidden":false,"roles":{"default":1},"children":[{"configs":{"serverScript":"//---------------------获取当前模块语言对应的.json文件，放到request中----------------\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xc/ap/gl/json/XC_AP_INV_GL_H_NO_C\");\nvar contextPath = request.getContextPath();\nrequest.setAttribute(\"contextPath\",contextPath);\nrequest.setAttribute('opmode','view');\nrequest.setAttribute('vtype','normal');\n\nrequest.setAttribute('businessId',request.getParameter('businessId')); ","itemId":"module"},"events":{"finalize":"var tableValue = '';//窗口中的所有信息\nvar isEditCol = 'N';//判断是否更新过行信息\nvar deleteDtl = [];","initialize":"Wb.keyValue = '';\nWb.isInsert = 'Y';\nWb.docCatCode = 'YFD';\nWb.apInvHId = null;\nWb.h_ap_inv_gl_h_id = '';\nWb.LEDGER_ID = '';\nWb.LEDGER_NAME = '';\nWb.flag = '';\nvar gridCommon = null;\nExt.apply(app, {\n    initWin: function(params) {\n        Ext.apply(app, params);\n        app.editWinN = new Ext.window.Window(app.editWinN);\n        app.editWinN.show();\n        Wb.isInsert = params.IS_INSERT;\n        Wb.keyValue = params.AP_INV_GL_H_ID;\n        Wb.docCatCode = params.AP_DOC_CAT_CODE;\n        app.AP_DOC_CAT_CODE.setValue(Wb.docCatCode);\n        Wb.h_ap_inv_gl_h_id = params.H_AP_INV_GL_H_ID;\n        Wb.LEDGER_ID = params.LEDGER_ID;\n        Wb.LEDGER_NAME = params.LEDGER_NAME;\n        Wb.flag = params.flag;\n        //隐藏新增按钮\n        if(Wb.flag == 'inv_h'){\n            app.addBtn.hide();\n        }\n        if(Wb.docCatCode == 'YFD-H'){\n            app.INV_AMOUNT.setFieldStyle('color:red;');\n            app.TAX_AMT.setFieldStyle('color:red;');\n            app.TAX_AMT.setMaxValue(0);\n            app.invGlBtn.hide();\n        }\n        else{\n            app.TAX_AMT.setMinValue(0);\n            app.SOURCE.setReadOnly(true);\n        }\n        if (Wb.isInsert == 'Y') {\n            gridCommon = app.grid1;\n            app.AP_INV_GL_H_ID.setValue(Xip.getId());\n            app.GL_DATE.setValue(new Date());\n            app.CREATED_BY_NAME.setValue('{#XIP.empName#}');\n            app.V_STATUS_NAME.setValue('{#1_STATUS#}');\n            gridCommon.getStore().reload({params: {AP_INV_GL_H_ID: app.AP_INV_GL_H_ID.getValue()}});\n\n            app.tabs.tabBar.items.items[0].hide();\n            app.tabs.setActiveTab(app.tab1);\n            app.SOURCE.getStore().removeAt(1);\n\n            if (!Wb.isEmpty(Wb.h_ap_inv_gl_h_id)) {\n                app.cancelBtn.hide();\n                app.payBtn.hide();\n                Wb.request({\n                  url: 'm?xwl=xc/ap/gl/DB/XC_AP_INV_GL_H_SELECT_BY_ID',\n                  params: {AP_INV_GL_H_ID: Wb.h_ap_inv_gl_h_id},\n                  async : false,\n                  success: function(resp) {\n                      var r = Wb.decode(resp.responseText);\n                      r.GL_DATE = new Date();\n                      r.AMOUNT = r.AMOUNT * -1;\n                      r.TAX_AMT = ((r.TAX_AMT === 0) ? null : r.TAX_AMT * -1);\n                      app.TAX_AMT.setMaxValue(0);\n                      app.TAX_AMT.setMinValue((r.TAX_AMT === null) ? 0 : r.TAX_AMT);\n                      r.INV_AMOUNT = r.INV_AMOUNT * -1;\n                      r.AP_DOC_CAT_CODE = Wb.docCatCode;\n                      Wb.keyValue = Xip.getId();\n                      r.AP_INV_GL_H_ID = Wb.keyValue;\n                      Wb.setValue(app.editWinN, r);\n                    \n                      app.CREATED_BY_NAME.setValue('{#XIP.empName#}');\n                      app.SOURCE.setValue('GL');\n                      app.AP_INV_GL_H_ID_XWL.L_AP_INV_GL_H_ID.setValue(Wb.h_ap_inv_gl_h_id);\n                      app.AP_INV_GL_H_ID_XWL.L_AP_INV_GL_H_CODE.setValue(app.AP_INV_GL_H_CODE.getValue());\n                      app.AP_INV_GL_H_CODE.reset();\n                      app.V_HEAD_ID.reset();\n                      app.V_STATUS.reset();\n                      app.V_STATUS_NAME.setValue('{#1_STATUS#}');\n                      app.V_ATTCH_TOTAL.reset();\n                      app.AP_INV_H_ID.reset();\n\n                      //账薄、供应商、蓝字应付单设置为不可修改\n                      setSomeReadOnly(true);\n                      setLedger(r.LEDGER_ID);\n                      setMinDate(r.LEDGER_ID);\n                      app.SOURCE.setReadOnly(true);\n                    \n                      app.store2.reload({\n                          params: {AP_INV_GL_H_ID: Wb.h_ap_inv_gl_h_id},\n                          callback: function() {\n                              gridCommon.getStore().removeAll();\n                              for (var i = 0; i < app.store2.getCount(); i++) {\n                                  var r = app.store2.getAt(i);\n                                  r.set('L_AP_INV_GL_L_ID', r.get('AP_INV_GL_L_ID'));\n                                  r.set('L_AP_INV_GL_H_ID', r.get('AP_INV_GL_H_ID'));\n                                  r.set('AP_INV_GL_L_ID', null);\n                                  r.set('AP_INV_GL_H_ID', app.AP_INV_GL_H_ID.getValue());\n                                  r.set('AMOUNT', r.get('AMOUNT') * -1);\n                                  r.set('QTY', r.get('QTY') * -1);\n                                  gridCommon.getStore().add(r.data);\n                                  app.QTY_COL.getEditor().setMinValue(r.get('QTY'));\n                                  app.AMOUNT_COL.getEditor().setMinValue(r.get('AMOUNT'));\n                              }\n                          }\n                      });\n                    }\n                });\n              }\n          }\n          if (Wb.isInsert == 'N') {\n              Wb.request({\n                  url: 'm?xwl=xc/ap/gl/DB/XC_AP_INV_GL_H_SELECT_BY_ID',\n                  params: {AP_INV_GL_H_ID: Wb.keyValue},\n                  async : false,\n                  success: function(resp) {\n                      var r = Wb.decode(resp.responseText);\n                      r.GL_DATE = Wb.strToDate(r.GL_DATE);\n                      if (r.V_STATUS !== '1' && r.V_STATUS !== null) {\n                          app.saveBtn.setDisabled(true);\n                          app.verfyBtn.setDisabled(true);\n                      }\n                      r.TAX_AMT = ((r.TAX_AMT === 0) ? null : r.TAX_AMT);\n                      Wb.setValue(app.tab1, r);\n                      gridCommon = app.grid2;\n                      //判断是否有发票ID，如果没有就隐藏发票页签\n                      if (Wb.isEmpty(r.AP_INV_H_ID)) {\n                          app.tabs.tabBar.items.items[0].hide();\n                          app.tabs.setActiveTab(app.tab1);\n                          gridCommon = app.grid1;\n                      }\n                      Wb.apInvHId = r.AP_INV_H_ID;\n                      if (!Wb.isEmpty(r.L_AP_INV_GL_H_CODE)) {\n                          app.AP_INV_GL_H_ID_XWL.L_AP_INV_GL_H_CODE.setValue(r.L_AP_INV_GL_H_CODE);\n                          app.AP_INV_GL_H_ID_XWL.L_AP_INV_GL_H_ID.setValue(r.L_AP_INV_GL_H_ID);\n                          app.td_2_2.show();\n                          Wb.request({\n                              url : 'm?xwl=xc/ap/gl/DB/XC_AP_INV_GL_H_SELECT_BY_ID',\n                              params : {AP_INV_GL_H_ID : r.L_AP_INV_GL_H_ID},\n                              success : function(res){\n                                  var resp = Wb.decode(res.responseText);\n                                  app.TAX_AMT.setMinValue(resp.TAX_AMT * -1);\n                                  app.INV_AMOUNT.setMinValue(resp.INV_AMOUNT * -1);\n                                  app.TAX_RATE.setMaxValue(resp.TAX_RATE);\n                                  app.store2.load({\t\n                                      params: {AP_INV_GL_H_ID : r.L_AP_INV_GL_H_ID},\n                                      callback: function() {\n                                          for (var i = 0; i < app.store2.getCount(); i++) {\n                                              var rs = app.store2.getAt(i);\n                                              app.QTY_COL.getEditor().setMinValue(rs.get('QTY') * -1);\n                                              app.AMOUNT_COL.getEditor().setMinValue(rs.get('AMOUNT') * -1);\n                                          }\n                                      }\n                                  });\n                              }\n                          });\n                      }\n                      setLedger(r.LEDGER_ID);\n                      setMinDate(r.LEDGER_ID);\n                      //调用加载采购发票界面的方法\n                      loadInvoiceInfo();\n                      //账薄、供应商、蓝字应付单设置为不可修改\n                      setSomeReadOnly(true);\n                      returnRowFn(r,'xip_pub_depts');\n                      app.SOURCE.getStore().removeAt(1);\n\n                      //为合同名称加上筛选条件\n                      app.AP_CONTRACT_ID_XWL.QUERY_VENDOR_ID.setValue(r.VENDOR_ID);\n                      gridCommon.getStore().reload({params: {AP_INV_GL_H_ID: Wb.keyValue}});\n                      tableValue = Wb.encode(Wb.getValue(app.form1));\n                  }\n              });\n          }\n          if (Wb.isInsert == 'S') {\n              Wb.request({\n                  url: 'm?xwl=xc/ap/gl/DB/XC_AP_INV_GL_H_SELECT_BY_ID',\n                  params: {AP_INV_GL_H_ID: Wb.keyValue},\n                  async : false,\n                  success: function(resp) {\n                      var r = Wb.decode(resp.responseText);\n                      setLedger(r.LEDGER_ID);\n                      r.GL_DATE = Wb.strToDate(r.GL_DATE);\n                      gridCommon = app.grid2;\n                      //判断是否有发票ID，如果没有就隐藏发票页签\n                      if (Wb.isEmpty(r.AP_INV_H_ID)) {\n                          app.tabs.tabBar.items.items[0].hide();\n                          app.tabs.setActiveTab(app.tab1);\n                          gridCommon = app.grid1;\n                      }\n                      r.TAX_AMT = ((r.TAX_AMT === 0) ? null : r.TAX_AMT);\n                      Wb.setValue(app.tab1, r);\n                      gridCommon.getStore().reload({params: {AP_INV_GL_H_ID: Wb.keyValue}});\n                      if(r.L_AP_INV_GL_H_ID !== null && r.L_AP_INV_GL_H_ID !== '' && r.L_AP_INV_GL_H_ID !== undefined){\n                          app.AP_INV_GL_H_ID_XWL.L_AP_INV_GL_H_ID.setValue(Wb.h_ap_inv_gl_h_id);\n                          app.AP_INV_GL_H_ID_XWL.L_AP_INV_GL_H_CODE.setValue(r.L_AP_INV_GL_H_CODE);\n                          app.td_2_2.show();\n                        }\n                      //调用加载采购发票界面的方法\n                      loadInvoiceInfo();\n                      app.AP_ACC_ID_DEBT_XWL.AP_ACC_NAME_DEBT.setReadOnly(true);\n                      app.AP_ACC_ID_TAX_XWL.AP_ACC_NAME_TAX.setReadOnly(true);\n                  }\n              });\n              app.form1Tbar.hide();\n              app.grid1Tbar.hide();\n              app.grid2Tbar.hide();\n          }\n          if (Wb.isInsert == 'F') { //采购发票复核界面进入的\n              app.AP_INV_GL_H_ID.setValue(Xip.getId());\n              Wb.request({\n                  url: 'm?xwl=xc/ap/inv/DB/XC_AP_INVOICE_H_SELECT_BY_ID',\n                  params: {AP_INV_H_ID: Wb.keyValue},\n                  async : false,\n                  success: function(resp) {\n                      var r = Wb.decode(resp.responseText);\n                      r.BIZ_DATE = Wb.strToDate(r.BIZ_DATE);\n                      Wb.setValue(app.tab0, r);\n                      Wb.request({\n                          url : 'm?xwl=xc/ap/inv/DB/XC_AP_INV_GL_H_SELECT_BY_INV_ID',\n                          params : {AP_INV_H_ID : r.L_AP_INV_H_ID},\n                          success : function(res){\n                              var temp = Wb.decode(res.responseText);\n                              if(temp.AP_INV_GL_H_ID !== null && temp.AP_INV_GL_H_ID !== '' && temp.AP_INV_GL_H_ID !== undefined){\n                                  app.AP_INV_GL_H_ID_XWL.L_AP_INV_GL_H_CODE.setValue(temp.AP_INV_GL_H_CODE);\n                                  app.AP_INV_GL_H_ID_XWL.L_AP_INV_GL_H_ID.setValue(temp.AP_INV_GL_H_ID);\n                                  app.td_2_2.show();\n                              }\n                          }\n                      });\n                      //通过蓝字发票ID得到对应的应付单ID\n                      r.AMOUNT = Math.abs(r.AMOUNT);\n                      r.TAX_AMT = ((r.TAX_AMT === 0) ? null : r.TAX_AMT);\n                      r.INV_AMOUNT = r.INV_AMOUNT;\n                      Wb.setValue(app.tab1, r);\n                      app.CANCEL_AMT.setValue(0);\n                      app.CREATED_BY_NAME.setValue('{#XIP.empName#}');\n                      app.GL_DATE.setValue(r.BIZ_DATE);\n                      app.AP_DOC_CAT_CODE.setValue(Wb.docCatCode);\n                      setLedger(r.LEDGER_ID);\n                      setMinDate(r.LEDGER_ID);\n                      returnRowFn(r,'xip_pub_depts');\n                      app.SOURCE.setValue('INV');\n                      app.V_STATUS_NAME.setValue('{#1_STATUS#}');\n                      Wb.request({\n                          url: 'm?xwl=xc/ap/ld/ledgers/DB/XC_GL_LEDGERS_SELECT_BY_ID',\n                          params: {LEDGER_ID: app.LEDGER_ID_XWL.LEDGER_ID.getValue()},\n                          success: function(resp) {\n                              var o = Wb.decode(resp.responseText);\n                              app.AP_ACC_ID_DEBT_XWL.AP_ACC_ID_DEBT.setValue(o.AP_ACC_ID_DEBT);\n                              app.AP_ACC_ID_DEBT_XWL.AP_ACC_NAME_DEBT.setValue(o.AP_ACC_NAME_DEBT);\n                              if(app.TAX_AMT.getValue() !== null){\n                                  app.AP_ACC_ID_TAX_XWL.AP_ACC_ID_TAX.setValue(o.AP_ACC_ID_TAX);\n                                  app.AP_ACC_ID_TAX_XWL.AP_ACC_NAME_TAX.setValue(o.AP_ACC_NAME_TAX);\n                              }\n                          }\n                      });\n                      //为合同名称加上筛选条件\n                      app.AP_CONTRACT_ID_XWL.QUERY_VENDOR_ID.setValue(r.VENDOR_ID);\n                      gridCommon = app.grid1;\n                      if(r.AP_DOC_CAT_CODE == 'CGFP-CGDD-H' || r.AP_DOC_CAT_CODE == 'CGFP-CGDD') {\n                          app.grid1.hide();\n                          app.grid2.show();\n                          gridCommon = app.grid2;\n                      }\n                      app.grid1Tbar.hide();\n                      app.grid2Tbar.hide();\n                      gridCommon.getStore().reload({\n                          params: {AP_INV_GL_H_ID: app.AP_INV_GL_H_ID.getValue()},\n                          callback: function() {\n                              app.store1.reload({\n                                  params: {AP_INV_H_ID: Wb.keyValue},\n                                  callback: function() {\n                                      for (var i = 0; i < app.store1.getCount(); i++) {\n                                          var r = app.store1.getAt(i);\n                                          r.data.AP_INV_GL_H_ID = app.AP_INV_GL_H_ID.getValue();\n                                          r.data.AP_INV_GL_L_ID = null;\n                                          r.data.ACC_ID = r.data.AP_ACC_ID_INV;\n                                          r.data.ACC_NAME = r.data.AP_ACC_ID_INV_NAME;\n                                          r.data.AMOUNT = r.data.AMOUNT;\n                                          r.data.QTY = r.data.QTY;\n                                          if (Wb.isEmpty(r.data.DESCRIPTION)) {\n                                              r.data.DESCRIPTION = app.DESCRIPTION.getValue();\n                                          }\n                                          gridCommon.getStore().add(r.data);\n                                      }\n                                  }\n                              });\n                          }\n                      });\n                  }\n              });\n          }\n          app.LEDGER_ID_XWL.LEDGER_NAME.allowBlank = false;\n          app.VENDOR_ID_XWL.VENDOR_NAME.allowBlank = false;\n          app.AP_ACC_ID_DEBT_XWL.AP_ACC_NAME_DEBT.allowBlank = false;\n          app.AP_ACC_ID_TAX_XWL.AP_ACC_NAME_TAX.hide();\n    }\n});\nfunction returnRowFn(r, type) {\n    if (type == 'xc_gl_ledgers') {\n        clearAll();\n        app.VENDOR_ID_XWL.VENDOR_ID.setValue('');\n        app.VENDOR_ID_XWL.VENDOR_NAME.setValue('');\n        setLedger(r.data.LEDGER_ID);\n        setMinDate(r.data.LEDGER_ID);\n        Wb.request({\n            url: 'm?xwl=xc/ap/ld/ledgers/DB/XC_GL_LEDGERS_SELECT_BY_ID',\n            params: {LEDGER_ID: app.LEDGER_ID_XWL.LEDGER_ID.getValue()},\n            async : false,\n            success: function(resp) {\n                var o = Wb.decode(resp.responseText);\n                app.AP_ACC_ID_DEBT_XWL.AP_ACC_ID_DEBT.setValue(o.AP_ACC_ID_DEBT);\n                app.AP_ACC_ID_DEBT_XWL.AP_ACC_NAME_DEBT.setValue(o.AP_ACC_NAME_DEBT);\n                if(app.TAX_AMT.getValue() !== null){\n                    app.AP_ACC_ID_TAX_XWL.AP_ACC_ID_TAX.setValue(o.AP_ACC_ID_TAX);\n                    app.AP_ACC_ID_TAX_XWL.AP_ACC_NAME_TAX.setValue(o.AP_ACC_NAME_TAX);\n                }\n            }\n        });\n    }\n    //选择合同名称后为供应商赋值\n    if (type == 'xc_ap_contract') {\n        app.VENDOR_ID_XWL.VENDOR_ID.setValue(r.data.VENDOR_ID);\n        app.VENDOR_ID_XWL.VENDOR_NAME.setValue(r.data.VENDOR_NAME);\n    }\n    //选择供应商后为合同名称(和应收单)加筛选条件\n    if (type == 'xc_ap_vendors') {\n        if(app.AP_INV_GL_H_ID_XWL.L_AP_INV_GL_H_CODE.getValue() !== null && app.AP_INV_GL_H_ID_XWL.L_AP_INV_GL_H_CODE.getValue() !== ''){\n            clearAll();\n            app.VENDOR_ID_XWL.VENDOR_ID.setValue(r.data.VENDOR_ID);\n            app.VENDOR_ID_XWL.VENDOR_NAME.setValue(r.data.VENDOR_NAME);\n        }\n        else{\n            app.AP_CONTRACT_ID_XWL.QUERY_VENDOR_ID.setValue(app.VENDOR_ID_XWL.VENDOR_ID.getValue());\n            app.AP_CONTRACT_ID_XWL.AP_CONTRACT_ID.setValue('');\n            app.AP_CONTRACT_ID_XWL.AP_CONTRACT_NAME.setValue('');\n        }\n    }\n    //为蓝字应收单筛选时带上供应商条件\n    if (type == 'xc_ap_inv_gl_h_before' || type == 'xc_ap_contract_before') {\n        app.AP_CONTRACT_ID_XWL.QUERY_VENDOR_ID.setValue(app.VENDOR_ID_XWL.VENDOR_ID.getValue());\n        app.AP_INV_GL_H_ID_XWL.QUERY_VENDOR_ID.setValue(app.VENDOR_ID_XWL.VENDOR_ID.getValue());\n    }\n    if (type == 'xc_ap_inv_gl_h') {\n        setMaxOrMinValue(null);\n        app.DEPT_ID_XWL.DEPT_ID.setValue(r.data.DEPT_ID);\n        app.DEPT_ID_XWL.DEPT_NAME.setValue(r.data.DEPT_NAME);\n        app.PROJECT_ID_XWL.PROJECT_ID.setValue(r.data.PROJECT_ID);\n        app.PROJECT_ID_XWL.PROJECT_NAME.setValue(r.data.PROJECT_NAME);\n        app.VENDOR_ID_XWL.VENDOR_ID.setValue(r.data.VENDOR_ID);\n        app.VENDOR_ID_XWL.VENDOR_NAME.setValue(r.data.VENDOR_NAME);\n        app.AP_CONTRACT_ID_XWL.AP_CONTRACT_ID.setValue(r.data.AP_CONTRACT_ID);\n        app.AP_CONTRACT_ID_XWL.AP_CONTRACT_NAME.setValue(r.data.AP_CONTRACT_NAME);\n        app.AP_ACC_ID_DEBT_XWL.AP_ACC_ID_DEBT.setValue(r.data.AP_ACC_ID_DEBT);\n        app.AP_ACC_ID_DEBT_XWL.AP_ACC_NAME_DEBT.setValue(r.data.AP_ACC_NAME_DEBT);\n        app.AP_ACC_ID_TAX_XWL.AP_ACC_ID_TAX.setValue(r.data.AP_ACC_ID_TAX);\n        app.AP_ACC_ID_TAX_XWL.AP_ACC_NAME_TAX.setValue(r.data.AP_ACC_NAME_TAX);\n      \n        app.TAX_AMT.setValue(r.get('TAX_AMT') * -1);\n        app.TAX_AMT.setMaxValue(0);\n        app.TAX_AMT.setMinValue(r.get('TAX_AMT') * -1);\n        app.INV_AMOUNT.setValue(r.get('INV_AMOUNT') * -1);\n        app.INV_AMOUNT.setMaxValue(0);\n        app.INV_AMOUNT.setMinValue(r.get('INV_AMOUNT') * -1);\n        app.TAX_RATE.setValue(r.get('TAX_RATE'));\n        app.TAX_RATE.setMaxValue(r.get('TAX_RATE'));\n        app.DESCRIPTION.setValue(r.data.DESCRIPTION);\n        var H_AMOUNT_SUM = r.data.NO_PAY_AMT;\n        var L_AMOUNT_SUM = 0;\n        app.store2.reload({\n            params: {AP_INV_GL_H_ID: app.AP_INV_GL_H_ID_XWL.L_AP_INV_GL_H_ID.getValue()},\n            callback: function() {\n                gridCommon.getStore().removeAll();\n                for (var i = 0; i < app.store2.getCount(); i++) {\n                    var r = app.store2.getAt(i);\n                    L_AMOUNT_SUM = L_AMOUNT_SUM+r.get('AMOUNT');\n\n                    r.set('L_AP_INV_GL_H_ID', r.get('AP_INV_GL_L_ID'));\n                    r.set('L_AP_INV_GL_L_ID', r.get('AP_INV_GL_L_ID'));\n                    r.set('AP_INV_GL_L_ID', null);\n                    r.set('AP_INV_GL_H_ID', app.AP_INV_GL_H_ID.getValue());\n                    r.set('AMOUNT', r.get('AMOUNT') * -1);\n                    r.set('QTY', r.get('QTY') * -1);\n                    gridCommon.getStore().add(r.data);\n                    app.QTY_COL.getEditor().setMinValue(r.get('QTY'));\n                    app.AMOUNT_COL.getEditor().setMinValue(r.get('AMOUNT'));\n                }\n                if(H_AMOUNT_SUM!=L_AMOUNT_SUM){\n                    app.AMOUNT_COL.getEditor().setMaxValue(0);\n                    app.AMOUNT_COL.getEditor().editable=true;\n                }\n            }\n        });\n    }\n    //选择项目带回成本中心\n    if(type == 'xc_pm_projects') {\n        app.DEPT_ID_XWL.DEPT_ID.setValue(r.data.DEPT_ID);\n        app.DEPT_ID_XWL.DEPT_NAME.setValue(r.data.DEPT_NAME);\n    }\n  \n    //选择成本中心为项目查询的成本中心赋值\n    if(type == 'xip_pub_depts') {\n        if(r.data === undefined)\n            app.PROJECT_ID_XWL.QUERY_DEPT_ID.setValue(r.DEPT_ID);\n        else\n            app.PROJECT_ID_XWL.QUERY_DEPT_ID.setValue(r.data.DEPT_ID);\n    }\n}\nfunction clearOtherFn(type) {\n    //清空供应商信息时，同时清空合同名称信息\n    if (type == 'xc_ap_vendors') {\n        if(app.AP_INV_GL_H_ID_XWL.L_AP_INV_GL_H_CODE.getValue() !== null && app.AP_INV_GL_H_ID_XWL.L_AP_INV_GL_H_CODE.getValue() !== ''){\n            clearAll();\n            setMaxOrMinValue(null);\n        }\n        else{\n            app.AP_CONTRACT_ID_XWL.QUERY_VENDOR_ID.setValue('');\n            app.AP_CONTRACT_ID_XWL.AP_CONTRACT_ID.setValue('');\n            app.AP_CONTRACT_ID_XWL.AP_CONTRACT_NAME.setValue('');\n        }\n    }\n    if (type == 'xc_gl_ledgers') {\n        clearAll();\n        app.VENDOR_ID_XWL.VENDOR_ID.setValue('');\n        app.VENDOR_ID_XWL.VENDOR_NAME.setValue('');\n        app.AP_ACC_ID_DEBT_XWL.AP_ACC_ID_DEBT.setValue('');\n        app.AP_ACC_ID_DEBT_XWL.AP_ACC_NAME_DEBT.setValue('');\n        app.AP_ACC_ID_TAX_XWL.AP_ACC_ID_TAX.setValue('');\n        app.AP_ACC_ID_TAX_XWL.AP_ACC_NAME_TAX.setValue('');\n        setLedger('');\n        setMinDate(null);\n    }\n   //情况成本中心同时清空项目查询条件里的成本中心\n    if(type == 'xip_pub_depts') {\n        app.PROJECT_ID_XWL.QUERY_DEPT_ID.setValue('');\n    }\n    //清空应付单，清空明细\n    if(type == 'cancelApInvGl'){\n        clearAll();\n        setMaxOrMinValue(null);\n    }\n}\n\nfunction setLedger(ledgerId) {\n    app.VENDOR_ID_XWL.QUERY_LEDGER_ID.setValue(ledgerId);\n    app.PROJECT_ID_XWL.QUERY_LEDGER_ID.setValue(ledgerId);\n    app.DEPT_ID_XWL.QUERY_LEDGER_ID.setValue(ledgerId);\n    app.AP_CONTRACT_ID_XWL.QUERY_LEDGER_ID.setValue(ledgerId);\n    app.AP_ACC_ID_DEBT_XWL.QUERY_LEDGER_ID.setValue(ledgerId);\n    app.AP_ACC_ID_TAX_XWL.QUERY_LEDGER_ID.setValue(ledgerId);\n    app.AP_INV_GL_H_ID_XWL.QUERY_LEDGER_ID.setValue(ledgerId);\n}\nfunction clearAll(){\n\tapp.DEPT_ID_XWL.DEPT_ID.setValue('');\n    app.DEPT_ID_XWL.DEPT_NAME.setValue('');\n    app.PROJECT_ID_XWL.PROJECT_ID.setValue('');\n    app.PROJECT_ID_XWL.PROJECT_NAME.setValue('');\n    app.AP_CONTRACT_ID_XWL.AP_CONTRACT_ID.setValue('');\n    app.AP_CONTRACT_ID_XWL.AP_CONTRACT_NAME.setValue('');\n    app.AP_CONTRACT_ID_XWL.QUERY_VENDOR_ID.setValue('');\n    app.AP_INV_GL_H_ID_XWL.L_AP_INV_GL_H_ID.setValue('');\n    app.AP_INV_GL_H_ID_XWL.L_AP_INV_GL_H_CODE.setValue('');\n    app.INV_AMOUNT.reset();\n    app.TAX_AMT.reset();\n    app.TAX_RATE.reset();\n    app.DESCRIPTION.reset();\n    gridCommon.getStore().removeAll();\n}\n//加载采购发票界面信息\nfunction loadInvoiceInfo(){\n    Wb.request({\n        url: 'm?xwl=xc/ap/inv/DB/XC_AP_INVOICE_H_SELECT_BY_ID',\n        params: {AP_INV_H_ID: app.AP_INV_H_ID.getValue()},\n        async : false,\n        success: function(resp) {\n            var r = Wb.decode(resp.responseText);\n            r.BIZ_DATE = Wb.strToDate(r.BIZ_DATE);\n            if(r.AP_DOC_CAT_CODE == 'CGFP-CGDD-H' || r.AP_DOC_CAT_CODE == 'CGFP-CGDD') {\n                app.xwl1.grid1.hide();\n                app.xwl1.grid2.show();\n                app.grid1.hide();\n                app.grid2.show();\n            }\n            app.xwl1.grid1.getStore().reload({params: {AP_INV_H_ID: app.AP_INV_H_ID.getValue()}});\n            app.xwl1.grid2.getStore().reload({params: {AP_INV_H_ID: app.AP_INV_H_ID.getValue()}});\n            Wb.setValue(app.tab0, r);\n        }\n    });\n}\n//账薄、供应商、蓝字应付单设置为可修改/不可修改状态\nfunction setSomeReadOnly(flag){\n    //账薄、供应商、蓝字发表设置为不可修改状态\n    app.LEDGER_ID_XWL.LEDGER_NAME.setReadOnly(flag);\n    app.VENDOR_ID_XWL.VENDOR_NAME.setReadOnly(flag);\n    app.AP_INV_GL_H_ID_XWL.L_AP_INV_GL_H_CODE.setReadOnly(flag);\n    app.SOURCE.setReadOnly(flag);\n}\nfunction setAllReadOnly(flag){\n    setSomeReadOnly(flag);\n    app.DEPT_ID_XWL.DEPT_NAME.setReadOnly(flag);\n    app.PROJECT_ID_XWL.PROJECT_NAME.setReadOnly(flag);\n    app.VENDOR_ID_XWL.VENDOR_NAME.setReadOnly(flag);\n    app.AP_CONTRACT_ID_XWL.AP_CONTRACT_NAME.setReadOnly(flag);\n    app.AP_INV_GL_H_ID_XWL.L_AP_INV_GL_H_CODE.setReadOnly(flag);\n    app.INV_AMOUNT.setReadOnly(flag);\n    app.TAX_AMT.setReadOnly(flag);\n    app.TAX_RATE.setReadOnly(flag);\n    app.INV_NO.setReadOnly(flag);\n}\n//查看的时候不能改的\nfunction setSeekReadOnly(flag){\n    app.AMOUNT_COL.getEditor().setReadOnly(flag);\n    app.QTY_COL.getEditor().setReadOnly(flag);\n    app.DIM_NAME_COL.getEditor().setReadOnly(flag);\n    app.DESCRIPTION.setReadOnly(flag);\n    app.V_ATTCH_TOTAL.setReadOnly(flag);\n    app.GL_DATE.setReadOnly(flag);\n    app.AP_ACC_ID_DEBT_XWL.AP_ACC_NAME_DEBT.setReadOnly(flag);\n    app.AP_ACC_ID_TAX_XWL.AP_ACC_NAME_TAX.setReadOnly(flag);\n    app.CCID_NAME_PICK.getEditor().setReadOnly(flag);\n    app.ACC_NAME_COL.getEditor().setReadOnly(flag);\n    app.DESCRIPTION_COL.getEditor().setReadOnly(flag);\n    app.BG_ITEM_NAME_COL.getEditor().setReadOnly(true);\n}\nfunction setMaxOrMinValue(flag){\n    app.TAX_AMT.setMinValue(flag);\n    app.INV_AMOUNT.setMinValue(flag);\n    app.TAX_RATE.setMaxValue(17);\n    app.QTY_COL.getEditor().setMinValue(flag);\n    app.AMOUNT_COL.getEditor().setMinValue(flag);\n}\nfunction setMinDate(ledgerId){\n    Wb.request({//账簿会计期查询\n        url : 'm?xwl=xc/ar/inv/DB/ledgerDateSelect',\n        params : {LEDGER_ID : ledgerId},\n        async : false,\n        success : function(resp){\n            var temp = Wb.decode(resp.responseText);\n            if(temp.rows[0].START_DATE !== null && temp.rows[0].START_DATE !== \"\"){\n                app.GL_DATE.setMinValue(Wb.strToDate(temp.rows[0].START_DATE));\n//                 app.GL_DATE.setValue(new Date());\n                app.GL_DATE.setReadOnly(false);\n            }\n            else {\n                if(app.LEDGER_ID_XWL.LEDGER_ID.getValue() !== null && app.LEDGER_ID_XWL.LEDGER_ID.getValue() !== \"\"){\n                    Wb.toast('{#ledgerNoDate#}');\n//                     app.GL_DATE.setValue(null);\n                    app.GL_DATE.setReadOnly(true);\n                }\n            }\n        }\n    });\n}"},"children":[{"configs":{"itemId":"request"},"children":[{"configs":{"itemId":"store1","url":"m?xwl=xc/ap/inv/DB/XC_AP_INVOICE_L_SELECT_FOR_GL"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"store2","url":"m?xwl=xc/ap/gl/DB/XC_AP_INV_GL_L_SELECT"},"children":[],"expanded":false,"type":"store"},{"configs":{"autoLoad":"true","itemId":"ldInitStore","url":"m?xwl=xc/com-lov/LEDGER_ID_PICK/DB/XC_GL_LEDGERS_SELECT_SEC"},"events":{"load":"if (Wb.isInsert == 'Y' && Wb.isEmpty(Wb.h_ap_inv_gl_h_id)) {\n    if(Wb.isEmpty(Wb.LEDGER_ID)){\n        setValue(store.getAt(0).get('LEDGER_ID'));\n        app.LEDGER_ID_XWL.LEDGER_NAME.setValue(store.getAt(0).get('LEDGER_NAME'));\n    }\n    else{\n        setValue(Wb.LEDGER_ID);\n        app.LEDGER_ID_XWL.LEDGER_NAME.setValue(Wb.LEDGER_NAME);\n    }\n    Wb.request({\n        url: 'm?xwl=xc/ap/ld/ledgers/DB/XC_GL_LEDGERS_SELECT_BY_ID',\n        params: {\n            LEDGER_ID: app.LEDGER_ID_XWL.LEDGER_ID.getValue()\n        },\n        success: function(resp) {\n            var o = Wb.decode(resp.responseText);\n            app.AP_ACC_ID_DEBT_XWL.AP_ACC_ID_DEBT.setValue(o.AP_ACC_ID_DEBT);\n            app.AP_ACC_ID_DEBT_XWL.AP_ACC_NAME_DEBT.setValue(o.AP_ACC_NAME_DEBT);\n            if(app.TAX_AMT.getValue() !== null){\n                app.AP_ACC_ID_TAX_XWL.AP_ACC_ID_TAX.setValue(o.AP_ACC_ID_TAX);\n                app.AP_ACC_ID_TAX_XWL.AP_ACC_NAME_TAX.setValue(o.AP_ACC_NAME_TAX);\n            }\n        }\n    });\n}\nfunction setValue(ledgerId){\n    app.LEDGER_ID_XWL.LEDGER_ID.setValue(ledgerId);\n    setLedger(ledgerId);\n    setMinDate(ledgerId);\n}"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"folder"},{"configs":{"itemId":"form1Tbar"},"children":[{"configs":{"text":"{#addBtn#}","itemId":"addBtn","iconCls":"file_add_icon"},"events":{"click":"app.form1.getForm().reset();\napp.edit_v_xwl.form1.getForm().reset();\nWb.reload(app.ldInitStore);\n//账薄、供应商、蓝字应付单设置为可修改\nsetSomeReadOnly(false);\nif(Wb.docCatCode == 'YFD-H')\n    setMaxOrMinValue(null);\napp.saveBtn.setDisabled(false);\napp.verfyBtn.setDisabled(false);\napp.AP_INV_GL_H_ID.setValue(Xip.getId());\napp.GL_DATE.setValue(new Date());\napp.AP_DOC_CAT_CODE.setValue(Wb.docCatCode);\napp.purTypeBtn.show();\ngridCommon.getStore().reload({params:{\n\tAP_INV_GL_H_ID:app.AP_INV_GL_H_ID.getValue()\n}});\nWb.isInsert = 'Y';"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#saveBtn#}","itemId":"saveBtn","iconCls":"save_icon"},"events":{"click":"var AMOUNT = 0,\nTAX_AMT = 0;\nfor (var i = 0; i < gridCommon.getStore().getCount(); i++) {\n    var r = gridCommon.getStore().getAt(i);\n    AMOUNT = AMOUNT + r.get('AMOUNT');\n    //行摘要\n    var DESCRIPTION = r.get('DESCRIPTION');\n    if(DESCRIPTION === null || DESCRIPTION === ''){\n\t\tr.set('DESCRIPTION',app.DESCRIPTION.getValue());\n    }\n}\nTAX_AMT = app.TAX_AMT.getValue();\nif (!TAX_AMT) {\n    TAX_AMT = 0;\n}\nAMOUNT = AMOUNT + TAX_AMT;\napp.AMOUNT.setValue(AMOUNT);\napp.INV_AMOUNT.setValue(AMOUNT);\n\nif (!Wb.verify(app.form1)) {\n    Wb.toast('{#saveWarn1#}');\n    return;\n}\nif (!Wb.verifyGrid(gridCommon)) {\n    Wb.toast('{#saveWarn2#}');\n    return;\n}\nvar getCount = gridCommon.getStore().getCount();\nif (getCount === 0) {\n    Wb.toast('{#saveWarn4#}');\n    return;\n}\nvar remove = gridCommon.getStore().getRemovedRecords();\nfor(var i = 0;i < remove.length;i++){\n    var deleteData =  {AP_INV_GL_L_ID : remove[i].data.AP_INV_GL_L_ID};\n    deleteDtl.push(deleteData);\n}\n//保存凭证的方法\nWb.request({\n    url: '{#contextPath#}' + '/apDocsAction.do?method=saveApInvGlAndVoucher',\n    //后台java代码生成凭证\n    method: 'POST',\n    async: false,\n    //异步传参\n    params : {'mainTabInfo' : Wb.encode(Wb.getValue(app.form1)),rowTabInfo : Wb.encode(Wb.getData(gridCommon)),deleteDtl : deleteDtl},\n    success: function(resp) {\n        var record= Wb.decode(resp.responseText);\n        var headId = record.headId;\n        var msg = record.msg;\n        if (record.flag == '0') {\n            Wb.toast('{#saveWarn3#}');\n            app.V_HEAD_ID.setValue(headId);\n            app.AP_INV_GL_H_CODE.setValue(record.apDocCode);\n            gridCommon.getStore().load({params: {AP_INV_GL_H_ID: app.AP_INV_GL_H_ID.getValue()}});\n            app.edit_v_xwl.v_head_id.setValue(headId);\n\n            //账薄、供应商、蓝字应付单设置为不可修改\n            setSomeReadOnly(true);\n            app.V_STATUS_NAME.setValue('{#1_STATUS#}');\n            app.V_STATUS.setValue('1');\n            Wb.isInsert = 'N';\n        }\n        if (record.flag == '1') {\n            Wb.toast(msg);\n        }\n        tableValue = Wb.encode(Wb.getValue(app.form1));\n        isEditCol = 'N';\n        loadInvoiceInfo();\n    }\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#verfyBtn#}","itemId":"verfyBtn","iconCls":"db_field_edit_icon"},"events":{"click":"var headId = app.V_HEAD_ID.getValue();\nif(app.V_STATUS.getValue() === '3'){\n    Wb.toast('{#verfyRec1#}');\n    return;\n}\nif(headId === '' || headId === null || tableValue !== Wb.encode(Wb.getValue(app.form1)) || isEditCol == 'Y'){\n    Wb.toast('{#verfyRec2#}');\n    return;\n}\n//账簿是否启用预算检查\nvar store = app.ldInitStore;\nvar idx = store.find('LEDGER_ID',app.LEDGER_ID_XWL.LEDGER_ID.getValue());\nvar rr = store.getAt(idx);\nvar BG_IS_CHK = rr.data.BG_IS_CHK;//预算检查：Y-是，N-否\nif(BG_IS_CHK === \"\" || BG_IS_CHK === null || BG_IS_CHK === undefined){\n    BG_IS_CHK = 'N' ;\n}\nif(app.SOURCE.getValue() != \"INV\"){//来源是发票的不需要做预算校验\n    var checkBudgetArray = [];\n    var checkParamJson = {isChkBg : BG_IS_CHK,apDocId:app.AP_INV_GL_H_ID.getValue(),apDocCat : \"YFD\"};\n    checkBudgetArray.push(checkParamJson);\n    //执行预算校验\n    Wb.request({\n        url : '{#contextPath#}' + '/apDocsAction.do?method=checkBudget',\n        params: Wb.apply({checkArray: checkBudgetArray}),\n        success : function(resp){\n            var response = Wb.decode(resp.responseText);\n            if(response.flag == \"0\"){\n                //执行阶段：BGCHK-预算校验,QRY-单据类型信息查询\n                var phase = response.phase;\n                if(phase === 'BGCHK'){\n                    //-1 校验不通过或者校验异常；0 校验通过；1校验不通过，但预算不是绝对控制，给出警告提示    \n                    var chkFlag = response.chkFlag;\n                    if(chkFlag === \"-1\"){\n                        Wb.toast(response.msg);\n                        return ;\n                    }\n                    else if(chkFlag === \"1\"){\n                        Ext.Msg.confirm('{#warning1#}',response.msg,function(id){\n                            if(id == 'yes'){\n                                verfyDoc();\n                            }\n                        });\n                    }\n                }\n                else{\n                    verfyDoc();\n                }\n            }\n            else{\n                Wb.toast(response.msg);\n            }\n        }\n    });\n}\nelse{\n\tverfyDoc();\n}\nfunction verfyDoc(){\n    var docArray = [] ;\n    var paramJson = {'headId' : app.V_HEAD_ID.getValue(),'apId':app.AP_INV_GL_H_ID.getValue(),apCatCode:'YFD'} ;\n    docArray.push(paramJson) ;\n    Wb.request({\n        url: '{#contextPath#}'+'/apVoucherAction.do?method=checkVoucher',\n        params: Wb.apply({apInfo: docArray}),\n        success: function(resp) {\n            var record = Wb.decode(resp.responseText);\n            var msg = record.msg;\n            if(record.flag === '0'){\n                app.V_STATUS_NAME.setValue('{#3_STATUS#}');\n                app.V_STATUS.setValue('3');\n                app.saveBtn.setDisabled(true);\n                app.verfyBtn.setDisabled(true);\n                if(app.INV_CANCEL_AMT.getValue() !== null && app.INV_CANCEL_AMT.getValue() !== '' && app.INV_CANCEL_AMT.getValue() !== 0 && app.CANCEL_AMT.getValue() === 0){\n                    Wb.confirm('{#verfyRec3#}',function(){\n\t\t\t\t\t\tapp.cancelBtn.fireEvent('click');\n                    });\n                }\n            }\n            Wb.toast(msg);\n            tableValue = Wb.encode(Wb.getValue(app.form1));\n        }\n\t});\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#cancelVerfyBtn#}","itemId":"cancelVerfyBtn","iconCls":"db_field_delete_icon"},"events":{"click":"var headId = app.V_HEAD_ID.getValue();\nif(headId === '' || headId === null){\n    Wb.toast('{#cancelVerfyRec1#}');\n    return;\n}\nif(app.V_STATUS.getValue() === '1'){\n    Wb.toast('{#cancelVerfyRec2#}');\n    return;\n}\nelse{\n//    Wb.request({\n//         url: 'm?xwl=xc/ap/gl/DB/XC_AP_INV_GL_H_IS_NEXT_BY_ONE',\n//         params: Wb.getValue(app.form1),\n//         success: function(resp) {\n            var docArray = [] ;\n            var paramJson = {'headId' : app.V_HEAD_ID.getValue(),'apId':app.AP_INV_GL_H_ID.getValue(),apCatCode:'YFD'} ;\n            docArray.push(paramJson) ;\n            Wb.request({\n                url: '{#contextPath#}'+'/apVoucherAction.do?method=cancelCheckVoucher',\n                params: Wb.apply({apInfo: docArray}),\n                success: function(resp) {\n                    var record = Wb.decode(resp.responseText);\n                    var msg = record.msg;\n                    if(record.flag === '0'){\n                        app.V_STATUS_NAME.setValue('{#1_STATUS#}');\n                        app.V_STATUS.setValue('1');\n                        app.saveBtn.setDisabled(false);\n                        app.verfyBtn.setDisabled(false);\n                    }\n                    Wb.toast(msg);\n                    tableValue = Wb.encode(Wb.getValue(app.form1));\n                }\n            });\n//         }\n//     });\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#cancelBtn#}","itemId":"cancelBtn","iconCls":"cancel_icon"},"events":{"click":"var r = Wb.getRefer(app.form1);\n\nif('3' > r.V_STATUS.getValue() || Wb.isEmpty(r.V_STATUS.getValue())){\n    Wb.toast('{#cancelPayRec1#}');\n    return null;\n}\nvar AP_INV_H_ID = r.AP_INV_H_ID.getValue();//发票ID\nWb.request({\n\turl : 'm?xwl=xc/ap/gl/DB/XC_AP_INV_GL_H_SELECT_BY_ID',\n    params : {AP_INV_GL_H_ID : r.AP_INV_GL_H_ID.getValue()},\n    success : function(resp){\n        var r = Wb.decode(resp.responseText);\n        if(r.CANCEL_AMT !== null && r.CANCEL_AMT !== '' && r.CANCEL_AMT !== 0){\n            AP_INV_H_ID = null;\n        }\n    }\n});\nWb.request({\n    url: 'm?xwl=xc/ap/gl/DB/XC_AP_INV_GL_H_PUB_ERROR_ALERT',\n    params: {\n        AP_INV_GL_H_ID: r.AP_INV_GL_H_ID.getValue(),\n        sql: 'select 1 FROM xc_ap_inv_gl_h WHERE AP_INV_GL_H_ID={?AP_INV_GL_H_ID?} AND NO_PAY_AMT=0',\n        errorMsg: '{#cancelPayRec1#}'\n    },\n    success: function(resp) {\n        Wb.run({\n            url: 'm?xwl=xc/ap/cancel/XC_AP_CANCEL_H_NO_C', \n            success: function(app) {\n                app.initWin({\n                    AP_CANCEL_H_ID:'',\n                    AP_INV_GL_H_ID:r.AP_INV_GL_H_ID.getValue(),\n                    AP_INV_H_ID:AP_INV_H_ID,\n                    IS_INSERT:'Y',\n                    flag:'cancel',\n                    AP_CANCEL_TYPE:'YFHYUF',\n                    AP_DOC_CAT_CODE:r.AP_DOC_CAT_CODE.getValue(),\n                    hideFun:function(){\n                        Wb.isInsert = 'N';\n                    }\n                });\n            }\n        });\n    }\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#payBtn#}","itemId":"payBtn","iconCls":"user_group_icon"},"events":{"click":"var ap_doc_cat_code = 'FKD_CGJS';\nvar r = Wb.getRefer(app.form1);\nif('3' > r.V_STATUS.getValue() || Wb.isEmpty(r.V_STATUS.getValue())){\n    Wb.toast('{#payRec1#}');\n    return null;\n}\nif (r.AP_DOC_CAT_CODE.getValue().indexOf('-H') != -1) {\n    ap_doc_cat_code = 'FKD_CGJS-H';\n}\nWb.request({\n    url: 'm?xwl=xc/ap/gl/DB/XC_AP_INV_GL_H_PUB_ERROR_ALERT',\n    params: {\n        AP_INV_GL_H_ID: r.AP_INV_GL_H_ID.getValue(),\n        sql: 'select 1 FROM xc_ap_inv_gl_h WHERE AP_INV_GL_H_ID={?AP_INV_GL_H_ID?} AND (ABS(NO_PAY_AMT)-ABS(OCCUPY_AMT))<=0',\n        errorMsg: '{#payRec2#}'\n    },\n    success: function(resp) {\n        Wb.run({\n            url: 'm?xwl=xc/ap/pay/XC_AP_PAY_H_NO_C',\n            success: function(app) {\n                app.initWin({\n                    AP_PAY_H_ID: '',\n                    H_AP_INV_GL_H_ID: r.AP_INV_GL_H_ID.getValue(),\n                    IS_INSERT: 'Y',\n                    flag: 'payAll',\n                    AP_DOC_CAT_CODE: ap_doc_cat_code,\n                    hideFun: function() {\n                        Wb.docCatCode = ((ap_doc_cat_code == 'FKD_CGJS') ? 'YFD' : 'YFD-H');\n                        Wb.isInsert = 'N';\n                    }\n                });\n            }\n        });\n    }\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#invGlBtn#}","itemId":"invGlBtn","iconCls":"record_delete_icon"},"events":{"click":"var r = Wb.getRefer(app.form1);\nif('3' > r.V_STATUS.getValue() || Wb.isEmpty(r.V_STATUS.getValue())){\n    Wb.toast('{#invGLRec1#}');\n    return null;\n}\nif (r.AP_DOC_CAT_CODE.getValue() == 'YFD') {\n    Wb.request({\n        url: 'm?xwl=xc/ap/gl/DB/XC_AP_INV_GL_H_PUB_ERROR_ALERT',\n        params: {\n            sql: 'SELECT 1 FROM xc_ap_inv_gl_h WHERE AP_INV_GL_H_ID={?AP_INV_GL_H_ID?} AND NO_PAY_AMT=0',\n            errorMsg: '{#invGLRec2#}',\n            AP_INV_GL_H_ID: r.AP_INV_GL_H_ID.getValue()\n        },\n        success: function(resp) {\n            Wb.run({\n                url: 'm?xwl=xc/ap/gl/XC_AP_INV_GL_H_NO_C',\n                success: function(app) {\n                    app.initWin({\n                        AP_CANCEL_H_ID: '',\n                        H_AP_INV_GL_H_ID: r.AP_INV_GL_H_ID.getValue(),\n                        IS_INSERT: 'Y',\n                        flag:'inv_h',\n                        AP_DOC_CAT_CODE: r.AP_DOC_CAT_CODE.getValue() + '-H',\n                        hideFun: function() {\n                            Wb.docCatCode = 'YFD';\n                            Wb.isInsert = 'N';\n                        }\n                    });\n                }\n            });\n        }\n    });\n}\nelse {\n    Wb.toast('{#invGLRec3#}');\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#payListBtn#}","itemId":"payListBtn"},"events":{"click":"var apInvGlHId = app.AP_INV_GL_H_ID.getValue();\n\nif(Wb.isInsert != 'N'){\n    Wb.toast('{#payList1#}');\n    return null;\n}\nWb.run({\n    url: 'm?xwl=xc/ap/trans/XC_AP_INV_TRANS_ALL', \n    success: function(app) {\n        app.initWin({\n            SOURCE_ID:apInvGlHId,\n            AP_INV_GL_H_ID:apInvGlHId,\n            QUERY_FROM:'YFD'\n        });\n    }\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#enclosureBtn#}","itemId":"enclosureBtn","iconCls":"attach_icon"},"events":{"click":"if(Wb.isInsert=='Y'){\n    Wb.toast('{#enclosureWarn1#}');\n    return false;\n}\nvar temp_id = app.AP_INV_GL_H_ID.getValue();\nvar temp_code = app.AP_DOC_CAT_CODE.getValue();\nWb.request({\n    url : '{#contextPath#}' + '/apDocsAction.do?method=getApAttCatCode',\n    params : {LEDGER_ID : app.LEDGER_ID_XWL.LEDGER_ID.getValue(),AP_DOC_CAT_CODE : app.AP_DOC_CAT_CODE.getValue()},\n    success : function(resp){\n        var temp = Wb.decode(resp.responseText);\n        if(temp.flag == '0'){\n            var attCatCode = temp.attCatCode;\n            Xip.showAttachmentManager('{#XIP.userId#}',temp_id,'',attCatCode,temp_code,'Y','Y','Y',function(){},10); \n        }\n    }\n});"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"maximized":"true","height":"600","width":"1000","layout":"fit","closeAction":"hide","itemId":"editWinN"},"events":{"hide":"app.hideFun();"},"children":[{"configs":{"itemId":"tabs"},"events":{"beforerender":"app.edit_v_xwl.xwl_v_panel.setTitle('{#VOUCHER#}');","beforetabchange":"//加载凭证信息\nif(newCard.title === app.edit_v_xwl.xwl_v_panel.title){\n    Wb.request({\n        url: 'm?xwl=xc/gl/journal/data-db/common-data/select-v-head',\n        params: {'headId' : app.V_HEAD_ID.getValue()},\n        success: function(resp) {\n            var headJson = Wb.decode(resp.responseText);\n            Wb.setValue(app.edit_v_xwl.form1,headJson);\n            Wb.setValue(app.edit_v_xwl.bbar,headJson);\n            //处理会计日期\n            var accDate = headJson.accountDate;\n            app.edit_v_xwl.accountDate.setValue(Wb.strToDate(accDate));\n        }\n    });\n    // 加载凭证分录行\n    app.edit_v_xwl.grid1.getStore().load({params :{'headId':app.V_HEAD_ID.getValue()}});\n}"},"children":[{"configs":{"title":"{#INVOICE#}","layout":"fit","itemId":"tab0"},"children":[{"configs":{"file":"m?xwl=xc/ap/inv/XC_AP_INVOICE_H_VIEW","itemId":"xwl1"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"title":"{#INV_GL#}","layout":"border","itemId":"tab1"},"events":{"activate":"if (Wb.isInsert == 'F' || Wb.isInsert == 'S' || Wb.apInvHId !== null) {\n    setAllReadOnly(true);\n    if (Wb.isInsert == 'F'){\n        app.AMOUNT_COL.getEditor().setReadOnly(true);\n        app.QTY_COL.getEditor().setReadOnly(true);\n        app.DIM_NAME_COL.getEditor().setReadOnly(true);\n        app.BG_ITEM_NAME_COL.getEditor().setReadOnly(true);\n        Wb.isInsert = 'Y';\n    }\n    if(Wb.apInvHId !== null){\n        app.AMOUNT_COL.getEditor().setReadOnly(true);\n        app.QTY_COL.getEditor().setReadOnly(true);\n        app.DIM_NAME_COL.getEditor().setReadOnly(true);\n        app.BG_ITEM_NAME_COL.getEditor().setReadOnly(true);\n    }\n    if (Wb.isInsert == 'S'){\n        setSeekReadOnly(true);\n    }\n}"},"children":[{"configs":{"region":"north","tbar":"app.form1Tbar","border":"false","itemId":"form1"},"children":[{"configs":{"layout":"column","margin":"10 0 10 0","border":"false","itemId":"tr0"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".52","itemId":"td_0_1"},"children":[{"configs":{"style":"fontSize:20px","html":"<font style=\"\">应付单<\/font>","labelAlign":"right","itemId":"title"},"children":[],"expanded":false,"type":"label"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".31","itemId":"td_0_2"},"children":[{"configs":{"itemId":"emptyLabel"},"children":[],"expanded":false,"type":"label"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".148","itemId":"td_0_3"},"children":[{"configs":{"labelWidth":"80","allowBlank":"false","minValue":"0","value":"0","fieldStyle":"color:red;direction:rtl;","labelAlign":"right","itemId":"V_ATTCH_TOTAL","fieldLabel":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#V_ATTCH_TOTAL#}"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"layout":"column","margin":"5 0 0 0","border":"false","itemId":"tr1"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_1_1"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/LEDGER_ID_PICK/LEDGER_ID_PICK_SEC","itemId":"LEDGER_ID_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_1_2"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","pickList":"[\n  ['YFD','{#yfd#}'],\n  ['YFD-H','{#yfdH#}'],\n]","labelAlign":"right","itemId":"AP_DOC_CAT_CODE","fieldLabel":"{#AP_DOC_CAT_CODE#}"},"events":{"change":"if(newValue=='YFD-H'){\n    app.title.setText('<font style=\"color:red;\">{#yfd#}<\/font>',false);\n    app.AP_INV_GL_H_ID_XWL.QUERY_AP_DOC_CAT_CODE.setValue('YFD');\n}\nelse{\n    app.title.setText('{#yfd#}',false);\n}"},"children":[],"expanded":false,"type":"combo"},{"configs":{"labelWidth":"80","readOnly":"true","displayField":"VAL_NAME","hidden":"true","valueField":"VAL_CODE","labelAlign":"right","itemId":"AP_DOC_CAT_CODE1","fieldLabel":"{#AP_DOC_CAT_CODE#}"},"events":{"change":"if(newValue=='YFD-H'){\n    app.title.setText('<font style=\"color:red;\">{#yfd#}<\/font>',false);\n    app.AP_INV_GL_H_ID_XWL.QUERY_AP_DOC_CAT_CODE.setValue('YFD');\n}\nelse{\n    app.title.setText('{#yfd#}',false);\n}"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/ap/gl/DB/XC_AP_YFD_CLASS_SELECT"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_1_3"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","emptyText":"{#SystemAutomaticGeneration#}","labelAlign":"right","itemId":"AP_INV_GL_H_CODE","fieldLabel":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#AP_INV_GL_H_CODE#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_1_4"},"children":[{"configs":{"labelWidth":"80","allowBlank":"false","labelAlign":"right","itemId":"GL_DATE","fieldLabel":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#GL_DATE#}"},"children":[],"expanded":false,"type":"date"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"layout":"column","margin":"5 0 0 0","border":"false","itemId":"tr2"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_2_1"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/VENDOR_ID_PICK/VENDOR_ID_LD","itemId":"VENDOR_ID_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","hidden":"true","layout":"form","columnWidth":".245","itemId":"td_2_2"},"children":[{"configs":{"file":"m?xwl=xc/ap/ap-com-lov/AP_INV_GL_H_ID_PICK/AP_INV_GL_H_ID_PICK_GL_L","itemId":"AP_INV_GL_H_ID_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_2_3"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/DEPT_ID_PICK/DEPT_ID_LD","itemId":"DEPT_ID_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_2_4"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/PROJECT_ID_PICK/PROJECT_ID_LD","itemId":"PROJECT_ID_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"layout":"column","margin":"5 0 0 0","border":"false","itemId":"tr3"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_3_1"},"children":[{"configs":{"file":"m?xwl=xc/ap/ap-com-lov/AP_CONTRACT_ID_PICK/AP_CONTRACT_ID_PICK_ALL","itemId":"AP_CONTRACT_ID_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_3_2"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"INV_AMOUNT","fieldLabel":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#INV_AMOUNT#}"},"children":[],"expanded":false,"type":"number"},{"configs":{"labelWidth":"80","readOnly":"true","hidden":"true","labelAlign":"right","itemId":"AMOUNT","fieldLabel":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#AMOUNT#}"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_3_3"},"children":[{"configs":{"tagConfigs":"baseChars:\"-.0123456789\"","labelWidth":"80","labelAlign":"right","itemId":"TAX_AMT","fieldLabel":"{#TAX_AMT#}"},"events":{"afterrender":"if(Wb.docCatCode == 'YFD-H'){\n    number.setMaxValue(0);\n}else{\n    number.setMinValue(0);\n}","change":"if(number.getValue() !== null || number.getValue() !== ''){\n    app.AP_ACC_ID_TAX_XWL.AP_ACC_NAME_TAX.allowBlank = false;\n    app.AP_ACC_ID_TAX_XWL.AP_ACC_NAME_TAX.show();\n//     app.TAX_RATE.setFieldLabel('<span style=\"color: rgb(255, 0, 0);\">*<\/span>税率(%)');\n//     app.AP_ACC_ID_TAX_XWL.AP_ACC_NAME_TAX.setFieldLabel('<span style=\"color: rgb(255, 0, 0);\">*<\/span>进项税科目');\n    app.TAX_RATE.allowBlank = false;\n    app.TAX_RATE.show();\n//     app.AP_ACC_ID_TAX_XWL.AP_ACC_NAME_TAX.setReadOnly(false);\n}\nif(number.getValue() === null || number.getValue() === 0){\n    app.AP_ACC_ID_TAX_XWL.AP_ACC_NAME_TAX.reset();\n    app.AP_ACC_ID_TAX_XWL.AP_ACC_ID_TAX.reset();\n    app.AP_ACC_ID_TAX_XWL.AP_ACC_NAME_TAX.allowBlank = true;\n    app.AP_ACC_ID_TAX_XWL.AP_ACC_NAME_TAX.hide();\n    app.TAX_RATE.allowBlank = true;\n    app.TAX_RATE.hide();\n//     app.AP_ACC_ID_TAX_XWL.AP_ACC_NAME_TAX.setReadOnly(true);\n}","blur":"if(number.getValue() === 0){\n    number.reset();\n}"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_3_4"},"children":[{"configs":{"labelWidth":"80","hidden":"true","minValue":"0","labelAlign":"right","allowDecimals":"false","itemId":"TAX_RATE","fieldLabel":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#TAX_RATE#}(%)","maxValue":"17"},"events":{"blur":"if(number.getValue()>number.maxValue){\n  number.setValue('');\n}"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"layout":"column","margin":"5 0 0 0","border":"false","itemId":"tr4"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_4_1"},"children":[{"configs":{"labelWidth":"80","allowBlank":"false","labelAlign":"right","itemId":"DESCRIPTION","fieldLabel":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#DESCRIPTION#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_4_2"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"INV_NO","fieldLabel":"{#INV_NO#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_4_3"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","hidden":"true","labelAlign":"right","itemId":"INV_CANCEL_AMT","fieldLabel":"{#INV_CANCEL_AMT#}"},"children":[],"expanded":false,"type":"number"},{"configs":{"labelWidth":"80","readOnly":"true","hidden":"true","labelAlign":"right","itemId":"NO_PAY_AMT","fieldLabel":"{#NO_PAY_AMT#}"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_4_4"},"children":[{"configs":{"file":"m?xwl=xc/ap/ap-com-lov/ACC_ID_PICK/AP_ACC_ID_DEBT","itemId":"AP_ACC_ID_DEBT_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_4_5"},"children":[{"configs":{"file":"m?xwl=xc/ap/ap-com-lov/ACC_ID_PICK/AP_ACC_ID_TAX","itemId":"AP_ACC_ID_TAX_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"hidden":"true","layout":"column","margin":"5 0 0 0","border":"false","itemId":"tr5"},"children":[],"expanded":true,"type":"panel"},{"configs":{"layout":"column","margin":"5 0 5 0","border":"false","itemId":"tr6"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_6_1"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","value":"{#XIP.empName#}","labelAlign":"right","itemId":"CREATED_BY_NAME","fieldLabel":"{#CREATED_BY_NAME#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_6_2"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"V_STATUS_NAME","fieldLabel":"{#V_STATUS_NAME#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_6_3"},"children":[{"configs":{"labelWidth":"80","value":"TEMP","pickList":"[\n  ['GL','{#SOURCE_INV_GL#}'],\n  ['INV','{#SOURCE_INV#}'],\n  ['TEMP','{#SOURCE_TEMP#}']\n]","labelAlign":"right","itemId":"SOURCE","fieldLabel":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#SOURCE#}","editable":"false"},"events":{"change":"app.td_2_2.hide();\napp.purTypeBtn.hide();\nif(newValue=='GL'){\n\tapp.td_2_2.show();\n    app.cancelBtn.hide();\n    app.payBtn.hide();\n    if (Wb.isEmpty(Wb.h_ap_inv_gl_h_id) && Wb.isInsert == 'Y'){\n        clearAll();\n    }\n}\nif(newValue=='TEMP'){\n\tapp.purTypeBtn.show();\n    app.cancelBtn.show();\n    app.payBtn.show();\n    if(app.AP_INV_GL_H_ID_XWL.L_AP_INV_GL_H_CODE.getValue() !== null && app.AP_INV_GL_H_ID_XWL.L_AP_INV_GL_H_CODE.getValue() !== ''){\n        if (Wb.isEmpty(Wb.h_ar_inv_gl_h_id) && Wb.isInsert == 'Y'){  \n            clearAll();\n            setMaxOrMinValue(null);\n        }\n    }\n}\napp.AP_INV_GL_H_ID_XWL.L_AP_INV_GL_H_ID.reset();\napp.AP_INV_GL_H_ID_XWL.L_AP_INV_GL_H_CODE.reset();\napp.grid1.getStore().reload(\n  {\n    params:{\n        AP_INV_GL_H_ID:app.AP_INV_GL_H_ID.getValue()\n      }\n  }\n);"},"children":[],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"hidden":"true","itemId":"hidden_p"},"children":[{"configs":{"itemId":"V_STATUS","fieldLabel":"凭证状态"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"AP_INV_GL_H_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"AP_INV_H_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","value":"{#XIP.userId#}","itemId":"USER_ID","fieldLabel":"USER_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"V_HEAD_ID","fieldLabel":"凭证头ID"},"children":[],"expanded":true,"type":"text"},{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"CANCEL_AMT","fieldLabel":"核销金额"},"children":[],"expanded":false,"type":"number"},{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"PAID_AMT","fieldLabel":"已收金额"},"children":[],"expanded":false,"type":"number"},{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"ADJ_AMT","fieldLabel":"调整金额"},"children":[],"expanded":false,"type":"number"},{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"REQ_AMT","fieldLabel":"申请金额"},"children":[],"expanded":false,"type":"number"},{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"NO_REQ_AMT","fieldLabel":"未申请金额"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"form"},{"configs":{"region":"center","selType":"checkboxmodel","barExportButtons":"false","barExportAllButtons":"false","itemId":"grid1","editable":"true"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/ap/gl/DB/XC_AP_INV_GL_L_SELECT"},"events":{"update":"isEditCol = 'Y';","remove":"isEditCol = 'Y';","add":"isEditCol = 'Y';"},"children":[],"expanded":false,"type":"store"},{"configs":{"normalName":"grid1Tbar","itemId":"tbar"},"children":[{"configs":{"text":"{#purTypeBtn#}","itemId":"purTypeBtn","iconCls":"select_all_icon"},"events":{"click":"var invGlHId = app.AP_INV_GL_H_ID.getValue();\nvar ledgerId = app.LEDGER_ID_XWL.LEDGER_ID.getValue();\nvar P_DESCRIPTION = app.DESCRIPTION.getValue();\nif(Wb.isEmpty(ledgerId)){\n\tWb.toast('{#selectInfo1#}');\n    return false;\n}\n//设置数量\nvar tempQty = 1;\nif (Wb.docCatCode == 'YFD-H') {\n\ttempQty = -1;  \n}\nvar curGrid = gridCommon;\nWb.run({\n    url: 'm?xwl=xc/ap/gl/LOV/LOV_XC_AP_PUR_TYPE', \n    params:{docCatCode:Wb.docCatCode},//发票类型\n    success: function(app) {\n      app.initWin({\n          LEDGER_ID:ledgerId,\n          hideFun:function(rs){\n              Wb.each(rs, function(r) {\n                  r.set('AP_INV_GL_L_ID',Xip.getId());\n                  r.set('AP_INV_GL_H_ID',invGlHId);\n                  r.set('QTY',tempQty);\n                  var grid1Store = curGrid.getStore();\n                  if(grid1Store.getCount() > 0){\n                      r.set('DIM_CODE',grid1Store.getAt(0).get('DIM_CODE'));\n                      r.set('DIM_NAME',grid1Store.getAt(0).get('DIM_NAME'));\n                  }\n                  for(var i=0;i<grid1Store.getCount();i++){\n                      var gr = grid1Store.getAt(i);\n                      if(gr.get('AP_PUR_TYPE_ID')==r.get('AP_PUR_TYPE_ID')){\n//                           return false;\n                          curGrid.getStore().removeAt(i);\n                      }\n                  }\n                  Wb.add(curGrid, {\n                      AP_INV_GL_L_ID:null,\n                      AP_INV_GL_H_ID:r.get('AP_INV_GL_H_ID'),\n                      L_AP_INV_GL_H_CODE:r.get('L_AP_INV_GL_H_CODE'),\n                      AP_PUR_TYPE_ID:r.get('AP_PUR_TYPE_ID'),\n                      AP_PUR_TYPE_NAME:r.get('AP_PUR_TYPE_NAME'),\n                      BG_ITEM_ID:r.get('BG_ITEM_ID'),\n                      BG_ITEM_NAME:r.get('BG_ITEM_NAME'),\n                      DEPT_ID:r.get('DEPT_ID'),\n                      DEPT_NAME:r.get('DEPT_NAME'),\n                      PROJECT_ID:r.get('PROJECT_ID'),\n                      PROJECT_NAME:r.get('PROJECT_NAME'),\n                      ACC_ID:r.get('AP_ACC_ID_INV'),\n                      ACC_NAME:r.get('ACC_NAME'),\n                      DIM_CODE:r.get('DIM_CODE'),\n                      DIM_NAME:r.get('DIM_NAME'),\n                      CCID:r.get('CCID'),\n                      AMOUNT:r.get('PAY_AMT'),\n                      QTY:r.get('QTY'),\n                      DESCRIPTION:P_DESCRIPTION\n                  }, 'after', 1, false);\n              });\n          }\n      });\n    }\n});\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#delBtn#}","itemId":"delBtn","iconCls":"file_delete_icon"},"events":{"click":"/**\n*\tupdate：panghd date：20160510\n*\t删除原则，先将选中记录在表格中移除，点击主单保存时，才真正从数据库删除。\n**/\nvar recs = app.grid1.getSelection();\nif (!recs.length) {\n    Wb.toast('{#deleteRec#}');\n    return;\n}\n\nWb.confirm('{#confirm2#} ' + recs.length + ' {#confirm#}', function() {\n\tWb.remove(app.grid1, recs);\n});"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"<font color=\"red\">*<\/font>{#AP_PUR_TYPE_NAME#}","width":"150","dataIndex":"AP_PUR_TYPE_NAME","titleAlign":"center","itemId":"AP_PUR_TYPE_NAME_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"<font color=\"red\">*<\/font>{#ACC_NAMES#}","width":"150","dataIndex":"ACC_NAME","titleAlign":"center","itemId":"ACC_NAME_COL"},"children":[{"configs":{"labelWidth":"100","allowBlank":"false","labelAlign":"right","normalName":"ACC_NAME_PICK","itemId":"editor"},"children":[{"configs":{"tagConfigs":"minWidth:400","height":"300","itemId":"pickComp"},"events":{"itemdblclick":"var r=app.grid1.getSelectionModel().getSelection()[0];\nr.set('ACC_ID',record.data.ACC_ID);\nr.set('ACC_NAME',record.data.ACC_NAME);\nr.set('CCID',null) ;    \nr.set('CCID_NAME',null);\nr.dirty = true;\napp.ACC_NAME_PICK.setValue(record.data.ACC_NAME);\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/com-lov/ACC_ID_PICK/DB/XC_BG_LD_ACCOUNTS_SELECT_LD"},"events":{"beforeload":"operation.params = Wb.getValue([app.form1,app.tbar]);"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","dataIndex":"ACC_ID","itemId":"ACC_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#ACC_CODE_COLS#}","dataIndex":"ACC_CODE","itemId":"ACC_CODE_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#ACC_NAME_COLS#}","dataIndex":"ACC_NAME","itemId":"ACC_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"100","emptyText":"{#ACC_CODE_NAMES#}","labelAlign":"right","itemId":"QUERY_CODE_NAME"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.pickComp.getStore().load();\n}"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"searchButton","iconCls":"seek_icon"},"events":{"click":"app.pickComp.getStore().load();"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":false,"type":"column"},{"configs":{"text":"{#CCID_NAME#}","width":"200","dataIndex":"CCID_NAME","titleAlign":"center","normalName":"CCID_NAME_PICK","itemId":"CCID_NAME_COL"},"children":[{"configs":{"displayField":"CCID_NAME","triggerCls":"x-form-search-trigger","valueField":"CCID","itemId":"editor","onTriggerClick":"  // 账簿\n  var ledgerId = app.LEDGER_ID_XWL.LEDGER_ID.getValue() ;\n  if(ledgerId === \"\" ||ledgerId === null || ledgerId === undefined){\n    Wb.info('请选择账簿!') ;\n    return false ;\n  }\n  \n  // 会计日期\n  var accDate = app.GL_DATE.getValue() ;\n  if(accDate === \"\" ||accDate === null || accDate === undefined){\n    Wb.info('请选择会计日期!') ;\n    return false ;\n  }else{\n\taccDate = Wb.dateToStr(accDate).substring(0,7);\n  }\n  \n  // TODO: 当前选中\n  var r = app.grid1.getSelection()[0] ; \n  \n  // TODO: 显示科目选择窗口\n  Wb.run({\n    url:'m?xwl=xc/gl/journal/v-windows/handler-ccid-win',\n    params : {\n      'ledgerId' : ledgerId,\n      'vtype' : '{#vtype#}'\n    },          \n    success:function(appObj){\n      appObj.initWindow({\n        accName : r.data.ACC_NAME,\n        ledgerId : ledgerId,\n        periodCode : accDate ,\n        groupId : 'ALL',\n        handlerCCID : function(returnObj){\n          // TODO: 处理CCID信息\n          var rObj = Wb.decode(returnObj) ;\n          r.set('ACC_ID', rObj.acc_id) ;    \n          r.set('ACC_NAME', rObj.acc_name);\n          r.set('CCID', rObj.acc_ccid) ;    \n          r.set('CCID_NAME', rObj.acc_ccid_name);\n          if(!Wb.isEmpty(rObj.dim_id)){\n          r.set('DIM_ID', rObj.dim_id) ;\n          r.set('DIM_NAME', rObj.dim_name) ;\n          }\n          // 禁用账簿\n           app.LEDGER_ID_XWL.LEDGER_ID.setReadOnly(true) ;\n        }\n      });\n    }  \n  }) ;   "},"events":{"change":"if(newValue === null || newValue === ''){\n    var r = app.grid1.getSelection()[0]; \n    r.set('CCID',null);   \n}","beforequery":"var combo = e.combo;\nif(!e.forceAll){\n  var value = e.query;\n  combo.store.filterBy(function(record,id){\n    var text = record.get(combo.displayField);\n    return (text.indexOf(value)!=-1);\n  });\n  combo.expand();\n  return false;\n}","specialkey":"// TODO: 按回车键执行借方和贷方金额切换\nif (e.getKey() == e.ENTER) {\n  // 账簿\n  var ledgerId = app.LEDGER_ID_XWL.LEDGER_ID.getValue() ;\n  if(ledgerId === \"\" ||ledgerId === null || ledgerId === undefined){\n    Wb.info('请选择账簿!') ;\n    return false ;\n  }\n  \n  // 会计日期\n  var accDate = app.GL_DATE.getValue();\n  if(accDate === \"\" ||accDate === null || accDate === undefined){\n    Wb.info('请选择会计日期!') ;\n    return false ;\n  }else{\n    accDate = Wb.dateToStr(accDate).substring(0,7);\n  }\n  \n  // TODO: 当前选中\n  var r = app.grid1.getSelection()[0] ; \n  \n  // TODO: 显示科目选择窗口\n  Wb.run({\n    url:'m?xwl=xc/gl/journal/v-windows/handler-ccid-win',\n    params : {\n      'ledgerId' : ledgerId ,\n      'vtype' : '{#vtype#}'\n    },          \n    success:function(appObj){\n      appObj.initWindow({\n        accName : r.data.ACC_NAME,\n        ledgerId : ledgerId,\n        periodCode : accDate ,\n        groupId : 'ALL',\n        handlerCCID : function(returnObj){\n          // TODO: 处理CCID信息\n          var rObj = Wb.decode(returnObj) ;\n          r.set('ACC_ID', rObj.acc_id) ;    \n          r.set('ACC_NAME', rObj.acc_name);\n          r.set('CCID', rObj.acc_ccid) ;    \n          r.set('CCID_NAME', rObj.acc_ccid_name);\n          if(!Wb.isEmpty(rObj.dim_id)){\n          r.set('DIM_ID', rObj.dim_id) ;\n          r.set('DIM_NAME', rObj.dim_name) ;\n          }\n          // 禁用账簿\n           app.LEDGER_ID_XWL.LEDGER_ID.setReadOnly(true) ;\n        }\n      });\n    }  \n  }) ;   \n}"},"children":[],"expanded":true,"type":"combo"}],"expanded":false,"type":"column"},{"configs":{"text":"{#BG_ITEM_NAME#}","width":"150","dataIndex":"BG_ITEM_NAME","titleAlign":"center","itemId":"BG_ITEM_NAME_COL"},"children":[{"configs":{"labelWidth":"100","labelAlign":"right","normalName":"BG_ITEM_PICK","itemId":"editor"},"events":{"expand":"app.pickComp.getStore().load();"},"children":[{"configs":{"tagConfigs":"minWidth:400","height":"300","barExportButtons":"false","barExportAllButtons":"false","itemId":"pickComp"},"events":{"itemdblclick":"var r=app.grid1.getSelectionModel().getSelection()[0];\nr.set('BG_ITEM_ID',record.data.BG_ITEM_ID);\nr.set('BG_ITEM_NAME',record.data.BG_ITEM_NAME);\napp.BG_ITEM_PICK.setValue(record.data.BG_ITEM_NAME);\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/com-lov/BG_ITEM_ID_PICK/DB/XC_BG_ITEMS_LD_SELECT"},"events":{"beforeload":"operation.params = Wb.getValue([app.form1,app.tbar]);"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","dataIndex":"BG_ITEM_ID","itemId":"BG_ITEM_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#BG_ITEM_CODE_COL#}","dataIndex":"BG_ITEM_CODE","itemId":"BG_ITEM_CODE_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#BG_ITEM_CODE_COL#}","dataIndex":"BG_ITEM_NAME","itemId":"BG_ITEM_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"100","emptyText":"{#BG_ITEM_CODE_NAME#}","labelAlign":"right","itemId":"QUERY_CODE_NAME"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.searchButton.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"searchButton","iconCls":"seek_icon"},"events":{"click":"app.pickComp.getStore().load();"},"children":[],"expanded":false,"type":"button"},{"configs":{"itemId":"cancelBtn","iconCls":"delete_icon"},"events":{"click":"var r=app.grid1.getSelectionModel().getSelection()[0];\nr.set('BG_ITEM_ID',null);\nr.set('BG_ITEM_NAME',null);\napp.BG_ITEM_PICK.setValue(null);\napp.BG_ITEM_PICK.getPicker().hide();"},"children":[],"expanded":false,"type":"item"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":false,"type":"column"},{"configs":{"text":"<font color=\"red\">*<\/font>{#AMOUNT#}","align":"right","width":"100","dataIndex":"AMOUNT","format":"0,000.00","titleAlign":"center","itemId":"AMOUNT_COL","renderer":"if (app.AP_DOC_CAT_CODE.getValue() == 'YFD-H') {\n    value = '<font color=red>'+Wb.format(value,'0,000.00')+'<\/font>';\n}\nelse {\n    value = Wb.format(value,'0,000.00');\n}\nreturn value;"},"children":[{"configs":{"allowBlank":"false","itemId":"editor"},"events":{"afterrender":"if(Wb.docCatCode == 'YFD-H'){\n    number.setMaxValue(0);\n    number.setFieldStyle('color:red;');\n}else{\n    number.setMinValue(0);\n}","blur":"if(number.getValue()===0){\n  number.setValue('');\n}"},"children":[],"expanded":false,"type":"number"}],"expanded":false,"type":"column"},{"configs":{"text":"<font color=\"red\">*<\/font>{#QTY#}","align":"right","width":"80","dataIndex":"QTY","titleAlign":"center","itemId":"QTY_COL","renderer":"if (app.AP_DOC_CAT_CODE.getValue() == 'YFD-H') {\n    value = '<font color=red>'+value+'<\/font>';\n}\nelse {\n    value = value;\n}\nreturn value;"},"children":[{"configs":{"decimalPrecision":"6","allowBlank":"false","itemId":"editor"},"events":{"afterrender":"if(Wb.docCatCode == 'YFD-H'){\n    number.setMaxValue(0);\n    number.setFieldStyle('color:red;');\n}else{\n    number.setMinValue(0);\n}","blur":"if(number.value === 0){\n\tnumber.setValue(null);\n    return;\n}"},"children":[],"expanded":false,"type":"number"}],"expanded":false,"type":"column"},{"configs":{"text":"{#DIM_CODE#}","hidden":"true","dataIndex":"DIM_CODE","itemId":"DIM_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"<font color=\"red\">*<\/font>{#DIM_NAME#}","width":"80","dataIndex":"DIM_NAME","titleAlign":"center","itemId":"DIM_NAME_COL"},"children":[{"configs":{"labelWidth":"80","allowBlank":"false","labelAlign":"right","normalName":"DIM_NAME_PICK","itemId":"editor"},"events":{"expand":"app.pickComp.getStore().load();"},"children":[{"configs":{"tagConfigs":"minWidth:400","height":"300","barExportButtons":"false","barExportAllButtons":"false","itemId":"pickComp"},"events":{"itemdblclick":"var r=app.grid1.getSelectionModel().getSelection()[0];\nr.set('DIM_CODE',record.data.DIM_CODE);\nr.set('DIM_NAME',record.data.DIM_NAME);\napp.DIM_NAME_PICK.setValue(record.data.DIM_NAME);\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/ap/inv/DB/XC_GL_DIMENSIONS_SELECT"},"events":{"beforeload":"operation.params = Wb.getValue(app.tbar);"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","dataIndex":"DIM_ID","itemId":"DIM_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#DIM_CODE_COL#}","dataIndex":"DIM_CODE","itemId":"DIM_CODE_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#DIM_NAME_COL#}","dataIndex":"DIM_NAME","itemId":"DIM_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"100","emptyText":"{#DIM_CODE_NAME#}","labelAlign":"right","itemId":"QUERY_CODE_NAME"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.pickComp.getStore().load();\n}"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"searchButton","iconCls":"seek_icon"},"events":{"click":"app.pickComp.getStore().load();"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":false,"type":"column"},{"configs":{"text":"<font color=\"red\">*<\/font>{#DESCRIPTION#}","width":"300","dataIndex":"DESCRIPTION","titleAlign":"center","itemId":"DESCRIPTION_COL"},"children":[{"configs":{"allowBlank":"false","itemId":"editor"},"children":[],"expanded":false,"type":"text"}],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"},{"configs":{"region":"center","selType":"checkboxmodel","hidden":"true","barExportButtons":"false","barExportAllButtons":"false","itemId":"grid2","editable":"true"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/ap/gl/DB/XC_AP_INV_GL_L_SELECT"},"events":{"update":"isEditCol = 'Y';","remove":"isEditCol = 'Y';","add":"isEditCol = 'Y';"},"children":[],"expanded":false,"type":"store"},{"configs":{"normalName":"grid2Tbar","itemId":"tbar"},"children":[{"configs":{"text":"{#poOrderBtn#}","itemId":"poOrderBtn","iconCls":"db_form_add_icon"},"events":{"click":"var invHId = app.AP_INV_H_ID.getValue();\nvar ledgerId = app.LEDGER_ID_XWL.LEDGER_ID.getValue();\nif(Wb.isEmpty(ledgerId)){\n\tWb.toast('{#selectInfo1#}');\n    return false;\n}\n//设置数量\nvar curGrid = app.grid2;\nWb.run({\n    url: 'm?xwl=xc/ap/inv/LOV/XC_PO_ORDER_L_LOV', \n    params:{docCatCode:Wb.docCatCode},//发票类型\n    success: function(apps) {\n        apps.initWin({\n            AP_DOC_CAT_CODE:'',\n            LEDGER_ID:ledgerId,\n            VENDOR_ID:app.VENDOR_ID_XWL.VENDOR_ID.getValue(),\n            hideFun:function(rs){\n                Wb.each(rs, function(r) {\n                    r.set('AP_INV_H_ID',invHId);\n\n                    var grid2Store = curGrid.getStore();\n                    if(grid2Store.getCount() > 0){\n                        r.set('DIM_CODE',grid2Store.getAt(0).get('DIM_CODE'));\n                        r.set('DIM_NAME',grid2Store.getAt(0).get('DIM_NAME'));\n                    }\n                    for(var i=0;i<grid2Store.getCount();i++){\n                        var gr = grid2Store.getAt(i);\n                        if(gr.get('ORDER_L_ID')==r.get('ORDER_L_ID')){\n                            curGrid.getStore().removeAt(i);\n                        }\n                    }\n                    Wb.add(curGrid, {\n                        AP_INV_L_ID:null,\n                        AP_INV_H_ID:app.AP_INV_H_ID.getValue(),\n                        ORDER_H_ID:r.get('ORDER_H_ID'),\n                        ORDER_L_ID:r.get('ORDER_L_ID'),\n                        MATERIAL_ID:r.get('MATERIAL_ID'),\n                        ORDER_H_CODE:r.get('ORDER_H_CODE'),\n                        ORDER_L_NUM:r.get('ORDER_L_NUM'),\n                        MATERIAL_CODE:r.get('MATERIAL_CODE'),\n                        MATERIAL_NAME:r.get('MATERIAL_NAME'),\n                        SPECIFICATION:r.get('SPECIFICATION'),\n                        DIM_CODE:r.get('DIM_CODE'),\n                        DIM_NAME:r.get('DIM_NAME'),\n                        AMOUNT:r.get('AMOUNT'),\n                        QTY:r.get('QTY'),\n                        DESCRIPTION:r.get('DESCRIPTION')\n                    }, 'after', 1, false);\n                });\n            }\n        });\n    }\n});\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#delBtn#}","itemId":"delOrderBtn","iconCls":"file_delete_icon"},"events":{"click":"/**\n*\tupdate：panghd date：20160510\n*\t删除原则，先将选中记录在表格中移除，点击主单保存时，才真正从数据库删除。\n**/\nvar recs = app.grid2.getSelection();\nif (!recs.length) {\n    Wb.toast('{#deleteRec#}');\n    return;\n}\nWb.confirm('{#confirm2#} ' + recs.length + ' {#confirm#}', function() {\n\tWb.remove(app.grid2, recs);\n});"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#ORDER_H_CODE#}","width":"150","dataIndex":"ORDER_H_CODE","titleAlign":"center","itemId":"ORDER_H_CODE_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"{#ORDER_L_NUM#}","width":"100","dataIndex":"ORDER_L_NUM","titleAlign":"center","itemId":"ORDER_L_NUM_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"<font color=\"red\">*<\/font>{#ACC_NAMES#}","width":"150","dataIndex":"ACC_NAME","titleAlign":"center","itemId":"ACC_NAME_COL"},"children":[{"configs":{"labelWidth":"100","allowBlank":"false","labelAlign":"right","normalName":"ACC_NAME_PICK","itemId":"editor"},"children":[{"configs":{"tagConfigs":"minWidth:400","height":"300","itemId":"pickComp"},"events":{"itemdblclick":"var r=app.grid2.getSelectionModel().getSelection()[0];\nr.set('ACC_ID',record.data.ACC_ID);\nr.set('ACC_NAME',record.data.ACC_NAME);\nr.set('CCID',null) ;    \nr.set('CCID_NAME',null);\nr.dirty = true;\napp.ACC_NAME_PICK.setValue(record.data.ACC_NAME);\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/com-lov/ACC_ID_PICK/DB/XC_BG_LD_ACCOUNTS_SELECT_LD"},"events":{"beforeload":"operation.params = Wb.getValue([app.form1,app.tbar]);"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","dataIndex":"ACC_ID","itemId":"ACC_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#ACC_CODE_COLS#}","dataIndex":"ACC_CODE","itemId":"ACC_CODE_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#ACC_NAME_COLS#}","dataIndex":"ACC_NAME","itemId":"ACC_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"100","emptyText":"{#ACC_CODE_NAMES#}","labelAlign":"right","itemId":"QUERY_CODE_NAME"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.pickComp.getStore().load();\n}"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"searchButton","iconCls":"seek_icon"},"events":{"click":"app.pickComp.getStore().load();"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"}],"expanded":false,"type":"grid"}],"expanded":false,"type":"picker"}],"expanded":false,"type":"column"},{"configs":{"text":"{#CCID_NAME#}","width":"200","dataIndex":"CCID_NAME","titleAlign":"center","normalName":"CCID_NAME_PICK","itemId":"CCID_NAME_COL"},"children":[{"configs":{"displayField":"CCID_NAME","triggerCls":"x-form-search-trigger","valueField":"CCID","itemId":"editor","onTriggerClick":"  // 账簿\n  var ledgerId = app.LEDGER_ID_XWL.LEDGER_ID.getValue() ;\n  if(ledgerId === \"\" ||ledgerId === null || ledgerId === undefined){\n    Wb.info('请选择账簿!') ;\n    return false ;\n  }\n  \n  // 会计日期\n  var accDate = app.GL_DATE.getValue() ;\n  if(accDate === \"\" ||accDate === null || accDate === undefined){\n    Wb.info('请选择会计日期!') ;\n    return false ;\n  }else{\n\taccDate = Wb.dateToStr(accDate).substring(0,7);\n  }\n  \n  // TODO: 当前选中\n  var r = app.grid2.getSelection()[0] ; \n  \n  // TODO: 显示科目选择窗口\n  Wb.run({\n    url:'m?xwl=xc/gl/journal/v-windows/handler-ccid-win',\n    params : {\n      'ledgerId' : ledgerId,\n      'vtype' : '{#vtype#}'\n    },          \n    success:function(appObj){\n      appObj.initWindow({\n        accName : r.data.ACC_NAME,\n        ledgerId : ledgerId,\n        periodCode : accDate ,\n        groupId : 'ALL',\n        handlerCCID : function(returnObj){\n          // TODO: 处理CCID信息\n          var rObj = Wb.decode(returnObj) ;\n          r.set('ACC_ID', rObj.acc_id) ;    \n          r.set('ACC_NAME', rObj.acc_name);\n          r.set('CCID', rObj.acc_ccid) ;    \n          r.set('CCID_NAME', rObj.acc_ccid_name);\n          if(!Wb.isEmpty(rObj.dim_id)){\n          r.set('DIM_ID', rObj.dim_id) ;\n          r.set('DIM_NAME', rObj.dim_name) ;\n          }\n          // 禁用账簿\n           app.LEDGER_ID_XWL.LEDGER_ID.setReadOnly(true) ;\n        }\n      });\n    }  \n  }) ;   "},"events":{"change":"if(newValue === null || newValue === ''){\n    var r = app.grid2.getSelection()[0]; \n    r.set('CCID',null);   \n}","beforequery":"var combo = e.combo;\nif(!e.forceAll){\n  var value = e.query;\n  combo.store.filterBy(function(record,id){\n    var text = record.get(combo.displayField);\n    return (text.indexOf(value)!=-1);\n  });\n  combo.expand();\n  return false;\n}","specialkey":"// TODO: 按回车键执行借方和贷方金额切换\nif (e.getKey() == e.ENTER) {\n  // 账簿\n  var ledgerId = app.LEDGER_ID_XWL.LEDGER_ID.getValue() ;\n  if(ledgerId === \"\" ||ledgerId === null || ledgerId === undefined){\n    Wb.info('请选择账簿!') ;\n    return false ;\n  }\n  \n  // 会计日期\n  var accDate = app.GL_DATE.getValue();\n  if(accDate === \"\" ||accDate === null || accDate === undefined){\n    Wb.info('请选择会计日期!') ;\n    return false ;\n  }else{\n    accDate = Wb.dateToStr(accDate).substring(0,7);\n  }\n  \n  // TODO: 当前选中\n  var r = app.grid2.getSelection()[0] ; \n  \n  // TODO: 显示科目选择窗口\n  Wb.run({\n    url:'m?xwl=xc/gl/journal/v-windows/handler-ccid-win',\n    params : {\n      'ledgerId' : ledgerId ,\n      'vtype' : '{#vtype#}'\n    },          \n    success:function(appObj){\n      appObj.initWindow({\n        accName : r.data.ACC_NAME,\n        ledgerId : ledgerId,\n        periodCode : accDate ,\n        groupId : 'ALL',\n        handlerCCID : function(returnObj){\n          // TODO: 处理CCID信息\n          var rObj = Wb.decode(returnObj) ;\n          r.set('ACC_ID', rObj.acc_id) ;    \n          r.set('ACC_NAME', rObj.acc_name);\n          r.set('CCID', rObj.acc_ccid) ;    \n          r.set('CCID_NAME', rObj.acc_ccid_name);\n          if(!Wb.isEmpty(rObj.dim_id)){\n          r.set('DIM_ID', rObj.dim_id) ;\n          r.set('DIM_NAME', rObj.dim_name) ;\n          }\n          // 禁用账簿\n           app.LEDGER_ID_XWL.LEDGER_ID.setReadOnly(true) ;\n        }\n      });\n    }  \n  }) ;   \n}"},"children":[],"expanded":true,"type":"combo"}],"expanded":true,"type":"column"},{"configs":{"text":"{#BG_ITEM_NAME#}","width":"150","dataIndex":"BG_ITEM_NAME","titleAlign":"center","itemId":"BG_ITEM_NAME_COL"},"children":[{"configs":{"labelWidth":"100","labelAlign":"right","normalName":"BG_ITEM_PICK","itemId":"editor"},"events":{"expand":"app.pickComp.getStore().load();"},"children":[{"configs":{"tagConfigs":"minWidth:400","height":"300","barExportButtons":"false","barExportAllButtons":"false","itemId":"pickComp"},"events":{"itemdblclick":"var r=app.grid2.getSelectionModel().getSelection()[0];\nr.set('BG_ITEM_ID',record.data.BG_ITEM_ID);\nr.set('BG_ITEM_NAME',record.data.BG_ITEM_NAME);\napp.BG_ITEM_PICK.setValue(record.data.BG_ITEM_NAME);\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/com-lov/BG_ITEM_ID_PICK/DB/XC_BG_ITEMS_LD_SELECT"},"events":{"beforeload":"operation.params = Wb.getValue([app.form1,app.tbar]);"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","dataIndex":"BG_ITEM_ID","itemId":"BG_ITEM_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#BG_ITEM_CODE_COL#}","dataIndex":"BG_ITEM_CODE","itemId":"BG_ITEM_CODE_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#BG_ITEM_CODE_COL#}","dataIndex":"BG_ITEM_NAME","itemId":"BG_ITEM_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"100","emptyText":"{#BG_ITEM_CODE_NAME#}","labelAlign":"right","itemId":"QUERY_CODE_NAME"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.searchButton.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"searchButton","iconCls":"seek_icon"},"events":{"click":"app.pickComp.getStore().load();"},"children":[],"expanded":false,"type":"button"},{"configs":{"itemId":"cancelBtn","iconCls":"delete_icon"},"events":{"click":"var r=app.grid2.getSelectionModel().getSelection()[0];\nr.set('BG_ITEM_ID',null);\nr.set('BG_ITEM_NAME',null);\napp.BG_ITEM_PICK.setValue(null);\napp.BG_ITEM_PICK.getPicker().hide();"},"children":[],"expanded":false,"type":"item"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":false,"type":"column"},{"configs":{"text":"{#MATERIAL_CODE#}","width":"120","dataIndex":"MATERIAL_CODE","titleAlign":"center","itemId":"MATERIAL_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#MATERIAL_NAME#}","width":"120","dataIndex":"MATERIAL_NAME","titleAlign":"center","itemId":"MATERIAL_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#SPECIFICATION#}","width":"100","dataIndex":"SPECIFICATION","titleAlign":"center","itemId":"SPECIFICATION_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"<font color=\"red\">*<\/font>{#AMOUNT#}","width":"100","align":"right","dataIndex":"AMOUNT","format":"0,000.00","titleAlign":"center","itemId":"AMOUNT_COL","renderer":"if (app.AP_DOC_CAT_CODE.getValue() == 'CGFP-CGDD-H') {\n    value = '<font color=red>'+Wb.format(value,'0,000.00')+'<\/font>';\n}\nelse {\n    value = Wb.format(value,'0,000.00');\n}\nreturn value;"},"children":[{"configs":{"itemId":"editor"},"events":{"blur":"if(number.getValue()===0){\n  number.setValue('');\n}"},"children":[],"expanded":false,"type":"number"}],"expanded":false,"type":"column"},{"configs":{"text":"<font color=\"red\">*<\/font>{#QTY#}","align":"right","width":"80","dataIndex":"QTY","titleAlign":"center","itemId":"QTY_COL","renderer":"if (app.AP_DOC_CAT_CODE.getValue() == 'CGFP-CGDD-H') {\n    value = '<font color=red>'+value+'<\/font>';\n}\nelse {\n    value = value;\n}\nreturn value;"},"children":[{"configs":{"decimalPrecision":"6","allowBlank":"false","itemId":"editor"},"events":{"blur":"if(number.value === 0){\n\tnumber.setValue(null);\n    return;\n}"},"children":[],"expanded":false,"type":"number"}],"expanded":false,"type":"column"},{"configs":{"text":"<font color=\"red\">*<\/font>{#DIM_NAME#}","width":"80","dataIndex":"DIM_NAME","titleAlign":"center","itemId":"DIM_NAME_COL"},"children":[{"configs":{"labelWidth":"80","allowBlank":"false","labelAlign":"right","normalName":"DIM_NAME_PICK","itemId":"editor"},"children":[{"configs":{"tagConfigs":"minWidth:400","height":"300","barExportButtons":"false","barExportAllButtons":"false","itemId":"pickComp"},"events":{"itemdblclick":"var r=app.grid2.getSelectionModel().getSelection()[0];\nr.set('DIM_CODE',record.data.DIM_CODE);\nr.set('DIM_NAME',record.data.DIM_NAME);\napp.DIM_NAME_PICK.setValue(record.data.DIM_NAME);\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/ap/inv/DB/XC_GL_DIMENSIONS_SELECT"},"events":{"beforeload":"operation.params = Wb.getValue(app.tbar);"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"hidden":"true","dataIndex":"DIM_ID","itemId":"DIM_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#DIM_CODE_COL#}","dataIndex":"DIM_CODE","itemId":"DIM_CODE_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#DIM_NAME_COL#}","dataIndex":"DIM_NAME","itemId":"DIM_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"100","emptyText":"{#DIM_CODE_NAME#}","labelAlign":"right","itemId":"QUERY_CODE_NAME"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.pickComp.getStore().load();\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":true,"type":"column"},{"configs":{"text":"{#DESCRIPTION#}","width":"300","dataIndex":"DESCRIPTION","titleAlign":"center","itemId":"DESCRIPTION_COL"},"children":[{"configs":{"itemId":"editor"},"children":[],"expanded":false,"type":"text"}],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"panel"},{"configs":{"file":"m?xwl=xc/gl/journal/v-windows/new-xwl-voucher","itemId":"edit_v_xwl"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"tab"}],"expanded":true,"type":"window"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}