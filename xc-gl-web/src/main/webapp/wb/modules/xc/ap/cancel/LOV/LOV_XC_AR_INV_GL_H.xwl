{"inframe":false,"title":"选择应收单","hidden":false,"roles":{"default":1},"children":[{"configs":{"serverScript":"// 获取模块语言对应的json文件\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xc/ap/cancel/LOV/LOV_XC_AP_CANCEL\");","itemId":"module"},"events":{"initialize":"\nExt.apply(app, {\n  initWin: function(params) {\n    Ext.apply(app, params);\n    app.lovWinN = new Ext.window.Window(app.lovWinN);\n    app.lovWinN.show();\n    \n    app.AP_CANCEL_TYPE.setValue(params.AP_CANCEL_TYPE);\n    app.LEDGER_ID.setValue(params.LEDGER_ID);\n    app.VENDOR_ID.setValue(params.VENDOR_ID);\n\tapp.SRC_ID.setValue(params.SRC_ID);\n\n    app.grid1.getStore().load();\n  }\n});"},"children":[{"configs":{"maximized":"true","layout":"border","itemId":"lovWinN","modal":"true"},"children":[{"configs":{"region":"north","itemId":"form1"},"children":[{"configs":{"layout":"column","margin":"10 10 10 0","itemId":"tr1","border":"false"},"children":[{"configs":{"layout":"fit","columnWidth":".25","itemId":"td_1_1","border":"false"},"children":[{"configs":{"labelWidth":"100","labelAlign":"right","itemId":"AR_CONTRACT_NAME","fieldLabel":"{#CONTRACT#}"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n    app.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".25","itemId":"td_1_2","border":"false"},"children":[{"configs":{"labelWidth":"100","labelAlign":"right","itemId":"AR_INV_GL_H_CODE","fieldLabel":"{#DOC_CODE#}"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n    app.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".25","itemId":"td_1_3","border":"false"},"children":[{"configs":{"labelWidth":"100","labelAlign":"right","itemId":"CREATED_BY_NAME","fieldLabel":"{#CREATED_BY_NAME#}"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n    app.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"AP_CANCEL_TYPE"},"children":[],"expanded":false,"type":"hidden"},{"configs":{"itemId":"LEDGER_ID"},"children":[],"expanded":false,"type":"hidden"},{"configs":{"itemId":"VENDOR_ID"},"children":[],"expanded":false,"type":"hidden"},{"configs":{"itemId":"SRC_ID"},"children":[],"expanded":false,"type":"hidden"}],"expanded":true,"type":"panel"},{"configs":{"layout":"column","columnWidth":".25","itemId":"td_3_2","border":"false"},"children":[{"configs":{"width":"20","itemId":"空格"},"children":[],"expanded":false,"type":"label"},{"configs":{"text":"{#QUERY#}","itemId":"queryBtn","iconCls":"seek_icon"},"events":{"click":"Wb.reload(app.grid1);"},"children":[],"expanded":false,"type":"button"},{"configs":{"width":"20","itemId":"空格1"},"children":[],"expanded":false,"type":"label"},{"configs":{"text":"{#RESET#}","itemId":"clearBtn","iconCls":"refresh_icon"},"events":{"click":"//三个 文本框\napp.AP_CONTRACT_NAME.reset();//合同\napp.AP_PAY_H_CODE.reset();//单据\napp.CREATED_BY_NAME.reset();//制单人\n//app.form1.getForm().reset();\n//app.LEDGER_ID.setValue(Wb.ledger_id);\n//app.VENDOR_ID.setValue(Wb.vendor_id);\napp.queryBtn.fireEvent('click');\n"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"form"},{"configs":{"region":"center","selType":"checkboxmodel","itemId":"grid1","editable":"true"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/ap/cancel/LOV/DB/XC_AR_INV_GL_H_SELECT"},"events":{"beforeload":"operation.params = Wb.getValue(app.form1);"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"{#SURE#}","itemId":"commitBtn","iconCls":"ok_icon"},"events":{"click":"var recs = app.grid1.getSelection();\nif (!recs.length) {\n  Wb.toast(\"{#qxzzsytjl#}\");//请选择至少一条记录！\n  return;\n}\nvar rows = Wb.getData(recs);\nvar isContinue = false;\nWb.each(rows, function(row) {\n  if(Wb.isEmpty(row.PAY_AMT)){\n    Wb.toast(\"{#hxjebnwk#}\");//核销金额不能为空！\n    isContinue = false;\n    return false;\n  }\n  if(row.PAY_AMT === 0){\n    Wb.toast(\"{#hxjebnwl#}\");//核销金额不能为 0 ！\n    isContinue = false;\n    return false;\n  }\n  isContinue = true;\n});\nif(isContinue){\n  Wb.confirm(\"{#qdyxzd#} \" + recs.length + \" {#tjlm#}\", function() {//确定要选择的  条记录吗？\n    app.hideFun(recs);\n    app.lovWinN.close();\n  });\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#CANCEL#}","itemId":"closeBtn","iconCls":"cancel_icon"},"events":{"click":"app.lovWinN.close();"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#ROWNUM#}","xtype":"rownumberer","align":"center","titleAlign":"center","itemId":"ROWNUM_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#GL_DATE#}","width":"100","dataIndex":"GL_DATE","titleAlign":"center","itemId":"GL_DATE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#AR_INV_GL_H_CODE#}","width":"150","dataIndex":"AR_INV_GL_H_CODE","titleAlign":"center","itemId":"AR_INV_GL_H_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#DESCRIPTION#}","width":"200","dataIndex":"DESCRIPTION","titleAlign":"center","itemId":"DESCRIPTION_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#NO_CANCEL_AMT#}","align":"right","width":"100","dataIndex":"NO_PAY_AMT","format":"0,000.00","titleAlign":"center","itemId":"NO_CANCEL_AMT_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#CANCEL_AMT#}","align":"right","width":"100","dataIndex":"PAY_AMT","titleAlign":"center","itemId":"PAY_AMT_COL","renderer":"metaData.style='background-color:#ffffd0';\n\nreturn Ext.util.Format.number(value,'0,000.00');"},"children":[{"configs":{"itemId":"editor"},"events":{"change":"var rec = app.grid1.getSelection()[0];\nvar yue = rec.data.NO_PAY_AMT;\n\nif( newValue < 0 ){\n  Wb.toast(\"{#hxjeydyl#}\");//核销金额应大于 0 ！\n  number.setValue(0);\n  return false;\n}\nif( newValue > yue ){\n  Wb.toast(\"{#hxjebkcgkhxje#}\");//核销金额不可超过可核销金额！\n  number.setValue(yue);\n  return false;\n}\n\n","focus":"var value = number.getValue();\n\nif(value === 0){\n  number.setValue();\n}"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"column"},{"configs":{"text":"{#CONTRACT#}","width":"200","dataIndex":"AR_CONTRACT_NAME","titleAlign":"center","itemId":"AR_CONTRACT_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#CUSTOMER#}","width":"200","dataIndex":"CUSTOMER_NAME","titleAlign":"center","itemId":"CUSTOMER_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#DEPT#}","width":"100","dataIndex":"DEPT_NAME","titleAlign":"center","itemId":"DEPT_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#PROJECT#}","width":"100","dataIndex":"PROJECT_NAME","titleAlign":"center","itemId":"PROJECT_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#ACC#}","width":"100","dataIndex":"ACC_NAME","titleAlign":"center","itemId":"ACC_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#CCID#}","width":"150","dataIndex":"CCID_NAME","titleAlign":"center","itemId":"CCID_NAME_COL"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"window"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":"window_icon"}