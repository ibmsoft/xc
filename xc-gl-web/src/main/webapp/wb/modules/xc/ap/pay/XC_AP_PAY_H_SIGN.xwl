{"inframe":false,"title":"付款单签字管理","hidden":false,"roles":{"default":1},"children":[{"configs":{"serverScript":"// 获取模块语言对应的json文件\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xc/ap/pay/XC_AP_PAY_H_SIGN\");\n\nvar contextPath = request.getContextPath();\nrequest.setAttribute(\"contextPath\",contextPath);","itemId":"module"},"events":{"initialize":"function returnRowFn(r,type){\n  if(type==='xc_gl_ledgers'){\n    Wb.reload(app.grid1);\n  }\n}\nfunction clearOtherFn(type){\n  if(type=='xc_gl_ledgers'){\n  }\n}"},"children":[{"configs":{"itemId":"request"},"children":[{"configs":{"autoLoad":"true","itemId":"ldInitStore","url":"m?xwl=xc/com-lov/LEDGER_ID_PICK/DB/XC_GL_LEDGERS_SELECT_SEC"},"events":{"load":"app.LEDGER_XWL.LEDGER_ID.setValue(store.getAt(0).get('LEDGER_ID'));\napp.LEDGER_XWL.LEDGER_NAME.setValue(store.getAt(0).get('LEDGER_NAME'));\napp.grid1.getStore().load();"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"folder"},{"configs":{"layout":"fit","itemId":"viewport1"},"children":[{"configs":{"itemId":"tab1"},"children":[{"configs":{"title":"{#NoSign#}","layout":"border","itemId":"tab1"},"children":[{"configs":{"region":"north","buttonAlign":"center","itemId":"form1"},"children":[{"configs":{"layout":"column","border":"false","itemId":"tr1"},"children":[{"configs":{"layout":"fit","columnWidth":".33","margin":"10 10 10 10","border":"false","itemId":"td_1_1"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/LEDGER_ID_PICK/LEDGER_ID_PICK_SEC","itemId":"LEDGER_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".33","margin":"10 10 10 10","border":"false","itemId":"td_1_2"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"AP_PAY_H_CODE","fieldLabel":"{#AP_PAY_H_CODE#}"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n    app.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".33","margin":"10 10 10 10","border":"false","itemId":"td_1_3"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"VENDOR_NAME","fieldLabel":"{#VENDOR_NAME#}"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n    app.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"layout":"column","border":"false","itemId":"tr2"},"children":[{"configs":{"layout":"fit","columnWidth":".33","margin":"10 10 10 10","border":"false","itemId":"td_1_4"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"PROJECT_NAME","fieldLabel":"{#PROJECT_NAME#}"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n    app.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".33","margin":"10 10 10 10","border":"false","itemId":"td_2_2"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"DESCRIPTION","fieldLabel":"{#DESCRIPTION#}"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n    app.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"80","hidden":"true","value":"1","labelAlign":"right","itemId":"SIGN_STATUS","fieldLabel":"{#SIGN_STATUS#}"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"80","hidden":"true","value":"Y","labelAlign":"right","itemId":"V_STATUS_YES","fieldLabel":"{#V_STATUS_YES#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"layout":"column","columnWidth":".33","margin":"10 10 10 10","border":"false","itemId":"td_3_2"},"children":[{"configs":{"width":"85","itemId":"space"},"children":[],"expanded":false,"type":"label"},{"configs":{"text":"{#queryBtn#}","itemId":"queryBtn","iconCls":"seek_icon"},"events":{"click":"Wb.reload(app.grid1);"},"children":[],"expanded":false,"type":"button"},{"configs":{"width":"20","itemId":"space1"},"children":[],"expanded":false,"type":"label"},{"configs":{"text":"{#clearBtn#}","itemId":"clearBtn","iconCls":"refresh_icon"},"events":{"click":"app.form1.getForm().reset();"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"form"},{"configs":{"region":"center","selType":"checkboxmodel","itemId":"grid1"},"events":{"itemdblclick":"app.seekBtnBtn.fireEvent('click');"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/ap/pay/DB/XC_AP_PAY_H_SELECT"},"events":{"beforeload":"operation.params = Wb.getValue(app.form1);"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"{#seekBtnBtn#}","itemId":"seekBtnBtn","iconCls":"seek_icon"},"events":{"click":"var curGrid = app.grid1;\nvar r=curGrid.getSelectionModel().getSelection()[0];\nif (!r) {\n  Wb.toast('请选择一条记录。');\n  return;\n}\nWb.run({\n  url: 'm?xwl=xc/ap/pay/XC_AP_PAY_H_NO_C', \n  success: function(app) {\n    app.initWin({\n\t\tAP_PAY_H_ID:r.get('AP_PAY_H_ID'),\n        IS_INSERT:'S',\n        AP_DOC_CAT_CODE:r.get('AP_DOC_CAT_CODE'),\n        hideFun:function(){\n          Wb.reload(curGrid.store);\n        }\n    });\n  }\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#signBtn#}","itemId":"signBtn","iconCls":"db_form_edit_icon"},"events":{"click":"var rows = app.grid1.getSelection();\nif(rows.length === 0){\n    Wb.toast(\"请选择需要签字的单据!\");\n    return;\n}\nelse{\n    //单据ID数组\n    var docArray = [];\n    var i = 0;//判断是否生成凭证\n    var j = 0;//判断是否审核通过\n    Wb.each(rows,function(r){\n        var apId = r.data.AP_PAY_H_ID;//单据ID\n        var headId = r.data.V_HEAD_ID;//凭证头ID\n        if(headId === '' || headId === null){\n            i++;\n        }\n        if(r.data.V_STATUS_NAME === '草稿'){\n            j++;\n        }\n        var paramJson = {'headId' : headId,'apId':apId} ;\n        docArray.push(paramJson) ;\n    });\n    if(i > 0){\n        Wb.toast('请选择已经生成凭证的单据！');\n        return;\n    }\n    if(j > 0){\n        Wb.toast('请选择已经审核通过的单据！');\n        return;\n    }\n    Wb.request({\n        url: '{#contextPath#}'+'/apVoucherAction.do?method=signVoucher',\n        params: Wb.apply({apInfo: docArray}),\n        success: function(resp) {\n            var record = Wb.decode(resp.responseText);\n            var msg = record.msg;\n            Wb.reload(app.grid1.store);\n            Wb.toast(msg);\n        }\n\t});\n}"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#LEDGER_NAME_COL#}","width":"150","dataIndex":"LEDGER_NAME","titleAlign":"center","itemId":"LEDGER_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#AP_PAY_H_CODE_COL#}","width":"150","dataIndex":"AP_PAY_H_CODE","titleAlign":"center","itemId":"AP_PAY_H_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#AP_DOC_CAT_NAME_COL#}","width":"150","dataIndex":"AP_DOC_CAT_CODE","titleAlign":"center","itemId":"AP_DOC_CAT_CODE_COL","renderer":"if(value == \"FKD_YUFK\"){\n  return \"{#FKD_YUFK#}\";\n}else if(value == \"FKD_YUFK-H\"){\n  return \"{#FKD_YUFK-H#}\";\n}else if(value == \"FKD_CGJS\"){\n  return \"{#FKD_CGJS#}\";\n}else if(value == \"FKD_CGJS-H\"){\n  return \"{#FKD_CGJS-H#}\";\n}else if(value == \"FKD_QTFK\"){\n  return \"{#FKD_QTFK#}\";\n}else if(value == \"FKD_QTFK-H\"){\n  return \"{#FKD_QTFK-H#}\";\n}"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#GL_DATE_COL#}","width":"100","dataIndex":"GL_DATE","titleAlign":"center","itemId":"GL_DATE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#DESCRIPTION_COL#}","width":"150","dataIndex":"DESCRIPTION","titleAlign":"center","itemId":"DESCRIPTION_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#VENDOR_NAME_COL#}","width":"200","dataIndex":"VENDOR_NAME","titleAlign":"center","itemId":"VENDOR_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#AP_CONTRACT_NAME_COL#}","width":"200","dataIndex":"AP_CONTRACT_NAME","titleAlign":"center","itemId":"AP_CONTRACT_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#AMOUNT_COL#}","align":"right","width":"80","dataIndex":"AMOUNT","format":"0,000.00","titleAlign":"center","itemId":"AMOUNT_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#DEPT_NAME_COL#}","width":"150","dataIndex":"DEPT_NAME","titleAlign":"center","itemId":"DEPT_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#PROJECT_NAME_COL#}","width":"150","dataIndex":"PROJECT_NAME","titleAlign":"center","itemId":"PROJECT_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#CREATED_BY_NAME_COL#}","width":"100","dataIndex":"CREATED_BY_NAME","titleAlign":"center","itemId":"CREATED_BY_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#SIGN_USER_NAME_COL#}","width":"100","dataIndex":"SIGN_USER_NAME","titleAlign":"center","itemId":"SIGN_USER_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#V_STATUS_NAME_COL#}","width":"100","dataIndex":"V_STATUS_NAME","titleAlign":"center","itemId":"V_STATUS_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#V_HEAD_ID_COL#}","hidden":"true","dataIndex":"V_HEAD_ID","itemId":"V_HEAD_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#AP_PAY_H_ID_COL#}","hidden":"true","dataIndex":"AP_PAY_H_ID","itemId":"AP_PAY_H_ID_COL"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"panel"},{"configs":{"title":"{#YesSign#}","layout":"fit","itemId":"tab2"},"children":[{"configs":{"file":"m?xwl=xc/ap/pay/XC_AP_PAY_H_SIGN_Y","itemId":"xwl1"},"children":[],"expanded":false,"type":"xwl"}],"expanded":false,"type":"panel"}],"expanded":true,"type":"tab"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}