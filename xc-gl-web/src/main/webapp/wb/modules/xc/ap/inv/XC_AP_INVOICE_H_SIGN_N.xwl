{"inframe":false,"title":"采购发票待签收","hidden":false,"roles":{"default":1},"children":[{"configs":{"serverScript":"//---------------------获取当前模块语言对应的.json文件，放到request中----------------\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,\"xc/ap/inv/json/XC_AP_INVOICE_H_MY\");\nvar userId = request.getSession().getAttribute(\"XzSessionVars\").get('userId');\n\nvar contextPath = request.getContextPath();\nrequest.setAttribute(\"contextPath\",contextPath);","itemId":"module"},"events":{"finalize":"function returnRowFn(r,type){\n  if(type==='xc_gl_ledgers'){\n    app.queryBtn.fireEvent('click');\n  }\n}\nfunction clearOtherFn(type){\n  //清空账薄时清空面板中所有信息\n  if(type=='xc_gl_ledgers'){\n    app.LEDGER_XWL.LEDGER_ID.setValue('');\n    app.LEDGER_XWL.LEDGER_NAME.setValue('');\n    app.queryBtn.fireEvent('click');\n  }\n}"},"children":[{"configs":{"itemId":"request"},"children":[{"configs":{"autoLoad":"true","itemId":"ldInitStore","url":"m?xwl=xc/com-lov/LEDGER_ID_PICK/DB/XC_GL_LEDGERS_SELECT_SEC"},"events":{"load":"app.LEDGER_XWL.LEDGER_ID.setValue(store.getAt(0).get('LEDGER_ID'));\napp.LEDGER_XWL.LEDGER_NAME.setValue(store.getAt(0).get('LEDGER_NAME'));\napp.queryBtn.fireEvent('click');"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"folder"},{"configs":{"layout":"fit","itemId":"viewport1"},"children":[{"configs":{"itemId":"tabs"},"events":{"beforetabchange":"app.queryBtn.fireEvent('click');\napp.xwl1.queryBtn.fireEvent('click');"},"children":[{"configs":{"title":"{#NoProcessed#}","layout":"border","itemId":"tab1"},"children":[{"configs":{"region":"north","buttonAlign":"center","itemId":"form1"},"children":[{"configs":{"layout":"column","margin":"10 0 10 0","border":"false","itemId":"tr1"},"children":[{"configs":{"layout":"form","columnWidth":".22","border":"false","itemId":"td_1_1"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/LEDGER_ID_PICK/LEDGER_ID_PICK_SEC","itemId":"LEDGER_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".22","border":"false","itemId":"td_1_2"},"children":[{"configs":{"labelWidth":"80","value":"All","pickList":"[\n  ['All','{#all#}'],\n  ['CGFP','{#cgfp#}'],\n  ['CGFP-H','{#cgfpH#}'],\n  ['CGFP-CGDD','{#cgfpCgdd#}'],\n  ['CGFP-CGDD-H','{#cgfpCgddH#}']\n]","labelAlign":"right","itemId":"AP_DOC_CAT_CODE","fieldLabel":"{#AP_DOC_CAT_CODE#}"},"events":{"select":"app.queryBtn.fireEvent('click');","specialkey":"if(e.getKey()===13) {\n  app.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".22","border":"false","itemId":"td_1_3"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"AP_INV_H_CODE","fieldLabel":"{#AP_INV_H_CODE#}"},"events":{"specialkey":"if(e.getKey()===13) {\n  app.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"80","hidden":"true","value":"0","labelAlign":"right","itemId":"SIGN_STATUS","fieldLabel":"签收状态"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"80","hidden":"true","value":"0","labelAlign":"right","itemId":"IS_SIGN","fieldLabel":"是否签收"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"80","hidden":"true","value":"E","labelAlign":"right","itemId":"SYS_AUDIT_STATUS","fieldLabel":"单据状态"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"80","hidden":"true","value":"IS_NO_SIGN_SELECT","labelAlign":"right","itemId":"IS_NO_SIGN_SELECT","fieldLabel":"已提交，未签收"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"layout":"fit","columnWidth":".34","border":"false","itemId":"td_3_4"},"children":[{"configs":{"layout":"column","border":"false","itemId":"tr_3_4_1"},"children":[{"configs":{"layout":"form","columnWidth":".02","border":"false","itemId":"td_3_4_1_21"},"children":[{"configs":{"itemId":"空格"},"children":[],"expanded":false,"type":"label"}],"expanded":false,"type":"panel"},{"configs":{"layout":"form","columnWidth":".2","border":"false","itemId":"td_3_4_1_2"},"children":[{"configs":{"text":"{#queryBtn#}","itemId":"queryBtn","iconCls":"seek_icon"},"events":{"click":"app.grid1.store.load({params : Wb.getValue(app.form1)});"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":".2","border":"false","itemId":"td_3_4_1_3"},"children":[{"configs":{"text":"{#clearBtn#}","itemId":"clearBtn","iconCls":"refresh_icon"},"events":{"click":"app.form1.getForm().reset();\napp.queryBtn.fireEvent('click');"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"form"},{"configs":{"region":"center","multiSelect":"true","selType":"checkboxmodel","itemId":"grid1"},"events":{"itemdblclick":"app.seekBtn.fireEvent('click');"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/ap/inv/DB/XC_AP_INVOICE_H_SELECT"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"{#seekBtn#}","itemId":"seekBtn","iconCls":"seek_icon"},"events":{"click":"var curGrid = app.grid1;\nvar r=curGrid.getSelectionModel().getSelection()[0];\nvar rows = curGrid.getSelection();\nif (rows.length > 1 || rows.length === 0) {\n    Wb.toast('{#seekRec#}');\n    return;\n}\nWb.run({\n  url: 'm?xwl=xc/ap/inv/XC_AP_INVOICE_H_NO_C', \n  success: function(apps) {\n    apps.initWin({\n\t\tAP_INV_H_ID:r.get('AP_INV_H_ID'),\n        IS_INSERT:'S',\n        AP_DOC_CAT_CODE:r.get('AP_DOC_CAT_CODE'),\n        hideFun:function(){\n            app.queryBtn.fireEvent('click');\n        }\n    });\n  }\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#signBtn#}","itemId":"signBtn","iconCls":"business_icon"},"events":{"click":"var recs = app.grid1.getSelection();\nif (!recs.length) {\n    Wb.toast('{#signRec#}');\n    return;\n}\nvar invoiceArray = [];\nfor(var i = 0;i < recs.length;i++){\n    if(recs[i].data.SIGN_STATUS == '1' || recs[i].data.SIGN_STATUS == '3'){\n        var deleteData =  {AP_INV_H_ID : recs[i].data.AP_INV_H_ID};\n        invoiceArray.push(deleteData);\n    }\n}\nif(invoiceArray.length === 0){\n    Wb.toast('{#signRec1#}');\n    return;\n}\nWb.confirm('{#confirm1#} ' + recs.length + ' {#confirm#}', function() {\n    //调用销售发票签收的后台程序\n    Wb.request({\n        url : '{#contextPath#}' + '/apDocsAction.do?method=signOrCancelApInvoice',\n        params : Wb.apply({invoiceId: invoiceArray,opType : '1'}),\n        success : function(resp){\n            var record = Wb.decode(resp.responseText);\n            var msg = record.msg;\n            if(record.flag == '0')\n                Wb.toast('{#signRec2#}');\n            else\n                Wb.toast(msg);\n            app.queryBtn.fireEvent('click');\n        }\n    });\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"{#refusedBtn#}","itemId":"refusedBtn"},"events":{"click":"var recs = app.grid1.getSelection();\nif (!recs.length) {\n    Wb.toast('{#refusedRec#}');\n    return;\n}\nvar invoiceArray = [];\nfor(var i = 0;i < recs.length;i++){\n    var deleteData =  {AP_INV_H_ID : recs[i].data.AP_INV_H_ID};\n    invoiceArray.push(deleteData);\n}\nif(invoiceArray.length === 0){\n    Wb.toast('{#refusedRec1#}');\n    return;\n}\nWb.confirm('{#confirm5#} ' + recs.length + ' {#confirm#}', function() {\n    //调用销售发票拒绝签收的后台程序\n    Wb.request({\n        url : '{#contextPath#}' + '/apDocsAction.do?method=signOrCancelApInvoice',\n        params : Wb.apply({invoiceId: invoiceArray,opType : '3'}),\n        success : function(resp){\n            var record = Wb.decode(resp.responseText);\n            var msg = record.msg;\n            if(record.flag == '0')\n                Wb.toast('{#refusedRec2#}');\n            else\n                Wb.toast(msg);\n            app.queryBtn.fireEvent('click');\n        }\n    });\n});"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"{#order#}","align":"center","xtype":"rownumberer","width":"50","titleAlign":"center","itemId":"ORDERBY"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#LEDGER_NAME#}","hidden":"true","width":"150","dataIndex":"LEDGER_NAME","titleAlign":"center","itemId":"LEDGER_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#AP_DOC_CAT_CODE#}","hidden":"true","width":"150","dataIndex":"AP_DOC_CAT_CODE","titleAlign":"center","itemId":"AP_DOC_CAT_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#AP_DOC_CAT_NAME#}","width":"160","dataIndex":"AP_DOC_CAT_NAME","titleAlign":"center","itemId":"AP_DOC_CAT_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#AP_INV_H_CODE#}","width":"200","dataIndex":"AP_INV_H_CODE","titleAlign":"center","itemId":"AP_INV_H_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#BIZ_DATE#}","width":"100","dataIndex":"BIZ_DATE","titleAlign":"center","itemId":"BIZ_DATE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#VENDOR_NAME#}","width":"200","dataIndex":"VENDOR_NAME","titleAlign":"center","itemId":"VENDOR_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#AP_CONTRACT_NAME#}","width":"150","dataIndex":"AP_CONTRACT_NAME","titleAlign":"center","itemId":"AP_CONTRACT_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#DEPT_NAME#}","width":"150","dataIndex":"DEPT_NAME","titleAlign":"center","itemId":"DEPT_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#PROJECT_NAME#}","width":"150","dataIndex":"PROJECT_NAME","titleAlign":"center","itemId":"PROJECT_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#INV_AMOUNT#}","width":"120","align":"right","dataIndex":"INV_AMOUNT","format":"0,000.00","titleAlign":"center","itemId":"INV_AMOUNT_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#NO_PAY_AMT#}","width":"120","align":"right","dataIndex":"NO_PAY_AMT","format":"0,000.00","titleAlign":"center","itemId":"NO_PAY_AMT_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#TAX_RATE#}","width":"100","align":"right","dataIndex":"TAX_RATE","titleAlign":"center","itemId":"TAX_RATE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#TAX_AMT#}","width":"120","align":"right","dataIndex":"TAX_AMT","format":"0,000.00","titleAlign":"center","itemId":"TAX_AMT_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#DESCRIPTION#}","width":"200","dataIndex":"DESCRIPTION","titleAlign":"center","itemId":"DESCRIPTION_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#CREATED_BY_NAME#}","width":"100","dataIndex":"CREATED_BY_NAME","titleAlign":"center","itemId":"CREATED_BY_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"{#SYS_AUDIT_STATUS_DESC#}","width":"100","dataIndex":"XC_AP_SYS_AUDIT_STATUS","titleAlign":"center","itemId":"SYS_AUDIT_STATUS_DESC_COL"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"panel"},{"configs":{"title":"{#Processed#}","layout":"fit","itemId":"tab2"},"children":[{"configs":{"file":"m?xwl=xc/ap/inv/XC_AP_INVOICE_H_SIGN_Y","itemId":"xwl1"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"tab"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}