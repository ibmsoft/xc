{"inframe":false,"title":"查询应收单","hidden":false,"roles":{"default":1},"children":[{"configs":{"serverScript":"/*\n核销单 \n核销类型：应付核应收\n过滤条件1（死）：账簿、供应商-客户、单据类型-应收单红蓝、余额不为0、审核通过\n过滤条件2（活）：应收单编码、制单人\n过滤条件3（待考虑，暂不实现）：来源单据的合同\n*/\n\nvar data = app.get();\nvar sql = \"\";\n\n//var results = app.run(\"SELECT AP_DOC_CAT_CODE,AP_CONTRACT_ID  FROM xc_ap_inv_gl_h WHERE AP_INV_GL_H_ID = '\"+data.SRC_ID+\"'\");\t\t\t\n\n// if( results.next() ){\n//   var ap_doc_cat_code = results.getString('AP_DOC_CAT_CODE');\n//   if( ap_doc_cat_code == 'YFD' ){\n//     sql += \" AND h.AR_DOC_CAT_CODE = 'YSD'\";\n//     sql += \" AND h.NO_PAY_AMT > 0\";\n//   }else if( ap_doc_cat_code == 'YSD-HZ' ){\n//     sql += \" AND h.AR_DOC_CAT_CODE = 'YSD-HZ'\";\n//     sql += \" AND h.NO_PAY_AMT < 0\";\n//   }\n// }\n//合同编码名称\nif (!Wb.isEmpty(data.AR_CONTRACT_NAME)){\n  sql += \" AND (contract.AR_CONTRACT_CODE LIKE '%\"+data.AR_CONTRACT_NAME+\"%' OR contract.AR_CONTRACT_NAME LIKE '%\"+data.AR_CONTRACT_NAME+\"%')\";\n}\n\n// //单据编号/名称\n// if (!Wb.isEmpty(data.AR_INV_GL_H_CODE)){\n//   sql += \"AND (h.AR_INV_GL_H_CODE LIKE '%\"+data.AR_INV_GL_H_CODE+\"%' OR h.DESCRIPTION LIKE '%\"+data.AR_INV_GL_H_CODE+\"%')\";\n// }\n\n// //制单人\n// if (!Wb.isEmpty(data.CREATED_BY_NAME)){\n//   sql += \"AND emp.EMP_NAME LIKE '%\"+data.CREATED_BY_NAME+\"%'\";\n// }\n\n// //应付单单据类型\n// if (data.AP_DOC_CAT_CODE == \"YFD\"){\n//   sql += \"AND h.AR_DOC_CAT_CODE = 'YSD'\";\n// }else if (data.AP_DOC_CAT_CODE == \"YFD-H\"){\n//   sql += \"AND h.AR_DOC_CAT_CODE = 'YSD-HZ'\";\n// }\n\nrequest.setAttribute(\"sql\",sql);\n","itemId":"module"},"children":[{"configs":{"oracle":"SELECT \n  h.AR_INV_GL_H_ID ,\n  h.AR_INV_GL_H_CODE,\n  h.GL_DATE,\n  h.CUSTOMER_ID,\n  h.PROJECT_ID,\n  h.DEPT_ID,\n  h.AR_CONTRACT_ID,\n  NVL(h.NO_PAY_AMT,0) AS NO_PAY_AMT,\n  h.DESCRIPTION,\n  customer.CUSTOMER_NAME,\n  project.PROJECT_NAME,\n  dept.DEPT_NAME,\n  contract.AR_CONTRACT_NAME,\n  account.ACC_NAME,\n  ccid.CCID_NAME,\n  emp.EMP_NAME\n  \nFROM \n\txc_ar_inv_gl_h h\n      LEFT JOIN xc_gl_ledgers ledger ON ledger.LEDGER_ID = h.LEDGER_ID\n      LEFT JOIN xc_ar_customers customer ON customer.CUSTOMER_ID = h.CUSTOMER_ID\n      LEFT JOIN xc_pm_projects project ON project.PROJECT_ID = h.PROJECT_ID\n      LEFT JOIN xip_pub_depts dept ON dept.DEPT_ID = h.DEPT_ID\n      LEFT JOIN xc_ar_contract contract ON contract.AR_CONTRACT_ID = h.AR_CONTRACT_ID\n      LEFT JOIN xc_gl_accounts account ON account.ACC_ID = h.AR_ACC_ID_DEBT\n      LEFT JOIN xc_gl_ccid ccid ON ccid.CCID = h.AR_CCID_DEBT\n      LEFT JOIN xip_pub_emps emp ON emp.EMP_ID = (SELECT EMP_ID FROM xip_pub_users WHERE USER_ID=h.CREATED_BY)\nWHERE\n\th.LEDGER_ID = {?LEDGER_ID?}\nAND\th.CUSTOMER_ID = (select CUSTOMER_ID from xc_ap_vendors where VENDOR_ID = {?VENDOR_ID?})\nAND h.V_STATUS >= 3\nAND h.AR_DOC_CAT_CODE = 'YSD'\nAND h.NO_PAY_AMT > 0\nAND h.AR_INV_GL_H_CODE IS NOT NULL\nAND h.AR_INV_GL_H_CODE <> ''\n{#sql#}\n\nAND (h.AR_INV_GL_H_CODE LIKE '%{#AR_INV_GL_H_CODE#}%' OR h.DESCRIPTION LIKE '%{#AR_INV_GL_H_CODE#}%')\nAND emp.EMP_NAME LIKE '%{#CREATED_BY_NAME#}%'\nORDER BY \n\th.CREATION_DATE DESC\n\n\n\n","itemId":"sqlswitcher1","mysql":"SELECT \n  h.AR_INV_GL_H_ID ,\n  h.AR_INV_GL_H_CODE,\n  h.GL_DATE,\n  h.CUSTOMER_ID,\n  h.PROJECT_ID,\n  h.DEPT_ID,\n  h.AR_CONTRACT_ID,\n  IFNULL(h.NO_PAY_AMT,0) AS NO_PAY_AMT,\n  h.DESCRIPTION,\n  customer.CUSTOMER_NAME,\n  project.PROJECT_NAME,\n  dept.DEPT_NAME,\n  contract.AR_CONTRACT_NAME,\n  account.ACC_NAME,\n  ccid.CCID_NAME,\n  emp.EMP_NAME\n  \nFROM \n\txc_ar_inv_gl_h h\n      LEFT JOIN xc_gl_ledgers ledger ON ledger.LEDGER_ID = h.LEDGER_ID\n      LEFT JOIN xc_ar_customers customer ON customer.CUSTOMER_ID = h.CUSTOMER_ID\n      LEFT JOIN xc_pm_projects project ON project.PROJECT_ID = h.PROJECT_ID\n      LEFT JOIN xip_pub_depts dept ON dept.DEPT_ID = h.DEPT_ID\n      LEFT JOIN xc_ar_contract contract ON contract.AR_CONTRACT_ID = h.AR_CONTRACT_ID\n      LEFT JOIN xc_gl_accounts account ON account.ACC_ID = h.AR_ACC_ID_DEBT\n      LEFT JOIN xc_gl_ccid ccid ON ccid.CCID = h.AR_CCID_DEBT\n      LEFT JOIN xip_pub_emps emp ON emp.EMP_ID = (SELECT EMP_ID FROM xip_pub_users WHERE USER_ID=h.CREATED_BY)\nWHERE\n\th.LEDGER_ID = {?LEDGER_ID?}\nAND\th.CUSTOMER_ID = (select CUSTOMER_ID from xc_ap_vendors where VENDOR_ID = {?VENDOR_ID?})\nAND h.V_STATUS >= 3\nAND h.AR_DOC_CAT_CODE = 'YSD'\nAND h.NO_PAY_AMT > 0\nAND h.AR_INV_GL_H_CODE IS NOT NULL\nAND h.AR_INV_GL_H_CODE <> ''\n{#sql#}\n\nAND (h.AR_INV_GL_H_CODE LIKE '%{#AR_INV_GL_H_CODE#}%' OR h.DESCRIPTION LIKE '%{#AR_INV_GL_H_CODE#}%')\nAND emp.EMP_NAME LIKE '%{#CREATED_BY_NAME#}%'\nORDER BY \n\th.CREATION_DATE DESC\n\n\n\n"},"children":[],"expanded":false,"type":"sqlswitcher"},{"configs":{"sql":"{#sqlswitcher1#}","itemId":"dataprovider1"},"children":[],"expanded":false,"type":"dataprovider"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":"search_icon"}