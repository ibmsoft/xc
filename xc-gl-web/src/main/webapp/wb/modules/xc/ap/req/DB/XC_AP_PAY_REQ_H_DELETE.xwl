{"inframe":false,"title":"","hidden":false,"roles":{"default":1},"children":[{"configs":{"serverScript":"//付款申请批量删除需要一条一条去判断是否启动流程，如果启动流程，不让删除，程序中断。\nvar  rs, meta, row, rows = [];\nvar recs = Wb.decode(request.getParameter('destroy'));\nvar updateGl = [];\nWb.each(recs, function(rec) {\n    app.run('SELECT 1 FROM xc_ap_pay_req_h WHERE AP_PAY_REQ_H_ID=\\''+rec.AP_PAY_REQ_H_ID+'\\' AND SYS_AUDIT_STATUS <> \"A\" AND SYS_AUDIT_STATUS <> \"D\" ',{ \n       errorText:'此付款申请已被启动流程，不允许删除'\n\t});\n});\n/**\n* update:panghd date:20160510\n* 删除付款申请，需要把申请行中应付单申请的金额释放回去给应付单。\n**/\nWb.each(recs, function(rec) {\n  rs = app.run('select * from xc_ap_pay_req_l where AP_PAY_REQ_H_ID=\\''+rec.AP_PAY_REQ_H_ID+'\\'');\n  meta = rs.getMetaData();\n  while (rs.next()) {\n    row = Wb.getRecord(rs, meta);\n    rows.push(row);\n  }\n});\nrequest.setAttribute('deletePayReqL',Wb.encode(rows));","itemId":"module"},"children":[{"configs":{"sql":"update xc_ap_inv_gl_h set \nOCCUPY_AMT = OCCUPY_AMT-({?decimal.AMOUNT?}-{?decimal.PAID_AMT?})\nwhere \n AP_INV_GL_H_ID = {?varchar.AP_INV_GL_H_ID?}","transaction":"start","arrayName":"deletePayReqL","itemId":"query1"},"children":[],"expanded":false,"type":"query"},{"configs":{"sql":"delete from xc_ap_pay_req_l where AP_PAY_REQ_H_ID={?varchar.AP_PAY_REQ_H_ID?}","arrayName":"destroy","itemId":"query2"},"children":[],"expanded":false,"type":"query"},{"configs":{"sql":"delete from xc_ap_pay_req_h where AP_PAY_REQ_H_ID={?varchar.AP_PAY_REQ_H_ID?}","arrayName":"destroy","itemId":"query3"},"children":[],"expanded":false,"type":"query"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}