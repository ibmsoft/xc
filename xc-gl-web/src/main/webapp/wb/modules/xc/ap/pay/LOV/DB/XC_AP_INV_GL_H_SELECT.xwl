{"inframe":false,"title":"","hidden":false,"roles":{"default":1},"children":[{"configs":{"serverScript":"var data = app.get();\nvar sql = '';\n\n//合同\nif (!Wb.isEmpty(data.AP_CONTRACT_ID)) {\n  sql += \" AND h.AP_CONTRACT_ID = '\"+data.AP_CONTRACT_ID+\"'\";\n}else{\n  sql += \" AND (h.AP_CONTRACT_ID is null OR h.AP_CONTRACT_ID = '') \";\n}\n\n//项目\nif( !Wb.isEmpty(data.PROJECT_ID)){\n  sql += \" AND h.PROJECT_ID = '\"+data.PROJECT_ID+\"'\";\n}\n\n//单据类型\nif(data.AP_DOC_CAT_CODE == 'FKD_CGJS'){\n  sql += \" AND h.AP_DOC_CAT_CODE = 'YFD' AND h.INV_AMOUNT > 0 AND h.NO_PAY_AMT > 0\";\n}else if(data.AP_DOC_CAT_CODE == 'FKD_CGJS-H'){\n  sql += \" AND h.AP_DOC_CAT_CODE = 'YFD-H' AND h.INV_AMOUNT < 0 AND h.NO_PAY_AMT < 0\";\n}\n\n// //单据编码、摘要\n// if (!Wb.isEmpty(data.AP_INV_GL_H_CODE)) {\n//   sql += \" and (t.AP_INV_GL_H_CODE like '%\"+data.AP_INV_GL_H_CODE+\"%' or t.DESCRIPTION like '%\"+data.AP_INV_GL_H_CODE+\"%') \";\n// }\n\n// //创建人\n// if (!Wb.isEmpty(data.CREATED_BY_NAME)) {\n//   sql += \" and t.CREATED_BY_NAME like '%\"+data.CREATED_BY_NAME+\"%' \";\n// }\n\n\nrequest.setAttribute('sql', sql);\n","itemId":"module"},"children":[{"configs":{"oracle":"SELECT \n    h.AP_INV_GL_H_ID,\n    h.AP_INV_GL_H_CODE,\n    h.GL_DATE,\n    h.DESCRIPTION,\n    NVL(h.INV_AMOUNT,0) AS INV_AMOUNT,\n    NVL(h.OCCUPY_AMT,0) AS OCCUPY_AMT,\n    (NVL(h.NO_PAY_AMT,0) - NVL(h.OCCUPY_AMT,0) ) AS YUE,\n    h.VENDOR_ID,\n    h.DEPT_ID,\n    h.PROJECT_ID,\n    h.AP_CONTRACT_ID,\n    h.AP_ACC_ID_DEBT AS ACC_ID,\n    h.AP_CCID_DEBT AS CCID,\n    h.CREATED_BY,\n    vendor.VENDOR_NAME,\n    project.PROJECT_NAME,\n    dept.DEPT_NAME,\n    contract.AP_CONTRACT_NAME,\n    account.ACC_NAME,\n    ccid.CCID_NAME,\n    emp.EMP_NAME AS CREATED_BY_NAME\nFROM \n    xc_ap_inv_gl_h h\n        LEFT JOIN xc_gl_ledgers ledger ON ledger.LEDGER_ID = h.LEDGER_ID\n        LEFT JOIN xc_ap_vendors vendor ON vendor.VENDOR_ID = h.VENDOR_ID\n        LEFT JOIN xc_pm_projects project ON project.PROJECT_ID = h.PROJECT_ID\n        LEFT JOIN xip_pub_depts dept ON dept.DEPT_ID = h.DEPT_ID\n        LEFT JOIN xc_ap_contract contract ON contract.AP_CONTRACT_ID = h.AP_CONTRACT_ID\n        LEFT JOIN xc_gl_accounts account ON account.ACC_ID = h.AP_ACC_ID_DEBT\n        LEFT JOIN xc_gl_ccid ccid ON ccid.CCID = h.AP_CCID_DEBT\n        LEFT JOIN xip_pub_emps emp ON emp.EMP_ID = (SELECT EMP_ID FROM xip_pub_users WHERE USER_ID=h.CREATED_BY)\nWHERE \n\th.LEDGER_ID = {?varchar.LEDGER_ID?}\nAND h.VENDOR_ID = {?varchar.VENDOR_ID?}\nAND h.V_STATUS>=3\nAND h.AP_INV_GL_H_CODE IS NOT NULL\nAND h.AP_INV_GL_H_CODE <> ''\n{#sql#}\nAND ( h.AP_INV_GL_H_CODE LIKE '%{#AP_INV_GL_H_CODE#}%' OR h.DESCRIPTION LIKE '%{#AP_INV_GL_H_CODE#}%')\nAND emp.EMP_NAME LIKE '%{#CREATED_BY_NAME#}%'\nORDER BY h.CREATION_DATE DESC","itemId":"sqlswitcher1","mysql":"SELECT \n    h.AP_INV_GL_H_ID,\n    h.AP_INV_GL_H_CODE,\n    h.GL_DATE,\n    h.DESCRIPTION,\n    IFNULL(h.INV_AMOUNT,0) AS INV_AMOUNT,\n    IFNULL(h.OCCUPY_AMT,0) AS OCCUPY_AMT,\n    (IFNULL(h.NO_PAY_AMT,0) - IFNULL(h.OCCUPY_AMT,0) ) AS YUE,\n    h.VENDOR_ID,\n    h.DEPT_ID,\n    h.PROJECT_ID,\n    h.AP_CONTRACT_ID,\n    h.AP_ACC_ID_DEBT AS ACC_ID,\n    h.AP_CCID_DEBT AS CCID,\n    h.CREATED_BY,\n    vendor.VENDOR_NAME,\n    project.PROJECT_NAME,\n    dept.DEPT_NAME,\n    contract.AP_CONTRACT_NAME,\n    account.ACC_NAME,\n    ccid.CCID_NAME,\n    emp.EMP_NAME AS CREATED_BY_NAME\nFROM \n    xc_ap_inv_gl_h h\n        LEFT JOIN xc_gl_ledgers ledger ON ledger.LEDGER_ID = h.LEDGER_ID\n        LEFT JOIN xc_ap_vendors vendor ON vendor.VENDOR_ID = h.VENDOR_ID\n        LEFT JOIN xc_pm_projects project ON project.PROJECT_ID = h.PROJECT_ID\n        LEFT JOIN xip_pub_depts dept ON dept.DEPT_ID = h.DEPT_ID\n        LEFT JOIN xc_ap_contract contract ON contract.AP_CONTRACT_ID = h.AP_CONTRACT_ID\n        LEFT JOIN xc_gl_accounts account ON account.ACC_ID = h.AP_ACC_ID_DEBT\n        LEFT JOIN xc_gl_ccid ccid ON ccid.CCID = h.AP_CCID_DEBT\n        LEFT JOIN xip_pub_emps emp ON emp.EMP_ID = (SELECT EMP_ID FROM xip_pub_users WHERE USER_ID=h.CREATED_BY)\nWHERE \n\th.LEDGER_ID = {?varchar.LEDGER_ID?}\nAND h.VENDOR_ID = {?varchar.VENDOR_ID?}\nAND h.V_STATUS>=3\nAND h.AP_INV_GL_H_CODE IS NOT NULL\nAND h.AP_INV_GL_H_CODE <> ''\n{#sql#}\nAND ( h.AP_INV_GL_H_CODE LIKE '%{#AP_INV_GL_H_CODE#}%' OR h.DESCRIPTION LIKE '%{#AP_INV_GL_H_CODE#}%')\nAND emp.EMP_NAME LIKE '%{#CREATED_BY_NAME#}%'\nORDER BY h.CREATION_DATE DESC"},"children":[],"expanded":false,"type":"sqlswitcher"},{"configs":{"sql":"{#sqlswitcher1#}","itemId":"dataprovider1"},"children":[],"expanded":false,"type":"dataprovider"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}