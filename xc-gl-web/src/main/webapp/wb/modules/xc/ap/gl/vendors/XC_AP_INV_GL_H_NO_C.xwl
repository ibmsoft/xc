{"inframe":false,"title":"拆分出来的应付单无容器模式","hidden":false,"roles":{"default":1},"children":[{"configs":{"serverScript":"var contextPath = request.getContextPath();\nrequest.setAttribute(\"contextPath\",contextPath);\ncom.xzsoft.xip.platform.util.XipUtil.getCurrentLang(request,'xc/ap/gl/vendors/json/XC_AP_INV_GL_H_NO_C');","itemId":"module"},"events":{"initialize":"Wb.isInsert = 'Y'; //操作类型\nvar init = '0';\nExt.apply(app, {\n  initWin: function(params) {\n    Ext.apply(app, params);\n    app.editWinN = new Ext.window.Window(app.editWinN);\n    app.editWinN.show();\n    Wb.IsInsert = params.IS_INSERT;\n    Wb.AP_INV_GL_H_ID = params.AP_INV_GL_H_ID;\n    if (Wb.IsInsert == 'Y') {\n      init = '0';\n    } else {\n      init = '1';\n      Wb.AP_INV_H_ID = params.AP_INV_H_ID;\n    }\n    Wb.request({\n      url: 'm?xwl=xc/ap/gl/LOV/DB/LOV_XC_AP_INV_DETAIL_H',\n      //后台java代码生成\n      method: 'POST',\n      async: false,\n      //异步传参\n      params: {\n        AP_INV_GL_H_ID: Wb.AP_INV_GL_H_ID,\n        INIT: init\n      },\n      success: function(resp) {\n        var r = Wb.decode(resp.responseText);\n        Wb.request({\n          url: 'm?xwl=xc/ap/gl/vendors/DB/XC_AP_SELECT_DATE',\n          //后台java代码生成\n          method: 'POST',\n          async: false,\n          //异步传参\n          params: {\n            LEDGER_ID:r.LEDGER_ID\n          },\n          success: function(respDate) {\n\n            var rDate = Wb.decode(respDate.responseText);\n\n            r.GL_DATE = rDate.LAST_M_DATE;\n            Wb.setValue(app.editWinN, r);//赋值\n            if (Wb.IsInsert == 'Y') {\n              Wb.request({\n                url:'m?xwl=xc/ap/gl/vendors/DB/getSplitAmount',\n                params:{'AP_INV_GL_H_ID':Wb.AP_INV_GL_H_ID,'sql':'1=1'},\n                success:function(resp){\n                  var rec = Wb.decode(resp.responseText);\n                  app.AMOUNT.setValue(rec.rows[0].amount);\n\n                }\n              });\n            }else{\n\n            }\n\n            if (!Wb.isEmpty(r.VENDOR_ID)) {\n              app.VENDOR_ID_XWL.VENDOR_NAME.setReadOnly(true);\n            }else if(r.VENDOR_ID=='00'){\n              app.VENDOR_ID_XWL.VENDOR_NAME.setReadOnly(false);\n              app.VENDOR_ID_XWL.QUERY_LEDGER_ID.setValue(r.LEDGER_ID);\n            }\n            app.AP_CONTRACT_ID_XWL.QUERY_LEDGER_ID.setValue(r.LEDGER_ID);\n            app.AP_CONTRACT_ID_XWL.QUERY_VENDOR_ID.setValue(app.VENDOR_ID_XWL.VENDOR_ID.getValue());\n            app.PROJECT_ID_XWL.QUERY_LEDGER_ID.setValue(r.LEDGER_ID);\n            app.PROJECT_ID_XWL.QUERY_DEPT_ID.setValue(app.DEPT_ID_XWL.DEPT_ID.getValue());\n            app.DEPT_ID_XWL.QUERY_LEDGER_ID.setValue(r.LEDGER_ID);\n            app.LEDGER_ID_XWL.LEDGER_NAME.setReadOnly(true);\n            app.AP_ACC_ID_DEBT_XWL.AP_ACC_NAME_DEBT.setReadOnly(true);\n            if (Wb.IsInsert == 'Y') {\n              app.AP_INV_H_ID.setValue(r.AP_INV_GL_H_ID);\n              app.AP_INV_GL_H_ID.setValue(Xip.getId());\n            }\n\n          }\n        });\n\n      }\n    });\n\n  }\n});\n\nfunction returnRowFn(r, type) {\n  if (type == 'xc_gl_ledgers') {\n    app.VENDOR_ID_XWL.QUERY_LEDGER_ID.setValue(r.data.LEDGER_ID);\n    app.PROJECT_ID_XWL.QUERY_LEDGER_ID.setValue(r.data.LEDGER_ID);\n    app.DEPT_ID_XWL.QUERY_LEDGER_ID.setValue(r.data.LEDGER_ID);\n    app.AP_ACC_ID_TAX_XWL.QUERY_LEDGER_ID.setValue(r.data.LEDGER_ID);\n    app.AP_ACC_ID_DEBT_XWL.QUERY_LEDGER_ID.setValue(r.data.LEDGER_ID);\n    app.AP_CONTRACT_ID_XWL.QUERY_LEDGER_ID.setValue(r.data.LEDGER_ID);\n  }\n  if(type == 'xc_ap_vendors'){\n    app.AP_CONTRACT_ID_XWL.QUERY_VENDOR_ID.setValue(r.data.VENDOR_ID);\n     app.AP_CONTRACT_ID_XWL.AP_CONTRACT_NAME.setValue('');\n  }\n  if(type==\"xip_pub_depts\"){\n    app.PROJECT_ID_XWL.QUERY_DEPT_ID.setValue(r.data.DEPT_ID);\n    app.PROJECT_ID_XWL.PROJECT_NAME.setValue('');\n  }\n}\nfunction clearOtherFn(type) {\n  if (type == 'xc_gl_ledgers') {\n  }\n  if(type == 'xc_ap_vendors'){\n    app.AP_CONTRACT_ID_XWL.AP_CONTRACT_NAME.setValue('');\n  }\n  if(type==\"xip_pub_depts\"){\n    app.PROJECT_ID_XWL.PROJECT_NAME.setValue('');\n  }\n}"},"children":[{"configs":{"itemId":"winTbar"},"children":[{"configs":{"text":"{#save#}","itemId":"saveBtn","iconCls":"save_icon"},"events":{"click":"if(app.AMOUNT.getValue()==0){\n  Wb.toast('{#saveMsg4#}');\n  return;\n}\nif(Wb.IsInsert=='Y'){\n  Wb.request({\n    url:'m?xwl=xc/ap/gl/vendors/DB/getSplitAmount',\n    params:{'AP_INV_GL_H_ID':Wb.AP_INV_GL_H_ID,'sql':'1=1'},\n    success:function(resp){\n      var rec = Wb.decode(resp.responseText);\n      if(app.AMOUNT.getValue()>rec.rows[0].amount){\n        app.AMOUNT.setValue(rec.rows[0].amount);\n        Wb.toast('{#editorMsg1#}');\n      }else{\n        if (app.form1.isValid()) {\n\n          Wb.request({\n            url: 'm?xwl=xc/ap/gl/DB/XC_AP_INV_GL_H_PUB_ERROR_ALERT',\n            async:false,\n            params: {\n              AP_INV_GL_H_ID: app.AP_INV_GL_H_ID.getValue(),\n              AP_INV_H_ID: app.AP_INV_H_ID.getValue(),\n              AMOUNT:app.AMOUNT.getValue(),\n              sql: 'SELECT 1 '+\n              ' FROM xc_ap_inv_gl_h WHERE AP_INV_GL_H_ID={?AP_INV_H_ID?} '+\n              ' and ABS(AMOUNT)+ '+\n              ' IFNULL((SELECT ABS(AMOUNT) '+\n              ' FROM xc_ap_inv_gl_h WHERE AP_INV_GL_H_ID={?AP_INV_GL_H_ID?} ),0)- '+\n              ' IFNULL((SELECT SUM(ABS(AMOUNT))+{?decimal.AMOUNT?} '+\n              ' FROM xc_ap_inv_gl_h WHERE AP_INV_H_ID={?AP_INV_H_ID?} ),{?decimal.AMOUNT?})<0 ',\n              errorMsg: '{#saveMsg1#}'\n            },\n            success: function(resp) {\n              Wb.request({\n                url:'{#contextPath#}'+'/apInvGlCommonAction.do?method=split',\n                async:false,\n                params:{'json':Wb.getValue(app.form1)},\n                success:function(resp){\n                  var rec = Wb.decode(resp.responseText);\n                  if(rec.flag=='0'){\n                    Wb.toast('{#saveMsg2#}');\n                    Wb.IsInsert = 'N';\n                    app.AP_INV_GL_H_CODE.setValue(rec.code);\n                  }else if(rec.flag=='1'){\n                    Wb.toast(rec.msg);\n                  }\n                }\n              });\n            }\n          });\n        } else {\n          Wb.toast('{#saveMsg3#}');\n          return;\n        }\n      }\n    }\n  });\n}else{\n  var sql = 'b.AP_INV_GL_H_ID !='+\"'\"+Wb.AP_INV_GL_H_ID+\"'\";\n  Wb.request({\n    url:'m?xwl=xc/ap/gl/vendors/DB/getSplitAmount1',\n    params:{'AP_INV_GL_H_ID':app.AP_INV_H_ID.getValue(),'sql':sql,'invGlHId':app.AP_INV_GL_H_ID.getValue()},\n    success:function(resp){\n      var rec = Wb.decode(resp.responseText);\n      if(app.AMOUNT.getValue()>rec.rows[0].amount){\n        app.AMOUNT.setValue(rec.rows[0].amount);\n        Wb.toast('{#editorMsg1#}');\n      }else{\n        if (app.form1.isValid()) {\n\n          Wb.request({\n            url: 'm?xwl=xc/ap/gl/DB/XC_AP_INV_GL_H_PUB_ERROR_ALERT',\n            async:false,\n            params: {\n              AP_INV_GL_H_ID: app.AP_INV_GL_H_ID.getValue(),\n              AP_INV_H_ID: app.AP_INV_H_ID.getValue(),\n              AMOUNT:app.AMOUNT.getValue(),\n              sql: 'SELECT 1 '+\n              ' FROM xc_ap_inv_gl_h WHERE AP_INV_GL_H_ID={?AP_INV_H_ID?} '+\n              ' and ABS(AMOUNT)+ '+\n              ' IFNULL((SELECT ABS(AMOUNT) '+\n              ' FROM xc_ap_inv_gl_h WHERE AP_INV_GL_H_ID={?AP_INV_GL_H_ID?} ),0)- '+\n              ' IFNULL((SELECT SUM(ABS(AMOUNT))+{?decimal.AMOUNT?} '+\n              ' FROM xc_ap_inv_gl_h WHERE AP_INV_H_ID={?AP_INV_H_ID?} ),{?decimal.AMOUNT?})<0 ',\n              errorMsg: '{#saveMsg1#}'\n            },\n            success: function(resp) {\n              Wb.request({\n                url:'{#contextPath#}'+'/apInvGlCommonAction.do?method=split',\n                async:false,\n                params:{'json':Wb.getValue(app.form1)},\n                success:function(resp){\n                  var rec = Wb.decode(resp.responseText);\n                  if(rec.flag=='0'){\n                    Wb.toast('{#saveMsg2#}');\n                    Wb.IsInsert = 'N';\n                    app.AP_INV_GL_H_CODE.setValue(rec.code);\n                  }else if(rec.flag=='1'){\n                    Wb.toast(rec.msg);\n                  }\n                }\n              });\n            }\n          });\n        } else {\n          Wb.toast('{#saveMsg3#}');\n          return;\n        }\n      }\n    }\n  });\n}\n\n"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"tbar":"app.winTbar","maximized":"true","layout":"fit","itemId":"editWinN"},"events":{"close":"app.hideFun();"},"children":[{"configs":{"region":"north","border":"false","itemId":"form1"},"children":[{"configs":{"text":"{#label#}","style":"fontSize:20px","margin":"10 0 20 0","labelAlign":"center","itemId":"label1"},"children":[],"expanded":false,"type":"label"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"column","itemId":"tr1"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_1_1"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/LEDGER_ID_PICK/LEDGER_ID_PICK_SEC","itemId":"LEDGER_ID_XWL"},"children":[],"expanded":false,"type":"xwl"},{"configs":{"hidden":"true","itemId":"AP_INV_GL_H_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"AP_INV_H_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"INIT"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","value":"{#XIP.userId#}","itemId":"USER_ID","fieldLabel":"USER_ID"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_1_2"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","allowBlank":"false","pickList":"[['YFD','{#shoulePayDoc#}']]","labelAlign":"right","itemId":"AP_DOC_CAT_CODE","fieldLabel":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#docType#}"},"events":{"select":"if(combo.getValue()=='YFD'){\n  app.tr4.hide();\n}else{\n  app.tr4.show();\n}"},"children":[],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_1_3"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"AP_INV_GL_H_CODE","fieldLabel":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#docCode#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_1_4"},"children":[{"configs":{"labelWidth":"80","readOnly":"true","labelAlign":"right","itemId":"GL_DATE","fieldLabel":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#glDate#}"},"children":[],"expanded":false,"type":"date"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"column","itemId":"tr2"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_2_1"},"children":[{"configs":{"file":"m?xwl=xc/ap/gl/VENDOR_ID_PICK/VENDOR_ID_LD","itemId":"VENDOR_ID_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_1_3"},"children":[{"configs":{"file":"m?xwl=xc/ap/gl/DEPT_ID_PICK/DEPT_ID_LD","itemId":"DEPT_ID_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":false,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_2_2"},"children":[{"configs":{"file":"m?xwl=xc/com-lov/PROJECT_ID_PICK/PROJECT_ID_LD","itemId":"PROJECT_ID_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":false,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_2_4"},"children":[{"configs":{"file":"m?xwl=xc/ap/ap-com-lov/AP_CONTRACT_ID_PICK/AP_CONTRACT_ID_PICK_ALL","itemId":"AP_CONTRACT_ID_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"column","itemId":"tr3"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_3_1"},"children":[{"configs":{"file":"m?xwl=xc/ap/ap-com-lov/ACC_ID_PICK/AP_ACC_ID_DEBT","itemId":"AP_ACC_ID_DEBT_XWL"},"children":[],"expanded":false,"type":"xwl"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_3_2"},"children":[{"configs":{"labelWidth":"80","allowBlank":"false","minValue":"0","labelAlign":"right","itemId":"AMOUNT","fieldLabel":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#amount#}"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".490","itemId":"td_3_3"},"children":[{"configs":{"labelWidth":"80","allowBlank":"false","labelAlign":"right","itemId":"DESCRIPTION","fieldLabel":"<span style=\"color: rgb(255, 0, 0);\">*<\/span>{#description#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","hidden":"true","layout":"column","itemId":"tr4"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_4_1"},"children":[{"configs":{"file":"m?xwl=xc/ap/ap-com-lov/ACC_ID_PICK/AP_ACC_ID_TAX","itemId":"AP_ACC_ID_TAX_XWL"},"children":[],"expanded":false,"type":"xwl"},{"configs":{"itemId":"AP_CCID_DEBT"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_4_2"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"TAX_AMT","fieldLabel":"{#tax#}"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".245","itemId":"td_4_3"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"TAX_RATE","fieldLabel":"{#taxRate#}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":false,"type":"panel"}],"expanded":true,"type":"form"}],"expanded":true,"type":"window"}],"expanded":true,"type":"module"}],"pageLink":"{container:false}","iconCls":""}