{"inframe":false,"title":"","hidden":false,"roles":{"default":1},"children":[{"configs":{"serverScript":"var data = app.get();\nvar sql = \"\";\n\n//合同\nif(Wb.isEmpty(data.AP_CONTRACT_ID)){\n  sql += \" AND (h.AP_CONTRACT_ID is null or h.AP_CONTRACT_ID = '')\";\n}else{\n  sql += \" AND h.AP_CONTRACT_ID = '\"+data.AP_CONTRACT_ID+\"'\";\n}\n//项目\nif(!Wb.isEmpty(data.PROJECT_ID)){\n  sql += \" and h.PROJECT_ID = '\"+data.PROJECT_ID+\"'\";\n}\n\n// if (!Wb.isEmpty(data.AP_PAY_REQ_H_CODE)) {\n//     sql+=' and (h.AP_PAY_REQ_H_CODE like \\'%'+data.AP_PAY_REQ_H_CODE+'%\\' ';\n//     sql+=' or h.DESCRIPTION like \\'%'+data.AP_PAY_REQ_H_CODE+'%\\' )';\n// }\n// if (!Wb.isEmpty(data.CREATED_BY_NAME)) {\n//   sql+=' and CREATED_BY_NAME like \\'%'+data.CREATED_BY_NAME+'%\\' ';\n// }\n\nrequest.setAttribute('sql', sql);","itemId":"module"},"children":[{"configs":{"oracle":"SELECT \n    l.AP_PAY_REQ_L_ID,\n    l.AP_PAY_REQ_H_ID,\n    l.AP_PUR_TYPE_ID,\n    NVL(l.AMOUNT,0) AS AMOUNT,\n    NVL(l.PAID_AMT,0) AS PAID_AMT,\n    NVL(l.NO_PAY_AMT,0) AS NO_PAY_AMT,\n    l.DESCRIPTION,\n    h.AP_PAY_REQ_H_CODE,\n    h.BIZ_DATE,\n    h.LEDGER_ID,\n    h.VENDOR_ID,\n    h.DEPT_ID,\n    h.PROJECT_ID,\n    h.AP_CONTRACT_ID,\n    h.CREATED_BY,\n    pur.AP_PUR_TYPE_NAME,\n    ledger.LEDGER_NAME,\n    vendor.VENDOR_NAME,\n    project.PROJECT_NAME,\n    dept.DEPT_NAME,\n    contract.AP_CONTRACT_NAME,\n    emp.EMP_NAME AS CREATED_BY_NAME\nFROM \n  \txc_ap_pay_req_l l\n\t\tLEFT JOIN xc_ap_pur_type pur ON pur.AP_PUR_TYPE_ID = l.AP_PUR_TYPE_ID,\n    xc_ap_pay_req_h h\n        LEFT JOIN xc_gl_ledgers ledger ON ledger.LEDGER_ID = h.LEDGER_ID\n        LEFT JOIN xc_ap_vendors vendor ON vendor.VENDOR_ID = h.VENDOR_ID\n        LEFT JOIN xc_pm_projects project ON project.PROJECT_ID = h.PROJECT_ID\n        LEFT JOIN xip_pub_depts dept ON dept.DEPT_ID = h.DEPT_ID\n        LEFT JOIN xc_ap_contract contract ON contract.AP_CONTRACT_ID = h.AP_CONTRACT_ID\n        LEFT JOIN xip_pub_emps emp ON emp.EMP_ID = (SELECT EMP_ID FROM xip_pub_users WHERE USER_ID=h.CREATED_BY)\nWHERE \n\tl.AP_PAY_REQ_H_ID = h.AP_PAY_REQ_H_ID\nAND h.IS_CLOSE = 'N'\nAND h.AUDIT_STATUS = 'E'\nAND l.NO_PAY_AMT > 0\nAND h.AP_DOC_CAT_CODE = 'QTFK'\nAND h.LEDGER_ID = {?varchar.LEDGER_ID?}\nAND h.VENDOR_ID = {?varchar.VENDOR_ID?}\n{#sql#}\nAND (h.AP_PAY_REQ_H_CODE LIKE '%{#AP_PAY_REQ_H_CODE#}%' OR l.DESCRIPTION LIKE '%{#AP_PAY_REQ_H_CODE#}%')\nAND emp.EMP_NAME LIKE '%{#CREATED_BY_NAME#}%'\nORDER BY h.CREATION_DATE DESC","itemId":"sqlswitcher1","mysql":"SELECT \n    l.AP_PAY_REQ_L_ID,\n    l.AP_PAY_REQ_H_ID,\n    l.AP_PUR_TYPE_ID,\n    IFNULL(l.AMOUNT,0) AS AMOUNT,\n    IFNULL(l.PAID_AMT,0) AS PAID_AMT,\n    IFNULL(l.NO_PAY_AMT,0) AS NO_PAY_AMT,\n    l.DESCRIPTION,\n    h.AP_PAY_REQ_H_CODE,\n    h.BIZ_DATE,\n    h.LEDGER_ID,\n    h.VENDOR_ID,\n    h.DEPT_ID,\n    h.PROJECT_ID,\n    h.AP_CONTRACT_ID,\n    h.CREATED_BY,\n    pur.AP_PUR_TYPE_NAME,\n    ledger.LEDGER_NAME,\n    vendor.VENDOR_NAME,\n    project.PROJECT_NAME,\n    dept.DEPT_NAME,\n    contract.AP_CONTRACT_NAME,\n    emp.EMP_NAME AS CREATED_BY_NAME\nFROM \n  \txc_ap_pay_req_l l\n\t\tLEFT JOIN xc_ap_pur_type pur ON pur.AP_PUR_TYPE_ID = l.AP_PUR_TYPE_ID,\n    xc_ap_pay_req_h h\n        LEFT JOIN xc_gl_ledgers ledger ON ledger.LEDGER_ID = h.LEDGER_ID\n        LEFT JOIN xc_ap_vendors vendor ON vendor.VENDOR_ID = h.VENDOR_ID\n        LEFT JOIN xc_pm_projects project ON project.PROJECT_ID = h.PROJECT_ID\n        LEFT JOIN xip_pub_depts dept ON dept.DEPT_ID = h.DEPT_ID\n        LEFT JOIN xc_ap_contract contract ON contract.AP_CONTRACT_ID = h.AP_CONTRACT_ID\n        LEFT JOIN xip_pub_emps emp ON emp.EMP_ID = (SELECT EMP_ID FROM xip_pub_users WHERE USER_ID=h.CREATED_BY)\nWHERE \n\tl.AP_PAY_REQ_H_ID = h.AP_PAY_REQ_H_ID\nAND h.IS_CLOSE = 'N'\nAND h.AUDIT_STATUS = 'E'\nAND l.NO_PAY_AMT > 0\nAND h.AP_DOC_CAT_CODE = 'QTFK'\nAND h.LEDGER_ID = {?varchar.LEDGER_ID?}\nAND h.VENDOR_ID = {?varchar.VENDOR_ID?}\n{#sql#}\nAND (h.AP_PAY_REQ_H_CODE LIKE '%{#AP_PAY_REQ_H_CODE#}%' OR l.DESCRIPTION LIKE '%{#AP_PAY_REQ_H_CODE#}%')\nAND emp.EMP_NAME LIKE '%{#CREATED_BY_NAME#}%'\nORDER BY h.CREATION_DATE DESC"},"children":[],"expanded":false,"type":"sqlswitcher"},{"configs":{"sql":"{#sqlswitcher1#}","itemId":"dataprovider1"},"children":[],"expanded":false,"type":"dataprovider"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}