{"inframe":true,"title":"我的付款申请","hidden":false,"roles":{"default":1},"children":[{"configs":{"serverScript":"var ctxPath = request.getContextPath() ;\nrequest.setAttribute('contextPath',ctxPath);","itemId":"module"},"events":{"initialize":"var hold='false';\nvar docCatCode;\nWb.apply(app,{\n  init:function(x){\n    mainNav=x;\n\n  },\n   addYUFK:\n  function(rec,handler){\n    var url='m?xwl=xc/ap/touch/req/xc_ap_pay_req';\n    var title='预付款';\n    docCatCode='YUFK';\n    getURLAndTitle(url,title);\n},\n  addCGJS:function(rec,handler){\n    var url='m?xwl=xc/ap/touch/req/xc_ap_pay_req';\n    var title='采购结算';\n    docCatCode='CGJS';\n   getURLAndTitle(url,title);\n}\n});\nfunction getURLAndTitle(url,title){\n  var found;\n  mainNav.items.each(function(item) {\n  if (item.__url == url) {\n    found = true;\n    mainNav.setActiveItem(item);\n    \n    return;\n  }\n});\nif (found)\n  return;\n\nWb.run({\n  url: url,\n  params:{'op':'write','docCatCode':docCatCode},\n  success: function(scope) {\n    if(scope.flashStore){\n      scope.flashStore(app.list1);\n    }\n    \n    Wb.each(scope, function(k, v) {\n      if (v && (v.isViewport || v.initialConfig && v.initialConfig.isViewport)) {\n        if(scope.init){\n          scope.init(mainNav);\n        }\n       \n        var newCard = Ext.create('Ext.Container',{\n          layout: 'fit',\n          title:title\n        });\n        newCard.add(v);\n        newCard._title=title;\n        newCard.__url = url;\n        mainNav.push(newCard);\n        return false;\n      }\n    });\n  }\n});\n\n};"},"children":[{"configs":{"height":"200","hidden":"true","width":"180","layout":"fit","left":"0","itemId":"menu","modal":"true","top":"0","hideOnMaskTap":"true"},"children":[{"configs":{"itemTpl":"<div style='height:40px'>&nbsp&nbsp&nbsp&nbsp&nbsp{text}<\/div>","scrollable":"false","padding":"8","itemId":"dataview1"},"events":{"itemtap":"app.menu.hide();\nrecord.get('handler')();"},"children":[{"configs":{"data":" [{\n   text: '预付款',\n   handler: app.addYUFK\n }, {\n   text: '采购结算',\n   handler: app.addCGJS\n }]","itemId":"store","fields":"['text','handler']"},"children":[],"expanded":false,"type":"tstore"}],"expanded":true,"type":"tdataview"}],"expanded":true,"type":"tpanel"},{"configs":{"appGlyph":"f015","layout":"fit","itemId":"viewport1"},"children":[{"configs":{"title":"我的付款申请","layout":"fit","itemId":"container1"},"events":{"initialize":"app.ledgerSel.getStore().load({\ncallback:function(){\napp.ledgerSel.setValue(app.ledgerSel.getStore().getAt(0));//查询账簿赋初值\n}\n});//加载账簿\napp.list1.getStore().load({params:{'ledger_id':app.ledgerSel.getValue()}});//加载列表\n"},"children":[{"configs":{"docked":"top","itemId":"toolbar2"},"children":[{"configs":{"labelWidth":"50","height":"50","displayField":"LEDGER_NAME","width":"265","valueField":"LEDGER_ID","label":"<font color=\"red\">*<\/font>账簿:","labelAlign":"left","itemId":"ledgerSel"},"events":{"change":"app.list1.getStore().reload({params:{'ledger_id':newValue}});//加载列表"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/com-qry/gl-ledgers/select-sec-fd-ledgers"},"children":[],"expanded":false,"type":"tstore"}],"expanded":true,"type":"tselect"}],"expanded":true,"type":"ttoolbar"},{"configs":{"docked":"top","style":"background:0;border-bottom:1px #C0C0C0 solid","itemId":"toolbar1"},"children":[{"configs":{"ui":"action","glyph":"f067","margin":"0 -6 0 0","itemId":"menuBtn"},"events":{"tap":"app.menu.showBy(button);"},"children":[],"expanded":false,"type":"tbutton"},{"configs":{"placeHolder":"输入供应商编码/名称","height":"50","width":"265","padding":"2 0","itemId":"vendor"},"children":[],"expanded":false,"type":"ttext"},{"configs":{"ui":"action","glyph":"f002","margin":"0 0 0 -6","itemId":"selectBtn"},"events":{"tap":"app.list1.store.load({\nparams:{\nvendor_code:app.vendor.getValue(),\n ledger_id:app.ledgerSel.getValue()\n}\n});"},"children":[],"expanded":false,"type":"tbutton"},{"configs":{"hidden":"true","itemId":"ledger"},"children":[],"expanded":false,"type":"ttext"},{"configs":{"hidden":"true","itemId":"dept"},"children":[],"expanded":false,"type":"ttext"}],"expanded":true,"type":"ttoolbar"},{"configs":{"style":"background:0","itemTpl":"<div style=\"width:100%\">\n  <div style=\"margin:5px 0px;width:100%;height:33%\">\n         <div style=\"float:left;width:65%;height:33%\">编　号:{AP_PAY_REQ_H_CODE}<\/div>\n         <div style=\"float:left;width:35%;height:100%\"> 单据类型:{ap_cat_name} <\/div>\n  <\/div>\n <div style=\"margin:5px 0px;width:100%;height:33%\">\n         <div style=\"float:left;;width:65%;height:33%\">供应商:{vendor_name}<\/div>\n         <div style=\"float:left;width:35%;height:100%\"> 申请金额:{AMOUNT}<\/div>\n <\/div>\n <div style=\"margin:5px 0px 5px;height:33%\">\n         <div style=\"float:left;width:65%;height:33%;\">摘　要:{DESCRIPTION}<\/div>\n         <div style=\"width:100%;word-wrap:break-word;word-break:break-all;\"> 状　　态:{SYS_AUDIT_STATUS_DESC}<\/div>\n <\/div>\n  <\/div>","autoPaging":"true","itemId":"list1"},"events":{"itemtap":"if(hold==='true'){\nreturn false;\n}\nvar payReqHId = record.data.AP_PAY_REQ_H_ID;\nvar status = record.data.AUDIT_STATUS;\nvar docCatCode = record.data.AP_DOC_CAT_CODE;\nvar url = record.data.url;\nvar found;\nmainNav.items.each(function(item) {\n  if (item.__url == url) {\n    found = true;\n   mainNav.setActiveItem(item);\n    return;\n  }\n});\nif (found)\n  return;\nWb.run({\n  url: url,\n  params:{'ap_pay_req_h_id':payReqHId,'op':'write','status':status,'docCatCode':docCatCode},\n  success: function(scope) {\n     \n    if(scope.flashStore){\n      scope.flashStore(app.list1);\n    }\n    /*if(scope.ledgerSel){\n      scope.ledgerSel(app.ledger,app.dept);\n    }*/\n    Wb.each(scope, function(k, v) {\n      if (v && (v.isViewport || v.initialConfig && v.initialConfig.isViewport)) {\n        if(scope.initViewPort){\n          scope.initViewPort(mainNav);\n        }\n        if(scope.init){\n          scope.init(mainNav);\n        }\n        var newCard = Ext.create('Ext.Container',{\n          layout: 'fit',\n          title:record.get('ap_cat_name')\n        });\n        newCard.add(v);\n        newCard.__AP_PAY_REQ_H_CODE = record.get('AP_PAY_REQ_H_CODE');\n       \tnewCard.__ap_cat_name = record.get('ap_cat_name');\n       \tnewCard.__vendor_name = record.get('vendor_name');\n        newCard.__AMOUNT = record.get('AMOUNT');\n        newCard.__DESCRIPTION = record.get('DESCRIPTION');\n        newCard.__AUDIT_STATUS_DESC = record.get('AUDIT_STATUS_DESC');\n        newCard.__url = url;\n        mainNav.push(newCard);\n        app.list1.store.load();\n        return false;\n      }\n    });\n  }\n});\n\n","itemtaphold":"hold='true';\nif(record.get('AUDIT_STATUS')==='C'){\n  Wb.info('该单据状态为进行中,不能删除!');\n  return false;\n}\nif(record.get('AUDIT_STATUS')==='E'){\n  Wb.info('该单据已审批结束,不能删除!');\n  return false;\n}\nvar ids = [];\nExt.Msg.confirm('提示','确定删除'+record.get('AP_PAY_REQ_H_CODE')+'吗?',function(btn){\n  var docCatCode = record.get('AP_DOC_CAT_CODE');\n  if(btn=='yes'){\n    var id = {'id':record.get('AP_PAY_REQ_H_ID')};\n    ids.push(id);\n    Wb.request({\n      url:'{#contextPath#}' + '/apPayReqCommonAction.do?method=delPayReq',\n      params:{'payReqHId':ids},\n      success: function(resp) {\n        var rec = Wb.decode(resp.responseText);\n        if(rec.flag=='0'){\n          Wb.info('删除成功！');         \n          app.list1.getStore().reload();\n        }else if(rec.flag=='1'){\n          Wb.info(rec.msg);\n        } \n      }\n    });\n  }else{\n  \t hold='false';\n  }\n    \n     \n});\n"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/ap/touch/req/xc_ap_pay_req_myDB/getPayReqH"},"children":[],"expanded":false,"type":"tstore"}],"expanded":true,"type":"tlist"}],"expanded":true,"type":"tcontainer"}],"expanded":true,"type":"tviewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}