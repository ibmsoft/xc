{"inframe":false,"title":"","hidden":false,"roles":{"default":1},"children":[{"configs":{"itemId":"module"},"children":[{"configs":{"maximized":"true","height":"350","width":"600","layout":"border","closeAction":"hide","buttonAlign":"center","itemId":"win","modal":"true","maximizable":"true"},"events":{"close":"app.grid.getStore().load();"},"children":[{"configs":{"region":"north","height":"75","bodyPadding":"10 20 0 10","itemId":"mainForm"},"children":[{"configs":{"hidden":"true","itemId":"hiddenPanel"},"children":[{"configs":{"itemId":"H_ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"OP_TYPE"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"style":"border-width:0px;","layout":"column","border":"false","itemId":"t1"},"children":[{"configs":{"style":"border-width:0px;","layout":"form","columnWidth":".33","border":"false","itemId":"d1"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"PO_CODE","fieldLabel":"PO Code"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"style":"border-width:0px;","layout":"form","columnWidth":".33","border":"false","itemId":"d2"},"children":[{"configs":{"labelWidth":"80","pickList":"[['Vender01','Vender01'],['Vender02','Vender02']]","labelAlign":"right","itemId":"VENDER","fieldLabel":"Vender"},"children":[],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"style":"border-width:0px;","layout":"form","columnWidth":".33","border":"false","itemId":"d3"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"CONTRACT","fieldLabel":"Contract"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"style":"border-width:0px;","layout":"column","border":"false","itemId":"t2"},"children":[{"configs":{"style":"border-width:0px;","layout":"form","columnWidth":".33","border":"false","itemId":"d1"},"children":[{"configs":{"labelWidth":"80","pickList":"[['Proj01','Proj01'],['Proj02','Proj02']]","labelAlign":"right","itemId":"PROJECT","fieldLabel":"Project"},"children":[],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"style":"border-width:0px;","layout":"form","columnWidth":".33","border":"false","itemId":"d2"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"AMOUNT","fieldLabel":"Amount"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"panel"},{"configs":{"style":"border-width:0px;","layout":"form","columnWidth":".33","border":"false","itemId":"d3"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"AMOUNT_TAX","fieldLabel":"Amount Tax"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"form"},{"configs":{"region":"center","multiSelect":"false","itemId":"subGrid","simpleSelect":"false","editable":"true"},"children":[{"configs":{"hidden":"true","itemId":"tbar"},"children":[{"configs":{"text":"Add","itemId":"addSubBtn","iconCls":"file_add_icon"},"events":{"click":"var hid = app.H_ID.getValue();\napp.subGrid.getStore().insert(0, {'H_ID':hid});"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"-","itemId":"sp1"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"Delete","itemId":"delSubBtn","iconCls":"file_delete_icon"},"events":{"click":"var record = app.subGrid.getSelection()[0];\napp.subGrid.getStore().remove(record);"},"children":[],"expanded":false,"type":"item"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"No.","width":"40","align":"center","xtype":"rownumberer","titleAlign":"center","itemId":"rowCol"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"Asset Code","width":"180","dataIndex":"ASSET_CODE","itemId":"ASSET_CODE_COL"},"children":[{"configs":{"labelWidth":"120","triggerCls":"x-form-search-trigger","labelAlign":"right","itemId":"editor","fieldLabel":"{#cbzx#}","editable":"false"},"events":{"expand":"app.findLdDepts.fireEvent('click') ;"},"children":[{"configs":{"tagConfigs":"minWidth:420","height":"240","barExportAllButtons":"false","barExportButtons":"false","itemId":"pickComp","forceFit":"true"},"events":{"itemclick":"// 选择成本中心\nvar assetCode = record.get('ASSET_CODE');\nvar assetName = record.get('ASSET_NAME');\nvar spec = record.get('SPEC');\nvar unit = record.get('UNIT');\n\nvar selRecord = app.subGrid.getSelection()[0];\n\nselRecord.set('ASSET_CODE', assetCode);\nselRecord.set('ASSET_NAME', assetName);\nselRecord.set('SPEC', spec);\nselRecord.set('UNIT', unit);\n\n// app.pickComp.hide() ;\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/demo/ASSET_ISSUE/DATA/get_consuming_application_l"},"events":{"beforeload":"store.proxy.extraParams.textStr = app.deptCodeOrName.getValue() ;"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"Asset Code","width":"100","dataIndex":"ASSET_CODE","titleAlign":"center","itemId":"ASSET_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"Asset Name","width":"200","dataIndex":"ASSET_NAME","titleAlign":"center","itemId":"ASSET_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"Spec.","width":"180","dataIndex":"SPEC","itemId":"SPEC_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"Unit","width":"180","dataIndex":"UNIT","itemId":"UNIT_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"Quantity","width":"180","dataIndex":"QUANTITY","itemId":"QUANTITY_COL"},"children":[],"expanded":true,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"itemId":"deptCodeOrName"},"events":{"specialkey":"if(Ext.EventObject.getKey() == 13){\n  app.findLdDepts.fireEvent('click') ;\n}"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"findLdDepts","iconCls":"seek_icon"},"events":{"click":"// TODO: 加载成本中心\napp.pickComp.getStore().load() ;"},"children":[],"expanded":false,"type":"button"},{"configs":{"itemId":"clearLdDepts","iconCls":"cancel_icon"},"events":{"click":"/**app.CBZX.setValue();\napp.CBZX_NAME.setValue() ;\napp.deptCodeOrName.setValue() ;\napp.findLdDepts.fireEvent('click') ;**/"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":false,"type":"column"},{"configs":{"text":"Asset Name","width":"180","dataIndex":"ASSET_NAME","itemId":"ASSET_NAME_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"Spec.","width":"180","dataIndex":"SPEC","itemId":"SPEC_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"unit","width":"180","dataIndex":"UNIT","itemId":"UNIT_COL"},"children":[{"configs":{"pickList":"[['box','box'],['set','set']]","itemId":"editor"},"children":[],"expanded":false,"type":"combo"}],"expanded":true,"type":"column"},{"configs":{"text":"Quantity","width":"180","dataIndex":"QUANTITY","itemId":"QUANTITY_COL"},"children":[{"configs":{"itemId":"editor"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"column"},{"configs":{"text":"Price","width":"180","dataIndex":"PRICE","itemId":"PRICE_COL"},"children":[{"configs":{"itemId":"editor"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"column"},{"configs":{"text":"Tax Rate","width":"180","dataIndex":"TAX_RATE","itemId":"TAX_RATE_COL"},"children":[{"configs":{"itemId":"editor"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"column"},{"configs":{"text":"Price Tax","width":"180","dataIndex":"PRICE_TAX","itemId":"PRICE_TAX_COL"},"children":[{"configs":{"itemId":"editor"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"column"},{"configs":{"text":"Amount","width":"180","dataIndex":"AMOUT","itemId":"AMOUT_COL"},"children":[{"configs":{"itemId":"editor"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"column"},{"configs":{"text":"Amount Tax","width":"180","dataIndex":"AMOUT_TAX","itemId":"AMOUT_TAX_COL"},"children":[{"configs":{"itemId":"editor"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"column"},{"configs":{"text":"L_ID","hidden":"true","dataIndex":"L_ID","itemId":"L_ID_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"H_ID","hidden":"true","dataIndex":"H_ID","itemId":"H_ID_COL"},"children":[],"expanded":true,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"pageSize":"-1","itemId":"store","url":"m?xwl=xc/demo/IMP_PURCHASE_RESULT/DATA/get_imp_purchase_result_l"},"children":[],"expanded":false,"type":"store"}],"expanded":true,"type":"grid"},{"configs":{"itemId":"buttons"},"children":[{"configs":{"text":"Save","hidden":"true","itemId":"saveBtn","iconCls":"save_icon"},"events":{"click":"var mainJson = {};\n\nmainJson.H_ID = app.H_ID.getValue();\nmainJson.H_CODE = app.H_CODE.getValue();\nmainJson.ORG = app.ORG.getValue();\nmainJson.DEPT = app.DEPT.getValue();\nmainJson.APPLICANT = app.APPLICANT.getValue();\nmainJson.H_DATE = app.H_DATE.getRawValue();\nmainJson.PROJECT = app.PROJECT.getValue();\nmainJson.H_DESC = app.H_DESC.getValue();\nmainJson.WAREHOUSE = app.WAREHOUSE.getValue();\n\nvar url = '';\nif(app.OP_TYPE.getValue() == '_added'){\n  url = 'm?xwl=xc/demo/ASSET_ISSUE/DATA/insertMain';\n}else{\n  url = 'm?xwl=xc/demo/ASSET_ISSUE/DATA/updateMain';\n}\n\n// 提交ajax请求\nExt.Msg.wait('Saving');\nExt.Ajax.request({\n  url: url,\n  method: 'POST',\n  params: mainJson,\n  success: function(res, opts) {\n    Ext.Msg.hide();\n\n    Wb.sync({\n      grid: app.subGrid,\n      url: 'm?xwl=xc/demo/ASSET_ISSUE/DATA/saveSub',\n      success: function(resp) {\n        Wb.info('success');\n        Wb.syncCreate(app.subGrid, Wb.decode(resp.responseText));\n      }\n    });\n  },\n  failure: function(res, opts) {\n    Ext.Msg.hide();\n    Wb.error('failure');\n  }\n});\n"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"Cancel","itemId":"cancelBtn","iconCls":"cancel_icon"},"events":{"click":"app.win.close();"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"array"}],"expanded":true,"type":"window"},{"configs":{"layout":"border","itemId":"viewport"},"children":[{"configs":{"region":"north","height":"45","layout":"column","bodyPadding":"10 0 0 20","itemId":"queryPanel"},"children":[{"configs":{"labelWidth":"60","width":"240","labelAlign":"right","itemId":"queryCode","fieldLabel":"Code"},"events":{"specialkey":"if(e.getKey() == 13){\n  app.queryBtn.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"},{"configs":{"labelWidth":"100","pickList":"[['Vender01','Vender01'],['Vender02','Vender02']]","labelAlign":"right","itemId":"queryVender","fieldLabel":"Vender"},"children":[],"expanded":false,"type":"combo"},{"configs":{"text":"Query","width":"60","itemId":"queryBtn","iconCls":"seek_icon","x":"20"},"events":{"click":"app.grid.store.load();"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"Reset","width":"60","itemId":"resetBtn","iconCls":"refresh_icon","x":"40"},"events":{"click":"Wb.reset(app.queryPanel);\napp.queryBtn.fireEvent('click');"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"panel"},{"configs":{"region":"center","selType":"checkboxmodel","itemId":"grid"},"events":{"itemdblclick":"app.editBtn.fireEvent('click');"},"children":[{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"Import","itemId":"impBtn","iconCls":"db_export_icon"},"events":{"click":"// 提交ajax请求\nExt.Msg.wait('Please wait ...');\nExt.Ajax.request({\n  url: 'm?xwl=xc/demo/IMP_PURCHASE_RESULT/DATA/imp_purchase',\n  method: 'POST',\n  timeout: 300000,\n  success: function(res, opts) {\n    Ext.Msg.hide();\n    Wb.toast('success');\n    app.grid.getStore().load();\n  },\n  failure: function(res, opts) {\n    Ext.Msg.hide();\n    Wb.error('failure');\n  }\n});"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"Add","hidden":"true","itemId":"addBtn","iconCls":"file_add_icon"},"events":{"click":"app.win.setTitle('Add');\n\nWb.reset(app.mainForm);\napp.subGrid.getStore().getProxy().extraParams.hid = '-1';\napp.subGrid.getStore().load();\napp.H_ID.setValue(Xip.getId());\napp.OP_TYPE.setValue('_added');\n\napp.win.show();"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"-","hidden":"true","itemId":"sp1"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"View","itemId":"editBtn","iconCls":"file_edit_icon"},"events":{"click":"var record = app.grid.getSelection()[0];\nif (!record) {\n  Wb.warn('Please select one record');\n  return;\n}\n\napp.win.show();\n\napp.win.setTitle('Edit');\n\nWb.reset(app.mainForm);\n\nWb.setValue(app.win, record.data);\n\n//app.mainForm.loadRecord(record);\n\n/*app.H_ID.setValue(record.get('H_ID'));\napp.H_CODE.setValue(record.get('H_CODE'));\napp.ORG.setValue(record.get('ORG'));\napp.DEPT.setValue(record.get('DEPT'));\napp.APPLICANT.setValue(record.get('APPLICANT'));\napp.H_DATE.setValue(record.get('H_DATE'));\napp.PROJECT.setValue(record.get('PROJECT'));\napp.H_DESC.setValue(record.get('H_DESC'));\napp.WAREHOUSE.setValue(record.get('WAREHOUSE'));*/\n\napp.subGrid.getStore().getProxy().extraParams.hId = record.get('H_ID');\napp.subGrid.getStore().load();\n\napp.OP_TYPE.setValue(\"_modified\");"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"-","itemId":"sp2"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"Delete","hidden":"true","itemId":"delBtn","iconCls":"file_delete_icon"},"events":{"click":"var records = app.grid.getSelection();\n\nif(records.length==0){\n  Wb.warn('Please select one record');\n  return;\n}\n\nvar delIds = \"\";\n\nfor(var i=0; i<records.length; i++){\n  delIds = delIds + \"'\" + records[i].get('H_ID') + \"',\";\n}\n\ndelIds = delIds.substring(0, delIds.length-1);\n\n// 提交ajax请求\nExt.Msg.wait('Please wait ...');\nExt.Ajax.request({\n  url: 'm?xwl=xc/demo/ASSET_ISSUE/DATA/delete_asset_issue',\n  method: 'POST',\n  timeout: 300000,\n  params: {delIds: delIds},\n  success: function(res, opts) {\n    Ext.Msg.hide();\n    Wb.toast('success');\n    app.grid.getStore().load();\n  },\n  failure: function(res, opts) {\n    Ext.Msg.hide();\n    Wb.error('failure');\n  }\n});"},"children":[],"expanded":false,"type":"item"}],"expanded":true,"type":"toolbar"},{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/demo/IMP_PURCHASE_RESULT/DATA/get_imp_purchase_result_h"},"events":{"beforeload":"var whereSql = ' 1=1 ';\n\nif(!Ext.isEmpty(app.queryCode.getValue())){\n  whereSql = whereSql + \" and h.H_CODE = '\"+app.queryCode.getValue()+\"'\";\n}\n\nif(!Ext.isEmpty(app.queryVender.getValue())){\n  whereSql = whereSql + \" and h.VENDER = '\"+app.queryVender.getValue()+\"'\";\n}\n\nstore.getProxy().extraParams.whereSql = whereSql;"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"No.","width":"40","align":"center","xtype":"rownumberer","titleAlign":"center","itemId":"rowCol"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"PO Code","width":"180","dataIndex":"PO_CODE","itemId":"PO_CODE_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"Vender","width":"180","dataIndex":"VENDER","itemId":"VENDER_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"Contract","width":"180","dataIndex":"CONTRACT","itemId":"CONTRACT_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"Project","width":"180","dataIndex":"PROJECT","itemId":"PROJECT_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"Amount","width":"180","dataIndex":"AMOUNT","itemId":"AMOUNT_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"Amount Tax","width":"180","dataIndex":"AMOUNT_TAX","itemId":"AMOUNT_TAX_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"H_ID","hidden":"true","dataIndex":"H_ID","itemId":"H_ID_COL"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}