{"inframe":false,"title":"","hidden":false,"roles":{"default":1},"children":[{"configs":{"itemId":"module"},"events":{"initialize":"Ext.apply(app,{\n  opType : '',\n  initWin : function(params){\n    Ext.apply(app,params);\n    //显示窗口\n    app.win = new Ext.window.Window(app.window1);\n    app.win.show();\n    \n    app.opType = params.opType;//操作类型\n    app.H_ID.setValue(params.H_ID);//给id赋值\n    \n    //新增\n    if(app.opType == 'add'){\n      app.H_ID.setValue(Xip.getId());//添加id\n      app.grid1.store.load();\n    }\n    \n    //修改\n    if(app.opType == 'edit'){\n      //查找数据\n      Wb.request({\n        async : false,\n        url : 'm?xwl=xc/demo/po_receipt/db/select_po_receipt_h_by_id',\n        params : {H_ID : app.H_ID.getValue()},\n        success : function(resp){\n          var obj = Wb.decode(resp.responseText);\n          obj.DELIVERY_DATE = Wb.strToDate(obj.DELIVERY_DATE);\n          Wb.setValue(app.form1,obj);\n          app.grid1.store.load();\n        }\n      });\n    }\n  }\n});"},"children":[{"configs":{"maximized":"true","layout":"border","closeAction":"hide","itemId":"rowWin","modal":"true","draggable":"true"},"children":[{"configs":{"region":"center","selType":"checkboxmodel","itemId":"grid2"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/demo/po_receipt/db/select_imp_purchase_result_l"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"OK","textAlign":"center","itemId":"okBtn","iconCls":"ok_icon"},"events":{"click":"var recs = app.grid2.getSelection();\n\nif(recs.length === 0){\n  Wb.toast('Please select at least 1 records!');\n  return;\n}\nWb.each(recs,function(rec){\n  Wb.addEdit(app.grid1,{\n    L_ID : Xip.getId(),\n    H_ID : app.H_ID.getValue(),\n    ASSET_CODE : rec.get('ASSET_CODE'),\n    ASSET_NAME : rec.get('ASSET_NAME'),\n    SPEC : rec.get('SPEC'),\n    UNIT : rec.get('UNIT'),\n    QUANTITY : 0,\n    MAX_Quantity : rec.get('QUANTITY'),\n    PRICE : rec.get('PRICE'),\n    AMOUNT : 0,\n    LOCATION : '',\n    BATCH_NO : '',\n    NOTE : ''\n  });\n});\n\napp.rowWin.hide();"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"Cancel","textAlign":"center","itemId":"cancelBtn","iconCls":"cancel_icon"},"events":{"click":"app.rowWin.hide();"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"No.","align":"center","width":"50","xtype":"rownumberer","titleAlign":"center","itemId":"ROWNUM_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"L_ID","hidden":"true","dataIndex":"L_ID","titleAlign":"center","itemId":"L_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"H_ID","hidden":"true","dataIndex":"H_ID","titleAlign":"center","itemId":"H_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"ASSET_CODE","width":"150","dataIndex":"ASSET_CODE","titleAlign":"center","itemId":"ASSET_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"ASSET_NAME","width":"150","dataIndex":"ASSET_NAME","titleAlign":"center","itemId":"ASSET_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"UNIT","width":"100","dataIndex":"UNIT","titleAlign":"center","itemId":"UNIT_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"QUANTITY","width":"100","align":"right","dataIndex":"QUANTITY","titleAlign":"center","itemId":"QUANTITY_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"PRICE","width":"100","align":"right","dataIndex":"PRICE","format":"0,000.00","titleAlign":"center","itemId":"PRICE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"TAX_RATE","hidden":"true","width":"100","align":"right","dataIndex":"TAX_RATE","titleAlign":"center","itemId":"TAX_RATE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"PRICE_TAX","hidden":"true","width":"100","align":"right","dataIndex":"PRICE_TAX","titleAlign":"center","itemId":"PRICE_TAX_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"AMOUNT","width":"100","align":"right","dataIndex":"AMOUNT","format":"0,000.00","titleAlign":"center","itemId":"AMOUNT_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"AMOUNT_TAX","hidden":"true","width":"100","align":"right","dataIndex":"AMOUNT_TAX","titleAlign":"center","itemId":"AMOUNT_TAX_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"SPEC","dataIndex":"SPEC","titleAlign":"center","itemId":"SPEC_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":false,"type":"window"},{"configs":{"itemId":"toolbar1"},"children":[{"configs":{"text":"Save","textAlign":"center","itemId":"Save","iconCls":"save_icon"},"events":{"click":"//验证\nvar dtlCount = app.grid1.store.getCount();\nif(dtlCount === 0){\n  Wb.toast('Please add detail data!');\n  return;\n}\n\nif(!Wb.verify(app.form1)){\n  Wb.toast('Please fill in all required fields!');\n  return;\n}\n\nvar newRecs = app.grid1.store.getNewRecords();\nvar updateRecs = app.grid1.store.getUpdatedRecords();\nvar deleteRecs = app.grid1.store.getRemovedRecords();\n\nvar params = {\n  receipt_h : Wb.getValue(app.form1),\n  newRecs : Wb.getData(newRecs),\n  updateRecs : Wb.getData(updateRecs),\n  deleteRecs : Wb.getData(deleteRecs)\n};\n\nif(app.opType == 'add'){\n  Wb.request({\n    url : 'm?xwl=xc/demo/po_receipt/db/insert_po_receipt_h_l',\n    params : params,\n    success : function(resp){\n      Wb.toast('Save success!');\n      app.grid1.store.load();\n    }\n  });\n}else{\n  Wb.request({\n    url : 'm?xwl=xc/demo/po_receipt/db/update_po_receipt_h_l',\n    params : params,\n    success : function(resp){\n      Wb.toast('Save success!');\n      app.grid1.store.load();\n    }\n  });\n}\n"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"maximized":"true","layout":"border","itemId":"window1"},"events":{"close":"app.hideFun();"},"children":[{"configs":{"tbar":"app.toolbar1","region":"north","border":"false","itemId":"form1"},"children":[{"configs":{"layout":"column","margin":"10 10 10 0","border":"false","itemId":"tr1"},"children":[{"configs":{"tagConfigs":"{\n  columnWidth : .33\n}","labelWidth":"100","allowBlank":"false","labelAlign":"right","itemId":"H_CODE","fieldLabel":"Code"},"children":[],"expanded":false,"type":"text"},{"configs":{"tagConfigs":"{\n  columnWidth : .33\n}","labelWidth":"100","pickList":"[\n  ['ORG1','ORG1'],\n  ['ORG2','ORG2'],\n]","labelAlign":"right","itemId":"ORG","fieldLabel":"Organization"},"children":[],"expanded":false,"type":"combo"},{"configs":{"tagConfigs":"{\n  columnWidth : .33\n}","labelWidth":"100","pickList":"[\n  ['DEPT1','DEPT1'],\n  ['DEPT2','DEPT2'],\n]","labelAlign":"right","itemId":"DEPT","fieldLabel":"Department"},"children":[],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"layout":"column","margin":"10 10 10 0","border":"false","itemId":"tr2"},"children":[{"configs":{"tagConfigs":"{\n  columnWidth : .33\n}","labelWidth":"100","pickList":"[\n  ['VENDOR1','VENDOR1'],\n  ['VENDOR2','VENDOR2'],\n]","labelAlign":"right","itemId":"VENDER","fieldLabel":"Vendor"},"children":[],"expanded":false,"type":"combo"},{"configs":{"tagConfigs":"{\n  columnWidth : .33\n}","labelWidth":"100","labelAlign":"right","itemId":"PO","fieldLabel":"PO Number"},"children":[],"expanded":false,"type":"text"},{"configs":{"tagConfigs":"{\n  columnWidth : .33\n}","labelWidth":"100","pickList":"[\n  ['Hendi herdiana','Hendi herdiana'],\n  ['Gunawan','Gunawan'],\n]","labelAlign":"right","itemId":"KEEPER","fieldLabel":"Keeper"},"children":[],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"layout":"column","margin":"10 10 10 0","border":"false","itemId":"tr3"},"children":[{"configs":{"tagConfigs":"{\n  columnWidth : .33\n}","labelWidth":"100","labelAlign":"right","itemId":"CONTRACT","fieldLabel":"Contract"},"children":[],"expanded":false,"type":"text"},{"configs":{"tagConfigs":"{\n  columnWidth : .33\n}","labelWidth":"100","labelAlign":"right","itemId":"DELIVERY_DATE","fieldLabel":"Deliverry Date"},"children":[],"expanded":false,"type":"date"},{"configs":{"tagConfigs":"{\n  columnWidth : .33\n}","labelWidth":"100","pickList":"[\n  ['Wh01','Wh01'],\n  ['Wh02','Wh02'],\n]","labelAlign":"right","itemId":"WAREHOUSE","fieldLabel":"Warehouse"},"children":[],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"hidden":"true","itemId":"hidden_panel"},"children":[{"configs":{"itemId":"H_ID"},"children":[],"expanded":false,"type":"hidden"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"form"},{"configs":{"region":"center","selType":"checkboxmodel","itemId":"grid1","editable":"true"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/demo/po_receipt/db/select_po_receipt_l_by_hId"},"events":{"beforeload":"operation.params = {\n  H_ID : app.H_ID.getValue()\n};"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"Add Row","itemId":"Add","iconCls":"application_add_icon"},"events":{"click":"// var win = new Ext.window.Window(app.rowWin);\n// win.show();\napp.rowWin.show();\n\n\n// Wb.addEdit(app.grid1,{\n//   L_ID : Xip.getId(),\n//   H_ID : app.H_ID.getValue()\n// });"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"Delete Row","itemId":"Delete","iconCls":"application_delete_icon"},"events":{"click":"Wb.remove(app.grid1);"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"No.","xtype":"rownumberer","width":"50","align":"center","titleAlign":"center","itemId":"ROWNUM_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"Asset Code","width":"150 ","dataIndex":"ASSET_CODE","titleAlign":"center","itemId":"ASSET_CODE_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"Asset Name","width":"200","dataIndex":"ASSET_NAME","titleAlign":"center","itemId":"ASSET_NAME_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"Spec.","width":"200","dataIndex":"SPEC","titleAlign":"center","itemId":"SPEC_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"Uint","width":"100","dataIndex":"UNIT","titleAlign":"center","itemId":"UNIT_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"<font color='red'>*<\/font>Quantity","align":"right","width":"100","dataIndex":"QUANTITY","titleAlign":"center","itemId":"QUANTITY_COL","renderer":"metaData.style='background-color:#ffffd0';\nreturn value;"},"children":[{"configs":{"allowBlank":"false","itemId":"editor"},"events":{"change":"var rec = app.grid1.getSelection()[0];\nvar max = rec.get('MAX_Quantity');\nif(newValue > max){\n  newValue = max;\n  number.setValue(max);\n}\nvar amount = newValue * rec.get('PRICE');\n\nrec.set('AMOUNT',amount);\nreturn newValue;"},"children":[],"expanded":false,"type":"number"}],"expanded":false,"type":"column"},{"configs":{"text":"MAX Quantity","align":"right","width":"100","dataIndex":"MAX_Quantity","titleAlign":"center","itemId":"MAX_Quantity_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"Price","align":"right","width":"100","dataIndex":"PRICE","titleAlign":"center","itemId":"PRICE_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"Amount","width":"100","align":"right","dataIndex":"AMOUNT","format":"0,000.00","titleAlign":"center","itemId":"AMOUNT_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"Location","width":"150","dataIndex":"LOCATION","titleAlign":"center","itemId":"LOCATION_COL","renderer":"metaData.style='background-color:#ffffd0';\nreturn value;"},"children":[{"configs":{"itemId":"editor"},"children":[],"expanded":false,"type":"text"}],"expanded":false,"type":"column"},{"configs":{"text":"Batch No.","width":"150","dataIndex":"BATCH_NO","titleAlign":"center","itemId":"BATCH_NO_COL","renderer":"metaData.style='background-color:#ffffd0';\nreturn value;"},"children":[{"configs":{"itemId":"editor"},"children":[],"expanded":false,"type":"text"}],"expanded":false,"type":"column"},{"configs":{"text":"Note","width":"150","dataIndex":"NOTE","titleAlign":"center","itemId":"NOTE_COL","renderer":"metaData.style='background-color:#ffffd0';\nreturn value;"},"children":[{"configs":{"itemId":"editor"},"children":[],"expanded":false,"type":"text"}],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"window"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":"window_icon"}