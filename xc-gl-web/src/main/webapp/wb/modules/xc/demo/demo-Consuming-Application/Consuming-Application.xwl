{"inframe":false,"title":"","hidden":false,"roles":{"default":1},"children":[{"configs":{"loginRequired":"false","itemId":"module"},"events":{"initialize":"var ids = [];"},"children":[{"configs":{"autoShow":"false","height":"600","layout":"border","width":"800","dialog":"false","itemId":"window1","modal":"true"},"children":[{"configs":{"region":"north","layout":"form","border":"false","itemId":"mainform"},"children":[{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"save","itemId":"saveBtn","iconCls":"save_icon"},"events":{"click":"var hId = app.H_ID.getValue();\nvar vstore = app.grid2.getStore();\nvar vgrid = app.grid2;\nWb.request({\n  url:'m?xwl=xc/demo/demo-Consuming-Application/data/ifExistH',\n  params:{'hId':hId},\n  success:function(resp){\n    var rec = Wb.decode(resp.responseText);\n    if(rec.rows[0].count==0){//新增主表\n      Wb.request({\n        url:'m?xwl=xc/demo/demo-Consuming-Application/data/insertH',\n        params:Wb.getValue(app.mainform),\n        success:function(){\n          var count = vstore.getCount();\n          for(var i=0;i<count;i++){\n            Wb.request({\n              url:'m?xwl=xc/demo/demo-Consuming-Application/data/insertL',\n              params:{'H_ID':app.H_ID.getValue(),'ASSET_CODE':vstore.getAt(i).get('ASSET_CODE'),\n                      'ASSET_NAME':vstore.getAt(i).get('ASSET_NAME'),'SPEC':vstore.getAt(i).get('SPEC'),\n                      'UNIT':vstore.getAt(i).get('UNIT'),'QUANTITY':vstore.getAt(i).get('QUANTITY'),\n                      'NOTE':vstore.getAt(i).get('NOTE')},\n              success:function(){\n                Wb.toast('Successfully saved');\n                app.window1.hide();\n                app.grid1.getStore().reload();\n              }\n            });\n          }\n\n        }\n      });\n    }else{//更新主表\n      Wb.request({\n        url:'m?xwl=xc/demo/demo-Consuming-Application/data/editH',\n        params:Wb.getValue(app.mainform),\n        success:function(){\n          Wb.request({\n            url:'m?xwl=xc/demo/demo-Consuming-Application/data/deleteL',\n            params:{'ids':ids},\n            success:function(){\n\n            }\n          });\n          var count = vstore.getCount();\n          for(var j=0;j<count;j++){\n            var id = vstore.getAt(j).get('L_ID');\n            var Data = vstore.getAt(j);\n            Wb.request({\n              url:'m?xwl=xc/demo/demo-Consuming-Application/data/ifExistL',\n              params:{'lId':id},\n              async:false,\n              success:function(resp){\n                var r = Wb.decode(resp.responseText);\n                if(r.rows[0].count==0){//新增行表\n                  Wb.request({\n                    url:'m?xwl=xc/demo/demo-Consuming-Application/data/insertL',\n                    async:false,\n                    params:{'H_ID':app.H_ID.getValue(),'ASSET_CODE':Data.get('ASSET_CODE'),\n                            'ASSET_NAME':Data.get('ASSET_NAME'),'SPEC':Data.get('SPEC'),\n                            'UNIT':Data.get('UNIT'),'QUANTITY':Data.get('QUANTITY'),\n                            'NOTE':Data.get('NOTE')}\n                  \n                  });\n                }else{//修改行表\n                  Wb.request({\n                    url:'m?xwl=xc/demo/demo-Consuming-Application/data/editL',\n                    async:false,\n                    params:{'L_ID':id,'ASSET_CODE':Data.get('ASSET_CODE'),\n                            'ASSET_NAME':Data.get('ASSET_NAME'),'SPEC':Data.get('SPEC'),\n                            'UNIT':Data.get('UNIT'),'QUANTITY':Data.get('QUANTITY'),\n                            'NOTE':Data.get('NOTE')}\n                  });\n\n                }\n\n              }\n            });\t\n          }\n          Wb.toast('Successfully saved');\n          app.grid1.getStore().reload();\n          app.window1.hide();\n        }\n      });\n    }\n  }\n});"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"layout":"column","border":"false","itemId":"tr1"},"children":[{"configs":{"layout":"form","columnWidth":"0.33","border":"false","itemId":"td1_1"},"children":[{"configs":{"labelWidth":"60","labelAlign":"right","itemId":"CODE","fieldLabel":"Code"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":"0.33","border":"false","itemId":"td1_11"},"children":[{"configs":{"labelWidth":"80","displayField":"ORG","valueField":"ORG","labelAlign":"right","pickList":"[['org1','org1'],['org2','org2']]","itemId":"ORG","fieldLabel":"Organization"},"children":[],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":"0.33","border":"false","itemId":"td1_12"},"children":[{"configs":{"labelWidth":"80","displayField":"DEPT","valueField":"DEPT","labelAlign":"right","pickList":"[['dept1','dept1'],['dept2','dept2']]","itemId":"DEPT","fieldLabel":"Department"},"children":[],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"layout":"column","border":"false","itemId":"tr2"},"children":[{"configs":{"layout":"form","columnWidth":"0.33","border":"false","itemId":"td2_1"},"children":[{"configs":{"labelWidth":"60","readOnly":"true","labelAlign":"right","itemId":"APPLICATION","fieldLabel":"Applicant"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":"0.33","border":"false","itemId":"td2_11"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"DATE","fieldLabel":"Date"},"children":[],"expanded":false,"type":"date"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":"0.33","border":"false","itemId":"td2_12"},"children":[{"configs":{"labelWidth":"80","displayField":"PROJECT","valueField":"PROJECT","labelAlign":"right","pickList":"[['project1','project1'],['project2','project2']]","itemId":"PROJECT","fieldLabel":"Project"},"children":[],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"layout":"column","border":"false","itemId":"tr3"},"children":[{"configs":{"layout":"form","columnWidth":"0.66","border":"false","itemId":"td3_1"},"children":[{"configs":{"labelWidth":"60","width":"540","labelAlign":"right","itemId":"H_DESC","fieldLabel":"Description"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":"0.33","border":"false","itemId":"td3_11"},"children":[{"configs":{"labelWidth":"80","valueField":"PROJECT","labelAlign":"right","pickList":"[['Wh01','Wh01'],['Wh02','Wh02']]","itemId":"WAREHOUSE","fieldLabel":"Warehouse"},"children":[],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"hidden":"true","itemId":"hiddenPanel"},"children":[{"configs":{"itemId":"H_ID","fieldLabel":"H_ID"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"form"},{"configs":{"region":"center","selType":"checkboxmodel","itemId":"grid2","editable":"true"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/demo/demo-Consuming-Application/data/selectL"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"No.","xtype":"rownumberer","width":"50","titleAlign":"right","itemId":"NoCol"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"L_ID","hidden":"true","dataIndex":"L_ID","itemId":"L_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"Asset Code","dataIndex":"ASSET_CODE","titleAlign":"center","itemId":"ASSET_CODE_COL"},"children":[{"configs":{"normalName":"ASSET_CODE_SET","itemId":"editor","editable":"true"},"children":[{"configs":{"tagConfigs":"minWidth:300","height":"300","barExportButtons":"false","barExportAllButtons":"false","itemId":"pickComp"},"events":{"itemdblclick":"var r=app.grid2.getSelectionModel().getSelection()[0];\nr.set('ASSET_CODE',record.data.ASSET_CODE);\nr.set('ASSET_NAME',record.data.ASSET_NAME);\nr.set('SPEC',record.data.SPEC);\nr.set('UNIT',record.data.UNIT);\nr.set('QUANTITY',record.data.QUANTITY);\nr.dirty = true;\napp.ASSET_CODE_SET.setValue(record.data.ASSET_CODE);\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/demo/demo-Consuming-Application/data/selectCodeName"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"80","itemId":"queryCodeP","fieldLabel":"Code"},"children":[],"expanded":true,"type":"text"},{"configs":{"itemId":"cancelBtn","iconCls":"cancel_icon"},"events":{"click":"var r=app.grid2.getSelectionModel().getSelection()[0];\napp.queryCodeP.reset();\napp.ASSET_CODE_SET.setValue('');\nr.set('ASSET_CODE','');\n\n"},"children":[],"expanded":false,"type":"item"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"Code","dataIndex":"ASSET_CODE","titleAlign":"center","itemId":"ASSET_CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"Code","dataIndex":"ASSET_NAME","titleAlign":"center","itemId":"ASSET_NAME_COL"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":true,"type":"column"},{"configs":{"text":"Asset Name","dataIndex":"ASSET_NAME","titleAlign":"center","itemId":"ASSET_NAME_COL"},"children":[{"configs":{"normalName":"ASSET_NAME_SET","itemId":"editor1","editable":"true"},"children":[{"configs":{"tagConfigs":"minWidth:300","height":"300","barExportButtons":"false","barExportAllButtons":"false","itemId":"pickComp"},"events":{"itemdblclick":"var r=app.grid2.getSelectionModel().getSelection()[0];\nr.set('ASSET_NAME',record.data.ASSET_NAME);\nr.dirty = true;\napp.ASSET_NAME_SET.setValue(record.data.ASSET_NAME);\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/demo/demo-Consuming-Application/data/selectCodeName"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"80","itemId":"queryNameP","fieldLabel":"Name"},"children":[],"expanded":true,"type":"text"},{"configs":{"itemId":"cancelBtn","iconCls":"cancel_icon"},"events":{"click":"var r=app.grid2.getSelectionModel().getSelection()[0];\napp.queryNameP.reset();\nr.set('ASSET_NAME','');\napp.ASSET_NAME_SET.setValue('');\n\n"},"children":[],"expanded":false,"type":"item"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"Name","dataIndex":"ASSET_NAME","titleAlign":"center","itemId":"ASSET_NAME_COL"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":true,"type":"column"},{"configs":{"text":"Spec","dataIndex":"SPEC","titleAlign":"center","itemId":"SPEC_COL"},"children":[{"configs":{"itemId":"editor"},"children":[],"expanded":false,"type":"text"}],"expanded":false,"type":"column"},{"configs":{"text":"Unit","dataIndex":"UNIT","titleAlign":"center","itemId":"UNIT_COL"},"children":[{"configs":{"pickList":"[['box','box'],['set','set']]","itemId":"editor"},"children":[],"expanded":false,"type":"combo"}],"expanded":false,"type":"column"},{"configs":{"text":"Quantity","dataIndex":"QUANTITY","titleAlign":"center","itemId":"QUANTITY_COL"},"children":[{"configs":{"itemId":"editor"},"children":[],"expanded":false,"type":"text"}],"expanded":false,"type":"column"},{"configs":{"text":"Note","dataIndex":"NOTE","titleAlign":"center","itemId":"NOTE_COL"},"children":[{"configs":{"itemId":"editor"},"children":[],"expanded":false,"type":"text"}],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"add","itemId":"addDtlBtn","iconCls":"file_add_icon"},"events":{"click":"Wb.addEdit(app.grid2,[{L_ID:Xip.getId()}]);"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"-","itemId":"item2"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"delete","itemId":"delDtlBtn","iconCls":"file_delete_icon"},"events":{"click":"var rec = app.grid2.getSelection();\nif(rec.length==0){\n  return;\n}\n \nfor(var i=0;i<rec.length;i++) {\n  var id ={'id':rec[i].data.L_ID};\n  ids.push(id);\n}\nWb.remove(app.grid2);\n"},"children":[],"expanded":false,"type":"item"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"window"},{"configs":{"layout":"border","itemId":"viewport1"},"children":[{"configs":{"region":"north","layout":"form","border":"false","itemId":"queryform"},"children":[{"configs":{"layout":"column","border":"false","itemId":"tr1"},"children":[{"configs":{"layout":"form","columnWidth":"0.27","border":"false","itemId":"td1_1"},"children":[{"configs":{"labelWidth":"60","labelAlign":"right","itemId":"queryCode","fieldLabel":"Code"},"events":{"specialkey":"app.queryBtn.fireEvent('click');"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":"0.27","border":"false","itemId":"td1_11"},"children":[{"configs":{"labelWidth":"80","displayField":"ORG","valueField":"ORG","labelAlign":"right","pickList":"[['org1','org1'],['org2','org2']]","itemId":"OrganizationComBox","fieldLabel":"Organization"},"events":{"specialkey":"app.queryBtn.fireEvent('click');"},"children":[],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"layout":"form","columnWidth":"0.27","border":"false","itemId":"td2_1"},"children":[{"configs":{"labelWidth":"60","labelAlign":"right","itemId":"Applicant","fieldLabel":"Applicant"},"events":{"specialkey":"app.queryBtn.fireEvent('click');"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"layout":"column","columnWidth":"0.18","border":"false","itemId":"td2_11"},"children":[{"configs":{"text":"query","itemId":"queryBtn","iconCls":"seek_icon","x":"5"},"events":{"click":"var code = app.queryCode.getValue();\nvar org = app.OrganizationComBox.getValue();\nvar user = app.Applicant.getValue();\napp.grid1.getStore().load({params:{'code':code,'org':org,'application':user}});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"reset","itemId":"resetBtn","iconCls":"refresh_icon","x":"10"},"events":{"click":"app.queryform.getForm().reset();\napp.queryBtn.fireEvent('click');"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":false,"type":"form"},{"configs":{"region":"center","selType":"checkboxmodel","itemId":"grid1"},"events":{"itemdblclick":"app.editBtn.fireEvent('click');"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/demo/demo-Consuming-Application/data/selectH"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"No.","xtype":"rownumberer","width":"50","titleAlign":"right","itemId":"NoCol"},"children":[],"expanded":false,"type":"column"},{"configs":{"hidden":"true","dataIndex":"H_ID","itemId":"H_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"CODE","dataIndex":"CODE","titleAlign":"center","itemId":"CODE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"ORG","dataIndex":"ORG","titleAlign":"center","itemId":"ORG_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"DEPT","dataIndex":"DEPT","titleAlign":"center","itemId":"DEPT_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"APPLICATION","dataIndex":"APPLICATION","titleAlign":"center","itemId":"APPLICATION_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"DATE","xtype":"datecolumn","dataIndex":"DATE","titleAlign":"center","itemId":"DATE_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"PROJECT","dataIndex":"PROJECT","titleAlign":"center","itemId":"PROJECT_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"H_DESC","dataIndex":"H_DESC","titleAlign":"center","itemId":"H_DESC_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"WAREHOUSE","dataIndex":"WAREHOUSE","titleAlign":"center","itemId":"WAREHOUSE_COL"},"children":[],"expanded":false,"type":"column"}],"expanded":false,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"add","itemId":"addBtn","iconCls":"file_add_icon"},"events":{"click":"var win = new Ext.window.Window(app._window1);\nwin.setTitle('add');\napp.H_ID.setValue(Xip.getId());\nwin.show();\n\napp.APPLICATION.setValue('ADMIN');\napp.DATE.setValue(new Date());"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"-","itemId":"item1"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"edit","itemId":"editBtn","iconCls":"file_edit_icon"},"events":{"click":"var r = app.grid1.getSelection()[0];\nif(r.length==0){\n  Wb.toast('Please select a record');\n  return;\n}\nvar win = new Ext.window.Window(app._window1);\nWb.setValue(app.mainform,r.data);\napp.grid2.getStore().load({params:{'H_ID':r.data.H_ID}});\nwin.setTitle('edit');\nwin.show();"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"-","itemId":"item2"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"delete","itemId":"delBtn","iconCls":"file_delete_icon"},"events":{"click":"var rec = app.grid1.getSelection();\nif(rec.length==0){\n  Wb.toast('Please select a data');\n  return;\n}\nvar ids = [];\nfor(var i=0;i<rec.length;i++){\n  var id = {'id':rec[0].get('H_ID')};\n  ids.push(id);\n}\nWb.request({\n\turl:'m?xwl=xc/demo/demo-Consuming-Application/data/deleteH',\n  \tparams:{'ids':ids},\n  \tsuccess:function(){\n    \tWb.toast('Successfully deleted');\n      \tapp.grid1.getStore().reload();\n    }\n});"},"children":[],"expanded":false,"type":"item"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":false,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}