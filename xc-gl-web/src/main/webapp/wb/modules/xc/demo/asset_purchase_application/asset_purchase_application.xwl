{"inframe":false,"title":"Asset Purchase Application","hidden":false,"roles":{"default":1},"children":[{"configs":{"loginRequired":"false","serverScript":"var userId = request.getSession().getAttribute(\"XzSessionVars\").get('userId');\n\nvar protocol = request.getProtocol() ;\nvar ipAddr = request.getServerName();\nvar port = request.getServerPort() ;\nvar ctxPath = request.getContextPath() ;\n\nvar pp = protocol.substr(0,5) ;\nprotocol = (pp.indexOf(\"https\") == -1 ? \"http\" : \"https\") ;\nvar url = protocol + \"://\" + ipAddr +\":\" + port + ctxPath ;\n\nrequest.setAttribute('contextPath',ctxPath);\nrequest.setAttribute(\"userId\",userId);\nrequest.setAttribute(\"appIP\",url);\nvar appId = request.getSession().getAttribute(\"XzSessionVars\").get('appId');\nrequest.setAttribute(\"funId\",request.getParameter('funId'));\nrequest.setAttribute(\"appId\",request.getParameter('appId'));","itemId":"module"},"events":{"finalize":"var buttonChange = '';"},"children":[{"configs":{"itemId":"tool"},"children":[],"expanded":true,"type":"folder"},{"configs":{"itemId":"form1Tbar"},"children":[{"configs":{"text":"Save","itemId":"saveBtn","iconCls":"save_icon"},"events":{"click":"if(!Wb.verify(app.form1) || !Wb.verifyGrid(app.grid1)){\n    Wb.toast('Please enter all the necessary entries!');\n    return;\n}\nif(buttonChange === 'Add'){\n    saveInsert();\n}\nelse if(buttonChange === 'Edit'){\n    saveEdit();\n}\nfunction saveInsert(){\n    Wb.request({\n        url: 'm?xwl=xc/demo/asset_purchase_application/asset_purchase_applicationDB/asset_purchase_application_h_insert',\n        params: Wb.getValue(app.form1),\n        success: function(resp) {\n            saveDtl();\n            buttonChange = 'Edit';\n            app.H_CODE.setReadOnly(true);\n        }\n    });\n}\nfunction saveEdit(){\n    Wb.request({\n        url: 'm?xwl=xc/demo/asset_purchase_application/asset_purchase_applicationDB/asset_purchase_application_h_update',\n        params: Wb.getValue(app.form1),\n        success: function(resp) {\n            saveDtl();\n            app.H_CODE.setReadOnly(true);\n        }\n    });\n}\nfunction saveDtl(){\n    Wb.sync({\n        grid : app.grid1,\n        url : 'm?xwl=xc/demo/asset_purchase_application/asset_purchase_applicationDB/asset_purchase_application_l_save',\n        message : 'Saving...',\n        success : function(resp) {\n            Wb.toast('Data saved successfully!');\n            app.searchButton.fireEvent('click');\n            app.grid1.store.load({params : {H_ID : app.H_ID.getValue()}});\n        }\n    });\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"Submit","itemId":"submitButton","iconCls":"check_icon"},"events":{"click":"if(buttonChange === 'Add'){\n    Wb.toast('Please save the data first!');\n\treturn;\n}\nelse {\n    var auditStatus = app.STATUS.getValue();\n    var json = {\n        'APP_IP'\t\t\t: '{#appIP#}',\n        'EMP_ID'\t\t\t: '{#XIP.empId#}',\n        'loginName'\t\t\t: '{#XIP.userName#}',\n        'e_business_id'\t\t: app.H_ID.getValue()\n    };\n    if(auditStatus === 'A'){//起草状态\n        XipWf.startAndSubmitByProcess('XC_PRESET_DEMO',json,function(e){//提交流程\n            if(e.flag === 0){\n                saveStatus(e.instanceCode);\n            }\n            else if(e.flag === 1){\n                Wb.toast(e.msg) ;\n            }\n        });\n    }\n    else if(auditStatus === 'D'){//驳回状态\n        XipWf.submitInstance(app.INST_CODE.getValue(),json,function(e){//提交流程\n            if(e.flag === 0){\n                saveStatus(app.INST_CODE.getValue());\n            }\n            else if(e.flag === 1){\n                Wb.toast(e.msg) ;\n            }\n        });\n    }\n    else if(auditStatus === 'R'){//撤回状态\n        XipWf.restartAndSubmitByProcess(app.INST_CODE.getValue(),'XC_PRESET_DEMO',json,function(e){//提交流程\n            if(e.flag === 0){\n                saveStatus(app.INST_CODE.getValue());\n            }\n            else if(e.flag === 1){\n                Wb.toast(e.msg) ;\n            }\n        });\n    }\n    else if(auditStatus === 'E' || auditStatus === 'C'){//运行中、结束状态\n        Wb.toast('Process has been submitted, please select!');\n        return false;\n    }\n}\nfunction saveStatus(instanceCode){\n    Wb.request({\n        url : 'm?xwl=xc/demo/asset_purchase_application/asset_purchase_applicationDB/saveAuditStatus',\n        params : {H_ID : app.H_ID.getValue(),INST_CODE : instanceCode,STATUS : 'C'},\n        success : function(){\n            app.submitButton.setDisabled(true);\n            app.saveBtn.setDisabled(true);\n            app.STATUS.setValue('C');\n            app.INST_CODE.setValue(instanceCode);\n            app.searchButton.fireEvent('click');\n            Wb.toast('Process submission success!');\n        }\n    });\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"Monitor","itemId":"monitorBtn","iconCls":"viewport_icon"},"events":{"click":"if(app.INST_CODE.getValue() === null || app.INST_CODE.getValue() === '') {\n    Wb.toast('The selected data is not submitted, can not be monitored!');\n\treturn;\n}\nelse{\n    XipWf.showMonitorPage(app.INST_CODE.getValue());\n}   "},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"Withdraw","itemId":"withdrawBtn","iconCls":"cancel_icon"},"events":{"click":"if(app.STATUS.getValue() === 'A') {\n    Wb.toast('The selected data is not submitted, can not be withdrawn!');\n\treturn;\n}\nelse if(app.STATUS.getValue() === 'E') {\n    Wb.toast('The process has been approved');\n\treturn;\n}\nelse if(app.STATUS.getValue() === 'R'){\n    Wb.toast('Process has been withdrawn!');\n    return false;\n}\nelse if(app.STATUS.getValue() === 'D'){\n\tWb.toast('Process has been rejected!');\n    return false;\n}\nelse {\n    //撤回流程\n    XipWf.revokeByInstance(app.INST_CODE.getValue(),function(e){\n        if(e.flag == '0'){\n          Wb.request({\n              url : 'm?xwl=xc/demo/asset_purchase_application/asset_purchase_applicationDB/saveAuditStatus',\n              params : {H_ID : app.H_ID.getValue(),INST_CODE : app.INST_CODE.getValue(),STATUS : 'R'},\n              success : function(){\n                  Wb.toast('Process withdrawal success!');\n                  app.STATUS.setValue('R');\n                  app.submitButton.setDisabled(false);\n                  app.saveBtn.setDisabled(false);\n                  app.searchButton.fireEvent('click');\n              }\n          });\n        }\n    });\n}"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"maximized":"true","height":"500","autoScroll":"true","width":"1000","layout":"border","itemId":"window","modal":"true"},"children":[{"configs":{"region":"north","tbar":"app.form1Tbar","autoScroll":"true","border":"false","itemId":"form1"},"children":[{"configs":{"layout":"column","margin":"10 0 0 0","border":"false","itemId":"tr1"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".33","itemId":"td_1_1"},"children":[{"configs":{"labelWidth":"100","labelAlign":"right","itemId":"H_CODE","fieldLabel":"Code"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".33","itemId":"td_1_2"},"children":[{"configs":{"labelWidth":"120","pickList":"[\n  ['ORG01','ORG01'],\n  ['ORG02','ORG02']\n]","labelAlign":"right","itemId":"ORG_CODE","fieldLabel":"Organization","editable":"false"},"children":[],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".33","itemId":"td_1_3"},"children":[{"configs":{"labelWidth":"100","pickList":"[\n  ['DEPT01','DEPT01'],\n  ['DEPT02','DEPT02']\n]","labelAlign":"right","itemId":"DEPT_CODE","fieldLabel":"Department","editable":"false"},"children":[],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"layout":"column","margin":"10 0 0 0","border":"false","itemId":"tr2"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".33","itemId":"td_2_1"},"children":[{"configs":{"labelWidth":"100","pickList":"[\n  ['PROJECT01','PROJECT01'],\n  ['PROJECT02','PROJECT02']\n]","labelAlign":"right","itemId":"PRO_CODE","fieldLabel":"Project","editable":"false"},"children":[],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".33","itemId":"td_2_2"},"children":[{"configs":{"labelWidth":"120","labelAlign":"right","pickList":"[['Centralized','Centralized'],['Self','Self']]","itemId":"PURCHASE_METHOD","forceSelection":"true","fieldLabel":"Purchase Method","editable":"false"},"children":[],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".33","itemId":"td_2_3"},"children":[{"configs":{"labelWidth":"100","readOnly":"true","value":"{#XIP.empName#}","labelAlign":"right","itemId":"APPLICATE","fieldLabel":"Applicant"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"layout":"column","margin":"10 0 10 0","border":"false","itemId":"tr3"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".66","itemId":"td_3_1"},"children":[{"configs":{"labelWidth":"100","labelAlign":"right","itemId":"H_DESC","fieldLabel":"Description"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".33","itemId":"td_3_2"},"children":[{"configs":{"labelWidth":"100","value":"new Value()","labelAlign":"right","itemId":"H_DATE","fieldLabel":"Date"},"children":[],"expanded":false,"type":"date"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"hidden":"true","itemId":"hidden_p"},"children":[{"configs":{"hidden":"true","itemId":"H_ID","fieldLabel":"ID"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","value":"A","itemId":"STATUS","fieldLabel":"STATUS"},"children":[],"expanded":false,"type":"text"},{"configs":{"hidden":"true","itemId":"INST_CODE","fieldLabel":"INST_CODE"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"form"},{"configs":{"region":"center","selType":"checkboxmodel","itemId":"grid1","editable":"true"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/demo/asset_purchase_application/asset_purchase_applicationDB/asset_purchase_application_l_select"},"children":[],"expanded":false,"type":"store"},{"configs":{"normalName":"grid1Tbar","itemId":"tbar"},"children":[{"configs":{"text":"Add Line","itemId":"addLBtn","iconCls":"file_add_icon"},"events":{"click":"Wb.addEdit(app.grid1,[{H_ID : app.H_ID.getValue(),L_ID : Xip.getId()}]);"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"Delete Line","itemId":"delLBtn","iconCls":"file_delete_icon"},"events":{"click":"//删除原则，先将选中记录在表格中移除，点击主单保存时，才真正从数据库删除。\nvar recs = app.grid1.getSelection();\nif (!recs.length) {\n    Wb.toast('Please select the records you need to delete!');\n    return;\n}\nWb.confirm('Sure you want to delete the selected ' + recs.length + ' records?',function() {\n\tWb.remove(app.grid1,recs);\n});"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"NO.","align":"center","xtype":"rownumberer","width":"50","titleAlign":"center","itemId":"ORDERBY"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"L_ID","hidden":"true","dataIndex":"L_ID","titleAlign":"center","itemId":"L_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"H_ID","hidden":"true","dataIndex":"H_ID","titleAlign":"center","itemId":"H_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"Asset Code","width":"150","dataIndex":"ASSET_CODE","titleAlign":"center","itemId":"ASSET_CODE_COL"},"children":[{"configs":{"normalName":"ASSET_CODE_PICK","itemId":"editor"},"events":{"expand":"app.pickComp.getStore().load();","collapse":"app.QUERY_CODE_NAME.reset();"},"children":[{"configs":{"tagConfigs":"minWidth:400","height":"300","barExportButtons":"false","barExportAllButtons":"false","itemId":"pickComp"},"events":{"itemdblclick":"var r=app.grid1.getSelectionModel().getSelection()[0];\nr.set('ASSET_CODE',record.data.ASSET_CODE);\nr.set('ASSET_NAME',record.data.ASSET_NAME);\nr.set('UNIT',record.data.UNIT);\napp.ASSET_CODE_PICK.setValue(record.data.ASSET_CODE);\nvar picker = this.ownerCmp;\npicker.collapse();"},"children":[{"configs":{"itemId":"store","url":"m?xwl=xc/demo/asset_purchase_application/asset_purchase_applicationDB/asset_select"},"events":{"beforeload":"operation.params = Wb.getValue([app.tbar]);"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"Asset Code","dataIndex":"ASSET_CODE","itemId":"ASSET_CODE_COL","flex":"1"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"Asset Name","dataIndex":"ASSET_NAME","itemId":"ASSET_NAME_COL","flex":"1"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"},{"configs":{"itemId":"tbar"},"children":[{"configs":{"labelWidth":"100","emptyText":"Code Or Name","labelAlign":"right","itemId":"QUERY_CODE_NAME"},"events":{"specialkey":"if(Ext.EventObject.getKey()==13){\n\tapp.pickComp.getStore().load();\n}"},"children":[],"expanded":false,"type":"text"},{"configs":{"itemId":"searchButton","iconCls":"seek_icon","tooltip":"Query"},"events":{"click":"app.pickComp.getStore().load();"},"children":[],"expanded":false,"type":"button"},{"configs":{"itemId":"cancelBtn","iconCls":"delete_icon","tooltip":"Reset"},"events":{"click":"var r = app.grid1.getSelectionModel().getSelection()[0];\nr.set('ASSET_CODE',null);\nr.set('ASSET_NAME',null);\nr.set('UNIT',null);\napp.ASSET_CODE_PICK.setValue(null);\napp.ASSET_CODE_PICK.getPicker().hide();"},"children":[],"expanded":true,"type":"item"}],"expanded":true,"type":"toolbar"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"picker"}],"expanded":false,"type":"column"},{"configs":{"text":"Asset Name","width":"150","dataIndex":"ASSET_NAME","titleAlign":"center","itemId":"ASSET_NAME_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"Unit","width":"100","dataIndex":"UNIT","titleAlign":"center","itemId":"UNIT_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"Quantity","align":"right","width":"100","dataIndex":"QUANTITY","titleAlign":"center","itemId":"QUANTITY_COL"},"children":[{"configs":{"itemId":"editor"},"children":[],"expanded":false,"type":"number"}],"expanded":false,"type":"column"},{"configs":{"text":"Price","width":"120","align":"right","dataIndex":"PRICE","format":"0,000.00","titleAlign":"center","itemId":"PRICE_COL"},"children":[{"configs":{"decimalPrecision":"6","minValue":"0","itemId":"editor"},"events":{"focus":"var rec = app.grid1.getSelection()[0];\nif(rec.data.QTY === 0 || rec.data.QTY === null || Wb.isInsert == 'S' || Wb.isInsert == 'K'){\n\tnumber.setReadOnly(true);\n}\nelse{\n\tnumber.setReadOnly(false);\n}","blur":"/*\t无税金额\t= ROUND（无税单价*数量，2）\n\t税额\t\t= ROUND（无税金额*税率/100，2）\n    价税合计\t= 无税金额+税额\n    含税单价\t= ROUND（价税合计/数量，6）\n*/\n\nvar rec = app.grid1.getSelection()[0];\n\n//无税金额\nvar amount = number.value * rec.get('QTY');\nrec.set('AMOUNT',Ext.util.Format.round(amount,2));\n\n//税额\nvar taxAmt = rec.get('AMOUNT') * rec.get('TAX') / 100;\nrec.set('TAX_AMT',Ext.util.Format.round(taxAmt,2));\n\n//价税合计\nvar invAmount = rec.get('AMOUNT') + rec.get('TAX_AMT');\nrec.set('INV_AMOUNT',invAmount);\n\n//含税单价\nvar invPrice = rec.get('INV_AMOUNT') / rec.get('QTY');\nrec.set('INV_PRICE',Ext.util.Format.round(invPrice,6));"},"children":[],"expanded":false,"type":"number"}],"expanded":false,"type":"column"},{"configs":{"text":"Amount","width":"120","align":"right","dataIndex":"AMOUT","format":"0,000.00","titleAlign":"center","itemId":"AMOUNT_COL"},"children":[{"configs":{"itemId":"editor"},"children":[],"expanded":false,"type":"number"}],"expanded":false,"type":"column"},{"configs":{"text":"Require Date","width":"120","dataIndex":"REQUIRE_DATE","titleAlign":"center","itemId":"REQUIRE_DATE_COL"},"children":[{"configs":{"itemId":"editor"},"children":[],"expanded":false,"type":"date"}],"expanded":false,"type":"column"},{"configs":{"text":"Purchase Note","width":"150","dataIndex":"PURCHASE_NOTE","titleAlign":"center","itemId":"PURCHASE_NOTE_COL"},"children":[{"configs":{"itemId":"editor"},"children":[],"expanded":false,"type":"textarea"}],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"window"},{"configs":{"layout":"border","itemId":"viewport1"},"children":[{"configs":{"region":"north","autoScroll":"true","border":"false","itemId":"form"},"children":[{"configs":{"layout":"column","margin":"10 0 10 0","border":"false","itemId":"tr1"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".33","itemId":"td_1_1"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"H_CODE_INFO","fieldLabel":"Code"},"events":{"specialkey":"if(e.getKey()===13) {\n  app.searchButton.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".33","itemId":"td_1_2"},"children":[{"configs":{"labelWidth":"80","pickList":"[\n  ['ORG01','ORG01'],\n  ['ORG02','ORG02']\n]","labelAlign":"right","itemId":"ORG_CODE_INFO","fieldLabel":"Organization"},"events":{"select":"app.searchButton.fireEvent('click');","specialkey":"if(e.getKey()===13) {\n  app.searchButton.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"fit","columnWidth":".33","itemId":"td_1_3"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"column","itemId":"td_1_3_1","y":"3"},"children":[{"configs":{"labelWidth":"80","columnWidth":"1","labelAlign":"right","itemId":"H_DESC_INFO","fieldLabel":"Description"},"events":{"specialkey":"if(e.getKey()===13) {\n  app.searchButton.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"},{"configs":{"text":"Query","itemId":"searchButton","iconCls":"seek_icon"},"events":{"click":"app.grid.store.reload();"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"Reset","itemId":"resetButton","iconCls":"refresh_icon"},"events":{"click":"app.form.getForm().reset();\napp.searchButton.fireEvent('click');"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"form"},{"configs":{"region":"center","selType":"checkboxmodel","itemId":"grid","editable":"true"},"events":{"itemdblclick":"app.updateHBtn.fireEvent('click');"},"children":[{"configs":{"autoLoad":"true","itemId":"store","url":"m?xwl=xc/demo/asset_purchase_application/asset_purchase_applicationDB/asset_purchase_application_h_select"},"events":{"beforeload":"operation.params = Wb.getValue(app.form);"},"children":[],"expanded":false,"type":"store"},{"configs":{"normalName":"grid1Tbar","itemId":"tbar"},"children":[{"configs":{"text":"Add","itemId":"addHBtn","iconCls":"file_add_icon"},"events":{"click":"var win = new Ext.window.Window(app._window); //app._strategy_window指向配置对象而非实例\nwin.show();//显示窗口\nWb.setTitle(win,'Add Asset Purchase Application');//标题\napp.H_DATE.setValue(new Date());\napp.H_ID.setValue(Xip.getId());\napp.grid1.store.load({params : {H_ID : app.H_ID.getValue()}});\nbuttonChange = 'Add';"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"Edit","itemId":"updateHBtn","iconCls":"file_edit_icon"},"events":{"click":"var rec = app.grid.getSelection();\nif (rec.length > 1 || rec.length === 0) {//大于一条或没选择会警告\n    Wb.toast('Please select a record that needs to be modified!');\n    return;\n}\nvar win = new Ext.window.Window(app._window);\nwin.show();//显示窗口\nWb.setTitle(win,'Edit Asset Purchase Application');//标题\nWb.setValue(win,rec[0].data);//把记录数据应用到窗口\nbuttonChange = 'Edit';\napp.grid1.store.load({params : {H_ID : rec[0].data.H_ID}});\n// if(rec[0].data.STATIS !== 'A'){\n//     app.submitButton.setDisabled(true);\n//     app.saveBtn.setDisabled(true);\n// }\napp.H_CODE.setReadOnly(true);"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"Delete","itemId":"delHBtns","iconCls":"file_delete_icon"},"events":{"click":"var recs = app.grid.getSelection();//获得选中数据\nif (!recs.length) {//选中的数据条数\n\tWb.toast('Please select the records you need to delete!');\n\treturn;\n}\nWb.confirm('Sure you want to delete the selected ' + recs.length + ' records?',function() {\n    Wb.request({//\n        url : 'm?xwl=xc/demo/asset_purchase_application/asset_purchase_applicationDB/asset_purchase_application_h_delete',\n        params : {'deleteArray' : Wb.encode(Wb.getData(recs))},//传参\n        success : function(){\n            Wb.toast('Deleted successfully!');\n            app.searchButton.fireEvent('click');\n        }\n    });\n});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"Submit","itemId":"submitButton","iconCls":"check_icon"},"events":{"click":"var rows = app.grid.getSelection();//获得选中数据\nif (rows.length > 1 || rows.length === 0) {//大于一条或没选择会警告\n    Wb.toast('Please select a record that needs to be submitted!');\n\treturn;\n}\nelse {\n    var auditStatus = rows[0].data.STATUS;\n    var json = {\n        'APP_IP'\t\t\t: '{#appIP#}',\n        'EMP_ID'\t\t\t: '{#XIP.empId#}',\n        'loginName'\t\t\t: '{#XIP.userName#}',\n        'e_business_id'\t\t: rows[0].data.H_ID\n    };\n    if(auditStatus === 'A'){//起草状态\n        XipWf.startAndSubmitByProcess('XC_PRESET_DEMO',json,function(e){//提交流程\n            if(e.flag === 0){\n                saveStatus(e.instanceCode);\n            }\n            else if(e.flag === 1){\n                Wb.toast(e.msg) ;\n            }\n        });\n    }\n    else if(auditStatus === 'D'){//驳回状态\n        XipWf.submitInstance(rows[0].data.INST_CODE,json,function(e){//提交流程\n            if(e.flag === 0){\n                saveStatus(rows[0].data.INST_CODE);\n            }\n            else if(e.flag === 1){\n                Wb.toast(e.msg) ;\n            }\n        });\n    }\n    else if(auditStatus === 'R'){//撤回状态\n        XipWf.restartAndSubmitByProcess(rows[0].data.INST_CODE,'XC_PRESET_DEMO',json,function(e){//提交流程\n            if(e.flag === 0){\n                saveStatus(rows[0].data.INST_CODE);\n            }\n            else if(e.flag === 1){\n                Wb.toast(e.msg) ;\n            }\n        });\n    }\n    else if(auditStatus === 'E' || auditStatus === 'C'){//运行中、结束状态\n        Wb.toast('Process has been submitted, please select!');\n        return false;\n    }\n}\nfunction saveStatus(instanceCode){\n    Wb.request({\n        url : 'm?xwl=xc/demo/asset_purchase_application/asset_purchase_applicationDB/saveAuditStatus',\n        params : {H_ID : rows[0].data.H_ID,INST_CODE : instanceCode,STATUS : 'C'},\n        success : function(){\n            app.searchButton.fireEvent('click');\n            Wb.toast('Process submission success!');\n        }\n    });\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"Monitor","itemId":"monitorBtn","iconCls":"viewport_icon"},"events":{"click":"var rows = app.grid.getSelection();\nif (rows.length > 1 || rows.length === 0) {\n    Wb.toast('Please select a record that needs to be monitored!');\n    return;\n}\nif(rows[0].data.INST_CODE === null || rows[0].data.INST_CODE === '') {\n    Wb.toast('The selected data is not submitted, can not be monitored!');\n\treturn;\n}\nelse{\n    XipWf.showMonitorPage(rows[0].data.INST_CODE);\n}   "},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"Withdraw","itemId":"withdrawBtn","iconCls":"cancel_icon"},"events":{"click":"var rows = app.grid.getSelection();\nif(rows.length != 1){\n    Wb.toast('Please select a record that needs to be withdrawn!');\n\treturn;\n}\nif(rows[0].data.INST_CODE === null || rows[0].data.INST_CODE === '') {\n    Wb.toast('The selected data is not submitted, can not be withdrawn!');\n\treturn;\n}\nelse if(rows[0].data.STATUS === 'E') {\n    Wb.toast('The process has been approved');\n\treturn;\n}\nelse if(rows[0].data.STATUS === 'R'){\n    Wb.toast('Process has been withdrawn!');\n    return false;\n}\nelse if(rows[0].data.STATUS === 'D'){\n\tWb.toast('Process has been rejected!');\n    return false;\n}\nelse {\n    Wb.confirm('Be sure to withdraw the choice ' + rows.length + ' record?', function() {\n        //撤回流程\n        XipWf.revokeByInstance(rows[0].data.INST_CODE,function(e){\n            if(e.flag == '0'){\n                Wb.request({\n                    url : 'm?xwl=xc/demo/asset_purchase_application/asset_purchase_applicationDB/saveAuditStatus',\n                    params : {H_ID : rows[0].data.H_ID,INST_CODE : rows[0].data.INST_CODE,STATUS : 'R'},\n                    success : function(){\n                        Wb.toast('Process withdrawal success!');\n                        app.searchButton.fireEvent('click');\n                    }\n                });\n            }\n        });\n    });\n}"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"NO.","align":"center","xtype":"rownumberer","width":"50","titleAlign":"center","itemId":"ORDERBY"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"H_ID","hidden":"true","dataIndex":"H_ID","titleAlign":"center","itemId":"H_ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"Code","width":"150","dataIndex":"H_CODE","titleAlign":"center","itemId":"H_CODE_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"Organization","width":"150","dataIndex":"ORG_CODE","titleAlign":"center","itemId":"ORG_CODE_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"Department","width":"150","dataIndex":"DEPT_CODE","titleAlign":"center","itemId":"DEPT_CODE_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"Purchase Method","width":"180","dataIndex":"PURCHASE_METHOD","itemId":"PURCHASE_METHOD_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"Project","width":"100","dataIndex":"PRO_CODE","titleAlign":"center","itemId":"PRO_CODE_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"Applicant","width":"120","dataIndex":"APPLICATE","titleAlign":"center","itemId":"APPLICATE_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"Description","width":"150","dataIndex":"H_DESC","titleAlign":"center","itemId":"H_DESC_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"Require Date","width":"120","dataIndex":"H_DATE","titleAlign":"center","itemId":"H_DATE_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"Audit Status","hidden":"true","width":"100","dataIndex":"STATUS","titleAlign":"center","itemId":"STATUS_COL","renderer":"if(value == 'A'){\n\treturn '起草';\n}\nelse if(value == 'C'){\n\treturn '运行中';\n}\nelse if(value == 'R'){\n\treturn '撤回';\n}\nelse if(value == 'E'){\n\treturn '结束';\n}\nelse if(value == 'D'){\n\treturn '驳回';\n}\nelse{\n\treturn value ;\n}"},"children":[],"expanded":false,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}