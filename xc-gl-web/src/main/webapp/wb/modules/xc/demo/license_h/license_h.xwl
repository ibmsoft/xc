{"inframe":false,"title":"license","hidden":false,"roles":{"default":1},"children":[{"configs":{"loginRequired":"false","serverScript":"var userId = request.getSession().getAttribute(\"XzSessionVars\").get('userId');\n\nvar protocol = request.getProtocol() ;\nvar ipAddr = request.getServerName();\nvar port = request.getServerPort() ;\nvar ctxPath = request.getContextPath() ;\n\nvar pp = protocol.substr(0,5) ;\nprotocol = (pp.indexOf(\"https\") == -1 ? \"http\" : \"https\") ;\nvar url = protocol + \"://\" + ipAddr +\":\" + port + ctxPath ;\n\nrequest.setAttribute('contextPath',ctxPath);\nrequest.setAttribute(\"userId\",userId);\nrequest.setAttribute(\"appIP\",url);\nvar appId = request.getSession().getAttribute(\"XzSessionVars\").get('appId');\nrequest.setAttribute(\"funId\",request.getParameter('funId'));\nrequest.setAttribute(\"appId\",request.getParameter('appId'));","itemId":"module"},"events":{"finalize":"var buttonChange = '';"},"children":[{"configs":{"maximized":"true","height":"500","autoScroll":"true","layout":"border","width":"1000","buttonAlign":"center","itemId":"window","modal":"true"},"events":{"close":"app.grid.getStore().load();"},"children":[{"configs":{"itemId":"OP_TYPE"},"children":[],"expanded":false,"type":"text"},{"configs":{"tbar":"app.form1Tbar","region":"north","autoScroll":"true","itemId":"mainForm","border":"false"},"children":[{"configs":{"layout":"column","margin":"10 0 0 0","itemId":"tr1","border":"false"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".33","itemId":"td_1_1"},"children":[{"configs":{"labelWidth":"100","allowBlank":"false","labelAlign":"right","itemId":"ID","fieldLabel":"ID"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".33","itemId":"td_1_2"},"children":[{"configs":{"labelWidth":"100","labelAlign":"right","itemId":"NAME","fieldLabel":"Name"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".33","itemId":"td_1_3"},"children":[{"configs":{"labelWidth":"100","labelAlign":"right","itemId":"PLACE","fieldLabel":"The Place"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"layout":"column","margin":"10 0 0 0","itemId":"tr2","border":"false"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".33","itemId":"td_2_1"},"children":[{"configs":{"labelWidth":"100","labelAlign":"right","itemId":"BIRTHDAY","fieldLabel":"Birthday"},"children":[],"expanded":false,"type":"date"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".33","itemId":"td_2_2"},"children":[{"configs":{"labelWidth":"100","pickList":"[['Male','Male'],['Female','Female']]","labelAlign":"right","itemId":"GENDER","fieldLabel":"Gender","editable":"false"},"children":[],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".33","itemId":"td_2_3"},"children":[{"configs":{"labelWidth":"100","pickList":"[['A','A'],['B','B'],['AB','AB'],['O','O']]","labelAlign":"right","itemId":"BLOOD_TYPE","fieldLabel":"Blood Type","editable":"false"},"children":[],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"layout":"column","margin":"10 0 0 0","itemId":"tr3","border":"false"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".66","itemId":"td_3_1"},"children":[{"configs":{"labelWidth":"100","labelAlign":"right","itemId":"ADDRESS","fieldLabel":"Address"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".33","itemId":"td_3_2"},"children":[{"configs":{"labelWidth":"100","labelAlign":"right","itemId":"RELIGION","fieldLabel":"Religion"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"layout":"column","margin":"10 0 10 0","itemId":"tr4","border":"false"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".33","itemId":"td_4_1"},"children":[{"configs":{"labelWidth":"100","labelAlign":"right","itemId":"WORK","fieldLabel":"Work"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".33","itemId":"td_4_2"},"children":[{"configs":{"labelWidth":"100","pickList":"[['YES','YES'],['NO','NO']]","labelAlign":"right","itemId":"MARRAGE","fieldLabel":"Marrage","editable":"false"},"children":[],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"form"},{"configs":{"region":"center","itemId":"tabPanel"},"children":[{"configs":{"title":"Driving License","layout":"border","border":"false","itemId":"Driving License"},"children":[{"configs":{"region":"north","height":"85","autoScroll":"true","itemId":"dlForm","border":"false"},"children":[{"configs":{"layout":"column","margin":"10 0 0 0","itemId":"tr1","border":"false"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".33","itemId":"td_1_1"},"children":[{"configs":{"labelWidth":"100","allowBlank":"false","labelAlign":"right","itemId":"LICENSE_ID","fieldLabel":"License ID"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".33","itemId":"td_1_2"},"children":[{"configs":{"labelWidth":"100","pickList":"[['A','A'],['B','B'],['C','C'],['D','D']]","labelAlign":"right","itemId":"LICENSE_CLASS","fieldLabel":"License Class","editable":"false"},"children":[],"expanded":false,"type":"combo"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".33","itemId":"td_1_3"},"children":[{"configs":{"labelWidth":"100","labelAlign":"right","itemId":"LICENSE_ISSUED","fieldLabel":"Issued"},"children":[],"expanded":false,"type":"date"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"},{"configs":{"layout":"column","margin":"10 0 0 0","itemId":"tr3","border":"false"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".33","itemId":"td_4_1"},"children":[{"configs":{"labelWidth":"100","labelAlign":"right","itemId":"LICENSE_VALID_FROM","fieldLabel":"Valid From"},"events":{"blur":"var _validFrom = app.LICENSE_VALID_FROM.getRawValue();\nvar _validFor = app.LICENSE_VALID_FOR.getValue();\nif(!Ext.isEmpty(_validFrom) && !Ext.isEmpty(_validFor)){\n  var _year = _validFrom.substring(0, 4);\n  var _newDate = Number(_year) + Number(_validFor) + _validFrom.substring(4, 10);\n  app.LICENSE_EXPIRES.setValue(_newDate);\n}"},"children":[],"expanded":false,"type":"date"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".33","itemId":"td_4_2"},"children":[{"configs":{"labelWidth":"100","minValue":"0","labelAlign":"right","allowDecimals":"false","itemId":"LICENSE_VALID_FOR","fieldLabel":"Valid For(Year)"},"events":{"blur":"var _validFrom = app.LICENSE_VALID_FROM.getRawValue();\nvar _validFor = app.LICENSE_VALID_FOR.getValue();\nif(!Ext.isEmpty(_validFrom) && !Ext.isEmpty(_validFor)){\n  var _year = _validFrom.substring(0, 4);\n  var _newDate = Number(_year) + Number(_validFor) + _validFrom.substring(4, 10);\n  app.LICENSE_EXPIRES.setValue(_newDate);\n}"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".33","itemId":"td_4_3"},"children":[{"configs":{"labelWidth":"100","readOnly":"true","labelAlign":"right","itemId":"LICENSE_EXPIRES","fieldLabel":"Expires"},"children":[],"expanded":false,"type":"date"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"form"},{"configs":{"region":"center","pagingBar":"false","selType":"checkboxmodel","itemId":"dlGrid","editable":"true"},"events":{"tagEvents":"cellclick:function(tab, td, cellIndex, record, tr, rowIndex, e, eOpts ){\n  if(Ext.isEmpty(record.get('OP'))){\n    return false;\n  }\n  return true;\n}"},"children":[{"configs":{"itemId":"tbar"},"children":[{"configs":{"text":"Add","itemId":"addBtn"},"events":{"click":"Wb.add(app.dlGrid, {L_ID: Wb.getId(), 'OP':'NEW'}, 'first', 1, false);"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"-","itemId":"sp1"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"Delete","itemId":"deleteBtn"},"events":{"click":"Wb.remove(app.dlGrid);\n"},"children":[],"expanded":false,"type":"item"}],"expanded":true,"type":"toolbar"},{"configs":{"pageSize":"-1","itemId":"store","url":"m?xwl=xc/demo/license_h/license_hDB/license_l_select"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"NO.","width":"50","xtype":"rownumberer","align":"center","titleAlign":"center","itemId":"ORDERBY"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"L_ID","hidden":"true","dataIndex":"L_ID","titleAlign":"center","itemId":"L_ID_COL"},"children":[{"configs":{"itemId":"editor"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"column"},{"configs":{"text":"Date","xtype":"datecolumn","width":"120","dataIndex":"DATE","titleAlign":"center","itemId":"DATE_COL"},"children":[{"configs":{"itemId":"editor"},"children":[],"expanded":false,"type":"date"}],"expanded":true,"type":"column"},{"configs":{"text":"Operation","width":"150","dataIndex":"OPERATION","titleAlign":"center","itemId":"OPERATION_COL"},"children":[{"configs":{"itemId":"editor"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"column"},{"configs":{"text":"CLASS","dataIndex":"CLASS","titleAlign":"center","itemId":"CLASS_COL"},"children":[{"configs":{"labelWidth":"100","pickList":"[['A','A'],['B','B'],['C','C'],['D','D']]","labelAlign":"right","itemId":"editor","editable":"false"},"events":{"select":"app.LICENSE_CLASS.setValue(this.getValue());"},"children":[],"expanded":false,"type":"combo"}],"expanded":true,"type":"column"},{"configs":{"text":"Valid From","width":"150","dataIndex":"VALID_FROM","titleAlign":"center","itemId":"VALID_FROM_COL"},"children":[{"configs":{"itemId":"editor"},"events":{"select":"app.LICENSE_VALID_FROM.setValue(this.getValue());alert();\n\nvar _validFrom = app.LICENSE_VALID_FROM.getRawValue();\nvar _validFor = app.LICENSE_VALID_FOR.getValue();\nif(!Ext.isEmpty(_validFrom) && !Ext.isEmpty(_validFor)){\n  var _year = _validFrom.substring(0, 4);\n  var _newDate = Number(_year) + Number(_validFor) + _validFrom.substring(4, 10);\n  app.LICENSE_EXPIRES.setValue(_newDate);\n}"},"children":[],"expanded":false,"type":"date"}],"expanded":true,"type":"column"},{"configs":{"text":"Valid For","width":"200","dataIndex":"VALID_FOR","titleAlign":"center","itemId":"VALID_FOR_COL"},"children":[{"configs":{"minValue":"0","itemId":"editor"},"events":{"blur":"app.LICENSE_VALID_FOR.setValue(this.getValue());\n\nvar _validFrom = app.LICENSE_VALID_FROM.getRawValue();\nvar _validFor = app.LICENSE_VALID_FOR.getValue();\nif(!Ext.isEmpty(_validFrom) && !Ext.isEmpty(_validFor)){\n  var _year = _validFrom.substring(0, 4);\n  var _newDate = Number(_year) + Number(_validFor) + _validFrom.substring(4, 10);\n  app.LICENSE_EXPIRES.setValue(_newDate);\n}"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"column"},{"configs":{"text":"Receipt ID","width":"200","dataIndex":"RECEIPT_ID","titleAlign":"center","itemId":"RECEIPT_ID_COL"},"children":[{"configs":{"itemId":"editor"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"column"},{"configs":{"text":"Amount","align":"right","width":"120","dataIndex":"AMOUNT","format":"0,000.00","titleAlign":"center","itemId":"AMOUNT_COL"},"children":[{"configs":{"minValue":"0","itemId":"editor"},"children":[],"expanded":false,"type":"number"}],"expanded":true,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"tab"},{"configs":{"itemId":"buttons"},"children":[{"configs":{"text":"Save","itemId":"saveBtn","iconCls":"save_icon"},"events":{"click":"if(!app.mainForm.getForm().isValid() || !app.dlForm.getForm().isValid()){\n  Wb.toast('Please input the required Information');\n  return;\n}\n\nvar mainJson = Wb.getValue(app.mainForm);\nvar dlFormValues = Wb.getValue(app.dlForm);\nmainJson = Ext.apply(mainJson, dlFormValues);\n\nif(app.dlGrid.store.getNewRecords().length > 0){\n  var records = app.dlGrid.store.getNewRecords();\n  for(var i=0; i<records.length; i++){\n    var record = records[i];\n    record.set('LICENSE_ID', app.LICENSE_ID.getValue());\n  }\n}\n\nvar newDlRecs = [];\nfor(var i=0; i<app.dlGrid.store.getNewRecords().length; i++){\n  newDlRecs.push(app.dlGrid.store.getNewRecords()[i].data);\n}\nvar updateDlRecs = [];\nfor(var i=0; i<app.dlGrid.store.getUpdatedRecords().length; i++){\n  updateDlRecs.push(app.dlGrid.store.getUpdatedRecords()[i].data);\n}\nvar deleteDlRecs = [];\nfor(var i=0; i<app.dlGrid.store.getRemovedRecords().length; i++){\n  deleteDlRecs.push(app.dlGrid.store.getRemovedRecords()[i].data);\n}\n\nvar params = {};\nparams.mainJson = mainJson;\nparams.newDlRecs = newDlRecs;\nparams.updateDlRecs = updateDlRecs;\nparams.deleteDlRecs = deleteDlRecs;\n\nif(app.OP_TYPE.getValue() == '_added'){\n  Wb.request({\n    url : 'm?xwl=xc/demo/license_h/license_hDB/insert_license',\n    params : params,\n    success : function(resp){\n      Wb.toast('Save success!');\n      //app.dlGrid.store.load();\n    }\n  });\n}else{\n  Wb.request({\n    url : 'm?xwl=xc/demo/license_h/license_hDB/update_license',\n    params : params,\n    success : function(resp){\n      Wb.toast('Save success!');\n      app.dlGrid.store.commitChanges();\n      //app.dlGrid.store.load();\n    }\n  });\n}"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"cancel","itemId":"cancelBtn","iconCls":"delete_icon"},"events":{"click":"app.window.hide();"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"array"}],"expanded":true,"type":"window"},{"configs":{"layout":"border","itemId":"viewport"},"children":[{"configs":{"region":"north","autoScroll":"true","itemId":"form","border":"false"},"children":[{"configs":{"layout":"column","margin":"10 0 10 0","itemId":"tr1","border":"false"},"children":[{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".33","itemId":"td_1_1"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"ID_INFO","fieldLabel":"ID"},"events":{"specialkey":"if(e.getKey()===13) {\n  app.searchButton.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"form","columnWidth":".33","itemId":"td_1_2"},"children":[{"configs":{"labelWidth":"80","labelAlign":"right","itemId":"NAME_INFO","fieldLabel":"Name"},"events":{"specialkey":"if(e.getKey()===13) {\n  app.searchButton.fireEvent('click');\n}"},"children":[],"expanded":false,"type":"text"}],"expanded":true,"type":"panel"},{"configs":{"tagConfigs":"baseCls : 'my-panel-no-border'","layout":"column","columnWidth":".33","itemId":"td_1_3"},"children":[{"configs":{"text":"Query","itemId":"searchButton","y":"3","iconCls":"seek_icon","x":"5"},"events":{"click":"app.grid.store.reload();"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"Reset","itemId":"resetButton","y":"3","iconCls":"refresh_icon","x":"10"},"events":{"click":"app.form.getForm().reset();\napp.searchButton.fireEvent('click');"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"panel"}],"expanded":true,"type":"form"},{"configs":{"region":"center","itemId":"grid","editable":"true"},"events":{"itemdblclick":"app.editBtn.fireEvent('click');"},"children":[{"configs":{"itemId":"store","autoLoad":"true","url":"m?xwl=xc/demo/license_h/license_hDB/license_h_select"},"events":{"beforeload":"operation.params = Wb.getValue(app.form);"},"children":[],"expanded":false,"type":"store"},{"configs":{"itemId":"tbar","normalName":"grid1Tbar"},"children":[{"configs":{"text":"Add","itemId":"addBtn","iconCls":"file_add_icon"},"events":{"click":"var win = new Ext.window.Window(app._window);\nwin.show();//显示窗口\napp.OP_TYPE.setValue('_added');\n\nWb.reset(app.mainForm);\nWb.reset(app.dlForm);\n\n//Wb.setValue(win,recs[0].data);//把记录数据应用到窗口\napp.dlGrid.store.load({params : {ID : '-1'}});"},"children":[],"expanded":false,"type":"button"},{"configs":{"text":"-","itemId":"sp1"},"children":[],"expanded":false,"type":"item"},{"configs":{"text":"Edit","itemId":"editBtn","iconCls":"file_edit_icon"},"events":{"click":"var recs = app.grid.getSelection();\nif (recs.length > 1 || recs.length === 0) {//大于一条或没选择会警告\n    Wb.toast('Please select a data view!');\n    return;\n}\nvar win = new Ext.window.Window(app._window);\nwin.show();//显示窗口\napp.OP_TYPE.setValue('_modified');\nWb.setValue(win,recs[0].data);//把记录数据应用到窗口\napp.dlGrid.store.load({params : {LICENSE_ID : recs[0].data.LICENSE_ID}});"},"children":[],"expanded":false,"type":"button"}],"expanded":true,"type":"toolbar"},{"configs":{"itemId":"columns"},"children":[{"configs":{"text":"NO.","width":"50","xtype":"rownumberer","align":"center","titleAlign":"center","itemId":"ORDERBY"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"ID","width":"100","dataIndex":"ID","titleAlign":"center","itemId":"ID_COL"},"children":[],"expanded":false,"type":"column"},{"configs":{"text":"Name","width":"150","dataIndex":"NAME","titleAlign":"center","itemId":"NAME_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"Place","width":"100","dataIndex":"PLACE","titleAlign":"center","itemId":"PLACE_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"Birthday","width":"100","dataIndex":"BIRTHDAY","titleAlign":"center","itemId":"BIRTHDAY_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"Gender","width":"100","dataIndex":"GENDER","titleAlign":"center","itemId":"GENDER_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"Blood type","width":"100","dataIndex":"BLOOD_TYPE","titleAlign":"center","itemId":"BLOOD_TYPE_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"Address","width":"100","dataIndex":"ADDRESS","titleAlign":"center","itemId":"ADDRESS_COL","flex":"1"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"Religion","width":"120","dataIndex":"RELIGION","titleAlign":"center","itemId":"RELIGION_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"Work","width":"100","dataIndex":"WORK","titleAlign":"center","itemId":"WORK_COL"},"children":[],"expanded":true,"type":"column"},{"configs":{"text":"Marrage","width":"120","dataIndex":"MARRAGE","titleAlign":"center","itemId":"MARRAGE_COL"},"children":[],"expanded":true,"type":"column"}],"expanded":true,"type":"array"}],"expanded":true,"type":"grid"}],"expanded":true,"type":"viewport"}],"expanded":true,"type":"module"}],"pageLink":"","iconCls":""}